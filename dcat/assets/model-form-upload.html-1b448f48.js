import{_ as i}from"./plugin-vue_export-helper-c27b6911.js";import{r as p,o as l,c,a as s,b as n,d as a,w as u,e as t}from"./app-c17653d8.js";const r={},d=s("h1",{id:"picture-file-upload",tabindex:"-1"},[s("a",{class:"header-anchor",href:"#picture-file-upload","aria-hidden":"true"},"#"),n(" Picture/file upload")],-1),k={href:"https://fex.baidu.com/webuploader/",target:"_blank",rel:"noopener noreferrer"},g={href:"https://fex.baidu.com/webuploader/document",target:"_blank",rel:"noopener noreferrer"},m=t(`<blockquote><p>{tip} Please do not set the <strong>accessor</strong> and <strong>mutator</strong> splicing domain name in the file or image upload form fields in the model, please refer to <a href="#withhost">File/Image Domain Splicing</a> for related requirements.</p></blockquote><div class="language-php line-numbers-mode" data-ext="php"><pre class="language-php"><code><span class="token variable">$form</span><span class="token operator">-&gt;</span><span class="token function">file</span><span class="token punctuation">(</span><span class="token string single-quoted-string">&#39;file_column&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$form</span><span class="token operator">-&gt;</span><span class="token function">image</span><span class="token punctuation">(</span><span class="token string single-quoted-string">&#39;image_column&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="local-upload" tabindex="-1"><a class="header-anchor" href="#local-upload" aria-hidden="true">#</a> Local Upload</h2><p>First add the storage configuration, <code>config/filesystems.php</code> and add a <code>disk</code>:</p><div class="language-php line-numbers-mode" data-ext="php"><pre class="language-php"><code>
<span class="token string single-quoted-string">&#39;disks&#39;</span> <span class="token operator">=&gt;</span> <span class="token punctuation">[</span>
    <span class="token operator">...</span> <span class="token punctuation">,</span>

    <span class="token string single-quoted-string">&#39;admin&#39;</span> <span class="token operator">=&gt;</span> <span class="token punctuation">[</span>
        <span class="token string single-quoted-string">&#39;driver&#39;</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">&#39;local&#39;</span><span class="token punctuation">,</span>
        <span class="token string single-quoted-string">&#39;root&#39;</span> <span class="token operator">=&gt;</span> <span class="token function">public_path</span><span class="token punctuation">(</span><span class="token string single-quoted-string">&#39;uploads&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token string single-quoted-string">&#39;visibility&#39;</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">&#39;public&#39;</span><span class="token punctuation">,</span>
        <span class="token string single-quoted-string">&#39;url&#39;</span> <span class="token operator">=&gt;</span> <span class="token function">env</span><span class="token punctuation">(</span><span class="token string single-quoted-string">&#39;APP_URL&#39;</span><span class="token punctuation">)</span><span class="token operator">.</span><span class="token string single-quoted-string">&#39;/uploads&#39;</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">,</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Set the upload path to <code>public/uploads</code>(public_path(&#39;uploads&#39;)).</p><p>Then select the uploaded <code>disk</code>, open <code>config/admin.php</code> and find</p><div class="language-php line-numbers-mode" data-ext="php"><pre class="language-php"><code>    
<span class="token string single-quoted-string">&#39;upload&#39;</span>  <span class="token operator">=&gt;</span> <span class="token punctuation">[</span>

    <span class="token string single-quoted-string">&#39;disk&#39;</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">&#39;admin&#39;</span><span class="token punctuation">,</span>

    <span class="token string single-quoted-string">&#39;directory&#39;</span>  <span class="token operator">=&gt;</span> <span class="token punctuation">[</span>
        <span class="token string single-quoted-string">&#39;image&#39;</span>  <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">&#39;images&#39;</span><span class="token punctuation">,</span>
        <span class="token string single-quoted-string">&#39;file&#39;</span>   <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">&#39;files&#39;</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span>
<span class="token punctuation">]</span><span class="token punctuation">,</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Set <code>disk</code> to <code>admin</code> added above, and <code>directory.image</code> and <code>directory.file</code> to the upload directories for images and files uploaded with <code>$form-&gt;image($column)</code> and <code>$form-&gt;file($column)</code>, respectively.</p><p>Of course, you can also specify <code>disk</code> in the code:</p><div class="language-php line-numbers-mode" data-ext="php"><pre class="language-php"><code><span class="token variable">$form</span><span class="token operator">-&gt;</span><span class="token function">file</span><span class="token punctuation">(</span><span class="token string single-quoted-string">&#39;file&#39;</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">disk</span><span class="token punctuation">(</span><span class="token string single-quoted-string">&#39;your disk name&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h2 id="cloud-uploads" tabindex="-1"><a class="header-anchor" href="#cloud-uploads" aria-hidden="true">#</a> Cloud uploads</h2><p>If you need to upload to cloud storage, you need to install an adapter for <code>laravel storage</code>.</p>`,13),v={href:"https://github.com/zgldh/qiniu-laravel-storage",target:"_blank",rel:"noopener noreferrer"},h=t(`<p>With the disk configured as well, add an entry to <code>config/filesystems.php</code>:</p><div class="language-php line-numbers-mode" data-ext="php"><pre class="language-php"><code><span class="token string single-quoted-string">&#39;disks&#39;</span> <span class="token operator">=&gt;</span> <span class="token punctuation">[</span>
    <span class="token operator">...</span> <span class="token punctuation">,</span>
    <span class="token string single-quoted-string">&#39;qiniu&#39;</span> <span class="token operator">=&gt;</span> <span class="token punctuation">[</span>
        <span class="token string single-quoted-string">&#39;driver&#39;</span>  <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">&#39;qiniu&#39;</span><span class="token punctuation">,</span>
        <span class="token string single-quoted-string">&#39;domains&#39;</span> <span class="token operator">=&gt;</span> <span class="token punctuation">[</span>
            <span class="token string single-quoted-string">&#39;default&#39;</span>   <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">&#39;xxxxx.com1.z0.glb.clouddn.com&#39;</span><span class="token punctuation">,</span> <span class="token comment">//你的七牛域名</span>
            <span class="token string single-quoted-string">&#39;https&#39;</span>     <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">&#39;dn-yourdomain.qbox.me&#39;</span><span class="token punctuation">,</span>         <span class="token comment">//你的HTTPS域名</span>
            <span class="token string single-quoted-string">&#39;custom&#39;</span>    <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">&#39;static.abc.com&#39;</span><span class="token punctuation">,</span>                <span class="token comment">//你的自定义域名</span>
         <span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token string single-quoted-string">&#39;access_key&#39;</span><span class="token operator">=&gt;</span> <span class="token string single-quoted-string">&#39;&#39;</span><span class="token punctuation">,</span>  <span class="token comment">//AccessKey</span>
        <span class="token string single-quoted-string">&#39;secret_key&#39;</span><span class="token operator">=&gt;</span> <span class="token string single-quoted-string">&#39;&#39;</span><span class="token punctuation">,</span>  <span class="token comment">//SecretKey</span>
        <span class="token string single-quoted-string">&#39;bucket&#39;</span>    <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">&#39;&#39;</span><span class="token punctuation">,</span>  <span class="token comment">//Bucket名字</span>
        <span class="token string single-quoted-string">&#39;notify_url&#39;</span><span class="token operator">=&gt;</span> <span class="token string single-quoted-string">&#39;&#39;</span><span class="token punctuation">,</span>  <span class="token comment">//持久化处理回调地址</span>
        <span class="token string single-quoted-string">&#39;url&#39;</span>       <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">&#39;http://of8kfibjo.bkt.clouddn.com/&#39;</span><span class="token punctuation">,</span>  <span class="token comment">// 填写文件访问根url</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">,</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Then modify the <code>dcat-admin</code> upload configuration by opening <code>config/admin.php</code> and find:</p><div class="language-php line-numbers-mode" data-ext="php"><pre class="language-php"><code>
<span class="token string single-quoted-string">&#39;upload&#39;</span>  <span class="token operator">=&gt;</span> <span class="token punctuation">[</span>

    <span class="token string single-quoted-string">&#39;disk&#39;</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">&#39;qiniu&#39;</span><span class="token punctuation">,</span>

    <span class="token string single-quoted-string">&#39;directory&#39;</span>  <span class="token operator">=&gt;</span> <span class="token punctuation">[</span>
        <span class="token string single-quoted-string">&#39;image&#39;</span>  <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">&#39;image&#39;</span><span class="token punctuation">,</span>
        <span class="token string single-quoted-string">&#39;file&#39;</span>   <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">&#39;file&#39;</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">,</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code>disk</code> select <code>qiniu</code> as configured above, or:</p><div class="language-php line-numbers-mode" data-ext="php"><pre class="language-php"><code><span class="token variable">$form</span><span class="token operator">-&gt;</span><span class="token function">file</span><span class="token punctuation">(</span><span class="token string single-quoted-string">&#39;file&#39;</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">disk</span><span class="token punctuation">(</span><span class="token string single-quoted-string">&#39;qiniu&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h2 id="public-methods" tabindex="-1"><a class="header-anchor" href="#public-methods" aria-hidden="true">#</a> Public methods</h2><h3 id="thumbnail" tabindex="-1"><a class="header-anchor" href="#thumbnail" aria-hidden="true">#</a> Thumbnail</h3><p>Generate thumbnails while uploading images</p><div class="language-php line-numbers-mode" data-ext="php"><pre class="language-php"><code><span class="token variable">$form</span><span class="token operator">-&gt;</span><span class="token function">image</span><span class="token punctuation">(</span><span class="token variable">$column</span><span class="token punctuation">[</span><span class="token punctuation">,</span> <span class="token variable">$label</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">thumbnail</span><span class="token punctuation">(</span><span class="token string single-quoted-string">&#39;small&#39;</span><span class="token punctuation">,</span> <span class="token variable">$width</span> <span class="token operator">=</span> <span class="token number">300</span><span class="token punctuation">,</span> <span class="token variable">$height</span> <span class="token operator">=</span> <span class="token number">300</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Generate multiple thumbnails</span>
<span class="token variable">$form</span><span class="token operator">-&gt;</span><span class="token function">image</span><span class="token punctuation">(</span><span class="token variable">$column</span><span class="token punctuation">[</span><span class="token punctuation">,</span> <span class="token variable">$label</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">thumbnail</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
    <span class="token string single-quoted-string">&#39;small1&#39;</span> <span class="token operator">=&gt;</span> <span class="token punctuation">[</span><span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token string single-quoted-string">&#39;small2&#39;</span> <span class="token operator">=&gt;</span> <span class="token punctuation">[</span><span class="token number">200</span><span class="token punctuation">,</span> <span class="token number">200</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token string single-quoted-string">&#39;small3&#39;</span> <span class="token operator">=&gt;</span> <span class="token punctuation">[</span><span class="token number">300</span><span class="token punctuation">,</span> <span class="token number">300</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-php line-numbers-mode" data-ext="php"><pre class="language-php"><code><span class="token keyword">use</span> <span class="token package">Dcat<span class="token punctuation">\\</span>Admin<span class="token punctuation">\\</span>Traits<span class="token punctuation">\\</span>Resizable</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name-definition class-name">Photo</span> <span class="token keyword">extends</span> <span class="token class-name">Model</span>
<span class="token punctuation">{</span>
    <span class="token keyword">use</span> <span class="token package">Resizable</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// To access thumbnail</span>
<span class="token variable">$photo</span><span class="token operator">-&gt;</span><span class="token function">thumbnail</span><span class="token punctuation">(</span><span class="token string single-quoted-string">&#39;small&#39;</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">&#39;photo_column&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="storage-drive-disk" tabindex="-1"><a class="header-anchor" href="#storage-drive-disk" aria-hidden="true">#</a> Storage drive (disk)</h3><p>Modify file upload source</p><div class="language-php line-numbers-mode" data-ext="php"><pre class="language-php"><code><span class="token variable">$form</span><span class="token operator">-&gt;</span><span class="token function">file</span><span class="token punctuation">(</span><span class="token string single-quoted-string">&#39;file&#39;</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">disk</span><span class="token punctuation">(</span><span class="token string single-quoted-string">&#39;your disk name&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="upload-path-move" tabindex="-1"><a class="header-anchor" href="#upload-path-move" aria-hidden="true">#</a> Upload path (move)</h3><p>Modify the upload path</p><div class="language-php line-numbers-mode" data-ext="php"><pre class="language-php"><code><span class="token variable">$form</span><span class="token operator">-&gt;</span><span class="token function">file</span><span class="token punctuation">(</span><span class="token string single-quoted-string">&#39;file&#39;</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">move</span><span class="token punctuation">(</span><span class="token string single-quoted-string">&#39;public/upload/image1/&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="file-name-name" tabindex="-1"><a class="header-anchor" href="#file-name-name" aria-hidden="true">#</a> File name (name)</h3><p>Modify the upload file name</p><div class="language-php line-numbers-mode" data-ext="php"><pre class="language-php"><code><span class="token variable">$form</span><span class="token operator">-&gt;</span><span class="token function">file</span><span class="token punctuation">(</span><span class="token string single-quoted-string">&#39;file&#39;</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">name</span><span class="token punctuation">(</span><span class="token string single-quoted-string">&#39;test.text&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token variable">$form</span><span class="token operator">-&gt;</span><span class="token function">image</span><span class="token punctuation">(</span><span class="token string single-quoted-string">&#39;picture&#39;</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">name</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token variable">$file</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token string single-quoted-string">&#39;test.&#39;</span><span class="token operator">.</span><span class="token variable">$file</span><span class="token operator">-&gt;</span><span class="token function">guessExtension</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="randomname-uniquename" tabindex="-1"><a class="header-anchor" href="#randomname-uniquename" aria-hidden="true">#</a> randomName (uniqueName)</h3><p>Using randomly generated filenames (md5(uniqid()).extension)</p><div class="language-php line-numbers-mode" data-ext="php"><pre class="language-php"><code><span class="token variable">$form</span><span class="token operator">-&gt;</span><span class="token function">image</span><span class="token punctuation">(</span><span class="token string single-quoted-string">&#39;picture&#39;</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">uniqueName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="disable-page-delete-files-replace-upload" tabindex="-1"><a class="header-anchor" href="#disable-page-delete-files-replace-upload" aria-hidden="true">#</a> Disable page delete files (replace upload)</h3><p>The <code>removable</code> method allows you to prevent users from deleting files on the server by clicking on them on the page, and allows you to achieve an image overlay upload effect.</p><div class="language-php line-numbers-mode" data-ext="php"><pre class="language-php"><code><span class="token variable">$form</span><span class="token operator">-&gt;</span><span class="token function">file</span><span class="token punctuation">(</span><span class="token variable">$column</span><span class="token punctuation">[</span><span class="token punctuation">,</span> <span class="token variable">$label</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">removable</span><span class="token punctuation">(</span><span class="token constant boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="autoupload" tabindex="-1"><a class="header-anchor" href="#autoupload" aria-hidden="true">#</a> AutoUpload</h3><p>When this function is enabled, the file will be uploaded automatically immediately after selection, and the page will no longer show the <code>Upload</code> button.</p><div class="language-php line-numbers-mode" data-ext="php"><pre class="language-php"><code><span class="token variable">$form</span><span class="token operator">-&gt;</span><span class="token function">file</span><span class="token punctuation">(</span><span class="token string single-quoted-string">&#39;file&#39;</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">autoUpload</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token variable">$form</span><span class="token operator">-&gt;</span><span class="token function">image</span><span class="token punctuation">(</span><span class="token string single-quoted-string">&#39;img&#39;</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">autoUpload</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="disable-removal-recallable" tabindex="-1"><a class="header-anchor" href="#disable-removal-recallable" aria-hidden="true">#</a> Disable removal (recallable)</h3><p>Files will not be deleted from the server after this feature is enabled.</p><div class="language-php line-numbers-mode" data-ext="php"><pre class="language-php"><code><span class="token variable">$form</span><span class="token operator">-&gt;</span><span class="token function">file</span><span class="token punctuation">(</span><span class="token string single-quoted-string">&#39;file&#39;</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">retainable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token variable">$form</span><span class="token operator">-&gt;</span><span class="token function">image</span><span class="token punctuation">(</span><span class="token string single-quoted-string">&#39;img&#39;</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">retainable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="storagepermission" tabindex="-1"><a class="header-anchor" href="#storagepermission" aria-hidden="true">#</a> storagePermission</h3><p>Setting Permissions for Uploading Files</p><div class="language-php line-numbers-mode" data-ext="php"><pre class="language-php"><code><span class="token variable">$form</span><span class="token operator">-&gt;</span><span class="token function">image</span><span class="token punctuation">(</span><span class="token string single-quoted-string">&#39;picture&#39;</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">storagePermission</span><span class="token punctuation">(</span><span class="token number">777</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="restrict-file-upload-types" tabindex="-1"><a class="header-anchor" href="#restrict-file-upload-types" aria-hidden="true">#</a> Restrict file upload types</h3><p>Restrict the types of files to be uploaded</p><div class="language-php line-numbers-mode" data-ext="php"><pre class="language-php"><code><span class="token variable">$form</span><span class="token operator">-&gt;</span><span class="token function">file</span><span class="token punctuation">(</span><span class="token string single-quoted-string">&#39;file&#39;</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">accept</span><span class="token punctuation">(</span><span class="token string single-quoted-string">&#39;jpg,png,gif,jpeg&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// can specify mimeTypes, multiple comma-separated</span>
<span class="token variable">$form</span><span class="token operator">-&gt;</span><span class="token function">file</span><span class="token punctuation">(</span><span class="token string single-quoted-string">&#39;file&#39;</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">accept</span><span class="token punctuation">(</span><span class="token string single-quoted-string">&#39;jpg,png,gif,jpeg&#39;</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">&#39;image/*&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="disablechunked" tabindex="-1"><a class="header-anchor" href="#disablechunked" aria-hidden="true">#</a> disableChunked</h3><p>Enable chunked Upload</p><div class="language-php line-numbers-mode" data-ext="php"><pre class="language-php"><code><span class="token variable">$form</span><span class="token operator">-&gt;</span><span class="token function">file</span><span class="token punctuation">(</span><span class="token string single-quoted-string">&#39;file&#39;</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">chunked</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="chunksize" tabindex="-1"><a class="header-anchor" href="#chunksize" aria-hidden="true">#</a> chunkSize</h3><p>Set the block size in <code>KB</code>, default <code>5MB</code>.</p><blockquote><p>{tip} Calling this method will automatically enable block uploads.</p></blockquote><div class="language-php line-numbers-mode" data-ext="php"><pre class="language-php"><code><span class="token comment">// Set to 1MB</span>
<span class="token variable">$form</span><span class="token operator">-&gt;</span><span class="token function">file</span><span class="token punctuation">(</span><span class="token string single-quoted-string">&#39;file&#39;</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">chunkSize</span><span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="file-size-maxsize" tabindex="-1"><a class="header-anchor" href="#file-size-maxsize" aria-hidden="true">#</a> File size(maxSize)</h3><p>Set the maximum size of a single file in <code>Kb</code>, the default size is <code>10M</code>.</p><blockquote><p>{tip} Also make sure that the <code>upload_max_filesize</code> parameter in the <code>php.ini</code> configuration file must be greater than the value set by this method.</p></blockquote><div class="language-php line-numbers-mode" data-ext="php"><pre class="language-php"><code><span class="token comment">// Set the maximum size of a single file to 1Mb</span>
<span class="token variable">$form</span><span class="token operator">-&gt;</span><span class="token function">file</span><span class="token punctuation">(</span><span class="token string single-quoted-string">&#39;file&#39;</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">maxSize</span><span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="number-of-concurrent-upload-threads-threads" tabindex="-1"><a class="header-anchor" href="#number-of-concurrent-upload-threads-threads" aria-hidden="true">#</a> Number of concurrent upload threads (threads)</h3><p>Set the number of concurrent upload threads, default <code>3</code></p><div class="language-php line-numbers-mode" data-ext="php"><pre class="language-php"><code><span class="token variable">$form</span><span class="token operator">-&gt;</span><span class="token function">file</span><span class="token punctuation">(</span><span class="token string single-quoted-string">&#39;file&#39;</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">threads</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="custom-upload-interface-url" tabindex="-1"><a class="header-anchor" href="#custom-upload-interface-url" aria-hidden="true">#</a> Custom upload interface (url)</h3><p>Custom upload interfaces can be set via <code>url</code>.</p><div class="language-php line-numbers-mode" data-ext="php"><pre class="language-php"><code><span class="token variable">$form</span><span class="token operator">-&gt;</span><span class="token function">file</span><span class="token punctuation">(</span><span class="token string single-quoted-string">&#39;file&#39;</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">url</span><span class="token punctuation">(</span><span class="token string single-quoted-string">&#39;users/files&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>A <code>trait</code>, <code>Dcat\\Admin\\Traits\\HasUploadedFile</code>, is provided to help developers handle uploaded files more easily, as follows</p><div class="language-php line-numbers-mode" data-ext="php"><pre class="language-php"><code><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>

<span class="token keyword">namespace</span> <span class="token package">App<span class="token punctuation">\\</span>Admin<span class="token punctuation">\\</span>Controllers</span><span class="token punctuation">;</span>

<span class="token keyword">use</span> <span class="token package">Dcat<span class="token punctuation">\\</span>Admin<span class="token punctuation">\\</span>Traits<span class="token punctuation">\\</span>HasUploadedFile</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name-definition class-name">FileController</span>
<span class="token punctuation">{</span>
    <span class="token keyword">use</span> <span class="token package">HasUploadedFile</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">handle</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token variable">$disk</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token function">disk</span><span class="token punctuation">(</span><span class="token string single-quoted-string">&#39;local&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        
        <span class="token comment">// Determine if it is a file deletion request</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token function">isDeleteRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// Delete files and respond</span>
            <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token function">deleteFileAndResponse</span><span class="token punctuation">(</span><span class="token variable">$disk</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        
        <span class="token comment">// Get uploaded files</span>
        <span class="token variable">$file</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token function">file</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// Get the name of the uploaded field</span>
        <span class="token variable">$column</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token function">uploader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token property">upload_column</span><span class="token punctuation">;</span>

        <span class="token variable">$dir</span> <span class="token operator">=</span> <span class="token string single-quoted-string">&#39;my-images&#39;</span><span class="token punctuation">;</span>
        <span class="token variable">$newName</span> <span class="token operator">=</span> <span class="token variable">$column</span><span class="token operator">.</span><span class="token string single-quoted-string">&#39;-MyFileName.&#39;</span><span class="token operator">.</span><span class="token variable">$file</span><span class="token operator">-&gt;</span><span class="token function">getClientOriginalExtension</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token variable">$result</span> <span class="token operator">=</span> <span class="token variable">$disk</span><span class="token operator">-&gt;</span><span class="token function">putFileAs</span><span class="token punctuation">(</span><span class="token variable">$dir</span><span class="token punctuation">,</span> <span class="token variable">$file</span><span class="token punctuation">,</span> <span class="token variable">$newName</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token variable">$path</span> <span class="token operator">=</span> <span class="token string double-quoted-string">&quot;<span class="token interpolation"><span class="token punctuation">{</span><span class="token variable">$dir</span><span class="token punctuation">}</span></span>/<span class="token interpolation"><span class="token variable">$newName</span></span>&quot;</span><span class="token punctuation">;</span>

        <span class="token keyword">return</span> <span class="token variable">$result</span>
            <span class="token operator">?</span> <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token function">responseUploaded</span><span class="token punctuation">(</span><span class="token variable">$path</span><span class="token punctuation">,</span> <span class="token variable">$disk</span><span class="token operator">-&gt;</span><span class="token function">url</span><span class="token punctuation">(</span><span class="token variable">$path</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">:</span> <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token function">responseErrorMessage</span><span class="token punctuation">(</span><span class="token string single-quoted-string">&#39;File upload failed&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>To your routing file <code>app\\Admin\\routes.php</code> add the following</p><div class="language-php line-numbers-mode" data-ext="php"><pre class="language-php"><code><span class="token variable">$router</span><span class="token operator">-&gt;</span><span class="token function">any</span><span class="token punctuation">(</span><span class="token string single-quoted-string">&#39;users/files&#39;</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">&#39;FileController@handle&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="deleteurl" tabindex="-1"><a class="header-anchor" href="#deleteurl" aria-hidden="true">#</a> deleteUrl</h3><p>Modify and delete the path of uploaded files, this method generally does not need to be modified</p><div class="language-php line-numbers-mode" data-ext="php"><pre class="language-php"><code><span class="token variable">$form</span><span class="token operator">-&gt;</span><span class="token function">file</span><span class="token punctuation">(</span><span class="token string single-quoted-string">&#39;file&#39;</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">deleteUrl</span><span class="token punctuation">(</span><span class="token string single-quoted-string">&#39;file/delete&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="autosave-field-values-autosave" tabindex="-1"><a class="header-anchor" href="#autosave-field-values-autosave" aria-hidden="true">#</a> AutoSave field values (autoSave)</h3><p>Set whether to automatically save the file path to the database after uploading a file, this method is enabled by default.</p><div class="language-php line-numbers-mode" data-ext="php"><pre class="language-php"><code><span class="token variable">$form</span><span class="token operator">-&gt;</span><span class="token function">file</span><span class="token punctuation">(</span><span class="token string single-quoted-string">&#39;file&#39;</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">autoSave</span><span class="token punctuation">(</span><span class="token constant boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="configure-options" tabindex="-1"><a class="header-anchor" href="#configure-options" aria-hidden="true">#</a> Configure (options)</h3>`,66),b={href:"https://fex.baidu.com/webuploader/document.html",target:"_blank",rel:"noopener noreferrer"},f=t(`<div class="language-php line-numbers-mode" data-ext="php"><pre class="language-php"><code><span class="token variable">$form</span><span class="token operator">-&gt;</span><span class="token function">file</span><span class="token punctuation">(</span><span class="token string single-quoted-string">&#39;file&#39;</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">options</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&#39;disableGlobalDnd&#39;</span> <span class="token operator">=&gt;</span> <span class="token constant boolean">true</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="sortable-sortable" tabindex="-1"><a class="header-anchor" href="#sortable-sortable" aria-hidden="true">#</a> Sortable (sortable)</h3><p>This method is only available for multiple image/file upload forms.</p><div class="language-php line-numbers-mode" data-ext="php"><pre class="language-php"><code><span class="token variable">$form</span><span class="token operator">-&gt;</span><span class="token function">multipleImage</span><span class="token punctuation">(</span><span class="token string single-quoted-string">&#39;images&#39;</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">sortable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="compress-pictures-compress" tabindex="-1"><a class="header-anchor" href="#compress-pictures-compress" aria-hidden="true">#</a> Compress pictures (compress)</h3><p>Not enabled by default</p><div class="language-php line-numbers-mode" data-ext="php"><pre class="language-php"><code><span class="token comment">// Enable image compression.</span>

<span class="token variable">$form</span><span class="token operator">-&gt;</span><span class="token function">multipleImage</span><span class="token punctuation">(</span><span class="token string single-quoted-string">&#39;images&#39;</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">compress</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token variable">$form</span><span class="token operator">-&gt;</span><span class="token function">image</span><span class="token punctuation">(</span><span class="token string single-quoted-string">&#39;avatar&#39;</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">compress</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
	<span class="token string single-quoted-string">&#39;width&#39;</span> <span class="token operator">=&gt;</span> <span class="token number">1600</span><span class="token punctuation">,</span>
	<span class="token string single-quoted-string">&#39;height&#39;</span> <span class="token operator">=&gt;</span> <span class="token number">1600</span><span class="token punctuation">,</span>

	<span class="token comment">// Image quality, only valid if type is \`image/jpeg\`.</span>
	<span class="token string single-quoted-string">&#39;quality&#39;</span> <span class="token operator">=&gt;</span> <span class="token number">90</span><span class="token punctuation">,</span>

	<span class="token comment">// This option should be set to false if you want to generate small images without distortion.</span>
	<span class="token string single-quoted-string">&#39;allowMagnify&#39;</span> <span class="token operator">=&gt;</span> <span class="token constant boolean">false</span><span class="token punctuation">,</span>

	<span class="token comment">// Whether cropping is allowed.</span>
	<span class="token string single-quoted-string">&#39;crop&#39;</span> <span class="token operator">=&gt;</span> <span class="token constant boolean">false</span><span class="token punctuation">,</span>

	<span class="token comment">// Whether to keep the header meta information.</span>
	<span class="token string single-quoted-string">&#39;preserveHeaders&#39;</span> <span class="token operator">=&gt;</span> <span class="token constant boolean">true</span><span class="token punctuation">,</span>

	<span class="token comment">// If you find that the compressed file size is even larger than the original, use the original image.</span>
	<span class="token comment">// This property may affect the image auto-correct function.</span>
	<span class="token string single-quoted-string">&#39;noCompressIfLarger&#39;</span> <span class="token operator">=&gt;</span> <span class="token constant boolean">false</span><span class="token punctuation">,</span>

	<span class="token comment">// Unit byte, if the image size is smaller than this value, compression will not be applied.</span>
	<span class="token string single-quoted-string">&#39;compressSize&#39;</span> <span class="token operator">=&gt;</span> <span class="token number">0</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="listening-to-webuploader-file-upload-events-on" tabindex="-1"><a class="header-anchor" href="#listening-to-webuploader-file-upload-events-on" aria-hidden="true">#</a> Listening to WebUploader file upload events (on)</h3>`,8),y=s("code",null,"on",-1),q={href:"http://fex.baidu.com/webuploader/doc/index.html#WebUploader_Uploader_events",target:"_blank",rel:"noopener noreferrer"},w=t(`<div class="language-php line-numbers-mode" data-ext="php"><pre class="language-php"><code><span class="token variable">$form</span><span class="token operator">-&gt;</span><span class="token function">file</span><span class="token punctuation">(</span><span class="token string single-quoted-string">&#39;...&#39;</span><span class="token punctuation">)</span>
	<span class="token operator">-&gt;</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string single-quoted-string">&#39;startUpload&#39;</span><span class="token punctuation">,</span> <span class="token operator">&lt;&lt;</span><span class="token operator">&lt;</span><span class="token constant">JS</span>
		<span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			console<span class="token operator">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string single-quoted-string">&#39;File upload started...&#39;</span><span class="token punctuation">,</span> this<span class="token punctuation">)</span><span class="token punctuation">;</span>
			
			<span class="token comment">// Attach custom parameters to the file upload interface before uploading files</span>
			this<span class="token operator">.</span>uploader<span class="token operator">.</span>options<span class="token operator">.</span>formData<span class="token punctuation">[</span><span class="token string single-quoted-string">&#39;custom_field&#39;</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string single-quoted-string">&#39;...&#39;</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
<span class="token operator">&lt;&lt;</span><span class="token operator">&lt;</span><span class="token constant">JS</span>
    <span class="token punctuation">)</span>
	<span class="token operator">-&gt;</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string single-quoted-string">&#39;uploadFinished&#39;</span><span class="token punctuation">,</span> <span class="token operator">&lt;&lt;</span><span class="token operator">&lt;</span><span class="token constant">JS</span>
    	<span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    		console<span class="token operator">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string single-quoted-string">&#39;File upload is complete&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    	<span class="token punctuation">}</span>
<span class="token operator">&lt;&lt;</span><span class="token operator">&lt;</span><span class="token constant">JS</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="file-image-domain-splicing" tabindex="-1"><a class="header-anchor" href="#file-image-domain-splicing" aria-hidden="true">#</a> File/image domain splicing</h3><p>Please do not set the <strong>accessor</strong> and <strong>mutator</strong> to splice the domain name in the model. If you need to splice the full domain name at the time of access, you can define a <code>public</code> method in the model.</p><div class="language-php line-numbers-mode" data-ext="php"><pre class="language-php"><code><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>

<span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\\</span>Support<span class="token punctuation">\\</span>Str</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\\</span>Support<span class="token punctuation">\\</span>Facades<span class="token punctuation">\\</span>Storage</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name-definition class-name">YourModel</span> <span class="token keyword">extends</span> <span class="token class-name">Model</span>
<span class="token punctuation">{</span>
    <span class="token comment">// Define a public method to access an image or file</span>
	<span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">getImage</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name static-context">Str</span><span class="token operator">::</span><span class="token function">contains</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">image</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">&#39;//&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		    <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">image</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		
		<span class="token keyword">return</span> <span class="token class-name static-context">Storage</span><span class="token operator">::</span><span class="token function">disk</span><span class="token punctuation">(</span><span class="token string single-quoted-string">&#39;admin&#39;</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">url</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">image</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="save-the-domain-name" tabindex="-1"><a class="header-anchor" href="#save-the-domain-name" aria-hidden="true">#</a> Save the domain name</h3><p>If you need to save a file domain name to a datasheet, you can use the <code>saveFullUrl</code> method.</p><div class="language-php line-numbers-mode" data-ext="php"><pre class="language-php"><code><span class="token variable">$form</span><span class="token operator">-&gt;</span><span class="token function">image</span><span class="token punctuation">(</span><span class="token string single-quoted-string">&#39;avatar&#39;</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">saveFullUrl</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token variable">$form</span><span class="token operator">-&gt;</span><span class="token function">file</span><span class="token punctuation">(</span><span class="token string single-quoted-string">&#39;...&#39;</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">saveFullUrl</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="listening-for-file-upload-changes-change" tabindex="-1"><a class="header-anchor" href="#listening-for-file-upload-changes-change" aria-hidden="true">#</a> Listening for file upload changes (change)</h3><p>You can listen for changes when a file <strong>is uploaded successfully</strong> or when a file <strong>is deleted</strong> by using the following methods</p><div class="language-php line-numbers-mode" data-ext="php"><pre class="language-php"><code><span class="token variable">$file</span> <span class="token operator">=</span> <span class="token variable">$form</span><span class="token operator">-&gt;</span><span class="token function">file</span><span class="token punctuation">(</span><span class="token string single-quoted-string">&#39;...&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token class-name static-context">Admin</span><span class="token operator">::</span><span class="token function">script</span><span class="token punctuation">(</span>
	<span class="token operator">&lt;&lt;</span><span class="token operator">&lt;</span><span class="token class-name type-declaration">JS</span>
$<span class="token punctuation">(</span><span class="token string single-quoted-string">&#39;{$file-&gt;getElementClassSelector()} .file-input&#39;</span><span class="token punctuation">)</span><span class="token operator">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string single-quoted-string">&#39;change&#39;</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	console<span class="token operator">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string single-quoted-string">&#39;File changed&#39;</span><span class="token punctuation">,</span> this<span class="token operator">.</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token constant">JS</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="覆盖上传-override" tabindex="-1"><a class="header-anchor" href="#覆盖上传-override" aria-hidden="true">#</a> 覆盖上传 (override)</h3><p>The <code>override</code> method enables file override uploads.</p><div class="language-php line-numbers-mode" data-ext="php"><pre class="language-php"><code><span class="token variable">$form</span><span class="token operator">-&gt;</span><span class="token function">file</span><span class="token punctuation">(</span><span class="token string single-quoted-string">&#39;file&#39;</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">override</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token variable">$form</span><span class="token operator">-&gt;</span><span class="token function">image</span><span class="token punctuation">(</span><span class="token string single-quoted-string">&#39;img&#39;</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">override</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="picture-uploading-built-in-method" tabindex="-1"><a class="header-anchor" href="#picture-uploading-built-in-method" aria-hidden="true">#</a> Picture uploading built-in method</h2><h3 id="compressing-cropping-adding-watermarks-etc" tabindex="-1"><a class="header-anchor" href="#compressing-cropping-adding-watermarks-etc" aria-hidden="true">#</a> Compressing, cropping, adding watermarks, etc.</h3>`,15),$={href:"http://image.intervention.io/getting_started/installation",target:"_blank",rel:"noopener noreferrer"},x={href:"http://image.intervention.io/getting_started/introduction",target:"_blank",rel:"noopener noreferrer"},_=t(`<div class="language-php line-numbers-mode" data-ext="php"><pre class="language-php"><code><span class="token variable">$form</span><span class="token operator">-&gt;</span><span class="token function">image</span><span class="token punctuation">(</span><span class="token variable">$column</span><span class="token punctuation">[</span><span class="token punctuation">,</span> <span class="token variable">$label</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Modify image upload path and file name</span>
<span class="token variable">$form</span><span class="token operator">-&gt;</span><span class="token function">image</span><span class="token punctuation">(</span><span class="token variable">$column</span><span class="token punctuation">[</span><span class="token punctuation">,</span> <span class="token variable">$label</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">move</span><span class="token punctuation">(</span><span class="token variable">$dir</span><span class="token punctuation">,</span> <span class="token variable">$name</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Cropping pictures</span>
<span class="token variable">$form</span><span class="token operator">-&gt;</span><span class="token function">image</span><span class="token punctuation">(</span><span class="token variable">$column</span><span class="token punctuation">[</span><span class="token punctuation">,</span> <span class="token variable">$label</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">crop</span><span class="token punctuation">(</span><span class="token keyword type-hint">int</span> <span class="token variable">$width</span><span class="token punctuation">,</span> <span class="token keyword type-hint">int</span> <span class="token variable">$height</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token keyword type-declaration">int</span> <span class="token variable">$x</span><span class="token punctuation">,</span> <span class="token keyword type-hint">int</span> <span class="token variable">$y</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// add a watermark</span>
<span class="token variable">$form</span><span class="token operator">-&gt;</span><span class="token function">image</span><span class="token punctuation">(</span><span class="token variable">$column</span><span class="token punctuation">[</span><span class="token punctuation">,</span> <span class="token variable">$label</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">insert</span><span class="token punctuation">(</span><span class="token variable">$watermark</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">&#39;center&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="limit-the-size-of-uploaded-images" tabindex="-1"><a class="header-anchor" href="#limit-the-size-of-uploaded-images" aria-hidden="true">#</a> Limit the size of uploaded images</h3><p>Set file upload size limit</p><p>Parameters: <code>array</code> in pixels</p><ul><li><code>width</code> Specify the width</li><li><code>height</code> Specify the height</li><li><code>min_width</code> Minimum width</li><li><code>min_height</code> Minimum height</li><li><code>max_width</code> Maximum width</li><li><code>max_height</code> Maximum height</li><li><code>ratio</code> Aspect ratio (width/height)</li></ul><div class="language-php line-numbers-mode" data-ext="php"><pre class="language-php"><code><span class="token comment">// Upload an image between 100-300 pixels wide.</span>
<span class="token variable">$form</span><span class="token operator">-&gt;</span><span class="token function">image</span><span class="token punctuation">(</span><span class="token string single-quoted-string">&#39;img&#39;</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">dimensions</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&#39;min_width&#39;</span> <span class="token operator">=</span> <span class="token number">100</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">&#39;max_width&#39;</span> <span class="token operator">=&gt;</span> <span class="token number">300</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="save-image-file-paths-to-other-data-tables" tabindex="-1"><a class="header-anchor" href="#save-image-file-paths-to-other-data-tables" aria-hidden="true">#</a> Save image/file paths to other data tables</h2><p>The following method allows you to save the path of an image or file in a separate attachment table, while the current image/file field saves only the ID.</p><blockquote><p>{tip} The example here uses a single image upload form, so you can adjust it yourself if it&#39;s multiple images.</p></blockquote><p>Image/File Table Structure</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token identifier"><span class="token punctuation">\`</span>images<span class="token punctuation">\`</span></span> <span class="token punctuation">(</span>
  <span class="token identifier"><span class="token punctuation">\`</span>id<span class="token punctuation">\`</span></span> <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span> <span class="token keyword">unsigned</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">AUTO_INCREMENT</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">\`</span>path<span class="token punctuation">\`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">191</span><span class="token punctuation">)</span> <span class="token keyword">COLLATE</span> utf8mb4_unicode_ci <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">DEFAULT</span> <span class="token string">&#39;&#39;</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">\`</span>created_at<span class="token punctuation">\`</span></span> <span class="token keyword">timestamp</span> <span class="token boolean">NULL</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">\`</span>updated_at<span class="token punctuation">\`</span></span> <span class="token keyword">timestamp</span> <span class="token boolean">NULL</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">\`</span>id<span class="token punctuation">\`</span></span><span class="token punctuation">)</span>
<span class="token punctuation">)</span> <span class="token keyword">ENGINE</span><span class="token operator">=</span>MyISAM <span class="token keyword">AUTO_INCREMENT</span><span class="token operator">=</span><span class="token number">4</span> <span class="token keyword">DEFAULT</span> <span class="token keyword">CHARSET</span><span class="token operator">=</span>utf8mb4 <span class="token keyword">COLLATE</span><span class="token operator">=</span>utf8mb4_unicode_ci<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>use</p><div class="language-php line-numbers-mode" data-ext="php"><pre class="language-php"><code><span class="token variable">$form</span><span class="token operator">-&gt;</span><span class="token function">image</span><span class="token punctuation">(</span><span class="token string single-quoted-string">&#39;image1&#39;</span><span class="token punctuation">)</span>
    <span class="token operator">-&gt;</span><span class="token function">saving</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token variable">$value</span><span class="token punctuation">)</span> <span class="token keyword">use</span> <span class="token punctuation">(</span><span class="token variable">$form</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$form</span><span class="token operator">-&gt;</span><span class="token function">isEditing</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span> <span class="token variable">$value</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// Editing Pages, Deleting Image Logic</span>
            <span class="token class-name static-context">Image</span><span class="token operator">::</span><span class="token function">destroy</span><span class="token punctuation">(</span><span class="token variable">$form</span><span class="token operator">-&gt;</span><span class="token function">model</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token property">image1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token keyword">return</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token comment">// Add or edit images to a page</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$value</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token variable">$model</span> <span class="token operator">=</span> <span class="token class-name static-context">Image</span><span class="token operator">::</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token string single-quoted-string">&#39;path&#39;</span><span class="token punctuation">,</span> <span class="token variable">$value</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">first</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">empty</span><span class="token punctuation">(</span><span class="token variable">$model</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token variable">$model</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Image</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token variable">$model</span><span class="token operator">-&gt;</span><span class="token property">path</span> <span class="token operator">=</span> <span class="token variable">$value</span><span class="token punctuation">;</span>

        <span class="token variable">$model</span><span class="token operator">-&gt;</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">return</span> <span class="token variable">$model</span><span class="token operator">-&gt;</span><span class="token function">getKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token operator">-&gt;</span><span class="token function">customFormat</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token variable">$v</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span> <span class="token variable">$v</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">return</span> <span class="token class-name static-context">Image</span><span class="token operator">::</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword type-casting">array</span><span class="token punctuation">)</span> <span class="token variable">$v</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">pluck</span><span class="token punctuation">(</span><span class="token string single-quoted-string">&#39;path&#39;</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">toArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="file-upload-failed-or-inaccessible" tabindex="-1"><a class="header-anchor" href="#file-upload-failed-or-inaccessible" aria-hidden="true">#</a> File upload failed or inaccessible?</h2><p>If you find that you are unable to upload a file, then there are usually several reasons for this.</p>`,15),S=s("code",null,"Laravel",-1),U=s("code",null,"admin.upload.disk",-1),T=s("code",null,"laravel",-1),F={href:"https://learnku.com/docs/laravel/7.x/filesystem/7485",target:"_blank",rel:"noopener noreferrer"},L=s("li",null,[n("Files are too large, need to adjust "),s("code",null,"upload_max_filesize"),n(" parameter of "),s("code",null,"php.ini"),n(".")],-1),A=s("li",null,"File upload directory without write permissions",-1),z=s("li",null,[s("code",null,"php"),n(" is not installed or the "),s("code",null,"fileinfo"),n(" extension is not enabled")],-1),I=s("p",null,[n("If your file uploads success but can't be accessed properly, then the "),s("code",null,"APP_URL"),n(" parameter in the "),s("code",null,".env"),n(" configuration file may not be set correctly.")],-1);function E(N,C){const o=p("RouterLink"),e=p("ExternalLinkIcon");return l(),c("div",null,[d,s("p",null,[n("The "),a(o,{to:"/guide/model-form.html"},{default:u(()=>[n("data form")]),_:1}),n(" generates an image/file upload form with the following calls, supporting both local and cloud storage file uploads. The uploading component is based on "),s("a",k,[n("webuploader"),a(e)]),n(", please refer to the "),s("a",g,[n("webuploader official documentation"),a(e)]),n(" for specific configuration. .html)")]),m,s("p",null,[n("First install "),s("a",v,[n("zgldh/qiniu-laravel-storage"),a(e)])]),h,s("p",null,[n("customization configuration "),s("a",b,[n("webuploader"),a(e)])]),f,s("p",null,[n("The "),y,n(" method can listen for "),s("a",q,[n("WebUploader file upload-related events"),a(e)])]),w,s("p",null,[n("Compression, cropping, watermarking and other methods can be used, which requires installation "),s("a",$,[n("intervention/image"),a(e)]),n(".")]),s("p",null,[n("For more information on how to use it, please refer to ["),s("a",x,[n("Intervention"),a(e)]),n("]：")]),_,s("ol",null,[s("li",null,[S,n(" file upload is not configured correctly, check the "),U,n(" parameter. If you are not familiar with the "),T,n(" file upload feature, please read the documentation "),s("a",F,[n("Laravel - File Storage"),a(e)]),n(".")]),L,A,z]),I])}const P=i(r,[["render",E],["__file","model-form-upload.html.vue"]]);export{P as default};
