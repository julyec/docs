import{_ as n}from"./plugin-vue_export-helper-c27b6911.js";import{o as s,c as a,a as e}from"./app-98225aba.js";const t={},o=e(`<h1 id="permission-control" tabindex="-1"><a class="header-anchor" href="#permission-control" aria-hidden="true">#</a> Permission control</h1><p><code>Dcat Admin</code> has a built-in <code>RBAC</code> permission control module, expand <code>Auth</code> on the left sidebar, and below there are three management panels for users, roles, and permissions.</p><h3 id="routing-control" tabindex="-1"><a class="header-anchor" href="#routing-control" aria-hidden="true">#</a> Routing control</h3><p>In <code>Dcat Admin</code>, permissions and routes are bound together, set the routes that the current permissions can access in the edit permissions page, select the method to access the routes in the <code>HTTP method</code> select box, and fill in the path that can be accessed in the <code>HTTP path</code>.</p><p>For example, if you want to add a permission, which can access the path <code>/admin/users</code> by <code>GET</code>, then <code>HTTP method</code> select <code>GET</code>, and <code>HTTP path</code> fill in <code>/users</code>.</p><p>If you want to access all the paths prefixed with <code>/admin/users</code>, then <code>HTTP path</code> fill in <code>/users*</code>; if you want to access the edit page, then <code>HTTP path</code> fill in <code>/users/*/edit</code>; if the method of each path in multiple paths is different, then <code>HTTP path</code> fill in <code>GET:users/*&#39;. </code>.</p><p>If the above method is not sufficient, <code>HTTP path</code> also supports <strong>routing aliases</strong>, such as <code>admin.users.show</code>.</p><h3 id="disable-permissions-function" tabindex="-1"><a class="header-anchor" href="#disable-permissions-function" aria-hidden="true">#</a> Disable permissions function</h3><p>Setting the value of the <code>admin.permission.enable</code> configuration parameter to <code>false</code> completely disables the built-in permission system.</p><h3 id="super-administrator" tabindex="-1"><a class="header-anchor" href="#super-administrator" aria-hidden="true">#</a> Super Administrator</h3><p>The default role <code>administrator</code> in <code>Dcat Admin</code> is the super admin role, do not change the identity or it will become a normal role.</p><h3 id="skip-privilege-verification" tabindex="-1"><a class="header-anchor" href="#skip-privilege-verification" aria-hidden="true">#</a> Skip privilege verification</h3><p>Interfaces that require skipping permission validation can be added to the configuration file <code>admin.permission.except</code> parameter.</p><div class="language-php line-numbers-mode" data-ext="php"><pre class="language-php"><code>	<span class="token string single-quoted-string">&#39;permission&#39;</span> <span class="token operator">=&gt;</span> <span class="token punctuation">[</span>
		<span class="token comment">// Whether enable permission.</span>
		<span class="token string single-quoted-string">&#39;enable&#39;</span> <span class="token operator">=&gt;</span> <span class="token constant boolean">true</span><span class="token punctuation">,</span>

		<span class="token comment">// All method to path like: auth/users/*/edit</span>
		<span class="token comment">// or specific method to path like: get:auth/users.</span>
		<span class="token string single-quoted-string">&#39;except&#39;</span> <span class="token operator">=&gt;</span> <span class="token punctuation">[</span>
			<span class="token string single-quoted-string">&#39;/&#39;</span><span class="token punctuation">,</span>
			<span class="token string single-quoted-string">&#39;auth/login&#39;</span><span class="token punctuation">,</span>
			<span class="token string single-quoted-string">&#39;auth/logout&#39;</span><span class="token punctuation">,</span>
			<span class="token string single-quoted-string">&#39;auth/setting&#39;</span><span class="token punctuation">,</span>
		<span class="token punctuation">]</span><span class="token punctuation">,</span>

	<span class="token punctuation">]</span><span class="token punctuation">,</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="page-control" tabindex="-1"><a class="header-anchor" href="#page-control" aria-hidden="true">#</a> Page control</h3><p>If you want to control a user&#39;s permissions on a page, consider the following example</p><h4 id="scenario-1" tabindex="-1"><a class="header-anchor" href="#scenario-1" aria-hidden="true">#</a> Scenario 1</h4><p>For example, now there is a scenario to do permission management for the article publishing module to create articles</p><p>First of all, create a permission, enter <code>http://localhost/admin/auth/permissions</code>, permission identification (slug) fill <code>create-post</code>, permission name fill <code>create article</code>, so that the permission is created.</p><p>The second step can be this permission directly attached to the individual or role, in the user edit page can be created directly above the permission attached to the current editor of the user, or in the edit role page attached to a role.</p><p>The third step is to add the control code inside the create article controller:</p><div class="language-php line-numbers-mode" data-ext="php"><pre class="language-php"><code><span class="token keyword">use</span> <span class="token package">Dcat<span class="token punctuation">\\</span>Admin<span class="token punctuation">\\</span>Auth<span class="token punctuation">\\</span>Permission</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name-definition class-name">PostController</span> <span class="token keyword">extends</span> <span class="token class-name">Controller</span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token comment">// 检查权限，有create-post权限的用户或者角色可以访问创建文章页面</span>
        <span class="token class-name static-context">Permission</span><span class="token operator">::</span><span class="token function">check</span><span class="token punctuation">(</span><span class="token string single-quoted-string">&#39;create-post&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>This completes the permissions control of a page.</p><h4 id="scenario-2" tabindex="-1"><a class="header-anchor" href="#scenario-2" aria-hidden="true">#</a> Scenario 2</h4><p>If you want to control the user&#39;s display of an element in a table, you need to define two permissions, such as the permissions <code>delete-image</code> and <code>view-title-column</code>, which are used to control the permission to delete an image and the permission to display a column, respectively.：</p><div class="language-php line-numbers-mode" data-ext="php"><pre class="language-php"><code><span class="token variable">$grid</span><span class="token operator">-&gt;</span><span class="token function">actions</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token variable">$actions</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

    <span class="token comment">// Roles without \`delete-image\` permission do not show the delete button</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token class-name static-context">Admin</span><span class="token operator">::</span><span class="token function">user</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">can</span><span class="token punctuation">(</span><span class="token string single-quoted-string">&#39;delete-image&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token variable">$actions</span><span class="token operator">-&gt;</span><span class="token function">disableDelete</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Only users with the \`view-title-column\` permission can display the \`title\` column</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name static-context">Admin</span><span class="token operator">::</span><span class="token function">user</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">can</span><span class="token punctuation">(</span><span class="token string single-quoted-string">&#39;view-title-column&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token variable">$grid</span><span class="token operator">-&gt;</span><span class="token function">column</span><span class="token punctuation">(</span><span class="token string single-quoted-string">&#39;title&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="related-methods" tabindex="-1"><a class="header-anchor" href="#related-methods" aria-hidden="true">#</a> Related methods</h3><p>Get the current user object</p><div class="language-php line-numbers-mode" data-ext="php"><pre class="language-php"><code><span class="token class-name static-context">Admin</span><span class="token operator">::</span><span class="token function">user</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>Get current user id</p><div class="language-php line-numbers-mode" data-ext="php"><pre class="language-php"><code><span class="token class-name static-context">Admin</span><span class="token operator">::</span><span class="token function">user</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token property">id</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>Get user roles</p><div class="language-php line-numbers-mode" data-ext="php"><pre class="language-php"><code><span class="token class-name static-context">Admin</span><span class="token operator">::</span><span class="token function">user</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token property">roles</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>Get user permissions</p><div class="language-php line-numbers-mode" data-ext="php"><pre class="language-php"><code><span class="token class-name static-context">Admin</span><span class="token operator">::</span><span class="token function">user</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token property">permissions</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>Whether the user has a role</p><div class="language-php line-numbers-mode" data-ext="php"><pre class="language-php"><code><span class="token class-name static-context">Admin</span><span class="token operator">::</span><span class="token function">user</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">isRole</span><span class="token punctuation">(</span><span class="token string single-quoted-string">&#39;developer&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>Is there a certain permission</p><div class="language-php line-numbers-mode" data-ext="php"><pre class="language-php"><code><span class="token class-name static-context">Admin</span><span class="token operator">::</span><span class="token function">user</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">can</span><span class="token punctuation">(</span><span class="token string single-quoted-string">&#39;create-post&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>Is there no certain permission</p><div class="language-php line-numbers-mode" data-ext="php"><pre class="language-php"><code><span class="token class-name static-context">Admin</span><span class="token operator">::</span><span class="token function">user</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">cannot</span><span class="token punctuation">(</span><span class="token string single-quoted-string">&#39;delete-post&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>Are you a super administrator?</p><div class="language-php line-numbers-mode" data-ext="php"><pre class="language-php"><code><span class="token class-name static-context">Admin</span><span class="token operator">::</span><span class="token function">user</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">isAdministrator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>Is it one of the roles?</p><div class="language-php line-numbers-mode" data-ext="php"><pre class="language-php"><code><span class="token class-name static-context">Admin</span><span class="token operator">::</span><span class="token function">user</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">inRoles</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&#39;editor&#39;</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">&#39;developer&#39;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="privilege-middleware" tabindex="-1"><a class="header-anchor" href="#privilege-middleware" aria-hidden="true">#</a> Privilege Middleware</h3><p>Route configuration can be combined with permission middleware to control permissions on routes</p><div class="language-php line-numbers-mode" data-ext="php"><pre class="language-php"><code>
<span class="token comment">// Allow the administrator and editor roles to access routes in the group.</span>
<span class="token class-name static-context">Route</span><span class="token operator">::</span><span class="token function">group</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
    <span class="token string single-quoted-string">&#39;middleware&#39;</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">&#39;admin.permission:allow,administrator,editor&#39;</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token variable">$router</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

    <span class="token variable">$router</span><span class="token operator">-&gt;</span><span class="token function">resource</span><span class="token punctuation">(</span><span class="token string single-quoted-string">&#39;users&#39;</span><span class="token punctuation">,</span> <span class="token class-name static-context">UserController</span><span class="token operator">::</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token operator">...</span>
    
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Deny the roles of developer and operator access to the routes in the group.</span>
<span class="token class-name static-context">Route</span><span class="token operator">::</span><span class="token function">group</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
    <span class="token string single-quoted-string">&#39;middleware&#39;</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">&#39;admin.permission:deny,developer,operator&#39;</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token variable">$router</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

    <span class="token variable">$router</span><span class="token operator">-&gt;</span><span class="token function">resource</span><span class="token punctuation">(</span><span class="token string single-quoted-string">&#39;users&#39;</span><span class="token punctuation">,</span> <span class="token class-name static-context">UserController</span><span class="token operator">::</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token operator">...</span>
    
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Users with permission to edit-post, create-post, and delete-post can access the routes in the group</span>
<span class="token class-name static-context">Route</span><span class="token operator">::</span><span class="token function">group</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
    <span class="token string single-quoted-string">&#39;middleware&#39;</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">&#39;admin.permission:check,edit-post,create-post,delete-post&#39;</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token variable">$router</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

    <span class="token variable">$router</span><span class="token operator">-&gt;</span><span class="token function">resource</span><span class="token punctuation">(</span><span class="token string single-quoted-string">&#39;posts&#39;</span><span class="token punctuation">,</span> <span class="token class-name static-context">PostController</span><span class="token operator">::</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token operator">...</span>
    
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Permissions middleware is used in the same way as other middleware.</p><h3 id="why-does-it-still-say-no-access-even-though-i-have-configured-roles-and-permissions" tabindex="-1"><a class="header-anchor" href="#why-does-it-still-say-no-access-even-though-i-have-configured-roles-and-permissions" aria-hidden="true">#</a> Why does it still say no access even though I have configured roles and permissions?</h3><p>The reason for this may be due to a misconfiguration of the <code>URL</code> path of the privilege, the correct <code>URL</code> configuration that contains the add/drop check function should be something like <code>auth/users*</code>, if you configure it as <code>auth/users/*</code>, then it will indicate that there is no right to access.</p><blockquote><p>{tip} In addition, there are two ways to fill in the custom URL of the tag form: one is to select it and press <code>delete key</code> to change it; the other is to fill in the form and press <code>space bar</code> + <code>Enter key</code>.</p></blockquote>`,52),p=[o];function i(c,l){return s(),a("div",null,p)}const d=n(t,[["render",i],["__file","permission.html.vue"]]);export{d as default};
