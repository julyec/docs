<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
 <head>
  <meta http-equiv="content-type" content="text/html; CHARSET=UTF-8">
  <title>获取部分字符串</title>
<link media="all" rel="stylesheet" type="text/css" href="styles/03e73060321a0a848018724a6c83de7f-theme-base.css" />
<link media="all" rel="stylesheet" type="text/css" href="styles/03e73060321a0a848018724a6c83de7f-theme-medium.css" />

  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <link media="all" rel="stylesheet" type="text/css" href="style.css"/>
 </head>
 <body class="docs" class="docs"><div class="navbar navbar-fixed-top">
  <div class="navbar-inner clearfix">
    <ul class="nav" style="width: 100%">
      <li style="float: left;"><a href="function.mb-substr-count.html">? mb_substr_count</a></li>
      <li style="float: right;"><a href="book.pspell.html">Pspell ?</a></li>
    </ul>
  </div>
</div>
<div id="breadcrumbs" class="clearfix">
  <ul class="breadcrumbs-container">
    <li><a href="index.html">PHP Manual</a></li>
    <li><a href="ref.mbstring.html">多字节字符串 函数</a></li>
    <li>获取部分字符串</li>
  </ul>
</div>
<div id="layout">
  <div id="layout-content"><div id="function.mb-substr" class="refentry">
 <div class="refnamediv">
  <h1 class="refname">mb_substr</h1>
  <p class="verinfo">(PHP 4 &gt;= 4.0.6, PHP 5, PHP 7, PHP 8)</p><p class="refpurpose"><span class="refname">mb_substr</span> &mdash; <span class="dc-title">获取部分字符串</span></p>

 </div>
   
 <div class="refsect1 description" id="refsect1-function.mb-substr-description">
  <h3 class="title">说明</h3>
  <div class="methodsynopsis dc-description">
   <span class="methodname"><strong>mb_substr</strong></span>(<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="methodparam"><span class="type">string</span> <code class="parameter">$string</code></span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="methodparam"><span class="type">int</span> <code class="parameter">$start</code></span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="methodparam"><span class="type">?</span><span class="type"><span class="type">int</span><span class="type"></span></span> <code class="parameter">$length</code><span class="initializer"> = <strong><code>null</code></strong></span></span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="methodparam"><span class="type">?</span><span class="type"><span class="type">string</span><span class="type"></span></span> <code class="parameter">$encoding</code><span class="initializer"> = <strong><code>null</code></strong></span></span><br>): <span class="type">string</span></div>

  <p class="para rdfs-comment">
   根据字符数执行一个多字节安全的 <span class="function"><a href="function.substr.html" class="function">substr()</a></span> 操作。
   位置是从 <code class="parameter">string</code> 的开始位置进行计数。
   第一个字符的位置是 0。第二个字符的位置是 1，以此类推。 
  </p>
 </div>


 <div class="refsect1 parameters" id="refsect1-function.mb-substr-parameters">
  <h3 class="title">参数</h3>
  <p class="para">
   <dl>
    
     <dt>
<code class="parameter">string</code></dt>

     <dd>

      <p class="para">
       从该 <span class="type">string</span> 中提取子字符串。
      </p>
     </dd>

    
    
     <dt>
<code class="parameter">start</code></dt>

     <dd>

      <p class="para">
        如果 <code class="parameter">start</code> 不是负数，返回的字符串会从 <code class="parameter">string</code> 第 <code class="parameter">start</code> 的位置开始，从 0 开始计数。举个例子，字符串 &#039;<code class="literal">abcdef</code>&#039;，位置 <code class="literal">0</code> 的字符是 &#039;<code class="literal">a</code>&#039;，位置 <code class="literal">2</code> 的字符是
       &#039;<code class="literal">c</code>&#039;，以此类推。
      </p>
      <p class="para">
       如果 <code class="parameter">start</code> 是负数，返回的字符串是从 <code class="parameter">string</code> 末尾处第 <code class="parameter">start</code> 个字符开始的。
      </p>
     </dd>

    
    
     <dt>
<code class="parameter">length</code></dt>

     <dd>

      <p class="para">
       <code class="parameter">string</code> 中要使用的最大字符数。如果省略了此参数或者传入了 <code class="literal">NULL</code>，则会提取到字符串的尾部。
      </p>
     </dd>

    
    
     <dt>
<code class="parameter">encoding</code></dt>

     <dd>

      <p class="para"><code class="parameter">encoding</code>
参数为字符编码。如果省略或是 <strong><code>null</code></strong>，则使用内部字符编码。</p>
     </dd>

    
   </dl>

  </p>
 </div>


 <div class="refsect1 returnvalues" id="refsect1-function.mb-substr-returnvalues">
  <h3 class="title">返回值</h3>
  <p class="para">
   <span class="function"><strong>mb_substr()</strong></span> 函数根据 <code class="parameter">start</code> 和 <code class="parameter">length</code> 参数返回 <code class="parameter">string</code> 中指定的部分。
  </p>
 </div>

 
 <div class="refsect1 changelog" id="refsect1-function.mb-substr-changelog">
  <h3 class="title">更新日志</h3>
  <table class="doctable informaltable">
   
    <thead>
     <tr>
      <th>版本</th>
      <th>说明</th>
     </tr>

    </thead>

    <tbody class="tbody">
     <tr>
  <td>8.0.0</td>
  <td>
   现在 <code class="parameter">encoding</code> 可以为 null。
  </td>
 </tr>

    </tbody>
   
  </table>

 </div>


 <div class="refsect1 seealso" id="refsect1-function.mb-substr-seealso">
  <h3 class="title">参见</h3>
  <p class="para">
   <ul class="simplelist">
    <li class="member"><span class="function"><a href="function.mb-strcut.html" class="function" rel="rdfs-seeAlso">mb_strcut()</a> - 获取字符的一部分</span></li>
    <li class="member"><span class="function"><a href="function.mb-internal-encoding.html" class="function" rel="rdfs-seeAlso">mb_internal_encoding()</a> - 设置/获取内部字符编码</span></li>
   </ul>
  </p>
 </div>


</div><div id="usernotes">
 <div class="head">
  <h3 class="title">User Contributed Notes</h3>
 </div>
<div id="allnotes">  <a name="119517""></a>
  <div class="note">
   <strong class="user">qdinar at gmail dot com</strong>
   <a href="#119517" class="date">27-Jun-2016 04:06</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
you can make mb_substr working faster with long strings with usage of ucs-2 encoding.<br />
<br />
<span class="default">&lt;?php<br />
<br />
header</span><span class="keyword">(</span><span class="string">'Content-Type: text/html; CHARSET=gb2312'</span><span class="keyword">);<br />
echo </span><span class="string">'&lt;meta http-equiv="Content-Type" content="text/html; CHARSET=gb2312" &gt;'</span><span class="keyword">;<br />
<br />
function </span><span class="default">test</span><span class="keyword">(</span><span class="default">$string</span><span class="keyword">, </span><span class="default">$encoding</span><span class="keyword">=</span><span class="string">'utf8'</span><span class="keyword">){<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$t1</span><span class="keyword">=</span><span class="default">microtime</span><span class="keyword">(</span><span class="default">true</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$textlen</span><span class="keyword">=</span><span class="default">mb_strlen</span><span class="keyword">(</span><span class="default">$string</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$substr_len</span><span class="keyword">=</span><span class="default">3</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; for(</span><span class="default">$i</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">;</span><span class="default">$i</span><span class="keyword">&lt;</span><span class="default">$textlen</span><span class="keyword">-</span><span class="default">$substr_len</span><span class="keyword">+</span><span class="default">1</span><span class="keyword">;</span><span class="default">$i</span><span class="keyword">++){<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$substr</span><span class="keyword">=</span><span class="default">mb_substr</span><span class="keyword">(</span><span class="default">$string</span><span class="keyword">,</span><span class="default">$i</span><span class="keyword">,</span><span class="default">$substr_len</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; echo </span><span class="string">'mb_substr, '</span><span class="keyword">.</span><span class="default">$encoding</span><span class="keyword">.</span><span class="string">': '</span><span class="keyword">.(</span><span class="default">microtime</span><span class="keyword">(</span><span class="default">true</span><span class="keyword">)-</span><span class="default">$t1</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; echo </span><span class="string">' . check: '</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; if(</span><span class="default">$encoding</span><span class="keyword">==</span><span class="string">'ucs2'</span><span class="keyword">){<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$substr</span><span class="keyword">=</span><span class="default">mb_convert_encoding</span><span class="keyword">(</span><span class="default">$substr</span><span class="keyword">,</span><span class="string">'utf-8'</span><span class="keyword">,</span><span class="string">'ucs2'</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">var_dump</span><span class="keyword">( </span><span class="default">$substr </span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; echo </span><span class="string">' . &lt;br&gt;'</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; echo </span><span class="string">'&lt;br&gt;'</span><span class="keyword">;<br />
}<br />
<br />
</span><span class="default">$corpus_short</span><span class="keyword">=</span><span class="default">str_repeat</span><span class="keyword">(</span><span class="string">'тест Тест '</span><span class="keyword">,</span><span class="default">1000</span><span class="keyword">);<br />
</span><span class="comment">// it works likewise slowly with "test Test" with utf8<br />
</span><span class="default">mb_internal_encoding</span><span class="keyword">(</span><span class="string">'utf-8'</span><span class="keyword">);<br />
</span><span class="default">test</span><span class="keyword">(</span><span class="default">$corpus_short</span><span class="keyword">);<br />
<br />
</span><span class="default">$corpus_short_ucs2</span><span class="keyword">=</span><span class="default">mb_convert_encoding</span><span class="keyword">(</span><span class="default">$corpus_short</span><span class="keyword">,</span><span class="string">'ucs2'</span><span class="keyword">,</span><span class="string">'utf-8'</span><span class="keyword">);<br />
</span><span class="default">mb_internal_encoding</span><span class="keyword">(</span><span class="string">'ucs2'</span><span class="keyword">);<br />
</span><span class="default">test</span><span class="keyword">(</span><span class="default">$corpus_short_ucs2</span><span class="keyword">,</span><span class="string">'ucs2'</span><span class="keyword">);<br />
<br />
</span><span class="default">?&gt;<br />
</span><br />
output:<br />
<br />
mb_substr, utf8: 0.26480984687805 . check: string(5) "ст " .<br />
<br />
mb_substr, ucs2: 0.0048871040344238 . check: string(5) "ст " .</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="117764""></a>
  <div class="note">
   <strong class="user">qbolec at gmail dot com</strong>
   <a href="#117764" class="date">05-Aug-2015 03:10</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
As you often need to iterate over UTF-8 characters inside a string, you might be tempted to use mb_substr($text,$i,1).<br />
The problem with this is that there is no "magic" way to find $i-th character inside UTF-8 string, other than reading it byte by byte from the begining. Thus a loop which calls mb_substr($text,$i,1) N times for all possible N values of $i, will take much longer than expected. The larger the $i gets, the longer is the search for $i-th letter. As characters are between 1 to 6 bytes long, one can convince oneself, that the execution time of such loop is actually Theta(N^2), which can be really slow even for moderately long texts.<br />
One way to work around it is to first split your text into an array of letters using some smart preprocessing, and only then iterate over the array.<br />
Here is the idea:<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">class </span><span class="default">Strings<br />
</span><span class="keyword">{<br />
&nbsp; public static function </span><span class="default">len</span><span class="keyword">(</span><span class="default">$a</span><span class="keyword">){<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">mb_strlen</span><span class="keyword">(</span><span class="default">$a</span><span class="keyword">,</span><span class="string">'UTF-8'</span><span class="keyword">);<br />
&nbsp; }<br />
&nbsp; public static function </span><span class="default">charAt</span><span class="keyword">(</span><span class="default">$a</span><span class="keyword">,</span><span class="default">$i</span><span class="keyword">){<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">self</span><span class="keyword">::</span><span class="default">substr</span><span class="keyword">(</span><span class="default">$a</span><span class="keyword">,</span><span class="default">$i</span><span class="keyword">,</span><span class="default">1</span><span class="keyword">);<br />
&nbsp; }<br />
&nbsp; public static function </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$a</span><span class="keyword">,</span><span class="default">$x</span><span class="keyword">,</span><span class="default">$y</span><span class="keyword">=</span><span class="default">null</span><span class="keyword">){<br />
&nbsp;&nbsp;&nbsp; if(</span><span class="default">$y</span><span class="keyword">===</span><span class="default">NULL</span><span class="keyword">){<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">$y</span><span class="keyword">=</span><span class="default">self</span><span class="keyword">::</span><span class="default">len</span><span class="keyword">(</span><span class="default">$a</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">mb_substr</span><span class="keyword">(</span><span class="default">$a</span><span class="keyword">,</span><span class="default">$x</span><span class="keyword">,</span><span class="default">$y</span><span class="keyword">,</span><span class="string">'UTF-8'</span><span class="keyword">);<br />
&nbsp; }<br />
&nbsp; public static function </span><span class="default">letters</span><span class="keyword">(</span><span class="default">$a</span><span class="keyword">){<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$len </span><span class="keyword">= </span><span class="default">self</span><span class="keyword">::</span><span class="default">len</span><span class="keyword">(</span><span class="default">$a</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; if(</span><span class="default">$len</span><span class="keyword">==</span><span class="default">0</span><span class="keyword">){<br />
&nbsp;&nbsp; &nbsp;&nbsp; return array();<br />
&nbsp;&nbsp;&nbsp; }else if(</span><span class="default">$len </span><span class="keyword">== </span><span class="default">1</span><span class="keyword">){<br />
&nbsp;&nbsp; &nbsp;&nbsp; return array(</span><span class="default">$a</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }else{<br />
&nbsp;&nbsp; &nbsp;&nbsp; return </span><span class="default">Arrays</span><span class="keyword">::</span><span class="default">concat</span><span class="keyword">(<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">self</span><span class="keyword">::</span><span class="default">letters</span><span class="keyword">(</span><span class="default">self</span><span class="keyword">::</span><span class="default">substr</span><span class="keyword">(</span><span class="default">$a</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">$len</span><span class="keyword">&gt;&gt;</span><span class="default">1</span><span class="keyword">)),<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">self</span><span class="keyword">::</span><span class="default">letters</span><span class="keyword">(</span><span class="default">self</span><span class="keyword">::</span><span class="default">substr</span><span class="keyword">(</span><span class="default">$a</span><span class="keyword">,</span><span class="default">$len</span><span class="keyword">&gt;&gt;</span><span class="default">1</span><span class="keyword">))<br />
&nbsp;&nbsp; &nbsp;&nbsp; );<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp; }<br />
</span><span class="default">?&gt;<br />
</span>As you can see, the Strings::letters($text) split the text recursively into two parts. Each level of the recursion requires time linear in the length of the string, and there is logarithmic number of levels, so the total runtime is O(N log N), which is still more than theoretically optimal O(N), but sadly this is the best idea I've got.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="113329""></a>
  <div class="note">
   <strong class="user">sanjuro at 1up-games dot com</strong>
   <a href="#113329" class="date">27-Sep-2013 06:18</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
A serious pitfall when using mb_substr() set to HTML-ENTITIES encoding is that the function performs a number of conversions before returning the value, the worst one being that html special characters are not just counted but decoded.<br />
<br />
<span class="default">&lt;?php<br />
<br />
mb_internal_encoding</span><span class="keyword">(</span><span class="string">"ISO-8859-1"</span><span class="keyword">); echo </span><span class="default">mb_internal_encoding</span><span class="keyword">(),</span><span class="string">"\n&lt;br&gt;&lt;br&gt;\n"</span><span class="keyword">;<br />
<br />
</span><span class="default">$a</span><span class="keyword">=</span><span class="string">'j&amp;uuml;st &amp;#228; &amp;quot; simple &amp;quot; &amp;#26085;&amp;#26412; &amp;lt;b&amp;gt;test&amp;lt;/b&amp;gt;'</span><span class="keyword">;<br />
<br />
echo </span><span class="default">mb_substr</span><span class="keyword">(</span><span class="default">$a</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">),</span><span class="string">"\n&lt;br&gt;&lt;br&gt;\n"</span><span class="keyword">;<br />
</span><span class="comment">// page source: j&amp;uuml;st &amp;#228; &amp;quot; simple &amp;quot; &amp;#26085;&amp;#26412; &amp;lt;b&amp;gt;test&amp;lt;/b&amp;gt;<br />
<br />
</span><span class="keyword">echo </span><span class="default">mb_substr</span><span class="keyword">(</span><span class="default">$a</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$a</span><span class="keyword">),</span><span class="string">'HTML-ENTITIES'</span><span class="keyword">);<br />
</span><span class="comment">// page source: j&amp;uuml;st &amp;auml; " simple " &amp;#26085;&amp;#26412; &lt;b&gt;test&lt;/b&gt;<br />
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="112070""></a>
  <div class="note">
   <strong class="user">desmatic at gmail dot com</strong>
   <a href="#112070" class="date">29-Apr-2013 03:51</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
quick and dirty loop through multibyte string<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">function </span><span class="default">get_character_classes</span><span class="keyword">(</span><span class="default">$string</span><span class="keyword">, </span><span class="default">$encoding </span><span class="keyword">= </span><span class="string">"UTF-8"</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$current_encoding </span><span class="keyword">= </span><span class="default">mb_internal_encoding</span><span class="keyword">();<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">mb_internal_encoding</span><span class="keyword">(</span><span class="default">$encoding</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$has </span><span class="keyword">= array();<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$stringlength </span><span class="keyword">= </span><span class="default">mb_strlen</span><span class="keyword">(</span><span class="default">$string</span><span class="keyword">, </span><span class="default">$encoding</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; for (</span><span class="default">$i</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">; </span><span class="default">$i </span><span class="keyword">&lt; </span><span class="default">$stringlength</span><span class="keyword">; </span><span class="default">$i</span><span class="keyword">++) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$c </span><span class="keyword">= </span><span class="default">mb_substr</span><span class="keyword">(</span><span class="default">$string</span><span class="keyword">, </span><span class="default">$i</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if ((</span><span class="default">$c </span><span class="keyword">&gt;= </span><span class="string">"0"</span><span class="keyword">) &amp;&amp; (</span><span class="default">$c </span><span class="keyword">&lt;= </span><span class="string">"9"</span><span class="keyword">)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$has</span><span class="keyword">[</span><span class="string">'numeric'</span><span class="keyword">] = </span><span class="string">"numeric"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; } else if ((</span><span class="default">$c </span><span class="keyword">&gt;= </span><span class="string">"a"</span><span class="keyword">) &amp;&amp; (</span><span class="default">$c </span><span class="keyword">&lt;= </span><span class="string">"z"</span><span class="keyword">)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$has</span><span class="keyword">[</span><span class="string">'alpha'</span><span class="keyword">] = </span><span class="string">"alpha"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$has</span><span class="keyword">[</span><span class="string">'alphalower'</span><span class="keyword">] = </span><span class="string">'alphalower'</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; } else if ((</span><span class="default">$c </span><span class="keyword">&gt;= </span><span class="string">"A"</span><span class="keyword">) &amp;&amp; (</span><span class="default">$c </span><span class="keyword">&lt;= </span><span class="string">"Z"</span><span class="keyword">)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$has</span><span class="keyword">[</span><span class="string">'alpha'</span><span class="keyword">] = </span><span class="string">"alpha"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$has</span><span class="keyword">[</span><span class="string">'alphaupper'</span><span class="keyword">] = </span><span class="string">"alphaupper"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; } else if ((</span><span class="default">$c </span><span class="keyword">== </span><span class="string">"$"</span><span class="keyword">) || (</span><span class="default">$c </span><span class="keyword">== </span><span class="string">"￡"</span><span class="keyword">)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$has</span><span class="keyword">[</span><span class="string">'currency'</span><span class="keyword">] = </span><span class="string">"currency"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; } else if ((</span><span class="default">$c </span><span class="keyword">== </span><span class="string">"."</span><span class="keyword">) &amp;&amp; (</span><span class="default">$has</span><span class="keyword">[</span><span class="string">'decimal'</span><span class="keyword">])) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$has</span><span class="keyword">[</span><span class="string">'decimals'</span><span class="keyword">] = </span><span class="string">"decimals"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; } else if (</span><span class="default">$c </span><span class="keyword">== </span><span class="string">"."</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$has</span><span class="keyword">[</span><span class="string">'decimal'</span><span class="keyword">] = </span><span class="string">"decimal"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; } else if (</span><span class="default">$c </span><span class="keyword">== </span><span class="string">","</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$has</span><span class="keyword">[</span><span class="string">'comma'</span><span class="keyword">] = </span><span class="string">"comma"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; } else if (</span><span class="default">$c </span><span class="keyword">== </span><span class="string">"-"</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$has</span><span class="keyword">[</span><span class="string">'dash'</span><span class="keyword">] = </span><span class="string">"dash"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; } else if (</span><span class="default">$c </span><span class="keyword">== </span><span class="string">" "</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$has</span><span class="keyword">[</span><span class="string">'space'</span><span class="keyword">] = </span><span class="string">"space"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; } else if (</span><span class="default">$c </span><span class="keyword">== </span><span class="string">"/"</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$has</span><span class="keyword">[</span><span class="string">'slash'</span><span class="keyword">] = </span><span class="string">"slash"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; } else if (</span><span class="default">$c </span><span class="keyword">== </span><span class="string">":"</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$has</span><span class="keyword">[</span><span class="string">'colon'</span><span class="keyword">] = </span><span class="string">"colon"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; } else if ((</span><span class="default">$c </span><span class="keyword">&gt;= </span><span class="string">" "</span><span class="keyword">) &amp;&amp; (</span><span class="default">$c </span><span class="keyword">&lt;= </span><span class="string">"~"</span><span class="keyword">)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$has</span><span class="keyword">[</span><span class="string">'ascii'</span><span class="keyword">] = </span><span class="string">"ascii"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; } else {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$has</span><span class="keyword">[</span><span class="string">'binary'</span><span class="keyword">] = </span><span class="string">"binary"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">mb_internal_encoding</span><span class="keyword">(</span><span class="default">$current_encoding</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">$has</span><span class="keyword">;<br />
}<br />
<br />
</span><span class="default">$string </span><span class="keyword">= </span><span class="string">"1234asdfA￡^_{}|}~????"</span><span class="keyword">;<br />
echo </span><span class="default">print_r</span><span class="keyword">(</span><span class="default">get_character_classes</span><span class="keyword">(</span><span class="default">$string</span><span class="keyword">), </span><span class="default">true</span><span class="keyword">);<br />
</span><span class="default">?&gt;<br />
</span><br />
Array<br />
(<br />
&nbsp;&nbsp;&nbsp; [numeric] =&gt; numeric<br />
&nbsp;&nbsp;&nbsp; [alpha] =&gt; alpha<br />
&nbsp;&nbsp;&nbsp; [alphalower] =&gt; alphalower<br />
&nbsp;&nbsp;&nbsp; [alphaupper] =&gt; alphaupper<br />
&nbsp;&nbsp;&nbsp; [currency] =&gt; currency<br />
&nbsp;&nbsp;&nbsp; [ascii] =&gt; ascii<br />
&nbsp;&nbsp;&nbsp; [binary] =&gt; binary<br />
)</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="106737""></a>
  <div class="note">
   <strong class="user">p dot assenov at aip-solutions dot com</strong>
   <a href="#106737" class="date">02-Dec-2011 09:17</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I'm trying to capitalize only the first character of the string and tried some of the examples above but they didn't work. It seems mb_substr() cannot calculate the length of the string in multi-byte encoding (UTF-8) and it should be set explicitly. Here is the corrected version:
<br />

<br />
<span class="default">&lt;?php
<br />
</span><span class="keyword">function </span><span class="default">mb_ucfirst</span><span class="keyword">(</span><span class="default">$str</span><span class="keyword">, </span><span class="default">$enc </span><span class="keyword">= </span><span class="string">'utf-8'</span><span class="keyword">) {
<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">mb_strtoupper</span><span class="keyword">(</span><span class="default">mb_substr</span><span class="keyword">(</span><span class="default">$str</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">, </span><span class="default">$enc</span><span class="keyword">), </span><span class="default">$enc</span><span class="keyword">).</span><span class="default">mb_substr</span><span class="keyword">(</span><span class="default">$str</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">, </span><span class="default">mb_strlen</span><span class="keyword">(</span><span class="default">$str</span><span class="keyword">, </span><span class="default">$enc</span><span class="keyword">), </span><span class="default">$enc</span><span class="keyword">);
<br />
}
<br />
</span><span class="default">?&gt;
<br />
</span>
<br />
cheers!</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="86473""></a>
  <div class="note">
   <strong class="user">projektas at gmail dot com</strong>
   <a href="#86473" class="date">21-Oct-2008 06:29</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
First letter in upper case &lt;hr /&gt;<br />
<br />
<span class="default">&lt;?php<br />
header </span><span class="keyword">(</span><span class="string">'Content-type: text/html; CHARSET=gb2312'</span><span class="keyword">);<br />
<br />
if (isset(</span><span class="default">$_POST</span><span class="keyword">[</span><span class="string">'check'</span><span class="keyword">]) &amp;&amp; !empty(</span><span class="default">$_POST</span><span class="keyword">[</span><span class="string">'check'</span><span class="keyword">])) {<br />
&nbsp;&nbsp;&nbsp; echo </span><span class="default">htmlspecialchars</span><span class="keyword">(</span><span class="default">ucfirst_utf8</span><span class="keyword">(</span><span class="default">$_POST</span><span class="keyword">[</span><span class="string">'check'</span><span class="keyword">]));<br />
} else {<br />
&nbsp;&nbsp;&nbsp; echo </span><span class="default">htmlspecialchars</span><span class="keyword">(</span><span class="default">ucfirst_utf8</span><span class="keyword">(</span><span class="string">'??sin?'</span><span class="keyword">));<br />
}<br />
<br />
function </span><span class="default">ucfirst_utf8</span><span class="keyword">(</span><span class="default">$str</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; if (</span><span class="default">mb_check_encoding</span><span class="keyword">(</span><span class="default">$str</span><span class="keyword">,</span><span class="string">'UTF-8'</span><span class="keyword">)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$first </span><span class="keyword">= </span><span class="default">mb_substr</span><span class="keyword">(<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">mb_strtoupper</span><span class="keyword">(</span><span class="default">$str</span><span class="keyword">, </span><span class="string">"utf-8"</span><span class="keyword">),</span><span class="default">0</span><span class="keyword">,</span><span class="default">1</span><span class="keyword">,</span><span class="string">'utf-8'<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">$first</span><span class="keyword">.</span><span class="default">mb_substr</span><span class="keyword">(<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">mb_strtolower</span><span class="keyword">(</span><span class="default">$str</span><span class="keyword">,</span><span class="string">"utf-8"</span><span class="keyword">),</span><span class="default">1</span><span class="keyword">,</span><span class="default">mb_strlen</span><span class="keyword">(</span><span class="default">$str</span><span class="keyword">),</span><span class="string">'utf-8'<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; } else {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">$str</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
}<br />
</span><span class="default">?&gt;<br />
</span><br />
&lt;form method="post" action="" &gt;<br />
&nbsp;&nbsp;&nbsp; &lt;input type="input" name="check" /&gt;<br />
&nbsp;&nbsp;&nbsp; &lt;input type="submit" /&gt;<br />
&lt;/form&gt;</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="55405""></a>
  <div class="note">
   <strong class="user">xiaogil at yahoo dot fr</strong>
   <a href="#55405" class="date">02-Aug-2005 08:33</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Thanks Darien from /freenode #php for the following example (a little bit changed).<br />
<br />
It just prints the 6th character of $string.<br />
You can replace the digits by the same in japanese, chinese or whatever language to make a test, it works perfect.<br />
<br />
<span class="default">&lt;?php<br />
mb_internal_encoding</span><span class="keyword">(</span><span class="string">"UTF-8"</span><span class="keyword">);<br />
</span><span class="default">$string </span><span class="keyword">= </span><span class="string">"0123456789"</span><span class="keyword">;<br />
</span><span class="default">$mystring </span><span class="keyword">= </span><span class="default">mb_substr</span><span class="keyword">(</span><span class="default">$string</span><span class="keyword">,</span><span class="default">5</span><span class="keyword">,</span><span class="default">1</span><span class="keyword">);<br />
echo </span><span class="default">$mystring</span><span class="keyword">;<br />
</span><span class="default">?&gt;<br />
</span><br />
(I couldn't replace 0123456789 by chinese numbers for example here, because it's automatically converted into latin digits on this website, look : <br />
&amp;#38646;&amp;#19968;&amp;#20108;&amp;#19977;&amp;#22235;<br />
&amp;#20116;&amp;#20845;&amp;#19971;&amp;#20843;&amp;#20061;)<br />
<br />
gilv</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="50275""></a>
  <div class="note">
   <strong class="user">drraf at tlen dot pl</strong>
   <a href="#50275" class="date">23-Feb-2005 06:44</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Note: If borders are out of string - mb_string() returns empty _string_, when function substr() returns _boolean_ false in this case.<br />
Keep this in mind when using "===" comparisions.<br />
<br />
Example code:<br />
<span class="default">&lt;?php<br />
<br />
var_dump</span><span class="keyword">( </span><span class="default">substr</span><span class="keyword">( </span><span class="string">'abc'</span><span class="keyword">, </span><span class="default">5</span><span class="keyword">, </span><span class="default">2 </span><span class="keyword">) ); </span><span class="comment">// returns "false"<br />
</span><span class="default">var_dump</span><span class="keyword">( </span><span class="default">mb_substr</span><span class="keyword">( </span><span class="string">'abc'</span><span class="keyword">, </span><span class="default">5</span><span class="keyword">, </span><span class="default">2 </span><span class="keyword">) ); </span><span class="comment">// returns ""<br />
<br />
</span><span class="default">?&gt;<br />
</span><br />
It's especially confusing when using mbstring with function overloading turned on.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
</div>
</div>
</div></div></body></html>
