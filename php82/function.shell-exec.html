<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
 <head>
  <meta http-equiv="content-type" content="text/html; CHARSET=UTF-8">
  <title>通过 shell 执行命令并将完整的输出以字符串的方式返回</title>
<link media="all" rel="stylesheet" type="text/css" href="styles/03e73060321a0a848018724a6c83de7f-theme-base.css" />
<link media="all" rel="stylesheet" type="text/css" href="styles/03e73060321a0a848018724a6c83de7f-theme-medium.css" />

  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <link media="all" rel="stylesheet" type="text/css" href="style.css"/>
 </head>
 <body class="docs" class="docs"><div class="navbar navbar-fixed-top">
  <div class="navbar-inner clearfix">
    <ul class="nav" style="width: 100%">
      <li style="float: left;"><a href="function.proc-terminate.html">? proc_terminate</a></li>
      <li style="float: right;"><a href="function.system.html">system ?</a></li>
    </ul>
  </div>
</div>
<div id="breadcrumbs" class="clearfix">
  <ul class="breadcrumbs-container">
    <li><a href="index.html">PHP Manual</a></li>
    <li><a href="ref.exec.html">程序执行函数</a></li>
    <li>通过 shell 执行命令并将完整的输出以字符串的方式返回</li>
  </ul>
</div>
<div id="layout">
  <div id="layout-content"><div id="function.shell-exec" class="refentry">
 <div class="refnamediv">
  <h1 class="refname">shell_exec</h1>
  <p class="verinfo">(PHP 4, PHP 5, PHP 7, PHP 8)</p><p class="refpurpose"><span class="refname">shell_exec</span> &mdash; <span class="dc-title">通过 shell 执行命令并将完整的输出以字符串的方式返回</span></p>

 </div>

 <div class="refsect1 description" id="refsect1-function.shell-exec-description">
  <h3 class="title">说明</h3>
  <div class="methodsynopsis dc-description">
   <span class="methodname"><strong>shell_exec</strong></span>(<span class="methodparam"><span class="type">string</span> <code class="parameter">$command</code></span>): <span class="type"><span class="type">string</span>|<span class="type"><span class="type false">false</span></span>|<span class="type">null</span></span></div>

  <p class="para rdfs-comment">
   本函数同<a href="language.operators.execution.html" class="link">执行运算符</a>。
  </p>
  <blockquote class="note"><p><strong class="note">Note</strong>: 
   <p class="para">
    在 Windows 上，底层管道以文本模式打开，这可能导致函数无法进行二进制输出。考虑使用
    <span class="function"><a href="function.popen.html" class="function">popen()</a></span> 避免这种情况。
   </p>
  </p></blockquote>
 </div>


 <div class="refsect1 parameters" id="refsect1-function.shell-exec-parameters">
  <h3 class="title">参数</h3>
  <p class="para">
   <dl>
    
     <dt>
<code class="parameter">command</code></dt>

     <dd>

      <p class="para">
       要执行的命令。
      </p>
     </dd>

    
   </dl>

  </p>
 </div>


 <div class="refsect1 returnvalues" id="refsect1-function.shell-exec-returnvalues">
  <h3 class="title">返回值</h3>
  <p class="para">
   <span class="type">string</span> 包含已执行命令的输出，如果无法建立管道，则为
   <strong><code>false</code></strong>，如果发生错误或者命令不产生输出则为 <strong><code>null</code></strong>
  </p>
  <blockquote class="note"><p><strong class="note">Note</strong>: 
   <p class="para">
    当进程执行过程中发生错误，或者进程不产生输出的情况下，都会返回
    <strong><code>null</code></strong>。使用本函数无法检测执行是否成功。当需要访问程序退出代码时，应使用
    <span class="function"><a href="function.exec.html" class="function">exec()</a></span>。
   </p>
  </p></blockquote>
 </div>


 <div class="refsect1 errors" id="refsect1-function.shell-exec-errors">
  <h3 class="title">错误／异常</h3>
  <p class="para">
   无法建立管道时会产生 <strong><code>E_WARNING</code></strong> 级别的错误。
  </p>
 </div>


 <div class="refsect1 examples" id="refsect1-function.shell-exec-examples">
  <h3 class="title">示例</h3>
  <p class="para">
   <div class="example" id="">
    <p><strong>Example #1 <span class="function"><strong>shell_exec()</strong></span> 示例</strong></p>
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br />$output </span><span style="color: #007700">= </span><span style="color: #0000BB">shell_exec</span><span style="color: #007700">(</span><span style="color: #DD0000">'ls -lart'</span><span style="color: #007700">);<br />echo </span><span style="color: #DD0000">"&lt;pre&gt;</span><span style="color: #0000BB">$output</span><span style="color: #DD0000">&lt;/pre&gt;"</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
    </div>

   </div>
  </p>
 </div>


 <div class="refsect1 seealso" id="refsect1-function.shell-exec-seealso">
  <h3 class="title">参见</h3>
  <p class="para">
   <ul class="simplelist">
    <li class="member"><span class="function"><a href="function.exec.html" class="function" rel="rdfs-seeAlso">exec()</a> - 执行一个外部程序</span></li>
    <li class="member"><span class="function"><a href="function.escapeshellcmd.html" class="function" rel="rdfs-seeAlso">escapeshellcmd()</a> - shell 元字符转义</span></li>
   </ul>
  </p>
 </div>

</div><div id="usernotes">
 <div class="head">
  <h3 class="title">User Contributed Notes</h3>
 </div>
<div id="allnotes">  <a name="126980""></a>
  <div class="note">
   <strong class="user">Which shell?</strong>
   <a href="#126980" class="date">10-Apr-2022 06:31</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Does anything, anywhere mention WHICH SHELL shell_exec() runs?...on my system, it's running sh, instead of bash, which causes &lt;() Process Substitution to fail with no error msg.<br />
<br />
Shouldn't the docs mention which shell this function (&amp; backticks ``) runs?</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="125899""></a>
  <div class="note">
   <strong class="user">Numabyte</strong>
   <a href="#125899" class="date">11-Mar-2021 06:01</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
An important thing to consider is in some cases, like on MacOS, using "2&gt;&amp;1" to properly output string from exec() works well when you wrap the command in parenthesis. <br />
<br />
For example:<br />
WITH PARENTHESIS AROUND CMD<br />
$cmd = "(mysqldump -h l ocalhost -u root -ppassword --databases login_practice_db &gt; /Users/username/Desktop/testDB.sql) 2&gt;&amp;1";<br />
<br />
$sys = shell_exec($cmd ); //Works and produces an error (localhost is poorly spaced on purpose)<br />
<br />
WITHOUT PARENTHESIS AROUND CMD<br />
&nbsp;$cmd = "mysqldump -h l ocalhost -u root -ppassword --databases login_practice_db &gt; /Users/username/Desktop/testDB.sql 2&gt;&amp;1";<br />
<br />
$sys = shell_exec($cmd ); //Does nothing and goes blank as if the result were error free. Empty string.<br />
<br />
It's interesting how shell command execution can get down to how nuanced one might need to be with string parsing.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="125577""></a>
  <div class="note">
   <strong class="user">smcbride at msn dot com</strong>
   <a href="#125577" class="date">07-Dec-2020 10:47</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
proc_open is probably a better solution for most use cases as of PHP 7.4.&nbsp; There is better control and platform independence.&nbsp; If you still want to use shell_exec(), I like to wrap it with a function that allows better control.<br />
<br />
Something like below solves some problems with background process issues on apache/php.&nbsp; It also <br />
<br />
public function sh_exec(string $cmd, string $outputfile = "", string $pidfile = "", bool $mergestderror = true, bool $bg = false) {<br />
&nbsp; $fullcmd = $cmd;<br />
&nbsp; if(strlen($outputfile) &gt; 0) $fullcmd .= " &gt;&gt; " . $outputfile;<br />
&nbsp; if($mergestderror) $fullcmd .= " 2&gt;&amp;1";<br />
&nbsp; if($bg) {<br />
&nbsp;&nbsp;&nbsp; $fullcmd = "nohup " . $fullcmd . " &amp;";<br />
&nbsp;&nbsp;&nbsp; if(strlen($pidfile)) $fullcmd .= " echo $! &gt; " . $pidfile;<br />
&nbsp; } else {<br />
&nbsp;&nbsp;&nbsp; if(strlen($pidfile) &gt; 0) $fullcmd .= "; echo $$ &gt; " . $pidfile;<br />
&nbsp; }<br />
&nbsp; shell_exec($fullcmd);<br />
}</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="123710""></a>
  <div class="note">
   <strong class="user">pedroxam at gmail dot com</strong>
   <a href="#123710" class="date">20-Mar-2019 10:50</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Here is my gist to all:<br />
<br />
function execCommand($command, $log) {<br />
<br />
&nbsp;&nbsp;&nbsp; if (substr(php_uname(), 0, 7) == "Windows")<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; //windows<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; pclose(popen("start /B " . $command . " 1&gt; $log 2&gt;&amp;1", "r"));<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; else<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; //linux<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; shell_exec( $command . " 1&gt; $log 2&gt;&amp;1" );<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; return false;<br />
}</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="123226""></a>
  <div class="note">
   <strong class="user">ricky at rocker dot com</strong>
   <a href="#123226" class="date">12-Oct-2018 10:21</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
despite: <br />
<br />
shell_exec("env")<br />
<br />
returning <br />
<br />
SHELL=/bin/bash<br />
<br />
I simply could not get:<br />
<br />
shell_exec("bash command &lt;(another bash command)")<br />
<br />
to work. I have now got it working by forcing the bash shell using: <br />
<br />
shell_exec("bash -c \"bash command &lt;(another bash command)\"")</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="122676""></a>
  <div class="note">
   <strong class="user">smithnigelw at gmail dot com</strong>
   <a href="#122676" class="date">27-Apr-2018 02:13</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
With PHP on Windows, if you get the 'Warning: shell_exec() [function.shell-exec]: Unable to execute' error, then you need to check the permissions on file 'C:\WINDOWS\system32\cmd.exe'. You need read/execute permission on this file.&nbsp; I would recommend using the sysinternals Process Monitor 'procmon.exe' to confirm the user that is trying to run 'cmd.exe'. Filter on 'Process Name' is 'php-cgi.exe' and 'Path' ends with 'cmd.exe'. Look at the event properties for the task with the access denied error, and it will show you the 'Impersonating' user name.&nbsp; This is usually the 'Internet Guest Account', often 'NT AUTHORITY\IUSR'.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="118495""></a>
  <div class="note">
   <strong class="user">alexandre dot schmidt at gmail dot com</strong>
   <a href="#118495" class="date">16-Dec-2015 02:26</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
To run a command in background, the output must be redirected to /dev/null. This is written in exec() manual page. There are cases where you need the output to be logged somewhere else though. Redirecting the output to a file like this didn't work for me:<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="comment"># this doesn't work!<br />
</span><span class="default">shell_exec</span><span class="keyword">(</span><span class="string">"my_script.sh 2&gt;&amp;1 &gt;&gt; /tmp/mylog &amp;"</span><span class="keyword">);<br />
</span><span class="default">?&gt;<br />
</span><br />
Using the above command still hangs web browser request.<br />
<br />
Seems like you have to add exactly "/dev/null" to the command line. For instance, this worked:<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="comment"># works, but output is lost<br />
</span><span class="default">shell_exec</span><span class="keyword">(</span><span class="string">"my_script.sh 2&gt;/dev/null &gt;/dev/null &amp;"</span><span class="keyword">);<br />
</span><span class="default">?&gt;<br />
</span><br />
But I wanted the output, so I used this:<br />
<br />
<span class="default">&lt;?php<br />
shell_exec</span><span class="keyword">(</span><span class="string">"my_script.sh 2&gt;&amp;1 | tee -a /tmp/mylog 2&gt;/dev/null &gt;/dev/null &amp;"</span><span class="keyword">);<br />
</span><span class="default">?&gt;<br />
</span><br />
Hope this helps someone.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="115702""></a>
  <div class="note">
   <strong class="user">jack dot harris-7ot2j4ip at yopmail dot Com</strong>
   <a href="#115702" class="date">11-Sep-2014 01:52</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
On Windows, if shell_exec does NOT return the result you expected and the PC is on an enterprise network, set the Apache service (or wampapache) to run under your account instead of the 'Local system account'. Your account must have admin privileges.<br />
<br />
To change the account go to console services, right click on the Apache service, choose properties, and select the connection tab.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="109693""></a>
  <div class="note">
   <strong class="user">wally at soggysoftware dot co dot uk</strong>
   <a href="#109693" class="date">10-Aug-2012 11:39</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
As others have noted, shell_exec and the backtick operator (`) both return NULL if the executed command doesn't output anything.<br />
<br />
This can be worked around by doing anything like the following:<br />
<br />
shell_exec ("silentcmd &amp;&amp; echo ' '");<br />
<br />
Here we're simply outputting blank whitespace if&nbsp; the command succeeds - which satisfies this slightly strange issue.&nbsp; From there, you can trim() the command output etc.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="106250""></a>
  <div class="note">
   <strong class="user">trev at dedicate.co.uk</strong>
   <a href="#106250" class="date">21-Oct-2011 07:34</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you're trying to run a command such as "gunzip -t" in shell_exec and getting an empty result, you might need to add 2&gt;&amp;1 to the end of the command, eg:<br />
<br />
Won't always work:<br />
echo shell_exec("gunzip -c -t $path_to_backup_file");<br />
<br />
Should work:<br />
echo shell_exec("gunzip -c -t $path_to_backup_file 2&gt;&amp;1");<br />
<br />
In the above example, a line break at the beginning of the gunzip output seemed to prevent shell_exec printing anything else. Hope this saves someone else an hour or two.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="96249""></a>
  <div class="note">
   <strong class="user">martin at intelli-gens dot com</strong>
   <a href="#96249" class="date">17-Feb-2010 03:21</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Also after lots of hair pulling why shell_exec didn't want to work for me I found out that in my case some things needed to be set (which normally are set by default).<br />
<br />
the options -jo&nbsp; <br />
-j means: don't recreate the paths found in the archive<br />
-o means: always overwrite files<br />
<br />
And I needed to specify the destination path (even though it should unzip in the same directory when not specified), this is done by -d [path]<br />
<br />
The strange thing was that I didn't have to put these options when I would give the command on the command-line, only when I would call it with shell_exec.<br />
<br />
So the complete command in php would be for me:<br />
<br />
shell_exec('unzip -jo /path_to_archive/archive.zip&nbsp; -d /destination_path')<br />
<br />
And putting en echo in front will help you a lot.<br />
it should tell you something like this:<br />
&nbsp;&nbsp; &nbsp; <br />
<br />
Archive:&nbsp; /path_to_zip/archive.zip<br />
&nbsp; inflating: /destination_path/file1.jpeg&nbsp; <br />
&nbsp; inflating: /destination_path/file2.jpeg<br />
&nbsp; inflating: /destination_path/file3.jpeg</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="95651""></a>
  <div class="note">
   <strong class="user">codeslinger at compsalot dot com</strong>
   <a href="#95651" class="date">13-Jan-2010 06:47</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
it took me a heck of a lot of head banging to finally solve this problem so I thought that I would mention it here.<br />
<br />
If you are using Eclipse and you try to do something like<br />
<br />
<span class="default">&lt;?php<br />
<br />
&nbsp;&nbsp;&nbsp; $out </span><span class="keyword">= </span><span class="default">shell_exec</span><span class="keyword">(</span><span class="string">"php -s </span><span class="default">$File</span><span class="string">"</span><span class="keyword">);&nbsp;&nbsp; </span><span class="comment">//this fails <br />
</span><span class="default">?&gt;<br />
</span><br />
it will always fail when run inside of the Eclipse debugger.&nbsp; This happens on both Linux and Windows.&nbsp; I finally isolated the problem to changes that Eclipse makes to the environment when debugging.&nbsp;&nbsp; <br />
<br />
The fix is to force the ini setting.&nbsp; If you don't need an ini then -n is sufficient.<br />
<br />
<span class="default">&lt;?php<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; $out </span><span class="keyword">= </span><span class="default">shell_exec</span><span class="keyword">(</span><span class="string">"php -n -s </span><span class="default">$File</span><span class="string">"</span><span class="keyword">);&nbsp;&nbsp; </span><span class="comment">//this works<br />
</span><span class="default">?&gt;<br />
</span><br />
Of course if you run it outside of the debugger then it works fine without the -n.&nbsp;&nbsp; You may want to use a debug flag to control this behavior.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="90176""></a>
  <div class="note">
   <strong class="user">joelhy</strong>
   <a href="#90176" class="date">08-Apr-2009 06:29</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Here is a easy way to grab STDERR and discard STDOUT:<br />
&nbsp;&nbsp;&nbsp; add&nbsp; '2&gt;&amp;1 1&gt; /dev/null' to the end of your shell command<br />
<br />
For example:<br />
<span class="default">&lt;?php<br />
$output </span><span class="keyword">= </span><span class="default">shell_exec</span><span class="keyword">(</span><span class="string">'ls file_not_exist 2&gt;&amp;1 1&gt; /dev/null'</span><span class="keyword">);<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="88621""></a>
  <div class="note">
   <strong class="user">dburles@NOSPAMgmailDOTcom</strong>
   <a href="#88621" class="date">01-Feb-2009 03:07</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Easy way to capture error output in windows<br />
<br />
// we'll execute a php script as an example:<br />
$out = shell_exec("php test.php 2&gt; output");<br />
print $out ? $out : join("", file("output"));<br />
<br />
We assume in this case if the script produces output it has ran ok, the $out variable will then contain the output, if $out is empty then we read the captured error output from a file simply called 'output'.<br />
<br />
Hope this helps someone</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="88052""></a>
  <div class="note">
   <strong class="user">Rgemini</strong>
   <a href="#88052" class="date">07-Jan-2009 03:46</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
A simple way to handle the problem of capturing stderr output when using shell-exec under windows is to call ob_start() before the command and ob_end_clean() afterwards, like this:<br />
<br />
<span class="default">&lt;?php<br />
ob_start</span><span class="keyword">()<br />
</span><span class="default">$dir </span><span class="keyword">= </span><span class="default">shell_exec</span><span class="keyword">(</span><span class="string">'dir B:'</span><span class="keyword">);<br />
if </span><span class="default">is_null</span><span class="keyword">(</span><span class="default">$dir</span><span class="keyword">)<br />
{&nbsp;&nbsp; </span><span class="comment">// B: does not exist<br />
&nbsp;&nbsp;&nbsp; // do whatever you want with the stderr output here<br />
</span><span class="keyword">}<br />
else<br />
{&nbsp; </span><span class="comment">// B: exists and $dir holds the directory listing<br />
&nbsp;&nbsp; // do whatever you want with it here<br />
</span><span class="keyword">}<br />
</span><span class="default">ob_end_clean</span><span class="keyword">();&nbsp;&nbsp; </span><span class="comment">// get rid of the evidence :-)<br />
</span><span class="default">?&gt;<br />
</span><br />
If B: does not exist then $dir will be Null and the output buffer will have captured the message: <br />
<br />
&nbsp; 'The system cannot find the path specified'. <br />
<br />
(under WinXP, at least). If B: exists then $dir will contain the directory listing and we probably don't care about the output buffer. In any case it needs to be deleted before proceeding.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="83151""></a>
  <div class="note">
   <strong class="user">saivert at saivert dot com</strong>
   <a href="#83151" class="date">12-May-2008 08:48</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
How to get the volume label of a drive on Windows<br />
<br />
<span class="default">&lt;?php<br />
<br />
</span><span class="keyword">function </span><span class="default">GetVolumeLabel</span><span class="keyword">(</span><span class="default">$drive</span><span class="keyword">) {<br />
&nbsp; </span><span class="comment">// Try to grab the volume name<br />
&nbsp; </span><span class="keyword">if (</span><span class="default">preg_match</span><span class="keyword">(</span><span class="string">'#Volume in drive [a-zA-Z]* is (.*)\n#i'</span><span class="keyword">, </span><span class="default">shell_exec</span><span class="keyword">(</span><span class="string">'dir '</span><span class="keyword">.</span><span class="default">$drive</span><span class="keyword">.</span><span class="string">':'</span><span class="keyword">), </span><span class="default">$m</span><span class="keyword">)) {<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$volname </span><span class="keyword">= </span><span class="string">' ('</span><span class="keyword">.</span><span class="default">$m</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">].</span><span class="string">')'</span><span class="keyword">;<br />
&nbsp; } else {<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$volname </span><span class="keyword">= </span><span class="string">''</span><span class="keyword">;<br />
&nbsp; }<br />
return </span><span class="default">$volname</span><span class="keyword">;<br />
}<br />
<br />
print </span><span class="default">GetVolumeLabel</span><span class="keyword">(</span><span class="string">"c"</span><span class="keyword">);<br />
<br />
</span><span class="default">?&gt;<br />
</span><br />
Note: The regular expression assumes a english version of Windows is in use. modify it accordingly for a different localized copy of Windows.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="82278""></a>
  <div class="note">
   <strong class="user">gabekon at gmail dot com</strong>
   <a href="#82278" class="date">03-Apr-2008 08:33</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
RE: kamermans note,<br />
<br />
I was having a similar problem with the PATH variable when using shell_exec. Even with a hard-coded full path to a binary, I also got an error about a .so file that could not be found. After some reading up, I realized I had to set the LD_LIBRARY_PATH variable:<br />
<br />
<span class="default">&lt;?php<br />
<br />
$command </span><span class="keyword">= </span><span class="string">'export LD_LIBRARY_PATH="' </span><span class="keyword">. </span><span class="default">$path_to_library_dir </span><span class="keyword">.</span><span class="string">'"; ' </span><span class="keyword">. </span><span class="default">$path_to_binary</span><span class="keyword">;<br />
</span><span class="default">shell_exec</span><span class="keyword">(</span><span class="default">$command</span><span class="keyword">);<br />
<br />
</span><span class="default">?&gt;<br />
</span><br />
Hope this saves someone a headache,<br />
<br />
- G</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="79061""></a>
  <div class="note">
   <strong class="user">RoBorg</strong>
   <a href="#79061" class="date">08-Nov-2007 07:45</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
The Subversion error "svn: Can't recode string" can be caused by the locale being wrong.&nbsp; Try<br />
<span class="default">&lt;?php<br />
putenv</span><span class="keyword">(</span><span class="string">'LANG=en_US.UTF-8'</span><span class="keyword">);<br />
</span><span class="default">?&gt;<br />
</span>(or whatever your preferred locale is) before you call shell_exec()</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="78506""></a>
  <div class="note">
   <strong class="user">kamermans at teratechnologies dot net</strong>
   <a href="#78506" class="date">15-Oct-2007 08:01</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I'm not sure what shell you are going to get with this function, but you can find out like this:<br />
<br />
<span class="default">&lt;?php<br />
$cmd </span><span class="keyword">= </span><span class="string">'set'</span><span class="keyword">;<br />
echo </span><span class="string">"&lt;pre&gt;"</span><span class="keyword">.</span><span class="default">shell_exec</span><span class="keyword">(</span><span class="default">$cmd</span><span class="keyword">).</span><span class="string">"&lt;/pre&gt;"</span><span class="keyword">;<br />
</span><span class="default">?&gt;<br />
</span><br />
On my FreeBSD 6.1 box I get this:<br />
<br />
USER=root<br />
LD_LIBRARY_PATH=/usr/local/lib/apache2:<br />
HOME=/root<br />
PS1='$ '<br />
OPTIND=1<br />
PS2='&gt; '<br />
LOGNAME=root<br />
PPID=88057<br />
PATH=/etc:/bin:/sbin:/usr/bin:/usr/sbin<br />
SHELL=/bin/sh<br />
IFS='&nbsp; &nbsp;&nbsp; <br />
'<br />
<br />
Very interesting.&nbsp; Note that the PATH may not be as complete as you need.&nbsp; I wanted to run Ghostscript via ImageMagik's "convert" and ended up having to add my path before running the command:<br />
<br />
<span class="default">&lt;?php<br />
$cmd </span><span class="keyword">= </span><span class="string">'export PATH="/usr/local/bin/"; convert -scale 25%x25% file1.pdf[0] file2.png 2&gt;&amp;1'</span><span class="keyword">;<br />
echo </span><span class="string">"&lt;pre&gt;"</span><span class="keyword">.</span><span class="default">shell_exec</span><span class="keyword">(</span><span class="default">$cmd</span><span class="keyword">).</span><span class="string">"&lt;/pre&gt;"</span><span class="keyword">;<br />
</span><span class="default">?&gt;<br />
</span><br />
ALSO, note that shell_exec() does not grab STDERR, so use "2&gt;&amp;1" to redirect it to STDOUT and catch it.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="78279""></a>
  <div class="note">
   <strong class="user">eric dot peyremorte at iut-valence dot fr</strong>
   <a href="#78279" class="date">05-Oct-2007 02:01</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I had trouble with accented caracters and shell_exec.<br />
<br />
ex :<br />
<br />
Executing this command from shell :<br />
<br />
/usr/bin/smbclient '//BREZEME/peyremor' -c 'dir' -U 'peyremor%*********' -d 0 -W 'ADMINISTRATIF' -O 'TCP_NODELAY IPTOS_LOWDELAY SO_KEEPALIVE SO_RCVBUF=8192 SO_SNDBUF=8192' -b 1200 -N 2&gt;&amp;1<br />
<br />
gave me that :<br />
<br />
Vidéos&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; D&nbsp; &nbsp; &nbsp; &nbsp; 0&nbsp; Tue Jun 12 14:41:21 2007<br />
&nbsp; Desktop&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; DH&nbsp; &nbsp; &nbsp; &nbsp; 0&nbsp; Mon Jun 18 17:41:36 2007<br />
<br />
Using php like that :<br />
<br />
shell_exec("/usr/bin/smbclient '//BREZEME/peyremor' -c 'dir' -U 'peyremor%*******' -d 0 -W 'ADMINISTRATIF' -O 'TCP_NODELAY IPTOS_LOWDELAY SO_KEEPALIVE SO_RCVBUF=8192 SO_SNDBUF=8192' -b 1200 -N 2&gt;&amp;1")<br />
<br />
gave me that :<br />
<br />
&nbsp; Vid&nbsp; Desktop&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; DH&nbsp; &nbsp; &nbsp; &nbsp; 0&nbsp; Mon Jun 18 17:41:36 2007<br />
<br />
The two lines were concatenated from the place where the accent was.<br />
<br />
I found the solution : php execute by default the command with LOCALE=C. <br />
<br />
I just added the following lines before shell_exec and the problem was solved :<br />
<br />
$locale = 'fr_FR.UTF-8';<br />
setlocale(LC_ALL, $locale);<br />
putenv('LC_ALL='.$locale);<br />
<br />
Just adapt it to your language locale.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="69706""></a>
  <div class="note">
   <strong class="user">Paul Cook</strong>
   <a href="#69706" class="date">16-Sep-2006 11:00</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
The technique mentioned by Nathan De Hert below is rather insecure -- you should never leave a password lying around in a file readable by the apache user.<br />
<br />
If you need this sort of functionality on *nix systems, have a look at the /etc/sudo file (edited with the command 'visudo'). The tag NOPASSWD allows specified commands to be run as root by another user, without needing to specify a password. It's a little extra configuration, but much more secure.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="69160""></a>
  <div class="note">
   <strong class="user">ruan at nospam dot tillcor dot com</strong>
   <a href="#69160" class="date">24-Aug-2006 08:31</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
When following Kenneth's method for executing root scripts via the nanoweb server mentioned on this page you would most likely need to be able to run a text-mode browser like lynx and pass the php script to it (works great).<br />
<br />
After struggling for a while (lynx kept asking me to download the file instead of executing it), I realised that I had to install php-cgi additionally and modify the nanoweb config file&nbsp; to use that php interpreter instead of /usr/bin/php. (On Debian this is the CLI version).<br />
<br />
On Ubuntu 6.06:<br />
<br />
apt-get install php5-cgi<br />
<br />
After editing /etc/nanoweb/nanoweb.conf and a quick restart of the web server, lynx and links will execute your PHP scripts properly.<br />
<br />
Hope this helps somebody else out there :)<br />
<br />
Ruan Fourie</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="67183""></a>
  <div class="note">
   <strong class="user">rustleb at hotmail dot com</strong>
   <a href="#67183" class="date">05-Jun-2006 01:45</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
For capturing stdout and stderr, when you don't care about the intermediate files, I've had better results with . . .<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">function </span><span class="default">cmd_exec</span><span class="keyword">(</span><span class="default">$cmd</span><span class="keyword">, &amp;</span><span class="default">$stdout</span><span class="keyword">, &amp;</span><span class="default">$stderr</span><span class="keyword">)<br />
{<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$outfile </span><span class="keyword">= </span><span class="default">tempnam</span><span class="keyword">(</span><span class="string">"."</span><span class="keyword">, </span><span class="string">"cmd"</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$errfile </span><span class="keyword">= </span><span class="default">tempnam</span><span class="keyword">(</span><span class="string">"."</span><span class="keyword">, </span><span class="string">"cmd"</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$descriptorspec </span><span class="keyword">= array(<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">0 </span><span class="keyword">=&gt; array(</span><span class="string">"pipe"</span><span class="keyword">, </span><span class="string">"r"</span><span class="keyword">),<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">1 </span><span class="keyword">=&gt; array(</span><span class="string">"file"</span><span class="keyword">, </span><span class="default">$outfile</span><span class="keyword">, </span><span class="string">"w"</span><span class="keyword">),<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">2 </span><span class="keyword">=&gt; array(</span><span class="string">"file"</span><span class="keyword">, </span><span class="default">$errfile</span><span class="keyword">, </span><span class="string">"w"</span><span class="keyword">)<br />
&nbsp;&nbsp;&nbsp; );<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$proc </span><span class="keyword">= </span><span class="default">proc_open</span><span class="keyword">(</span><span class="default">$cmd</span><span class="keyword">, </span><span class="default">$descriptorspec</span><span class="keyword">, </span><span class="default">$pipes</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; if (!</span><span class="default">is_resource</span><span class="keyword">(</span><span class="default">$proc</span><span class="keyword">)) return </span><span class="default">255</span><span class="keyword">;<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">fclose</span><span class="keyword">(</span><span class="default">$pipes</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">]);&nbsp; &nbsp; </span><span class="comment">//Don't really want to give any input<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$exit </span><span class="keyword">= </span><span class="default">proc_close</span><span class="keyword">(</span><span class="default">$proc</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$stdout </span><span class="keyword">= </span><span class="default">file</span><span class="keyword">(</span><span class="default">$outfile</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$stderr </span><span class="keyword">= </span><span class="default">file</span><span class="keyword">(</span><span class="default">$errfile</span><span class="keyword">);<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">unlink</span><span class="keyword">(</span><span class="default">$outfile</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">unlink</span><span class="keyword">(</span><span class="default">$errfile</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">$exit</span><span class="keyword">;<br />
}<br />
</span><span class="default">?&gt;<br />
</span><br />
This isn't much different than a redirection, except it takes care of the temp files for you (you may need to change the directory from ".") and it blocks automatically due to the proc_close call.&nbsp; This mimics the shell_exec behavior, plus gets you stderr.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="61998""></a>
  <div class="note">
   <strong class="user">rigsbr at yahoo dot com dot br</strong>
   <a href="#61998" class="date">16-Feb-2006 06:24</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you need to execute a command without permission and could not execute it by ssh or install any extension, there is a way in Apache 1.3.x and PHP 4.<br />
Create a file on cgi-bin directory, like this:<br />
<br />
#!/usr/bin/php<br />
&lt;?<br />
&nbsp; echo shell_exec('whoami');<br />
?&gt;<br />
<br />
Don't forget to set the file you created the permission to execute it. Hence, call it from browser and you will se that this script will be executed by the shell user and not the user nobody (apache default user if running a PHP script).</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="59898""></a>
  <div class="note">
   <strong class="user">Ashraf Kaabi</strong>
   <a href="#59898" class="date">19-Dec-2005 10:06</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I've write a Full Class for Run in Background, Kill PID , check if is Running <br />
<br />
<span class="default">&lt;?php<br />
</span><span class="comment">/**<br />
&nbsp;* @author&nbsp; &nbsp;&nbsp; Ashraf M Kaabi<br />
&nbsp;* @name&nbsp; &nbsp; &nbsp;&nbsp; Advance Linux Exec<br />
&nbsp;*/<br />
</span><span class="keyword">class </span><span class="default">exec </span><span class="keyword">{<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">/**<br />
&nbsp;&nbsp; &nbsp; * Run Application in background<br />
&nbsp;&nbsp; &nbsp; *<br />
&nbsp;&nbsp; &nbsp; * @param&nbsp; &nbsp;&nbsp; unknown_type $Command<br />
&nbsp;&nbsp; &nbsp; * @param&nbsp; &nbsp;&nbsp; unknown_type $Priority<br />
&nbsp;&nbsp; &nbsp; * @return&nbsp; &nbsp;&nbsp; PID<br />
&nbsp;&nbsp; &nbsp; */<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">function </span><span class="default">background</span><span class="keyword">(</span><span class="default">$Command</span><span class="keyword">, </span><span class="default">$Priority </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">){<br />
&nbsp;&nbsp; &nbsp; &nbsp; if(</span><span class="default">$Priority</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$PID </span><span class="keyword">= </span><span class="default">shell_exec</span><span class="keyword">(</span><span class="string">"nohup nice -n </span><span class="default">$Priority</span><span class="string"> </span><span class="default">$Command</span><span class="string"> &gt; /dev/null &amp; echo $!"</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; else<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$PID </span><span class="keyword">= </span><span class="default">shell_exec</span><span class="keyword">(</span><span class="string">"nohup </span><span class="default">$Command</span><span class="string"> &gt; /dev/null &amp; echo $!"</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; return(</span><span class="default">$PID</span><span class="keyword">);<br />
&nbsp;&nbsp; }<br />
&nbsp;&nbsp; </span><span class="comment">/**<br />
&nbsp;&nbsp;&nbsp; * Check if the Application running !<br />
&nbsp;&nbsp;&nbsp; *<br />
&nbsp;&nbsp;&nbsp; * @param&nbsp; &nbsp;&nbsp; unknown_type $PID<br />
&nbsp;&nbsp;&nbsp; * @return&nbsp; &nbsp;&nbsp; boolen<br />
&nbsp;&nbsp;&nbsp; */<br />
&nbsp;&nbsp; </span><span class="keyword">function </span><span class="default">is_running</span><span class="keyword">(</span><span class="default">$PID</span><span class="keyword">){<br />
&nbsp;&nbsp; &nbsp; &nbsp; </span><span class="default">exec</span><span class="keyword">(</span><span class="string">"ps </span><span class="default">$PID</span><span class="string">"</span><span class="keyword">, </span><span class="default">$ProcessState</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; return(</span><span class="default">count</span><span class="keyword">(</span><span class="default">$ProcessState</span><span class="keyword">) &gt;= </span><span class="default">2</span><span class="keyword">);<br />
&nbsp;&nbsp; }<br />
&nbsp;&nbsp; </span><span class="comment">/**<br />
&nbsp;&nbsp;&nbsp; * Kill Application PID<br />
&nbsp;&nbsp;&nbsp; *<br />
&nbsp;&nbsp;&nbsp; * @param&nbsp; unknown_type $PID<br />
&nbsp;&nbsp;&nbsp; * @return boolen<br />
&nbsp;&nbsp;&nbsp; */<br />
&nbsp;&nbsp; </span><span class="keyword">function </span><span class="default">kill</span><span class="keyword">(</span><span class="default">$PID</span><span class="keyword">){<br />
&nbsp;&nbsp; &nbsp; &nbsp; if(</span><span class="default">exec</span><span class="keyword">::</span><span class="default">is_running</span><span class="keyword">(</span><span class="default">$PID</span><span class="keyword">)){<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">exec</span><span class="keyword">(</span><span class="string">"kill -KILL </span><span class="default">$PID</span><span class="string">"</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return </span><span class="default">true</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; }else return </span><span class="default">false</span><span class="keyword">;<br />
&nbsp;&nbsp; }<br />
};<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="57215""></a>
  <div class="note">
   <strong class="user">php [AT] jsomers [DOT] be</strong>
   <a href="#57215" class="date">27-Sep-2005 06:00</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
<span class="default">&lt;?php<br />
<br />
</span><span class="comment">/**<br />
&nbsp;* PHP Kill Process<br />
&nbsp;*<br />
&nbsp;* Sometimes, it can happen a script keeps running when it shouldn't, and it<br />
&nbsp;* won't stop after we close the browser, or shutdown the computer. Because it's<br />
&nbsp;* not always easy to use SSH there's a workaround.<br />
&nbsp;*<br />
&nbsp;* @author&nbsp; &nbsp; &nbsp; Jensen Somers &lt;php@jsomers.be&gt;<br />
&nbsp;* @version&nbsp; &nbsp;&nbsp; 1.0<br />
&nbsp;*/<br />
&nbsp;<br />
</span><span class="keyword">class </span><span class="default">KillAllProcesses </span><span class="keyword">{<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">/**<br />
&nbsp;&nbsp; &nbsp; * Construct the class<br />
&nbsp;&nbsp; &nbsp; */<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">function </span><span class="default">killallprocesses</span><span class="keyword">() {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">listItems</span><span class="keyword">();<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">/**<br />
&nbsp;&nbsp; &nbsp; * List all the items<br />
&nbsp;&nbsp; &nbsp; */<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">function </span><span class="default">listItems</span><span class="keyword">() {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">/*<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; * PS&nbsp;&nbsp; Unix command to report process status<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; * -x&nbsp;&nbsp; Select processes without controlling ttys<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; *<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; * Output will look like:<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; *&nbsp; &nbsp; &nbsp; 16479 pts/13&nbsp;&nbsp; S&nbsp; &nbsp; &nbsp; 0:00 -bash<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; *&nbsp; &nbsp; &nbsp; 21944 pts/13&nbsp;&nbsp; R&nbsp; &nbsp; &nbsp; 0:00 ps -x<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; *<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; */<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$output </span><span class="keyword">=&nbsp;&nbsp; </span><span class="default">shell_exec</span><span class="keyword">(</span><span class="string">'ps -x'</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">output</span><span class="keyword">(</span><span class="default">$output</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// Put each individual line into an array<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$array&nbsp; </span><span class="keyword">=&nbsp;&nbsp; </span><span class="default">explode</span><span class="keyword">(</span><span class="string">"\n"</span><span class="keyword">, </span><span class="default">$output</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">doKill</span><span class="keyword">(</span><span class="default">$array</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">/**<br />
&nbsp;&nbsp; &nbsp; * Print the process list<br />
&nbsp;&nbsp; &nbsp; * @param&nbsp;&nbsp; string&nbsp; $output<br />
&nbsp;&nbsp; &nbsp; */<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">function </span><span class="default">output</span><span class="keyword">(</span><span class="default">$output</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; print&nbsp;&nbsp; </span><span class="string">"&lt;pre&gt;"</span><span class="keyword">.</span><span class="default">$output</span><span class="keyword">.</span><span class="string">"&lt;/pre&gt;"</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">/**<br />
&nbsp;&nbsp; &nbsp; * Kill all the processes<br />
&nbsp;&nbsp; &nbsp; * It should be possible to filter in this, but I won't do it now.<br />
&nbsp;&nbsp; &nbsp; * @param&nbsp;&nbsp; array&nbsp;&nbsp; $array<br />
&nbsp;&nbsp; &nbsp; */<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">function </span><span class="default">doKill</span><span class="keyword">(</span><span class="default">$array</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">/*<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; * Because the first line of our $output will look like<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; *&nbsp; &nbsp; &nbsp; &nbsp; PID TTY&nbsp; &nbsp; &nbsp; STAT&nbsp;&nbsp; TIME COMMAND<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; * we'll skip this one.<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; */<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">for (</span><span class="default">$i </span><span class="keyword">= </span><span class="default">1</span><span class="keyword">; </span><span class="default">$i </span><span class="keyword">&lt; </span><span class="default">count</span><span class="keyword">(</span><span class="default">$array</span><span class="keyword">); </span><span class="default">$i</span><span class="keyword">++) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$id </span><span class="keyword">=&nbsp;&nbsp; </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$array</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">], </span><span class="default">0</span><span class="keyword">, </span><span class="default">strpos</span><span class="keyword">(</span><span class="default">$array</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">], </span><span class="string">' ?'</span><span class="keyword">));<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">shell_exec</span><span class="keyword">(</span><span class="string">'kill '</span><span class="keyword">.</span><span class="default">$id</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; }<br />
}<br />
<br />
new </span><span class="default">KillAllProcesses</span><span class="keyword">();<br />
<br />
</span><span class="default">?&gt;<br />
</span><br />
It's not the very best solution, but I've used it a couple of times when I needed to do it quick without to much trouble.<br />
Make not I kill all the processes, on my server px -x will only return like 4 times /sbin/apache and it's pretty safe to kill them without any trouble.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="56935""></a>
  <div class="note">
   <strong class="user">concept at conceptonline dot hu</strong>
   <a href="#56935" class="date">19-Sep-2005 02:02</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Interestingly, if you execute a script which is not in your path (or you have made a typo, or if the script does no exist at all), you will get no return value. The error will be logged into the error_log of your webserver.<br />
<br />
Someone could add a note how this can be (if it could be) overriden, as the standard behaviour is not really fool-proof.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="51782""></a>
  <div class="note">
   <strong class="user">phillipberry at NOSPAM dot blisswebhosting dot com</strong>
   <a href="#51782" class="date">11-Apr-2005 01:13</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I found something odd.<br />
<br />
If you run exec then straight after shell_exec the shell_exec will simply not run and will return NULL.<br />
<br />
To get it to work i put a sleep(5) after the exec and now shell_exec works fine.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="48654""></a>
  <div class="note">
   
   <a href="#48654" class="date">03-Jan-2005 09:10</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Be careful as to how you elevate privileges to your php script.&nbsp; It's a good idea to use caution and planing.&nbsp; It is easy to open up huge security holes.&nbsp; Here are a couple of helpful hints I've gathered from experimentation and Unix documentation.<br />
<br />
Things to think about:<br />
<br />
1. If you are running php as an Apache module in Unix then every system command you run is run as user apache.&nbsp; This just makes sense.. Unix won't allow privileges to be elevated in this manner.&nbsp; If you need to run a system command with elevated privileges think through the problem carefully!<br />
<br />
2. You are absolutely insane if you decide to run apache as root.&nbsp; You may as well kick yourself in the face.&nbsp; There is always a better way to do it.<br />
<br />
3. If you decide to use a SUID it is best not to SUID a script.&nbsp; SUID is disabled for scripts on many flavors of Unix.&nbsp; SUID scripts open up security holes, so you don't always want to go this route even if it is an option.&nbsp; Write a simple binary and elevate the privileges of the binary as a SUID.&nbsp; In my own opinion it is a horrible idea to pass a system command through a SUID-- ie have the SUID accept the name of a command as a parameter.&nbsp; You may as well run Apache as root!</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="44438""></a>
  <div class="note">
   <strong class="user">James McCormack</strong>
   <a href="#44438" class="date">05-Aug-2004 01:50</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I had a perl program which ran fine from command line but not using shell_exec(), exec() or system() - nothing was being returned. I was using the full path and permissions were set correctly.<br />
<br />
It turned out the perl program was using more memory than my PHP.INI file was set to allow. Increasing "memory_limit" solved the problem.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="38905""></a>
  <div class="note">
   <strong class="user">Martin Rampersad</strong>
   <a href="#38905" class="date">11-Jan-2004 01:13</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I have PHP (CGI) and Apache. I also shell_exec() shell scripts which use PHP CLI. This combination destroys the string value returned from the call. I get binary garbage.&nbsp; Shell scripts that start with #!/usr/bin/bash return their output properly.<br />
<br />
A solution is to force a clean environment.&nbsp; PHP CLI no longer had the CGI environment variables to choke on.<br />
<br />
<span class="default">&lt;?php<br />
<br />
</span><span class="comment">// Binary garbage.<br />
</span><span class="default">$ExhibitA </span><span class="keyword">= </span><span class="default">shell_exec</span><span class="keyword">(</span><span class="string">'/home/www/myscript'</span><span class="keyword">);<br />
<br />
</span><span class="comment">// Perfect.<br />
</span><span class="default">$ExhibitB </span><span class="keyword">= </span><span class="default">shell_exec</span><span class="keyword">(</span><span class="string">'env -i /home/www/myscript'</span><span class="keyword">);<br />
<br />
</span><span class="default">?&gt;<br />
</span><br />
-- start /home/www/myscript<br />
#!/usr/local/bin/phpcli<br />
<span class="default">&lt;?php<br />
<br />
</span><span class="keyword">echo(</span><span class="string">"Output.\n"</span><span class="keyword">);<br />
<br />
</span><span class="default">?&gt;<br />
</span>-- end /home/www/myscript</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="37971""></a>
  <div class="note">
   <strong class="user">jessop &lt;AT&gt; bigfoot &lt;DOT&gt; com</strong>
   <a href="#37971" class="date">03-Dec-2003 12:19</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Just a quick reminder for those trying to use shell_exec on a unix-type platform and can't seem to get it to work. PHP executes as the web user on the system (generally www for Apache), so you need to make sure that the web user has rights to whatever files or directories that you are trying to use in the shell_exec command. Other wise, it won't appear to be doing anything.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="31235""></a>
  <div class="note">
   <strong class="user">mcbeth at broggs dot org</strong>
   <a href="#31235" class="date">14-Apr-2003 02:18</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
As far as error checking on the last example.&nbsp; Several of the shells have the &amp;&amp; operator, so you just string your commands together using it instead of ; If at any time any of the programs fail, you will return without running the rest</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="20329""></a>
  <div class="note">
   <strong class="user">tonysb at gmx dot net</strong>
   <a href="#20329" class="date">30-Mar-2002 12:57</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
shell_exec is extremely useful as a substitute for the virtual() function where unavailable (Microsoft IIS for example). All you have to do is remove the content type string sent in the header:<br />
<br />
&lt;? <br />
$mstrng = shell_exec('yourcgiscript.cgi');<br />
$mstrng = ereg_replace( "Content-type: text/html", "", $mstrng );<br />
echo $mstrng;<br />
?&gt;<br />
<br />
This works fine for me as a substitute for SSI or the virtual() func.<br />
<br />
Anton Babadjanov<br />
<a href="http://www.vbcn.com.ar" rel="nofollow" target="_blank">http://www.vbcn.com.ar</a></span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
</div>
</div>
</div></div></body></html>
