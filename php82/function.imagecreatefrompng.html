<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
 <head>
  <meta http-equiv="content-type" content="text/html; CHARSET=UTF-8">
  <title>由文件或 URL 创建一个新图象。</title>
<link media="all" rel="stylesheet" type="text/css" href="styles/03e73060321a0a848018724a6c83de7f-theme-base.css" />
<link media="all" rel="stylesheet" type="text/css" href="styles/03e73060321a0a848018724a6c83de7f-theme-medium.css" />

  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <link media="all" rel="stylesheet" type="text/css" href="style.css"/>
 </head>
 <body class="docs" class="docs"><div class="navbar navbar-fixed-top">
  <div class="navbar-inner clearfix">
    <ul class="nav" style="width: 100%">
      <li style="float: left;"><a href="function.imagecreatefromjpeg.html">? imagecreatefromjpeg</a></li>
      <li style="float: right;"><a href="function.imagecreatefromstring.html">imagecreatefromstring ?</a></li>
    </ul>
  </div>
</div>
<div id="breadcrumbs" class="clearfix">
  <ul class="breadcrumbs-container">
    <li><a href="index.html">PHP Manual</a></li>
    <li><a href="ref.image.html">GD 和图像处理 函数</a></li>
    <li>由文件或 URL 创建一个新图象。</li>
  </ul>
</div>
<div id="layout">
  <div id="layout-content"><div id="function.imagecreatefrompng" class="refentry">
 <div class="refnamediv">
  <h1 class="refname">imagecreatefrompng</h1>
  <p class="verinfo">(PHP 4, PHP 5, PHP 7, PHP 8)</p><p class="refpurpose"><span class="refname">imagecreatefrompng</span> &mdash; <span class="dc-title">由文件或 URL 创建一个新图象。</span></p>

 </div>
 <div class="refsect1 description" id="refsect1-function.imagecreatefrompng-description">
  <h3 class="title">说明</h3>
  <div class="methodsynopsis dc-description">
   <span class="methodname"><strong>imagecreatefrompng</strong></span>(<span class="methodparam"><span class="type">string</span> <code class="parameter">$filename</code></span>): <span class="type"><span class="type"><a href="class.gdimage.html" class="type GdImage">GdImage</a></span>|<span class="type"><span class="type false">false</span></span></span></div>

  <p class="para rdfs-comment">
   <span class="function"><strong>imagecreatefrompng()</strong></span> 返回图像标识符，代表从指定文件名获得的图像。
  </p>
  <div class="tip"><strong class="tip">Tip</strong><p class="simpara">如已启用<a href="filesystem.configuration.html#ini.allow-url-fopen" class="link">fopen 包装器</a>，在此函数中， URL 可作为文件名。关于如何指定文件名详见 <span class="function"><a href="function.fopen.html" class="function">fopen()</a></span>。各种
wapper 的不同功能请参见 <a href="wrappers.html" class="xref">支持的协议和封装协议</a>，注意其用法及其可提供的预定义变量。</p></div>
 </div>

 <div class="refsect1 parameters" id="refsect1-function.imagecreatefrompng-parameters">
  <h3 class="title">参数</h3>
  <p class="para">
   <dl>
    
     <dt>
<code class="parameter">filename</code></dt>

     <dd>

      <p class="para">
       PNG 图像的路径。
      </p>
     </dd>

    
   </dl>

  </p>
 </div>

 <div class="refsect1 returnvalues" id="refsect1-function.imagecreatefrompng-returnvalues">
  <h3 class="title">返回值</h3>
  <p class="para">成功后返回图象对象,失败后返回 <strong><code>false</code></strong>。</p>
 </div>


 <div class="refsect1 changelog" id="refsect1-function.imagecreatefrompng-changelog">
  <h3 class="title">更新日志</h3>
  <table class="doctable informaltable">
   
    <thead>
     <tr>
      <th>版本</th>
      <th>说明</th>
     </tr>

    </thead>

    <tbody class="tbody">
     <tr>
      <td>8.0.0</td>
      <td>
       成功时，此函数现在返回 <span class="classname"><a href="class.gdimage.html" class="classname">GDImage</a></span> 实例；之前返回 <span class="type">resource</span>。
      </td>
     </tr>

    </tbody>
   
  </table>

 </div>


 <div class="refsect1 examples" id="refsect1-function.imagecreatefrompng-examples">
  <h3 class="title">示例</h3>
  <div class="example" id="example-5448">
   <p><strong>Example #1 在加载 PNG 期间处理错误的示例</strong></p>
   <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br /></span><span style="color: #007700">function </span><span style="color: #0000BB">LoadPNG</span><span style="color: #007700">(</span><span style="color: #0000BB">$imgname</span><span style="color: #007700">)<br />{<br />    </span><span style="color: #FF8000">/* Attempt to open */<br />    </span><span style="color: #0000BB">$im </span><span style="color: #007700">= @</span><span style="color: #0000BB">imagecreatefrompng</span><span style="color: #007700">(</span><span style="color: #0000BB">$imgname</span><span style="color: #007700">);<br /><br />    </span><span style="color: #FF8000">/* See if it failed */<br />    </span><span style="color: #007700">if(!</span><span style="color: #0000BB">$im</span><span style="color: #007700">)<br />    {<br />        </span><span style="color: #FF8000">/* Create a blank image */<br />        </span><span style="color: #0000BB">$im  </span><span style="color: #007700">= </span><span style="color: #0000BB">imagecreatetruecolor</span><span style="color: #007700">(</span><span style="color: #0000BB">150</span><span style="color: #007700">, </span><span style="color: #0000BB">30</span><span style="color: #007700">);<br />        </span><span style="color: #0000BB">$bgc </span><span style="color: #007700">= </span><span style="color: #0000BB">imagecolorallocate</span><span style="color: #007700">(</span><span style="color: #0000BB">$im</span><span style="color: #007700">, </span><span style="color: #0000BB">255</span><span style="color: #007700">, </span><span style="color: #0000BB">255</span><span style="color: #007700">, </span><span style="color: #0000BB">255</span><span style="color: #007700">);<br />        </span><span style="color: #0000BB">$tc  </span><span style="color: #007700">= </span><span style="color: #0000BB">imagecolorallocate</span><span style="color: #007700">(</span><span style="color: #0000BB">$im</span><span style="color: #007700">, </span><span style="color: #0000BB">0</span><span style="color: #007700">, </span><span style="color: #0000BB">0</span><span style="color: #007700">, </span><span style="color: #0000BB">0</span><span style="color: #007700">);<br /><br />        </span><span style="color: #0000BB">imagefilledrectangle</span><span style="color: #007700">(</span><span style="color: #0000BB">$im</span><span style="color: #007700">, </span><span style="color: #0000BB">0</span><span style="color: #007700">, </span><span style="color: #0000BB">0</span><span style="color: #007700">, </span><span style="color: #0000BB">150</span><span style="color: #007700">, </span><span style="color: #0000BB">30</span><span style="color: #007700">, </span><span style="color: #0000BB">$bgc</span><span style="color: #007700">);<br /><br />        </span><span style="color: #FF8000">/* Output an error message */<br />        </span><span style="color: #0000BB">imagestring</span><span style="color: #007700">(</span><span style="color: #0000BB">$im</span><span style="color: #007700">, </span><span style="color: #0000BB">1</span><span style="color: #007700">, </span><span style="color: #0000BB">5</span><span style="color: #007700">, </span><span style="color: #0000BB">5</span><span style="color: #007700">, </span><span style="color: #DD0000">'Error loading ' </span><span style="color: #007700">. </span><span style="color: #0000BB">$imgname</span><span style="color: #007700">, </span><span style="color: #0000BB">$tc</span><span style="color: #007700">);<br />    }<br /><br />    return </span><span style="color: #0000BB">$im</span><span style="color: #007700">;<br />}<br /><br /></span><span style="color: #0000BB">header</span><span style="color: #007700">(</span><span style="color: #DD0000">'Content-Type: image/png'</span><span style="color: #007700">);<br /><br /></span><span style="color: #0000BB">$img </span><span style="color: #007700">= </span><span style="color: #0000BB">LoadPNG</span><span style="color: #007700">(</span><span style="color: #DD0000">'bogus.image'</span><span style="color: #007700">);<br /><br /></span><span style="color: #0000BB">imagepng</span><span style="color: #007700">(</span><span style="color: #0000BB">$img</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">imagedestroy</span><span style="color: #007700">(</span><span style="color: #0000BB">$img</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
   </div>

   <div class="example-contents"><p>以上示例的输出类似于：</p></div>
   <div class="mediaobject">
    
    <div class="imageobject">
     <img src="images/21009b70229598c6a80eef8b45bf282b-imagecreatefrompng.png" alt="imagecreatefrompng() 示例" width="150" height="30" />
    </div>
   </div>
  </div>
 </div>

</div><div id="usernotes">
 <div class="head">
  <h3 class="title">User Contributed Notes</h3>
 </div>
<div id="allnotes">  <a name="126300""></a>
  <div class="note">
   <strong class="user">sageptr at gmail dot com</strong>
   <a href="#126300" class="date">02-Aug-2021 07:58</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Because gd and imagick do not support animated PNG (at this moment), i wrote a simple function to determine if given PNG is APNG or not. It does not validate PNG, only checks whenever "acTL" chunk appears before "IDAT" like the specification says: https://wiki.mozilla.org/APNG_Specification<br />
<br />
<span class="default">&lt;?php<br />
<br />
</span><span class="keyword">function </span><span class="default">is_apng</span><span class="keyword">(</span><span class="default">string $filename</span><span class="keyword">): </span><span class="default">bool<br />
</span><span class="keyword">{<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$f </span><span class="keyword">= new </span><span class="default">\SplFileObject</span><span class="keyword">(</span><span class="default">$filename</span><span class="keyword">, </span><span class="string">'rb'</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$header </span><span class="keyword">= </span><span class="default">$f</span><span class="keyword">-&gt;</span><span class="default">fread</span><span class="keyword">(</span><span class="default">8</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; if (</span><span class="default">$header </span><span class="keyword">!== </span><span class="string">"\x89PNG\r\n\x1A\n"</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">false</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; while (!</span><span class="default">$f</span><span class="keyword">-&gt;</span><span class="default">eof</span><span class="keyword">()) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$bytes </span><span class="keyword">=&nbsp; </span><span class="default">$f</span><span class="keyword">-&gt;</span><span class="default">fread</span><span class="keyword">(</span><span class="default">4</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$bytes</span><span class="keyword">) &lt; </span><span class="default">4</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">false</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$length </span><span class="keyword">= </span><span class="default">unpack</span><span class="keyword">(</span><span class="string">'N'</span><span class="keyword">, </span><span class="default">$bytes</span><span class="keyword">)[</span><span class="default">1</span><span class="keyword">];<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$chunkname </span><span class="keyword">= </span><span class="default">$f</span><span class="keyword">-&gt;</span><span class="default">fread</span><span class="keyword">(</span><span class="default">4</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; switch (</span><span class="default">$chunkname</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="string">'acTL'</span><span class="keyword">:<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">true</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="string">'IDAT'</span><span class="keyword">:<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">false</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$f</span><span class="keyword">-&gt;</span><span class="default">fseek</span><span class="keyword">(</span><span class="default">$length </span><span class="keyword">+ </span><span class="default">4</span><span class="keyword">, </span><span class="default">SEEK_CUR</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">false</span><span class="keyword">;<br />
}<br />
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="121768""></a>
  <div class="note">
   <strong class="user">katalin at knittedforyou dot com</strong>
   <a href="#121768" class="date">17-Oct-2017 04:45</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I have this code: <br />
<br />
if (exif_imagetype($this-&gt;img_name) == IMAGETYPE_PNG) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; try {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $this-&gt;image = imagecreatefrompng($this-&gt;img_name);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; Error::log('It is a png: '.$this-&gt;img_name);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; } catch (Exception $e) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; echo "The image file has some strange charachters. Probably not a png image?";<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $this-&gt;image = '';<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $this-&gt;img_name = '';<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
<br />
And I get this error in the error.log: <br />
PHP Unknown error:&nbsp; imagecreatefrompng(): gd-png: fatal libpng error: Extra compressed data\n in Unknown on line 0<br />
<br />
The file that I try to open is a generated .png image which I can open from gimp and Geeqie. <br />
<br />
What is the problem? Could you please help me?</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="118146""></a>
  <div class="note">
   <strong class="user">Cyrille37</strong>
   <a href="#118146" class="date">13-Oct-2015 11:00</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
The image size (width x height) should not exceed INT_MAX ... It's still thrue on a 64 bits computer.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="90364""></a>
  <div class="note">
   <strong class="user">admin at wdfa dot co dot uk</strong>
   <a href="#90364" class="date">17-Apr-2009 03:06</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
When using imagecreatepng with alpha blending you will lose the blending.<br />
<br />
To over come this use something like the following<br />
<span class="default">&lt;?php<br />
$dstimage</span><span class="keyword">=</span><span class="default">imagecreatetruecolor</span><span class="keyword">(</span><span class="default">$width</span><span class="keyword">,</span><span class="default">$height</span><span class="keyword">);<br />
</span><span class="default">$srcimage</span><span class="keyword">=</span><span class="default">imagecreatefrompng</span><span class="keyword">(</span><span class="default">$src</span><span class="keyword">);<br />
</span><span class="default">imagecopyresampled</span><span class="keyword">(</span><span class="default">$dstimage</span><span class="keyword">,</span><span class="default">$srcimage</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">, </span><span class="default">$width</span><span class="keyword">,</span><span class="default">$height</span><span class="keyword">,</span><span class="default">$width</span><span class="keyword">,</span><span class="default">$height</span><span class="keyword">);<br />
</span><span class="default">?&gt;<br />
</span>Where $width and $height are the width and height of the $src image.<br />
<br />
This will create a true colour image then copy the png image to this true colour image and retain alpha blending.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="73546""></a>
  <div class="note">
   <strong class="user">marcos at assl-site dot net</strong>
   <a href="#73546" class="date">28-Feb-2007 12:23</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I had the same problem as jboyd1189 at yahoo dot com but I solve d it allocating more memory dynamically.<br />
<br />
Usually the memory_limit var on php.ini is set to 8M. Unfortunately, the required amount of memory to manage a PNG image about 1000x1000 could be bigger !<br />
<br />
The approach I used to solve the problem is:<br />
<br />
1-Calculate the memory required by the image<br />
2-Set the new memory_limit value <br />
3-Create the PNG image and thumbnail<br />
4-Restore the original value<br />
<br />
1-The following value works for me:<br />
$required_memory = Round($width * $height * $size['bits']);<br />
<br />
Note that for JPEG the requirements are not the same:<br />
<a href="http://es2.php.net/manual/en/function.imagecreatefromjpeg.php#60241" rel="nofollow" target="_blank">http://es2.php.net/manual/en/function.imagecreatefromjpeg.php#60241</a><br />
<br />
2-Use somthing like: <br />
$new_limit=memory_get_usage() + $required_memory;<br />
ini_set("memory_limit", $new_limit);<br />
<br />
4-ini_restore ("memory_limit");</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="67854""></a>
  <div class="note">
   <strong class="user">jboyd1189 at yahoo dot com</strong>
   <a href="#67854" class="date">05-Jul-2006 02:49</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I was having a terrible time with the imagecreatefrompng function as it was working perfectly for one image and not at all for another.&nbsp; After many hours of frustration, I discovered that the problem was the image size (number of pixels).&nbsp; It appears that the maximum number of pixels this function will process is 1,040,000.&nbsp; So, be sure that the pixel resolution of the image (eg. 1040 x 1000) does not exceed this value.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="43024""></a>
  <div class="note">
   
   <a href="#43024" class="date">07-Jun-2004 04:14</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you're trying to load a translucent png-24 image but are finding an absence of transparency (like it's black), you need to enable alpha channel AND save the setting. I'm new to GD and it took me almost two hours to figure this out.<br />
<br />
<span class="default">&lt;?php<br />
$imgPng </span><span class="keyword">= </span><span class="default">imageCreateFromPng</span><span class="keyword">(</span><span class="default">$strImagePath</span><span class="keyword">);<br />
</span><span class="default">imageAlphaBlending</span><span class="keyword">(</span><span class="default">$imgPng</span><span class="keyword">, </span><span class="default">true</span><span class="keyword">);<br />
</span><span class="default">imageSaveAlpha</span><span class="keyword">(</span><span class="default">$imgPng</span><span class="keyword">, </span><span class="default">true</span><span class="keyword">);<br />
<br />
</span><span class="comment">/* Output image to browser */<br />
</span><span class="default">header</span><span class="keyword">(</span><span class="string">"Content-type: image/png"</span><span class="keyword">);<br />
</span><span class="default">imagePng</span><span class="keyword">(</span><span class="default">$imgPng</span><span class="keyword">); <br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
</div>
</div>
</div></div></body></html>
