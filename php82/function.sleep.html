<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
 <head>
  <meta http-equiv="content-type" content="text/html; CHARSET=UTF-8">
  <title>延缓执行</title>
<link media="all" rel="stylesheet" type="text/css" href="styles/03e73060321a0a848018724a6c83de7f-theme-base.css" />
<link media="all" rel="stylesheet" type="text/css" href="styles/03e73060321a0a848018724a6c83de7f-theme-medium.css" />

  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <link media="all" rel="stylesheet" type="text/css" href="style.css"/>
 </head>
 <body class="docs" class="docs"><div class="navbar navbar-fixed-top">
  <div class="navbar-inner clearfix">
    <ul class="nav" style="width: 100%">
      <li style="float: left;"><a href="function.show-source.html">? show_source</a></li>
      <li style="float: right;"><a href="function.sys-getloadavg.html">sys_getloadavg ?</a></li>
    </ul>
  </div>
</div>
<div id="breadcrumbs" class="clearfix">
  <ul class="breadcrumbs-container">
    <li><a href="index.html">PHP Manual</a></li>
    <li><a href="ref.misc.html">杂项 函数</a></li>
    <li>延缓执行</li>
  </ul>
</div>
<div id="layout">
  <div id="layout-content"><div id="function.sleep" class="refentry">
 <div class="refnamediv">
  <h1 class="refname">sleep</h1>
  <p class="verinfo">(PHP 4, PHP 5, PHP 7, PHP 8)</p><p class="refpurpose"><span class="refname">sleep</span> &mdash; <span class="dc-title">延缓执行</span></p>

 </div>
 
 <div class="refsect1 description" id="refsect1-function.sleep-description">
  <h3 class="title">说明</h3>
  <div class="methodsynopsis dc-description">
   <span class="methodname"><strong>sleep</strong></span>(<span class="methodparam"><span class="type">int</span> <code class="parameter">$seconds</code></span>): <span class="type">int</span></div>

  <p class="simpara">
   程序延迟执行指定的 <code class="parameter">seconds</code> 的秒数。
  </p>
  <blockquote class="note"><p><strong class="note">Note</strong>: 
   <p class="para">
    为了让程序执行延迟几分之一秒，应使用 <span class="function"><a href="function.usleep.html" class="function">usleep()</a></span>，因为 <span class="function"><strong>sleep()</strong></span>
    需要 <span class="type">int</span>。例如 <code class="code">sleep(0.25)</code> 会使程序暂停 <code class="literal">0</code> 秒。
   </p>
  </p></blockquote>
 </div>


 <div class="refsect1 parameters" id="refsect1-function.sleep-parameters">
  <h3 class="title">参数</h3>
  <p class="para">
   <dl>
    
     <dt>
<code class="parameter">seconds</code></dt>

     <dd>

      <p class="para">
       暂停的秒数（必须大于或等于 <code class="literal">0</code>）。
      </p>
     </dd>

    
   </dl>

  </p>
 </div>


 <div class="refsect1 returnvalues" id="refsect1-function.sleep-returnvalues">
  <h3 class="title">返回值</h3>
  <p class="para">
   成功时返回 0。
  </p>
  <p class="para">
   如果函数的调用被一个信号中止，<span class="function"><strong>sleep()</strong></span> 会返回一个非零的值。在
   Windows 上，该值总是 <code class="literal">192</code>（即 Windows API 常量
   <strong><code>WAIT_IO_COMPLETION</code></strong> 的值）。其他平台上，该返回值是剩余未 sleep 的秒数。
  </p>
 </div>


 <div class="refsect1 errors" id="refsect1-function.sleep-errors">
  <h3 class="title">错误／异常</h3>
  <p class="para">
   如果指定的 <code class="parameter">seconds</code> 是负数，该函数会抛出 <span class="classname"><a href="class.valueerror.html" class="classname">ValueError</a></span>。
  </p>
 </div>


 <div class="refsect1 changelog" id="refsect1-function.sleep-changelog">
  <h3 class="title">更新日志</h3>
  <table class="doctable informaltable">
   
    <thead>
     <tr>
      <th>版本</th>
      <th>说明</th>
     </tr>

    </thead>

    <tbody class="tbody">
     <tr>
      <td>8.0.0</td>
      <td>
       此函数在负数 <code class="parameter">seconds</code> 时抛出 <span class="classname"><a href="class.valueerror.html" class="classname">ValueError</a></span>，之前会引发
       <strong><code>E_WARNING</code></strong> 且函数返回 <strong><code>false</code></strong>。
      </td>
     </tr>

    </tbody>
   
  </table>

 </div>


 <div class="refsect1 examples" id="refsect1-function.sleep-examples">
  <h3 class="title">示例</h3>
  <p class="para">
   <div class="example" id="">
    <p><strong>Example #1 <span class="function"><strong>sleep()</strong></span> 示例</strong></p>
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br /><br /></span><span style="color: #FF8000">// 当前时间<br /></span><span style="color: #007700">echo </span><span style="color: #0000BB">date</span><span style="color: #007700">(</span><span style="color: #DD0000">'h:i:s'</span><span style="color: #007700">) . </span><span style="color: #DD0000">"\n"</span><span style="color: #007700">;<br /><br /></span><span style="color: #FF8000">// 睡眠 10 秒<br /></span><span style="color: #0000BB">sleep</span><span style="color: #007700">(</span><span style="color: #0000BB">10</span><span style="color: #007700">);<br /><br /></span><span style="color: #FF8000">// 醒来！<br /></span><span style="color: #007700">echo </span><span style="color: #0000BB">date</span><span style="color: #007700">(</span><span style="color: #DD0000">'h:i:s'</span><span style="color: #007700">) . </span><span style="color: #DD0000">"\n"</span><span style="color: #007700">;<br /><br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
    </div>

    <div class="example-contents"><p>
     该例子会在休眠10秒后输出。
    </p></div>
    <div class="example-contents screen">
<div class="cdata"><pre>
05:31:23
05:31:33
</pre></div>
    </div>
   </div>
  </p>
 </div>


 <div class="refsect1 seealso" id="refsect1-function.sleep-seealso">
  <h3 class="title">参见</h3>
  <p class="para">
   <ul class="simplelist">
    <li class="member"><span class="function"><a href="function.usleep.html" class="function" rel="rdfs-seeAlso">usleep()</a> - 以指定的微秒数延迟执行</span></li>
    <li class="member"><span class="function"><a href="function.time-nanosleep.html" class="function" rel="rdfs-seeAlso">time_nanosleep()</a> - 延缓执行若干秒和纳秒</span></li>
    <li class="member"><span class="function"><a href="function.time-sleep-until.html" class="function" rel="rdfs-seeAlso">time_sleep_until()</a> - 使脚本睡眠到指定的时间为止</span></li>
    <li class="member"><span class="function"><a href="function.set-time-limit.html" class="function" rel="rdfs-seeAlso">set_time_limit()</a> - 设置脚本最大执行时间</span></li>
   </ul>
  </p>
 </div>


</div><div id="usernotes">
 <div class="head">
  <h3 class="title">User Contributed Notes</h3>
 </div>
<div id="allnotes">  <a name="127652""></a>
  <div class="note">
   <strong class="user">ealexs at gmail dot com</strong>
   <a href="#127652" class="date">20-Sep-2022 08:29</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
From my testing calling sleep(0); will do a `thread spin`.<br />
It would be nice if this was to be put explicitly in the documentation as it is useful. You can do the minimum wait without overloading the CPU thread.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="126400""></a>
  <div class="note">
   <strong class="user">Anonymous</strong>
   <a href="#126400" class="date">08-Sep-2021 08:08</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I wrote a simple method for sleeping with a float, which also allows you to do milliseconds (via fractional seconds).<br />
<br />
<span class="default">&lt;?php<br />
&nbsp; </span><span class="keyword">function </span><span class="default">sleepFloatSecs</span><span class="keyword">(</span><span class="default">$secs</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$intSecs </span><span class="keyword">= </span><span class="default">intval</span><span class="keyword">(</span><span class="default">$secs</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$microSecs </span><span class="keyword">= (</span><span class="default">$secs </span><span class="keyword">- </span><span class="default">$intSecs</span><span class="keyword">) * </span><span class="default">1000000</span><span class="keyword">;<br />
<br />
&nbsp;&nbsp;&nbsp; if(</span><span class="default">$intSecs </span><span class="keyword">&gt; </span><span class="default">0</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">sleep</span><span class="keyword">(</span><span class="default">$intSecs</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; if(</span><span class="default">$microSecs </span><span class="keyword">&gt; </span><span class="default">0</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">usleep</span><span class="keyword">(</span><span class="default">$microSecs</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp; }<br />
</span><span class="default">?&gt;<br />
</span><br />
And testing on my machine it works perfectly:<br />
<br />
<span class="default">&lt;?php<br />
&nbsp; $x </span><span class="keyword">= [</span><span class="default">0.100</span><span class="keyword">,</span><span class="default">0.250</span><span class="keyword">,</span><span class="default">0.5</span><span class="keyword">,</span><span class="default">1.0</span><span class="keyword">,</span><span class="default">1.5</span><span class="keyword">,</span><span class="default">2.0</span><span class="keyword">,</span><span class="default">2.5</span><span class="keyword">];<br />
<br />
&nbsp; foreach(</span><span class="default">$x </span><span class="keyword">as </span><span class="default">$secs</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$t </span><span class="keyword">= </span><span class="default">microtime</span><span class="keyword">(</span><span class="default">true</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">sleepFloatSecs</span><span class="keyword">(</span><span class="default">$secs</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$t </span><span class="keyword">= </span><span class="default">microtime</span><span class="keyword">(</span><span class="default">true</span><span class="keyword">) - </span><span class="default">$t</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; echo </span><span class="string">"</span><span class="default">$secs</span><span class="string"> \t =&gt; \t </span><span class="default">$t</span><span class="string">\n"</span><span class="keyword">;<br />
&nbsp; }<br />
</span><span class="default">?&gt;<br />
</span><br />
Output:<br />
<br />
<span class="default">&lt;?php<br />
&nbsp; 0.1&nbsp; &nbsp;&nbsp; </span><span class="keyword">=&gt;&nbsp; &nbsp; </span><span class="default">0.10017800331116<br />
&nbsp; 0.25&nbsp; &nbsp; </span><span class="keyword">=&gt;&nbsp; &nbsp; </span><span class="default">0.25016593933105<br />
&nbsp; 0.5&nbsp; &nbsp;&nbsp; </span><span class="keyword">=&gt;&nbsp; &nbsp; </span><span class="default">0.50015211105347<br />
&nbsp; 1&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">=&gt;&nbsp; &nbsp; </span><span class="default">1.0001430511475<br />
&nbsp; 1.5&nbsp; &nbsp;&nbsp; </span><span class="keyword">=&gt;&nbsp; &nbsp; </span><span class="default">1.5003218650818<br />
&nbsp; 2&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">=&gt;&nbsp; &nbsp; </span><span class="default">2.000167131424<br />
&nbsp; 2.5&nbsp; &nbsp;&nbsp; </span><span class="keyword">=&gt;&nbsp; &nbsp; </span><span class="default">2.5002470016479<br />
?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="125982""></a>
  <div class="note">
   <strong class="user">manu7772 at gmail dot com</strong>
   <a href="#125982" class="date">03-Apr-2021 06:31</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Sleep method with parameter in milliseconds :<br />
<br />
public static function ms_sleep($milliseconds = 0) {<br />
&nbsp;&nbsp;&nbsp; if($milliseconds &gt; 0) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $test = $milliseconds / 1000;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $seconds = floor($test);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $micro = round(($test - $seconds) * 1000000);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if($seconds &gt; 0) sleep($seconds);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if($micro &gt; 0) usleep($micro);<br />
&nbsp;&nbsp;&nbsp; }<br />
}</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="125934""></a>
  <div class="note">
   <strong class="user">smcbride at msn dot com</strong>
   <a href="#125934" class="date">15-Mar-2021 08:55</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
An example of using sleep to run a set of functions at different intervals.&nbsp; This is not a replacement for multi-threading, but it could help someone that wants to do something cheap.&nbsp; You don't have to use eval().&nbsp; It is just used as an example.&nbsp; This is different than running a standard 1 second sleep loop, due to sleeping longer does not consume as much CPU.<br />
<br />
<span class="default">&lt;?php<br />
<br />
</span><span class="comment">// current time<br />
</span><span class="keyword">echo </span><span class="default">date</span><span class="keyword">(</span><span class="string">'h:i:s'</span><span class="keyword">) . </span><span class="string">"\n"</span><span class="keyword">;<br />
<br />
</span><span class="comment">// Some example functions<br />
</span><span class="keyword">function </span><span class="default">function_a</span><span class="keyword">() { echo </span><span class="string">'function_a called @ ' </span><span class="keyword">. </span><span class="default">date</span><span class="keyword">(</span><span class="string">'h:i:s'</span><span class="keyword">) . </span><span class="default">PHP_EOL</span><span class="keyword">; }<br />
function </span><span class="default">function_b</span><span class="keyword">() { echo </span><span class="string">'function_b called @ ' </span><span class="keyword">. </span><span class="default">date</span><span class="keyword">(</span><span class="string">'h:i:s'</span><span class="keyword">) . </span><span class="default">PHP_EOL</span><span class="keyword">; }<br />
function </span><span class="default">function_c</span><span class="keyword">() { echo </span><span class="string">'function_c called @ ' </span><span class="keyword">. </span><span class="default">date</span><span class="keyword">(</span><span class="string">'h:i:s'</span><span class="keyword">) . </span><span class="default">PHP_EOL</span><span class="keyword">; }<br />
<br />
</span><span class="comment">// Add some timers (in seconds) with function calls<br />
</span><span class="default">$sleeptimers </span><span class="keyword">= array();<br />
</span><span class="default">$sleeptimers</span><span class="keyword">[</span><span class="string">'5'</span><span class="keyword">][</span><span class="default">0</span><span class="keyword">][</span><span class="string">'func'</span><span class="keyword">] = </span><span class="string">'function_a();'</span><span class="keyword">;<br />
</span><span class="default">$sleeptimers</span><span class="keyword">[</span><span class="string">'10'</span><span class="keyword">][</span><span class="default">0</span><span class="keyword">][</span><span class="string">'func'</span><span class="keyword">] = </span><span class="string">'function_b();'</span><span class="keyword">;<br />
</span><span class="default">$sleeptimers</span><span class="keyword">[</span><span class="string">'15'</span><span class="keyword">][</span><span class="default">0</span><span class="keyword">][</span><span class="string">'func'</span><span class="keyword">] = </span><span class="string">'function_c();'</span><span class="keyword">;<br />
<br />
</span><span class="comment">// Process the timers<br />
</span><span class="keyword">while(</span><span class="default">true</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$currenttime </span><span class="keyword">= </span><span class="default">time</span><span class="keyword">();<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">reset</span><span class="keyword">(</span><span class="default">$sleeptimers</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$mintime </span><span class="keyword">= </span><span class="default">key</span><span class="keyword">(</span><span class="default">$sleeptimers</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; foreach(</span><span class="default">$sleeptimers </span><span class="keyword">as </span><span class="default">$SleepTime </span><span class="keyword">=&gt; </span><span class="default">$Jobs</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; foreach(</span><span class="default">$Jobs </span><span class="keyword">as </span><span class="default">$JobIndex </span><span class="keyword">=&gt; </span><span class="default">$JobDetail</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if(!isset(</span><span class="default">$JobDetail</span><span class="keyword">[</span><span class="string">'lastrun'</span><span class="keyword">])) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$sleeptimers</span><span class="keyword">[</span><span class="default">$SleepTime</span><span class="keyword">][</span><span class="default">$JobIndex</span><span class="keyword">][</span><span class="string">'lastrun'</span><span class="keyword">] = </span><span class="default">time</span><span class="keyword">();<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">$SleepTime </span><span class="keyword">&lt; </span><span class="default">$mintime</span><span class="keyword">) </span><span class="default">$mintime </span><span class="keyword">= </span><span class="default">$SleepTime</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; } elseif((</span><span class="default">$currenttime </span><span class="keyword">- </span><span class="default">$JobDetail</span><span class="keyword">[</span><span class="string">'lastrun'</span><span class="keyword">]) &gt;= </span><span class="default">$SleepTime</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; eval(</span><span class="default">$JobDetail</span><span class="keyword">[</span><span class="string">'func'</span><span class="keyword">]);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$lastrun </span><span class="keyword">= </span><span class="default">time</span><span class="keyword">();<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$sleeptimers</span><span class="keyword">[</span><span class="default">$SleepTime</span><span class="keyword">][</span><span class="default">$JobIndex</span><span class="keyword">][</span><span class="string">'lastrun'</span><span class="keyword">] = </span><span class="default">$lastrun</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$mysleeptime </span><span class="keyword">= </span><span class="default">$SleepTime </span><span class="keyword">- (</span><span class="default">$currenttime </span><span class="keyword">- </span><span class="default">$lastrun</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">$mysleeptime </span><span class="keyword">&lt; </span><span class="default">0</span><span class="keyword">) </span><span class="default">$mysleeptime </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if((</span><span class="default">$currenttime </span><span class="keyword">- </span><span class="default">$JobDetail</span><span class="keyword">[</span><span class="string">'lastrun'</span><span class="keyword">]) &lt; </span><span class="default">$mintime</span><span class="keyword">) </span><span class="default">$mintime </span><span class="keyword">= </span><span class="default">$mysleeptime</span><span class="keyword">;&nbsp; </span><span class="comment">// account for length of time function runs<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">echo </span><span class="string">'Sleep time for function ' </span><span class="keyword">. </span><span class="default">$JobDetail</span><span class="keyword">[</span><span class="string">'func'</span><span class="keyword">] . </span><span class="string">' = ' </span><span class="keyword">. </span><span class="default">$mysleeptime </span><span class="keyword">. </span><span class="default">PHP_EOL</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; echo </span><span class="string">'Sleeping for ' </span><span class="keyword">. </span><span class="default">$mintime </span><span class="keyword">. </span><span class="string">' seconds' </span><span class="keyword">. </span><span class="default">PHP_EOL</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">sleep</span><span class="keyword">(</span><span class="default">$mintime</span><span class="keyword">);<br />
}<br />
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="122848""></a>
  <div class="note">
   <strong class="user">Anonymous</strong>
   <a href="#122848" class="date">17-Jun-2018 10:18</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Diego Andrade's msleep function is not compatible with php7's `strict_types`, cast the usleep parameter to int, and it will be, <br />
&nbsp;usleep((int)($time * 1000000));</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="119248""></a>
  <div class="note">
   <strong class="user">sergio at inbep dot com dot br</strong>
   <a href="#119248" class="date">26-Apr-2016 05:27</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
To use float or int numbers<br />
<br />
function pause($seconds)<br />
{<br />
&nbsp;&nbsp;&nbsp; usleep($seconds * 1000000);<br />
}<br />
<br />
pause(0.25);</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="118635""></a>
  <div class="note">
   <strong class="user">Diego Andrade</strong>
   <a href="#118635" class="date">13-Jan-2016 06:29</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Maybe obvious, but this my function to delay script execution using decimals for seconds (to mimic sleep(1.5) for example):<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="comment">/**<br />
&nbsp;* Delays execution of the script by the given time.<br />
&nbsp;* @param mixed $time Time to pause script execution. Can be expressed<br />
&nbsp;* as an integer or a decimal.<br />
&nbsp;* @example msleep(1.5); // delay for 1.5 seconds<br />
&nbsp;* @example msleep(.1); // delay for 100 milliseconds<br />
&nbsp;*/<br />
</span><span class="keyword">function </span><span class="default">msleep</span><span class="keyword">(</span><span class="default">$time</span><span class="keyword">)<br />
{<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">usleep</span><span class="keyword">(</span><span class="default">$time </span><span class="keyword">* </span><span class="default">1000000</span><span class="keyword">);<br />
}<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="114841""></a>
  <div class="note">
   <strong class="user">ash b</strong>
   <a href="#114841" class="date">13-Apr-2014 09:56</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
re: "mitigating the chances of a full bruit force attack by a limit of 30 lookups a minute."<br />
<br />
Not really - the attacker could do 100 requests. Each request might take 2 seconds but it doesn't stop the number of requests done. You need to stop processing more than one request every 2 seconds rather than delay it by 2 seconds on each execution.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="114588""></a>
  <div class="note">
   <strong class="user">Anonymous</strong>
   <a href="#114588" class="date">10-Mar-2014 06:35</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you are having issues with sleep() and usleep() not responding as you feel they should, take a look at session_write_close()<br />
<br />
as noted by anonymous on comments;<br />
"If the ajax function doesn't do session_write_close(), then your outer page will appear to hang, and opening other pages in new tabs will also stall."</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="113292""></a>
  <div class="note">
   <strong class="user">LVT</strong>
   <a href="#113292" class="date">22-Sep-2013 04:13</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Another reason for not to abuse sleep( ) is that along with the maximum of 30 sql connections, a shared hosting environment usually limits the number of processes to 20, if your website has many users online and you put sleep( ) everywhere in the code, your server will throw a 508 error (resource limit reached) and will stop serving your website.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="113227""></a>
  <div class="note">
   <strong class="user">LVT</strong>
   <a href="#113227" class="date">15-Sep-2013 10:12</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Always close your SQL connection and free the memory before using sleep( ) or you will be needlessly holding a SQL connection for [xx] seconds, remember that a shared hosting environment only allows max 30 SQL connections at the same time.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="110378""></a>
  <div class="note">
   <strong class="user">joshmeister at gmail dot com</strong>
   <a href="#110378" class="date">16-Oct-2012 10:51</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Here is a simplified way to flush output to browser before completing sleep cycle.&nbsp; Note the buffer must be "filled" with 4096 characters (bytes?) for ob_flush() to work before sleep() occurs.<br />
<span class="default">&lt;?php <br />
&nbsp;ob_implicit_flush</span><span class="keyword">(</span><span class="default">true</span><span class="keyword">);<br />
&nbsp;</span><span class="default">$buffer </span><span class="keyword">= </span><span class="default">str_repeat</span><span class="keyword">(</span><span class="string">" "</span><span class="keyword">, </span><span class="default">4096</span><span class="keyword">);<br />
&nbsp;echo </span><span class="string">"see this immediately.&lt;br&gt;"</span><span class="keyword">;<br />
&nbsp;echo </span><span class="default">$buffer</span><span class="keyword">;<br />
&nbsp;</span><span class="default">ob_flush</span><span class="keyword">();<br />
&nbsp;</span><span class="default">sleep</span><span class="keyword">(</span><span class="default">5</span><span class="keyword">);<br />
&nbsp;echo </span><span class="string">"some time has passed"</span><span class="keyword">;<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="105903""></a>
  <div class="note">
   <strong class="user">barlow at fhtsolutions dot com</strong>
   <a href="#105903" class="date">24-Sep-2011 06:33</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
You should put sleep into both the pass and fail branches, since an attacker can check whether the response is slow and use that as an indicator - cutting down the delay time. But a delay in both branches eliminates this possibility.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="105149""></a>
  <div class="note">
   <strong class="user">code {@} ashleyhunt [dot] co [dot] uk</strong>
   <a href="#105149" class="date">30-Jul-2011 06:31</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
A really simple, but effective way of majorly slowing down bruit force attacks on wrong password attempts.<br />
<br />
In my example below, if the end-user gets the password correct, they get to log in at full speed, as expected. For every incorrect password attempt, the users response is delayed by 2 seconds each time; mitigating the chances of a full bruit force attack by a limit of 30 lookups a minute.<br />
<br />
I hope this very simple approach will help make your web applications that little bit more secure.<br />
<br />
Ashley<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">public function </span><span class="default">handle_login</span><span class="keyword">() {<br />
&nbsp;&nbsp;&nbsp; if(</span><span class="default">$uid </span><span class="keyword">= </span><span class="default">user</span><span class="keyword">::</span><span class="default">check_password</span><span class="keyword">(</span><span class="default">$_REQUEST</span><span class="keyword">[</span><span class="string">'email'</span><span class="keyword">], </span><span class="default">$_REQUEST</span><span class="keyword">[</span><span class="string">'password'</span><span class="keyword">])) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">self</span><span class="keyword">::</span><span class="default">authenticate_user</span><span class="keyword">(</span><span class="default">$uid</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; else {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// delay failed output by 2 seconds<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; // to prevent bruit force attacks<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">sleep</span><span class="keyword">(</span><span class="default">2</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">self</span><span class="keyword">::</span><span class="default">login_failed</span><span class="keyword">();<br />
&nbsp;&nbsp;&nbsp; }<br />
}<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="99445""></a>
  <div class="note">
   <strong class="user">soulhunter1987 at post dot ru</strong>
   <a href="#99445" class="date">18-Aug-2010 12:49</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Since sleep() can be interrupted by signals i've made a function which can also be interrupted, but will continue sleeping after the signal arrived (and possibly was handled by callback). It's very useful when you write daemons and need sleep() function to work as long as you 'ordered', but have an ability to accept signals during sleeping.
<br />

<br />
<span class="default">&lt;?php
<br />
</span><span class="keyword">function </span><span class="default">my_sleep</span><span class="keyword">(</span><span class="default">$seconds</span><span class="keyword">)
<br />
{
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$start </span><span class="keyword">= </span><span class="default">microtime</span><span class="keyword">(</span><span class="default">true</span><span class="keyword">);
<br />
&nbsp;&nbsp;&nbsp; for (</span><span class="default">$i </span><span class="keyword">= </span><span class="default">1</span><span class="keyword">; </span><span class="default">$i </span><span class="keyword">&lt;= </span><span class="default">$seconds</span><span class="keyword">; </span><span class="default">$i </span><span class="keyword">++) {
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; @</span><span class="default">time_sleep_until</span><span class="keyword">(</span><span class="default">$start </span><span class="keyword">+ </span><span class="default">$i</span><span class="keyword">);
<br />
&nbsp;&nbsp;&nbsp; }
<br />
}
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="97809""></a>
  <div class="note">
   <strong class="user">toddjt78 at msn dot com</strong>
   <a href="#97809" class="date">09-May-2010 07:39</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Simple function to report the microtime since last called or the microtime since first called.
<br />

<br />
<span class="default">&lt;?php
<br />
</span><span class="keyword">function </span><span class="default">stopWatch</span><span class="keyword">(</span><span class="default">$total </span><span class="keyword">= </span><span class="default">false</span><span class="keyword">,</span><span class="default">$reset </span><span class="keyword">= </span><span class="default">true</span><span class="keyword">){
<br />
&nbsp;&nbsp;&nbsp; global </span><span class="default">$first_called</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; global </span><span class="default">$last_called</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$now_time </span><span class="keyword">= </span><span class="default">microtime</span><span class="keyword">(</span><span class="default">true</span><span class="keyword">);
<br />
&nbsp;&nbsp;&nbsp; if (</span><span class="default">$last_called </span><span class="keyword">=== </span><span class="default">null</span><span class="keyword">) {
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$last_called </span><span class="keyword">= </span><span class="default">$now_time</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$first_called </span><span class="keyword">= </span><span class="default">$now_time</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; }
<br />
&nbsp;&nbsp;&nbsp; if (</span><span class="default">$total</span><span class="keyword">) {
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$time_diff </span><span class="keyword">= </span><span class="default">$now_time </span><span class="keyword">- </span><span class="default">$first_called</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; } else {
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$time_diff </span><span class="keyword">= </span><span class="default">$now_time </span><span class="keyword">- </span><span class="default">$last_called</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; }
<br />
&nbsp;&nbsp;&nbsp; if (</span><span class="default">$reset</span><span class="keyword">)
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$last_called </span><span class="keyword">= </span><span class="default">$now_time</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">$time_diff</span><span class="keyword">;
<br />
}
<br />
</span><span class="default">?&gt;
<br />
</span>
<br />
$reset&nbsp; - if true, resets the last_called value to now
<br />
$total - if true, returns the time since first called otherwise returns the time since last called</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="96592""></a>
  <div class="note">
   <strong class="user">jimmy at powerzone dot dk</strong>
   <a href="#96592" class="date">06-Mar-2010 08:26</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Notice that sleep() delays execution for the current session, not just the script. Consider the following sample, where two computers invoke the same script from a browser, which doesn't do anything but sleep.
<br />

<br />
PC 1 [started 14:00:00]: script.php?sleep=10 // Will stop after 10 secs
<br />
PC 1 [started 14:00:03]: script.php?sleep=0 // Will stop after 7 secs
<br />

<br />
PC 2 [started 14:00:05]: script.php?sleep=0 // Will stop immediately
<br />

<br />
<a href="http://php.net/session_write_close may be used to address this problem." rel="nofollow" target="_blank">http://php.net/session_write_close may be used to address this problem.</a></span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="95164""></a>
  <div class="note">
   <strong class="user">mohd at Bahrain dot Bz</strong>
   <a href="#95164" class="date">16-Dec-2009 01:12</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I hope this code will help somebody to solve the problem of not being able to flush or output the buffer to the browser (I use IE7).<br />
It may work for you with just [ echo str_repeat(".", 4096); ] and without even using ob_... and flush.<br />
<br />
<span class="default">&lt;?php<br />
ob_start</span><span class="keyword">();<br />
<br />
</span><span class="default">ob_implicit_flush</span><span class="keyword">(</span><span class="default">true</span><span class="keyword">);<br />
</span><span class="comment">//[ OR ] echo "..."; ob_flush(); flush();<br />
<br />
</span><span class="default">set_time_limit</span><span class="keyword">(</span><span class="default">0</span><span class="keyword">);<br />
<br />
function </span><span class="default">sleep_echo</span><span class="keyword">(</span><span class="default">$secs</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$secs </span><span class="keyword">= (int) </span><span class="default">$secs</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$buffer </span><span class="keyword">= </span><span class="default">str_repeat</span><span class="keyword">(</span><span class="string">"."</span><span class="keyword">, </span><span class="default">4096</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">//echo $buffer."\r\n&lt;br /&gt;\r\n";<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">for (</span><span class="default">$i</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">; </span><span class="default">$i</span><span class="keyword">&lt;</span><span class="default">$secs</span><span class="keyword">; </span><span class="default">$i</span><span class="keyword">++) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="default">date</span><span class="keyword">(</span><span class="string">"H:i:s"</span><span class="keyword">, </span><span class="default">time</span><span class="keyword">()).</span><span class="string">" ("</span><span class="keyword">.(</span><span class="default">$i</span><span class="keyword">+</span><span class="default">1</span><span class="keyword">).</span><span class="string">")"</span><span class="keyword">.</span><span class="string">"\r\n&lt;br /&gt;\r\n"</span><span class="keyword">.</span><span class="default">$buffer</span><span class="keyword">.</span><span class="string">"\r\n&lt;br /&gt;\r\n"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">ob_flush</span><span class="keyword">();<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">flush</span><span class="keyword">();<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">sleep</span><span class="keyword">(</span><span class="default">1</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">//usleep(1000000);<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">}<br />
}<br />
<br />
</span><span class="default">sleep_echo</span><span class="keyword">(</span><span class="default">30</span><span class="keyword">);<br />
<br />
</span><span class="default">ob_end_flush</span><span class="keyword">();<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="94533""></a>
  <div class="note">
   <strong class="user">f dot schima at ccgmbh dot de</strong>
   <a href="#94533" class="date">10-Nov-2009 06:48</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Remember that sleep() means "Let PHP time to do some other stuff".<br />
That means that sleep() can be interrupted by signals. That is important if you work with pcntl_signal() and friends.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="88801""></a>
  <div class="note">
   <strong class="user">Anonymous</strong>
   <a href="#88801" class="date">08-Feb-2009 12:32</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
This will allow you to use negative values or valuer below 1 second.
<br />

<br />
<span class="default">&lt;?php slaap</span><span class="keyword">(</span><span class="default">0.5</span><span class="keyword">); </span><span class="default">?&gt;
<br />
</span>
<br />
<span class="default">&lt;?php
<br />
</span><span class="keyword">function </span><span class="default">slaap</span><span class="keyword">(</span><span class="default">$seconds</span><span class="keyword">)
<br />
{
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$seconds </span><span class="keyword">= </span><span class="default">abs</span><span class="keyword">(</span><span class="default">$seconds</span><span class="keyword">);
<br />
&nbsp;&nbsp;&nbsp; if (</span><span class="default">$seconds </span><span class="keyword">&lt; </span><span class="default">1</span><span class="keyword">):
<br />
&nbsp;&nbsp; &nbsp; &nbsp; </span><span class="default">usleep</span><span class="keyword">(</span><span class="default">$seconds</span><span class="keyword">*</span><span class="default">1000000</span><span class="keyword">);
<br />
&nbsp;&nbsp;&nbsp; else:
<br />
&nbsp;&nbsp; &nbsp; &nbsp; </span><span class="default">sleep</span><span class="keyword">(</span><span class="default">$seconds</span><span class="keyword">);
<br />
&nbsp;&nbsp;&nbsp; endif;&nbsp; &nbsp; 
<br />
}
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="85353""></a>
  <div class="note">
   <strong class="user">webseos at gmail dot com</strong>
   <a href="#85353" class="date">26-Aug-2008 09:29</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
This is a critical thing to use time delay function as sleep() Because a beginner can find that this is not working and he/she will see that all output appearing at a time.<br />
<br />
A good way to implement this is by using the function -&nbsp; ob_implicit_flush() then you don't need to use flush() function explicitly.<br />
<br />
A sample code :<br />
<span class="default">&lt;?php<br />
ob_implicit_flush</span><span class="keyword">(</span><span class="default">true</span><span class="keyword">);<br />
for(</span><span class="default">$i</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">;</span><span class="default">$i</span><span class="keyword">&lt;</span><span class="default">5</span><span class="keyword">;</span><span class="default">$i</span><span class="keyword">++)<br />
{<br />
</span><span class="default">$dis</span><span class="keyword">=&lt;&lt;&lt;DIS<br />
</span><span class="string">&lt;div style="width:200px; background-color:lime;border:1px; text-align:center;text-decoration:blink;"&gt;<br />
</span><span class="default">$i</span><span class="string"><br />
&lt;/div&gt;<br />
</span><span class="keyword">DIS;<br />
echo </span><span class="default">$dis</span><span class="keyword">;<br />
<br />
</span><span class="default">sleep</span><span class="keyword">(</span><span class="default">5</span><span class="keyword">);<br />
</span><span class="comment">//flush();<br />
</span><span class="keyword">}</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="33732""></a>
  <div class="note">
   <strong class="user">MPHH</strong>
   <a href="#33732" class="date">05-Jul-2003 12:33</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Note: The set_time_limit() function and the configuration directive max_execution_time only affect the execution time of the script itself. Any time spent on activity that happens outside the execution of the script such as system calls using system(), the sleep() function, database queries, etc. is not included when determining the maximum time that the script has been running.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="8054""></a>
  <div class="note">
   <strong class="user">hartmut at six dot de</strong>
   <a href="#8054" class="date">25-Aug-2000 06:38</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
it is a bad idea to use sleep() for delayed output effects as
<br />

<br />
1) you have to flush() output before you sleep
<br />

<br />
2) depending on your setup flush() will not work all the way to the browser as the web server might apply buffering of its own or the browser might not render output it thinks not to be complete
<br />

<br />
netscape for example will only display complete lines and will not show table parts until the &lt;/table&gt; tag arrived
<br />

<br />
so use sleep if you have to wait&nbsp; for events and don't want to burn&nbsp; to much cycles, but don't use it for silly delayed output effects!</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
</div>
</div>
</div></div></body></html>
