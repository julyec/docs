<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
 <head>
  <meta http-equiv="content-type" content="text/html; CHARSET=UTF-8">
  <title>魔术方法</title>
<link media="all" rel="stylesheet" type="text/css" href="styles/03e73060321a0a848018724a6c83de7f-theme-base.css" />
<link media="all" rel="stylesheet" type="text/css" href="styles/03e73060321a0a848018724a6c83de7f-theme-medium.css" />

  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <link media="all" rel="stylesheet" type="text/css" href="style.css"/>
 </head>
 <body class="docs" class="docs"><div class="navbar navbar-fixed-top">
  <div class="navbar-inner clearfix">
    <ul class="nav" style="width: 100%">
      <li style="float: left;"><a href="language.oop5.iterations.html">? 遍历对象</a></li>
      <li style="float: right;"><a href="language.oop5.final.html">Final 关键字 ?</a></li>
    </ul>
  </div>
</div>
<div id="breadcrumbs" class="clearfix">
  <ul class="breadcrumbs-container">
    <li><a href="index.html">PHP Manual</a></li>
    <li><a href="language.oop5.html">类与对象</a></li>
    <li>魔术方法</li>
  </ul>
</div>
<div id="layout">
  <div id="layout-content"><div id="language.oop5.magic" class="sect1">
  <h2 class="title">魔术方法</h2>
  <p class="para">
   魔术方法是一种特殊的方法，当对对象执行某些操作时会覆盖 PHP 的默认操作。
  </p>
  <div class="caution"><strong class="caution">Caution</strong>
   <p class="simpara">
    PHP 保留所有以 <code class="literal">__</code> 开头的方法名称。
    因此，除非覆盖 PHP 的行为，否则不建议使用此类方法名称。
   </p>
  </div>
  <p class="para">
   下列方法名被认为是魔术方法：
   
   <a href="language.oop5.decon.html#object.construct" class="link">__construct()</a> 、
   <a href="language.oop5.decon.html#object.destruct" class="link">__destruct()</a> 、
   <a href="language.oop5.overloading.html#object.call" class="link">__call()</a> 、
   <a href="language.oop5.overloading.html#object.callstatic" class="link">__callStatic()</a> 、
   <a href="language.oop5.overloading.html#object.get" class="link">__get()</a> 、
   <a href="language.oop5.overloading.html#object.set" class="link">__set()</a> 、
   <a href="language.oop5.overloading.html#object.isset" class="link">__isset()</a> 、
   <a href="language.oop5.overloading.html#object.unset" class="link">__unset()</a> 、
   <a href="language.oop5.magic.html#object.sleep" class="link">__sleep()</a> 、
   <a href="language.oop5.magic.html#object.wakeup" class="link">__wakeup()</a> 、
   <a href="language.oop5.magic.html#object.serialize" class="link">__serialize()</a> 、
   <a href="language.oop5.magic.html#object.unserialize" class="link">__unserialize()</a> 、
   <a href="language.oop5.magic.html#object.tostring" class="link">__toString()</a> 、
   <a href="language.oop5.magic.html#object.invoke" class="link">__invoke()</a> 、
   <a href="language.oop5.magic.html#object.set-state" class="link">__set_state()</a> 、
   <a href="language.oop5.cloning.html#object.clone" class="link">__clone()</a> 、
   <a href="language.oop5.magic.html#object.debuginfo" class="link">__debugInfo()</a> 。
  </p>

  <div class="warning"><strong class="warning">Warning</strong>
   
   <p class="simpara">
    除了 <a href="language.oop5.decon.html#object.construct" class="link">__construct()</a>，
    <a href="language.oop5.decon.html#object.destruct" class="link">__destruct()</a> ，和
    <a href="language.oop5.cloning.html#object.clone" class="link">__clone()</a> 之外的所有魔术方法都
    <em class="emphasis">必须</em> 声明为 <code class="literal">public</code>，
    否则会发出 <strong><code>E_WARNING</code></strong>。
    在 PHP 8.0.0 之前没有为魔术方法
    <a href="language.oop5.magic.html#object.sleep" class="link">__sleep()</a> 、
    <a href="language.oop5.magic.html#object.wakeup" class="link">__wakeup()</a> 、
    <a href="language.oop5.magic.html#object.serialize" class="link">__serialize()</a> 、
    <a href="language.oop5.magic.html#object.unserialize" class="link">__unserialize()</a> 、
    <a href="language.oop5.magic.html#object.set-state" class="link">__set_state()</a> 发出诊断信息。
   </p>
  </div>
  <div class="warning"><strong class="warning">Warning</strong>
   <p class="para">
    如果定义魔术方法时使用类型声明，它们必须与本文档中描述的签名相同，否则会发出致命错误。
    在 PHP 8.0.0 之前，不会发出诊断信息。
    然而， <a href="language.oop5.decon.html#object.construct" class="link">__construct()</a> 和
    <a href="language.oop5.decon.html#object.destruct" class="link">__destruct()</a> 不能声明返回类型，
    否则会发出致命错误。
   </p>
  </div>
 
  <div class="sect2" id="language.oop5.magic.sleep">
   <h3 class="title">
    <a href="language.oop5.magic.html#object.sleep" class="link">__sleep()</a> 和
    <a href="language.oop5.magic.html#object.wakeup" class="link">__wakeup()</a>
   </h3>
   
   <div class="methodsynopsis dc-description" id="object.sleep">
    <span class="modifier">public</span> <span class="methodname"><strong>__sleep</strong></span>(): <span class="type">array</span></div>

   <div class="methodsynopsis dc-description" id="object.wakeup"><span class="modifier">public</span> <span class="methodname"><strong>__wakeup</strong></span>(): <span class="type"><span class="type void">void</span></span></div>

   
   <p class="para">
    <span class="function"><a href="function.serialize.html" class="function">serialize()</a></span> 函数会检查类中是否存在一个魔术方法
    <a href="language.oop5.magic.html#object.sleep" class="link">__sleep()</a>。如果存在，该方法会先被调用，然后才执行序列化操作。此功能可以用于清理对象，并返回一个包含对象中所有应被序列化的变量名称的数组。如果该方法未返回任何内容，则
    <strong><code>null</code></strong> 被序列化，并产生一个 <strong><code>E_NOTICE</code></strong> 级别的错误。
    </p>
   <blockquote class="note"><p><strong class="note">Note</strong>: 
    <p class="para">
     <a href="language.oop5.magic.html#object.sleep" class="link">__sleep()</a> 不能返回父类的私有成员的名字。这样做会产生一个
     <strong><code>E_NOTICE</code></strong> 级别的错误。使用
     <a href="language.oop5.magic.html#object.serialize" class="link">__serialize()</a> 接口替代。
    </p>
   </p></blockquote>
    
   <p class="para">
    <a href="language.oop5.magic.html#object.sleep" class="link">__sleep()</a> 方法常用于提交未提交的数据，或类似的清理操作。同时，如果有一些很大的对象，但不需要全部保存，这个功能就很好用。
   </p>
   <p class="para">
    与之相反，<span class="function"><a href="function.unserialize.html" class="function">unserialize()</a></span> 会检查是否存在一个 <a href="language.oop5.magic.html#object.wakeup" class="link">__wakeup()</a>
    方法。如果存在，则会先调用 <code class="literal">__wakeup</code> 方法，预先准备对象需要的资源。
   </p>
   <p class="para">
    <a href="language.oop5.magic.html#object.wakeup" class="link">__wakeup()</a> 经常用在反序列化操作中，例如重新建立数据库连接，或执行其它初始化操作。
   </p>
   <div class="example" id="example-548">
    <p><strong>Example #1 Sleep 和 wakeup</strong></p>
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br /></span><span style="color: #007700">class </span><span style="color: #0000BB">Connection <br /></span><span style="color: #007700">{<br />    protected </span><span style="color: #0000BB">$link</span><span style="color: #007700">;<br />    private </span><span style="color: #0000BB">$server</span><span style="color: #007700">, </span><span style="color: #0000BB">$username</span><span style="color: #007700">, </span><span style="color: #0000BB">$password</span><span style="color: #007700">, </span><span style="color: #0000BB">$db</span><span style="color: #007700">;<br />    <br />    public function </span><span style="color: #0000BB">__construct</span><span style="color: #007700">(</span><span style="color: #0000BB">$server</span><span style="color: #007700">, </span><span style="color: #0000BB">$username</span><span style="color: #007700">, </span><span style="color: #0000BB">$password</span><span style="color: #007700">, </span><span style="color: #0000BB">$db</span><span style="color: #007700">)<br />    {<br />        </span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">server </span><span style="color: #007700">= </span><span style="color: #0000BB">$server</span><span style="color: #007700">;<br />        </span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">username </span><span style="color: #007700">= </span><span style="color: #0000BB">$username</span><span style="color: #007700">;<br />        </span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">password </span><span style="color: #007700">= </span><span style="color: #0000BB">$password</span><span style="color: #007700">;<br />        </span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">db </span><span style="color: #007700">= </span><span style="color: #0000BB">$db</span><span style="color: #007700">;<br />        </span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">connect</span><span style="color: #007700">();<br />    }<br />    <br />    private function </span><span style="color: #0000BB">connect</span><span style="color: #007700">()<br />    {<br />        </span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">link </span><span style="color: #007700">= </span><span style="color: #0000BB">mysql_connect</span><span style="color: #007700">(</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">server</span><span style="color: #007700">, </span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">username</span><span style="color: #007700">, </span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">password</span><span style="color: #007700">);<br />        </span><span style="color: #0000BB">mysql_select_db</span><span style="color: #007700">(</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">db</span><span style="color: #007700">, </span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">link</span><span style="color: #007700">);<br />    }<br />    <br />    public function </span><span style="color: #0000BB">__sleep</span><span style="color: #007700">()<br />    {<br />        return array(</span><span style="color: #DD0000">'server'</span><span style="color: #007700">, </span><span style="color: #DD0000">'username'</span><span style="color: #007700">, </span><span style="color: #DD0000">'password'</span><span style="color: #007700">, </span><span style="color: #DD0000">'db'</span><span style="color: #007700">);<br />    }<br />    <br />    public function </span><span style="color: #0000BB">__wakeup</span><span style="color: #007700">()<br />    {<br />        </span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">connect</span><span style="color: #007700">();<br />    }<br />}<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
    </div>

   </div>
  </div>

  <div class="sect2" id="language.oop5.magic.serialize">
   <h3 class="title">
    <a href="language.oop5.magic.html#object.serialize" class="link">__serialize()</a> 和
    <a href="language.oop5.magic.html#object.unserialize" class="link">__unserialize()</a>
   </h3>

   <div class="methodsynopsis dc-description" id="object.serialize">
    <span class="modifier">public</span> <span class="methodname"><strong>__serialize</strong></span>(): <span class="type">array</span></div>

   <div class="methodsynopsis dc-description" id="object.unserialize"><span class="modifier">public</span> <span class="methodname"><strong>__unserialize</strong></span>(<span class="methodparam"><span class="type">array</span> <code class="parameter">$data</code></span>): <span class="type"><span class="type void">void</span></span></div>


   <p class="para">
    <span class="function"><a href="function.serialize.html" class="function">serialize()</a></span> 函数会检查类中是否存在一个魔术方法
    <a href="language.oop5.magic.html#object.serialize" class="link">__serialize()</a> 
    。如果存在，该方法将在任何序列化之前优先执行。它必须以一个代表对象序列化形式的 键/值 成对的关联数组形式来返回，如果没有返回数组，将会抛出一个
    <span class="classname"><a href="class.typeerror.html" class="classname">TypeError</a></span> 错误。
   </p>
   <blockquote class="note"><p><strong class="note">Note</strong>: 
    <p class="para">
     如果类中同时定义了 <a href="language.oop5.magic.html#object.serialize" class="link">__serialize()</a> 和 <a href="language.oop5.magic.html#object.sleep" class="link">__sleep()</a>
     两个魔术方法，则只有 <a href="language.oop5.magic.html#object.serialize" class="link">__serialize()</a> 方法会被调用。
     <a href="language.oop5.magic.html#object.sleep" class="link">__sleep()</a> 方法会被忽略掉。如果对象实现了 <a href="class.serializable.html" class="link">Serializable</a>
     接口，接口的 <code class="literal">serialize()</code> 方法会被忽略，做为代替类中的 <a href="language.oop5.magic.html#object.serialize" class="link">__serialize()</a> 方法会被调用。
    </p>
   </p></blockquote>
   <p class="para">
    <a href="language.oop5.magic.html#object.serialize" class="link">__serialize()</a> 的预期用途是定义对象序列化友好的任意表示。
    数组的元素可能对应对象的属性，但是这并不是必须的。
   </p>
   <p class="para">
    相反， <span class="function"><a href="function.unserialize.html" class="function">unserialize()</a></span> 检查是否存在具有名为 
    <a href="language.oop5.magic.html#object.unserialize" class="link">__unserialize()</a>
    的魔术方法。此函数将会传递从 <a href="language.oop5.magic.html#object.serialize" class="link">__serialize()</a>
    返回的恢复数组。然后它可以根据需要从该数组中恢复对象的属性。
   </p>
   <blockquote class="note"><p><strong class="note">Note</strong>: 
    <p class="para">
     如果类中同时定义了 <a href="language.oop5.magic.html#object.unserialize" class="link">__unserialize()</a> 和 <a href="language.oop5.magic.html#object.wakeup" class="link">__wakeup()</a>
     两个魔术方法，则只有 <a href="language.oop5.magic.html#object.unserialize" class="link">__unserialize()</a> 方法会生效，<a href="language.oop5.magic.html#object.wakeup" class="link">__wakeup()</a> 方法会被忽略。
    </p>
   </p></blockquote>
   <blockquote class="note"><p><strong class="note">Note</strong>: 
    <p class="para">
      此特性自 PHP 7.4.0 起可用。
    </p>
   </p></blockquote>
   <div class="example" id="example-550">
    <p><strong>Example #2 序列化和反序列化</strong></p>
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br /></span><span style="color: #007700">class </span><span style="color: #0000BB">Connection<br /></span><span style="color: #007700">{<br />    protected </span><span style="color: #0000BB">$link</span><span style="color: #007700">;<br />    private </span><span style="color: #0000BB">$dsn</span><span style="color: #007700">, </span><span style="color: #0000BB">$username</span><span style="color: #007700">, </span><span style="color: #0000BB">$password</span><span style="color: #007700">;<br /><br />    public function </span><span style="color: #0000BB">__construct</span><span style="color: #007700">(</span><span style="color: #0000BB">$dsn</span><span style="color: #007700">, </span><span style="color: #0000BB">$username</span><span style="color: #007700">, </span><span style="color: #0000BB">$password</span><span style="color: #007700">)<br />    {<br />        </span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">dsn </span><span style="color: #007700">= </span><span style="color: #0000BB">$dsn</span><span style="color: #007700">;<br />        </span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">username </span><span style="color: #007700">= </span><span style="color: #0000BB">$username</span><span style="color: #007700">;<br />        </span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">password </span><span style="color: #007700">= </span><span style="color: #0000BB">$password</span><span style="color: #007700">;<br />        </span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">connect</span><span style="color: #007700">();<br />    }<br /><br />    private function </span><span style="color: #0000BB">connect</span><span style="color: #007700">()<br />    {<br />        </span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">link </span><span style="color: #007700">= new </span><span style="color: #0000BB">PDO</span><span style="color: #007700">(</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">dsn</span><span style="color: #007700">, </span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">username</span><span style="color: #007700">, </span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">password</span><span style="color: #007700">);<br />    }<br /><br />    public function </span><span style="color: #0000BB">__serialize</span><span style="color: #007700">(): array<br />    {<br />        return [<br />          </span><span style="color: #DD0000">'dsn' </span><span style="color: #007700">=&gt; </span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">dsn</span><span style="color: #007700">,<br />          </span><span style="color: #DD0000">'user' </span><span style="color: #007700">=&gt; </span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">username</span><span style="color: #007700">,<br />          </span><span style="color: #DD0000">'pass' </span><span style="color: #007700">=&gt; </span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">password</span><span style="color: #007700">,<br />        ];<br />    }<br /><br />    public function </span><span style="color: #0000BB">__unserialize</span><span style="color: #007700">(array </span><span style="color: #0000BB">$data</span><span style="color: #007700">): </span><span style="color: #0000BB">void<br />    </span><span style="color: #007700">{<br />        </span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">dsn </span><span style="color: #007700">= </span><span style="color: #0000BB">$data</span><span style="color: #007700">[</span><span style="color: #DD0000">'dsn'</span><span style="color: #007700">];<br />        </span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">username </span><span style="color: #007700">= </span><span style="color: #0000BB">$data</span><span style="color: #007700">[</span><span style="color: #DD0000">'user'</span><span style="color: #007700">];<br />        </span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">password </span><span style="color: #007700">= </span><span style="color: #0000BB">$data</span><span style="color: #007700">[</span><span style="color: #DD0000">'pass'</span><span style="color: #007700">];<br /><br />        </span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">connect</span><span style="color: #007700">();<br />    }<br />}</span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
    </div>

   </div>
  </div>

  <div class="sect2" id="language.oop5.magic.tostring">
   <h3 class="title"><a href="language.oop5.magic.html#object.tostring" class="link">__toString()</a></h3>
   <div class="methodsynopsis dc-description" id="object.tostring">
    <span class="modifier">public</span> <span class="methodname"><strong>__toString</strong></span>(): <span class="type">string</span></div>

   
   <p class="para">
    <a href="language.oop5.magic.html#object.tostring" class="link">__toString()</a> 方法用于一个类被当成字符串时应怎样回应。例如
    <code class="literal">echo $obj;</code> 应该显示些什么。
   </p>
   <div class="warning"><strong class="warning">Warning</strong>
    <p class="para">
     从 PHP 8.0.0 起，返回值遵循标准的 PHP 类型语义，
     这意味着如果禁用 <a href="language.types.declarations.html#language.types.declarations.strict" class="link">严格类型</a>
     ，它将会强制转换为字符串。
    </p>
    <p class="para">
     从 PHP 8.0.0 起，任何包含 <a href="language.oop5.magic.html#object.tostring" class="link">__toString()</a>
     方法的类都将隐性实现 <span class="interfacename"><a href="class.stringable.html" class="interfacename">Stringable</a></span> 接口，
     因此将通过该接口的类型检查。推荐无论如何应显式实现该接口。
    </p>
    <p class="para">
     在 PHP 7.4 中，返回值 <em class="emphasis">必须</em> 是 <span class="type">string</span>
     ，否则会抛出 <span class="classname"><a href="class.error.html" class="classname">Error</a></span> 。
    </p>
    <p class="para">
     在 PHP 7.4.0 之前，返回值 <em class="emphasis">必须</em> 是 <span class="type">string</span>
     ，否则会抛出致命错误 <strong><code>E_RECOVERABLE_ERROR</code></strong> 。
    </p>
   </div>
   <div class="warning"><strong class="warning">Warning</strong>
    <p class="simpara">
     在 PHP 7.4.0 之前不能在 <a href="language.oop5.magic.html#object.tostring" class="link">__toString()</a>
     方法中抛出异常。这么做会导致致命错误。
    </p>
   </div>
   <div class="example" id="example-552">
    <p><strong>Example #3 简单示例</strong></p>
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br /></span><span style="color: #FF8000">// 声明一个简单的类<br /></span><span style="color: #007700">class </span><span style="color: #0000BB">TestClass<br /></span><span style="color: #007700">{<br />    public </span><span style="color: #0000BB">$foo</span><span style="color: #007700">;<br /><br />    public function </span><span style="color: #0000BB">__construct</span><span style="color: #007700">(</span><span style="color: #0000BB">$foo</span><span style="color: #007700">) <br />    {<br />        </span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">foo </span><span style="color: #007700">= </span><span style="color: #0000BB">$foo</span><span style="color: #007700">;<br />    }<br /><br />    public function </span><span style="color: #0000BB">__toString</span><span style="color: #007700">() {<br />        return </span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">foo</span><span style="color: #007700">;<br />    }<br />}<br /><br /></span><span style="color: #0000BB">$class </span><span style="color: #007700">= new </span><span style="color: #0000BB">TestClass</span><span style="color: #007700">(</span><span style="color: #DD0000">'Hello'</span><span style="color: #007700">);<br />echo </span><span style="color: #0000BB">$class</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
    </div>

    <div class="example-contents"><p>以上示例会输出：</p></div>
    <div class="example-contents screen">
<div class="cdata"><pre>
Hello
</pre></div>
    </div>
   </div>
  </div>

  <div class="sect2" id="language.oop5.magic.invoke">
   <h3 class="title"><a href="language.oop5.magic.html#object.invoke" class="link">__invoke()</a></h3>
   <div class="methodsynopsis dc-description" id="object.invoke">
    <span class="methodname"><strong>__invoke</strong></span>(<span class="methodparam"> <code class="parameter">...$values</code></span>): <span class="type"><a href="language.types.declarations.html#language.types.declarations.mixed" class="type mixed">mixed</a></span></div>

   <p class="para">
    当尝试以调用函数的方式调用一个对象时，<a href="language.oop5.magic.html#object.invoke" class="link">__invoke()</a> 方法会被自动调用。
   </p>
   <div class="example" id="example-554">
    <p><strong>Example #4 使用 <a href="language.oop5.magic.html#object.invoke" class="link">__invoke()</a></strong></p>
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br /></span><span style="color: #007700">class </span><span style="color: #0000BB">CallableClass <br /></span><span style="color: #007700">{<br />    function </span><span style="color: #0000BB">__invoke</span><span style="color: #007700">(</span><span style="color: #0000BB">$x</span><span style="color: #007700">) {<br />        </span><span style="color: #0000BB">var_dump</span><span style="color: #007700">(</span><span style="color: #0000BB">$x</span><span style="color: #007700">);<br />    }<br />}<br /></span><span style="color: #0000BB">$obj </span><span style="color: #007700">= new </span><span style="color: #0000BB">CallableClass</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">$obj</span><span style="color: #007700">(</span><span style="color: #0000BB">5</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">var_dump</span><span style="color: #007700">(</span><span style="color: #0000BB">is_callable</span><span style="color: #007700">(</span><span style="color: #0000BB">$obj</span><span style="color: #007700">));<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
    </div>

    <div class="example-contents"><p>以上示例会输出：</p></div>
    <div class="example-contents screen">
<div class="cdata"><pre>
int(5)
bool(true)
</pre></div>
    </div>
   </div>
   <div class="example" id="example-556">
    <p><strong>Example #5 使用 <a href="language.oop5.magic.html#object.invoke" class="link">__invoke()</a></strong></p>
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br /></span><span style="color: #007700">class </span><span style="color: #0000BB">Sort<br /></span><span style="color: #007700">{<br />    private </span><span style="color: #0000BB">$key</span><span style="color: #007700">;<br />    public function </span><span style="color: #0000BB">__construct</span><span style="color: #007700">(</span><span style="color: #0000BB">string $key</span><span style="color: #007700">)<br />    {<br />        </span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">key </span><span style="color: #007700">= </span><span style="color: #0000BB">$key</span><span style="color: #007700">;<br />    }<br />    public function </span><span style="color: #0000BB">__invoke</span><span style="color: #007700">(array </span><span style="color: #0000BB">$a</span><span style="color: #007700">, array </span><span style="color: #0000BB">$b</span><span style="color: #007700">): </span><span style="color: #0000BB">int<br />    </span><span style="color: #007700">{<br />        return </span><span style="color: #0000BB">$a</span><span style="color: #007700">[</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">key</span><span style="color: #007700">] &lt;=&gt; </span><span style="color: #0000BB">$b</span><span style="color: #007700">[</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">key</span><span style="color: #007700">];<br />    }<br />}<br /></span><span style="color: #0000BB">$customers </span><span style="color: #007700">= [<br />    [</span><span style="color: #DD0000">'id' </span><span style="color: #007700">=&gt; </span><span style="color: #0000BB">1</span><span style="color: #007700">, </span><span style="color: #DD0000">'first_name' </span><span style="color: #007700">=&gt; </span><span style="color: #DD0000">'John'</span><span style="color: #007700">, </span><span style="color: #DD0000">'last_name' </span><span style="color: #007700">=&gt; </span><span style="color: #DD0000">'Do'</span><span style="color: #007700">],<br />    [</span><span style="color: #DD0000">'id' </span><span style="color: #007700">=&gt; </span><span style="color: #0000BB">3</span><span style="color: #007700">, </span><span style="color: #DD0000">'first_name' </span><span style="color: #007700">=&gt; </span><span style="color: #DD0000">'Alice'</span><span style="color: #007700">, </span><span style="color: #DD0000">'last_name' </span><span style="color: #007700">=&gt; </span><span style="color: #DD0000">'Gustav'</span><span style="color: #007700">],<br />    [</span><span style="color: #DD0000">'id' </span><span style="color: #007700">=&gt; </span><span style="color: #0000BB">2</span><span style="color: #007700">, </span><span style="color: #DD0000">'first_name' </span><span style="color: #007700">=&gt; </span><span style="color: #DD0000">'Bob'</span><span style="color: #007700">, </span><span style="color: #DD0000">'last_name' </span><span style="color: #007700">=&gt; </span><span style="color: #DD0000">'Filipe'</span><span style="color: #007700">]<br />];<br /></span><span style="color: #FF8000">// sort customers by first name<br /></span><span style="color: #0000BB">usort</span><span style="color: #007700">(</span><span style="color: #0000BB">$customers</span><span style="color: #007700">, new </span><span style="color: #0000BB">Sort</span><span style="color: #007700">(</span><span style="color: #DD0000">'first_name'</span><span style="color: #007700">));<br /></span><span style="color: #0000BB">print_r</span><span style="color: #007700">(</span><span style="color: #0000BB">$customers</span><span style="color: #007700">);<br /></span><span style="color: #FF8000">// sort customers by last name<br /></span><span style="color: #0000BB">usort</span><span style="color: #007700">(</span><span style="color: #0000BB">$customers</span><span style="color: #007700">, new </span><span style="color: #0000BB">Sort</span><span style="color: #007700">(</span><span style="color: #DD0000">'last_name'</span><span style="color: #007700">));<br /></span><span style="color: #0000BB">print_r</span><span style="color: #007700">(</span><span style="color: #0000BB">$customers</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
    </div>

    <div class="example-contents"><p>以上示例会输出：</p></div>
    <div class="example-contents screen">
<div class="cdata"><pre>
Array
(
    [0] =&gt; Array
        (
            [id] =&gt; 3
            [first_name] =&gt; Alice
            [last_name] =&gt; Gustav
        )
    [1] =&gt; Array
        (
            [id] =&gt; 2
            [first_name] =&gt; Bob
            [last_name] =&gt; Filipe
        )
    [2] =&gt; Array
        (
            [id] =&gt; 1
            [first_name] =&gt; John
            [last_name] =&gt; Do
        )
)
Array
(
    [0] =&gt; Array
        (
            [id] =&gt; 1
            [first_name] =&gt; John
            [last_name] =&gt; Do
        )
    [1] =&gt; Array
        (
            [id] =&gt; 2
            [first_name] =&gt; Bob
            [last_name] =&gt; Filipe
        )
    [2] =&gt; Array
        (
            [id] =&gt; 3
            [first_name] =&gt; Alice
            [last_name] =&gt; Gustav
        )
)
</pre></div>
    </div>
   </div>
  </div>

  <div class="sect2" id="language.oop5.magic.set-state">
   <h3 class="title"><a href="language.oop5.magic.html#object.set-state" class="link">__set_state()</a></h3>
   <div class="methodsynopsis dc-description" id="object.set-state">
    <span class="modifier">static</span> <span class="methodname"><strong>__set_state</strong></span>(<span class="methodparam"><span class="type">array</span> <code class="parameter">$properties</code></span>): <span class="type">object</span></div>

   <p class="para">
    当调用 <span class="function"><a href="function.var-export.html" class="function">var_export()</a></span> 导出类时，此<a href="language.oop5.static.html" class="link">静态</a> 方法会被调用。
   </p>
   <p class="para">
    本方法的唯一参数是一个数组，其中包含按 <code class="literal">[&#039;property&#039; =&gt; value, ...]</code> 格式排列的类属性。
   </p>
   <div class="example" id="example-558">
    <p><strong>Example #6 使用 <a href="language.oop5.magic.html#object.set-state" class="link">__set_state()</a>&gt;</strong></p>
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br /><br /></span><span style="color: #007700">class </span><span style="color: #0000BB">A<br /></span><span style="color: #007700">{<br />    public </span><span style="color: #0000BB">$var1</span><span style="color: #007700">;<br />    public </span><span style="color: #0000BB">$var2</span><span style="color: #007700">;<br /><br />    public static function </span><span style="color: #0000BB">__set_state</span><span style="color: #007700">(</span><span style="color: #0000BB">$an_array</span><span style="color: #007700">)<br />    {<br />        </span><span style="color: #0000BB">$obj </span><span style="color: #007700">= new </span><span style="color: #0000BB">A</span><span style="color: #007700">;<br />        </span><span style="color: #0000BB">$obj</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">var1 </span><span style="color: #007700">= </span><span style="color: #0000BB">$an_array</span><span style="color: #007700">[</span><span style="color: #DD0000">'var1'</span><span style="color: #007700">];<br />        </span><span style="color: #0000BB">$obj</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">var2 </span><span style="color: #007700">= </span><span style="color: #0000BB">$an_array</span><span style="color: #007700">[</span><span style="color: #DD0000">'var2'</span><span style="color: #007700">];<br />        return </span><span style="color: #0000BB">$obj</span><span style="color: #007700">;<br />    }<br />}<br /><br /></span><span style="color: #0000BB">$a </span><span style="color: #007700">= new </span><span style="color: #0000BB">A</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">$a</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">var1 </span><span style="color: #007700">= </span><span style="color: #0000BB">5</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">$a</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">var2 </span><span style="color: #007700">= </span><span style="color: #DD0000">'foo'</span><span style="color: #007700">;<br /><br /></span><span style="color: #0000BB">$b </span><span style="color: #007700">= </span><span style="color: #0000BB">var_export</span><span style="color: #007700">(</span><span style="color: #0000BB">$a</span><span style="color: #007700">, </span><span style="color: #0000BB">true</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">var_dump</span><span style="color: #007700">(</span><span style="color: #0000BB">$b</span><span style="color: #007700">);<br />eval(</span><span style="color: #DD0000">'$c = ' </span><span style="color: #007700">. </span><span style="color: #0000BB">$b </span><span style="color: #007700">. </span><span style="color: #DD0000">';'</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">var_dump</span><span style="color: #007700">(</span><span style="color: #0000BB">$c</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">var_dump</span><span style="color: #007700">(</span><span style="color: #0000BB">$b</span><span style="color: #007700">);<br /><br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
    </div>

    <div class="example-contents"><p>以上示例会输出：</p></div>
    <div class="example-contents screen">
<div class="cdata"><pre>
string(60) &quot;A::__set_state(array(
   &#039;var1&#039; =&gt; 5,
   &#039;var2&#039; =&gt; &#039;foo&#039;,
))&quot;
object(A)#2 (2) {
  [&quot;var1&quot;]=&gt;
  int(5)
  [&quot;var2&quot;]=&gt;
  string(3) &quot;foo&quot;
}
</pre></div>
    </div>
   </div>
   <blockquote class="note"><p><strong class="note">Note</strong>: 
    <span class="simpara">
     导出对象时， <span class="function"><a href="function.var-export.html" class="function">var_export()</a></span> 不会检查对象类是否实现了
     <a href="language.oop5.magic.html#object.set-state" class="link">__set_state()</a> ，
     所以如果 <a href="language.oop5.magic.html#object.set-state" class="link">__set_state()</a> 没有实现，
     重新导入对象会触发 <span class="classname"><a href="class.error.html" class="classname">Error</a></span> 异常。特别是这会影响内部(内置)类。
    </span>
    <span class="simpara">
     程序员有责任验证要重新导入的类是否实现了 
     <a href="language.oop5.magic.html#object.set-state" class="link">__set_state()</a> 。
    </span>
   </p></blockquote>
  </div>
  <div class="sect2" id="language.oop5.magic.debuginfo">
   <h3 class="title"><a href="language.oop5.magic.html#object.debuginfo" class="link">__debugInfo()</a></h3>
   <div class="methodsynopsis dc-description" id="object.debuginfo">
    <span class="methodname"><strong>__debugInfo</strong></span>(): <span class="type">array</span></div>

   <p class="para">
    当通过 <span class="function"><a href="function.var-dump.html" class="function">var_dump()</a></span> 转储对象，获取应该要显示的属性的时候，
    该函数就会被调用。如果对象中没有定义该方法，那么将会展示所有的公有、受保护和私有的属性。
   </p>
   <div class="example" id="example-560">
    <p><strong>Example #7 使用 <a href="language.oop5.magic.html#object.debuginfo" class="link">__debugInfo()</a></strong></p>
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br /></span><span style="color: #007700">class </span><span style="color: #0000BB">C </span><span style="color: #007700">{<br />    private </span><span style="color: #0000BB">$prop</span><span style="color: #007700">;<br /><br />    public function </span><span style="color: #0000BB">__construct</span><span style="color: #007700">(</span><span style="color: #0000BB">$val</span><span style="color: #007700">) {<br />        </span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">prop </span><span style="color: #007700">= </span><span style="color: #0000BB">$val</span><span style="color: #007700">;<br />    }<br /><br />    public function </span><span style="color: #0000BB">__debugInfo</span><span style="color: #007700">() {<br />        return [<br />            </span><span style="color: #DD0000">'propSquared' </span><span style="color: #007700">=&gt; </span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">prop </span><span style="color: #007700">** </span><span style="color: #0000BB">2</span><span style="color: #007700">,<br />        ];<br />    }<br />}<br /><br /></span><span style="color: #0000BB">var_dump</span><span style="color: #007700">(new </span><span style="color: #0000BB">C</span><span style="color: #007700">(</span><span style="color: #0000BB">42</span><span style="color: #007700">));<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
    </div>

    <div class="example-contents"><p>以上示例会输出：</p></div>
    <div class="example-contents screen">
<div class="cdata"><pre>
object(C)#1 (1) {
  [&quot;propSquared&quot;]=&gt;
  int(1764)
}
</pre></div>
    </div>
   </div>
  </div>
 </div><div id="usernotes">
 <div class="head">
  <h3 class="title">User Contributed Notes</h3>
 </div>
<div id="allnotes">  <a name="128621""></a>
  <div class="note">
   <strong class="user">tyler at nighthound dot us</strong>
   <a href="#128621" class="date">18-Jun-2023 01:26</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Please note that as of PHP 8.2 implementing __serialize() has no control over the output of json_encode(). you still have to implement JsonSerializable.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="125769""></a>
  <div class="note">
   <strong class="user">vali dot dr at gmail dot com</strong>
   <a href="#125769" class="date">03-Feb-2021 07:18</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
It should be noted that if you unset a class typed property and then try to access it,&nbsp; __get will be called. But it MUST return the original type.<br />
<br />
https://wiki.php.net/rfc/typed_properties_v2#overloaded_properties</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="125590""></a>
  <div class="note">
   <strong class="user">ricasiano at gmail dot com</strong>
   <a href="#125590" class="date">10-Dec-2020 09:59</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Objects with __toString() passed within methods with type declarations(either from function arguments or return types) automagically converts it to string.<br />
<br />
<span class="default">&lt;?php<br />
<br />
</span><span class="keyword">class </span><span class="default">Foo<br />
</span><span class="keyword">{<br />
&nbsp;&nbsp;&nbsp; public function </span><span class="default">__toString</span><span class="keyword">()<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="string">'foo'</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
}<br />
<br />
class </span><span class="default">Bar<br />
</span><span class="keyword">{<br />
&nbsp;&nbsp;&nbsp; public function </span><span class="default">setAndGetFoo</span><span class="keyword">(</span><span class="default">string $foo</span><span class="keyword">)<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">$foo</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp;&nbsp; public function </span><span class="default">getFoo</span><span class="keyword">(): </span><span class="default">string<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">{<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return new </span><span class="default">Foo</span><span class="keyword">();<br />
&nbsp;&nbsp;&nbsp; }<br />
}<br />
<br />
</span><span class="default">$foo </span><span class="keyword">= new </span><span class="default">Foo</span><span class="keyword">();<br />
</span><span class="default">$bar </span><span class="keyword">= new </span><span class="default">Bar</span><span class="keyword">();<br />
</span><span class="comment">// string(3) "foo"<br />
</span><span class="default">var_dump</span><span class="keyword">(</span><span class="default">$bar</span><span class="keyword">-&gt;</span><span class="default">setAndGetFoo</span><span class="keyword">(</span><span class="default">$foo</span><span class="keyword">));<br />
</span><span class="comment">// string(3) "foo"<br />
</span><span class="default">var_dump</span><span class="keyword">(</span><span class="default">$bar</span><span class="keyword">-&gt;</span><span class="default">getFoo</span><span class="keyword">());</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="125282""></a>
  <div class="note">
   <strong class="user">ctamayo at sitecrafting dot com</strong>
   <a href="#125282" class="date">18-Aug-2020 06:10</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Due to a bug in PHP &lt;= 7.3, overriding the __debugInfo() method from SPL classes is silently ignored.<br />
<br />
<span class="default">&lt;?php<br />
<br />
</span><span class="keyword">class </span><span class="default">Debuggable </span><span class="keyword">extends </span><span class="default">ArrayObject </span><span class="keyword">{<br />
&nbsp; public function </span><span class="default">__debugInfo</span><span class="keyword">() {<br />
&nbsp;&nbsp;&nbsp; return [</span><span class="string">'special' </span><span class="keyword">=&gt; </span><span class="string">'This should show up'</span><span class="keyword">];<br />
&nbsp; }<br />
}<br />
<br />
</span><span class="default">var_dump</span><span class="keyword">(new </span><span class="default">Debuggable</span><span class="keyword">());<br />
<br />
</span><span class="comment">// Expected output:<br />
// object(Debuggable)#1 (1) {<br />
//&nbsp;&nbsp; ["special"]=&gt;<br />
//&nbsp;&nbsp; string(19) "This should show up"<br />
// }<br />
<br />
// Actual output:<br />
// object(Debuggable)#1 (1) {<br />
//&nbsp;&nbsp; ["storage":"ArrayObject":private]=&gt;<br />
//&nbsp;&nbsp; array(0) {<br />
//&nbsp;&nbsp; }<br />
// }<br />
<br />
</span><span class="default">?&gt;<br />
</span><br />
Bug report: https://bugs.php.net/bug.php?id=69264</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="122684""></a>
  <div class="note">
   <strong class="user">daniel dot peder at gmail dot com</strong>
   <a href="#122684" class="date">30-Apr-2018 09:29</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
<a href="http://sandbox.onlinephpfunctions.com/code/4d2cc3648aed58c0dad90c7868173a4775e5ba0c" rel="nofollow" target="_blank">http://sandbox.onlinephpfunctions.com/code/4d2cc3648aed58c0dad90c7868173a4775e5ba0c</a><br />
<br />
IMHO a bug or need feature change<br />
<br />
providing a object as a array index doesn't try to us __toString() method so some volatile object identifier is used to index the array, which is breaking any persistency. Type hinting solves that, but while other than "string" type hinting doesn't work on ob jects, the automatic conversion to string should be very intuitive.<br />
<br />
PS: tried to submit bug, but withot patch the bugs are ignored, unfortunately, I don't C coding<br />
<br />
<span class="default">&lt;?php<br />
<br />
</span><span class="keyword">class </span><span class="default">shop_product_id </span><span class="keyword">{<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; protected </span><span class="default">$shop_name</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; protected </span><span class="default">$product_id</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; function </span><span class="default">__construct</span><span class="keyword">(</span><span class="default">$shop_name</span><span class="keyword">,</span><span class="default">$product_id</span><span class="keyword">){<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">shop_name </span><span class="keyword">= </span><span class="default">$shop_name</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">product_id </span><span class="keyword">= </span><span class="default">$product_id</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp;&nbsp; function </span><span class="default">__toString</span><span class="keyword">(){<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">shop_name </span><span class="keyword">. </span><span class="string">':' </span><span class="keyword">. </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">product_id</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
}<br />
<br />
</span><span class="default">$shop_name </span><span class="keyword">= </span><span class="string">'Shop_A'</span><span class="keyword">;<br />
</span><span class="default">$product_id </span><span class="keyword">= </span><span class="default">123</span><span class="keyword">;<br />
</span><span class="default">$demo_id </span><span class="keyword">= </span><span class="default">$shop_name </span><span class="keyword">. </span><span class="string">':' </span><span class="keyword">. </span><span class="default">$product_id</span><span class="keyword">;<br />
</span><span class="default">$demo_name </span><span class="keyword">= </span><span class="string">'Some product in shop A'</span><span class="keyword">;<br />
<br />
</span><span class="default">$all_products </span><span class="keyword">= [ </span><span class="default">$demo_id </span><span class="keyword">=&gt; </span><span class="default">$demo_name </span><span class="keyword">];<br />
</span><span class="default">$pid </span><span class="keyword">= new </span><span class="default">shop_product_id</span><span class="keyword">( </span><span class="default">$shop_name</span><span class="keyword">, </span><span class="default">$product_id </span><span class="keyword">);<br />
<br />
echo </span><span class="string">"with type hinting: "</span><span class="keyword">;<br />
echo (</span><span class="default">$demo_name </span><span class="keyword">=== </span><span class="default">$all_products</span><span class="keyword">[(string)</span><span class="default">$pid</span><span class="keyword">]) ? </span><span class="string">"ok" </span><span class="keyword">: </span><span class="string">"fail"</span><span class="keyword">;<br />
echo </span><span class="string">"\n"</span><span class="keyword">;<br />
<br />
echo </span><span class="string">"without type hinting: "</span><span class="keyword">;<br />
echo (</span><span class="default">$demo_name </span><span class="keyword">=== </span><span class="default">$all_products</span><span class="keyword">[</span><span class="default">$pid</span><span class="keyword">]) ?&nbsp; </span><span class="string">"ok" </span><span class="keyword">: </span><span class="string">"fail"</span><span class="keyword">;<br />
echo </span><span class="string">"\n"</span><span class="keyword">;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="121158""></a>
  <div class="note">
   <strong class="user">kguest at php dot net</strong>
   <a href="#121158" class="date">30-May-2017 01:27</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
__debugInfo&nbsp; is also utilised when calling print_r on an object:<br />
<br />
$ cat test.php<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">class </span><span class="default">FooQ </span><span class="keyword">{<br />
<br />
&nbsp;&nbsp; &nbsp; private </span><span class="default">$bar </span><span class="keyword">= </span><span class="string">''</span><span class="keyword">;<br />
<br />
&nbsp;&nbsp; &nbsp; public function </span><span class="default">__construct</span><span class="keyword">(</span><span class="default">$val</span><span class="keyword">) {<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">bar </span><span class="keyword">= </span><span class="default">$val</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; }<br />
<br />
&nbsp;&nbsp; &nbsp; public function </span><span class="default">__debugInfo</span><span class="keyword">()<br />
&nbsp;&nbsp; &nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; return [</span><span class="string">'_bar' </span><span class="keyword">=&gt; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">bar</span><span class="keyword">];<br />
&nbsp;&nbsp; &nbsp; }<br />
}<br />
</span><span class="default">$fooq </span><span class="keyword">= new </span><span class="default">FooQ</span><span class="keyword">(</span><span class="string">"q"</span><span class="keyword">);<br />
</span><span class="default">print_r </span><span class="keyword">(</span><span class="default">$fooq</span><span class="keyword">);<br />
<br />
$ </span><span class="default">php test</span><span class="keyword">.</span><span class="default">php<br />
FooQ Object<br />
</span><span class="keyword">(<br />
&nbsp;&nbsp;&nbsp; [</span><span class="default">_bar</span><span class="keyword">] =&gt; </span><span class="default">q<br />
</span><span class="keyword">)<br />
$</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="118617""></a>
  <div class="note">
   <strong class="user">smiley at HELLOSPAMBOT dot chillerlan dot net</strong>
   <a href="#118617" class="date">09-Jan-2016 04:30</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
A simple API wrapper, using __call() and the PHP 5.6 "..." token.<br />
<a href="http://php.net/manual/functions.arguments.php#functions.variable-arg-list" rel="nofollow" target="_blank">http://php.net/manual/functions.arguments.php#functions.variable-arg-list</a><br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">namespace </span><span class="default">Example</span><span class="keyword">;<br />
<br />
use </span><span class="default">Exception</span><span class="keyword">;<br />
use </span><span class="default">ReflectionClass</span><span class="keyword">;<br />
use </span><span class="default">SomeApiInterface</span><span class="keyword">;<br />
use </span><span class="default">SomeHttpClient</span><span class="keyword">;<br />
use </span><span class="default">SomeEndpointHandler</span><span class="keyword">;<br />
<br />
</span><span class="comment">/**<br />
&nbsp;* Class SomeApiWrapper<br />
&nbsp;* <br />
&nbsp;* @method SomeEndpointHandler method1(MethodParams $param1)<br />
&nbsp;* @method SomeEndpointHandler method2(MethodParams $param1, AuthParams $param2 = null)<br />
&nbsp;* ...<br />
&nbsp;* @method SomeEndpointHandler method42()<br />
&nbsp;*/<br />
</span><span class="keyword">class </span><span class="default">SomeApiWrapper</span><span class="keyword">{<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">/**<br />
&nbsp;&nbsp; &nbsp; * @var \SomeHttpClient<br />
&nbsp;&nbsp; &nbsp; */<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">private </span><span class="default">$httpClient</span><span class="keyword">;<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">/**<br />
&nbsp;&nbsp; &nbsp; * @var array<br />
&nbsp;&nbsp; &nbsp; */<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">private </span><span class="default">$methodMap </span><span class="keyword">= [];<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">/**<br />
&nbsp;&nbsp; &nbsp; * SomeApiWrapper constructor.<br />
&nbsp;&nbsp; &nbsp; */<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">public function </span><span class="default">__construct</span><span class="keyword">(){<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">mapApiMethods</span><span class="keyword">();<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">httpClient </span><span class="keyword">= new </span><span class="default">SomeHttpClient</span><span class="keyword">();<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">/**<br />
&nbsp;&nbsp; &nbsp; * The API is flat and has ~ 150 endpoints, all of which take optional parameters<br />
&nbsp;&nbsp; &nbsp; * from up to 3 groups (method params, authentication, filters). Instead of<br />
&nbsp;&nbsp; &nbsp; * implementing the interface and adding countless stubs that have basically<br />
&nbsp;&nbsp; &nbsp; * the same signature, i just map its methods here and use __call().<br />
&nbsp;&nbsp; &nbsp; */<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">private function </span><span class="default">mapApiMethods</span><span class="keyword">(){<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$reflectionClass </span><span class="keyword">= new </span><span class="default">ReflectionClass</span><span class="keyword">(</span><span class="default">SomeApiInterface</span><span class="keyword">::class);<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; foreach(</span><span class="default">$reflectionClass</span><span class="keyword">-&gt;</span><span class="default">getMethods</span><span class="keyword">() as </span><span class="default">$m</span><span class="keyword">){<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">methodMap</span><span class="keyword">[] = </span><span class="default">$m</span><span class="keyword">-&gt;</span><span class="default">name</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">/**<br />
&nbsp;&nbsp; &nbsp; * Thanks to the PHP 5.6+ "..." token, there's no hassle with the arguments anymore<br />
&nbsp;&nbsp; &nbsp; * (ugh, bad pun). Just hand the method parameters into the endpoint handler,<br />
&nbsp;&nbsp; &nbsp; * along with other mandatory params - type hints are your friends.<br />
&nbsp;&nbsp; &nbsp; * <br />
&nbsp;&nbsp; &nbsp; * It's magic!<br />
&nbsp;&nbsp; &nbsp; * <br />
&nbsp;&nbsp; &nbsp; * @param string $method<br />
&nbsp;&nbsp; &nbsp; * @param array&nbsp; $arguments<br />
&nbsp;&nbsp; &nbsp; *<br />
&nbsp;&nbsp; &nbsp; * @return \SomeEndpointHandler<br />
&nbsp;&nbsp; &nbsp; * @throws \Exception<br />
&nbsp;&nbsp; &nbsp; */<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">public function </span><span class="default">__call</span><span class="keyword">(</span><span class="default">$method</span><span class="keyword">, </span><span class="default">$arguments</span><span class="keyword">){<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">in_array</span><span class="keyword">(</span><span class="default">$method</span><span class="keyword">, </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">methodMap</span><span class="keyword">)){<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return new </span><span class="default">SomeEndpointHandler</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">httpClient</span><span class="keyword">, </span><span class="default">$method</span><span class="keyword">, ...</span><span class="default">$arguments</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; throw new </span><span class="default">Exception</span><span class="keyword">(</span><span class="string">'Endpoint "'</span><span class="keyword">.</span><span class="default">$method</span><span class="keyword">.</span><span class="string">'" does not exist'</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
}</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="112209""></a>
  <div class="note">
   <strong class="user">danillo dot paiva dot toledo at gmail dot com</strong>
   <a href="#112209" class="date">16-May-2013 07:39</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
While I was studying Ruby I saw as such interesting things as properties created + its getters and setters in just one line.<br />
<br />
I tryied to do the same in PHP and this is the code I have<br />
<br />
class Father {<br />
&nbsp;&nbsp;&nbsp; public function __call($name, $args) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if(isset($this-&gt;$name)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if(isset($args[0]))<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return $this-&gt;$name = $args[0];<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return $this-&gt;$name;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return false;<br />
&nbsp;&nbsp;&nbsp; }<br />
}<br />
<br />
class Child extends Father {<br />
&nbsp;&nbsp;&nbsp; public $country = "Brazil";<br />
&nbsp;&nbsp;&nbsp; public $state = "Sao Paulo";<br />
}<br />
<br />
Sometimes we don't need things like that on all classes but is quite interesting.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="112193""></a>
  <div class="note">
   <strong class="user">staff at pro-unreal dot de</strong>
   <a href="#112193" class="date">16-May-2013 06:08</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
To avoid instanciating the parent instead of the inherited class for __set_state() as reported by jsnell, you could use late static binding introduced in PHP 5.3:<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">class </span><span class="default">A </span><span class="keyword">{<br />
&nbsp;&nbsp;&nbsp; public static function </span><span class="default">__set_state</span><span class="keyword">(</span><span class="default">$data</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return new static();<br />
&nbsp;&nbsp;&nbsp; }<br />
}<br />
<br />
class </span><span class="default">B </span><span class="keyword">extends </span><span class="default">A </span><span class="keyword">{<br />
}<br />
<br />
</span><span class="default">$instance </span><span class="keyword">= new </span><span class="default">B</span><span class="keyword">();<br />
eval(</span><span class="string">'$test = ' </span><span class="keyword">. </span><span class="default">var_export</span><span class="keyword">(</span><span class="default">$instance</span><span class="keyword">, </span><span class="default">true</span><span class="keyword">) . </span><span class="string">';'</span><span class="keyword">);<br />
</span><span class="default">var_dump</span><span class="keyword">(</span><span class="default">$test</span><span class="keyword">);<br />
</span><span class="comment">// -&gt; object(B)#2 (0) {<br />
// }<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="107509""></a>
  <div class="note">
   <strong class="user">daan dot broekhof at gmail dot com</strong>
   <a href="#107509" class="date">14-Feb-2012 10:54</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Ever wondered why you can't throw exceptions from __toString()? Yeah me too. <br />
<br />
Well now you can! This trick allows you to throw any type of exception from within a __toString(), with a full &amp; correct backtrace.<br />
<br />
How does it work? Well PHP __toString() handling is not as strict in every case: throwing an Exception from __toString() triggers a fatal E_ERROR, but returning a non-string value from a __toString() triggers a non-fatal E_RECOVERABLE_ERROR. <br />
Add a little bookkeeping, and can circumvented this PHP deficiency!<br />
(tested to work PHP 5.3+)<br />
<br />
<span class="default">&lt;?php<br />
<br />
set_error_handler</span><span class="keyword">(array(</span><span class="string">'My_ToStringFixer'</span><span class="keyword">, </span><span class="string">'errorHandler'</span><span class="keyword">));<br />
</span><span class="default">error_reporting</span><span class="keyword">(</span><span class="default">E_ALL </span><span class="keyword">| </span><span class="default">E_STRICT</span><span class="keyword">);<br />
<br />
class </span><span class="default">My_ToStringFixer<br />
</span><span class="keyword">{<br />
&nbsp;&nbsp;&nbsp; protected static </span><span class="default">$_toStringException</span><span class="keyword">;<br />
<br />
&nbsp;&nbsp;&nbsp; public static function </span><span class="default">errorHandler</span><span class="keyword">(</span><span class="default">$errorNumber</span><span class="keyword">, </span><span class="default">$errorMessage</span><span class="keyword">, </span><span class="default">$errorFile</span><span class="keyword">, </span><span class="default">$errorLine</span><span class="keyword">)<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (isset(</span><span class="default">self</span><span class="keyword">::</span><span class="default">$_toStringException</span><span class="keyword">))<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$exception </span><span class="keyword">= </span><span class="default">self</span><span class="keyword">::</span><span class="default">$_toStringException</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// Always unset '_toStringException', we don't want a straggler to be found later if something came between the setting and the error<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">self</span><span class="keyword">::</span><span class="default">$_toStringException </span><span class="keyword">= </span><span class="default">null</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">preg_match</span><span class="keyword">(</span><span class="string">'~^Method .*::__toString\(\) must return a string value$~'</span><span class="keyword">, </span><span class="default">$errorMessage</span><span class="keyword">))<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; throw </span><span class="default">$exception</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">false</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; public static function </span><span class="default">throwToStringException</span><span class="keyword">(</span><span class="default">$exception</span><span class="keyword">)<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// Should not occur with prescribed usage, but in case of recursion: clean out exception, return a valid string, and weep<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">if (isset(</span><span class="default">self</span><span class="keyword">::</span><span class="default">$_toStringException</span><span class="keyword">))<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">self</span><span class="keyword">::</span><span class="default">$_toStringException </span><span class="keyword">= </span><span class="default">null</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="string">''</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">self</span><span class="keyword">::</span><span class="default">$_toStringException </span><span class="keyword">= </span><span class="default">$exception</span><span class="keyword">;<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">null</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
}<br />
<br />
class </span><span class="default">My_Class<br />
</span><span class="keyword">{<br />
&nbsp;&nbsp;&nbsp; public function </span><span class="default">doComplexStuff</span><span class="keyword">()<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; throw new </span><span class="default">Exception</span><span class="keyword">(</span><span class="string">'Oh noes!'</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp;&nbsp; public function </span><span class="default">__toString</span><span class="keyword">()<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; try<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// do your complex thing which might trigger an exception<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">return </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">doComplexStuff</span><span class="keyword">();<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; catch (</span><span class="default">Exception $e</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// The 'return' is required to trigger the trick<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">return </span><span class="default">My_ToStringFixer</span><span class="keyword">::</span><span class="default">throwToStringException</span><span class="keyword">(</span><span class="default">$e</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; }<br />
}<br />
<br />
</span><span class="default">$x </span><span class="keyword">= new </span><span class="default">My_Class</span><span class="keyword">();<br />
<br />
try<br />
{<br />
&nbsp;&nbsp;&nbsp; echo </span><span class="default">$x</span><span class="keyword">;<br />
}<br />
catch (</span><span class="default">Exception $e</span><span class="keyword">)<br />
{<br />
&nbsp;&nbsp;&nbsp; echo </span><span class="string">'Caught Exception! : '</span><span class="keyword">. </span><span class="default">$e</span><span class="keyword">;<br />
}<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="107031""></a>
  <div class="note">
   <strong class="user">osbertv at yahoo dot com</strong>
   <a href="#107031" class="date">29-Dec-2011 09:42</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Invoking a class inside a class results in an error.<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">class </span><span class="default">A<br />
</span><span class="keyword">{<br />
&nbsp;&nbsp;&nbsp; public function </span><span class="default">__invoke</span><span class="keyword">()<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="string">"Invoking A() Class"</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
}<br />
<br />
class </span><span class="default">B <br />
</span><span class="keyword">{<br />
&nbsp;&nbsp;&nbsp; public </span><span class="default">$a</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; public function </span><span class="default">__construct</span><span class="keyword">()<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">a </span><span class="keyword">= new </span><span class="default">A</span><span class="keyword">();<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; public function </span><span class="default">__invoke</span><span class="keyword">()<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="string">"Invoking B() Class"</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
}<br />
<br />
</span><span class="default">$a </span><span class="keyword">= new </span><span class="default">A</span><span class="keyword">();<br />
</span><span class="default">$b </span><span class="keyword">= new </span><span class="default">B</span><span class="keyword">();<br />
</span><span class="default">$a</span><span class="keyword">();<br />
</span><span class="default">$b</span><span class="keyword">();<br />
</span><span class="default">$b</span><span class="keyword">-&gt;</span><span class="default">a</span><span class="keyword">();<br />
<br />
</span><span class="default">?&gt;<br />
</span><br />
returns<br />
Invoking B() Class<br />
PHP Fatal error:&nbsp; Call to undefined method B::a()</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="104138""></a>
  <div class="note">
   <strong class="user">Wesley</strong>
   <a href="#104138" class="date">25-May-2011 12:10</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Warning __toString can be triggerd more then one time
<br />

<br />
<span class="default">&lt;?php
<br />
</span><span class="keyword">if(</span><span class="default">strstr</span><span class="keyword">(</span><span class="default">substr</span><span class="keyword">(</span><span class="default">$obj</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">1024</span><span class="keyword">), </span><span class="string">'somestuff'</span><span class="keyword">)
<br />
&nbsp;&nbsp;&nbsp; echo </span><span class="default">$obj</span><span class="keyword">;
<br />
return </span><span class="string">'missing somestuff at the start, create container!'</span><span class="keyword">;
<br />

<br />
</span><span class="default">substr</span><span class="keyword">() </span><span class="default">will trigger a __toString aswell </span><span class="keyword">as echo </span><span class="default">$obj</span><span class="keyword">;
<br />
</span><span class="default">?&gt;
<br />
</span>
<br />
wich cause a performance issue since it will gather all data twice.
<br />

<br />
what i used as a hotfix:
<br />

<br />
<span class="default">&lt;?php
<br />
__toString</span><span class="keyword">(){
<br />
&nbsp; if(</span><span class="default">null </span><span class="keyword">=== </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">sToString</span><span class="keyword">)
<br />
&nbsp;&nbsp; &nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">sToString </span><span class="keyword">= </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">_show</span><span class="keyword">();
<br />
&nbsp; return </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">sToString</span><span class="keyword">;
<br />
}
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="99058""></a>
  <div class="note">
   <strong class="user">Anonymous</strong>
   <a href="#99058" class="date">24-Jul-2010 07:41</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Concerning __set() with protected/private/overloaded properties, the behavior might not be so intuitive without knowing some underlying rules.&nbsp; Consider this test object for the following examples...<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">class </span><span class="default">A </span><span class="keyword">{<br />
&nbsp;&nbsp;&nbsp; protected </span><span class="default">$test_int </span><span class="keyword">= </span><span class="default">2</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; protected </span><span class="default">$test_array </span><span class="keyword">= array(</span><span class="string">'key' </span><span class="keyword">=&gt; </span><span class="string">'test'</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; protected </span><span class="default">$test_obj</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; function </span><span class="default">__construct</span><span class="keyword">() {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">test_obj </span><span class="keyword">= new </span><span class="default">stdClass</span><span class="keyword">();<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; function </span><span class="default">__get</span><span class="keyword">(</span><span class="default">$prop</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">$prop</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; function </span><span class="default">__set</span><span class="keyword">(</span><span class="default">$prop</span><span class="keyword">, </span><span class="default">$val</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">$prop </span><span class="keyword">= </span><span class="default">$val</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
</span><span class="default">$a </span><span class="keyword">= new </span><span class="default">A</span><span class="keyword">();<br />
<br />
</span><span class="default">?&gt;<br />
</span><br />
Combined Operators (.=, +=, *=, etc): you must also define a companion __get() method to grant write -and- read access to the property.&nbsp; Remember, "$x += $y" is shorthand for "$x = $x + $y".&nbsp; In other words, "__set($x, (__get($x) + $y))".<br />
<br />
Properties that are Arrays: attempting to set array values like "$a-&gt;test_array[] = 'asdf';" from outside this object will result in an "Indirect modification of overloaded property" notice and the operation completely ignored.&nbsp; You can't use '[]' for array value assignment in this context (with the exception only if you made __get() return by reference, in which case, it would work fine and bypass the __set() method altogether).&nbsp; You can work around this doing something like unioning the array instead:<br />
<br />
<span class="default">&lt;?php<br />
<br />
$a</span><span class="keyword">-&gt;</span><span class="default">test_array</span><span class="keyword">[] = </span><span class="string">'asdf'</span><span class="keyword">; </span><span class="comment">// notice given and ignored unless __get() was declared to return by reference<br />
</span><span class="default">$a</span><span class="keyword">-&gt;</span><span class="default">test_array </span><span class="keyword">+= array(</span><span class="default">1 </span><span class="keyword">=&gt; </span><span class="string">'asdf'</span><span class="keyword">); </span><span class="comment">// to add a key/value<br />
</span><span class="default">$a</span><span class="keyword">-&gt;</span><span class="default">test_array </span><span class="keyword">= array(</span><span class="string">"key" </span><span class="keyword">=&gt; </span><span class="string">'asdf'</span><span class="keyword">) + </span><span class="default">$a</span><span class="keyword">-&gt;</span><span class="default">test_array</span><span class="keyword">; </span><span class="comment">// to overwrite a&nbsp; key/value.<br />
<br />
</span><span class="default">?&gt;<br />
</span><br />
Properties that are Objects: as long as you have that __get() method, you can freely access and alter that sub object's own properties, bypassing __set() entirely.&nbsp; Remember, objects are assigned and passed by reference naturally. <br />
<br />
<span class="default">&lt;?php<br />
<br />
$a</span><span class="keyword">-&gt;</span><span class="default">test_obj</span><span class="keyword">-&gt;</span><span class="default">prop </span><span class="keyword">= </span><span class="default">1</span><span class="keyword">; </span><span class="comment">// fine if $a did not have a set method declared.<br />
<br />
</span><span class="default">?&gt;<br />
</span><br />
All above tested in 5.3.2.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="98963""></a>
  <div class="note">
   <strong class="user">tom</strong>
   <a href="#98963" class="date">18-Jul-2010 03:20</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Note a common pitfall when using __wakeup.
<br />

<br />
If you unserialize a datastructure, you may not rely on the parent object to have been fully unserialized by the time __wakeup is called. Example
<br />

<br />
<span class="default">&lt;?php
<br />
</span><span class="keyword">class </span><span class="default">A </span><span class="keyword">{
<br />
&nbsp;public </span><span class="default">$b</span><span class="keyword">;
<br />
&nbsp;public </span><span class="default">$name</span><span class="keyword">;
<br />
}
<br />

<br />
class </span><span class="default">B </span><span class="keyword">extends </span><span class="default">A </span><span class="keyword">{
<br />
&nbsp;public </span><span class="default">$parent</span><span class="keyword">;
<br />
&nbsp;public function </span><span class="default">__wakeup</span><span class="keyword">() {
<br />
&nbsp; </span><span class="default">var_dump</span><span class="keyword">(</span><span class="default">$parent</span><span class="keyword">-&gt;</span><span class="default">name</span><span class="keyword">);
<br />
&nbsp;}
<br />
}
<br />

<br />
</span><span class="default">$a </span><span class="keyword">= new </span><span class="default">A</span><span class="keyword">();
<br />
</span><span class="default">$a</span><span class="keyword">-&gt;</span><span class="default">name </span><span class="keyword">= </span><span class="string">"foo"</span><span class="keyword">;
<br />
</span><span class="default">$a</span><span class="keyword">-&gt;</span><span class="default">b </span><span class="keyword">= new </span><span class="default">B</span><span class="keyword">();
<br />
</span><span class="default">$a</span><span class="keyword">-&gt;</span><span class="default">b</span><span class="keyword">-&gt;</span><span class="default">parent </span><span class="keyword">= </span><span class="default">$a</span><span class="keyword">;
<br />
</span><span class="default">$s </span><span class="keyword">= </span><span class="default">serialize</span><span class="keyword">(</span><span class="default">$a</span><span class="keyword">);
<br />
</span><span class="default">$a </span><span class="keyword">= </span><span class="default">unserialize</span><span class="keyword">(</span><span class="default">$s</span><span class="keyword">);
<br />
</span><span class="default">?&gt;
<br />
</span>
<br />
Expected output: "foo".
<br />
Actual output: NULL.
<br />

<br />
Reason: $b is unserialized before $name. By the time B::__wakeup is called, $a-&gt;name does not yet have a value.
<br />

<br />
So be aware that the order in which your class variables are defined is important! You need to manually order them by dependencies - or write a __sleep function and order them by depencies there. (Currently I can't tell which option I hate more)</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="98691""></a>
  <div class="note">
   <strong class="user">Anonymous</strong>
   <a href="#98691" class="date">30-Jun-2010 09:29</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
C++-style operator overloading finally makes an appearance with the introduction to __invoke().&nbsp; Unfortunately, with just '()'.&nbsp; In that sense, it is no more useful than having a default class method (probably quite useful actually) and not having to type out an entire method name.&nbsp; Complimenting wbcarts at juno dot com's point class below, the following allows calculating distance between one or more graph points...<br />
<br />
<span class="default">&lt;?php<br />
<br />
</span><span class="keyword">class </span><span class="default">point </span><span class="keyword">{<br />
&nbsp;&nbsp;&nbsp; public </span><span class="default">$x</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; public </span><span class="default">$y</span><span class="keyword">;<br />
<br />
&nbsp;&nbsp;&nbsp; function </span><span class="default">__construct</span><span class="keyword">(</span><span class="default">$x</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">, </span><span class="default">$y</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">x </span><span class="keyword">= (int) </span><span class="default">$x</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">y </span><span class="keyword">= (int) </span><span class="default">$y</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; function </span><span class="default">__invoke</span><span class="keyword">() {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$args </span><span class="keyword">= </span><span class="default">func_get_args</span><span class="keyword">();<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$total_distance </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$current_loc </span><span class="keyword">= </span><span class="default">$this</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; foreach (</span><span class="default">$args </span><span class="keyword">as </span><span class="default">$arg</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">is_object</span><span class="keyword">(</span><span class="default">$arg</span><span class="keyword">) and (</span><span class="default">get_class</span><span class="keyword">(</span><span class="default">$arg</span><span class="keyword">) === </span><span class="default">get_class</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">))) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$total_distance </span><span class="keyword">+= </span><span class="default">sqrt</span><span class="keyword">(</span><span class="default">pow</span><span class="keyword">(</span><span class="default">$arg</span><span class="keyword">-&gt;</span><span class="default">x </span><span class="keyword">- </span><span class="default">$current_loc</span><span class="keyword">-&gt;</span><span class="default">x</span><span class="keyword">, </span><span class="default">2</span><span class="keyword">) + </span><span class="default">pow</span><span class="keyword">((int) </span><span class="default">$arg</span><span class="keyword">-&gt;</span><span class="default">y </span><span class="keyword">- </span><span class="default">$current_loc</span><span class="keyword">-&gt;</span><span class="default">y</span><span class="keyword">, </span><span class="default">2</span><span class="keyword">));<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$current_loc </span><span class="keyword">= </span><span class="default">$arg</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; else {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">trigger_error</span><span class="keyword">(</span><span class="string">"Arguments must be objects of this class."</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">$total_distance</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
</span><span class="default">$p1 </span><span class="keyword">= new </span><span class="default">point</span><span class="keyword">(</span><span class="default">1</span><span class="keyword">,</span><span class="default">1</span><span class="keyword">);<br />
</span><span class="default">$p2 </span><span class="keyword">= new </span><span class="default">point</span><span class="keyword">(</span><span class="default">23</span><span class="keyword">,-</span><span class="default">6</span><span class="keyword">);<br />
</span><span class="default">$p3 </span><span class="keyword">= new </span><span class="default">point</span><span class="keyword">(</span><span class="default">15</span><span class="keyword">,</span><span class="default">20</span><span class="keyword">);<br />
echo </span><span class="default">$p1</span><span class="keyword">(</span><span class="default">$p2</span><span class="keyword">,</span><span class="default">$p3</span><span class="keyword">,</span><span class="default">$p1</span><span class="keyword">); </span><span class="comment">// round trip 73.89<br />
<br />
</span><span class="default">?&gt;<br />
</span><br />
Functionally, __invoke() can also be used to mimic the use of variable functions.&nbsp; Sadly, attempting any calling of __invoke() on a static level will produce a fatal error.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="90194""></a>
  <div class="note">
   <strong class="user">rudie-de-hotblocks at osu1 dot php dot net</strong>
   <a href="#90194" class="date">09-Apr-2009 06:35</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Note also that the constructor is executed also, and before __set_state(), making this magic function less magic, imho, (except for the ability to assign private members).</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="87404""></a>
  <div class="note">
   <strong class="user">jsnell at e-normous dot com</strong>
   <a href="#87404" class="date">03-Dec-2008 02:01</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Be very careful to define __set_state() in classes which inherit from a parent using it, as the static __set_state() call will be called for any children.&nbsp; If you are not careful, you will end up with an object of the wrong type.&nbsp; Here is an example:
<br />

<br />
<span class="default">&lt;?php
<br />
</span><span class="keyword">class </span><span class="default">A
<br />
</span><span class="keyword">{
<br />
&nbsp;&nbsp;&nbsp; public </span><span class="default">$var1</span><span class="keyword">; 
<br />

<br />
&nbsp;&nbsp;&nbsp; public static function </span><span class="default">__set_state</span><span class="keyword">(</span><span class="default">$an_array</span><span class="keyword">)
<br />
&nbsp;&nbsp;&nbsp; {
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$obj </span><span class="keyword">= new </span><span class="default">A</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$obj</span><span class="keyword">-&gt;</span><span class="default">var1 </span><span class="keyword">= </span><span class="default">$an_array</span><span class="keyword">[</span><span class="string">'var1'</span><span class="keyword">];&nbsp; 
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">$obj</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; }
<br />
}
<br />

<br />
class </span><span class="default">B </span><span class="keyword">extends </span><span class="default">A </span><span class="keyword">{
<br />
}
<br />

<br />
</span><span class="default">$b </span><span class="keyword">= new </span><span class="default">B</span><span class="keyword">;
<br />
</span><span class="default">$b</span><span class="keyword">-&gt;</span><span class="default">var1 </span><span class="keyword">= </span><span class="default">5</span><span class="keyword">;
<br />

<br />
eval(</span><span class="string">'$new_b = ' </span><span class="keyword">. </span><span class="default">var_export</span><span class="keyword">(</span><span class="default">$b</span><span class="keyword">, </span><span class="default">true</span><span class="keyword">) . </span><span class="string">';'</span><span class="keyword">); 
<br />
</span><span class="default">var_dump</span><span class="keyword">(</span><span class="default">$new_b</span><span class="keyword">);
<br />
</span><span class="comment">/*
<br />
object(A)#2 (1) {
<br />
&nbsp; ["var1"]=&gt;
<br />
&nbsp; int(5)
<br />
}
<br />
*/
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="86111""></a>
  <div class="note">
   <strong class="user">jon at webignition dot net</strong>
   <a href="#86111" class="date">03-Oct-2008 07:26</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
The __toString() method is extremely useful for converting class attribute names and values into common string representations of data (of which there are many choices). I mention this as previous references to __toString() refer only to debugging uses.<br />
<br />
I have previously used the __toString() method in the following ways:<br />
<br />
&nbsp;- representing a data-holding object as:<br />
&nbsp;&nbsp; - XML<br />
&nbsp;&nbsp; - raw POST data<br />
&nbsp;&nbsp; - a GET query string<br />
&nbsp;&nbsp; - header name:value pairs<br />
<br />
&nbsp;- representing a custom mail object as an actual email (headers then body, all correctly represented)<br />
<br />
When creating a class, consider what possible standard string representations are available and, of those, which would be the most relevant with respect to the purpose of the class.<br />
<br />
Being able to represent data-holding objects in standardised string forms makes it much easier for your internal representations of data to be shared in an interoperable way with other applications.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="83556""></a>
  <div class="note">
   <strong class="user">Anonymous</strong>
   <a href="#83556" class="date">31-May-2008 04:24</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Serializing objects is problematic with references. This is solved redefining the __sleep() magic method. This is also problematic when parent class has private variables since the parent object is not accessible nor its private variables from within the child object.<br />
<br />
I found a solution that seems working for classes that implements this __sleep() method, and for its subclasses. Without more work in subclasses. The inheritance system does the trick.<br />
<br />
Recursively __sleep() call parent' __sleep() and return the whole array of variables of the object instance to be serialized.<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">class </span><span class="default">foo </span><span class="keyword">{<br />
}<br />
<br />
class </span><span class="default">a </span><span class="keyword">{<br />
&nbsp; private </span><span class="default">$var1</span><span class="keyword">;<br />
<br />
&nbsp; function </span><span class="default">__construct</span><span class="keyword">(</span><span class="default">foo </span><span class="keyword">&amp;</span><span class="default">$obj </span><span class="keyword">= </span><span class="default">NULL</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">var1 </span><span class="keyword">= &amp;</span><span class="default">$obj</span><span class="keyword">;<br />
&nbsp; }<br />
<br />
&nbsp; </span><span class="comment">/** Return its variables array, if its parent exists and the __sleep method is accessible, call it and push the result into the array and return the whole thing. */<br />
&nbsp; </span><span class="keyword">public function </span><span class="default">__sleep</span><span class="keyword">() {<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$a </span><span class="keyword">= </span><span class="default">array_keys</span><span class="keyword">(</span><span class="default">get_object_vars</span><span class="keyword">(&amp;</span><span class="default">$this</span><span class="keyword">));<br />
&nbsp;&nbsp;&nbsp; if (</span><span class="default">method_exists</span><span class="keyword">(</span><span class="default">parent</span><span class="keyword">, </span><span class="string">'__sleep'</span><span class="keyword">)) {<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">$p </span><span class="keyword">= </span><span class="default">parent</span><span class="keyword">::</span><span class="default">__sleep</span><span class="keyword">();<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">array_push</span><span class="keyword">(</span><span class="default">$a</span><span class="keyword">, </span><span class="default">$p</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; };<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">$a</span><span class="keyword">;<br />
&nbsp; }<br />
}<br />
<br />
class </span><span class="default">b </span><span class="keyword">extends </span><span class="default">a </span><span class="keyword">{<br />
&nbsp; function </span><span class="default">__construct</span><span class="keyword">(</span><span class="default">foo </span><span class="keyword">&amp;</span><span class="default">$obj </span><span class="keyword">= </span><span class="default">NULL</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">parent</span><span class="keyword">::</span><span class="default">__construct</span><span class="keyword">(</span><span class="default">$obj</span><span class="keyword">);<br />
&nbsp; }<br />
}<br />
<br />
</span><span class="default">session_start</span><span class="keyword">();<br />
</span><span class="default">$myfoo </span><span class="keyword">= &amp;new </span><span class="default">foo</span><span class="keyword">();<br />
</span><span class="default">$myb </span><span class="keyword">= &amp;new </span><span class="default">b</span><span class="keyword">(</span><span class="default">$myfoo</span><span class="keyword">);<br />
</span><span class="default">$myb </span><span class="keyword">= </span><span class="default">unserialize</span><span class="keyword">(</span><span class="default">serialize</span><span class="keyword">(&amp;</span><span class="default">$myb</span><span class="keyword">));<br />
</span><span class="default">?&gt;<br />
</span><br />
This should work, I haven't tested deeper.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="83110""></a>
  <div class="note">
   <strong class="user">yanleech at gmail dot com</strong>
   <a href="#83110" class="date">10-May-2008 06:24</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Maybe we can using unserialize() &amp; __wakeup() instead "new" when creating a new instance of class.<br />
<br />
Consider following codes:<br />
<br />
class foo<br />
{<br />
&nbsp;&nbsp;&nbsp; static public $WAKEUP_STR = 'O:3:"foo":0:{}';<br />
&nbsp;&nbsp;&nbsp; public function foo(){}<br />
&nbsp;&nbsp;&nbsp; public function bar(){}<br />
}<br />
<br />
$foo = unserialize(foo::$WAKEUP_STR);</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="82629""></a>
  <div class="note">
   <strong class="user">michal dot kocarek at seznam dot cz</strong>
   <a href="#82629" class="date">18-Apr-2008 02:34</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Remember that setters and getters (__set, __get) will work in your class as long as you NOT SET the property with given name.<br />
<br />
If you still want to have the public property definition in the class source code (phpDocumentor, editor code completition, or any other reason) when using these magic methods, simply unset() your public properties inside the constructor.<br />
__set/__get function will be called and code reader will see at first sight, which public properties are available.<br />
<br />
Example:<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">class </span><span class="default">user </span><span class="keyword">{<br />
&nbsp;&nbsp; </span><span class="comment">/**<br />
&nbsp;&nbsp;&nbsp; * @var int Gets and sets the user ID<br />
&nbsp;&nbsp;&nbsp; */<br />
&nbsp;&nbsp; </span><span class="keyword">public </span><span class="default">$UserID</span><span class="keyword">;<br />
&nbsp;&nbsp; private </span><span class="default">$_userID</span><span class="keyword">;<br />
<br />
&nbsp;&nbsp; public function </span><span class="default">__construct</span><span class="keyword">() {<br />
<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="comment">// All the magic is in single line:<br />
&nbsp;&nbsp; &nbsp;&nbsp; // We unset public property, so our setters and getters<br />
&nbsp;&nbsp; &nbsp;&nbsp; // are used and phpDoc and editors with code completition are happy<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="keyword">unset(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">UserID</span><span class="keyword">);<br />
<br />
&nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp; public function </span><span class="default">__set</span><span class="keyword">(</span><span class="default">$key</span><span class="keyword">, </span><span class="default">$value</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="comment">// assign value for key UserID to _userID property<br />
&nbsp;&nbsp; </span><span class="keyword">}<br />
<br />
&nbsp;&nbsp; public function </span><span class="default">__get</span><span class="keyword">(</span><span class="default">$key</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="comment">// return value of _userID for UserID property<br />
&nbsp;&nbsp; </span><span class="keyword">}<br />
}<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="81492""></a>
  <div class="note">
   <strong class="user">dhuseby domain getback tld com</strong>
   <a href="#81492" class="date">29-Feb-2008 06:22</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
The above hint for using array_keys((array)$obj) got me investigating how to get __sleep to really work with object hierarchies.<br />
<br />
With PHP 5.2.3, If you want to serialize an object that is part of an object hierarchy and you want to selectively serialize members (public, private, and protected) by manually specifying the array of members, there are a few simple rules for naming members that you must follow:<br />
<br />
1. public members should be named using just their member name, like so:<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">class </span><span class="default">Foo </span><span class="keyword">{<br />
&nbsp;&nbsp;&nbsp; public </span><span class="default">$bar</span><span class="keyword">;<br />
<br />
&nbsp;&nbsp;&nbsp; public function </span><span class="default">__sleep</span><span class="keyword">() {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return array(</span><span class="string">"bar"</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }<br />
}<br />
</span><span class="default">?&gt;<br />
</span><br />
2. protected members should be named using "\0" . "*" . "\0" . member name, like so:<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">class </span><span class="default">Foo </span><span class="keyword">{<br />
&nbsp;&nbsp;&nbsp; protected </span><span class="default">$bar</span><span class="keyword">;<br />
<br />
&nbsp;&nbsp;&nbsp; public function </span><span class="default">__sleep</span><span class="keyword">() {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return array(</span><span class="string">"\0*\0bar"</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }<br />
}<br />
</span><span class="default">?&gt;<br />
</span><br />
3. private members should be named using "\0" . class name . "\0" . member name, like so:<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">class </span><span class="default">Foo </span><span class="keyword">{<br />
&nbsp;&nbsp;&nbsp; private </span><span class="default">$bar</span><span class="keyword">;<br />
<br />
&nbsp;&nbsp;&nbsp; public function </span><span class="default">__sleep</span><span class="keyword">() {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return array(</span><span class="string">"\0Foo\0bar"</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }<br />
}<br />
</span><span class="default">?&gt;<br />
</span><br />
So with this information let us serialize a class hierarchy correctly:<br />
<br />
<span class="default">&lt;?php<br />
<br />
</span><span class="keyword">class </span><span class="default">Base </span><span class="keyword">{<br />
&nbsp;&nbsp;&nbsp; private </span><span class="default">$foo </span><span class="keyword">= </span><span class="string">"foo_value"</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; protected </span><span class="default">$bar </span><span class="keyword">= </span><span class="string">"bar_value"</span><span class="keyword">;<br />
<br />
&nbsp;&nbsp;&nbsp; public function </span><span class="default">__sleep</span><span class="keyword">() {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return array(</span><span class="string">"\0Base\0foo"</span><span class="keyword">, </span><span class="string">"\0*\0bar"</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }<br />
}<br />
<br />
class </span><span class="default">Derived </span><span class="keyword">extends </span><span class="default">Base </span><span class="keyword">{<br />
&nbsp;&nbsp;&nbsp; public </span><span class="default">$baz </span><span class="keyword">= </span><span class="string">"baz_value"</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; private </span><span class="default">$boo </span><span class="keyword">= </span><span class="string">"boo_value"</span><span class="keyword">;<br />
<br />
&nbsp;&nbsp;&nbsp; public function </span><span class="default">__sleep</span><span class="keyword">() {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// we have to merge our members with our parent's<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">return </span><span class="default">array_merge</span><span class="keyword">(array(</span><span class="string">"baz"</span><span class="keyword">, </span><span class="string">"\0Derived\0boo"</span><span class="keyword">), </span><span class="default">parent</span><span class="keyword">::</span><span class="default">__sleep</span><span class="keyword">());<br />
&nbsp;&nbsp;&nbsp; }<br />
}<br />
<br />
class </span><span class="default">Leaf </span><span class="keyword">extends </span><span class="default">Derived </span><span class="keyword">{<br />
&nbsp;&nbsp;&nbsp; private </span><span class="default">$qux </span><span class="keyword">= </span><span class="string">"qux_value"</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; protected </span><span class="default">$zaz </span><span class="keyword">= </span><span class="string">"zaz_value"</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; public </span><span class="default">$blah </span><span class="keyword">= </span><span class="string">"blah_value"</span><span class="keyword">;<br />
<br />
&nbsp;&nbsp;&nbsp; public function </span><span class="default">__sleep</span><span class="keyword">() {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// again, merge our members with our parent's<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">return </span><span class="default">array_merge</span><span class="keyword">(array(</span><span class="string">"\0Leaf\0qux"</span><span class="keyword">, </span><span class="string">"\0*\0zaz"</span><span class="keyword">, </span><span class="string">"blah"</span><span class="keyword">), </span><span class="default">parent</span><span class="keyword">::</span><span class="default">__sleep</span><span class="keyword">());<br />
&nbsp;&nbsp;&nbsp; }<br />
}<br />
<br />
</span><span class="comment">// test it<br />
</span><span class="default">$test </span><span class="keyword">= new </span><span class="default">Leaf</span><span class="keyword">();<br />
</span><span class="default">$s </span><span class="keyword">= </span><span class="default">serialize</span><span class="keyword">(</span><span class="default">$test</span><span class="keyword">);<br />
</span><span class="default">$test2 </span><span class="keyword">= </span><span class="default">unserialize</span><span class="keyword">(</span><span class="default">$s</span><span class="keyword">);<br />
echo </span><span class="default">$s</span><span class="keyword">;<br />
</span><span class="default">print_r</span><span class="keyword">(</span><span class="default">$test</span><span class="keyword">);<br />
</span><span class="default">print_r</span><span class="keyword">(</span><span class="default">$test2</span><span class="keyword">);<br />
<br />
</span><span class="default">?&gt;<br />
</span><br />
Now if you comment out all of the __sleep() functions and output the serialized string, you will see that the output doesn't change.&nbsp; The most important part of course is that with the proper __sleep() functions, we can unserialize the string and get a properly set up object.<br />
<br />
I hope this solves the mystery for everybody.&nbsp; __sleep() does work, if you use it correctly :-)</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="75010""></a>
  <div class="note">
   <strong class="user">Travis Swicegood</strong>
   <a href="#75010" class="date">08-May-2007 07:43</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
There is no need to use eval() to mimic mixins (i.e., multiple inheritance) within PHP 5.&nbsp; You only need to:<br />
<br />
<span class="default">&lt;?php<br />
<br />
</span><span class="keyword">class </span><span class="default">MyClass<br />
</span><span class="keyword">{<br />
&nbsp;&nbsp;&nbsp; private </span><span class="default">$_obj </span><span class="keyword">= </span><span class="default">null</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; public function </span><span class="default">__construct</span><span class="keyword">(</span><span class="default">$obj</span><span class="keyword">)<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">_obj </span><span class="keyword">= </span><span class="default">$obj</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp;&nbsp; public function </span><span class="default">__call</span><span class="keyword">(</span><span class="default">$method</span><span class="keyword">, </span><span class="default">$args</span><span class="keyword">)<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (!</span><span class="default">method_exists</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">_obj</span><span class="keyword">, </span><span class="default">$method</span><span class="keyword">)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; throw new </span><span class="default">Exception</span><span class="keyword">(</span><span class="string">"unknown method [</span><span class="default">$method</span><span class="string">]"</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">call_user_func_array</span><span class="keyword">(<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; array(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">_obj</span><span class="keyword">, </span><span class="default">$method</span><span class="keyword">),<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$args<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }<br />
}<br />
<br />
</span><span class="default">?&gt;<br />
</span><br />
You could just as easily add an addMixin() method that would allow you to add multiple objects to an array, and then iterate over that array until you found the right method.&nbsp; As noted, these are referred to as a Mixins in other languages.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="72532""></a>
  <div class="note">
   <strong class="user">Dérico Filho</strong>
   <a href="#72532" class="date">23-Jan-2007 07:33</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Since PHP 5.2.0, you'll always get an error like this:<br />
"Object of class foo could not be converted to string"<br />
<br />
When one tries to use an object as string, for instance:<br />
<br />
class Test{}<br />
echo new Test();<br />
<br />
Thus, one way to avoid this problem is to programme the magic method __toString.<br />
<br />
However, in the older versions, it would output a string saying that it was an object together a unique obj id. Therefore, the __toString() method must comply with this behaviour.<br />
<br />
My suggestion:<br />
<br />
class Test{<br />
&nbsp;&nbsp;&nbsp; function __toString(){<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if(!isset($this-&gt;__uniqid))<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $this-&gt;__uniqid = md5(uniqid(rand(), true));<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return(get_class($this)."@".$this-&gt;__uniqid);<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
}<br />
<br />
echo new Test();<br />
<br />
would output something like this:<br />
<br />
Test@6006ba04f5569544c10a588b04849cf7</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="63863""></a>
  <div class="note">
   <strong class="user">rayRO</strong>
   <a href="#63863" class="date">02-Apr-2006 09:55</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you use the Magical Method '__set()', be shure that the call of<br />
<span class="default">&lt;?php<br />
$myobject</span><span class="keyword">-&gt;</span><span class="default">test</span><span class="keyword">[</span><span class="string">'myarray'</span><span class="keyword">] = </span><span class="string">'data'</span><span class="keyword">;<br />
</span><span class="default">?&gt;<br />
</span>will not appear!<br />
<br />
For that u have to do it the fine way if you want to use __set Method ;)<br />
<span class="default">&lt;?php<br />
$myobject</span><span class="keyword">-&gt;</span><span class="default">test </span><span class="keyword">= array(</span><span class="string">'myarray' </span><span class="keyword">=&gt; </span><span class="string">'data'</span><span class="keyword">);<br />
</span><span class="default">?&gt;<br />
</span><br />
If a Variable is already set, the __set Magic Method already wont appear!<br />
<br />
My first solution was to use a Caller Class.<br />
With that, i ever knew which Module i currently use!<br />
But who needs it... :]<br />
There are quiet better solutions for this...<br />
Here's the Code:<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">class </span><span class="default">Caller </span><span class="keyword">{<br />
&nbsp;&nbsp;&nbsp; public </span><span class="default">$caller</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; public </span><span class="default">$module</span><span class="keyword">;<br />
<br />
&nbsp;&nbsp;&nbsp; function </span><span class="default">__call</span><span class="keyword">(</span><span class="default">$funcname</span><span class="keyword">, </span><span class="default">$args </span><span class="keyword">= array()) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">setModuleInformation</span><span class="keyword">();<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">is_object</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">caller</span><span class="keyword">) &amp;&amp; </span><span class="default">function_exists</span><span class="keyword">(</span><span class="string">'call_user_func_array'</span><span class="keyword">))<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$return </span><span class="keyword">= </span><span class="default">call_user_func_array</span><span class="keyword">(array(&amp;</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">caller</span><span class="keyword">, </span><span class="default">$funcname</span><span class="keyword">), </span><span class="default">$args</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; else<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">trigger_error</span><span class="keyword">(</span><span class="string">"Call to Function with call_user_func_array failed"</span><span class="keyword">, </span><span class="default">E_USER_ERROR</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">unsetModuleInformation</span><span class="keyword">();<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">$return</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp;&nbsp; function </span><span class="default">__construct</span><span class="keyword">(</span><span class="default">$callerClassName </span><span class="keyword">= </span><span class="default">false</span><span class="keyword">, </span><span class="default">$callerModuleName </span><span class="keyword">= </span><span class="string">'Webboard'</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">$callerClassName </span><span class="keyword">== </span><span class="default">false</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">trigger_error</span><span class="keyword">(</span><span class="string">'No Classname'</span><span class="keyword">, </span><span class="default">E_USER_ERROR</span><span class="keyword">);<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">module </span><span class="keyword">= </span><span class="default">$callerModuleName</span><span class="keyword">;<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">class_exists</span><span class="keyword">(</span><span class="default">$callerClassName</span><span class="keyword">))<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">caller </span><span class="keyword">= new </span><span class="default">$callerClassName</span><span class="keyword">();<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; else<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">trigger_error</span><span class="keyword">(</span><span class="string">'Class not exists: \''</span><span class="keyword">.</span><span class="default">$callerClassName</span><span class="keyword">.</span><span class="string">'\''</span><span class="keyword">, </span><span class="default">E_USER_ERROR</span><span class="keyword">);<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">is_object</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">caller</span><span class="keyword">))<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">setModuleInformation</span><span class="keyword">();<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">method_exists</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">caller</span><span class="keyword">, </span><span class="string">'__init'</span><span class="keyword">))<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">caller</span><span class="keyword">-&gt;</span><span class="default">__init</span><span class="keyword">();<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">unsetModuleInformation</span><span class="keyword">();<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; else<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">trigger_error</span><span class="keyword">(</span><span class="string">'Caller is no object!'</span><span class="keyword">, </span><span class="default">E_USER_ERROR</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp;&nbsp; function </span><span class="default">__destruct</span><span class="keyword">() {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">setModuleInformation</span><span class="keyword">();<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">method_exists</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">caller</span><span class="keyword">, </span><span class="string">'__deinit'</span><span class="keyword">))<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">caller</span><span class="keyword">-&gt;</span><span class="default">__deinit</span><span class="keyword">();<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">unsetModuleInformation</span><span class="keyword">();<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp;&nbsp; function </span><span class="default">__isset</span><span class="keyword">(</span><span class="default">$isset</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">setModuleInformation</span><span class="keyword">();<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">is_object</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">caller</span><span class="keyword">))<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$return </span><span class="keyword">= isset(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">caller</span><span class="keyword">-&gt;{</span><span class="default">$isset</span><span class="keyword">});<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; else<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">trigger_error</span><span class="keyword">(</span><span class="string">'Caller is no object!'</span><span class="keyword">, </span><span class="default">E_USER_ERROR</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">unsetModuleInformation</span><span class="keyword">();<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">$return</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp;&nbsp; function </span><span class="default">__unset</span><span class="keyword">(</span><span class="default">$unset</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">setModuleInformation</span><span class="keyword">();<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">is_object</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">caller</span><span class="keyword">)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (isset(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">caller</span><span class="keyword">-&gt;{</span><span class="default">$unset</span><span class="keyword">}))<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; unset(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">caller</span><span class="keyword">-&gt;{</span><span class="default">$unset</span><span class="keyword">});<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; else<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">trigger_error</span><span class="keyword">(</span><span class="string">'Caller is no object!'</span><span class="keyword">, </span><span class="default">E_USER_ERROR</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">unsetModuleInformation</span><span class="keyword">();<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp;&nbsp; function </span><span class="default">__set</span><span class="keyword">(</span><span class="default">$set</span><span class="keyword">, </span><span class="default">$val</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">setModuleInformation</span><span class="keyword">();<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">is_object</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">caller</span><span class="keyword">))<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">caller</span><span class="keyword">-&gt;{</span><span class="default">$set</span><span class="keyword">} = </span><span class="default">$val</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; else<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">trigger_error</span><span class="keyword">(</span><span class="string">'Caller is no object!'</span><span class="keyword">, </span><span class="default">E_USER_ERROR</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">unsetModuleInformation</span><span class="keyword">();<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp;&nbsp; function </span><span class="default">__get</span><span class="keyword">(</span><span class="default">$get</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">setModuleInformation</span><span class="keyword">();<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">is_object</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">caller</span><span class="keyword">)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (isset(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">caller</span><span class="keyword">-&gt;{</span><span class="default">$get</span><span class="keyword">}))<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$return </span><span class="keyword">= </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">caller</span><span class="keyword">-&gt;{</span><span class="default">$get</span><span class="keyword">};<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; else<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$return </span><span class="keyword">= </span><span class="default">false</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; else<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">trigger_error</span><span class="keyword">(</span><span class="string">'Caller is no object!'</span><span class="keyword">, </span><span class="default">E_USER_ERROR</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">unsetModuleInformation</span><span class="keyword">();<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">$return</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; function </span><span class="default">setModuleInformation</span><span class="keyword">() {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">caller</span><span class="keyword">-&gt;</span><span class="default">module </span><span class="keyword">= </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">module</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp;&nbsp; function </span><span class="default">unsetModuleInformation</span><span class="keyword">() {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">caller</span><span class="keyword">-&gt;</span><span class="default">module </span><span class="keyword">= </span><span class="default">NULL</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
}<br />
<br />
</span><span class="comment">// Well this can be a Config Class?<br />
</span><span class="keyword">class </span><span class="default">Config </span><span class="keyword">{<br />
&nbsp;&nbsp;&nbsp; public </span><span class="default">$module</span><span class="keyword">;<br />
<br />
&nbsp;&nbsp;&nbsp; public </span><span class="default">$test</span><span class="keyword">;<br />
<br />
&nbsp;&nbsp;&nbsp; function </span><span class="default">__construct</span><span class="keyword">()<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; print(</span><span class="string">'Constructor will have no Module Information... Use __init() instead!&lt;br /&gt;'</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; print(</span><span class="string">'--&gt; '</span><span class="keyword">.</span><span class="default">print_r</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">module</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">).</span><span class="string">' &lt;--'</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; print(</span><span class="string">'&lt;br /&gt;'</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; print(</span><span class="string">'&lt;br /&gt;'</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">test </span><span class="keyword">= </span><span class="string">'123'</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; function </span><span class="default">__init</span><span class="keyword">()<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; print(</span><span class="string">'Using of __init()!&lt;br /&gt;'</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; print(</span><span class="string">'--&gt; '</span><span class="keyword">.</span><span class="default">print_r</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">module</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">).</span><span class="string">' &lt;--'</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; print(</span><span class="string">'&lt;br /&gt;'</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; print(</span><span class="string">'&lt;br /&gt;'</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; function </span><span class="default">testFunction</span><span class="keyword">(</span><span class="default">$test </span><span class="keyword">= </span><span class="default">false</span><span class="keyword">)<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">$test </span><span class="keyword">!= </span><span class="default">false</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">test </span><span class="keyword">= </span><span class="default">$test</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
}<br />
<br />
echo(</span><span class="string">'&lt;pre&gt;'</span><span class="keyword">);<br />
</span><span class="default">$wow </span><span class="keyword">= new </span><span class="default">Caller</span><span class="keyword">(</span><span class="string">'Config'</span><span class="keyword">, </span><span class="string">'Guestbook'</span><span class="keyword">);<br />
</span><span class="default">print_r</span><span class="keyword">(</span><span class="default">$wow</span><span class="keyword">-&gt;</span><span class="default">test</span><span class="keyword">);<br />
print(</span><span class="string">'&lt;br /&gt;'</span><span class="keyword">);<br />
print(</span><span class="string">'&lt;br /&gt;'</span><span class="keyword">);<br />
</span><span class="default">$wow</span><span class="keyword">-&gt;</span><span class="default">test </span><span class="keyword">= </span><span class="string">'456'</span><span class="keyword">;<br />
</span><span class="default">print_r</span><span class="keyword">(</span><span class="default">$wow</span><span class="keyword">-&gt;</span><span class="default">test</span><span class="keyword">);<br />
print(</span><span class="string">'&lt;br /&gt;'</span><span class="keyword">);<br />
print(</span><span class="string">'&lt;br /&gt;'</span><span class="keyword">);<br />
</span><span class="default">$wow</span><span class="keyword">-&gt;</span><span class="default">testFunction</span><span class="keyword">(</span><span class="string">'789'</span><span class="keyword">);<br />
</span><span class="default">print_r</span><span class="keyword">(</span><span class="default">$wow</span><span class="keyword">-&gt;</span><span class="default">test</span><span class="keyword">);<br />
print(</span><span class="string">'&lt;br /&gt;'</span><span class="keyword">);<br />
print(</span><span class="string">'&lt;br /&gt;'</span><span class="keyword">);<br />
</span><span class="default">print_r</span><span class="keyword">(</span><span class="default">$wow</span><span class="keyword">-&gt;</span><span class="default">module</span><span class="keyword">);<br />
echo(</span><span class="string">'&lt;/pre&gt;'</span><span class="keyword">);<br />
</span><span class="default">?&gt;<br />
</span><br />
Outputs something Like:<br />
<br />
Constructor will have no Module Information... Use __init() instead!<br />
--&gt;&nbsp; &lt;--<br />
<br />
Using of __init()!<br />
--&gt; Guestbook &lt;--<br />
<br />
123<br />
<br />
456<br />
<br />
789<br />
<br />
Guestbook</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="59560""></a>
  <div class="note">
   <strong class="user">docey</strong>
   <a href="#59560" class="date">09-Dec-2005 08:44</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
about __sleep and _wakeup, consider using a method like this:<br />
<br />
class core<br />
{<br />
<br />
&nbsp;var $sub_core; //ref of subcore<br />
&nbsp;var $_sleep_subcore; // place where serialize version of sub_core will be stored<br />
<br />
&nbsp;function core(){<br />
&nbsp; $this-&gt;sub_core = new sub_core();<br />
&nbsp; return true;<br />
&nbsp;}<br />
<br />
&nbsp;function __wakeup()<br />
&nbsp;{<br />
&nbsp; // on wakeup of core, core unserializes sub_core<br />
&nbsp; // wich it had stored when it was serialized itself<br />
&nbsp; $this-&gt;sub_core = unserialize($this-&gt;_sleep_subcore);<br />
&nbsp; return true;<br />
&nbsp;}<br />
<br />
&nbsp;function __sleep()<br />
&nbsp;{<br />
&nbsp; // sub_core will be serialized when core is serialized.<br />
&nbsp; // the serialized subcore will be stored as a string inside core.<br />
&nbsp;&nbsp; $this-&gt;_sleep_subcore = serialize($this-&gt;sub_core);<br />
&nbsp;&nbsp; $return_arr[] = "_sleep_subcore";<br />
&nbsp;&nbsp; return $return_arr;<br />
&nbsp;}<br />
<br />
}<br />
<br />
class sub_core<br />
{<br />
&nbsp;var $info;<br />
<br />
&nbsp;function sub_core()<br />
&nbsp;{<br />
&nbsp; $this-&gt;info["somedata"] = "somedata overhere"<br />
&nbsp;}<br />
<br />
&nbsp;function __wakeup()<br />
&nbsp;{<br />
&nbsp; return true;<br />
&nbsp;}<br />
<br />
&nbsp;function __sleep()<br />
&nbsp;{<br />
&nbsp; $return_arr[] = "info"<br />
&nbsp; return $return_arr; <br />
&nbsp;}<br />
<br />
}<br />
<br />
this way subcore is being serialized by core when core is being serialized. subcore handles its own data and core stores it as a serialize string inside itself. on wakeup core unserializes subcore. <br />
<br />
this may have a performance cost, but if you have many objects connected this way this is the best way of serializing them. you only need to serialize the the main object wich will serialize all those below which will serialize all those below them again. in effect causing a sort of chainreaction in wich each object takes care of its own info.<br />
<br />
offcoarse you always need to store the eventualy serialized string in a safe place. somebody got experience with this way of __wakeup and __sleep. <br />
<br />
works in PHP4&amp;5</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="55844""></a>
  <div class="note">
   <strong class="user">martin dot goldinger at netserver dot ch</strong>
   <a href="#55844" class="date">15-Aug-2005 04:47</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
When you use sessions, its very important to keep the sessiondata small, due to low performance with unserialize. Every class shoud extend from this class. The result will be, that no null Values are written to the sessiondata. It will increase performance.<br />
<br />
&lt;?<br />
class BaseObject<br />
{<br />
&nbsp;&nbsp;&nbsp; function __sleep()<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $vars = (array)$this;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; foreach ($vars as $key =&gt; $val)<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (is_null($val))<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; unset($vars[$key]);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }&nbsp; &nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return array_keys($vars);<br />
&nbsp;&nbsp;&nbsp; }<br />
};<br />
?&gt;</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="55806""></a>
  <div class="note">
   <strong class="user">jeffxlevy at gmail dot com</strong>
   <a href="#55806" class="date">13-Aug-2005 06:26</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Intriguing what happens when __sleep() and __wakeup() and sessions() are mixed. I had a hunch that, as session data is serialized, __sleep would be called when an object, or whatever, is stored in _SESSION. true. The same hunch applied when session_start() was called. Would __wakeup() be called? True. Very helpful, specifically as I'm building massive objects (well, lots of simple objects stored in sessions), and need lots of automated tasks (potentially) reloaded at "wakeup" time. (for instance, restarting a database session/connection).</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="55783""></a>
  <div class="note">
   <strong class="user">mastabog at hotmail dot com</strong>
   <a href="#55783" class="date">12-Aug-2005 05:06</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
In reply to krisj1010 at gmail.com below:
<br />

<br />
__sleep() handles protected/private properties very well. You should never rely on get_class_vars() to retrieve property names since this function only returns the public properties. Use the Reflection API instead for that purpose. Better yet, if you know which ones you want to save it is always faster to specify the return array manually.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="49413""></a>
  <div class="note">
   <strong class="user">ddavenport at newagedigital dot com</strong>
   <a href="#49413" class="date">26-Jan-2005 11:09</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
One of the principles of OOP is encapsulation--the idea that an object should handle its own data and no others'.&nbsp; Asking base classes to take care of subclasses' data, esp considering that a class can't possibly know how many dozens of ways it will be extended, is irresponsible and dangerous.<br />
<br />
Consider the following...<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">class </span><span class="default">SomeStupidStorageClass<br />
</span><span class="keyword">{<br />
&nbsp; public function </span><span class="default">getContents</span><span class="keyword">(</span><span class="default">$pos</span><span class="keyword">, </span><span class="default">$len</span><span class="keyword">) { ...</span><span class="default">stuff</span><span class="keyword">... }<br />
}<br />
<br />
class </span><span class="default">CryptedStorageClass </span><span class="keyword">extends </span><span class="default">SomeStupidStorageClass<br />
</span><span class="keyword">{<br />
&nbsp; private </span><span class="default">$decrypted_block</span><span class="keyword">;<br />
&nbsp; public function </span><span class="default">getContents</span><span class="keyword">(</span><span class="default">$pos</span><span class="keyword">, </span><span class="default">$len</span><span class="keyword">) { ...</span><span class="default">decrypt</span><span class="keyword">... }<br />
}<br />
</span><span class="default">?&gt;<br />
</span><br />
If SomeStupidStorageClass decided to serialize its subclasses' data as well as its own, a portion of what was once an encrypted thingie could be stored, in the clear, wherever the thingie was stored.&nbsp; Obviously, CryptedStorageClass would never have chosen this...but it had to either know how to serialize its parent class's data without calling parent::_sleep(), or let the base class do what it wanted to.<br />
<br />
Considering encapsulation again, no class should have to know how the parent handles its own private data.&nbsp; And it certainly shouldn't have to worry that users will find a way to break access controls in the name of convenience.<br />
<br />
If a class wants both to have private/protected data and to survive serialization, it should have its own __sleep() method which asks the parent to report its own fields and then adds to the list if applicable.&nbsp; Like so....<br />
<br />
<span class="default">&lt;?php<br />
<br />
</span><span class="keyword">class </span><span class="default">BetterClass<br />
</span><span class="keyword">{<br />
&nbsp; private </span><span class="default">$content</span><span class="keyword">;<br />
<br />
&nbsp; public function </span><span class="default">__sleep</span><span class="keyword">()<br />
&nbsp; {<br />
&nbsp;&nbsp;&nbsp; return array(</span><span class="string">'basedata1'</span><span class="keyword">, </span><span class="string">'basedata2'</span><span class="keyword">);<br />
&nbsp; }<br />
<br />
&nbsp; public function </span><span class="default">getContents</span><span class="keyword">() { ...</span><span class="default">stuff</span><span class="keyword">... }<br />
}<br />
<br />
class </span><span class="default">BetterDerivedClass </span><span class="keyword">extends </span><span class="default">BetterClass<br />
</span><span class="keyword">{<br />
&nbsp; private </span><span class="default">$decrypted_block</span><span class="keyword">;<br />
<br />
&nbsp; public function </span><span class="default">__sleep</span><span class="keyword">()<br />
&nbsp; {<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">parent</span><span class="keyword">::</span><span class="default">__sleep</span><span class="keyword">();<br />
&nbsp; }<br />
<br />
&nbsp; public function </span><span class="default">getContents</span><span class="keyword">() { ...</span><span class="default">decrypt</span><span class="keyword">... }<br />
}<br />
<br />
</span><span class="default">?&gt;<br />
</span><br />
The derived class has better control over its data, and we don't have to worry about something being stored that shouldn't be.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="48849""></a>
  <div class="note">
   <strong class="user">krisj1010 at gmail.com</strong>
   <a href="#48849" class="date">09-Jan-2005 12:09</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you are attempting to write an abstract/base class which automates the __sleep process in PHP5 you will run into some trouble if the subclasses which are being serialized have private/protected variables you need to be serialized.&nbsp; <br />
<br />
The reason is, even though get_class($this) within the base class will return the subclass -- get_class_vars(get_class($this)) will *not* return the subclass' protected/private variables.&nbsp; Which makes sense -- using OO principles.&nbsp; <br />
<br />
However, when automating __sleep it becomes necissary to have access to the private/protected subclass variables because their names have to be returned by __sleep.<br />
<br />
So here is the work around:<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">public function </span><span class="default">__sleep</span><span class="keyword">()<br />
{<br />
&nbsp;... </span><span class="default">code </span><span class="keyword">...<br />
</span><span class="default">$sleepVars&nbsp; &nbsp; </span><span class="keyword">= </span><span class="default">array_keys</span><span class="keyword">((array)</span><span class="default">$this</span><span class="keyword">);<br />
return </span><span class="default">$sleepVars</span><span class="keyword">;<br />
}<br />
</span><span class="default">?&gt;<br />
</span><br />
Even though array_keys includes more information about the variable names than just the variable names -- it still seems to work appropriately.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
</div>
</div>
</div></div></body></html>
