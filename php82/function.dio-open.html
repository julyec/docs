<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
 <head>
  <meta http-equiv="content-type" content="text/html; CHARSET=UTF-8">
  <title>在 C 库输入/输出流函数允许的更低级别打开（必要时创建）文件</title>
<link media="all" rel="stylesheet" type="text/css" href="styles/03e73060321a0a848018724a6c83de7f-theme-base.css" />
<link media="all" rel="stylesheet" type="text/css" href="styles/03e73060321a0a848018724a6c83de7f-theme-medium.css" />

  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <link media="all" rel="stylesheet" type="text/css" href="style.css"/>
 </head>
 <body class="docs" class="docs"><div class="navbar navbar-fixed-top">
  <div class="navbar-inner clearfix">
    <ul class="nav" style="width: 100%">
      <li style="float: left;"><a href="function.dio-fcntl.html">? dio_fcntl</a></li>
      <li style="float: right;"><a href="function.dio-read.html">dio_read ?</a></li>
    </ul>
  </div>
</div>
<div id="breadcrumbs" class="clearfix">
  <ul class="breadcrumbs-container">
    <li><a href="index.html">PHP Manual</a></li>
    <li><a href="ref.dio.html">Direct IO 函数</a></li>
    <li>在 C 库输入/输出流函数允许的更低级别打开（必要时创建）文件</li>
  </ul>
</div>
<div id="layout">
  <div id="layout-content"><div id="function.dio-open" class="refentry">
 <div class="refnamediv">
  <h1 class="refname">dio_open</h1>
  <p class="verinfo">(PHP 4 &gt;= 4.2.0, PHP 5 &lt; 5.1.0)</p><p class="refpurpose"><span class="refname">dio_open</span> &mdash; <span class="dc-title">
   在 C 库输入/输出流函数允许的更低级别打开（必要时创建）文件
  </span></p>

 </div>
 <div class="refsect1 description" id="refsect1-function.dio-open-description">
  <h3 class="title">说明</h3>
  <div class="methodsynopsis dc-description">
   <span class="methodname"><strong>dio_open</strong></span>(<span class="methodparam"><span class="type">string</span> <code class="parameter">$filename</code></span>, <span class="methodparam"><span class="type">int</span> <code class="parameter">$flags</code></span>, <span class="methodparam"><span class="type">int</span> <code class="parameter">$mode</code><span class="initializer"> = 0</span></span>): <span class="type">resource</span></div>

  <p class="para rdfs-comment">
   <span class="function"><strong>dio_open()</strong></span> 打开文件并返回新的文件描述符。
  </p>
 </div>

 <div class="refsect1 parameters" id="refsect1-function.dio-open-parameters">
  <h3 class="title">参数</h3>
  <p class="para">
   <dl>
    
     <dt>
<code class="parameter">filename</code></dt>

     <dd>

      <p class="para">
       要打开的文件路径。
      </p>
     </dd>

    
    
     <dt>
<code class="parameter">flags</code></dt>

     <dd>

      <p class="para">
       <code class="parameter">flags</code> 参数是按位或运算值，包含以下列表的标志。
       必须包含 <strong><code>O_RDONLY</code></strong>、<strong><code>O_WRONLY</code></strong> 
       或 <strong><code>O_RDWR</code></strong> 中的一个。此外，可以包含此列表中其它标志的任意组合。
       <ul class="itemizedlist">
        <li class="listitem">
         <p class="para">
          <strong><code>O_RDONLY</code></strong> - 打开文件读访问。
         </p>
        </li>
        <li class="listitem">
         <p class="para">
          <strong><code>O_WRONLY</code></strong> - 打开文件写访问。
         </p>
        </li>
        <li class="listitem">
         <p class="para">
          <strong><code>O_RDWR</code></strong> - 打开文件读写。 
         </p>
        </li>
        <li class="listitem">
         <p class="para">
          <strong><code>O_CREAT</code></strong> - 如果文件不存在，创建文件。 
         </p>
        </li> 
        <li class="listitem">
         <p class="para">
          <strong><code>O_EXCL</code></strong> - 如果同时设置了 <strong><code>O_CREAT</code></strong> 
          和 <strong><code>O_EXCL</code></strong>，并且文件已存在，<span class="function"><strong>dio_open()</strong></span> 
          将执行失败。
         </p>
        </li> 
        <li class="listitem">
         <p class="para">
          <strong><code>O_TRUNC</code></strong> - 如果文件存在且已打开写访问，将会被截断到 0 长度。
         </p>
        </li>
        <li class="listitem">
         <p class="para">
          <strong><code>O_APPEND</code></strong> - 写操作在文件末尾写数据。
         </p>
        </li>
        <li class="listitem">
         <p class="para">
          <strong><code>O_NONBLOCK</code></strong> - 设置非阻塞模式。 
         </p>
        </li>
        <li class="listitem">
         <p class="para">
          <strong><code>O_NOCTTY</code></strong> - 防止操作系统在打开 TTY 设备文件时将文件指定为进程的控制终端。 
         </p>
        </li>
       </ul>
      </p>
     </dd>

    
    
     <dt>
<code class="parameter">mode</code></dt>

     <dd>

      <p class="para">
       如果 <code class="parameter">flags</code> 包含 <strong><code>O_CREAT</code></strong>，<code class="parameter">mode</code> 
       将设置文件权限（创建权限）。当 <code class="parameter">flags</code> 
       指定了 <strong><code>O_CREAT</code></strong> 标志时，需要 <code class="parameter">mode</code> 
       才能正确操作，否则将会被忽略。
      </p>
      <p class="para">
       分配给创建文件的实际权限照例受到进程的 <em class="emphasis">umask</em> 设置的影响。
      </p>
     </dd>

    
   </dl>

  </p>
 </div>

 <div class="refsect1 returnvalues" id="refsect1-function.dio-open-returnvalues">
  <h3 class="title">返回值</h3>
  <p class="para">
   文件描述符，错误时是 <strong><code>false</code></strong>。
  </p>
 </div>

 <div class="refsect1 examples" id="refsect1-function.dio-open-examples">
  <h3 class="title">示例</h3>
  <div class="example" id="example-4360">
   <p><strong>Example #1 打开文件描述符</strong></p>
   <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br /><br />$fd </span><span style="color: #007700">= </span><span style="color: #0000BB">dio_open</span><span style="color: #007700">(</span><span style="color: #DD0000">'/dev/ttyS0'</span><span style="color: #007700">, </span><span style="color: #0000BB">O_RDWR </span><span style="color: #007700">| </span><span style="color: #0000BB">O_NOCTTY </span><span style="color: #007700">| </span><span style="color: #0000BB">O_NONBLOCK</span><span style="color: #007700">);<br /><br /></span><span style="color: #0000BB">dio_close</span><span style="color: #007700">(</span><span style="color: #0000BB">$fd</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
   </div>

  </div>    
 </div>

 <div class="refsect1 seealso" id="refsect1-function.dio-open-seealso">
  <h3 class="title">参见</h3>
  <p class="para">
   <ul class="simplelist">
    <li class="member"><span class="function"><a href="function.dio-close.html" class="function" rel="rdfs-seeAlso">dio_close()</a> - 通过 fd 关闭文件描述符</span></li>
   </ul>
  </p>
 </div>

</div><div id="usernotes">
 <div class="head">
  <h3 class="title">User Contributed Notes</h3>
 </div>
<div id="allnotes">  <a name="108210""></a>
  <div class="note">
   <strong class="user">Anonymous</strong>
   <a href="#108210" class="date">08-Apr-2012 02:12</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
"The prominent reason" to use direct I/O is when your application provides its own cache feature, so you won't do double caching</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="96534""></a>
  <div class="note">
   <strong class="user">Marius Karthaus</strong>
   <a href="#96534" class="date">03-Mar-2010 12:02</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
One of the prominent reasons to use direct IO, is for it's ability to do actual direct IO, bypassing the operating system cache and getting the data from the disk directly.&nbsp; <br />
The flag to do that (O_DIRECT) is missing from the documentation above. Maybe for good reasons, because this type of IO only works on blockdevices, not on files, and should only be used if you are **really** sure what you are doing.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="49317""></a>
  <div class="note">
   <strong class="user">j at pureftpd dot org</strong>
   <a href="#49317" class="date">23-Jan-2005 04:13</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Please note that dio_open()/dio_write()/dio_close() is *faster* than fopen()/fwrite()/fclose() for files.<br />
<br />
fwrite() has to manage a 8k buffer, while dio_write() just issue a single write(). The end result is less system calls and less memory access.<br />
<br />
Also, giving the full size to write() as with dio_write() let filesystems properly use preallocation in order to avoid fragmentation.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="30570""></a>
  <div class="note">
   <strong class="user">alla at cyber dot com dot au</strong>
   <a href="#30570" class="date">22-Mar-2003 07:16</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
To specify a combination of flags you OR them together.
<br />
This was the only way I could get it to append:
<br />

<br />
$fd = dio_open($file, O_WRONLY | O_APPEND);</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
</div>
</div>
</div></div></body></html>
