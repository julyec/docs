<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
 <head>
  <meta http-equiv="content-type" content="text/html; CHARSET=UTF-8">
  <title>Open a ZIP file archive</title>
<link media="all" rel="stylesheet" type="text/css" href="styles/03e73060321a0a848018724a6c83de7f-theme-base.css" />
<link media="all" rel="stylesheet" type="text/css" href="styles/03e73060321a0a848018724a6c83de7f-theme-medium.css" />

  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <link media="all" rel="stylesheet" type="text/css" href="style.css"/>
 </head>
 <body class="docs" class="docs"><div class="navbar navbar-fixed-top">
  <div class="navbar-inner clearfix">
    <ul class="nav" style="width: 100%">
      <li style="float: left;"><a href="ziparchive.locatename.html">? ZipArchive::locateName</a></li>
      <li style="float: right;"><a href="ziparchive.registercancelcallback.html">ZipArchive::registerCancelCallback ?</a></li>
    </ul>
  </div>
</div>
<div id="breadcrumbs" class="clearfix">
  <ul class="breadcrumbs-container">
    <li><a href="index.html">PHP Manual</a></li>
    <li><a href="class.ziparchive.html">ZipArchive</a></li>
    <li>Open a ZIP file archive</li>
  </ul>
</div>
<div id="layout">
  <div id="layout-content"><div id="ziparchive.open" class="refentry">
 <div class="refnamediv">
  <h1 class="refname">ZipArchive::open</h1>
  <p class="verinfo">(PHP 5 &gt;= 5.2.0, PHP 7, PHP 8, PECL zip &gt;= 1.1.0)</p><p class="refpurpose"><span class="refname">ZipArchive::open</span> &mdash; <span class="dc-title">Open a ZIP file archive</span></p>

 </div>
 <div class="refsect1 description" id="refsect1-ziparchive.open-description">
  <h3 class="title">说明</h3>
  <div class="methodsynopsis dc-description">
   <span class="modifier">public</span> <span class="methodname"><strong>ZipArchive::open</strong></span>(<span class="methodparam"><span class="type">string</span> <code class="parameter">$filename</code></span>, <span class="methodparam"><span class="type">int</span> <code class="parameter">$flags</code><span class="initializer"> = 0</span></span>): <span class="type"><span class="type">bool</span>|<span class="type">int</span></span></div>

  <p class="para rdfs-comment">
   Opens a new or existing zip archive for reading, writing or modifying.
  </p>
  <p class="para">
   Since libzip 1.6.0, a empty file is not a valid archive any longer.
  </p>
 </div>

 <div class="refsect1 parameters" id="refsect1-ziparchive.open-parameters">
  <h3 class="title">参数</h3>
  <p class="para">
   <dl>
    
     <dt>
<code class="parameter">filename</code></dt>

     <dd>

      <p class="para">
       The file name of the ZIP archive to open.
      </p>
     </dd>

    
    
     <dt>
<code class="parameter">flags</code></dt>

     <dd>

      <p class="para">
       The mode to use to open the archive.
       <ul class="itemizedlist">
        <li class="listitem">
         <p class="para">
          <strong><code><a href="zip.constants.html#ziparchive.constants.overwrite" class="link">ZipArchive::OVERWRITE</a></code></strong>
         </p>
        </li>
        <li class="listitem">
         <p class="para">
          <strong><code><a href="zip.constants.html#ziparchive.constants.create" class="link">ZipArchive::CREATE</a></code></strong>
         </p>
        </li>
        <li class="listitem">
         <p class="para">
          <strong><code><a href="zip.constants.html#ziparchive.constants.rdonly" class="link">ZipArchive::RDONLY</a></code></strong>
         </p>
        </li>
        <li class="listitem">
         <p class="para">
          <strong><code><a href="zip.constants.html#ziparchive.constants.excl" class="link">ZipArchive::EXCL</a></code></strong>
         </p>
        </li>
        <li class="listitem">
         <p class="para">
          <strong><code><a href="zip.constants.html#ziparchive.constants.checkcons" class="link">ZipArchive::CHECKCONS</a></code></strong>
         </p>
        </li>
       </ul>
      </p>
     </dd>

    
   </dl>

  </p>
 </div>

 <div class="refsect1 returnvalues" id="refsect1-ziparchive.open-returnvalues">
  <h3 class="title">返回值</h3>
  <p class="para">
   Returns <strong><code>true</code></strong> on success, <strong><code>false</code></strong> or one of the following error codes on error:
   <dl>
    
     <dt>
<strong><code>ZipArchive::ER_EXISTS</code></strong></dt>

     <dd>

      <span class="simpara">File already exists.</span>
     </dd>

    
    
     <dt>
<strong><code>ZipArchive::ER_INCONS</code></strong></dt>

     <dd>

      <span class="simpara">Zip archive inconsistent.</span>
     </dd>

    
    
     <dt>
<strong><code>ZipArchive::ER_INVAL</code></strong></dt>

     <dd>

      <span class="simpara">Invalid argument.</span>
     </dd>

    
    
     <dt>
<strong><code>ZipArchive::ER_MEMORY</code></strong></dt>

     <dd>

      <span class="simpara">Malloc failure.</span>
     </dd>

    
    
     <dt>
<strong><code>ZipArchive::ER_NOENT</code></strong></dt>

     <dd>

      <span class="simpara">No such file.</span>
     </dd>

    
    
     <dt>
<strong><code>ZipArchive::ER_NOZIP</code></strong></dt>

     <dd>

      <span class="simpara">Not a zip archive.</span>
     </dd>

    
    
     <dt>
<strong><code>ZipArchive::ER_OPEN</code></strong></dt>

     <dd>

      <span class="simpara">Can&#039;t open file.</span>
     </dd>

    
    
     <dt>
<strong><code>ZipArchive::ER_READ</code></strong></dt>

     <dd>

      <span class="simpara">Read error.</span>
     </dd>

    
    
     <dt>
<strong><code>ZipArchive::ER_SEEK</code></strong></dt>

     <dd>

      <span class="simpara">Seek error.</span>
     </dd>

    
   </dl>

  </p>
 </div>

 <div class="refsect1 examples" id="refsect1-ziparchive.open-examples">
  <h3 class="title">示例</h3>
    <div class="example" id="example-1710">
     <p><strong>Example #1 Open and extract</strong></p>
     <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br />$zip </span><span style="color: #007700">= new </span><span style="color: #0000BB">ZipArchive</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">$res </span><span style="color: #007700">= </span><span style="color: #0000BB">$zip</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">open</span><span style="color: #007700">(</span><span style="color: #DD0000">'test.zip'</span><span style="color: #007700">);<br />if (</span><span style="color: #0000BB">$res </span><span style="color: #007700">=== </span><span style="color: #0000BB">TRUE</span><span style="color: #007700">) {<br />    echo </span><span style="color: #DD0000">'ok'</span><span style="color: #007700">;<br />    </span><span style="color: #0000BB">$zip</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">extractTo</span><span style="color: #007700">(</span><span style="color: #DD0000">'test'</span><span style="color: #007700">);<br />    </span><span style="color: #0000BB">$zip</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">close</span><span style="color: #007700">();<br />} else {<br />    echo </span><span style="color: #DD0000">'failed, code:' </span><span style="color: #007700">. </span><span style="color: #0000BB">$res</span><span style="color: #007700">;<br />}<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
     </div>

    </div>
    <div class="example" id="example-1712">
     <p><strong>Example #2 Create an archive</strong></p>
     <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br />$zip </span><span style="color: #007700">= new </span><span style="color: #0000BB">ZipArchive</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">$res </span><span style="color: #007700">= </span><span style="color: #0000BB">$zip</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">open</span><span style="color: #007700">(</span><span style="color: #DD0000">'test.zip'</span><span style="color: #007700">, </span><span style="color: #0000BB">ZipArchive</span><span style="color: #007700">::</span><span style="color: #0000BB">CREATE</span><span style="color: #007700">);<br />if (</span><span style="color: #0000BB">$res </span><span style="color: #007700">=== </span><span style="color: #0000BB">TRUE</span><span style="color: #007700">) {<br />    </span><span style="color: #0000BB">$zip</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">addFromString</span><span style="color: #007700">(</span><span style="color: #DD0000">'test.txt'</span><span style="color: #007700">, </span><span style="color: #DD0000">'file content goes here'</span><span style="color: #007700">);<br />    </span><span style="color: #0000BB">$zip</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">addFile</span><span style="color: #007700">(</span><span style="color: #DD0000">'data.txt'</span><span style="color: #007700">, </span><span style="color: #DD0000">'entryname.txt'</span><span style="color: #007700">);<br />    </span><span style="color: #0000BB">$zip</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">close</span><span style="color: #007700">();<br />    echo </span><span style="color: #DD0000">'ok'</span><span style="color: #007700">;<br />} else {<br />    echo </span><span style="color: #DD0000">'failed'</span><span style="color: #007700">;<br />}<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
     </div>

    </div>
    <div class="example" id="example-1714">
     <p><strong>Example #3 Create an temporary archive</strong></p>
     <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br />$name </span><span style="color: #007700">= </span><span style="color: #0000BB">tempnam</span><span style="color: #007700">(</span><span style="color: #0000BB">sys_get_temp_dir</span><span style="color: #007700">(), </span><span style="color: #DD0000">"FOO"</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">$zip </span><span style="color: #007700">= new </span><span style="color: #0000BB">ZipArchive</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">$res </span><span style="color: #007700">= </span><span style="color: #0000BB">$zip</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">open</span><span style="color: #007700">(</span><span style="color: #0000BB">$name</span><span style="color: #007700">, </span><span style="color: #0000BB">ZipArchive</span><span style="color: #007700">::</span><span style="color: #0000BB">OVERWRITE</span><span style="color: #007700">); </span><span style="color: #FF8000">/* truncate as empty file is not valid */<br /></span><span style="color: #007700">if (</span><span style="color: #0000BB">$res </span><span style="color: #007700">=== </span><span style="color: #0000BB">TRUE</span><span style="color: #007700">) {<br />    </span><span style="color: #0000BB">$zip</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">addFile</span><span style="color: #007700">(</span><span style="color: #DD0000">'data.txt'</span><span style="color: #007700">, </span><span style="color: #DD0000">'entryname.txt'</span><span style="color: #007700">);<br />    </span><span style="color: #0000BB">$zip</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">close</span><span style="color: #007700">();<br />    echo </span><span style="color: #DD0000">'ok'</span><span style="color: #007700">;<br />} else {<br />    echo </span><span style="color: #DD0000">'failed'</span><span style="color: #007700">;<br />}<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
     </div>

    </div>
   </div>

</div><div id="usernotes">
 <div class="head">
  <h3 class="title">User Contributed Notes</h3>
 </div>
<div id="allnotes">  <a name="126360""></a>
  <div class="note">
   <strong class="user">Anonymous</strong>
   <a href="#126360" class="date">23-Aug-2021 11:39</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
To read a zip file contents then loop through $zip-&gt;numFiles using $zip-&gt;getNameIndex(i)<br />
<br />
e.g.<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $zipfilename=$dir.DIRECTORY_SEPARATOR."test.zip";<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $zippedFile = new ZipArchive;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $zippedFile-&gt;open($zipfilename);<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; echo "&lt;LI&gt;".$zippedFile-&gt;getFromName("mpdf-8.0.7/.gitignore")."&lt;/LI&gt;&lt;HR&gt;";<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; echo "&lt;LI&gt;Loaded $zipfilename ".$zippedFile-&gt;numFiles;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; for($i = 0; $i &lt; $zippedFile-&gt;numFiles; $i++) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $fn=$zippedFile-&gt;getNameIndex($i);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; echo "&lt;LI&gt;$i: ".$fn;<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if ( strcmp(substr($fn, -1), DIRECTORY_SEPARATOR )==0 ) echo "... directory";<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; else echo "... ".strlen($zippedFile-&gt;getFromIndex($i))." bytes";<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $zippedFile-&gt;close();</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="126201""></a>
  <div class="note">
   <strong class="user">laacz at laacz dot lv</strong>
   <a href="#126201" class="date">28-Jun-2021 02:29</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If on PHP 8.0+, you can use match expression to decode status code:<br />
<br />
<span class="default">&lt;?php<br />
$archive </span><span class="keyword">= new </span><span class="default">\ZipArchive</span><span class="keyword">();<br />
</span><span class="default">$result </span><span class="keyword">= </span><span class="default">$archive</span><span class="keyword">-&gt;</span><span class="default">open</span><span class="keyword">(</span><span class="string">'some.file.zip'</span><span class="keyword">);<br />
<br />
</span><span class="default">$message </span><span class="keyword">= match (</span><span class="default">$result</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">\ZipArchive</span><span class="keyword">::</span><span class="default">ER_MULTIDISK&nbsp;&nbsp; </span><span class="keyword">=&gt; </span><span class="string">'Multi-disk zip archives not supported'</span><span class="keyword">,<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">\ZipArchive</span><span class="keyword">::</span><span class="default">ER_RENAME&nbsp; &nbsp; &nbsp; </span><span class="keyword">=&gt; </span><span class="string">'Renaming temporary file failed'</span><span class="keyword">,<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">\ZipArchive</span><span class="keyword">::</span><span class="default">ER_CLOSE&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">=&gt; </span><span class="string">'Closing zip archive failed'</span><span class="keyword">,<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">\ZipArchive</span><span class="keyword">::</span><span class="default">ER_SEEK&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">=&gt; </span><span class="string">'Seek error'</span><span class="keyword">,<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">\ZipArchive</span><span class="keyword">::</span><span class="default">ER_READ&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">=&gt; </span><span class="string">'Read error'</span><span class="keyword">,<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">\ZipArchive</span><span class="keyword">::</span><span class="default">ER_WRITE&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">=&gt; </span><span class="string">'Write error'</span><span class="keyword">,<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">\ZipArchive</span><span class="keyword">::</span><span class="default">ER_CRC&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">=&gt; </span><span class="string">'CRC error'</span><span class="keyword">,<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">\ZipArchive</span><span class="keyword">::</span><span class="default">ER_ZIPCLOSED&nbsp;&nbsp; </span><span class="keyword">=&gt; </span><span class="string">'Containing zip archive was closed'</span><span class="keyword">,<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">\ZipArchive</span><span class="keyword">::</span><span class="default">ER_NOENT&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">=&gt; </span><span class="string">'No such file'</span><span class="keyword">,<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">\ZipArchive</span><span class="keyword">::</span><span class="default">ER_EXISTS&nbsp; &nbsp; &nbsp; </span><span class="keyword">=&gt; </span><span class="string">'File already exists'</span><span class="keyword">,<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">\ZipArchive</span><span class="keyword">::</span><span class="default">ER_OPEN&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">=&gt; </span><span class="string">'Can\'t open file'</span><span class="keyword">,<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">\ZipArchive</span><span class="keyword">::</span><span class="default">ER_TMPOPEN&nbsp; &nbsp;&nbsp; </span><span class="keyword">=&gt; </span><span class="string">'Failure to create temporary file'</span><span class="keyword">,<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">\ZipArchive</span><span class="keyword">::</span><span class="default">ER_ZLIB&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">=&gt; </span><span class="string">'Zlib error'</span><span class="keyword">,<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">\ZipArchive</span><span class="keyword">::</span><span class="default">ER_MEMORY&nbsp; &nbsp; &nbsp; </span><span class="keyword">=&gt; </span><span class="string">'Malloc failure'</span><span class="keyword">,<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">\ZipArchive</span><span class="keyword">::</span><span class="default">ER_CHANGED&nbsp; &nbsp;&nbsp; </span><span class="keyword">=&gt; </span><span class="string">'Entry has been changed'</span><span class="keyword">,<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">\ZipArchive</span><span class="keyword">::</span><span class="default">ER_COMPNOTSUPP </span><span class="keyword">=&gt; </span><span class="string">'Compression method not supported'</span><span class="keyword">,<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">\ZipArchive</span><span class="keyword">::</span><span class="default">ER_EOF&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">=&gt; </span><span class="string">'Premature EOF'</span><span class="keyword">,<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">\ZipArchive</span><span class="keyword">::</span><span class="default">ER_INVAL&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">=&gt; </span><span class="string">'Invalid argument'</span><span class="keyword">,<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">\ZipArchive</span><span class="keyword">::</span><span class="default">ER_NOZIP&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">=&gt; </span><span class="string">'Not a zip archive'</span><span class="keyword">,<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">\ZipArchive</span><span class="keyword">::</span><span class="default">ER_INTERNAL&nbsp; &nbsp; </span><span class="keyword">=&gt; </span><span class="string">'Internal error'</span><span class="keyword">,<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">\ZipArchive</span><span class="keyword">::</span><span class="default">ER_INCONS&nbsp; &nbsp; &nbsp; </span><span class="keyword">=&gt; </span><span class="string">'Zip archive inconsistent'</span><span class="keyword">,<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">\ZipArchive</span><span class="keyword">::</span><span class="default">ER_REMOVE&nbsp; &nbsp; &nbsp; </span><span class="keyword">=&gt; </span><span class="string">'Can\'t remove file'</span><span class="keyword">,<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">\ZipArchive</span><span class="keyword">::</span><span class="default">ER_DELETED&nbsp; &nbsp;&nbsp; </span><span class="keyword">=&gt; </span><span class="string">'Entry has been deleted'</span><span class="keyword">,<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// \ZipArchive::ER_OK&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; =&gt; 'No error',<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">default&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; =&gt; </span><span class="string">'No error'</span><span class="keyword">,<br />
};<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="125111""></a>
  <div class="note">
   <strong class="user">Fred Johnson</strong>
   <a href="#125111" class="date">12-Jun-2020 03:24</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Note that ZipArchive does not support generating streaming ZIP file content (i.e. start sending data to the user as soon as you start generating it such as from a database).&nbsp; This means you have to write the entire file to disk first and then send the file to the user.&nbsp; Doing that can take a while depending on how much data there is, which could run up against server timeout limits.<br />
<br />
There are a couple of PHP userland libraries available on GitHub that can stream ZIP file content out to the user as soon as any data is written to the relevant classes.<br />
<br />
cubiclesoft/php-zipstreamwriter<br />
maennchen/ZipStream-PHP<br />
<br />
Maybe a future version of ZipArchive will offer something similar.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="118490""></a>
  <div class="note">
   <strong class="user">ohcc at 163 dot com</strong>
   <a href="#118490" class="date">14-Dec-2015 10:29</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
ZipArchive::OVERWRITE does NOT mean an existing file would be deleted when ZipArchive::open() is called.<br />
<br />
In fact, the existing file will be deleted before PHP saves the zip archive on disk.<br />
<br />
PHP takes these steps to finish zipping:<br />
<br />
1. When ZipArchive::open('xx.zip') is called<br />
If 'xx.zip' exists and is a zip archive, it will be opened and read as a temporary zip file, <br />
If the file does not exist, and ZipArchive::CREATE is applied, php will create a temporary empty zip file<br />
In these cases, ZipArchive::open() returns true, otherwise it returns an integer error code.<br />
2. Adds file(s) to the temporary zip file when methods such as addFile(), addFromString() are called.<br />
3. Deletes the existing file before saving the temporary zip file on disk.<br />
4. Save the temporary zip file on disk<br />
5.&nbsp; Closes the active archive when ZipArchive::close() is called or at the end of the script<br />
<br />
Since PHP does NOT delete the existing file before saving the zip archive on disk, you should use unset() to delete it if you want to zip that file's containing folder and save the zip archive in that folder, otherwise you will get a larger and larger zip archive everytime you refresh the page.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="118274""></a>
  <div class="note">
   <strong class="user">ohcc at 163 dot com</strong>
   <a href="#118274" class="date">06-Nov-2015 09:45</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
return values of ZipArchive::open() and their values and meanings<br />
ZipArchive::ER_SEEK&nbsp; &nbsp;&nbsp; 4&nbsp; &nbsp; Seek error.<br />
ZipArchive::ER_READ&nbsp; &nbsp;&nbsp; 5&nbsp; &nbsp; Read error.<br />
ZipArchive::ER_NOENT&nbsp; &nbsp;&nbsp; 9&nbsp; &nbsp; No such file.<br />
ZipArchive::ER_OPEN&nbsp; &nbsp;&nbsp; 11&nbsp; &nbsp; Can't open file.<br />
ZipArchive::ER_EXISTS&nbsp; &nbsp;&nbsp; 10&nbsp; &nbsp; File already exists.<br />
ZipArchive::ER_MEMORY 14&nbsp; &nbsp; Malloc failure.<br />
ZipArchive::ER_INVAL&nbsp; &nbsp;&nbsp; 18&nbsp; &nbsp; Invalid argument.<br />
ZipArchive::ER_NOZIP&nbsp; &nbsp;&nbsp; 19&nbsp; &nbsp; Not a zip archive.<br />
ZipArchive::ER_INCONS&nbsp; &nbsp;&nbsp; 21&nbsp; &nbsp; Zip archive inconsistent</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="118273""></a>
  <div class="note">
   <strong class="user">ohcc at 163 dot com</strong>
   <a href="#118273" class="date">06-Nov-2015 09:29</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
<span class="default">&lt;?php<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// Use ZipArchive::OVERWRITE when the targetd file does not exist may lead you to an error like this<br />
&nbsp;&nbsp;&nbsp; // Warning: ZipArchive::addFile(): Invalid or uninitialized Zip object <br />
&nbsp;&nbsp;&nbsp; // try ZipArchive::OVERWRITE|ZipArchive::CREATE when you want to replace a zip archive that may not exist<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$zip </span><span class="keyword">= new </span><span class="default">ZipArchive</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$rt</span><span class="keyword">=</span><span class="default">$zip</span><span class="keyword">-&gt;</span><span class="default">open</span><span class="keyword">(</span><span class="string">'i.zip'</span><span class="keyword">,</span><span class="default">ZipArchive</span><span class="keyword">::</span><span class="default">OVERWRITE</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; echo </span><span class="default">$rt</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// when i.zip does not exist, $rt is 9, ZipArchive::ER_NOENT, or "No such file."<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$zip</span><span class="keyword">-&gt;</span><span class="default">addFile</span><span class="keyword">(</span><span class="string">'wuxiancheng.cn.sql'</span><span class="keyword">,</span><span class="string">'db.sql'</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// triggers an error with the message "Warning: ZipArchive::addFile(): Invalid or uninitialized Zip object ..."<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; // Use ZipArchive::OVERWRITE|ZipArchive::CREATE<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$zip </span><span class="keyword">= new </span><span class="default">ZipArchive</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$zip</span><span class="keyword">-&gt;</span><span class="default">open</span><span class="keyword">(</span><span class="string">'i.zip'</span><span class="keyword">,</span><span class="default">ZipArchive</span><span class="keyword">::</span><span class="default">OVERWRITE</span><span class="keyword">|</span><span class="default">ZipArchive</span><span class="keyword">::</span><span class="default">CREATE</span><span class="keyword">);&nbsp; &nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$zip</span><span class="keyword">-&gt;</span><span class="default">addFile</span><span class="keyword">(</span><span class="string">'wuxiancheng.cn.sql'</span><span class="keyword">,</span><span class="string">'db.sql'</span><span class="keyword">);&nbsp; &nbsp; <br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="117339""></a>
  <div class="note">
   <strong class="user">abolfazl dot ziaratban at gmail dot com</strong>
   <a href="#117339" class="date">24-May-2015 04:35</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
<span class="default">&lt;?php<br />
</span><span class="comment">#made by abolfazl ziaratban (c)<br />
#license GPL<br />
<br />
</span><span class="keyword">class </span><span class="default">zip </span><span class="keyword">extends </span><span class="default">ZipArchive<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">{<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; public function </span><span class="default">message</span><span class="keyword">(</span><span class="default">$code</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; switch (</span><span class="default">$code</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="default">0</span><span class="keyword">:<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="string">'No error'</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="default">1</span><span class="keyword">:<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="string">'Multi-disk zip archives not supported'</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="default">2</span><span class="keyword">:<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="string">'Renaming temporary file failed'</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="default">3</span><span class="keyword">:<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="string">'Closing zip archive failed'</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="default">4</span><span class="keyword">:<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="string">'Seek error'</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="default">5</span><span class="keyword">:<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="string">'Read error'</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="default">6</span><span class="keyword">:<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="string">'Write error'</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="default">7</span><span class="keyword">:<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="string">'CRC error'</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="default">8</span><span class="keyword">:<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="string">'Containing zip archive was closed'</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="default">9</span><span class="keyword">:<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="string">'No such file'</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="default">10</span><span class="keyword">:<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="string">'File already exists'</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="default">11</span><span class="keyword">:<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="string">'Can\'t open file'</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="default">12</span><span class="keyword">:<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="string">'Failure to create temporary file'</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="default">13</span><span class="keyword">:<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="string">'Zlib error'</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="default">14</span><span class="keyword">:<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="string">'Malloc failure'</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="default">15</span><span class="keyword">:<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="string">'Entry has been changed'</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="default">16</span><span class="keyword">:<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="string">'Compression method not supported'</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="default">17</span><span class="keyword">:<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="string">'Premature EOF'</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="default">18</span><span class="keyword">:<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="string">'Invalid argument'</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="default">19</span><span class="keyword">:<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="string">'Not a zip archive'</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="default">20</span><span class="keyword">:<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="string">'Internal error'</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="default">21</span><span class="keyword">:<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="string">'Zip archive inconsistent'</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="default">22</span><span class="keyword">:<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="string">'Can\'t remove file'</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="default">23</span><span class="keyword">:<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="string">'Entry has been deleted'</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; default:<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="string">'An unknown error has occurred('</span><span class="keyword">.</span><span class="default">intval</span><span class="keyword">(</span><span class="default">$code</span><span class="keyword">).</span><span class="string">')'</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; public function </span><span class="default">isDir</span><span class="keyword">(</span><span class="default">$path</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$path</span><span class="keyword">,-</span><span class="default">1</span><span class="keyword">) == </span><span class="string">'/'</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; public function </span><span class="default">getTree</span><span class="keyword">()<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$Tree </span><span class="keyword">= array();<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$pathArray </span><span class="keyword">= array();<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; for(</span><span class="default">$i</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">; </span><span class="default">$i</span><span class="keyword">&lt;</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">numFiles</span><span class="keyword">; </span><span class="default">$i</span><span class="keyword">++)<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$path </span><span class="keyword">= </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">getNameIndex</span><span class="keyword">(</span><span class="default">$i</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$pathBySlash </span><span class="keyword">= </span><span class="default">array_values</span><span class="keyword">(</span><span class="default">explode</span><span class="keyword">(</span><span class="string">'/'</span><span class="keyword">,</span><span class="default">$path</span><span class="keyword">));<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$c </span><span class="keyword">= </span><span class="default">count</span><span class="keyword">(</span><span class="default">$pathBySlash</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$temp </span><span class="keyword">= &amp;</span><span class="default">$Tree</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; for(</span><span class="default">$j</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">; </span><span class="default">$j</span><span class="keyword">&lt;</span><span class="default">$c</span><span class="keyword">-</span><span class="default">1</span><span class="keyword">; </span><span class="default">$j</span><span class="keyword">++)<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if(isset(</span><span class="default">$temp</span><span class="keyword">[</span><span class="default">$pathBySlash</span><span class="keyword">[</span><span class="default">$j</span><span class="keyword">]]))<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$temp </span><span class="keyword">= &amp;</span><span class="default">$temp</span><span class="keyword">[</span><span class="default">$pathBySlash</span><span class="keyword">[</span><span class="default">$j</span><span class="keyword">]];<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; else<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$temp</span><span class="keyword">[</span><span class="default">$pathBySlash</span><span class="keyword">[</span><span class="default">$j</span><span class="keyword">]] = array();<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$temp </span><span class="keyword">= &amp;</span><span class="default">$temp</span><span class="keyword">[</span><span class="default">$pathBySlash</span><span class="keyword">[</span><span class="default">$j</span><span class="keyword">]];<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">isDir</span><span class="keyword">(</span><span class="default">$path</span><span class="keyword">))<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$temp</span><span class="keyword">[</span><span class="default">$pathBySlash</span><span class="keyword">[</span><span class="default">$c</span><span class="keyword">-</span><span class="default">1</span><span class="keyword">]] = array();<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; else<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$temp</span><span class="keyword">[] = </span><span class="default">$pathBySlash</span><span class="keyword">[</span><span class="default">$c</span><span class="keyword">-</span><span class="default">1</span><span class="keyword">];<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">$Tree</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; }<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="117082""></a>
  <div class="note">
   <strong class="user">jekillen at prodigy net</strong>
   <a href="#117082" class="date">13-Apr-2015 07:23</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Calling ZipArchive-&gt;open() will not create an empty zip archive file.<br />
I found this out the hard way. I wrote code that produced positive<br />
results: I.E. the return value from the call to ZipArchive was TRUE<br />
and the empty zip file was not created. So at least call <br />
ZipArchive-&gt;addFromString(&lt;filename.zip&gt;, '&lt;minimal content&gt;')<br />
when creating a new zip archive file.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="114257""></a>
  <div class="note">
   <strong class="user">Eric Langlois</strong>
   <a href="#114257" class="date">29-Jan-2014 09:53</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
<span class="default">&lt;?PHP<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $zip </span><span class="keyword">= new </span><span class="default">ZipArchive</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$res </span><span class="keyword">= </span><span class="default">$zip</span><span class="keyword">-&gt;</span><span class="default">open</span><span class="keyword">(</span><span class="string">'test.zip'</span><span class="keyword">, </span><span class="default">ZipArchive</span><span class="keyword">::</span><span class="default">CREATE</span><span class="keyword">);<br />
<br />
&nbsp;&nbsp;&nbsp; if ( </span><span class="default">$res </span><span class="keyword">=== </span><span class="default">TRUE</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">//CODE GOES HERE<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$zip</span><span class="keyword">-&gt;</span><span class="default">close</span><span class="keyword">();<br />
&nbsp;&nbsp;&nbsp; } else {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; switch(</span><span class="default">$res</span><span class="keyword">){<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="default">ZipArchive</span><span class="keyword">::</span><span class="default">ER_EXISTS</span><span class="keyword">: <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$ErrMsg </span><span class="keyword">= </span><span class="string">"File already exists."</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; break;<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="default">ZipArchive</span><span class="keyword">::</span><span class="default">ER_INCONS</span><span class="keyword">: <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$ErrMsg </span><span class="keyword">= </span><span class="string">"Zip archive inconsistent."</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; break;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="default">ZipArchive</span><span class="keyword">::</span><span class="default">ER_MEMORY</span><span class="keyword">: <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$ErrMsg </span><span class="keyword">= </span><span class="string">"Malloc failure."</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; break;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="default">ZipArchive</span><span class="keyword">::</span><span class="default">ER_NOENT</span><span class="keyword">: <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$ErrMsg </span><span class="keyword">= </span><span class="string">"No such file."</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; break;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="default">ZipArchive</span><span class="keyword">::</span><span class="default">ER_NOZIP</span><span class="keyword">: <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$ErrMsg </span><span class="keyword">= </span><span class="string">"Not a zip archive."</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; break;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="default">ZipArchive</span><span class="keyword">::</span><span class="default">ER_OPEN</span><span class="keyword">: <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$ErrMsg </span><span class="keyword">= </span><span class="string">"Can't open file."</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; break;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="default">ZipArchive</span><span class="keyword">::</span><span class="default">ER_READ</span><span class="keyword">: <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$ErrMsg </span><span class="keyword">= </span><span class="string">"Read error."</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; break;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="default">ZipArchive</span><span class="keyword">::</span><span class="default">ER_SEEK</span><span class="keyword">: <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$ErrMsg </span><span class="keyword">= </span><span class="string">"Seek error."</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; break;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; default: <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$ErrMsg </span><span class="keyword">= </span><span class="string">"Unknow (Code </span><span class="default">$rOpen</span><span class="string">)"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; break;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; die( </span><span class="string">'ZipArchive Error: ' </span><span class="keyword">. </span><span class="default">$ErrMsg</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="110651""></a>
  <div class="note">
   <strong class="user">walter at clevertechie dot com</strong>
   <a href="#110651" class="date">17-Nov-2012 08:53</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you have archives that you want to overwrite just use:<br />
<br />
ZIPARCHIVE::CREATE<br />
<br />
It will overwrite existing archives and at the same time create new ones if they don't already exist.<br />
<br />
ZIPARCHIVE::OVERWRITE won't work for both of these scenarios.<br />
<br />
(PHP version 5.4.4)</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="105590""></a>
  <div class="note">
   <strong class="user">YiiWanAB at hotmail dot com</strong>
   <a href="#105590" class="date">30-Aug-2011 10:06</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Most of the time people iterate over a directory with 'opendir' or 'readdir' to add files to a zip. Like...<br />
<br />
while ($file = readdir($dir)) { ... $zip-&gt;addFile($file) }<br />
<br />
Note that $zip-&gt;addFile($file) will only work in the current directory if your at the root. You will need to add the correct path to that $file string variable to have the full file name like ...<br />
<br />
$zip-&gt;addFile($dir . DIRECTORY_SEPARATOR . $file); will work.<br />
<br />
This may identify why you may get a read error when closing the file. <br />
<br />
Enjoy.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="102965""></a>
  <div class="note">
   <strong class="user">sunil dt bhave at gmail dt com</strong>
   <a href="#102965" class="date">16-Mar-2011 10:44</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Even though the api specifies that the flags are optional I found that I had to specify the flag ZIPARCHIVE::CREATE for an archive to be opened. <br />
This is on a Windows 7 system with PHP 5.3.0</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="102849""></a>
  <div class="note">
   <strong class="user">Jan Vavra</strong>
   <a href="#102849" class="date">10-Mar-2011 12:04</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
As discussed in <a href="http://bugs.php.net/bug.php?id=54128 on Windows Server systems (2003, 2008" rel="nofollow" target="_blank">http://bugs.php.net/bug.php?id=54128 on Windows Server systems (2003, 2008</a>) and IIS there is a problem when you want to unzip file stored in C:\Windows\Temp folder.<br />
User of worker process IUSR_XXX has no directory listing right for C:\Windows\Temp and this is a reason why ZipArchive::open() fails with error 11 (error open). So it is not a good idea to store file for unzipping in folder defined by sys_get_temp_dir().</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="94226""></a>
  <div class="note">
   <strong class="user">sebwoolford at gmail dot com</strong>
   <a href="#94226" class="date">23-Oct-2009 03:29</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Further to what rickky at gmail dot com was saying, I've had that problem while trying to cache zip files and found that I had to set the permissions of the containing folder to 777 to get it to work.<br />
<br />
Because this is a potential security weakness if on a public viewable folder, I'd recommend moving the folder so that it is no longer within public_html. You can then use readfile() to output the archive to the browser, with some HTTP headers to tell the browser it is a zip file.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="92559""></a>
  <div class="note">
   <strong class="user">michael202 at gmx dot de</strong>
   <a href="#92559" class="date">29-Jul-2009 06:33</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
to anyone getting an error ZIPARCHIVE::ER_READ = 5, when<br />
doing $zip-&gt;open($zipfile) with a ZIP file containing a total of more then (around) 800 files (even when they are in sub-directories).<br />
<br />
possibly related bugs 40873, 8714:<br />
<br />
1. it was not an OS limit, because it worked when called from windows via samba on the same file at the same place<br />
<br />
2. it wasn't working under 32bit linux<br />
<br />
with php 5.3.0 the issue seems to be resolved.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="88765""></a>
  <div class="note">
   <strong class="user">eric at webdeveric dot com</strong>
   <a href="#88765" class="date">06-Feb-2009 07:06</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
With php 5.2.6, the following code created a new zip or replaced a existing zip.<br />
Note that I am only using the ZIPARCHIVE::OVERWRITE flag.<br />
<br />
<span class="default">&lt;?php<br />
&nbsp;&nbsp;&nbsp; $zip </span><span class="keyword">= new </span><span class="default">ZipArchive</span><span class="keyword">();<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$opened </span><span class="keyword">= </span><span class="default">$zip</span><span class="keyword">-&gt;</span><span class="default">open</span><span class="keyword">( </span><span class="default">$zipFileName</span><span class="keyword">, </span><span class="default">ZIPARCHIVE</span><span class="keyword">::</span><span class="default">OVERWRITE </span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; if( </span><span class="default">$opened </span><span class="keyword">!== </span><span class="default">true </span><span class="keyword">){<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; die(</span><span class="string">"cannot open </span><span class="keyword">{</span><span class="default">$zipFileName</span><span class="keyword">}</span><span class="string"> for writing."</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$zip</span><span class="keyword">-&gt;</span><span class="default">addFromString</span><span class="keyword">( </span><span class="default">$name</span><span class="keyword">, </span><span class="default">$contents </span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$zip</span><span class="keyword">-&gt;</span><span class="default">close</span><span class="keyword">();<br />
</span><span class="default">?&gt;<br />
</span><br />
Now, with php 5.2.8, it does not work and gives this warning:<br />
<br />
Warning: ZipArchive::addFromString() [ziparchive.addfromstring]: Invalid or unitialized Zip object in [myfile] on line [myline]<br />
<br />
To fix this, you must specify the flags as create or overwrite.<br />
<br />
<span class="default">&lt;?php<br />
&nbsp;&nbsp;&nbsp; $zip </span><span class="keyword">= new </span><span class="default">ZipArchive</span><span class="keyword">();<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$opened </span><span class="keyword">= </span><span class="default">$zip</span><span class="keyword">-&gt;</span><span class="default">open</span><span class="keyword">( </span><span class="default">$zipFileName</span><span class="keyword">, </span><span class="default">ZIPARCHIVE</span><span class="keyword">::</span><span class="default">CREATE </span><span class="keyword">| </span><span class="default">ZIPARCHIVE</span><span class="keyword">::</span><span class="default">OVERWRITE </span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; if( </span><span class="default">$opened </span><span class="keyword">!== </span><span class="default">true </span><span class="keyword">){<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; die(</span><span class="string">"cannot open </span><span class="keyword">{</span><span class="default">$zipFileName</span><span class="keyword">}</span><span class="string"> for writing."</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$zip</span><span class="keyword">-&gt;</span><span class="default">addFromString</span><span class="keyword">( </span><span class="default">$name</span><span class="keyword">, </span><span class="default">$contents </span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$zip</span><span class="keyword">-&gt;</span><span class="default">close</span><span class="keyword">();<br />
</span><span class="default">?&gt;<br />
</span><br />
When googling for the error message I found a lot of people that had it but couldn't figure out why they were getting it.<br />
I hope this helps someone.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="87423""></a>
  <div class="note">
   <strong class="user">jj at icglink dot com</strong>
   <a href="#87423" class="date">04-Dec-2008 11:09</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
if you are echoing out the output and confused about the number...maybe this will help.&nbsp; i'm not totally sure it is accurate though.<br />
<br />
ZIPARCHIVE::ER_EXISTS - 10<br />
ZIPARCHIVE::ER_INCONS - 21<br />
ZIPARCHIVE::ER_INVAL - 18<br />
ZIPARCHIVE::ER_MEMORY - 14<br />
ZIPARCHIVE::ER_NOENT - 9<br />
ZIPARCHIVE::ER_NOZIP - 19<br />
ZIPARCHIVE::ER_OPEN - 11<br />
ZIPARCHIVE::ER_READ - 5<br />
ZIPARCHIVE::ER_SEEK - 4</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="84848""></a>
  <div class="note">
   <strong class="user">azsymvelik at gmail dot com</strong>
   <a href="#84848" class="date">01-Aug-2008 01:25</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
<span class="default">&lt;?php
<br />

<br />
</span><span class="comment">/*
<br />
Hi!
<br />

<br />
I made a little script about checking content and "secure repacking"
<br />
*/
<br />

<br />
</span><span class="default">$somefile </span><span class="keyword">= </span><span class="string">"zip.zip"</span><span class="keyword">;
<br />
</span><span class="default">$someurl </span><span class="keyword">= </span><span class="string">"/some/url"
<br />
</span><span class="default">$zip </span><span class="keyword">= new </span><span class="default">ZipArchive</span><span class="keyword">;
<br />
</span><span class="default">$open </span><span class="keyword">= </span><span class="default">$zip</span><span class="keyword">-&gt;</span><span class="default">open</span><span class="keyword">(</span><span class="default">$somefile</span><span class="keyword">, </span><span class="default">ZIPARCHIVE</span><span class="keyword">::</span><span class="default">CHECKCONS</span><span class="keyword">);
<br />
</span><span class="comment">// If the archive is broken(or just another file renamed to *.zip) the function will return error on httpd under windows, so it's good to check if the archive is ok with ZIPARCHIVE::CHECKCONS
<br />
</span><span class="keyword">if (</span><span class="default">$open </span><span class="keyword">=== </span><span class="default">TRUE</span><span class="keyword">) {
<br />
if(!</span><span class="default">$zip</span><span class="keyword">-&gt;</span><span class="default">extractTo</span><span class="keyword">(</span><span class="default">$someurl</span><span class="keyword">)) {
<br />
die (</span><span class="string">"Error during extracting"</span><span class="keyword">);
<br />
}
<br />
</span><span class="default">$zip</span><span class="keyword">-&gt;</span><span class="default">close</span><span class="keyword">();
<br />
}
<br />
</span><span class="default">$new_archive_name </span><span class="keyword">= </span><span class="string">"new.zip"</span><span class="keyword">;
<br />
</span><span class="default">$new_zip </span><span class="keyword">= new </span><span class="default">ZipArchive</span><span class="keyword">;
<br />
</span><span class="default">$new_open </span><span class="keyword">= </span><span class="default">$new_zip</span><span class="keyword">-&gt;</span><span class="default">open</span><span class="keyword">(</span><span class="default">$new_archive_name</span><span class="keyword">, </span><span class="default">ZIPARCHIVE</span><span class="keyword">::</span><span class="default">CREATE</span><span class="keyword">);
<br />
if (</span><span class="default">$new_open </span><span class="keyword">=== </span><span class="default">TRUE</span><span class="keyword">) {
<br />
</span><span class="default">$dir </span><span class="keyword">= </span><span class="default">opendir</span><span class="keyword">(</span><span class="default">$someurl</span><span class="keyword">);
<br />
while (</span><span class="default">$file </span><span class="keyword">= </span><span class="default">readdir</span><span class="keyword">(</span><span class="default">$dir</span><span class="keyword">)) {
<br />
&nbsp;if (</span><span class="default">$file </span><span class="keyword">== </span><span class="string">"." </span><span class="keyword">|| </span><span class="default">$file </span><span class="keyword">== </span><span class="string">".."</span><span class="keyword">) { } else {
<br />
&nbsp;</span><span class="comment">//We do not wanna this files in the new zip archive
<br />
&nbsp; </span><span class="keyword">if (!</span><span class="default">$new_zip</span><span class="keyword">-&gt;</span><span class="default">addFile</span><span class="keyword">(</span><span class="default">$file</span><span class="keyword">)) {
<br />
&nbsp;&nbsp; &nbsp; print </span><span class="default">$file</span><span class="keyword">.</span><span class="string">"was not added!&lt;br /&gt;"</span><span class="keyword">;
<br />
&nbsp;&nbsp; }
<br />
&nbsp; }
<br />
&nbsp;}
<br />
}
<br />
</span><span class="default">$new_zip</span><span class="keyword">-&gt;</span><span class="default">close</span><span class="keyword">();
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="84646""></a>
  <div class="note">
   <strong class="user">Jonathan Baltazar</strong>
   <a href="#84646" class="date">23-Jul-2008 07:14</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
The file name does not need to end in '.zip' if it is created using tempnam().&nbsp; You just need to overwrite the file instead of trying to read it:
<br />

<br />
<span class="default">&lt;?php
<br />
$file </span><span class="keyword">= </span><span class="default">tempnam</span><span class="keyword">(</span><span class="string">"tmp"</span><span class="keyword">, </span><span class="string">"zip"</span><span class="keyword">);
<br />
&nbsp;&nbsp;&nbsp; 
<br />
</span><span class="default">$zip </span><span class="keyword">= new </span><span class="default">ZipArchive</span><span class="keyword">();
<br />

<br />
</span><span class="comment">// Zip will open and overwrite the file, rather than try to read it.
<br />
</span><span class="default">$zip</span><span class="keyword">-&gt;</span><span class="default">open</span><span class="keyword">(</span><span class="default">$file</span><span class="keyword">, </span><span class="default">ZipArchive</span><span class="keyword">::</span><span class="default">OVERWRITE</span><span class="keyword">);
<br />

<br />
</span><span class="default">$zip</span><span class="keyword">-&gt;</span><span class="default">close</span><span class="keyword">();
<br />

<br />
</span><span class="comment">// Stream the file to the client
<br />
</span><span class="default">header</span><span class="keyword">(</span><span class="string">"Content-Type: application/zip"</span><span class="keyword">);
<br />
</span><span class="default">header</span><span class="keyword">(</span><span class="string">"Content-Length: " </span><span class="keyword">. </span><span class="default">filesize</span><span class="keyword">(</span><span class="default">$file</span><span class="keyword">));
<br />
</span><span class="default">header</span><span class="keyword">(</span><span class="string">"Content-Disposition: attachment; filename=\"a_zip_file.zip\""</span><span class="keyword">);
<br />
</span><span class="default">readfile</span><span class="keyword">(</span><span class="default">$file</span><span class="keyword">);
<br />

<br />
</span><span class="default">unlink</span><span class="keyword">(</span><span class="default">$file</span><span class="keyword">);
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="83235""></a>
  <div class="note">
   <strong class="user">olivier pons</strong>
   <a href="#83235" class="date">16-May-2008 12:26</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you try this to open a file with creation in mind (= empty zip to fill with other files), this may not work :<br />
<br />
$res = $zip-&gt;open($zip_file, ZipArchive::CREATE);<br />
<br />
// you may get false<br />
<br />
Try this instead, it should work :<br />
<br />
$res = $zip-&gt;open($zip_file, ZIPARCHIVE::OVERWRITE);</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="76136""></a>
  <div class="note">
   <strong class="user">rickky at gmail dot com</strong>
   <a href="#76136" class="date">02-Jul-2007 05:07</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If the directory you are writing or saving into does not have the correct permissions set, you won't get any error messages and it will look like everything worked fine... except it won't have changed!<br />
<br />
Instead make sure you collect the return value of ZipArchive::close(). If it is false... it didn't work.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
</div>
</div>
</div></div></body></html>
