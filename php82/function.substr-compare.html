<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
 <head>
  <meta http-equiv="content-type" content="text/html; CHARSET=UTF-8">
  <title>二进制安全比较字符串（从偏移位置比较指定长度）</title>
<link media="all" rel="stylesheet" type="text/css" href="styles/03e73060321a0a848018724a6c83de7f-theme-base.css" />
<link media="all" rel="stylesheet" type="text/css" href="styles/03e73060321a0a848018724a6c83de7f-theme-medium.css" />

  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <link media="all" rel="stylesheet" type="text/css" href="style.css"/>
 </head>
 <body class="docs" class="docs"><div class="navbar navbar-fixed-top">
  <div class="navbar-inner clearfix">
    <ul class="nav" style="width: 100%">
      <li style="float: left;"><a href="function.strtr.html">? strtr</a></li>
      <li style="float: right;"><a href="function.substr-count.html">substr_count ?</a></li>
    </ul>
  </div>
</div>
<div id="breadcrumbs" class="clearfix">
  <ul class="breadcrumbs-container">
    <li><a href="index.html">PHP Manual</a></li>
    <li><a href="ref.strings.html">字符串 函数</a></li>
    <li>二进制安全比较字符串（从偏移位置比较指定长度）</li>
  </ul>
</div>
<div id="layout">
  <div id="layout-content"><div id="function.substr-compare" class="refentry">
 <div class="refnamediv">
  <h1 class="refname">substr_compare</h1>
  <p class="verinfo">(PHP 5, PHP 7, PHP 8)</p><p class="refpurpose"><span class="refname">substr_compare</span> &mdash; <span class="dc-title">二进制安全比较字符串（从偏移位置比较指定长度）</span></p>

 </div>
 
 <div class="refsect1 description" id="refsect1-function.substr-compare-description">
  <h3 class="title">说明</h3>
  <div class="methodsynopsis dc-description">
   <span class="methodname"><strong>substr_compare</strong></span>(<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="methodparam"><span class="type">string</span> <code class="parameter">$haystack</code></span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="methodparam"><span class="type">string</span> <code class="parameter">$needle</code></span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="methodparam"><span class="type">int</span> <code class="parameter">$offset</code></span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="methodparam"><span class="type">?</span><span class="type"><span class="type">int</span><span class="type"></span></span> <code class="parameter">$length</code><span class="initializer"> = <strong><code>null</code></strong></span></span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="methodparam"><span class="type">bool</span> <code class="parameter">$case_insensitive</code><span class="initializer"> = <strong><code>false</code></strong></span></span><br>): <span class="type">int</span></div>

  <p class="para rdfs-comment">
   <span class="function"><strong>substr_compare()</strong></span> 从偏移位置
   <code class="parameter">offset</code> 开始比较
   <code class="parameter">haystack</code> 与
   <code class="parameter">needle</code>，比较长度为
   <code class="parameter">length</code> 个字符。
  </p>
 </div>


 <div class="refsect1 parameters" id="refsect1-function.substr-compare-parameters">
  <h3 class="title">参数</h3>
  <p class="para">
   <dl>
    
     <dt>
<code class="parameter">haystack</code></dt>

     <dd>

      <p class="para">
       待比较的第一个字符串。
      </p>
     </dd>

    
    
     <dt>
<code class="parameter">needle</code></dt>

     <dd>

      <p class="para">
       待比较的第二个字符串。
      </p>
     </dd>

    
    
     <dt>
<code class="parameter">offset</code></dt>

     <dd>

      <p class="para">
       比较开始的位置。如果为负数，则从字符串结尾处开始算起。
      </p>
     </dd>

    
    
     <dt>
<code class="parameter">length</code></dt>

     <dd>

      <p class="para">
       比较的长度。默认值为 <code class="parameter">needle</code> 的长度与
       <code class="parameter">haystack</code> 的长度减去位置偏移量
       <code class="parameter">offset</code> 后二者中的较大者。
      </p>
     </dd>

    
    
     <dt>
<code class="parameter">case_insensitive</code></dt>

     <dd>

      <p class="para">
       如果 <code class="parameter">case_insensitive</code> 为 <strong><code>true</code></strong>，比较将不区分大小写。
      </p>
     </dd>

    
   </dl>

  </p>
 </div>


 <div class="refsect1 returnvalues" id="refsect1-function.substr-compare-returnvalues">
  <h3 class="title">返回值</h3>
  <p class="para">
   如果 <code class="parameter">haystack</code> 从偏移位置
   <code class="parameter">offset</code> 起的子字符串小于
   <code class="parameter">needle</code>，则返回 <code class="literal">-1</code>；如果大于
   <code class="parameter">needle</code>，则返回 <code class="literal">1</code>；如果二者相等，则返回 <code class="literal">0</code>。如果
   <code class="parameter">offset</code> 等于（在 PHP 7.2.18, 7.3.5 之前）或大于
   <code class="parameter">haystack</code> 的长度，或设置
   <code class="parameter">length</code> 小于或等于 0，<span class="function"><strong>substr_compare()</strong></span>
   将打印出警告信息并且返回 <strong><code>false</code></strong>。
  </p>
 </div>


 <div class="refsect1 changelog" id="refsect1-function.substr-compare-changelog">
  <h3 class="title">更新日志</h3>
  <p class="para">
   <table class="doctable informaltable">
    
     <thead>
      <tr>
       <th>版本</th>
       <th>说明</th>
      </tr>

     </thead>

     <tbody class="tbody">
      <tr>
 <td>8.2.0</td>
 <td>
  现在此函数返回 <code class="literal">-1</code> 或者 <code class="literal">1</code>，之前返回负数或正数。
 </td>
</tr>


      <tr>
       <td>8.0.0</td>
       <td>
        <code class="parameter">length</code> 现在允许为 null。
       </td>
      </tr>

      <tr>
       <td>7.2.18, 7.3.5</td>
       <td>
        <code class="parameter">offset</code> 现在可能等于 <code class="parameter">haystack</code>。
       </td>
      </tr>

     </tbody>
    
   </table>

  </p>
 </div>


 <div class="refsect1 examples" id="refsect1-function.substr-compare-examples">
  <h3 class="title">示例</h3>
  <p class="para">
   <div class="example" id="">
    <p><strong>Example #1 <span class="function"><strong>substr_compare()</strong></span> 示例</strong></p>
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br /></span><span style="color: #007700">echo </span><span style="color: #0000BB">substr_compare</span><span style="color: #007700">(</span><span style="color: #DD0000">"abcde"</span><span style="color: #007700">, </span><span style="color: #DD0000">"bc"</span><span style="color: #007700">, </span><span style="color: #0000BB">1</span><span style="color: #007700">, </span><span style="color: #0000BB">2</span><span style="color: #007700">); </span><span style="color: #FF8000">// 0<br /></span><span style="color: #007700">echo </span><span style="color: #0000BB">substr_compare</span><span style="color: #007700">(</span><span style="color: #DD0000">"abcde"</span><span style="color: #007700">, </span><span style="color: #DD0000">"de"</span><span style="color: #007700">, -</span><span style="color: #0000BB">2</span><span style="color: #007700">, </span><span style="color: #0000BB">2</span><span style="color: #007700">); </span><span style="color: #FF8000">// 0<br /></span><span style="color: #007700">echo </span><span style="color: #0000BB">substr_compare</span><span style="color: #007700">(</span><span style="color: #DD0000">"abcde"</span><span style="color: #007700">, </span><span style="color: #DD0000">"bcg"</span><span style="color: #007700">, </span><span style="color: #0000BB">1</span><span style="color: #007700">, </span><span style="color: #0000BB">2</span><span style="color: #007700">); </span><span style="color: #FF8000">// 0<br /></span><span style="color: #007700">echo </span><span style="color: #0000BB">substr_compare</span><span style="color: #007700">(</span><span style="color: #DD0000">"abcde"</span><span style="color: #007700">, </span><span style="color: #DD0000">"BC"</span><span style="color: #007700">, </span><span style="color: #0000BB">1</span><span style="color: #007700">, </span><span style="color: #0000BB">2</span><span style="color: #007700">, </span><span style="color: #0000BB">true</span><span style="color: #007700">); </span><span style="color: #FF8000">// 0<br /></span><span style="color: #007700">echo </span><span style="color: #0000BB">substr_compare</span><span style="color: #007700">(</span><span style="color: #DD0000">"abcde"</span><span style="color: #007700">, </span><span style="color: #DD0000">"bc"</span><span style="color: #007700">, </span><span style="color: #0000BB">1</span><span style="color: #007700">, </span><span style="color: #0000BB">3</span><span style="color: #007700">); </span><span style="color: #FF8000">// 1<br /></span><span style="color: #007700">echo </span><span style="color: #0000BB">substr_compare</span><span style="color: #007700">(</span><span style="color: #DD0000">"abcde"</span><span style="color: #007700">, </span><span style="color: #DD0000">"cd"</span><span style="color: #007700">, </span><span style="color: #0000BB">1</span><span style="color: #007700">, </span><span style="color: #0000BB">2</span><span style="color: #007700">); </span><span style="color: #FF8000">// -1<br /></span><span style="color: #007700">echo </span><span style="color: #0000BB">substr_compare</span><span style="color: #007700">(</span><span style="color: #DD0000">"abcde"</span><span style="color: #007700">, </span><span style="color: #DD0000">"abc"</span><span style="color: #007700">, </span><span style="color: #0000BB">5</span><span style="color: #007700">, </span><span style="color: #0000BB">1</span><span style="color: #007700">); </span><span style="color: #FF8000">// warning<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
    </div>

   </div>
  </p>
 </div>


 <div class="refsect1 seealso" id="refsect1-function.substr-compare-seealso">
  <h3 class="title">参见</h3>
  <p class="para">
   <ul class="simplelist">
    <li class="member"><span class="function"><a href="function.strncmp.html" class="function" rel="rdfs-seeAlso">strncmp()</a> - 二进制安全比较字符串开头的若干个字符</span></li>
   </ul>
  </p>
 </div>

 
</div><div id="usernotes">
 <div class="head">
  <h3 class="title">User Contributed Notes</h3>
 </div>
<div id="allnotes">  <a name="119982""></a>
  <div class="note">
   <strong class="user">bishop at php dot net</strong>
   <a href="#119982" class="date">03-Oct-2016 07:28</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
This function efficiently implements checks for strings beginning or ending with other strings:<br />
<br />
<span class="default">&lt;?php<br />
<br />
</span><span class="keyword">function </span><span class="default">str_begins</span><span class="keyword">(</span><span class="default">$haystack</span><span class="keyword">, </span><span class="default">$needle</span><span class="keyword">) {<br />
&nbsp; return </span><span class="default">0 </span><span class="keyword">=== </span><span class="default">substr_compare</span><span class="keyword">(</span><span class="default">$haystack</span><span class="keyword">, </span><span class="default">$needle</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$needle</span><span class="keyword">));<br />
}<br />
<br />
function </span><span class="default">str_ends</span><span class="keyword">(</span><span class="default">$haystack</span><span class="keyword">,&nbsp; </span><span class="default">$needle</span><span class="keyword">) {<br />
&nbsp; return </span><span class="default">0 </span><span class="keyword">=== </span><span class="default">substr_compare</span><span class="keyword">(</span><span class="default">$haystack</span><span class="keyword">, </span><span class="default">$needle</span><span class="keyword">, -</span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$needle</span><span class="keyword">));<br />
}<br />
<br />
</span><span class="default">var_dump</span><span class="keyword">(</span><span class="default">str_begins</span><span class="keyword">(</span><span class="string">'<a href="http://example.com" rel="nofollow" target="_blank">http://example.com</a>'</span><span class="keyword">, </span><span class="string">'https://'</span><span class="keyword">));<br />
<br />
</span><span class="default">?&gt;<br />
</span><br />
Note that these are not multi-byte character set aware.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="110859""></a>
  <div class="note">
   <strong class="user">jimmetry at gmail dot com</strong>
   <a href="#110859" class="date">16-Dec-2012 12:31</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
When you came to this page, you may have been looking for something a little simpler: A function that can check if a small string exists within a larger string starting at a particular index. Using substr_compare() for this can leave your code messy, because you need to check that your string is long enough (to avoid the warning), manually specify the length of the short string, and like many of the string functions, perform an integer comparison to answer a true/false question.<br />
<br />
I put together a simple function to return true if $str exists within $mainStr. If $loc is specified, the $str must begin at that index. If not, the entire $mainStr will be searched.<br />
<br />
<span class="default">&lt;?php<br />
<br />
</span><span class="keyword">function </span><span class="default">contains_substr</span><span class="keyword">(</span><span class="default">$mainStr</span><span class="keyword">, </span><span class="default">$str</span><span class="keyword">, </span><span class="default">$loc </span><span class="keyword">= </span><span class="default">false</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; if (</span><span class="default">$loc </span><span class="keyword">=== </span><span class="default">false</span><span class="keyword">) return (</span><span class="default">strpos</span><span class="keyword">(</span><span class="default">$mainStr</span><span class="keyword">, </span><span class="default">$str</span><span class="keyword">) !== </span><span class="default">false</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; if (</span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$mainStr</span><span class="keyword">) &lt; </span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$str</span><span class="keyword">)) return </span><span class="default">false</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; if ((</span><span class="default">$loc </span><span class="keyword">+ </span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$str</span><span class="keyword">)) &gt; </span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$mainStr</span><span class="keyword">)) return </span><span class="default">false</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; return (</span><span class="default">strcmp</span><span class="keyword">(</span><span class="default">substr</span><span class="keyword">(</span><span class="default">$mainStr</span><span class="keyword">, </span><span class="default">$loc</span><span class="keyword">, </span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$str</span><span class="keyword">)), </span><span class="default">$str</span><span class="keyword">) == </span><span class="default">0</span><span class="keyword">);<br />
}<br />
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="109636""></a>
  <div class="note">
   <strong class="user">Skyborne</strong>
   <a href="#109636" class="date">03-Aug-2012 01:55</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Take note of the `length` parameter: "The default value is the largest of the length of the str compared to the length of main_str less the offset."<br />
<br />
This is *not* the length of str as you might (I always) expect, so if you leave it out, you'll get unexpected results.&nbsp; Example:<br />
<br />
<span class="default">&lt;?php<br />
$hash </span><span class="keyword">= </span><span class="string">'$5$lalalalalalalala$crypt.output.here'</span><span class="keyword">;<br />
</span><span class="default">var_dump</span><span class="keyword">(</span><span class="default">substr_compare</span><span class="keyword">(</span><span class="default">$hash</span><span class="keyword">, </span><span class="string">'$5$'</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">)); </span><span class="comment"># int(34)<br />
</span><span class="default">var_dump</span><span class="keyword">(</span><span class="default">substr_compare</span><span class="keyword">(</span><span class="default">$hash</span><span class="keyword">, </span><span class="string">'$5$'</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">3</span><span class="keyword">)); </span><span class="comment"># int(0)<br />
</span><span class="default">var_dump</span><span class="keyword">(</span><span class="default">PHP_VERSION</span><span class="keyword">); </span><span class="comment"># string(6) "5.3.14"<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="53084""></a>
  <div class="note">
   <strong class="user">sleek</strong>
   <a href="#53084" class="date">23-May-2005 05:07</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Modified version of the original posted function. Use this one:<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">if (!</span><span class="default">function_exists</span><span class="keyword">(</span><span class="string">'substr_compare'</span><span class="keyword">)) {<br />
&nbsp;&nbsp;&nbsp; function </span><span class="default">substr_compare</span><span class="keyword">(</span><span class="default">$main_str</span><span class="keyword">, </span><span class="default">$str</span><span class="keyword">, </span><span class="default">$offset</span><span class="keyword">, </span><span class="default">$length </span><span class="keyword">= </span><span class="default">NULL</span><span class="keyword">, </span><span class="default">$case_insensitivity </span><span class="keyword">= </span><span class="default">false</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$offset </span><span class="keyword">= (int) </span><span class="default">$offset</span><span class="keyword">;<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// Throw a warning because the offset is invalid<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">if (</span><span class="default">$offset </span><span class="keyword">&gt;= </span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$main_str</span><span class="keyword">)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">trigger_error</span><span class="keyword">(</span><span class="string">'The start position cannot exceed initial string length.'</span><span class="keyword">, </span><span class="default">E_USER_WARNING</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">false</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// We are comparing the first n-characters of each string, so let's use the PHP function to do it<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">if (</span><span class="default">$offset </span><span class="keyword">== </span><span class="default">0 </span><span class="keyword">&amp;&amp; </span><span class="default">is_int</span><span class="keyword">(</span><span class="default">$length</span><span class="keyword">) &amp;&amp; </span><span class="default">$case_insensitivity </span><span class="keyword">=== </span><span class="default">true</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">strncasecmp</span><span class="keyword">(</span><span class="default">$main_str</span><span class="keyword">, </span><span class="default">$str</span><span class="keyword">, </span><span class="default">$length</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// Get the substring that we are comparing<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">if (</span><span class="default">is_int</span><span class="keyword">(</span><span class="default">$length</span><span class="keyword">)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$main_substr </span><span class="keyword">= </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$main_str</span><span class="keyword">, </span><span class="default">$offset</span><span class="keyword">, </span><span class="default">$length</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$str_substr </span><span class="keyword">= </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$str</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">$length</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; } else {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$main_substr </span><span class="keyword">= </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$main_str</span><span class="keyword">, </span><span class="default">$offset</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$str_substr </span><span class="keyword">= </span><span class="default">$str</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// Return a case-insensitive comparison of the two strings<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">if (</span><span class="default">$case_insensitivity </span><span class="keyword">=== </span><span class="default">true</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">strcasecmp</span><span class="keyword">(</span><span class="default">$main_substr</span><span class="keyword">, </span><span class="default">$str_substr</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// Return a case-sensitive comparison of the two strings<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">return </span><span class="default">strcmp</span><span class="keyword">(</span><span class="default">$main_substr</span><span class="keyword">, </span><span class="default">$str_substr</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }<br />
}<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
</div>
</div>
</div></div></body></html>
