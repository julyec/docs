<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
 <head>
  <meta http-equiv="content-type" content="text/html; CHARSET=UTF-8">
  <title>Open a new connection to the MySQL server</title>
<link media="all" rel="stylesheet" type="text/css" href="styles/03e73060321a0a848018724a6c83de7f-theme-base.css" />
<link media="all" rel="stylesheet" type="text/css" href="styles/03e73060321a0a848018724a6c83de7f-theme-medium.css" />

  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <link media="all" rel="stylesheet" type="text/css" href="style.css"/>
 </head>
 <body class="docs" class="docs"><div class="navbar navbar-fixed-top">
  <div class="navbar-inner clearfix">
    <ul class="nav" style="width: 100%">
      <li style="float: left;"><a href="mysqli.connect-error.html">? mysqli::$connect_error</a></li>
      <li style="float: right;"><a href="mysqli.debug.html">mysqli::debug ?</a></li>
    </ul>
  </div>
</div>
<div id="breadcrumbs" class="clearfix">
  <ul class="breadcrumbs-container">
    <li><a href="index.html">PHP Manual</a></li>
    <li><a href="class.mysqli.html">mysqli</a></li>
    <li>Open a new connection to the MySQL server</li>
  </ul>
</div>
<div id="layout">
  <div id="layout-content"><div id="mysqli.construct" class="refentry">
 <div class="refnamediv">
  <h1 class="refname">mysqli::__construct</h1>
  <h1 class="refname">mysqli::connect</h1>
  <h1 class="refname">mysqli_connect</h1>
  <p class="verinfo">(PHP 5, PHP 7, PHP 8)</p><p class="refpurpose"><span class="refname">mysqli::__construct</span> -- <span class="refname">mysqli::connect</span> -- <span class="refname">mysqli_connect</span> &mdash; <span class="dc-title">Open a new connection to the MySQL server</span></p>

 </div>

 <div class="refsect1 description" id="refsect1-mysqli.construct-description">
  <h3 class="title">说明</h3>
  <p class="para">面向对象风格</p>
  <div class="constructorsynopsis dc-description">
   <span class="modifier">public</span> <span class="methodname"><strong>mysqli::__construct</strong></span>(<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="methodparam"><span class="type">?</span><span class="type"><span class="type">string</span><span class="type"></span></span> <code class="parameter">$hostname</code><span class="initializer"> = <strong><code>null</code></strong></span></span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="methodparam"><span class="type">?</span><span class="type"><span class="type">string</span><span class="type"></span></span> <code class="parameter">$username</code><span class="initializer"> = <strong><code>null</code></strong></span></span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="methodparam"><span class="type">?</span><span class="type"><span class="type">string</span><span class="type"></span></span> <code class="parameter">$password</code><span class="initializer"> = <strong><code>null</code></strong></span></span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="methodparam"><span class="type">?</span><span class="type"><span class="type">string</span><span class="type"></span></span> <code class="parameter">$database</code><span class="initializer"> = <strong><code>null</code></strong></span></span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="methodparam"><span class="type">?</span><span class="type"><span class="type">int</span><span class="type"></span></span> <code class="parameter">$port</code><span class="initializer"> = <strong><code>null</code></strong></span></span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="methodparam"><span class="type">?</span><span class="type"><span class="type">string</span><span class="type"></span></span> <code class="parameter">$socket</code><span class="initializer"> = <strong><code>null</code></strong></span></span><br>)</div>

  <div class="methodsynopsis dc-description"><span class="modifier">public</span> <span class="methodname"><a href="function.mysqli-connect.html" class="methodname">mysqli::connect</a></span>(<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="methodparam"><span class="type">?</span><span class="type"><span class="type">string</span><span class="type"></span></span> <code class="parameter">$hostname</code><span class="initializer"> = <strong><code>null</code></strong></span></span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="methodparam"><span class="type">?</span><span class="type"><span class="type">string</span><span class="type"></span></span> <code class="parameter">$username</code><span class="initializer"> = <strong><code>null</code></strong></span></span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="methodparam"><span class="type">?</span><span class="type"><span class="type">string</span><span class="type"></span></span> <code class="parameter">$password</code><span class="initializer"> = <strong><code>null</code></strong></span></span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="methodparam"><span class="type">?</span><span class="type"><span class="type">string</span><span class="type"></span></span> <code class="parameter">$database</code><span class="initializer"> = <strong><code>null</code></strong></span></span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="methodparam"><span class="type">?</span><span class="type"><span class="type">int</span><span class="type"></span></span> <code class="parameter">$port</code><span class="initializer"> = <strong><code>null</code></strong></span></span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="methodparam"><span class="type">?</span><span class="type"><span class="type">string</span><span class="type"></span></span> <code class="parameter">$socket</code><span class="initializer"> = <strong><code>null</code></strong></span></span><br>): <span class="type">bool</span></div>

  <p class="para rdfs-comment">过程化风格</p>
  <div class="methodsynopsis dc-description"><span class="methodname"><a href="function.mysqli-connect.html" class="methodname">mysqli_connect</a></span>(<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="methodparam"><span class="type">?</span><span class="type"><span class="type">string</span><span class="type"></span></span> <code class="parameter">$hostname</code><span class="initializer"> = <strong><code>null</code></strong></span></span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="methodparam"><span class="type">?</span><span class="type"><span class="type">string</span><span class="type"></span></span> <code class="parameter">$username</code><span class="initializer"> = <strong><code>null</code></strong></span></span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="methodparam"><span class="type">?</span><span class="type"><span class="type">string</span><span class="type"></span></span> <code class="parameter">$password</code><span class="initializer"> = <strong><code>null</code></strong></span></span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="methodparam"><span class="type">?</span><span class="type"><span class="type">string</span><span class="type"></span></span> <code class="parameter">$database</code><span class="initializer"> = <strong><code>null</code></strong></span></span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="methodparam"><span class="type">?</span><span class="type"><span class="type">int</span><span class="type"></span></span> <code class="parameter">$port</code><span class="initializer"> = <strong><code>null</code></strong></span></span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="methodparam"><span class="type">?</span><span class="type"><span class="type">string</span><span class="type"></span></span> <code class="parameter">$socket</code><span class="initializer"> = <strong><code>null</code></strong></span></span><br>): <span class="type"><span class="type"><a href="class.mysqli.html" class="type mysqli">mysqli</a></span>|<span class="type"><span class="type false">false</span></span></span></div>

  <p class="para rdfs-comment">
   Opens a connection to the MySQL Server.
  </p>
 </div>


 <div class="refsect1 parameters" id="refsect1-mysqli.construct-parameters">
  <h3 class="title">参数</h3>
  <p class="para">
   <dl>
    
     <dt>
<code class="parameter">hostname</code></dt>

     <dd>

      <p class="para">
       Can be either a host name or an IP address. When passing <strong><code>null</code></strong>, the value is retrieved from
       <a href="mysqli.configuration.html#ini.mysqli.default-host" class="link">mysqli.default_host</a>.
       When possible, pipes will be used instead of the TCP/IP protocol.
       The TCP/IP protocol is used if a host name and port number are provided together e.g. <code class="literal">localhost:3308</code>.
      </p>
      <p class="para">
       Prepending host by <code class="literal">p:</code> opens a persistent connection.
       <span class="function"><a href="mysqli.change-user.html" class="function">mysqli_change_user()</a></span> is automatically called on
       connections opened from the connection pool.
      </p>
     </dd>

    
    
     <dt>
<code class="parameter">username</code></dt>

     <dd>

      <p class="para">
       The MySQL username or <strong><code>null</code></strong> to assume the username based on the
       <a href="mysqli.configuration.html#ini.mysqli.default-user" class="link">mysqli.default_user</a> ini option.
      </p>
     </dd>

    
    
     <dt>
<code class="parameter">password</code></dt>

     <dd>

      <p class="para">
       The MySQL password or <strong><code>null</code></strong> to assume the password based on the
       <a href="mysqli.configuration.html#ini.mysqli.default-pw" class="link">mysqli.default_pw</a> ini option.
      </p>
     </dd>

    
    
     <dt>
<code class="parameter">database</code></dt>

     <dd>

      <p class="para">
       The default database to be used when performing queries or <strong><code>null</code></strong>.
      </p>
     </dd>

    
    
     <dt>
<code class="parameter">port</code></dt>

     <dd>

      <p class="para">
       The port number to attempt to connect to the MySQL server or <strong><code>null</code></strong> to assume the port based on the
       <a href="mysqli.configuration.html#ini.mysqli.default-port" class="link">mysqli.default_port</a> ini option.
      </p>
     </dd>

    
    
     <dt>
<code class="parameter">socket</code></dt>

     <dd>

      <p class="para">
       The socket or named pipe that should be used or <strong><code>null</code></strong> to assume the socket based on the
       <a href="mysqli.configuration.html#ini.mysqli.default-socket" class="link">mysqli.default_socket</a> ini option.
      </p>
      <blockquote class="note"><p><strong class="note">Note</strong>: 
       <p class="para">
        Specifying the <code class="parameter">socket</code> parameter will not
        explicitly determine the type of connection to be used when
        connecting to the MySQL server. How the connection is made to the
        MySQL database is determined by the <code class="parameter">hostname</code>
        parameter.
       </p>
      </p></blockquote>
     </dd>

    
   </dl>

  </p>
 </div>


 <div class="refsect1 returnvalues" id="refsect1-mysqli.construct-returnvalues">
  <h3 class="title">返回值</h3>
  <p class="para">
   <span class="methodname"><strong>mysqli::__construct()</strong></span> always returns an object which represents the connection to a MySQL Server, 
   regardless of it being successful or not.
  </p>
  <p class="para">
   <span class="function"><a href="function.mysqli-connect.html" class="function">mysqli_connect()</a></span> returns an object which represents the connection to a MySQL Server,
    或者在失败时返回 <strong><code>false</code></strong>.
  </p>
  <p class="para">
   <span class="methodname"><a href="function.mysqli-connect.html" class="methodname">mysqli::connect()</a></span> returns <strong><code>null</code></strong> on success 或者在失败时返回 <strong><code>false</code></strong>.
  </p>
 </div>


 <div class="refsect1 errors" id="refsect1-mysqli.construct-errors">
  <h3 class="title">错误／异常</h3>
  <p class="para">
If mysqli error reporting is enabled (<strong><code>MYSQLI_REPORT_ERROR</code></strong>) and the requested operation fails,
a warning is generated. If, in addition, the mode is set to <strong><code>MYSQLI_REPORT_STRICT</code></strong>,
a <span class="classname"><a href="class.mysqli-sql-exception.html" class="classname">mysqli_sql_exception</a></span> is thrown instead.</p>
 </div>


 <div class="refsect1 changelog" id="refsect1-mysqli.construct-changelog">
  <h3 class="title">更新日志</h3>
  <p class="para">
   <table class="doctable informaltable">
    
     <thead>
      <tr>
       <th>版本</th>
       <th>说明</th>
      </tr>

     </thead>

     <tbody class="tbody">
      <tr>
       <td>7.4.0</td>
       <td>
        All parameters are now nullable.
       </td>
      </tr>

     </tbody>
    
   </table>

  </p>
 </div>


 <div class="refsect1 examples" id="refsect1-mysqli.construct-examples">
  <h3 class="title">示例</h3>
  <div class="example" id="example-2916">
   <p><strong>Example #1 <span class="methodname"><strong>mysqli::__construct()</strong></span> example</strong></p>
   <div class="example-contents"><p>面向对象风格</p></div>
   <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br /><br /></span><span style="color: #FF8000">/* You should enable error reporting for mysqli before attempting to make a connection */<br /></span><span style="color: #0000BB">mysqli_report</span><span style="color: #007700">(</span><span style="color: #0000BB">MYSQLI_REPORT_ERROR </span><span style="color: #007700">| </span><span style="color: #0000BB">MYSQLI_REPORT_STRICT</span><span style="color: #007700">);<br /><br /></span><span style="color: #0000BB">$mysqli </span><span style="color: #007700">= new </span><span style="color: #0000BB">mysqli</span><span style="color: #007700">(</span><span style="color: #DD0000">'localhost'</span><span style="color: #007700">, </span><span style="color: #DD0000">'my_user'</span><span style="color: #007700">, </span><span style="color: #DD0000">'my_password'</span><span style="color: #007700">, </span><span style="color: #DD0000">'my_db'</span><span style="color: #007700">);<br /><br /></span><span style="color: #FF8000">/* Set the desired charset after establishing a connection */<br /></span><span style="color: #0000BB">$mysqli</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">set_charset</span><span style="color: #007700">(</span><span style="color: #DD0000">'utf8mb4'</span><span style="color: #007700">);<br /><br /></span><span style="color: #0000BB">printf</span><span style="color: #007700">(</span><span style="color: #DD0000">"Success... %s\n"</span><span style="color: #007700">, </span><span style="color: #0000BB">$mysqli</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">host_info</span><span style="color: #007700">);</span>
</span>
</code></div>
   </div>

   <div class="example-contents"><p>过程化风格</p></div>
   <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br /><br /></span><span style="color: #FF8000">/* You should enable error reporting for mysqli before attempting to make a connection */<br /></span><span style="color: #0000BB">mysqli_report</span><span style="color: #007700">(</span><span style="color: #0000BB">MYSQLI_REPORT_ERROR </span><span style="color: #007700">| </span><span style="color: #0000BB">MYSQLI_REPORT_STRICT</span><span style="color: #007700">);<br /><br /></span><span style="color: #0000BB">$mysqli </span><span style="color: #007700">= </span><span style="color: #0000BB">mysqli_connect</span><span style="color: #007700">(</span><span style="color: #DD0000">'localhost'</span><span style="color: #007700">, </span><span style="color: #DD0000">'my_user'</span><span style="color: #007700">, </span><span style="color: #DD0000">'my_password'</span><span style="color: #007700">, </span><span style="color: #DD0000">'my_db'</span><span style="color: #007700">);<br /><br /></span><span style="color: #FF8000">/* Set the desired charset after establishing a connection */<br /></span><span style="color: #0000BB">mysqli_set_charset</span><span style="color: #007700">(</span><span style="color: #0000BB">$mysqli</span><span style="color: #007700">, </span><span style="color: #DD0000">'utf8mb4'</span><span style="color: #007700">);<br /><br /></span><span style="color: #0000BB">printf</span><span style="color: #007700">(</span><span style="color: #DD0000">"Success... %s\n"</span><span style="color: #007700">, </span><span style="color: #0000BB">mysqli_get_host_info</span><span style="color: #007700">(</span><span style="color: #0000BB">$mysqli</span><span style="color: #007700">));</span>
</span>
</code></div>
   </div>

   <div class="example-contents"><p>以上示例的输出类似于：</p></div>
   <div class="example-contents screen">
<div class="cdata"><pre>
Success... localhost via TCP/IP
</pre></div>
   </div>
  </div>
  <div class="example" id="example-2918">
   <p><strong>Example #2 Extending mysqli class</strong></p>
   <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br /><br /></span><span style="color: #007700">class </span><span style="color: #0000BB">FooMysqli </span><span style="color: #007700">extends </span><span style="color: #0000BB">mysqli </span><span style="color: #007700">{<br />    public function </span><span style="color: #0000BB">__construct</span><span style="color: #007700">(</span><span style="color: #0000BB">$host</span><span style="color: #007700">, </span><span style="color: #0000BB">$user</span><span style="color: #007700">, </span><span style="color: #0000BB">$pass</span><span style="color: #007700">, </span><span style="color: #0000BB">$db</span><span style="color: #007700">, </span><span style="color: #0000BB">$port</span><span style="color: #007700">, </span><span style="color: #0000BB">$socket</span><span style="color: #007700">, </span><span style="color: #0000BB">$charset</span><span style="color: #007700">) {<br />        </span><span style="color: #0000BB">mysqli_report</span><span style="color: #007700">(</span><span style="color: #0000BB">MYSQLI_REPORT_ERROR </span><span style="color: #007700">| </span><span style="color: #0000BB">MYSQLI_REPORT_STRICT</span><span style="color: #007700">);<br />        </span><span style="color: #0000BB">parent</span><span style="color: #007700">::</span><span style="color: #0000BB">__construct</span><span style="color: #007700">(</span><span style="color: #0000BB">$host</span><span style="color: #007700">, </span><span style="color: #0000BB">$user</span><span style="color: #007700">, </span><span style="color: #0000BB">$pass</span><span style="color: #007700">, </span><span style="color: #0000BB">$db</span><span style="color: #007700">, </span><span style="color: #0000BB">$port</span><span style="color: #007700">, </span><span style="color: #0000BB">$socket</span><span style="color: #007700">);<br />        </span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">set_charset</span><span style="color: #007700">(</span><span style="color: #0000BB">$charset</span><span style="color: #007700">);<br />    }<br />}<br /><br /></span><span style="color: #0000BB">$db </span><span style="color: #007700">= new </span><span style="color: #0000BB">FooMysqli</span><span style="color: #007700">(</span><span style="color: #DD0000">'localhost'</span><span style="color: #007700">, </span><span style="color: #DD0000">'my_user'</span><span style="color: #007700">, </span><span style="color: #DD0000">'my_password'</span><span style="color: #007700">, </span><span style="color: #DD0000">'my_db'</span><span style="color: #007700">, </span><span style="color: #0000BB">3306</span><span style="color: #007700">, </span><span style="color: #0000BB">null</span><span style="color: #007700">, </span><span style="color: #DD0000">'utf8mb4'</span><span style="color: #007700">);</span>
</span>
</code></div>
   </div>

  </div>
  <div class="example" id="example-2920">
   <p><strong>Example #3 Manual error handling</strong></p>
   <div class="example-contents"><p>If error reporting is disabled, the developer is responsible for checking and handling failures</p></div>
   <div class="example-contents"><p>面向对象风格</p></div>
   <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br /><br />error_reporting</span><span style="color: #007700">(</span><span style="color: #0000BB">0</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">mysqli_report</span><span style="color: #007700">(</span><span style="color: #0000BB">MYSQLI_REPORT_OFF</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">$mysqli </span><span style="color: #007700">= new </span><span style="color: #0000BB">mysqli</span><span style="color: #007700">(</span><span style="color: #DD0000">'localhost'</span><span style="color: #007700">, </span><span style="color: #DD0000">'my_user'</span><span style="color: #007700">, </span><span style="color: #DD0000">'my_password'</span><span style="color: #007700">, </span><span style="color: #DD0000">'my_db'</span><span style="color: #007700">);<br />if (</span><span style="color: #0000BB">$mysqli</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">connect_errno</span><span style="color: #007700">) {<br />    throw new </span><span style="color: #0000BB">RuntimeException</span><span style="color: #007700">(</span><span style="color: #DD0000">'mysqli connection error: ' </span><span style="color: #007700">. </span><span style="color: #0000BB">$mysqli</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">connect_error</span><span style="color: #007700">);<br />}<br /><br /></span><span style="color: #FF8000">/* Set the desired charset after establishing a connection */<br /></span><span style="color: #0000BB">$mysqli</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">set_charset</span><span style="color: #007700">(</span><span style="color: #DD0000">'utf8mb4'</span><span style="color: #007700">);<br />if (</span><span style="color: #0000BB">$mysqli</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">errno</span><span style="color: #007700">) {<br />    throw new </span><span style="color: #0000BB">RuntimeException</span><span style="color: #007700">(</span><span style="color: #DD0000">'mysqli error: ' </span><span style="color: #007700">. </span><span style="color: #0000BB">$mysqli</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">error</span><span style="color: #007700">);<br />}</span>
</span>
</code></div>
   </div>

   <div class="example-contents"><p>过程化风格</p></div>
   <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br /><br />error_reporting</span><span style="color: #007700">(</span><span style="color: #0000BB">0</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">mysqli_report</span><span style="color: #007700">(</span><span style="color: #0000BB">MYSQLI_REPORT_OFF</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">$mysqli </span><span style="color: #007700">= </span><span style="color: #0000BB">mysqli_connect</span><span style="color: #007700">(</span><span style="color: #DD0000">'localhost'</span><span style="color: #007700">, </span><span style="color: #DD0000">'my_user'</span><span style="color: #007700">, </span><span style="color: #DD0000">'my_password'</span><span style="color: #007700">, </span><span style="color: #DD0000">'my_db'</span><span style="color: #007700">);<br />if (</span><span style="color: #0000BB">mysqli_connect_errno</span><span style="color: #007700">()) {<br />    throw new </span><span style="color: #0000BB">RuntimeException</span><span style="color: #007700">(</span><span style="color: #DD0000">'mysqli connection error: ' </span><span style="color: #007700">. </span><span style="color: #0000BB">mysqli_connect_error</span><span style="color: #007700">());<br />}<br /><br /></span><span style="color: #FF8000">/* Set the desired charset after establishing a connection */<br /></span><span style="color: #0000BB">mysqli_set_charset</span><span style="color: #007700">(</span><span style="color: #0000BB">$mysqli</span><span style="color: #007700">, </span><span style="color: #DD0000">'utf8mb4'</span><span style="color: #007700">);<br />if (</span><span style="color: #0000BB">mysqli_errno</span><span style="color: #007700">(</span><span style="color: #0000BB">$mysqli</span><span style="color: #007700">)) {<br />    throw new </span><span style="color: #0000BB">RuntimeException</span><span style="color: #007700">(</span><span style="color: #DD0000">'mysqli error: ' </span><span style="color: #007700">. </span><span style="color: #0000BB">mysqli_error</span><span style="color: #007700">(</span><span style="color: #0000BB">$mysqli</span><span style="color: #007700">));<br />}</span>
</span>
</code></div>
   </div>

  </div>
 </div>


 <div class="refsect1 notes" id="refsect1-mysqli.construct-notes">
  <h3 class="title">注释</h3>
  <blockquote class="note"><p><strong class="note">Note</strong>: 
<p class="para">MySQLnd 总是使用服务器的默认字符集。此字符集在连接握手／认证时发送，并被 mysqlnd
使用。</p><p class="para">Libmysqlclient 使用 <var class="filename">my.cnf</var> 中的默认字符集或者由在调用
<span class="function"><a href="mysqli.init.html" class="function">mysqli_init()</a></span> 之后，<span class="function"><a href="mysqli.real-connect.html" class="function">mysqli_real_connect()</a></span>
之前先调用 <span class="function"><a href="mysqli.options.html" class="function">mysqli_options()</a></span> 来指定。</p></p></blockquote>
  <blockquote class="note"><p><strong class="note">Note</strong>: 
   <p class="para">
    面向对象风格 only: If the connection fails, an object is still returned. To check 
    whether the connection failed, use either the 
    <span class="function"><a href="mysqli.connect-error.html" class="function">mysqli_connect_error()</a></span> function or the <a href="mysqli.connect-error.html" class="link">mysqli-&gt;connect_error</a> property as in 
    the preceding examples.
   </p>
  </p></blockquote>
  <blockquote class="note"><p><strong class="note">Note</strong>: 
   <p class="para">
    If it is necessary to set options, such as the connection timeout,
    <span class="function"><a href="mysqli.real-connect.html" class="function">mysqli_real_connect()</a></span> must be used instead.
   </p>
  </p></blockquote>
  <blockquote class="note"><p><strong class="note">Note</strong>: 
   <p class="para">
    Calling the constructor with no parameters is the same as calling
    <span class="function"><a href="mysqli.init.html" class="function">mysqli_init()</a></span>.
   </p>
  </p></blockquote>
  <blockquote class="note"><p><strong class="note">Note</strong>: 
   <p class="para">
    Error &quot;Can&#039;t create TCP/IP socket (10106)&quot; usually means that the <a href="ini.core.html#ini.variables-order" class="link">variables_order</a> configure directive
    doesn&#039;t contain character <code class="literal">E</code>. On Windows, if the
    environment is not copied the <code class="literal">SYSTEMROOT</code> environment
    variable won&#039;t be available and PHP will have problems loading Winsock.
   </p>
  </p></blockquote>
 </div>


 <div class="refsect1 seealso" id="refsect1-mysqli.construct-seealso">
  <h3 class="title">参见</h3>
  <p class="para">
   <ul class="simplelist">
    <li class="member"><span class="function"><a href="mysqli.real-connect.html" class="function" rel="rdfs-seeAlso">mysqli_real_connect()</a> - 建立一个 MySQL 服务器连接</span></li>
    <li class="member"><span class="function"><a href="mysqli.options.html" class="function" rel="rdfs-seeAlso">mysqli_options()</a> - 设置选项</span></li>
    <li class="member"><span class="function"><a href="mysqli.connect-errno.html" class="function" rel="rdfs-seeAlso">mysqli_connect_errno()</a> - Returns the error code from last connect call</span></li>
    <li class="member"><span class="function"><a href="mysqli.connect-error.html" class="function" rel="rdfs-seeAlso">mysqli_connect_error()</a> - Returns a description of the last connection error</span></li>
    <li class="member"><span class="function"><a href="mysqli.close.html" class="function" rel="rdfs-seeAlso">mysqli_close()</a> - 关闭先前打开的数据库连接</span></li>
   </ul>
  </p>
 </div>


</div><div id="usernotes">
 <div class="head">
  <h3 class="title">User Contributed Notes</h3>
 </div>
<div id="allnotes">  <a name="128071""></a>
  <div class="note">
   <strong class="user">arnold at nijboer dot it</strong>
   <a href="#128071" class="date">31-Dec-2022 12:17</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
public mysqli::__construct(<br />
&nbsp;&nbsp;&nbsp;&nbsp;string $hostname = ini_get("mysqli.default_host"),<br />
&nbsp;&nbsp;&nbsp;&nbsp;string $username = ini_get("mysqli.default_user"),<br />
&nbsp;&nbsp;&nbsp;&nbsp;string $password = ini_get("mysqli.default_pw"),<br />
&nbsp;&nbsp;&nbsp;&nbsp;string $database = "",<br />
&nbsp;&nbsp;&nbsp;&nbsp;int $port = ini_get("mysqli.default_port"),<br />
&nbsp;&nbsp;&nbsp;&nbsp;string $socket = ini_get("mysqli.default_socket")<br />
)<br />
<br />
the mysqli construct looks at the Master PHP.ini values.<br />
if you're using a local ini overwrite of some sort add the ini_get to you're php script:<br />
$mysqli = new mysqli(ini_get("mysqli.default_host"),ini_get("mysqli.default_user"),ini_get("mysqli.default_pw"))</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="122930""></a>
  <div class="note">
   <strong class="user">powtac at gmx de</strong>
   <a href="#122930" class="date">11-Jul-2018 04:25</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Be careful, mysqli_connect() does not return a resource ! It returns an instance of the mysqli class (<a href="http://php.net/manual/class.mysqli.php" rel="nofollow" target="_blank">http://php.net/manual/class.mysqli.php</a>) The old mysql_connect() function did return a resource.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="121712""></a>
  <div class="note">
   <strong class="user">php at haravikk dot me</strong>
   <a href="#121712" class="date">01-Oct-2017 06:58</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Just wanted to add a note for anyone looking to use the MySQLi persistent connections feature; it's important to note that PHP opens and retains one connection per database user per process.<br />
<br />
What this means is that if you are hosting multiple applications, each with its own database user (as is good practice) then you will end up multiplying the number of connections that PHP may hold open.<br />
<br />
For example, if you have PHP configured with a maximum of eight worker processes, and you regularly use four different database users, then your MySQL server will need to accept at LEAST a maximum of 32 connections, or else it will run out.<br />
<br />
However, if you would like to minimise the number of connections, what you can do is instead is to open the connection using a "guest" user (with no privileges except logging in) and then use -&gt;change_user() to switch to a more privileged user, before switching back to the guest when you're done. Since all of the connections would therefore belong to the guest user, PHP should only maintain one per worker process.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="121002""></a>
  <div class="note">
   <strong class="user">chris at ocproducts dot com</strong>
   <a href="#121002" class="date">21-Apr-2017 05:46</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
There's a separate port parameter, unlike mysql_connect. However, using host:port on the host parameter does actually work.<br />
<br />
There is a caveat. If the host is 'localhost' then the port is ignored, whether you use a port parameter or the implicit syntax I mentioned above. This is because 'localhost' will make it use unix sockets rather than TCP/IP.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="118769""></a>
  <div class="note">
   <strong class="user">PaulieG</strong>
   <a href="#118769" class="date">02-Feb-2016 06:31</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
It should be noted that on PHP 7 (v7.0.2 at least), passing the empty string '' for the Port argument while connecting to 'localhost' will prevent the connection from being successful altogether.<br />
<br />
To work around this, use 'null'.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="117665""></a>
  <div class="note">
   <strong class="user">webmaster at aryes dot fr</strong>
   <a href="#117665" class="date">18-Jul-2015 06:58</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
A friend of mine encountered a sudden bug with CMS Piwigo. I discovered that :<br />
- He had a hosting rule to use PHP 5.6.<br />
- The hoster uses 5.6.6, verified using phpinfo();.<br />
- The CMS declared a database name parameter as null.<br />
<br />
That gallery CMS was unable to connect to MySQL and left only a warning message about it.<br />
<br />
We tried to revert back to PHP 5.5, the CMS worked again.<br />
<br />
Then we switched back to 5.6.6 and changed those lines :<br />
<br />
&nbsp; $dbname = null;<br />
&nbsp; <br />
&nbsp; $mysqli = new mysqli($host, $user, $password, $dbname, $port, $socket);<br />
<br />
to<br />
<br />
&nbsp; $dbname = ''; // Use an empty string, not null<br />
&nbsp; <br />
&nbsp; $mysqli = new mysqli($host, $user, $password, $dbname, $port, $socket);<br />
<br />
It worked!<br />
<br />
So if you made the same mistake, using null where the manual invites to use an empty string, you should consider correcting your code.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="116808""></a>
  <div class="note">
   <strong class="user">Ben</strong>
   <a href="#116808" class="date">03-Mar-2015 11:28</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
A far more secure and language independent way of connecting to mysql is to use the READ_DEFAULT_FILE options. This passes the workload over to the mysql library, which allows for the configuration file itself to be outside of the scope of the language.<br />
<br />
The config file itself is something like this:<br />
[client]<br />
user=user_u<br />
password=user_password<br />
host=dbhost<br />
port=3306<br />
database=the_database<br />
default-character-set=utf8<br />
<br />
The following code fragment (in OO mysql_i format)<br />
<br />
$sqlconf='/var/private/my.cnf';<br />
$sql = new mysqli;<br />
$sql-&gt;init();<br />
$sql-&gt;options(MYSQLI_READ_DEFAULT_FILE,$sqlconf);<br />
$sql-&gt;real_connect();</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="116243""></a>
  <div class="note">
   <strong class="user">linguafranca2003 at yahoo dot com</strong>
   <a href="#116243" class="date">28-Nov-2014 05:21</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
mysqli can succeed in surprising ways, depending on the privileges granted to the user. For example,<br />
<br />
GRANT USAGE ON *.* TO 'myuser'@'localhost' IDENTIFIED BY PASSWORD 'mypassword';<br />
GRANT ALL PRIVILEGES ON `database_a`.* TO 'myuser'@'localhost';<br />
CREATE DATABASE database_b;<br />
<br />
<span class="default">&lt;?php<br />
$db </span><span class="keyword">= new </span><span class="default">mysqli</span><span class="keyword">(</span><span class="string">'localhost'</span><span class="keyword">, </span><span class="string">'myuser'</span><span class="keyword">, </span><span class="string">'mypassword'</span><span class="keyword">, </span><span class="string">'database_b'</span><span class="keyword">);<br />
<br />
if (</span><span class="default">$db</span><span class="keyword">-&gt;</span><span class="default">connect_error</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; die(</span><span class="string">'Connect Error (' </span><span class="keyword">. </span><span class="default">$db</span><span class="keyword">-&gt;</span><span class="default">connect_errno </span><span class="keyword">. </span><span class="string">') '<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">. </span><span class="default">$mysqli</span><span class="keyword">-&gt;</span><span class="default">connect_error</span><span class="keyword">);<br />
}<br />
<br />
</span><span class="default">printf</span><span class="keyword">(</span><span class="string">"SQLSTATE: %s\n"</span><span class="keyword">, </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">db</span><span class="keyword">-&gt;</span><span class="default">sqlstate</span><span class="keyword">);<br />
</span><span class="default">printf</span><span class="keyword">(</span><span class="string">"Warning Count: %s\n"</span><span class="keyword">, </span><span class="default">$db</span><span class="keyword">-&gt;</span><span class="default">warning_count</span><span class="keyword">);<br />
</span><span class="default">$db</span><span class="keyword">-&gt;</span><span class="default">close</span><span class="keyword">();<br />
</span><span class="default">?&gt;<br />
</span><br />
Will output:<br />
<br />
SQLSTATE: 00000 <br />
Warning Count: 0<br />
<br />
So, life is good &mdash; you're connected to the database and executing mysqli methods. Except, life isn't good, because you aren't actually using database_b because myuser doesn't have any privileges on it. You won't catch this until you try to perform a later operation, when you'll get an error, "MYSQL Error: No database selected", and find yourself scratching your head and thinking "what do you mean, of course I have a database selected; I selected one when I called the constructor".<br />
<br />
As a result, you may want to perform an additional check after connecting to mysql, to confirm that you're actually connected not just to the mysql server, but to the actual database:<br />
<br />
<span class="default">&lt;?php<br />
$db </span><span class="keyword">= new </span><span class="default">mysqli</span><span class="keyword">(</span><span class="string">'localhost'</span><span class="keyword">, </span><span class="string">'myuser'</span><span class="keyword">, </span><span class="string">'mypassword'</span><span class="keyword">, </span><span class="string">'database_b'</span><span class="keyword">);<br />
<br />
if (</span><span class="default">$db</span><span class="keyword">-&gt;</span><span class="default">connect_error</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; die(</span><span class="string">'Connect Error (' </span><span class="keyword">. </span><span class="default">$db</span><span class="keyword">-&gt;</span><span class="default">connect_errno </span><span class="keyword">. </span><span class="string">') '<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">. </span><span class="default">$mysqli</span><span class="keyword">-&gt;</span><span class="default">connect_error</span><span class="keyword">);<br />
} elseif (</span><span class="default">$result </span><span class="keyword">= </span><span class="default">$db</span><span class="keyword">-&gt;</span><span class="default">query</span><span class="keyword">(</span><span class="string">"SELECT DATABASE()"</span><span class="keyword">)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$row </span><span class="keyword">= </span><span class="default">$result</span><span class="keyword">-&gt;</span><span class="default">fetch_row</span><span class="keyword">();<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">$row</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">] != </span><span class="string">'database_b'</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">//oops! We're connected to mysql, but not to database_b<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">}<br />
}<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="115143""></a>
  <div class="note">
   <strong class="user">andres at 21brains dot com</strong>
   <a href="#115143" class="date">03-Jun-2014 09:39</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Please do use set_charset("utf8") after establishing the connection if you want to avoid weird string issues. I do not know why the documentation does not warn you about this kind of stuff.<br />
<br />
We had a hard time figuring out what was going on since we were using mb_detect_encoding and it said everything was UTF-8, but of course the display was wrong. If we used iconv from ISO-8859-1 to UTF-8 the strings looked fine, even though everything in the database had the right collation. So in the end, it was the connection that was the filter and although the notes for this function mention default charsets, it almost reads as a sidenote instead of a central issue when dealing with UTF and PHP/MySQL.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="114749""></a>
  <div class="note">
   <strong class="user">fugyl13 at gmail dot com</strong>
   <a href="#114749" class="date">01-Apr-2014 04:41</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Note that on all &gt;=Windows 7 Servers, a host name "localhost" will create a very expensive lookup (~1 Second). <br />
<br />
That's because since Windows 7, the hosts file doesn't come with a preconfigured<br />
127.0.0.1 localhost<br />
anymore<br />
<br />
So, if you notice a long connection creation, try "127.0.0.1" instead.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="112328""></a>
  <div class="note">
   <strong class="user">paul at mtnlist dot com</strong>
   <a href="#112328" class="date">02-Jun-2013 08:19</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you want to connect via an alternate port (other than 3306), as you might when using an ssh tunnel to another host, using "localhost" as the hostname will not work. <br />
<br />
Using 127.0.0.1 will work.&nbsp; Apparently, if you specify the host as "localhost", the constructor ignores the port specified as an argument to the constructor.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="111991""></a>
  <div class="note">
   <strong class="user">oleg at mastak dot fi</strong>
   <a href="#111991" class="date">19-Apr-2013 01:02</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you want to connect to local named pipe on windows and you get error "php_network_getaddresses: getaddrinfo failed: No such host is known. ", even if you using using "." as host, please check your if you are using mysqlnd driver: If this is true, then probably you need to update to version 5.4 of php:<br />
<br />
Named pipes support for Windows was added in PHP version 5.4.0.<br />
@ <a href="http://php.net/manual/en/mysqlnd.overview.php " rel="nofollow" target="_blank">http://php.net/manual/en/mysqlnd.overview.php </a><br />
<br />
Hopefully that will save you some time.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="93508""></a>
  <div class="note">
   <strong class="user">Anonymous</strong>
   <a href="#93508" class="date">13-Sep-2009 05:37</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you get an error like 
<br />
&nbsp; Can't connect to MySQL server on 'localhost' (10061)
<br />
and you use named pipes/socket connections (or aren't sure how you installed the MySQL server) try the following connect command:
<br />

<br />
<span class="default">&lt;?php
<br />
mysqli_connect</span><span class="keyword">(</span><span class="string">'.'</span><span class="keyword">, </span><span class="default">$user_name</span><span class="keyword">, </span><span class="default">$password</span><span class="keyword">, </span><span class="default">$database_name</span><span class="keyword">, </span><span class="default">null</span><span class="keyword">, </span><span class="string">'mysql'</span><span class="keyword">);
<br />
</span><span class="default">?&gt;
<br />
</span>
<br />
The '.' as hostname is absolutely necessary when using named pipes. 'localhost' won't work. 'mysql' is the standard name for the pipe/socket.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
</div>
</div>
</div></div></body></html>
