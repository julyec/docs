<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
 <head>
  <meta http-equiv="content-type" content="text/html; CHARSET=UTF-8">
  <title>Geo IP 定位</title>
<link media="all" rel="stylesheet" type="text/css" href="styles/03e73060321a0a848018724a6c83de7f-theme-base.css" />
<link media="all" rel="stylesheet" type="text/css" href="styles/03e73060321a0a848018724a6c83de7f-theme-medium.css" />

  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <link media="all" rel="stylesheet" type="text/css" href="style.css"/>
 </head>
 <body class="docs" class="docs"><div class="navbar navbar-fixed-top">
  <div class="navbar-inner clearfix">
    <ul class="nav" style="width: 100%">
      <li style="float: left;"><a href="refs.basic.other.html">? 其它基本扩展</a></li>
      <li style="float: right;"><a href="intro.geoip.html">简介 ?</a></li>
    </ul>
  </div>
</div>
<div id="breadcrumbs" class="clearfix">
  <ul class="breadcrumbs-container">
    <li><a href="index.html">PHP Manual</a></li>
    <li><a href="refs.basic.other.html">其它基本扩展</a></li>
    <li>Geo IP 定位</li>
  </ul>
</div>
<div id="layout">
  <div id="layout-content"><div id="book.geoip" class="book">
 
 <h1 class="title">Geo IP 定位</h1>
 

 

 








 

 








 








<ul class="chunklist chunklist_book"><li><a href="intro.geoip.html">简介</a></li><li><a href="geoip.setup.html">安装/配置</a><ul class="chunklist chunklist_book chunklist_children"><li><a href="geoip.requirements.html">需求</a></li><li><a href="geoip.installation.html">安装</a></li><li><a href="geoip.configuration.html">运行时配置</a></li><li><a href="geoip.resources.html">资源类型</a></li></ul></li><li><a href="geoip.constants.html">预定义常量</a></li><li><a href="ref.geoip.html">GeoIP 函数</a><ul class="chunklist chunklist_book chunklist_children"><li><a href="function.geoip-asnum-by-name.html">geoip_asnum_by_name</a> &mdash; 获取自治系统号(ASN)</li><li><a href="function.geoip-continent-code-by-name.html">geoip_continent_code_by_name</a> &mdash; 获取七大洲的大写字母简称</li><li><a href="function.geoip-country-code-by-name.html">geoip_country_code_by_name</a> &mdash; 获取国家代码</li><li><a href="function.geoip-country-code3-by-name.html">geoip_country_code3_by_name</a> &mdash; 获取三个字母组成的国家简称</li><li><a href="function.geoip-country-name-by-name.html">geoip_country_name_by_name</a> &mdash; 获取国家的全称</li><li><a href="function.geoip-database-info.html">geoip_database_info</a> &mdash; 获取 GeoIP 数据库的信息</li><li><a href="function.geoip-db-avail.html">geoip_db_avail</a> &mdash; GeoIP 数据库是否可用</li><li><a href="function.geoip-db-filename.html">geoip_db_filename</a> &mdash; 返回 GeoIP 数据库相对应的文件名</li><li><a href="function.geoip-db-get-all-info.html">geoip_db_get_all_info</a> &mdash; 返回所有 GeoIP 数据库类型的详细信息</li><li><a href="function.geoip-domain-by-name.html">geoip_domain_by_name</a> &mdash; 获取二级域名</li><li><a href="function.geoip-id-by-name.html">geoip_id_by_name</a> &mdash; 获取网络连接类型</li><li><a href="function.geoip-isp-by-name.html">geoip_isp_by_name</a> &mdash; 获取 ISP (网络服务提供商)的名称</li><li><a href="function.geoip-netspeedcell-by-name.html">geoip_netspeedcell_by_name</a> &mdash; 获取网络连接速度</li><li><a href="function.geoip-org-by-name.html">geoip_org_by_name</a> &mdash; 获取机构的名称</li><li><a href="function.geoip-record-by-name.html">geoip_record_by_name</a> &mdash; 返回 GeoIP 数据库中详细的城市信息</li><li><a href="function.geoip-region-by-name.html">geoip_region_by_name</a> &mdash; 获取国家和地区代码</li><li><a href="function.geoip-region-name-by-code.html">geoip_region_name_by_code</a> &mdash; 返回给定的国家和地区代码组合所对应的地区名称</li><li><a href="function.geoip-setup-custom-directory.html">geoip_setup_custom_directory</a> &mdash; 自定义 GeoIP 数据库的目录</li><li><a href="function.geoip-time-zone-by-country-and-region.html">geoip_time_zone_by_country_and_region</a> &mdash; 返回国家和地区的时区</li></ul></li></ul></div><div id="usernotes">
 <div class="head">
  <h3 class="title">User Contributed Notes</h3>
 </div>
<div id="allnotes">  <a name="126808""></a>
  <div class="note">
   <strong class="user">ruben dot benjamin at hidden-email dot com</strong>
   <a href="#126808" class="date">27-Jan-2022 06:51</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you want to use the C Library <br />
Example for Ubuntu and PHP 7.4<br />
<br />
sudo apt install libmaxminddb0 libmaxminddb-dev mmdb-bin<br />
pecl install maxminddb<br />
vi /etc/php/7.4/mods-available/maxmind.ini<br />
add<br />
extension=maxminddb.so<br />
phpenmod maxmind<br />
<br />
In code<br />
<span class="default">&lt;?php<br />
<br />
</span><span class="keyword">use </span><span class="default">MaxMind\Db\Reader</span><span class="keyword">;<br />
<br />
</span><span class="default">$ipAddress </span><span class="keyword">= </span><span class="string">'24.24.24.24'</span><span class="keyword">;<br />
</span><span class="default">$databaseFile </span><span class="keyword">= </span><span class="string">'/usr/share/GeoIP/GeoLite2-Country.mmdb'</span><span class="keyword">;<br />
<br />
</span><span class="default">$reader </span><span class="keyword">= new </span><span class="default">Reader</span><span class="keyword">(</span><span class="default">$databaseFile</span><span class="keyword">);<br />
<br />
</span><span class="comment">// get returns just the record for the IP address<br />
</span><span class="default">print_r</span><span class="keyword">(</span><span class="default">$reader</span><span class="keyword">-&gt;</span><span class="default">get</span><span class="keyword">(</span><span class="default">$ipAddress</span><span class="keyword">));<br />
<br />
</span><span class="comment">// getWithPrefixLen returns an array containing the record and the<br />
// associated prefix length for that record.<br />
</span><span class="default">print_r</span><span class="keyword">(</span><span class="default">$reader</span><span class="keyword">-&gt;</span><span class="default">getWithPrefixLen</span><span class="keyword">(</span><span class="default">$ipAddress</span><span class="keyword">));<br />
<br />
</span><span class="default">$reader</span><span class="keyword">-&gt;</span><span class="default">close</span><span class="keyword">();</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="124382""></a>
  <div class="note">
   <strong class="user">SG</strong>
   <a href="#124382" class="date">11-Nov-2019 02:23</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
The 3rd party geolite2legacy script can also used to convert the newer GeoLite2 format downloads into the legacy format which can be read by the PHP GeoIP extension.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="123492""></a>
  <div class="note">
   <strong class="user">webmaster at isag dot melbourne</strong>
   <a href="#123492" class="date">05-Jan-2019 09:51</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
With GeoIP2, the easiest way is to:<br />
<br />
* Grab the latest GeoIP2 Lite Database(s): https://dev.maxmind.com/geoip/geoip2/geolite2/<br />
* Grab the latest geoip2.phar: https://github.com/maxmind/GeoIP2-php/releases<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">require_once(</span><span class="string">"geoip2.phar"</span><span class="keyword">);<br />
use </span><span class="default">GeoIp2\Database\Reader</span><span class="keyword">;<br />
</span><span class="comment">// City DB<br />
</span><span class="default">$reader </span><span class="keyword">= new </span><span class="default">Reader</span><span class="keyword">(</span><span class="string">'/path/to/GeoLite2-City.mmdb'</span><span class="keyword">);<br />
</span><span class="default">$record </span><span class="keyword">= </span><span class="default">$reader</span><span class="keyword">-&gt;</span><span class="default">city</span><span class="keyword">(</span><span class="default">$_SERVER</span><span class="keyword">[</span><span class="string">'REMOTE_ADDR'</span><span class="keyword">]);<br />
</span><span class="comment">// or for Country DB<br />
// $reader = new Reader('/path/to/GeoLite2-Country.mmdb');<br />
// $record = $reader-&gt;country($_SERVER['REMOTE_ADDR']);<br />
</span><span class="keyword">print(</span><span class="default">$record</span><span class="keyword">-&gt;</span><span class="default">country</span><span class="keyword">-&gt;</span><span class="default">isoCode </span><span class="keyword">. </span><span class="string">"\n"</span><span class="keyword">);<br />
print(</span><span class="default">$record</span><span class="keyword">-&gt;</span><span class="default">country</span><span class="keyword">-&gt;</span><span class="default">name </span><span class="keyword">. </span><span class="string">"\n"</span><span class="keyword">);<br />
print(</span><span class="default">$record</span><span class="keyword">-&gt;</span><span class="default">country</span><span class="keyword">-&gt;</span><span class="default">names</span><span class="keyword">[</span><span class="string">'zh-CN'</span><span class="keyword">] . </span><span class="string">"\n"</span><span class="keyword">);<br />
print(</span><span class="default">$record</span><span class="keyword">-&gt;</span><span class="default">mostSpecificSubdivision</span><span class="keyword">-&gt;</span><span class="default">name </span><span class="keyword">. </span><span class="string">"\n"</span><span class="keyword">);<br />
print(</span><span class="default">$record</span><span class="keyword">-&gt;</span><span class="default">mostSpecificSubdivision</span><span class="keyword">-&gt;</span><span class="default">isoCode </span><span class="keyword">. </span><span class="string">"\n"</span><span class="keyword">);<br />
print(</span><span class="default">$record</span><span class="keyword">-&gt;</span><span class="default">city</span><span class="keyword">-&gt;</span><span class="default">name </span><span class="keyword">. </span><span class="string">"\n"</span><span class="keyword">);<br />
print(</span><span class="default">$record</span><span class="keyword">-&gt;</span><span class="default">postal</span><span class="keyword">-&gt;</span><span class="default">code </span><span class="keyword">. </span><span class="string">"\n"</span><span class="keyword">);<br />
print(</span><span class="default">$record</span><span class="keyword">-&gt;</span><span class="default">location</span><span class="keyword">-&gt;</span><span class="default">latitude </span><span class="keyword">. </span><span class="string">"\n"</span><span class="keyword">);<br />
print(</span><span class="default">$record</span><span class="keyword">-&gt;</span><span class="default">location</span><span class="keyword">-&gt;</span><span class="default">longitude </span><span class="keyword">. </span><span class="string">"\n"</span><span class="keyword">);<br />
$&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="113992""></a>
  <div class="note">
   <strong class="user">mark at moderndeveloperllc dot com</strong>
   <a href="#113992" class="date">26-Dec-2013 05:43</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
It should be noted that this extension has now been superseded by the GeoIP2 API that MaxMind now produces. There is a pure-PHP set of classes and a C library and extension you can optionally install. The code can be found in various projects on MaxMind's GitHub page: https://github.com/maxmind/</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
</div>
</div>
</div></div></body></html>
