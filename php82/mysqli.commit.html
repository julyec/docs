<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
 <head>
  <meta http-equiv="content-type" content="text/html; CHARSET=UTF-8">
  <title>提交当前事务</title>
<link media="all" rel="stylesheet" type="text/css" href="styles/03e73060321a0a848018724a6c83de7f-theme-base.css" />
<link media="all" rel="stylesheet" type="text/css" href="styles/03e73060321a0a848018724a6c83de7f-theme-medium.css" />

  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <link media="all" rel="stylesheet" type="text/css" href="style.css"/>
 </head>
 <body class="docs" class="docs"><div class="navbar navbar-fixed-top">
  <div class="navbar-inner clearfix">
    <ul class="nav" style="width: 100%">
      <li style="float: left;"><a href="mysqli.close.html">? mysqli::close</a></li>
      <li style="float: right;"><a href="mysqli.connect-errno.html">mysqli::$connect_errno ?</a></li>
    </ul>
  </div>
</div>
<div id="breadcrumbs" class="clearfix">
  <ul class="breadcrumbs-container">
    <li><a href="index.html">PHP Manual</a></li>
    <li><a href="class.mysqli.html">mysqli</a></li>
    <li>提交当前事务</li>
  </ul>
</div>
<div id="layout">
  <div id="layout-content"><div id="mysqli.commit" class="refentry">
 <div class="refnamediv">
  <h1 class="refname">mysqli::commit</h1>
  <h1 class="refname">mysqli_commit</h1>
  <p class="verinfo">(PHP 5, PHP 7, PHP 8)</p><p class="refpurpose"><span class="refname">mysqli::commit</span> -- <span class="refname">mysqli_commit</span> &mdash; <span class="dc-title">提交当前事务</span></p>

 </div>

 <div class="refsect1 description" id="refsect1-mysqli.commit-description">
  <h3 class="title">说明</h3>
  <p class="para">面向对象风格</p>
  <div class="methodsynopsis dc-description">
   <span class="modifier">public</span> <span class="methodname"><strong>mysqli::commit</strong></span>(<span class="methodparam"><span class="type">int</span> <code class="parameter">$flags</code><span class="initializer"> = 0</span></span>, <span class="methodparam"><span class="type">?</span><span class="type"><span class="type">string</span><span class="type"></span></span> <code class="parameter">$name</code><span class="initializer"> = <strong><code>null</code></strong></span></span>): <span class="type">bool</span></div>

  <p class="para rdfs-comment">过程化风格</p>
  <div class="methodsynopsis dc-description"><span class="methodname"><strong>mysqli_commit</strong></span>(<span class="methodparam"><span class="type"><a href="class.mysqli.html" class="type mysqli">mysqli</a></span> <code class="parameter">$mysql</code></span>, <span class="methodparam"><span class="type">int</span> <code class="parameter">$flags</code><span class="initializer"> = 0</span></span>, <span class="methodparam"><span class="type">?</span><span class="type"><span class="type">string</span><span class="type"></span></span> <code class="parameter">$name</code><span class="initializer"> = <strong><code>null</code></strong></span></span>): <span class="type">bool</span></div>

  <p class="para rdfs-comment">
   提交当前数据库连接的事务。
  </p>
 </div>


 <div class="refsect1 parameters" id="refsect1-mysqli.commit-parameters">
  <h3 class="title">参数</h3>
  <p class="para">
   <dl>
    <dt>

<code class="parameter">mysql</code></dt>
<dd>
<p class="para">仅以过程化样式：由<span class="function"><a href="function.mysqli-connect.html" class="function">mysqli_connect()</a></span> 或 <span class="function"><a href="mysqli.init.html" class="function">mysqli_init()</a></span>
返回的 <span class="classname"><a href="class.mysqli.html" class="classname">mysqli</a></span> 对象。</p></dd>

    
     <dt>
<code class="parameter">flags</code></dt>

     <dd>

      <p class="para">
       <strong><code>MYSQLI_TRANS_COR_*</code></strong> 常量的位掩码。
      </p>
     </dd>

    
    
     <dt>
<code class="parameter">name</code></dt>

     <dd>

      <p class="para">
       如果提供，则执行 <code class="literal">COMMIT/*name*/</code>。
      </p>
     </dd>

    
   </dl>

  </p>
 </div>


 <div class="refsect1 returnvalues" id="refsect1-mysqli.commit-returnvalues">
  <h3 class="title">返回值</h3>
  <p class="para">
   成功时返回 <strong><code>true</code></strong>， 或者在失败时返回 <strong><code>false</code></strong>。
  </p>
 </div>


 <div class="refsect1 errors" id="refsect1-mysqli.commit-errors">
  <h3 class="title">错误／异常</h3>
  <p class="para">
If mysqli error reporting is enabled (<strong><code>MYSQLI_REPORT_ERROR</code></strong>) and the requested operation fails,
a warning is generated. If, in addition, the mode is set to <strong><code>MYSQLI_REPORT_STRICT</code></strong>,
a <span class="classname"><a href="class.mysqli-sql-exception.html" class="classname">mysqli_sql_exception</a></span> is thrown instead.</p>
 </div>


 <div class="refsect1 changelog" id="refsect1-mysqli.commit-changelog">
  <h3 class="title">更新日志</h3>
  <p class="para">
   <table class="doctable informaltable">
    
     <thead>
      <tr>
       <th>版本</th>
       <th>说明</th>
      </tr>

     </thead>

     <tbody class="tbody">
      <tr>
       <td>8.0.0</td>
       <td>
        <code class="parameter">name</code> 现在允许为 null。
       </td>
      </tr>

     </tbody>
    
   </table>

  </p>
 </div>


 <div class="refsect1 examples" id="refsect1-mysqli.commit-examples">
  <h3 class="title">示例</h3>
  <p class="para">
   参阅 <a href="mysqli.begin-transaction.html#mysqli.begin-transaction.example.basic" class="link"><span class="methodname"><a href="mysqli.begin-transaction.html" class="methodname">mysqli::begin_transaction()</a></span> 示例</a>。
  </p>
 </div>


 <div class="refsect1 notes" id="refsect1-mysqli.commit-notes">
  <h3 class="title">注释</h3>
  <blockquote class="note"><p><strong class="note">Note</strong>: 
   <p class="para">
    此方法在不支持事务的表类型中不生效，如 MyISAM 或 ISAM。
   </p>
  </p></blockquote>
 </div>


 <div class="refsect1 seealso" id="refsect1-mysqli.commit-seealso">
  <h3 class="title">参见</h3>
  <p class="para">
   <ul class="simplelist">
    <li class="member"><span class="function"><a href="mysqli.autocommit.html" class="function" rel="rdfs-seeAlso">mysqli_autocommit()</a> - 打开或关闭本次数据库连接的自动命令提交事务模式</span></li>
    <li class="member"><span class="function"><a href="mysqli.begin-transaction.html" class="function" rel="rdfs-seeAlso">mysqli_begin_transaction()</a> - Starts a transaction</span></li>
    <li class="member"><span class="function"><a href="mysqli.rollback.html" class="function" rel="rdfs-seeAlso">mysqli_rollback()</a> - 回滚当前事务</span></li>
    <li class="member"><span class="function"><a href="mysqli.savepoint.html" class="function" rel="rdfs-seeAlso">mysqli_savepoint()</a> - 在当前事务中设置命名保存点</span></li>
   </ul>
  </p>
 </div>


</div><div id="usernotes">
 <div class="head">
  <h3 class="title">User Contributed Notes</h3>
 </div>
<div id="allnotes">  <a name="123851""></a>
  <div class="note">
   <strong class="user">zattechnology at gmail dot com</strong>
   <a href="#123851" class="date">15-May-2019 02:23</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
When you have alot of transactions to make, say you are applying inserting items to the database from a loop, it will be better to use the mysqli_commit for this kind of process as it will only hit the database once.<br />
<br />
//Wrong way<br />
Example 1:<br />
<br />
$con = mysqli_connect("host", "username", "password", "database") or die("Could not establish connection to database");<br />
<br />
$users = ["chris", "james", "peter", "mark", "joe", "alice", "bob"]<br />
<br />
for($i=0; $i&lt;count($users); $i++){<br />
&nbsp;&nbsp; &nbsp; &nbsp; $user= $users[$i];<br />
&nbsp;&nbsp; &nbsp; &nbsp; $query = mysqli_query($con, "INSERT INTO users (username) VALUES ('$user') ");<br />
} <br />
<br />
//Correct Way<br />
Example 2<br />
<br />
$con = mysqli_connect("host", "username", "password", "database") or die("Could not establish connection to database");<br />
<br />
$users = ["chris", "james", "peter", "mark", "joe", "alice", "bob"]<br />
<br />
//Turn off autocommit <br />
mysqli_autocommit($con, FALSE)<br />
<br />
//Make some transactions<br />
for($i=0; $i&lt;count($users); $i++){<br />
&nbsp;&nbsp; &nbsp; $user= $users[$i];<br />
&nbsp;&nbsp; &nbsp; $query = mysqli_query($con, "INSERT INTO users (username) VALUES ('$user') ");<br />
} <br />
<br />
//Make a one-time hit to the database <br />
mysqli_commit($con)<br />
<br />
As with the Example 1, since we had 7 items in the list, this means that their will be a 7 times hit to our database which can really affect performance. But with the Example 2, since we already turned off autocommit this means that the transactions will be queued ontill will explicitly call mysqli_commit($con)</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="117362""></a>
  <div class="note">
   <strong class="user">NoMan2000</strong>
   <a href="#117362" class="date">27-May-2015 02:51</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
This is to clarify the Flags parameters and what they mean:<br />
<br />
MYSQLI_TRANS_COR_AND_CHAIN: <br />
<br />
Appends "AND CHAIN" to mysqli_commit or mysqli_rollback.<br />
<br />
MYSQLI_TRANS_COR_AND_NO_CHAIN: <br />
<br />
Appends "AND NO CHAIN" to mysqli_commit or mysqli_rollback.<br />
<br />
MYSQLI_TRANS_COR_RELEASE: <br />
<br />
Appends "RELEASE" to mysqli_commit or mysqli_rollback.<br />
<br />
MYSQLI_TRANS_COR_NO_RELEASE:<br />
<br />
Appends "NO RELEASE" to mysqli_commit or mysqli_rollback.<br />
<br />
To clarify those options:<br />
<br />
The AND CHAIN clause causes a new transaction to begin as soon as the current one ends, and the new transaction has the same isolation level as the just-terminated transaction. <br />
<br />
The RELEASE clause causes the server to disconnect the current client session after terminating the current transaction.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="113000""></a>
  <div class="note">
   <strong class="user">snchzantonio at gmail dot com</strong>
   <a href="#113000" class="date">16-Aug-2013 05:38</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I never recomend to use the ? with only one value variant like: $var = expression ? $var&nbsp; : other_value or $var = expression ? null&nbsp; : other_value ,and php suport Exception catchin so,use it :)<br />
<br />
here my opinion abut lorenzo's post:<br />
<br />
&nbsp; <span class="default">&lt;?php<br />
&nbsp;<br />
</span><span class="comment">//variants combined<br />
<br />
</span><span class="default">$mysqli</span><span class="keyword">-&gt;</span><span class="default">autocommit</span><span class="keyword">(</span><span class="default">FALSE</span><span class="keyword">);<br />
<br />
try{<br />
<br />
&nbsp; </span><span class="default">$mysqli</span><span class="keyword">-&gt;</span><span class="default">query</span><span class="keyword">(</span><span class="string">"INSERT INTO myCity (id) VALUES (100)"</span><span class="keyword">) or throw new </span><span class="default">Exception</span><span class="keyword">(</span><span class="string">'error!'</span><span class="keyword">);<br />
<br />
</span><span class="comment">// or we can use<br />
<br />
&nbsp; </span><span class="keyword">if( !</span><span class="default">$mysqli</span><span class="keyword">-&gt;</span><span class="default">query</span><span class="keyword">(</span><span class="string">"INSERT INTO myCity (id) VALUES (200)"</span><span class="keyword">){ <br />
&nbsp;&nbsp;&nbsp; throw new </span><span class="default">Exception</span><span class="keyword">(</span><span class="string">'error!'</span><span class="keyword">); <br />
&nbsp; }<br />
<br />
}catch( </span><span class="default">Exception $e </span><span class="keyword">){<br />
&nbsp; </span><span class="default">$mysqli</span><span class="keyword">-&gt;</span><span class="default">rollback</span><span class="keyword">();<br />
}<br />
</span><span class="default">$mysqli</span><span class="keyword">-&gt;</span><span class="default">commit</span><span class="keyword">();<br />
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="93457""></a>
  <div class="note">
   <strong class="user">Bob Johnson</strong>
   <a href="#93457" class="date">10-Sep-2009 10:42</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
The compactness of Lorenzo's code is admirable.
<br />
However, it is a good idea to also check&nbsp; $mysqli-&gt;affected_rows to make sure that the INSERT statement did not fail. 
<br />

<br />
<span class="default">&lt;?php
<br />
$result_query </span><span class="keyword">= @</span><span class="default">mysqli_query</span><span class="keyword">(</span><span class="default">$query</span><span class="keyword">, </span><span class="default">$connect</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if ((</span><span class="default">$result_query </span><span class="keyword">== </span><span class="default">false</span><span class="keyword">) &amp;&amp;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (</span><span class="default">mysqli_affected_rows</span><span class="keyword">(</span><span class="default">$connect</span><span class="keyword">) == </span><span class="default">0</span><span class="keyword">))
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// verify the query executed completely and verify that it
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; // had impact on the table
<br />

<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$success </span><span class="keyword">= </span><span class="default">false</span><span class="keyword">;
<br />

<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// here also, the developer could choose to add a ROLLBACK
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; // statement
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">}
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="89976""></a>
  <div class="note">
   <strong class="user">mvanlamz</strong>
   <a href="#89976" class="date">31-Mar-2009 11:36</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Please note that calling mysqli::commit() will NOT automatically set mysqli::autocommit() back to 'true'.<br />
<br />
This means that any queries following mysqli::commit() will be rolled back when your script exits.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="88857""></a>
  <div class="note">
   <strong class="user">Lorenzo - webmaster AT 4tour DOT it</strong>
   <a href="#88857" class="date">11-Feb-2009 03:12</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
This is an example to explain the powerful of the rollback and commit functions.<br />
Let's suppose you want to be sure that all queries have to be executed without errors before writing data on the database.<br />
Here's the code:<br />
<br />
<span class="default">&lt;?php<br />
$all_query_ok</span><span class="keyword">=</span><span class="default">true</span><span class="keyword">; </span><span class="comment">// our control variable<br />
<br />
//we make 4 inserts, the last one generates an error<br />
//if at least one query returns an error we change our control variable<br />
</span><span class="default">$mysqli</span><span class="keyword">-&gt;</span><span class="default">query</span><span class="keyword">(</span><span class="string">"INSERT INTO myCity (id) VALUES (100)"</span><span class="keyword">) ? </span><span class="default">null </span><span class="keyword">: </span><span class="default">$all_query_ok</span><span class="keyword">=</span><span class="default">false</span><span class="keyword">;<br />
</span><span class="default">$mysqli</span><span class="keyword">-&gt;</span><span class="default">query</span><span class="keyword">(</span><span class="string">"INSERT INTO myCity (id) VALUES (200)"</span><span class="keyword">) ? </span><span class="default">null </span><span class="keyword">: </span><span class="default">$all_query_ok</span><span class="keyword">=</span><span class="default">false</span><span class="keyword">;<br />
</span><span class="default">$mysqli</span><span class="keyword">-&gt;</span><span class="default">query</span><span class="keyword">(</span><span class="string">"INSERT INTO myCity (id) VALUES (300)"</span><span class="keyword">) ? </span><span class="default">null </span><span class="keyword">: </span><span class="default">$all_query_ok</span><span class="keyword">=</span><span class="default">false</span><span class="keyword">;<br />
</span><span class="default">$mysqli</span><span class="keyword">-&gt;</span><span class="default">query</span><span class="keyword">(</span><span class="string">"INSERT INTO myCity (id) VALUES (100)"</span><span class="keyword">) ? </span><span class="default">null </span><span class="keyword">: </span><span class="default">$all_query_ok</span><span class="keyword">=</span><span class="default">false</span><span class="keyword">; </span><span class="comment">//duplicated PRIMARY KEY VALUE<br />
<br />
//now let's test our control variable<br />
</span><span class="default">$all_query_ok </span><span class="keyword">? </span><span class="default">$mysqli</span><span class="keyword">-&gt;</span><span class="default">commit</span><span class="keyword">() : </span><span class="default">$mysqli</span><span class="keyword">-&gt;</span><span class="default">rollback</span><span class="keyword">();<br />
<br />
</span><span class="default">$mysqli</span><span class="keyword">-&gt;</span><span class="default">close</span><span class="keyword">();<br />
</span><span class="default">?&gt;<br />
</span><br />
hope to be helpful!</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
</div>
</div>
</div></div></body></html>
