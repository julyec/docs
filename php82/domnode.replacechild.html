<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
 <head>
  <meta http-equiv="content-type" content="text/html; CHARSET=UTF-8">
  <title>Replaces a child</title>
<link media="all" rel="stylesheet" type="text/css" href="styles/03e73060321a0a848018724a6c83de7f-theme-base.css" />
<link media="all" rel="stylesheet" type="text/css" href="styles/03e73060321a0a848018724a6c83de7f-theme-medium.css" />

  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <link media="all" rel="stylesheet" type="text/css" href="style.css"/>
 </head>
 <body class="docs" class="docs"><div class="navbar navbar-fixed-top">
  <div class="navbar-inner clearfix">
    <ul class="nav" style="width: 100%">
      <li style="float: left;"><a href="domnode.removechild.html">? DOMNode::removeChild</a></li>
      <li style="float: right;"><a href="class.domnodelist.html">DOMNodeList ?</a></li>
    </ul>
  </div>
</div>
<div id="breadcrumbs" class="clearfix">
  <ul class="breadcrumbs-container">
    <li><a href="index.html">PHP Manual</a></li>
    <li><a href="class.domnode.html">DOMNode</a></li>
    <li>Replaces a child</li>
  </ul>
</div>
<div id="layout">
  <div id="layout-content"><div id="domnode.replacechild" class="refentry">
 <div class="refnamediv">
  <h1 class="refname">DOMNode::replaceChild</h1>
  <p class="verinfo">(PHP 5, PHP 7, PHP 8)</p><p class="refpurpose"><span class="refname">DOMNode::replaceChild</span> &mdash; <span class="dc-title">
   Replaces a child
  </span></p>

 </div>
 <div class="refsect1 description" id="refsect1-domnode.replacechild-description">
  <h3 class="title">说明</h3>
  <div class="methodsynopsis dc-description">
   <span class="modifier">public</span> <span class="methodname"><strong>DOMNode::replaceChild</strong></span>(<span class="methodparam"><span class="type"><a href="class.domnode.html" class="type DOMNode">DOMNode</a></span> <code class="parameter">$node</code></span>, <span class="methodparam"><span class="type"><a href="class.domnode.html" class="type DOMNode">DOMNode</a></span> <code class="parameter">$child</code></span>): <span class="type"><span class="type"><a href="class.domnode.html" class="type DOMNode">DOMNode</a></span>|<span class="type"><span class="type false">false</span></span></span></div>

  <p class="para rdfs-comment">
   This function replaces the child <code class="parameter">child</code> 
   with the passed new node. If the <code class="parameter">node</code> is already a child it 
   will not be added a second time. If the replacement succeeds the 
   old node is returned.
  </p>
 </div>

 <div class="refsect1 parameters" id="refsect1-domnode.replacechild-parameters">
  <h3 class="title">参数</h3>
  <p class="para">
   <dl>
    
     <dt>
<code class="parameter">node</code></dt>

     <dd>

      <p class="para">
       The new node. It must be a member of the target document, i.e.
       created by one of the DOMDocument-&gt;createXXX() methods or imported in
       the document by <a href="domdocument.importnode.html" class="xref">DOMDocument::importNode</a>.
      </p>
     </dd>

    
    
     <dt>
<code class="parameter">child</code></dt>

     <dd>

      <p class="para">
       The old node.
      </p>
     </dd>

    
   </dl>

  </p>
 </div>

 <div class="refsect1 returnvalues" id="refsect1-domnode.replacechild-returnvalues">
  <h3 class="title">返回值</h3>
  <p class="para">
   The old node or <strong><code>false</code></strong> if an error occur.
  </p>
 </div>

 <div class="refsect1 errors" id="refsect1-domnode.replacechild-errors">
  <h3 class="title">错误／异常</h3>
  <p class="para">
   <dl>
    
     <dt>
<strong><code>DOM_NO_MODIFICATION_ALLOWED_ERR</code></strong></dt>

     <dd>

      <p class="para">
       Raised if this node is readonly or if the previous parent of the node
       being inserted is readonly.
      </p>
     </dd>

    
    
     <dt>
<strong><code>DOM_HIERARCHY_REQUEST_ERR</code></strong></dt>

     <dd>

      <p class="para">
       Raised if this node is of a type that does not allow children of the 
       type of the <code class="parameter">node</code> node, or if the node to 
       put in is one of this node&#039;s ancestors or this node itself.
      </p>
     </dd>

    
    
     <dt>
<strong><code>DOM_WRONG_DOCUMENT_ERR</code></strong></dt>

     <dd>

      <p class="para">
       Raised if <code class="parameter">node</code> was created from a different 
       document than the one that created this node.
      </p>
     </dd>

    
    
     <dt>
<strong><code>DOM_NOT_FOUND</code></strong></dt>

     <dd>

      <p class="para">
       Raised if <code class="parameter">child</code> is not a child of this node.
      </p>
     </dd>

    
   </dl>

  </p>
 </div>

 <div class="refsect1 seealso" id="refsect1-domnode.replacechild-seealso">
  <h3 class="title">参见</h3>
  <p class="para">
   <ul class="simplelist">
    <li class="member"><span class="methodname"><a href="domchildnode.replacewith.html" class="methodname" rel="rdfs-seeAlso">DOMChildNode::replaceWith()</a> - Replaces the node with new nodes</span></li>
    <li class="member"><span class="methodname"><a href="domnode.appendchild.html" class="methodname" rel="rdfs-seeAlso">DOMNode::appendChild()</a> - Adds new child at the end of the children</span></li>
    <li class="member"><span class="methodname"><a href="domnode.removechild.html" class="methodname" rel="rdfs-seeAlso">DOMNode::removeChild()</a> - Removes child from list of children</span></li>
   </ul>
  </p>
 </div>

</div><div id="usernotes">
 <div class="head">
  <h3 class="title">User Contributed Notes</h3>
 </div>
<div id="allnotes">  <a name="123037""></a>
  <div class="note">
   <strong class="user">chealer at gmail dot com</strong>
   <a href="#123037" class="date">15-Aug-2018 03:07</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
As of version 5.6, PHP still behaves as reported by jb at jbpros dot com. To use replaceChild() in a loop, the more standard pattern used in the following example can be used:<br />
<br />
for ($currentNode = 0; $currentNode &lt; $link-&gt;childNodes-&gt;length; $currentNode++) {<br />
&nbsp;&nbsp;&nbsp; $child = $link-&gt;childNodes[$currentNode];<br />
<br />
&nbsp;&nbsp;&nbsp; // "Remove" links, since links can't contain links<br />
&nbsp;&nbsp;&nbsp; if ($child instanceof DOMElement &amp;&amp; $child-&gt;tagName == 'a') {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $replacement = $dom-&gt;createTextNode($child-&gt;textContent);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $link-&gt;replaceChild($replacement, $child);<br />
&nbsp;&nbsp;&nbsp; }<br />
}</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="50500""></a>
  <div class="note">
   <strong class="user">jb at jbpros dot com</strong>
   <a href="#50500" class="date">01-Mar-2005 08:08</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you are trying to replace more than one node at once, you have to be careful about iterating over the DOMNodeList.&nbsp; If the old node has a different name from the new node, it will be removed from the list once it has been replaced.&nbsp; Use a regressive loop:
<br />

<br />
<span class="default">&lt;?php
<br />

<br />
$xml </span><span class="keyword">= new </span><span class="default">DOMDocument</span><span class="keyword">;
<br />
</span><span class="default">$xml</span><span class="keyword">-&gt;</span><span class="default">load</span><span class="keyword">(</span><span class="string">'docfile.xml'</span><span class="keyword">);
<br />

<br />
</span><span class="default">$elements </span><span class="keyword">= </span><span class="default">$xml</span><span class="keyword">-&gt;</span><span class="default">getElementsByTagNameNS</span><span class="keyword">(</span><span class="string">'<a href="http://www.example.com/NS/" rel="nofollow" target="_blank">http://www.example.com/NS/</a>'</span><span class="keyword">, </span><span class="string">'*'</span><span class="keyword">);
<br />
</span><span class="default">$i </span><span class="keyword">= </span><span class="default">$elements</span><span class="keyword">-&gt;</span><span class="default">length </span><span class="keyword">- </span><span class="default">1</span><span class="keyword">;
<br />
while (</span><span class="default">$i </span><span class="keyword">&gt; -</span><span class="default">1</span><span class="keyword">) {
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$element </span><span class="keyword">= </span><span class="default">$elements</span><span class="keyword">-&gt;</span><span class="default">item</span><span class="keyword">(</span><span class="default">$i</span><span class="keyword">);
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$ignore </span><span class="keyword">= </span><span class="default">false</span><span class="keyword">;
<br />

<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$newelement </span><span class="keyword">= </span><span class="default">$xml</span><span class="keyword">&gt;</span><span class="default">createTextNode</span><span class="keyword">(</span><span class="string">'Some new node!'</span><span class="keyword">);
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$element</span><span class="keyword">-&gt;</span><span class="default">parentNode</span><span class="keyword">-&gt;</span><span class="default">replaceChild</span><span class="keyword">(</span><span class="default">$newelement</span><span class="keyword">, </span><span class="default">$element</span><span class="keyword">);
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$i</span><span class="keyword">--;
<br />
}
<br />

<br />
</span><span class="default">?&gt;
<br />
</span>
<br />
The loop counter ($i) will always be in the list's interval as removed elements indexes are above the counter.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="48485""></a>
  <div class="note">
   <strong class="user">aidan at php dot net</strong>
   <a href="#48485" class="date">26-Dec-2004 02:17</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Here is a simple example for replacing a node:<br />
<br />
Let's define our XML like so:<br />
<br />
<span class="default">&lt;?php<br />
$xml </span><span class="keyword">= &lt;&lt;&lt;XML<br />
</span><span class="string">&lt;?xml version="1.0"?&gt;<br />
&lt;root&gt;<br />
&nbsp; &lt;parent&gt;<br />
&nbsp;&nbsp; &nbsp; &lt;child&gt;bar&lt;/child&gt;<br />
&nbsp;&nbsp; &nbsp; &lt;child&gt;foo&lt;/child&gt;<br />
&nbsp; &lt;/parent&gt;<br />
&lt;/root&gt;<br />
</span><span class="keyword">XML;<br />
</span><span class="default">?&gt;<br />
</span><br />
If we wanted to replace the entire &lt;parent&gt; node, we could do something like this:<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="comment">// Create a new document fragment to hold the new &lt;parent&gt; node<br />
</span><span class="default">$parent </span><span class="keyword">= new </span><span class="default">DomDocument</span><span class="keyword">;<br />
</span><span class="default">$parent_node </span><span class="keyword">= </span><span class="default">$parent </span><span class="keyword">-&gt;</span><span class="default">createElement</span><span class="keyword">(</span><span class="string">'parent'</span><span class="keyword">);<br />
<br />
</span><span class="comment">// Add some children<br />
</span><span class="default">$parent_node</span><span class="keyword">-&gt;</span><span class="default">appendChild</span><span class="keyword">(</span><span class="default">$parent</span><span class="keyword">-&gt;</span><span class="default">createElement</span><span class="keyword">(</span><span class="string">'child'</span><span class="keyword">, </span><span class="string">'somevalue'</span><span class="keyword">));<br />
</span><span class="default">$parent_node</span><span class="keyword">-&gt;</span><span class="default">appendChild</span><span class="keyword">(</span><span class="default">$parent</span><span class="keyword">-&gt;</span><span class="default">createElement</span><span class="keyword">(</span><span class="string">'child'</span><span class="keyword">, </span><span class="string">'anothervalue'</span><span class="keyword">));<br />
<br />
</span><span class="comment">// Add the keywordset into the new document<br />
// The $parent variable now holds the new node as a document fragment<br />
</span><span class="default">$parent</span><span class="keyword">-&gt;</span><span class="default">appendChild</span><span class="keyword">(</span><span class="default">$parent_node</span><span class="keyword">);<br />
</span><span class="default">?&gt;<br />
</span><br />
Next, we need to locate the old node:<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="comment">// Load the XML<br />
</span><span class="default">$dom </span><span class="keyword">= new </span><span class="default">DomDocument</span><span class="keyword">;<br />
</span><span class="default">$dom</span><span class="keyword">-&gt;</span><span class="default">loadXML</span><span class="keyword">(</span><span class="default">$xml</span><span class="keyword">);<br />
<br />
</span><span class="comment">// Locate the old parent node<br />
</span><span class="default">$xpath </span><span class="keyword">= new </span><span class="default">DOMXpath</span><span class="keyword">(</span><span class="default">$dom</span><span class="keyword">);<br />
</span><span class="default">$nodelist </span><span class="keyword">= </span><span class="default">$xpath</span><span class="keyword">-&gt;</span><span class="default">query</span><span class="keyword">(</span><span class="string">'/root/parent'</span><span class="keyword">);<br />
</span><span class="default">$oldnode </span><span class="keyword">= </span><span class="default">$nodelist</span><span class="keyword">-&gt;</span><span class="default">item</span><span class="keyword">(</span><span class="default">0</span><span class="keyword">);<br />
</span><span class="default">?&gt;<br />
</span><br />
We then import and replace the new node:<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="comment">// Load the $parent document fragment into the current document<br />
</span><span class="default">$newnode </span><span class="keyword">= </span><span class="default">$dom</span><span class="keyword">-&gt;</span><span class="default">importNode</span><span class="keyword">(</span><span class="default">$parent</span><span class="keyword">-&gt;</span><span class="default">documentElement</span><span class="keyword">, </span><span class="default">true</span><span class="keyword">);<br />
<br />
</span><span class="comment">// Replace<br />
</span><span class="default">$oldnode</span><span class="keyword">-&gt;</span><span class="default">parentNode</span><span class="keyword">-&gt;</span><span class="default">replaceChild</span><span class="keyword">(</span><span class="default">$newnode</span><span class="keyword">, </span><span class="default">$oldnode</span><span class="keyword">);<br />
<br />
</span><span class="comment">// Display<br />
</span><span class="keyword">echo </span><span class="default">$dom</span><span class="keyword">-&gt;</span><span class="default">saveXML</span><span class="keyword">();<br />
</span><span class="default">?&gt;<br />
</span><br />
Our new node is successfully imported:<br />
<br />
&lt;?xml version="1.0"?&gt;<br />
&lt;root&gt;<br />
&lt;parent&gt;&lt;child&gt;somevalue&lt;/child&gt;&lt;child&gt;anothervalue&lt;/child&gt;&lt;/parent&gt;<br />
&lt;/root&gt;</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="45921""></a>
  <div class="note">
   <strong class="user">franp at free dot fr</strong>
   <a href="#45921" class="date">23-Sep-2004 08:39</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
1) If your XPath query returns a NodeList including a unique item, or if you know for sure the order of the items returned, you can use the "item(n)" syntax instead of the "foreach" syntax.
<br />
This can greatly improve you code lisibility.
<br />
s the method name implies, replaceChild cannot replace a node itself but a child of a node.
<br />
The trick is to use replaceChild on the parent node of your Xpath query result.
<br />

<br />
&lt;?xml version="1.0" ?&gt;
<br />
&lt;action&gt;
<br />
&nbsp;&lt;actionGlobal&gt;
<br />
&nbsp; &lt;actionGlobalFR&gt;sometext&lt;/actionGlobalFR&gt;
<br />
&nbsp;&lt;actionGlobal&gt;
<br />
&lt;/action&gt;
<br />

<br />
$frag = $doc-&gt;createElement("actionGlobalFR");&nbsp;&nbsp; 
<br />
$fragA = $doc-&gt;createTextNode("anothertext");
<br />
$frag-&gt;appendChild($fragA);
<br />
&nbsp;&nbsp; &nbsp;&nbsp; 
<br />
$xpResult = $xp-&gt;query("/action/actionGlobal/actionGlobalFR");&nbsp;&nbsp; 
<br />
$blipblip = $xpResult-&gt;item(0)-&gt;parentNode-&gt;replaceChild($ajout, $xpResult-&gt;item(0));
<br />

<br />
2) Also, as the method name implies, replaceChild cannot replace a node itself but a child of a node.
<br />
Still it is possible to replace a node pointed by XPath istead of its child. 
<br />
The trick is to use replaceChild on the parent node of your Xpath query result.
<br />

<br />
&lt;?xml version="1.0" ?&gt;
<br />
&lt;action&gt;
<br />
&nbsp; &lt;FR&gt;French Text&lt;/FR&gt;
<br />
&lt;/action&gt;
<br />

<br />
<span class="default">&lt;?php
<br />
$frag </span><span class="keyword">= </span><span class="default">$doc</span><span class="keyword">-&gt;</span><span class="default">createElement</span><span class="keyword">(</span><span class="string">"EN"</span><span class="keyword">);&nbsp;&nbsp; 
<br />
</span><span class="default">$fragA </span><span class="keyword">= </span><span class="default">$doc</span><span class="keyword">-&gt;</span><span class="default">createTextNode</span><span class="keyword">(</span><span class="string">"English Text"</span><span class="keyword">);
<br />
</span><span class="default">$frag</span><span class="keyword">-&gt;</span><span class="default">appendChild</span><span class="keyword">(</span><span class="default">$fragA</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp;&nbsp; 
<br />
</span><span class="default">$xpResult </span><span class="keyword">= </span><span class="default">$xp</span><span class="keyword">-&gt;</span><span class="default">query</span><span class="keyword">(</span><span class="string">"/action/FR"</span><span class="keyword">);&nbsp;&nbsp; 
<br />
</span><span class="default">$blipblip </span><span class="keyword">= </span><span class="default">$xpResult</span><span class="keyword">-&gt;</span><span class="default">item</span><span class="keyword">(</span><span class="default">0</span><span class="keyword">)-&gt;</span><span class="default">parentNode</span><span class="keyword">-&gt;</span><span class="default">replaceChild</span><span class="keyword">(</span><span class="default">$fragA</span><span class="keyword">, </span><span class="default">$xpResult</span><span class="keyword">-&gt;</span><span class="default">item</span><span class="keyword">(</span><span class="default">0</span><span class="keyword">));
<br />
</span><span class="default">?&gt;
<br />
</span>
<br />
Et voil? !
<br />

<br />
This produces :
<br />
&lt;?xml version="1.0" ?&gt;
<br />
&lt;action&gt;
<br />
&nbsp; &lt;EN&gt;English Text&lt;/EN&gt;
<br />
&lt;/action&gt;
<br />

<br />
....................................................
<br />

<br />
3) Also, be carefull, you CANNOT replace a node that doesn't exist.
<br />
While this may seems obvious, it is easy to forget.
<br />

<br />
Consider this :
<br />
&lt;?xml version="1.0" ?&gt;
<br />
&lt;action&gt;
<br />
&nbsp; &lt;EN&gt;&lt;/EN&gt;
<br />
&lt;/action&gt;
<br />

<br />
You cannot use replaceChild() to turn this into :
<br />
&lt;?xml version="1.0" ?&gt;
<br />
&lt;action&gt;
<br />
&nbsp; &lt;EN&gt;Some text&lt;/EN&gt;
<br />
&lt;/action&gt;
<br />

<br />
The reason is that since the &lt;EN&gt;&lt;/EN&gt; element is empty, it has no child (this is clearer to understand if you consider that &lt;EN&gt;&lt;/EN&gt; can be written &lt;EN /&gt;).
<br />
The fact that you intend to put some text inbetween &lt;EN&gt; and &lt;/EN&gt; does not change the fact that it has no text yet, thus no child yet.
<br />
When dealing with DOM, do not take your dream for the reality. The DOM parser doen't care about your dreams. If an element is currently empty, it has no child, whatever you intend to fill in.
<br />

<br />
Thus, the solution to teh problem is to use appendChild intead of replaceChild :
<br />

<br />
<span class="default">&lt;?php
<br />
$fragA </span><span class="keyword">= </span><span class="default">$doc</span><span class="keyword">-&gt;</span><span class="default">createTextNode</span><span class="keyword">(</span><span class="string">"Some Text"</span><span class="keyword">);
<br />
</span><span class="default">$xpResult </span><span class="keyword">= </span><span class="default">$xp</span><span class="keyword">-&gt;</span><span class="default">query</span><span class="keyword">(</span><span class="string">"/action/EN"</span><span class="keyword">);&nbsp;&nbsp; 
<br />
</span><span class="default">$blipblip </span><span class="keyword">= </span><span class="default">$xpResult</span><span class="keyword">-&gt;</span><span class="default">item</span><span class="keyword">(</span><span class="default">0</span><span class="keyword">)-&gt;</span><span class="default">appendChild</span><span class="keyword">(</span><span class="default">$fragA</span><span class="keyword">);
<br />
</span><span class="default">?&gt;
<br />
</span>
<br />
This produces the awaited :
<br />
&lt;?xml version="1.0" ?&gt;
<br />
&lt;action&gt;
<br />
&nbsp; &lt;EN&gt;Some Text&lt;/EN&gt;
<br />
&lt;/action&gt;
<br />

<br />
....................................................
<br />

<br />
4) Note that the description of replaceChild in the doc is wrong. Arguments have been inverted.
<br />
The correct description is :
<br />
object DOMNode-&gt;replaceChild (object newnode, object oldnode)</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
</div>
</div>
</div></div></body></html>
