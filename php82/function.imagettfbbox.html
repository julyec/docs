<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
 <head>
  <meta http-equiv="content-type" content="text/html; CHARSET=UTF-8">
  <title>取得使用 TrueType 字体的文本的边界框</title>
<link media="all" rel="stylesheet" type="text/css" href="styles/03e73060321a0a848018724a6c83de7f-theme-base.css" />
<link media="all" rel="stylesheet" type="text/css" href="styles/03e73060321a0a848018724a6c83de7f-theme-medium.css" />

  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <link media="all" rel="stylesheet" type="text/css" href="style.css"/>
 </head>
 <body class="docs" class="docs"><div class="navbar navbar-fixed-top">
  <div class="navbar-inner clearfix">
    <ul class="nav" style="width: 100%">
      <li style="float: left;"><a href="function.imagetruecolortopalette.html">? imagetruecolortopalette</a></li>
      <li style="float: right;"><a href="function.imagettftext.html">imagettftext ?</a></li>
    </ul>
  </div>
</div>
<div id="breadcrumbs" class="clearfix">
  <ul class="breadcrumbs-container">
    <li><a href="index.html">PHP Manual</a></li>
    <li><a href="ref.image.html">GD 和图像处理 函数</a></li>
    <li>取得使用 TrueType 字体的文本的边界框</li>
  </ul>
</div>
<div id="layout">
  <div id="layout-content"><div id="function.imagettfbbox" class="refentry">
 <div class="refnamediv">
  <h1 class="refname">imagettfbbox</h1>
  <p class="verinfo">(PHP 4, PHP 5, PHP 7, PHP 8)</p><p class="refpurpose"><span class="refname">imagettfbbox</span> &mdash; <span class="dc-title">取得使用 TrueType 字体的文本的边界框</span></p>

 </div>
 <div class="refsect1 description" id="refsect1-function.imagettfbbox-description">
  <h3 class="title">说明</h3>
  <div class="methodsynopsis dc-description">
   <span class="methodname"><strong>imagettfbbox</strong></span>(<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="methodparam"><span class="type">float</span> <code class="parameter">$size</code></span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="methodparam"><span class="type">float</span> <code class="parameter">$angle</code></span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="methodparam"><span class="type">string</span> <code class="parameter">$font_filename</code></span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="methodparam"><span class="type">string</span> <code class="parameter">$string</code></span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="methodparam"><span class="type">array</span> <code class="parameter">$options</code><span class="initializer"> = []</span></span><br>): <span class="type"><span class="type">array</span>|<span class="type"><span class="type false">false</span></span></span></div>

  <p class="para rdfs-comment">
   本函数计算并返回 TrueType 文本的边界框的像素大小。
  </p>
  <blockquote class="note"><p><strong class="note">Note</strong>: 
   <p class="para">
    在 PHP 8.0.0 之前，<span class="function"><a href="function.imageftbbox.html" class="function">imageftbbox()</a></span> 是 <span class="function"><strong>imagettfbbox()</strong></span> 的扩展变体，额外支持
    <code class="parameter">extrainfo</code>。自 PHP 8.0.0 起，<span class="function"><strong>imagettfbbox()</strong></span> 是 <span class="function"><a href="function.imageftbbox.html" class="function">imageftbbox()</a></span> 的别名。
   </p>
  </p></blockquote>
 </div>

 <div class="refsect1 parameters" id="refsect1-function.imagettfbbox-parameters">
  <h3 class="title">参数</h3>
  <p class="para">
   <dl>
    
     <dt>
<code class="parameter">size</code></dt>

     <dd>

      <p class="para">字体的尺寸，单位：点（磅）。</p>
     </dd>

    
    
     <dt>
<code class="parameter">angle</code></dt>

     <dd>

      <p class="para">
       测量字符串的角度（以度为单位）。
      </p>
     </dd>

    
    
    
     <dt>
<code class="parameter">fontfile</code></dt>

     <dd>

      <p class="para">
       想要使用的 TrueType 字体的路径。
      </p>
      <p class="para">
       根据 PHP 所使用的 GD 库版本，<em class="emphasis">当 <code class="parameter">fontfile</code>
       没有以 <code class="literal">/</code> 开头时则 <code class="literal">.ttf</code>
       将追加</em>到文件名之后，并且会在库定义字体路径中尝试搜索该文件名。
      </p>
      <p class="para">
       当使用的 GD 库版本低于 2.0.18 时，<code class="literal">space</code> 
       字符而不是分号将被用来作为不同字体文件的"路径分隔符"。不小心使用了此特性将会导致一条警告信息：<code class="literal">Warning:
       Could not find/open font</code>。对受影响的版本来说唯一解决方案就是将字体移动到不包含空格的路径。
      </p>
      <p class="para">
       很多情况下字体与使用字体的脚本在同一个目录中，下面的小技巧可以缓解 include 的问题。
       <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br /></span><span style="color: #FF8000">// Set the environment variable for GD<br /></span><span style="color: #0000BB">putenv</span><span style="color: #007700">(</span><span style="color: #DD0000">'GDFONTPATH=' </span><span style="color: #007700">. </span><span style="color: #0000BB">realpath</span><span style="color: #007700">(</span><span style="color: #DD0000">'.'</span><span style="color: #007700">));<br /><br /></span><span style="color: #FF8000">// Name the font to be used (note the lack of the .ttf extension)<br /></span><span style="color: #0000BB">$font </span><span style="color: #007700">= </span><span style="color: #DD0000">'SomeFont'</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
       </div>

      </p>
      <blockquote class="note"><p><strong class="note">Note</strong>: 
       <p class="para">
        注意 <a href="ini.core.html#ini.open-basedir" class="link">open_basedir</a>
        <em class="emphasis">不</em> 适用于 <code class="parameter">fontfile</code>。
       </p>
      </p></blockquote>
     </dd>

    

    
     <dt>
<code class="parameter">string</code></dt>

     <dd>

      <p class="para">
       要测量的字符串。
      </p>
     </dd>

    
   </dl>

  </p>
 </div>

 <div class="refsect1 returnvalues" id="refsect1-function.imagettfbbox-returnvalues">
  <h3 class="title">返回值</h3>
  <p class="para">
   <span class="function"><strong>imagettfbbox()</strong></span> 成功时返回包含 8 个元素的数组，代表构成文本边界框的四个点。失败时返回 <strong><code>false</code></strong>。
   <table class="doctable informaltable">
    
     <thead>
      <tr>
       <th>键</th>
       <th>内容</th>
      </tr>

     </thead>

     <tbody class="tbody">
      <tr>
       <td>0</td>
       <td>左下角,X 位置</td>
      </tr>

      <tr>
       <td>1</td>
       <td>左下角，Y 位置</td>
      </tr>

      <tr>
       <td>2</td>
       <td>右下角，X 位置</td>
      </tr>

      <tr>
       <td>3</td>
       <td>右下角，Y 位置</td>
      </tr>

      <tr>
       <td>4</td>
       <td>右上角，X 位置</td>
      </tr>

      <tr>
       <td>5</td>
       <td>右上角，Y 位置</td>
      </tr>

      <tr>
       <td>6</td>
       <td>左上角，X 位置</td>
      </tr>

      <tr>
       <td>7</td>
       <td>左上角，Y 位置</td>
      </tr>

     </tbody>
    
   </table>

  </p>
  <p class="para">
   这些点相对于 <em class="emphasis">text</em>，与 <code class="parameter">angle</code> 无关，因此"左上角"意味着可以在左上角看到横排文本。
  </p>
 </div>


 <div class="refsect1 changelog" id="refsect1-function.imagettfbbox-changelog">
  <h3 class="title">更新日志</h3>
  <table class="doctable informaltable">
   
    <thead>
     <tr>
      <th>版本</th>
      <th>说明</th>
     </tr>

    </thead>

    <tbody class="tbody">
     <tr>
      <td>8.0.0</td>
      <td>
       新增 <code class="parameter">options</code>。
      </td>
     </tr>

    </tbody>
   
  </table>

 </div>


 <div class="refsect1 examples" id="refsect1-function.imagettfbbox-examples">
  <h3 class="title">示例</h3>
  <p class="para">
   <div class="example" id="example-5588">
    <p><strong>Example #1 <span class="function"><strong>imagettfbbox()</strong></span> 示例</strong></p>
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br /></span><span style="color: #FF8000">// 创建 300x150 图像<br /></span><span style="color: #0000BB">$im </span><span style="color: #007700">= </span><span style="color: #0000BB">imagecreatetruecolor</span><span style="color: #007700">(</span><span style="color: #0000BB">300</span><span style="color: #007700">, </span><span style="color: #0000BB">150</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">$black </span><span style="color: #007700">= </span><span style="color: #0000BB">imagecolorallocate</span><span style="color: #007700">(</span><span style="color: #0000BB">$im</span><span style="color: #007700">, </span><span style="color: #0000BB">0</span><span style="color: #007700">, </span><span style="color: #0000BB">0</span><span style="color: #007700">, </span><span style="color: #0000BB">0</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">$white </span><span style="color: #007700">= </span><span style="color: #0000BB">imagecolorallocate</span><span style="color: #007700">(</span><span style="color: #0000BB">$im</span><span style="color: #007700">, </span><span style="color: #0000BB">255</span><span style="color: #007700">, </span><span style="color: #0000BB">255</span><span style="color: #007700">, </span><span style="color: #0000BB">255</span><span style="color: #007700">);<br /><br /></span><span style="color: #FF8000">// 设置白色背景色<br /></span><span style="color: #0000BB">imagefilledrectangle</span><span style="color: #007700">(</span><span style="color: #0000BB">$im</span><span style="color: #007700">, </span><span style="color: #0000BB">0</span><span style="color: #007700">, </span><span style="color: #0000BB">0</span><span style="color: #007700">, </span><span style="color: #0000BB">299</span><span style="color: #007700">, </span><span style="color: #0000BB">299</span><span style="color: #007700">, </span><span style="color: #0000BB">$white</span><span style="color: #007700">);<br /><br /></span><span style="color: #FF8000">// 字体文件的路径<br /></span><span style="color: #0000BB">$font </span><span style="color: #007700">= </span><span style="color: #DD0000">'./arial.ttf'</span><span style="color: #007700">;<br /><br /></span><span style="color: #FF8000">// 首先为第一个文本创建边界框<br /></span><span style="color: #0000BB">$bbox </span><span style="color: #007700">= </span><span style="color: #0000BB">imagettfbbox</span><span style="color: #007700">(</span><span style="color: #0000BB">10</span><span style="color: #007700">, </span><span style="color: #0000BB">45</span><span style="color: #007700">, </span><span style="color: #0000BB">$font</span><span style="color: #007700">, </span><span style="color: #DD0000">'Powered by PHP ' </span><span style="color: #007700">. </span><span style="color: #0000BB">phpversion</span><span style="color: #007700">());<br /><br /></span><span style="color: #FF8000">// 这是 X 坐标和 Y 坐标<br /></span><span style="color: #0000BB">$x </span><span style="color: #007700">= </span><span style="color: #0000BB">$bbox</span><span style="color: #007700">[</span><span style="color: #0000BB">0</span><span style="color: #007700">] + (</span><span style="color: #0000BB">imagesx</span><span style="color: #007700">(</span><span style="color: #0000BB">$im</span><span style="color: #007700">) / </span><span style="color: #0000BB">2</span><span style="color: #007700">) - (</span><span style="color: #0000BB">$bbox</span><span style="color: #007700">[</span><span style="color: #0000BB">4</span><span style="color: #007700">] / </span><span style="color: #0000BB">2</span><span style="color: #007700">) - </span><span style="color: #0000BB">25</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">$y </span><span style="color: #007700">= </span><span style="color: #0000BB">$bbox</span><span style="color: #007700">[</span><span style="color: #0000BB">1</span><span style="color: #007700">] + (</span><span style="color: #0000BB">imagesy</span><span style="color: #007700">(</span><span style="color: #0000BB">$im</span><span style="color: #007700">) / </span><span style="color: #0000BB">2</span><span style="color: #007700">) - (</span><span style="color: #0000BB">$bbox</span><span style="color: #007700">[</span><span style="color: #0000BB">5</span><span style="color: #007700">] / </span><span style="color: #0000BB">2</span><span style="color: #007700">) - </span><span style="color: #0000BB">5</span><span style="color: #007700">;<br /><br /></span><span style="color: #FF8000">// 写入<br /></span><span style="color: #0000BB">imagettftext</span><span style="color: #007700">(</span><span style="color: #0000BB">$im</span><span style="color: #007700">, </span><span style="color: #0000BB">10</span><span style="color: #007700">, </span><span style="color: #0000BB">45</span><span style="color: #007700">, </span><span style="color: #0000BB">$x</span><span style="color: #007700">, </span><span style="color: #0000BB">$y</span><span style="color: #007700">, </span><span style="color: #0000BB">$black</span><span style="color: #007700">, </span><span style="color: #0000BB">$font</span><span style="color: #007700">, </span><span style="color: #DD0000">'Powered by PHP ' </span><span style="color: #007700">. </span><span style="color: #0000BB">phpversion</span><span style="color: #007700">());<br /><br /></span><span style="color: #FF8000">// 为第二个文本创建边界框<br /></span><span style="color: #0000BB">$bbox </span><span style="color: #007700">= </span><span style="color: #0000BB">imagettfbbox</span><span style="color: #007700">(</span><span style="color: #0000BB">10</span><span style="color: #007700">, </span><span style="color: #0000BB">45</span><span style="color: #007700">, </span><span style="color: #0000BB">$font</span><span style="color: #007700">, </span><span style="color: #DD0000">'and Zend Engine ' </span><span style="color: #007700">. </span><span style="color: #0000BB">zend_version</span><span style="color: #007700">());<br /><br /></span><span style="color: #FF8000">// 设置坐标，使其位于第一个字的旁边<br /></span><span style="color: #0000BB">$x </span><span style="color: #007700">= </span><span style="color: #0000BB">$bbox</span><span style="color: #007700">[</span><span style="color: #0000BB">0</span><span style="color: #007700">] + (</span><span style="color: #0000BB">imagesx</span><span style="color: #007700">(</span><span style="color: #0000BB">$im</span><span style="color: #007700">) / </span><span style="color: #0000BB">2</span><span style="color: #007700">) - (</span><span style="color: #0000BB">$bbox</span><span style="color: #007700">[</span><span style="color: #0000BB">4</span><span style="color: #007700">] / </span><span style="color: #0000BB">2</span><span style="color: #007700">) + </span><span style="color: #0000BB">10</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">$y </span><span style="color: #007700">= </span><span style="color: #0000BB">$bbox</span><span style="color: #007700">[</span><span style="color: #0000BB">1</span><span style="color: #007700">] + (</span><span style="color: #0000BB">imagesy</span><span style="color: #007700">(</span><span style="color: #0000BB">$im</span><span style="color: #007700">) / </span><span style="color: #0000BB">2</span><span style="color: #007700">) - (</span><span style="color: #0000BB">$bbox</span><span style="color: #007700">[</span><span style="color: #0000BB">5</span><span style="color: #007700">] / </span><span style="color: #0000BB">2</span><span style="color: #007700">) - </span><span style="color: #0000BB">5</span><span style="color: #007700">;<br /><br /></span><span style="color: #FF8000">// 写入<br /></span><span style="color: #0000BB">imagettftext</span><span style="color: #007700">(</span><span style="color: #0000BB">$im</span><span style="color: #007700">, </span><span style="color: #0000BB">10</span><span style="color: #007700">, </span><span style="color: #0000BB">45</span><span style="color: #007700">, </span><span style="color: #0000BB">$x</span><span style="color: #007700">, </span><span style="color: #0000BB">$y</span><span style="color: #007700">, </span><span style="color: #0000BB">$black</span><span style="color: #007700">, </span><span style="color: #0000BB">$font</span><span style="color: #007700">, </span><span style="color: #DD0000">'and Zend Engine ' </span><span style="color: #007700">. </span><span style="color: #0000BB">zend_version</span><span style="color: #007700">());<br /><br /></span><span style="color: #FF8000">// 输出到浏览器<br /></span><span style="color: #0000BB">header</span><span style="color: #007700">(</span><span style="color: #DD0000">'Content-Type: image/png'</span><span style="color: #007700">);<br /><br /></span><span style="color: #0000BB">imagepng</span><span style="color: #007700">(</span><span style="color: #0000BB">$im</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">imagedestroy</span><span style="color: #007700">(</span><span style="color: #0000BB">$im</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
    </div>

   </div>
  </p>
 </div>

 <div class="refsect1 notes" id="refsect1-function.imagettfbbox-notes">
  <h3 class="title">注释</h3>
  <blockquote class="note"><p><strong class="note">Note</strong>: <span class="simpara">此函数仅在
PHP 编译时加入 freetype 支持时有效（<strong class="option configure">--with-freetype-dir=DIR</strong>）。</span></p></blockquote>
 </div>

 <div class="refsect1 seealso" id="refsect1-function.imagettfbbox-seealso">
  <h3 class="title">参见</h3>
  <ul class="simplelist">
   <li class="member"><span class="function"><a href="function.imagettftext.html" class="function" rel="rdfs-seeAlso">imagettftext()</a> - 用 TrueType 字体向图像写入文本</span></li>
   <li class="member"><span class="function"><a href="function.imageftbbox.html" class="function" rel="rdfs-seeAlso">imageftbbox()</a> - 通过 freetype2 使用字体给出文本的边界框</span></li>
  </ul>
 </div>

</div><div id="usernotes">
 <div class="head">
  <h3 class="title">User Contributed Notes</h3>
 </div>
<div id="allnotes">  <a name="126426""></a>
  <div class="note">
   <strong class="user">Somerset Ben</strong>
   <a href="#126426" class="date">15-Sep-2021 05:03</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Pushing text around.<br />
<br />
I wanted to put various bits of text in the corners of an image so I created a function to accept a location in the image and then put a corner of the text (eg right,top) at that location. Rotation is not supported.<br />
<br />
Inputs to the function are fairly standard. The align parameter is two characters R|M|L (right, middle, top)for x alignment and T|M|B (top, middle, bottom) for y alignment; eg "LT" meaning left, top. Omitting the align parameter displays nothing.<br />
<br />
The function returns the size of the text block or false indicating failure.<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">function </span><span class="default">imagettfalign </span><span class="keyword">(&amp;</span><span class="default">$im</span><span class="keyword">,</span><span class="default">$size</span><span class="keyword">,</span><span class="default">$x</span><span class="keyword">,</span><span class="default">$y</span><span class="keyword">,</span><span class="default">$col</span><span class="keyword">,</span><span class="default">$font</span><span class="keyword">,</span><span class="default">$text</span><span class="keyword">,</span><span class="default">$align</span><span class="keyword">=</span><span class="string">''</span><span class="keyword">)<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$box </span><span class="keyword">= </span><span class="default">imagettfbbox </span><span class="keyword">(</span><span class="default">$size</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">$font</span><span class="keyword">,</span><span class="default">$text</span><span class="keyword">) ;<br />
&nbsp;&nbsp;&nbsp; if (!</span><span class="default">$box</span><span class="keyword">) return </span><span class="default">false </span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; if (</span><span class="default">$align</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; switch (</span><span class="default">strtoupper</span><span class="keyword">(</span><span class="default">$align</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">])) </span><span class="comment">// X position<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">{<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="string">'L' </span><span class="keyword">: </span><span class="default">$tX </span><span class="keyword">= </span><span class="default">$x </span><span class="keyword">- </span><span class="default">$box</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">]&nbsp;&nbsp; ; break ;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="string">'R' </span><span class="keyword">: </span><span class="default">$tX </span><span class="keyword">= </span><span class="default">$x </span><span class="keyword">- </span><span class="default">$box</span><span class="keyword">[</span><span class="default">2</span><span class="keyword">]&nbsp;&nbsp; ; break ;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="string">'M' </span><span class="keyword">: </span><span class="default">$tX </span><span class="keyword">= </span><span class="default">$x </span><span class="keyword">- </span><span class="default">$box</span><span class="keyword">[</span><span class="default">2</span><span class="keyword">]/</span><span class="default">2 </span><span class="keyword">; break ;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; default : return </span><span class="default">false </span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; switch (</span><span class="default">strtoupper</span><span class="keyword">(</span><span class="default">$align</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">])) </span><span class="comment">// Y position<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">{<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="string">'B' </span><span class="keyword">: </span><span class="default">$tY </span><span class="keyword">= </span><span class="default">$y </span><span class="keyword">- </span><span class="default">$box</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">]&nbsp;&nbsp; ; break ;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="string">'T' </span><span class="keyword">: </span><span class="default">$tY </span><span class="keyword">= </span><span class="default">$y </span><span class="keyword">- </span><span class="default">$box</span><span class="keyword">[</span><span class="default">7</span><span class="keyword">]&nbsp;&nbsp; ; break ;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="string">'M' </span><span class="keyword">: </span><span class="default">$tY </span><span class="keyword">= </span><span class="default">$y </span><span class="keyword">- </span><span class="default">$box</span><span class="keyword">[</span><span class="default">7</span><span class="keyword">]/</span><span class="default">2 </span><span class="keyword">; break ;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; default : return </span><span class="default">false </span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (!</span><span class="default">imagettftext </span><span class="keyword">(</span><span class="default">$im</span><span class="keyword">,</span><span class="default">$size</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">$tX</span><span class="keyword">,</span><span class="default">$tY</span><span class="keyword">,</span><span class="default">$col</span><span class="keyword">,</span><span class="default">$font</span><span class="keyword">,</span><span class="default">$text</span><span class="keyword">)) return </span><span class="default">false </span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$r</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">]=</span><span class="default">abs</span><span class="keyword">(</span><span class="default">$box</span><span class="keyword">[</span><span class="default">2</span><span class="keyword">]) ;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$r</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">]=</span><span class="default">abs</span><span class="keyword">(</span><span class="default">$box</span><span class="keyword">[</span><span class="default">7</span><span class="keyword">]) ;<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">$r </span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
</span><span class="default">?&gt;<br />
</span><br />
An example (excluding font declarations, etc) would be:<br />
<span class="default">&lt;?php<br />
$im </span><span class="keyword">= @</span><span class="default">imagecreatetruecolor</span><span class="keyword">(</span><span class="default">400</span><span class="keyword">,</span><span class="default">200</span><span class="keyword">) ;<br />
</span><span class="default">$colBlack </span><span class="keyword">= </span><span class="default">imagecolorallocate</span><span class="keyword">(</span><span class="default">$im</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">);<br />
</span><span class="default">$xy </span><span class="keyword">= </span><span class="default">imagettfalign </span><span class="keyword">(</span><span class="default">$im</span><span class="keyword">,</span><span class="default">12</span><span class="keyword">,</span><span class="default">200</span><span class="keyword">,</span><span class="default">100</span><span class="keyword">,</span><span class="default">$colBlack</span><span class="keyword">,</span><span class="default">$ttFont</span><span class="keyword">,</span><span class="string">"The middle"</span><span class="keyword">,</span><span class="string">'MM'</span><span class="keyword">) ;<br />
</span><span class="default">?&gt;<br />
</span><br />
This will show "The middle" smack in the centre of the image.<br />
<br />
Finally,&nbsp; apologies for the non-standard indentation. It's just the way I've been doing it for years...</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="125053""></a>
  <div class="note">
   <strong class="user">dvladimirov77 at gmail dot com</strong>
   <a href="#125053" class="date">27-May-2020 12:43</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
if the line starts with a narrow character, for example: "1"<br />
<br />
&nbsp;&nbsp;&nbsp; function new_imagettfbbox($size, $angle, $fontfile, $text)<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $first = substr($text, 0, 1);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $sub = substr($text, 1);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; switch ($first)<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; case '1':<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $text = '0' . $sub;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; break;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return imagettfbbox($size, $angle, $fontfile, $text);<br />
&nbsp;&nbsp;&nbsp; }</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="120671""></a>
  <div class="note">
   <strong class="user">james dot heazlewood at crownbet com au</strong>
   <a href="#120671" class="date">20-Feb-2017 07:21</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I found the bounding boxes a bit tricky to use when trying to rotate AND align text boxes. I wrote this function allows you to set left, right or center aligned text and also rotate it.<br />
<br />
<span class="default">&lt;?php<br />
&nbsp; </span><span class="comment">/**<br />
&nbsp;&nbsp; * Renders rotate-able and align-able text of any font or colour<br />
&nbsp;&nbsp; * <br />
&nbsp;&nbsp; * @param resource $img Image resource<br />
&nbsp;&nbsp; * @param string $text<br />
&nbsp;&nbsp; * @param int $x<br />
&nbsp;&nbsp; * @param int $y<br />
&nbsp;&nbsp; * @param int $fontSize<br />
&nbsp;&nbsp; * @param string $fontFile Full path to font file<br />
&nbsp;&nbsp; * @param array $color Red, green, blue values in either int (255) or hex (0xFF)<br />
&nbsp;&nbsp; * @param string $align Accept 'left', 'right', and defaults to center<br />
&nbsp;&nbsp; * @return void<br />
&nbsp;&nbsp; */<br />
&nbsp; </span><span class="keyword">function </span><span class="default">gd_text_aligned</span><span class="keyword">(</span><span class="default">$img</span><span class="keyword">, </span><span class="default">$text</span><span class="keyword">, </span><span class="default">$x</span><span class="keyword">, </span><span class="default">$y</span><span class="keyword">, </span><span class="default">$fontSize</span><span class="keyword">, </span><span class="default">$fontFile</span><span class="keyword">, </span><span class="default">$color </span><span class="keyword">= [</span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">], </span><span class="default">$align </span><span class="keyword">= </span><span class="string">'left'</span><span class="keyword">) {<br />
<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="comment">// Create colour Resource<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">$textColor </span><span class="keyword">= </span><span class="default">imagecolorallocate</span><span class="keyword">(</span><span class="default">$img</span><span class="keyword">, </span><span class="default">$color</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">], </span><span class="default">$color</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">], </span><span class="default">$color</span><span class="keyword">[</span><span class="default">2</span><span class="keyword">]);<br />
<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="comment">// Create bounding box co-ordinates<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">$boundingBox </span><span class="keyword">= </span><span class="default">imagettfbbox</span><span class="keyword">(</span><span class="default">$fontSize</span><span class="keyword">, </span><span class="default">$rotation</span><span class="keyword">, </span><span class="default">$fontFile</span><span class="keyword">, </span><span class="default">$text</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">$textBox </span><span class="keyword">= </span><span class="default">imagettfbbox</span><span class="keyword">(</span><span class="default">$fontSize</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">$fontFile</span><span class="keyword">, </span><span class="default">$text</span><span class="keyword">);<br />
<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="comment">//&nbsp; Bounding box array key meanings<br />
&nbsp;&nbsp; &nbsp;&nbsp; //<br />
&nbsp;&nbsp; &nbsp;&nbsp; //&nbsp; $bBox[0] = lower left&nbsp; X<br />
&nbsp;&nbsp; &nbsp;&nbsp; //&nbsp; $bBox[1] = lower left&nbsp; Y<br />
&nbsp;&nbsp; &nbsp;&nbsp; //&nbsp; $bBox[2] = lower right X<br />
&nbsp;&nbsp; &nbsp;&nbsp; //&nbsp; $bBox[3] = lower right Y<br />
&nbsp;&nbsp; &nbsp;&nbsp; //&nbsp; $bBox[4] = upper right X<br />
&nbsp;&nbsp; &nbsp;&nbsp; //&nbsp; $bBox[5] = upper right Y<br />
&nbsp;&nbsp; &nbsp;&nbsp; //&nbsp; $bBox[6] = upper left&nbsp; X<br />
&nbsp;&nbsp; &nbsp;&nbsp; //&nbsp; $bBox[7] = upper left&nbsp; Y<br />
&nbsp;&nbsp; &nbsp;&nbsp; //<br />
&nbsp;&nbsp; &nbsp;&nbsp; //&nbsp; &nbsp;&nbsp; 6,7&nbsp; &nbsp;&nbsp; |&nbsp; &nbsp;&nbsp; 4,5<br />
&nbsp;&nbsp; &nbsp;&nbsp; //&nbsp; &nbsp; &nbsp; &nbsp; -----+-----<br />
&nbsp;&nbsp; &nbsp;&nbsp; //&nbsp; &nbsp;&nbsp; 0,1&nbsp; &nbsp;&nbsp; |&nbsp; &nbsp;&nbsp; 2,3<br />
&nbsp;&nbsp; &nbsp;&nbsp; //<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">$boundingBoxWidth </span><span class="keyword">= </span><span class="default">$boundingBox</span><span class="keyword">[</span><span class="default">4</span><span class="keyword">] - </span><span class="default">$boundingBox</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">];<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">$boundingBoxHeight </span><span class="keyword">= </span><span class="default">$boundingBox</span><span class="keyword">[</span><span class="default">5</span><span class="keyword">] - </span><span class="default">$boundingBox</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">];<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">$flatHeight </span><span class="keyword">= </span><span class="default">$textBox</span><span class="keyword">[</span><span class="default">5</span><span class="keyword">] - </span><span class="default">$textBox</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">]; <br />
<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="comment">// Align left right or centred?<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="keyword">if(</span><span class="default">$align </span><span class="keyword">== </span><span class="string">'left'</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$drawX </span><span class="keyword">= </span><span class="default">$x </span><span class="keyword">- </span><span class="default">sin</span><span class="keyword">(</span><span class="default">$rotation </span><span class="keyword">* </span><span class="default">M_PI </span><span class="keyword">/ </span><span class="default">180</span><span class="keyword">) * (</span><span class="default">$flatHeight </span><span class="keyword">/ </span><span class="default">2</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$drawY </span><span class="keyword">= </span><span class="default">$y </span><span class="keyword">- </span><span class="default">cos</span><span class="keyword">(</span><span class="default">$rotation </span><span class="keyword">* </span><span class="default">M_PI </span><span class="keyword">/ </span><span class="default">180</span><span class="keyword">) * (</span><span class="default">$flatHeight </span><span class="keyword">/ </span><span class="default">2</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp;&nbsp; } else if(</span><span class="default">$align </span><span class="keyword">== </span><span class="string">'right'</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$drawX </span><span class="keyword">= </span><span class="default">$x </span><span class="keyword">- </span><span class="default">$boundingBoxWidth </span><span class="keyword">+ </span><span class="default">sin</span><span class="keyword">(</span><span class="default">$rotation </span><span class="keyword">* </span><span class="default">M_PI </span><span class="keyword">/ </span><span class="default">180</span><span class="keyword">) * (</span><span class="default">$flatHeight </span><span class="keyword">/ </span><span class="default">2</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$drawY </span><span class="keyword">= </span><span class="default">$y </span><span class="keyword">- </span><span class="default">$boundingBoxHeight </span><span class="keyword">+ </span><span class="default">cos</span><span class="keyword">(</span><span class="default">$rotation </span><span class="keyword">* </span><span class="default">M_PI </span><span class="keyword">/ </span><span class="default">180</span><span class="keyword">) * (</span><span class="default">$flatHeight </span><span class="keyword">/ </span><span class="default">2</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp;&nbsp; } else {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// no alignment (centred)<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$drawX </span><span class="keyword">= </span><span class="default">$x </span><span class="keyword">- </span><span class="default">$boundingBoxWidth </span><span class="keyword">/ </span><span class="default">2</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$drawY </span><span class="keyword">= </span><span class="default">$y </span><span class="keyword">- </span><span class="default">$boundingBoxHeight </span><span class="keyword">/ </span><span class="default">2</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="comment">// draw text<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">imagettftext</span><span class="keyword">(<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$img</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$fontSize</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$rotation</span><span class="keyword">, </span><span class="default">$drawX</span><span class="keyword">, </span><span class="default">$drawY</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$textColor</span><span class="keyword">, </span><span class="default">$fontFile</span><span class="keyword">, </span><span class="default">$text<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; }</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="120117""></a>
  <div class="note">
   <strong class="user">tuxedobob</strong>
   <a href="#120117" class="date">03-Nov-2016 04:02</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
You might save yourself a lot of time and headache if you remember that the bold version of a font is NOT necessarily the same height as the regular version of that font!<br />
<br />
(In fact, it can be shorter!)</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="118677""></a>
  <div class="note">
   <strong class="user">gw at example dot com</strong>
   <a href="#118677" class="date">18-Jan-2016 05:32</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
a little something to replace in blackbart tip :<br />
<br />
// start scanning (0=&gt; black =&gt; empty) <br />
&nbsp; $rleft&nbsp; = $w4 = $width&lt;&lt;2; <br />
&nbsp; $rright = 0; <br />
&nbsp; $rbottom&nbsp;&nbsp; = 0; <br />
&nbsp; $rtop = $h4 = $height&lt;&lt;2; <br />
&nbsp; for( $x = 0; $x &lt; $w4; $x++ ) <br />
&nbsp;&nbsp;&nbsp; for( $y = 0; $y &lt; $h4; $y++ ) <br />
&nbsp;&nbsp; &nbsp;&nbsp; if( imagecolorat( $img, $x, $y ) ){ <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $rleft&nbsp;&nbsp; = min( $rleft, $x ); <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $rright&nbsp; = max( $rright, $x ); <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $rtop&nbsp; &nbsp; = min( $rtop, $y ); <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $rbottom = max( $rbottom, $y ); <br />
&nbsp;&nbsp; &nbsp;&nbsp; } <br />
<br />
with<br />
<br />
// start scanning (0=&gt; black =&gt; empty) <br />
&nbsp; $break = false;<br />
&nbsp; $rleft&nbsp; = $w4 = $width&lt;&lt;2; <br />
&nbsp; $rright = 0; <br />
&nbsp; $rbottom&nbsp;&nbsp; = 0; <br />
&nbsp; $rtop = $h4 = $height&lt;&lt;2; <br />
&nbsp; // scanning from left to right, breaking when a pixel is found, to scan from the other side : avoid scanning all pixels !<br />
&nbsp; for($x=0; $x&lt;$w4; $x++){<br />
&nbsp;&nbsp;&nbsp; for($y=0; $y&lt;$h4; $y++)<br />
&nbsp;&nbsp; &nbsp;&nbsp; if(imagecolorat($img,$x,$y)){<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $rtop = min($rtop, $y); $rleft = min($rleft, $x);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $break = true; break;<br />
&nbsp;&nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; if($break) break;<br />
&nbsp; }<br />
&nbsp; // scanning from right to left, breaking when a pixel is found<br />
&nbsp; for($x=($w4-1); $x&gt;$rleft; $x--){<br />
&nbsp;&nbsp;&nbsp; for($y=0; $y&lt;$h4; $y++)<br />
&nbsp;&nbsp; &nbsp;&nbsp; if(imagecolorat($img,$x,$y)){<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $rright = max($rright, $x); $rbottom = max($rbottom, $y);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $break = true; break;<br />
&nbsp;&nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; if($break) break;<br />
&nbsp; }<br />
//... //<br />
<br />
it may be even better to check if the picture is portrait or landscape, to start the loops from left-right(landscape) or top-bottom (portrait)</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="117234""></a>
  <div class="note">
   <strong class="user">indraaaa34 at gmail dot com</strong>
   <a href="#117234" class="date">07-May-2015 12:49</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
The returned array order is like this:<br />
-----------------------------<br />
| X:4&nbsp; Y:5&nbsp; &nbsp; &nbsp; | X:&nbsp;&nbsp; Y:7&nbsp; &nbsp; &nbsp; &nbsp; |<br />
-----------------------------<br />
| X:0&nbsp; Y:1&nbsp; &nbsp; &nbsp; | X:2&nbsp; Y:3&nbsp; &nbsp; &nbsp;&nbsp; |<br />
-----------------------------<br />
<br />
eg:<br />
4 for the upper left X <br />
5 for the upper left Y and so on.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="116999""></a>
  <div class="note">
   <strong class="user">user107</strong>
   <a href="#116999" class="date">31-Mar-2015 03:36</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I found a simple solution that was working for me:<br />
<br />
&nbsp;<span class="default">&lt;?php<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">if(!isset(</span><span class="default">$_GET</span><span class="keyword">[</span><span class="string">'size'</span><span class="keyword">])) </span><span class="default">$_GET</span><span class="keyword">[</span><span class="string">'size'</span><span class="keyword">] = </span><span class="default">44</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; if(!isset(</span><span class="default">$_GET</span><span class="keyword">[</span><span class="string">'text'</span><span class="keyword">])) </span><span class="default">$_GET</span><span class="keyword">[</span><span class="string">'text'</span><span class="keyword">] = </span><span class="string">"Hello, world!"</span><span class="keyword">;<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$size </span><span class="keyword">= </span><span class="default">imagettfbbox</span><span class="keyword">(</span><span class="default">$_GET</span><span class="keyword">[</span><span class="string">'size'</span><span class="keyword">], </span><span class="default">0</span><span class="keyword">, </span><span class="string">"ARIAL"</span><span class="keyword">, </span><span class="default">$_GET</span><span class="keyword">[</span><span class="string">'text'</span><span class="keyword">]);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$xsize </span><span class="keyword">= </span><span class="default">abs</span><span class="keyword">(</span><span class="default">$size</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">]) + </span><span class="default">abs</span><span class="keyword">(</span><span class="default">$size</span><span class="keyword">[</span><span class="default">2</span><span class="keyword">]);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$ysize </span><span class="keyword">= </span><span class="default">abs</span><span class="keyword">(</span><span class="default">$size</span><span class="keyword">[</span><span class="default">5</span><span class="keyword">]) + </span><span class="default">abs</span><span class="keyword">(</span><span class="default">$size</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">]);<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$image </span><span class="keyword">= </span><span class="default">imagecreate</span><span class="keyword">(</span><span class="default">$xsize</span><span class="keyword">, </span><span class="default">$ysize</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$blue </span><span class="keyword">= </span><span class="default">imagecolorallocate</span><span class="keyword">(</span><span class="default">$image</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">255</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$white </span><span class="keyword">= </span><span class="default">ImageColorAllocate</span><span class="keyword">(</span><span class="default">$image</span><span class="keyword">, </span><span class="default">255</span><span class="keyword">,</span><span class="default">255</span><span class="keyword">,</span><span class="default">255</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">imagettftext</span><span class="keyword">(</span><span class="default">$image</span><span class="keyword">, </span><span class="default">$_GET</span><span class="keyword">[</span><span class="string">'size'</span><span class="keyword">], </span><span class="default">0</span><span class="keyword">, </span><span class="default">abs</span><span class="keyword">(</span><span class="default">$size</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">]), </span><span class="default">abs</span><span class="keyword">(</span><span class="default">$size</span><span class="keyword">[</span><span class="default">5</span><span class="keyword">]), </span><span class="default">$white</span><span class="keyword">, </span><span class="string">"ARIAL"</span><span class="keyword">, </span><span class="default">$_GET</span><span class="keyword">[</span><span class="string">'text'</span><span class="keyword">]);<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">header</span><span class="keyword">(</span><span class="string">"content-type: image/png"</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">imagepng</span><span class="keyword">(</span><span class="default">$image</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">imagedestroy</span><span class="keyword">(</span><span class="default">$image</span><span class="keyword">);<br />
</span><span class="default">?&gt;</span> <br />
<br />
Here is the link with a examples:<br />
<a href="http://www.tuxradar.com/practicalphp/11/2/6#null" rel="nofollow" target="_blank">http://www.tuxradar.com/practicalphp/11/2/6#null</a></span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="111922""></a>
  <div class="note">
   <strong class="user">rasmus at mindplay dot dk</strong>
   <a href="#111922" class="date">11-Apr-2013 01:33</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
It should be noted that the bounding box coordinates returned by this function are inaccurate - bug reports about this have been open for 5 years, so expect this will likely never be fixed. <br />
<br />
More information here:<br />
<br />
https://gist.github.com/mindplay-dk/4429153</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="109589""></a>
  <div class="note">
   <strong class="user">go4christian at gmail dot com</strong>
   <a href="#109589" class="date">31-Jul-2012 03:02</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Automatic line breaks: This simple function is able automatically create line breaks if you want to write a text on an image. All you have to specify is a maximum length.
<br />

<br />
<span class="default">&lt;?php
<br />
</span><span class="keyword">function </span><span class="default">write_multiline_text</span><span class="keyword">(</span><span class="default">$image</span><span class="keyword">, </span><span class="default">$font_size</span><span class="keyword">, </span><span class="default">$color</span><span class="keyword">, </span><span class="default">$font</span><span class="keyword">, </span><span class="default">$text</span><span class="keyword">, </span><span class="default">$start_x</span><span class="keyword">, </span><span class="default">$start_y</span><span class="keyword">, </span><span class="default">$max_width</span><span class="keyword">) 
<br />
{
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">//split the string
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; //build new string word for word
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; //check everytime you add a word if string still fits
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; //otherwise, remove last word, post current string and start fresh on a new line
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$words </span><span class="keyword">= </span><span class="default">explode</span><span class="keyword">(</span><span class="string">" "</span><span class="keyword">, </span><span class="default">$text</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$string </span><span class="keyword">= </span><span class="string">""</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$tmp_string </span><span class="keyword">= </span><span class="string">""</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; 
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; for(</span><span class="default">$i </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">; </span><span class="default">$i </span><span class="keyword">&lt; </span><span class="default">count</span><span class="keyword">(</span><span class="default">$words</span><span class="keyword">); </span><span class="default">$i</span><span class="keyword">++)
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$tmp_string </span><span class="keyword">.= </span><span class="default">$words</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">].</span><span class="string">" "</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; 
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">//check size of string
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$dim </span><span class="keyword">= </span><span class="default">imagettfbbox</span><span class="keyword">(</span><span class="default">$font_size</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">$font</span><span class="keyword">, </span><span class="default">$tmp_string</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; 
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">$dim</span><span class="keyword">[</span><span class="default">4</span><span class="keyword">] &lt; </span><span class="default">$max_width</span><span class="keyword">)
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$string </span><span class="keyword">= </span><span class="default">$tmp_string</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; } else {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$i</span><span class="keyword">--;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$tmp_string </span><span class="keyword">= </span><span class="string">""</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">imagettftext</span><span class="keyword">(</span><span class="default">$image</span><span class="keyword">, </span><span class="default">11</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">$start_x</span><span class="keyword">, </span><span class="default">$start_y</span><span class="keyword">, </span><span class="default">$color</span><span class="keyword">, </span><span class="default">$font</span><span class="keyword">, </span><span class="default">$string</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; 
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$string </span><span class="keyword">= </span><span class="string">""</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$start_y </span><span class="keyword">+= </span><span class="default">22</span><span class="keyword">; </span><span class="comment">//change this to adjust line-height. Additionally you could use the information from the "dim" array to automatically figure out how much you have to "move down"
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">}
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; 
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">imagettftext</span><span class="keyword">(</span><span class="default">$image</span><span class="keyword">, </span><span class="default">11</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">$start_x</span><span class="keyword">, </span><span class="default">$start_y</span><span class="keyword">, </span><span class="default">$color</span><span class="keyword">, </span><span class="default">$font</span><span class="keyword">, </span><span class="default">$string</span><span class="keyword">); </span><span class="comment">//"draws" the rest of the string
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="108955""></a>
  <div class="note">
   <strong class="user">magnum dot tc dot mr at gmail dot com</strong>
   <a href="#108955" class="date">07-Jun-2012 10:50</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Please note that the 3rd argument is really a "path". 
<br />
<span class="default">&lt;?php
<br />
imagettfbbox</span><span class="keyword">(</span><span class="default">10</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="string">'arial.ttf'</span><span class="keyword">, </span><span class="string">'Hello, World!'</span><span class="keyword">);&nbsp; </span><span class="comment">// will result in "Warning: imagettfbbox(): Could not find/open font in ...php on line ..."
<br />
</span><span class="default">?&gt;
<br />
</span>
<br />
use instead something like this:
<br />
<span class="default">&lt;?php imagettfbbox</span><span class="keyword">(</span><span class="default">10</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="string">'./arial.ttf'</span><span class="keyword">, </span><span class="string">'Hello, World!'</span><span class="keyword">); </span><span class="default">?&gt;
<br />
</span>or
<br />
<span class="default">&lt;?php imagettfbbox</span><span class="keyword">(</span><span class="default">10</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">getcwd</span><span class="keyword">().</span><span class="string">'/arial.ttf'</span><span class="keyword">, </span><span class="string">'Hello, World!'</span><span class="keyword">); </span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="108536""></a>
  <div class="note">
   <strong class="user">Anonymous</strong>
   <a href="#108536" class="date">04-May-2012 01:29</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
It seems to be worth pointing out that the "points" unit GD2 is using corresponds to 96 dpi, as defined in gd.h:<br />
#define GD_RESOLUTION&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; 96&nbsp; &nbsp; &nbsp; /* pixels per inch */<br />
<br />
So if you want to translate the bbox back to font points, you need to multiply all coordinates by 72/96 = 3/4.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="105593""></a>
  <div class="note">
   <strong class="user">jodybrabec at gmail dot com</strong>
   <a href="#105593" class="date">30-Aug-2011 03:39</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Very CLEAR version of func., with example....
<br />

<br />
<span class="default">&lt;?php
<br />

<br />
</span><span class="keyword">function </span><span class="default">calculateTextBox</span><span class="keyword">(</span><span class="default">$text</span><span class="keyword">,</span><span class="default">$fontFile</span><span class="keyword">,</span><span class="default">$fontSize</span><span class="keyword">,</span><span class="default">$fontAngle</span><span class="keyword">) {
<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">/************
<br />
&nbsp;&nbsp;&nbsp; simple function that calculates the *exact* bounding box (single pixel precision). 
<br />
&nbsp;&nbsp;&nbsp; The function returns an associative array with these keys: 
<br />
&nbsp;&nbsp;&nbsp; left, top:&nbsp; coordinates you will pass to imagettftext 
<br />
&nbsp;&nbsp;&nbsp; width, height: dimension of the image you have to create 
<br />
&nbsp;&nbsp;&nbsp; *************/
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$rect </span><span class="keyword">= </span><span class="default">imagettfbbox</span><span class="keyword">(</span><span class="default">$fontSize</span><span class="keyword">,</span><span class="default">$fontAngle</span><span class="keyword">,</span><span class="default">$fontFile</span><span class="keyword">,</span><span class="default">$text</span><span class="keyword">);
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$minX </span><span class="keyword">= </span><span class="default">min</span><span class="keyword">(array(</span><span class="default">$rect</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">],</span><span class="default">$rect</span><span class="keyword">[</span><span class="default">2</span><span class="keyword">],</span><span class="default">$rect</span><span class="keyword">[</span><span class="default">4</span><span class="keyword">],</span><span class="default">$rect</span><span class="keyword">[</span><span class="default">6</span><span class="keyword">]));
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$maxX </span><span class="keyword">= </span><span class="default">max</span><span class="keyword">(array(</span><span class="default">$rect</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">],</span><span class="default">$rect</span><span class="keyword">[</span><span class="default">2</span><span class="keyword">],</span><span class="default">$rect</span><span class="keyword">[</span><span class="default">4</span><span class="keyword">],</span><span class="default">$rect</span><span class="keyword">[</span><span class="default">6</span><span class="keyword">]));
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$minY </span><span class="keyword">= </span><span class="default">min</span><span class="keyword">(array(</span><span class="default">$rect</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">],</span><span class="default">$rect</span><span class="keyword">[</span><span class="default">3</span><span class="keyword">],</span><span class="default">$rect</span><span class="keyword">[</span><span class="default">5</span><span class="keyword">],</span><span class="default">$rect</span><span class="keyword">[</span><span class="default">7</span><span class="keyword">]));
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$maxY </span><span class="keyword">= </span><span class="default">max</span><span class="keyword">(array(</span><span class="default">$rect</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">],</span><span class="default">$rect</span><span class="keyword">[</span><span class="default">3</span><span class="keyword">],</span><span class="default">$rect</span><span class="keyword">[</span><span class="default">5</span><span class="keyword">],</span><span class="default">$rect</span><span class="keyword">[</span><span class="default">7</span><span class="keyword">]));
<br />
&nbsp;&nbsp;&nbsp; 
<br />
&nbsp;&nbsp;&nbsp; return array(
<br />
&nbsp;&nbsp; &nbsp; </span><span class="string">"left"&nbsp;&nbsp; </span><span class="keyword">=&gt; </span><span class="default">abs</span><span class="keyword">(</span><span class="default">$minX</span><span class="keyword">) - </span><span class="default">1</span><span class="keyword">,
<br />
&nbsp;&nbsp; &nbsp; </span><span class="string">"top"&nbsp; &nbsp; </span><span class="keyword">=&gt; </span><span class="default">abs</span><span class="keyword">(</span><span class="default">$minY</span><span class="keyword">) - </span><span class="default">1</span><span class="keyword">,
<br />
&nbsp;&nbsp; &nbsp; </span><span class="string">"width"&nbsp; </span><span class="keyword">=&gt; </span><span class="default">$maxX </span><span class="keyword">- </span><span class="default">$minX</span><span class="keyword">,
<br />
&nbsp;&nbsp; &nbsp; </span><span class="string">"height" </span><span class="keyword">=&gt; </span><span class="default">$maxY </span><span class="keyword">- </span><span class="default">$minY</span><span class="keyword">,
<br />
&nbsp;&nbsp; &nbsp; </span><span class="string">"box"&nbsp; &nbsp; </span><span class="keyword">=&gt; </span><span class="default">$rect
<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">);
<br />
}
<br />

<br />
</span><span class="comment">// Example usage - gif image output
<br />

<br />
</span><span class="default">$text_string&nbsp; &nbsp; </span><span class="keyword">= </span><span class="string">"Hullo World"</span><span class="keyword">;
<br />
</span><span class="default">$font_ttf&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">= </span><span class="string">"./fonts/arial.ttf"</span><span class="keyword">;
<br />
</span><span class="default">$font_size&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">= </span><span class="default">22</span><span class="keyword">;
<br />
</span><span class="default">$text_angle&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;
<br />
</span><span class="default">$text_padding&nbsp; &nbsp; </span><span class="keyword">= </span><span class="default">10</span><span class="keyword">; </span><span class="comment">// Img padding - around text
<br />

<br />
</span><span class="default">$the_box&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">= </span><span class="default">calculateTextBox</span><span class="keyword">(</span><span class="default">$text_string</span><span class="keyword">, </span><span class="default">$font_ttf</span><span class="keyword">, </span><span class="default">$font_size</span><span class="keyword">, </span><span class="default">$text_angle</span><span class="keyword">);
<br />

<br />
</span><span class="default">$imgWidth&nbsp; &nbsp; </span><span class="keyword">= </span><span class="default">$the_box</span><span class="keyword">[</span><span class="string">"width"</span><span class="keyword">] + </span><span class="default">$text_padding</span><span class="keyword">;
<br />
</span><span class="default">$imgHeight&nbsp; &nbsp; </span><span class="keyword">= </span><span class="default">$the_box</span><span class="keyword">[</span><span class="string">"height"</span><span class="keyword">] + </span><span class="default">$text_padding</span><span class="keyword">; 
<br />

<br />
</span><span class="default">$image </span><span class="keyword">= </span><span class="default">imagecreate</span><span class="keyword">(</span><span class="default">$imgWidth</span><span class="keyword">,</span><span class="default">$imgHeight</span><span class="keyword">);
<br />
</span><span class="default">imagefill</span><span class="keyword">(</span><span class="default">$image</span><span class="keyword">, </span><span class="default">imagecolorallocate</span><span class="keyword">(</span><span class="default">$image</span><span class="keyword">,</span><span class="default">200</span><span class="keyword">,</span><span class="default">200</span><span class="keyword">,</span><span class="default">200</span><span class="keyword">));
<br />

<br />
</span><span class="default">$color </span><span class="keyword">= </span><span class="default">imagecolorallocate</span><span class="keyword">(</span><span class="default">$image</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">);
<br />
</span><span class="default">imagettftext</span><span class="keyword">(</span><span class="default">$image</span><span class="keyword">,
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$font_size</span><span class="keyword">,
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$text_angle</span><span class="keyword">,
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$the_box</span><span class="keyword">[</span><span class="string">"left"</span><span class="keyword">] + (</span><span class="default">$imgWidth </span><span class="keyword">/ </span><span class="default">2</span><span class="keyword">) - (</span><span class="default">$the_box</span><span class="keyword">[</span><span class="string">"width"</span><span class="keyword">] / </span><span class="default">2</span><span class="keyword">),
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$the_box</span><span class="keyword">[</span><span class="string">"top"</span><span class="keyword">] + (</span><span class="default">$imgHeight </span><span class="keyword">/ </span><span class="default">2</span><span class="keyword">) - (</span><span class="default">$the_box</span><span class="keyword">[</span><span class="string">"height"</span><span class="keyword">] / </span><span class="default">2</span><span class="keyword">),
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$color</span><span class="keyword">,
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$font_ttf</span><span class="keyword">,
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$text_string</span><span class="keyword">);
<br />

<br />
</span><span class="default">header</span><span class="keyword">(</span><span class="string">"Content-Type: image/gif"</span><span class="keyword">);
<br />
</span><span class="default">imagegif</span><span class="keyword">(</span><span class="default">$image</span><span class="keyword">);
<br />
</span><span class="default">imagedestroy</span><span class="keyword">(</span><span class="default">$image</span><span class="keyword">);
<br />

<br />
</span><span class="default">?&gt;
<br />
</span>
<br />
[ remember: No spaces before or after the <span class="default">&lt;?php </span><span class="keyword">... </span><span class="default">?&gt;</span> tag, because of header() call, you Roast! ]</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="101684""></a>
  <div class="note">
   <strong class="user">Andrey Zakharov</strong>
   <a href="#101684" class="date">04-Jan-2011 03:16</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
For mixed text drawing on image, height given by this function is useless and leads to text's hip-hops over the baseline .<br />
<br />
I will use just this:<br />
<span class="default">&lt;?php<br />
$size </span><span class="keyword">= </span><span class="default">12</span><span class="keyword">;</span><span class="comment">//font height<br />
</span><span class="default">$font </span><span class="keyword">= </span><span class="string">'Arial'</span><span class="keyword">;</span><span class="comment">// your font<br />
</span><span class="default">$char </span><span class="keyword">= </span><span class="string">'Test'</span><span class="keyword">;<br />
</span><span class="default">$char </span><span class="keyword">= </span><span class="string">'With W'</span><span class="keyword">;<br />
</span><span class="default">$char </span><span class="keyword">= </span><span class="string">'without w but with p and y and q'</span><span class="keyword">;<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$rect </span><span class="keyword">= </span><span class="default">imagettfbbox</span><span class="keyword">(</span><span class="default">$size</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">$font</span><span class="keyword">, </span><span class="default">$char</span><span class="keyword">);<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$image_height </span><span class="keyword">=</span><span class="default">abs</span><span class="keyword">( </span><span class="default">$rect</span><span class="keyword">[</span><span class="default">7</span><span class="keyword">] );</span><span class="comment">//do no respect bottom margin<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$imw </span><span class="keyword">= </span><span class="default">$rect</span><span class="keyword">[</span><span class="default">2</span><span class="keyword">] - </span><span class="default">$rect</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">]; </span><span class="comment">//as usual<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$bx </span><span class="keyword">= </span><span class="default">abs</span><span class="keyword">( </span><span class="default">$rect</span><span class="keyword">[ </span><span class="default">0 </span><span class="keyword">] ); </span><span class="comment">// X offset <br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$by </span><span class="keyword">= </span><span class="default">$size </span><span class="keyword">* </span><span class="default">1.25</span><span class="keyword">; </span><span class="comment">// Y offset - we will use const LINEHEIGHT<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="101537""></a>
  <div class="note">
   <strong class="user">a2hansolo at gmail dot com</strong>
   <a href="#101537" class="date">22-Dec-2010 11:29</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
measure bg image size, wrap text to fit image width
<br />

<br />
<span class="default">&lt;?php
<br />
$mx </span><span class="keyword">= </span><span class="default">imagesx</span><span class="keyword">(</span><span class="default">$main_img</span><span class="keyword">);
<br />
</span><span class="default">$my </span><span class="keyword">= </span><span class="default">imagesy</span><span class="keyword">(</span><span class="default">$main_img</span><span class="keyword">);
<br />

<br />
</span><span class="comment">//TEXT VARS/////////
<br />
</span><span class="default">$main_text </span><span class="keyword">= ;
<br />
</span><span class="default">$main_text_size </span><span class="keyword">= ;
<br />
</span><span class="default">$main_text_x </span><span class="keyword">= (</span><span class="default">$mx</span><span class="keyword">/</span><span class="default">2</span><span class="keyword">);
<br />

<br />
</span><span class="default">$main_text_color </span><span class="keyword">= </span><span class="default">imagecolorallocate</span><span class="keyword">(</span><span class="default">$main_img</span><span class="keyword">, </span><span class="default">$main_text_red</span><span class="keyword">, </span><span class="default">$main_text_green</span><span class="keyword">, </span><span class="default">$main_text_blue</span><span class="keyword">);
<br />
</span><span class="default">$words </span><span class="keyword">= </span><span class="default">explode</span><span class="keyword">(</span><span class="string">' '</span><span class="keyword">, </span><span class="default">$main_text</span><span class="keyword">);
<br />
</span><span class="default">$lines </span><span class="keyword">= array(</span><span class="default">$words</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">]); 
<br />
</span><span class="default">$currentLine </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; for(</span><span class="default">$i </span><span class="keyword">= </span><span class="default">1</span><span class="keyword">; </span><span class="default">$i </span><span class="keyword">&lt; </span><span class="default">count</span><span class="keyword">(</span><span class="default">$words</span><span class="keyword">); </span><span class="default">$i</span><span class="keyword">++)
<br />
&nbsp;&nbsp;&nbsp; {
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$lineSize </span><span class="keyword">= </span><span class="default">imagettfbbox</span><span class="keyword">(</span><span class="default">$main_text_size</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">$mt_f</span><span class="keyword">, </span><span class="default">$lines</span><span class="keyword">[</span><span class="default">$currentLine</span><span class="keyword">] . </span><span class="string">' ' </span><span class="keyword">. </span><span class="default">$words</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">]);
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">$lineSize</span><span class="keyword">[</span><span class="default">2</span><span class="keyword">] - </span><span class="default">$lineSize</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">] &lt; </span><span class="default">$mx</span><span class="keyword">)
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$lines</span><span class="keyword">[</span><span class="default">$currentLine</span><span class="keyword">] .= </span><span class="string">' ' </span><span class="keyword">. </span><span class="default">$words</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">];
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; else
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$currentLine</span><span class="keyword">++;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$lines</span><span class="keyword">[</span><span class="default">$currentLine</span><span class="keyword">] = </span><span class="default">$words</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">];
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; } 
<br />
&nbsp;&nbsp;&nbsp; }
<br />
</span><span class="default">$line_count </span><span class="keyword">= </span><span class="default">1</span><span class="keyword">;
<br />
</span><span class="comment">// Loop through the lines and place them on the image
<br />
</span><span class="keyword">foreach (</span><span class="default">$lines </span><span class="keyword">as </span><span class="default">$line</span><span class="keyword">)
<br />
{
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$line_box </span><span class="keyword">= </span><span class="default">imagettfbbox</span><span class="keyword">(</span><span class="default">$main_text_size</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">$mt_f</span><span class="keyword">, </span><span class="string">"</span><span class="default">$line</span><span class="string">"</span><span class="keyword">);
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$line_width </span><span class="keyword">= </span><span class="default">$line_box</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">]+</span><span class="default">$line_box</span><span class="keyword">[</span><span class="default">2</span><span class="keyword">];
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$line_height </span><span class="keyword">= </span><span class="default">$line_box</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">]-</span><span class="default">$line_box</span><span class="keyword">[</span><span class="default">7</span><span class="keyword">];
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$line_margin </span><span class="keyword">= (</span><span class="default">$mx</span><span class="keyword">-</span><span class="default">$line_width</span><span class="keyword">)/</span><span class="default">2</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$line_y </span><span class="keyword">= ((</span><span class="default">$line_height</span><span class="keyword">+</span><span class="default">12</span><span class="keyword">) * </span><span class="default">$line_count</span><span class="keyword">);
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">imagettftext</span><span class="keyword">(</span><span class="default">$main_img</span><span class="keyword">, </span><span class="default">$main_t_s</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">$line_margin</span><span class="keyword">, </span><span class="default">$line_y</span><span class="keyword">, </span><span class="default">$main_text_color</span><span class="keyword">, </span><span class="default">$mt_f</span><span class="keyword">, </span><span class="default">$line</span><span class="keyword">);
<br />

<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// Increment Y so the next line is below the previous line
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$line_count </span><span class="keyword">++;
<br />
}
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="97357""></a>
  <div class="note">
   <strong class="user">blackbart at simail dot it</strong>
   <a href="#97357" class="date">15-Apr-2010 11:12</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I wrote a simple function that calculates the *exact* bounding box (single pixel precision).
<br />
The function returns an associative array with these keys:
<br />
left, top:&nbsp; coordinates you will pass to imagettftext 
<br />
width, height: dimension of the image you have to create
<br />

<br />
<span class="default">&lt;?php
<br />
</span><span class="keyword">function </span><span class="default">calculateTextBox</span><span class="keyword">(</span><span class="default">$font_size</span><span class="keyword">, </span><span class="default">$font_angle</span><span class="keyword">, </span><span class="default">$font_file</span><span class="keyword">, </span><span class="default">$text</span><span class="keyword">) {
<br />
&nbsp; </span><span class="default">$box&nbsp;&nbsp; </span><span class="keyword">= </span><span class="default">imagettfbbox</span><span class="keyword">(</span><span class="default">$font_size</span><span class="keyword">, </span><span class="default">$font_angle</span><span class="keyword">, </span><span class="default">$font_file</span><span class="keyword">, </span><span class="default">$text</span><span class="keyword">);
<br />
&nbsp; if( !</span><span class="default">$box </span><span class="keyword">)
<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">false</span><span class="keyword">;
<br />
&nbsp; </span><span class="default">$min_x </span><span class="keyword">= </span><span class="default">min</span><span class="keyword">( array(</span><span class="default">$box</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">], </span><span class="default">$box</span><span class="keyword">[</span><span class="default">2</span><span class="keyword">], </span><span class="default">$box</span><span class="keyword">[</span><span class="default">4</span><span class="keyword">], </span><span class="default">$box</span><span class="keyword">[</span><span class="default">6</span><span class="keyword">]) );
<br />
&nbsp; </span><span class="default">$max_x </span><span class="keyword">= </span><span class="default">max</span><span class="keyword">( array(</span><span class="default">$box</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">], </span><span class="default">$box</span><span class="keyword">[</span><span class="default">2</span><span class="keyword">], </span><span class="default">$box</span><span class="keyword">[</span><span class="default">4</span><span class="keyword">], </span><span class="default">$box</span><span class="keyword">[</span><span class="default">6</span><span class="keyword">]) );
<br />
&nbsp; </span><span class="default">$min_y </span><span class="keyword">= </span><span class="default">min</span><span class="keyword">( array(</span><span class="default">$box</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">], </span><span class="default">$box</span><span class="keyword">[</span><span class="default">3</span><span class="keyword">], </span><span class="default">$box</span><span class="keyword">[</span><span class="default">5</span><span class="keyword">], </span><span class="default">$box</span><span class="keyword">[</span><span class="default">7</span><span class="keyword">]) );
<br />
&nbsp; </span><span class="default">$max_y </span><span class="keyword">= </span><span class="default">max</span><span class="keyword">( array(</span><span class="default">$box</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">], </span><span class="default">$box</span><span class="keyword">[</span><span class="default">3</span><span class="keyword">], </span><span class="default">$box</span><span class="keyword">[</span><span class="default">5</span><span class="keyword">], </span><span class="default">$box</span><span class="keyword">[</span><span class="default">7</span><span class="keyword">]) );
<br />
&nbsp; </span><span class="default">$width&nbsp; </span><span class="keyword">= ( </span><span class="default">$max_x </span><span class="keyword">- </span><span class="default">$min_x </span><span class="keyword">);
<br />
&nbsp; </span><span class="default">$height </span><span class="keyword">= ( </span><span class="default">$max_y </span><span class="keyword">- </span><span class="default">$min_y </span><span class="keyword">);
<br />
&nbsp; </span><span class="default">$left&nbsp;&nbsp; </span><span class="keyword">= </span><span class="default">abs</span><span class="keyword">( </span><span class="default">$min_x </span><span class="keyword">) + </span><span class="default">$width</span><span class="keyword">;
<br />
&nbsp; </span><span class="default">$top&nbsp; &nbsp; </span><span class="keyword">= </span><span class="default">abs</span><span class="keyword">( </span><span class="default">$min_y </span><span class="keyword">) + </span><span class="default">$height</span><span class="keyword">;
<br />
&nbsp; </span><span class="comment">// to calculate the exact bounding box i write the text in a large image
<br />
&nbsp; </span><span class="default">$img&nbsp; &nbsp;&nbsp; </span><span class="keyword">= @</span><span class="default">imagecreatetruecolor</span><span class="keyword">( </span><span class="default">$width </span><span class="keyword">&lt;&lt; </span><span class="default">2</span><span class="keyword">, </span><span class="default">$height </span><span class="keyword">&lt;&lt; </span><span class="default">2 </span><span class="keyword">);
<br />
&nbsp; </span><span class="default">$white&nbsp;&nbsp; </span><span class="keyword">=&nbsp; </span><span class="default">imagecolorallocate</span><span class="keyword">( </span><span class="default">$img</span><span class="keyword">, </span><span class="default">255</span><span class="keyword">, </span><span class="default">255</span><span class="keyword">, </span><span class="default">255 </span><span class="keyword">);
<br />
&nbsp; </span><span class="default">$black&nbsp;&nbsp; </span><span class="keyword">=&nbsp; </span><span class="default">imagecolorallocate</span><span class="keyword">( </span><span class="default">$img</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0 </span><span class="keyword">);
<br />
&nbsp; </span><span class="default">imagefilledrectangle</span><span class="keyword">(</span><span class="default">$img</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">imagesx</span><span class="keyword">(</span><span class="default">$img</span><span class="keyword">), </span><span class="default">imagesy</span><span class="keyword">(</span><span class="default">$img</span><span class="keyword">), </span><span class="default">$black</span><span class="keyword">);
<br />
&nbsp; </span><span class="comment">// for sure the text is completely in the image!
<br />
&nbsp; </span><span class="default">imagettftext</span><span class="keyword">( </span><span class="default">$img</span><span class="keyword">, </span><span class="default">$font_size</span><span class="keyword">,
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$font_angle</span><span class="keyword">, </span><span class="default">$left</span><span class="keyword">, </span><span class="default">$top</span><span class="keyword">,
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$white</span><span class="keyword">, </span><span class="default">$font_file</span><span class="keyword">, </span><span class="default">$text</span><span class="keyword">);
<br />
&nbsp; </span><span class="comment">// start scanning (0=&gt; black =&gt; empty)
<br />
&nbsp; </span><span class="default">$rleft&nbsp; </span><span class="keyword">= </span><span class="default">$w4 </span><span class="keyword">= </span><span class="default">$width</span><span class="keyword">&lt;&lt;</span><span class="default">2</span><span class="keyword">;
<br />
&nbsp; </span><span class="default">$rright </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;
<br />
&nbsp; </span><span class="default">$rbottom&nbsp;&nbsp; </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;
<br />
&nbsp; </span><span class="default">$rtop </span><span class="keyword">= </span><span class="default">$h4 </span><span class="keyword">= </span><span class="default">$height</span><span class="keyword">&lt;&lt;</span><span class="default">2</span><span class="keyword">;
<br />
&nbsp; for( </span><span class="default">$x </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">; </span><span class="default">$x </span><span class="keyword">&lt; </span><span class="default">$w4</span><span class="keyword">; </span><span class="default">$x</span><span class="keyword">++ )
<br />
&nbsp;&nbsp;&nbsp; for( </span><span class="default">$y </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">; </span><span class="default">$y </span><span class="keyword">&lt; </span><span class="default">$h4</span><span class="keyword">; </span><span class="default">$y</span><span class="keyword">++ )
<br />
&nbsp;&nbsp; &nbsp;&nbsp; if( </span><span class="default">imagecolorat</span><span class="keyword">( </span><span class="default">$img</span><span class="keyword">, </span><span class="default">$x</span><span class="keyword">, </span><span class="default">$y </span><span class="keyword">) ){
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$rleft&nbsp;&nbsp; </span><span class="keyword">= </span><span class="default">min</span><span class="keyword">( </span><span class="default">$rleft</span><span class="keyword">, </span><span class="default">$x </span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$rright&nbsp; </span><span class="keyword">= </span><span class="default">max</span><span class="keyword">( </span><span class="default">$rright</span><span class="keyword">, </span><span class="default">$x </span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$rtop&nbsp; &nbsp; </span><span class="keyword">= </span><span class="default">min</span><span class="keyword">( </span><span class="default">$rtop</span><span class="keyword">, </span><span class="default">$y </span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$rbottom </span><span class="keyword">= </span><span class="default">max</span><span class="keyword">( </span><span class="default">$rbottom</span><span class="keyword">, </span><span class="default">$y </span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp;&nbsp; }
<br />
&nbsp; </span><span class="comment">// destroy img and serve the result
<br />
&nbsp; </span><span class="default">imagedestroy</span><span class="keyword">( </span><span class="default">$img </span><span class="keyword">);
<br />
&nbsp; return array( </span><span class="string">"left"&nbsp;&nbsp; </span><span class="keyword">=&gt; </span><span class="default">$left </span><span class="keyword">- </span><span class="default">$rleft</span><span class="keyword">,
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">"top"&nbsp; &nbsp; </span><span class="keyword">=&gt; </span><span class="default">$top&nbsp; </span><span class="keyword">- </span><span class="default">$rtop</span><span class="keyword">,
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">"width"&nbsp; </span><span class="keyword">=&gt; </span><span class="default">$rright </span><span class="keyword">- </span><span class="default">$rleft </span><span class="keyword">+ </span><span class="default">1</span><span class="keyword">,
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">"height" </span><span class="keyword">=&gt; </span><span class="default">$rbottom </span><span class="keyword">- </span><span class="default">$rtop </span><span class="keyword">+ </span><span class="default">1 </span><span class="keyword">);
<br />
}
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="97211""></a>
  <div class="note">
   <strong class="user">peterjwest3 at gmail dot com</strong>
   <a href="#97211" class="date">08-Apr-2010 06:18</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
As many of you know, this function is bugged in several versions of PHP. It should return the coordinates relative to the baseline of the font. So if your text includes characters like g and p then the bounding box should extend below zero on the Y axis, however it doesn't. This is a problem because imagettftext() positions text using the baseline, so all your text will be misaligned.<br />
<br />
My solution is to create an image of the desired font and font-size using all ascii characters with imagettfbbox() and imagettftext(). The height of this image is used as the height for the real image.<br />
<br />
I then analyse the image to get the vertical offset of the text (the background color should be $baseColor)<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">function </span><span class="default">getYOffset</span><span class="keyword">(</span><span class="default">$image</span><span class="keyword">, </span><span class="default">$baseColor</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; for(</span><span class="default">$y </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">; </span><span class="default">$y </span><span class="keyword">&lt; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">height</span><span class="keyword">(); </span><span class="default">$y</span><span class="keyword">++)<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; for(</span><span class="default">$x </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">; </span><span class="default">$x </span><span class="keyword">&lt; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">width</span><span class="keyword">(); </span><span class="default">$x</span><span class="keyword">++)<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">imagecolorat</span><span class="keyword">(</span><span class="default">$image</span><span class="keyword">, </span><span class="default">$x</span><span class="keyword">, </span><span class="default">$y</span><span class="keyword">) !== </span><span class="default">$baseColor</span><span class="keyword">) <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">$y</span><span class="keyword">; }<br />
</span><span class="default">?&gt;<br />
</span><br />
This offset can be used as the baseline for the font (for this font-size). You can use a similar trick for the horizontal offset, but that changes depending on the first character.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="93088""></a>
  <div class="note">
   <strong class="user">hkc@taiwan</strong>
   <a href="#93088" class="date">22-Aug-2009 12:57</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I want to output a bounding box of a text as an image straightly. I did like this:<br />
<br />
<span class="default">&lt;?php<br />
<br />
$text </span><span class="keyword">= </span><span class="string">"&lt;?php echo \"hello, world\"; ?&gt;"</span><span class="keyword">;<br />
</span><span class="default">$font </span><span class="keyword">= </span><span class="string">"./arial.ttf"</span><span class="keyword">;<br />
</span><span class="default">$size </span><span class="keyword">= </span><span class="string">"60"</span><span class="keyword">;<br />
<br />
</span><span class="default">$bbox </span><span class="keyword">= </span><span class="default">imagettfbbox</span><span class="keyword">(</span><span class="default">$size</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">$font</span><span class="keyword">, </span><span class="default">$text</span><span class="keyword">);<br />
<br />
</span><span class="default">$width </span><span class="keyword">= </span><span class="default">abs</span><span class="keyword">(</span><span class="default">$bbox</span><span class="keyword">[</span><span class="default">2</span><span class="keyword">] - </span><span class="default">$bbox</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">]);<br />
</span><span class="default">$height </span><span class="keyword">= </span><span class="default">abs</span><span class="keyword">(</span><span class="default">$bbox</span><span class="keyword">[</span><span class="default">7</span><span class="keyword">] - </span><span class="default">$bbox</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">]);<br />
<br />
</span><span class="default">$image </span><span class="keyword">= </span><span class="default">imagecreatetruecolor</span><span class="keyword">(</span><span class="default">$width</span><span class="keyword">, </span><span class="default">$height</span><span class="keyword">);<br />
<br />
</span><span class="default">$bgcolor </span><span class="keyword">= </span><span class="default">imagecolorallocate</span><span class="keyword">(</span><span class="default">$image</span><span class="keyword">, </span><span class="default">255</span><span class="keyword">, </span><span class="default">255</span><span class="keyword">, </span><span class="default">255</span><span class="keyword">);<br />
</span><span class="default">$color </span><span class="keyword">= </span><span class="default">imagecolorallocate</span><span class="keyword">(</span><span class="default">$image</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">);<br />
<br />
</span><span class="default">$x </span><span class="keyword">= </span><span class="default">$bbox</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">] + (</span><span class="default">$width </span><span class="keyword">/ </span><span class="default">2</span><span class="keyword">) - (</span><span class="default">$bbox</span><span class="keyword">[</span><span class="default">4</span><span class="keyword">] / </span><span class="default">2</span><span class="keyword">);<br />
</span><span class="default">$y </span><span class="keyword">= </span><span class="default">$bbox</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">] + (</span><span class="default">$height </span><span class="keyword">/ </span><span class="default">2</span><span class="keyword">) - (</span><span class="default">$bbox</span><span class="keyword">[</span><span class="default">5</span><span class="keyword">] / </span><span class="default">2</span><span class="keyword">);<br />
<br />
</span><span class="default">imagefilledrectangle</span><span class="keyword">(</span><span class="default">$image</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">$width </span><span class="keyword">- </span><span class="default">1</span><span class="keyword">, </span><span class="default">$height </span><span class="keyword">- </span><span class="default">1</span><span class="keyword">, </span><span class="default">$bgcolor</span><span class="keyword">);<br />
</span><span class="default">imagettftext</span><span class="keyword">(</span><span class="default">$image</span><span class="keyword">, </span><span class="default">$size</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">$x</span><span class="keyword">, </span><span class="default">$y</span><span class="keyword">, </span><span class="default">$color</span><span class="keyword">, </span><span class="default">$font</span><span class="keyword">, </span><span class="default">$text</span><span class="keyword">);<br />
<br />
</span><span class="default">$last_pixel</span><span class="keyword">= </span><span class="default">imagecolorat</span><span class="keyword">(</span><span class="default">$image</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">);<br />
<br />
for (</span><span class="default">$j </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">; </span><span class="default">$j </span><span class="keyword">&lt; </span><span class="default">$height</span><span class="keyword">; </span><span class="default">$j</span><span class="keyword">++)<br />
{<br />
&nbsp;&nbsp;&nbsp; for (</span><span class="default">$i </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">; </span><span class="default">$i </span><span class="keyword">&lt; </span><span class="default">$width</span><span class="keyword">; </span><span class="default">$i</span><span class="keyword">++)<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (isset(</span><span class="default">$blank_left</span><span class="keyword">) &amp;&amp; </span><span class="default">$i </span><span class="keyword">&gt;= </span><span class="default">$blank_left</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; break;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">imagecolorat</span><span class="keyword">(</span><span class="default">$image</span><span class="keyword">, </span><span class="default">$i</span><span class="keyword">, </span><span class="default">$j</span><span class="keyword">) !== </span><span class="default">$last_pixel</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (!isset(</span><span class="default">$blank_top</span><span class="keyword">))<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$blank_top </span><span class="keyword">= </span><span class="default">$j</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$blank_left </span><span class="keyword">= </span><span class="default">$i</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; break;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$last_pixel </span><span class="keyword">= </span><span class="default">imagecolorat</span><span class="keyword">(</span><span class="default">$image</span><span class="keyword">, </span><span class="default">$i</span><span class="keyword">, </span><span class="default">$j</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }<br />
}<br />
<br />
</span><span class="default">$x </span><span class="keyword">-= </span><span class="default">$blank_left</span><span class="keyword">;<br />
</span><span class="default">$y </span><span class="keyword">-= </span><span class="default">$blank_top</span><span class="keyword">;<br />
<br />
</span><span class="default">imagefilledrectangle</span><span class="keyword">(</span><span class="default">$image</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">$width </span><span class="keyword">- </span><span class="default">1</span><span class="keyword">, </span><span class="default">$height </span><span class="keyword">- </span><span class="default">1</span><span class="keyword">, </span><span class="default">$bgcolor</span><span class="keyword">);<br />
</span><span class="default">imagettftext</span><span class="keyword">(</span><span class="default">$image</span><span class="keyword">, </span><span class="default">$size</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">$x</span><span class="keyword">, </span><span class="default">$y</span><span class="keyword">, </span><span class="default">$color</span><span class="keyword">, </span><span class="default">$font</span><span class="keyword">, </span><span class="default">$text</span><span class="keyword">);<br />
<br />
</span><span class="default">header</span><span class="keyword">(</span><span class="string">'Content-type: image/png'</span><span class="keyword">);<br />
</span><span class="default">imagepng</span><span class="keyword">(</span><span class="default">$image</span><span class="keyword">);<br />
</span><span class="default">imagedestroy</span><span class="keyword">(</span><span class="default">$image</span><span class="keyword">);<br />
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="90720""></a>
  <div class="note">
   <strong class="user">Dario</strong>
   <a href="#90720" class="date">05-May-2009 07:09</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
My solution to below-baseline characters is to simply apply a smaller angle and some padding when calculating your boundaries, so the function thinks your text goes below baseline. For example: 
<br />

<br />
<span class="default">&lt;?php
<br />
</span><span class="comment">// GET BOUNDS OF TEXT
<br />
</span><span class="default">$bounds </span><span class="keyword">= </span><span class="default">imagettfbbox</span><span class="keyword">(</span><span class="default">$size</span><span class="keyword">*</span><span class="default">1.05</span><span class="keyword">, </span><span class="default">$angle</span><span class="keyword">-</span><span class="default">3</span><span class="keyword">, </span><span class="default">$font</span><span class="keyword">, </span><span class="default">$text</span><span class="keyword">);
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="86854""></a>
  <div class="note">
   <strong class="user">Anonymous</strong>
   <a href="#86854" class="date">06-Nov-2008 11:18</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
SIMPLE OVERLOADED FUNCTION: Adds TTF Center and Right Alignment to co ordintate points.
<br />
Correctly demonstrates the use of the bouning box TTF function and the array of coordinates that it returns.
<br />

<br />
After obtaining values and adjusting based on a set of values [L, C, R], it uses simple math based of the length of the text to move it from the origin (x = 0 )
<br />

<br />
<span class="default">&lt;?php
<br />
</span><span class="keyword">function </span><span class="default">imagettftextalign</span><span class="keyword">(</span><span class="default">$image</span><span class="keyword">, </span><span class="default">$size</span><span class="keyword">, </span><span class="default">$angle</span><span class="keyword">, </span><span class="default">$x</span><span class="keyword">, </span><span class="default">$y</span><span class="keyword">, </span><span class="default">$color</span><span class="keyword">, </span><span class="default">$font</span><span class="keyword">, </span><span class="default">$text</span><span class="keyword">, </span><span class="default">$alignment</span><span class="keyword">=</span><span class="string">'L'</span><span class="keyword">)
<br />
{
<br />

<br />
&nbsp;&nbsp; </span><span class="comment">//check width of the text
<br />
&nbsp;&nbsp; </span><span class="default">$bbox </span><span class="keyword">= </span><span class="default">imagettfbbox </span><span class="keyword">(</span><span class="default">$size</span><span class="keyword">, </span><span class="default">$angle</span><span class="keyword">, </span><span class="default">$font</span><span class="keyword">, </span><span class="default">$text</span><span class="keyword">);
<br />
&nbsp;&nbsp; </span><span class="default">$textWidth </span><span class="keyword">= </span><span class="default">$bbox</span><span class="keyword">[</span><span class="default">2</span><span class="keyword">] - </span><span class="default">$bbox</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">];
<br />
&nbsp;&nbsp; switch (</span><span class="default">$alignment</span><span class="keyword">) {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; case </span><span class="string">"R"</span><span class="keyword">:
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$x </span><span class="keyword">-= </span><span class="default">$textWidth</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; break;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; case </span><span class="string">"C"</span><span class="keyword">:
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$x </span><span class="keyword">-= </span><span class="default">$textWidth </span><span class="keyword">/ </span><span class="default">2</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; break;
<br />
&nbsp;&nbsp; }
<br />

<br />
&nbsp;&nbsp; </span><span class="comment">//write text
<br />
&nbsp;&nbsp; </span><span class="default">imagettftext </span><span class="keyword">(</span><span class="default">$image</span><span class="keyword">, </span><span class="default">$size</span><span class="keyword">, </span><span class="default">$angle</span><span class="keyword">, </span><span class="default">$x</span><span class="keyword">, </span><span class="default">$y</span><span class="keyword">, </span><span class="default">$color</span><span class="keyword">, </span><span class="default">$font</span><span class="keyword">, </span><span class="default">$text</span><span class="keyword">);
<br />

<br />
}
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="86134""></a>
  <div class="note">
   <strong class="user">decimealgo at gmail dot com</strong>
   <a href="#86134" class="date">04-Oct-2008 10:11</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
This is a function which reformats a text string into a text block of a given width.
<br />
Usefull when you have a long single line string and want to fit it into a fixed width but don't care about it's height
<br />

<br />
<span class="default">&lt;?php
<br />
</span><span class="keyword">function </span><span class="default">makeTextBlock</span><span class="keyword">(</span><span class="default">$text</span><span class="keyword">, </span><span class="default">$fontfile</span><span class="keyword">, </span><span class="default">$fontsize</span><span class="keyword">, </span><span class="default">$width</span><span class="keyword">)
<br />
{&nbsp; &nbsp; 
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$words </span><span class="keyword">= </span><span class="default">explode</span><span class="keyword">(</span><span class="string">' '</span><span class="keyword">, </span><span class="default">$text</span><span class="keyword">);
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$lines </span><span class="keyword">= array(</span><span class="default">$words</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">]);
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$currentLine </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; for(</span><span class="default">$i </span><span class="keyword">= </span><span class="default">1</span><span class="keyword">; </span><span class="default">$i </span><span class="keyword">&lt; </span><span class="default">count</span><span class="keyword">(</span><span class="default">$words</span><span class="keyword">); </span><span class="default">$i</span><span class="keyword">++)
<br />
&nbsp;&nbsp;&nbsp; {
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$lineSize </span><span class="keyword">= </span><span class="default">imagettfbbox</span><span class="keyword">(</span><span class="default">$fontsize</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">$fontfile</span><span class="keyword">, </span><span class="default">$lines</span><span class="keyword">[</span><span class="default">$currentLine</span><span class="keyword">] . </span><span class="string">' ' </span><span class="keyword">. </span><span class="default">$words</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">]);
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">$lineSize</span><span class="keyword">[</span><span class="default">2</span><span class="keyword">] - </span><span class="default">$lineSize</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">] &lt; </span><span class="default">$width</span><span class="keyword">)
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$lines</span><span class="keyword">[</span><span class="default">$currentLine</span><span class="keyword">] .= </span><span class="string">' ' </span><span class="keyword">. </span><span class="default">$words</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">];
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; else
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$currentLine</span><span class="keyword">++;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$lines</span><span class="keyword">[</span><span class="default">$currentLine</span><span class="keyword">] = </span><span class="default">$words</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">];
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }
<br />
&nbsp;&nbsp;&nbsp; }
<br />
&nbsp;&nbsp;&nbsp; 
<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">implode</span><span class="keyword">(</span><span class="string">"\n"</span><span class="keyword">, </span><span class="default">$lines</span><span class="keyword">);
<br />
}
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="85266""></a>
  <div class="note">
   <strong class="user">beosman at gmail dot com</strong>
   <a href="#85266" class="date">22-Aug-2008 09:00</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I was viewing the code for calculate the box of a text for a given font but I do not found one that works fine with different angles from zero, so I have made a function simpler than above:<br />
<br />
<span class="default">&lt;?php<br />
<br />
</span><span class="keyword">function </span><span class="default">calculateTextBox</span><span class="keyword">(</span><span class="default">$text</span><span class="keyword">,</span><span class="default">$fontFile</span><span class="keyword">,</span><span class="default">$fontSize</span><span class="keyword">,</span><span class="default">$fontAngle</span><span class="keyword">) {<br />
&nbsp; </span><span class="default">$rect </span><span class="keyword">= </span><span class="default">imagettfbbox</span><span class="keyword">(</span><span class="default">$fontSize</span><span class="keyword">,</span><span class="default">$fontAngle</span><span class="keyword">,</span><span class="default">$fontFile</span><span class="keyword">,</span><span class="default">$text</span><span class="keyword">);<br />
&nbsp; <br />
&nbsp; </span><span class="default">$minX </span><span class="keyword">= </span><span class="default">min</span><span class="keyword">(array(</span><span class="default">$rect</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">],</span><span class="default">$rect</span><span class="keyword">[</span><span class="default">2</span><span class="keyword">],</span><span class="default">$rect</span><span class="keyword">[</span><span class="default">4</span><span class="keyword">],</span><span class="default">$rect</span><span class="keyword">[</span><span class="default">6</span><span class="keyword">]));<br />
&nbsp; </span><span class="default">$maxX </span><span class="keyword">= </span><span class="default">max</span><span class="keyword">(array(</span><span class="default">$rect</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">],</span><span class="default">$rect</span><span class="keyword">[</span><span class="default">2</span><span class="keyword">],</span><span class="default">$rect</span><span class="keyword">[</span><span class="default">4</span><span class="keyword">],</span><span class="default">$rect</span><span class="keyword">[</span><span class="default">6</span><span class="keyword">]));<br />
&nbsp; </span><span class="default">$minY </span><span class="keyword">= </span><span class="default">min</span><span class="keyword">(array(</span><span class="default">$rect</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">],</span><span class="default">$rect</span><span class="keyword">[</span><span class="default">3</span><span class="keyword">],</span><span class="default">$rect</span><span class="keyword">[</span><span class="default">5</span><span class="keyword">],</span><span class="default">$rect</span><span class="keyword">[</span><span class="default">7</span><span class="keyword">]));<br />
&nbsp; </span><span class="default">$maxY </span><span class="keyword">= </span><span class="default">max</span><span class="keyword">(array(</span><span class="default">$rect</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">],</span><span class="default">$rect</span><span class="keyword">[</span><span class="default">3</span><span class="keyword">],</span><span class="default">$rect</span><span class="keyword">[</span><span class="default">5</span><span class="keyword">],</span><span class="default">$rect</span><span class="keyword">[</span><span class="default">7</span><span class="keyword">]));<br />
<br />
&nbsp; return array(<br />
&nbsp;&nbsp;&nbsp; </span><span class="string">"left"&nbsp;&nbsp; </span><span class="keyword">=&gt; </span><span class="default">abs</span><span class="keyword">(</span><span class="default">$minX</span><span class="keyword">),<br />
&nbsp;&nbsp;&nbsp; </span><span class="string">"top"&nbsp; &nbsp; </span><span class="keyword">=&gt; </span><span class="default">abs</span><span class="keyword">(</span><span class="default">$minY</span><span class="keyword">),<br />
&nbsp;&nbsp;&nbsp; </span><span class="string">"width"&nbsp; </span><span class="keyword">=&gt; </span><span class="default">$maxX </span><span class="keyword">- </span><span class="default">$minX</span><span class="keyword">,<br />
&nbsp;&nbsp;&nbsp; </span><span class="string">"height" </span><span class="keyword">=&gt; </span><span class="default">$maxY </span><span class="keyword">- </span><span class="default">$minY</span><span class="keyword">,<br />
&nbsp;&nbsp;&nbsp; </span><span class="string">"box"&nbsp; &nbsp; </span><span class="keyword">=&gt; </span><span class="default">$rect<br />
&nbsp; </span><span class="keyword">);<br />
}<br />
<br />
</span><span class="default">?&gt;<br />
</span><br />
With this function you can center an angled string in any image:<br />
<br />
<span class="default">&lt;?php<br />
<br />
&nbsp; $mystring </span><span class="keyword">= </span><span class="string">"Hello world!"</span><span class="keyword">;<br />
<br />
&nbsp; </span><span class="default">$imgWidth </span><span class="keyword">= </span><span class="default">300</span><span class="keyword">;<br />
&nbsp; </span><span class="default">$imgHeight </span><span class="keyword">= </span><span class="default">150</span><span class="keyword">;&nbsp; <br />
<br />
&nbsp; </span><span class="default">$image </span><span class="keyword">= </span><span class="default">imagecreate</span><span class="keyword">(</span><span class="default">$imgWidth</span><span class="keyword">,</span><span class="default">$imgHeight</span><span class="keyword">);<br />
&nbsp; </span><span class="default">imagefill</span><span class="keyword">(</span><span class="default">$image</span><span class="keyword">,</span><span class="default">imagecolorallocate</span><span class="keyword">(</span><span class="default">$image</span><span class="keyword">,</span><span class="default">200</span><span class="keyword">,</span><span class="default">200</span><span class="keyword">,</span><span class="default">200</span><span class="keyword">));<br />
<br />
&nbsp; </span><span class="default">$box </span><span class="keyword">= </span><span class="default">calculateTextBox</span><span class="keyword">(</span><span class="default">$mystring</span><span class="keyword">,</span><span class="string">"./Verdana.ttf"</span><span class="keyword">,</span><span class="default">15</span><span class="keyword">,</span><span class="default">45</span><span class="keyword">);<br />
&nbsp; </span><span class="default">$color </span><span class="keyword">= </span><span class="default">imagecolorallocate</span><span class="keyword">(</span><span class="default">$image</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">);<br />
&nbsp; </span><span class="default">imagettftext</span><span class="keyword">(</span><span class="default">$image</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">15</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">45</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$box</span><span class="keyword">[</span><span class="string">"left"</span><span class="keyword">] + (</span><span class="default">$imgWidth </span><span class="keyword">/ </span><span class="default">2</span><span class="keyword">) - (</span><span class="default">$box</span><span class="keyword">[</span><span class="string">"width"</span><span class="keyword">] / </span><span class="default">2</span><span class="keyword">),<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$box</span><span class="keyword">[</span><span class="string">"top"</span><span class="keyword">] + (</span><span class="default">$imgHeight </span><span class="keyword">/ </span><span class="default">2</span><span class="keyword">) - (</span><span class="default">$box</span><span class="keyword">[</span><span class="string">"height"</span><span class="keyword">] / </span><span class="default">2</span><span class="keyword">),<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$color</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="string">"./Verdana.ttf"</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$mystring</span><span class="keyword">);<br />
<br />
&nbsp; </span><span class="default">header</span><span class="keyword">(</span><span class="string">"Content-Type: image/x-png"</span><span class="keyword">);<br />
&nbsp; </span><span class="default">imagepng</span><span class="keyword">(</span><span class="default">$im</span><span class="keyword">);<br />
&nbsp; </span><span class="default">imagedestroy</span><span class="keyword">(</span><span class="default">$im</span><span class="keyword">);<br />
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="83536""></a>
  <div class="note">
   <strong class="user">Stefan at colulus dot com</strong>
   <a href="#83536" class="date">30-May-2008 11:13</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I worked out a script that allows the transfer of alphanumeric data to be placed on an image. The HTML feature is img src and the php feature is imagettftext. This simple code will increment from 1 to 3 on images.<br />
<br />
code:<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="comment">//ImageCall.php -- This script will call a script to produce the image.<br />
</span><span class="keyword">for(</span><span class="default">$next </span><span class="keyword">= </span><span class="default">1</span><span class="keyword">;</span><span class="default">$next </span><span class="keyword">&lt; </span><span class="default">4</span><span class="keyword">; </span><span class="default">$next</span><span class="keyword">++){<br />
print </span><span class="string">"Image </span><span class="default">$next</span><span class="string">:&lt;br&gt;"</span><span class="keyword">;<br />
print </span><span class="string">"&lt;img src = 'Image.php?\$text=</span><span class="default">$next</span><span class="string">'&gt;"</span><span class="keyword">;<br />
print </span><span class="string">"&lt;br&gt;&lt;br&gt;"</span><span class="keyword">;<br />
}<br />
</span><span class="default">?&gt;<br />
</span><br />
<span class="default">&lt;?php<br />
</span><span class="comment">//Image.php -- This script creates a square image and places the text on it.<br />
<br />
// image size and color<br />
</span><span class="default">$im </span><span class="keyword">= </span><span class="default">ImageCreate</span><span class="keyword">(</span><span class="default">77</span><span class="keyword">,</span><span class="default">77</span><span class="keyword">);<br />
</span><span class="default">$color1 </span><span class="keyword">= </span><span class="default">ImageColorAllocate</span><span class="keyword">(</span><span class="default">$im</span><span class="keyword">,</span><span class="default">0x66</span><span class="keyword">,</span><span class="default">0xCC</span><span class="keyword">,</span><span class="default">0x00</span><span class="keyword">);<br />
</span><span class="default">$color2 </span><span class="keyword">= </span><span class="default">ImageColorAllocate</span><span class="keyword">(</span><span class="default">$im</span><span class="keyword">,</span><span class="default">0x33</span><span class="keyword">,</span><span class="default">0x66</span><span class="keyword">,</span><span class="default">0x00</span><span class="keyword">);<br />
</span><span class="default">$color3 </span><span class="keyword">= </span><span class="default">ImageColorAllocate</span><span class="keyword">(</span><span class="default">$im</span><span class="keyword">,</span><span class="default">0x00</span><span class="keyword">,</span><span class="default">0x99</span><span class="keyword">,</span><span class="default">0x00</span><span class="keyword">);<br />
</span><span class="default">$color4 </span><span class="keyword">= </span><span class="default">ImageColorAllocate</span><span class="keyword">(</span><span class="default">$im</span><span class="keyword">,</span><span class="default">0x3D</span><span class="keyword">,</span><span class="default">0x3D</span><span class="keyword">,</span><span class="default">0x3D</span><span class="keyword">);<br />
<br />
</span><span class="comment">// image creation<br />
</span><span class="default">ImageFilledRectangle</span><span class="keyword">(</span><span class="default">$im</span><span class="keyword">,</span><span class="default">1</span><span class="keyword">,</span><span class="default">1</span><span class="keyword">,</span><span class="default">76</span><span class="keyword">,</span><span class="default">76</span><span class="keyword">,</span><span class="default">$color1</span><span class="keyword">);<br />
</span><span class="default">ImageFilledpolygon</span><span class="keyword">(</span><span class="default">$im</span><span class="keyword">, array (</span><span class="default">76</span><span class="keyword">,</span><span class="default">1</span><span class="keyword">,</span><span class="default">1</span><span class="keyword">,</span><span class="default">76</span><span class="keyword">,</span><span class="default">76</span><span class="keyword">,</span><span class="default">76</span><span class="keyword">),</span><span class="default">3</span><span class="keyword">,</span><span class="default">$color2</span><span class="keyword">);<br />
</span><span class="default">ImageFilledRectangle</span><span class="keyword">(</span><span class="default">$im</span><span class="keyword">,</span><span class="default">5</span><span class="keyword">,</span><span class="default">5</span><span class="keyword">,</span><span class="default">72</span><span class="keyword">,</span><span class="default">72</span><span class="keyword">,</span><span class="default">$color3</span><span class="keyword">);<br />
<br />
</span><span class="comment">// determine numeric center of image<br />
</span><span class="default">$size </span><span class="keyword">= </span><span class="default">ImageTTFBBox</span><span class="keyword">(</span><span class="default">45</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="string">'impact'</span><span class="keyword">,</span><span class="default">$_GET</span><span class="keyword">[</span><span class="string">'$text'</span><span class="keyword">]);<br />
</span><span class="default">$X </span><span class="keyword">= (</span><span class="default">77 </span><span class="keyword">- (</span><span class="default">abs</span><span class="keyword">(</span><span class="default">$size</span><span class="keyword">[</span><span class="default">2</span><span class="keyword">]- </span><span class="default">$size</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">])))/</span><span class="default">2</span><span class="keyword">;<br />
</span><span class="default">$Y </span><span class="keyword">= ((</span><span class="default">77 </span><span class="keyword">- (</span><span class="default">abs</span><span class="keyword">(</span><span class="default">$size</span><span class="keyword">[</span><span class="default">5</span><span class="keyword">] - </span><span class="default">$size</span><span class="keyword">[</span><span class="default">3</span><span class="keyword">])))/</span><span class="default">2 </span><span class="keyword">+ (</span><span class="default">abs</span><span class="keyword">(</span><span class="default">$size</span><span class="keyword">[</span><span class="default">5</span><span class="keyword">] - </span><span class="default">$size</span><span class="keyword">[</span><span class="default">3</span><span class="keyword">])));<br />
<br />
</span><span class="comment">//places numeric information on image<br />
</span><span class="default">ImageTTFText</span><span class="keyword">(</span><span class="default">$im</span><span class="keyword">,</span><span class="default">45</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,(</span><span class="default">$X</span><span class="keyword">-</span><span class="default">1</span><span class="keyword">),</span><span class="default">$Y</span><span class="keyword">,</span><span class="default">$color4</span><span class="keyword">,</span><span class="string">'impact'</span><span class="keyword">,</span><span class="default">$_GET</span><span class="keyword">[</span><span class="string">'$text'</span><span class="keyword">]);<br />
<br />
</span><span class="comment">//returns completed image to calling script<br />
</span><span class="default">Header</span><span class="keyword">(</span><span class="string">'Content-Type: image/png'</span><span class="keyword">);<br />
</span><span class="default">Imagepng</span><span class="keyword">(</span><span class="default">$im</span><span class="keyword">);<br />
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="83249""></a>
  <div class="note">
   <strong class="user">Valentijn de Pagter</strong>
   <a href="#83249" class="date">16-May-2008 10:14</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you're looking for easy text alignment, you need to use the imagettfbbox() command. When given the correct parameters, it will return the boundaries of your to-be-made text field in an array, which will allow you to calculate the x and y coordinate that you need to use for centering or aligning your text.<br />
<br />
A horizontal centering example:<br />
<br />
<span class="default">&lt;?php<br />
<br />
$tb </span><span class="keyword">= </span><span class="default">imagettfbbox</span><span class="keyword">(</span><span class="default">17</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="string">'airlock.ttf'</span><span class="keyword">, </span><span class="string">'Hello world!'</span><span class="keyword">);<br />
<br />
</span><span class="default">?&gt;<br />
</span><br />
$tb would contain:<br />
<br />
Array<br />
(<br />
&nbsp;&nbsp;&nbsp; [0] =&gt; 0 // lower left X coordinate<br />
&nbsp;&nbsp;&nbsp; [1] =&gt; -1 // lower left Y coordinate<br />
&nbsp;&nbsp;&nbsp; [2] =&gt; 198 // lower right X coordinate<br />
&nbsp;&nbsp;&nbsp; [3] =&gt; -1 // lower right Y coordinate<br />
&nbsp;&nbsp;&nbsp; [4] =&gt; 198 // upper right X coordinate<br />
&nbsp;&nbsp;&nbsp; [5] =&gt; -20 // upper right Y coordinate<br />
&nbsp;&nbsp;&nbsp; [6] =&gt; 0 // upper left X coordinate<br />
&nbsp;&nbsp;&nbsp; [7] =&gt; -20 // upper left Y coordinate<br />
)<br />
<br />
For horizontal alignment, we need to substract the "text box's" width { $tb[2] or $tb[4] } from the image's width and then substract by two.<br />
<br />
Saying you have a 200px wide image, you could do something like this:<br />
<br />
<span class="default">&lt;?php<br />
<br />
$x </span><span class="keyword">= </span><span class="default">ceil</span><span class="keyword">((</span><span class="default">200 </span><span class="keyword">- </span><span class="default">$tb</span><span class="keyword">[</span><span class="default">2</span><span class="keyword">]) / </span><span class="default">2</span><span class="keyword">); </span><span class="comment">// lower left X coordinate for text<br />
</span><span class="default">imagettftext</span><span class="keyword">(</span><span class="default">$im</span><span class="keyword">, </span><span class="default">17</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">$x</span><span class="keyword">, </span><span class="default">$y</span><span class="keyword">, </span><span class="default">$tc</span><span class="keyword">, </span><span class="string">'airlock.ttf'</span><span class="keyword">, </span><span class="string">'Hello world!'</span><span class="keyword">); </span><span class="comment">// write text to image<br />
<br />
</span><span class="default">?&gt;<br />
</span><br />
This'll give you perfect horizontal center alignment for your text, give or take 1 pixel. Have fun!</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="82518""></a>
  <div class="note">
   <strong class="user">mihai.draghicioiu at gmailcom</strong>
   <a href="#82518" class="date">14-Apr-2008 03:57</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
To get the height for a line of text, I've found it useful to do:<br />
<br />
<span class="default">&lt;?php<br />
<br />
$bbox </span><span class="keyword">= </span><span class="default">imagettfbbox</span><span class="keyword">(</span><span class="default">$size</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">$ttf</span><span class="keyword">, </span><span class="string">" \n "</span><span class="keyword">); </span><span class="comment">// space, newline, space<br />
<br />
</span><span class="default">$height </span><span class="keyword">= </span><span class="default">$bbox</span><span class="keyword">[</span><span class="default">3</span><span class="keyword">] - </span><span class="default">$bbox</span><span class="keyword">[</span><span class="default">5</span><span class="keyword">];<br />
<br />
</span><span class="default">?&gt;<br />
</span><br />
I hope this helps. Before, I used the string "Tj", but that sometimes fell short, especially for crazy fonts.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="80265""></a>
  <div class="note">
   <strong class="user">heshan at sjtu dot edu dot cn</strong>
   <a href="#80265" class="date">07-Jan-2008 04:18</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
the imagettfbbox and imagettftext quirks are:<br />
<br />
1. imagettfbbox and imagettftext have the same return value and both of them are wrong for angle not equal to zero.<br />
2. imagettfbbox returns the correct bounding box when angle is zero.<br />
3. the bounding box has a coordinate system that the x gets bigger from left to right and y gets bigger from top to bottom.<br />
4. the "base point" used in imagettftext is the origin in the bounding box coordinate system.<br />
5. when the angle is other than 0, it is actually rotated in the coordinate system with respect to the base point. so if we know the bounding box coordinate when angle is zero, we can get the new bounding box coordinate by doing the rotation by math equations manually.<br />
6. to have pixel level accuracy, we should also be aware of another thing. suppose the axis is like this: |_|_|_|, the bounding box coordinate uses point on the vertical line while image function uses point on the horizontal line, so there is a 1 pixel difference you should take care of.<br />
<br />
The following snippet creates minimal images containing a letter of different font and rotation angle. This is especially useful in captcha scripts.<br />
<br />
<span class="default">&lt;?php<br />
<br />
</span><span class="keyword">function </span><span class="default">create_font_image</span><span class="keyword">( </span><span class="default">$size</span><span class="keyword">, </span><span class="default">$angle</span><span class="keyword">, </span><span class="default">$font</span><span class="keyword">, </span><span class="default">$char </span><span class="keyword">)<br />
{<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$rect </span><span class="keyword">= </span><span class="default">imagettfbbox</span><span class="keyword">( </span><span class="default">$size</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">$font</span><span class="keyword">, </span><span class="default">$char </span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; if( </span><span class="default">0 </span><span class="keyword">== </span><span class="default">$angle </span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$imh </span><span class="keyword">= </span><span class="default">$rect</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">] - </span><span class="default">$rect</span><span class="keyword">[</span><span class="default">7</span><span class="keyword">];<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$imw </span><span class="keyword">= </span><span class="default">$rect</span><span class="keyword">[</span><span class="default">2</span><span class="keyword">] - </span><span class="default">$rect</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">];<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$bx </span><span class="keyword">= -</span><span class="default">1 </span><span class="keyword">- </span><span class="default">$rect</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">];<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$by </span><span class="keyword">= -</span><span class="default">1 </span><span class="keyword">- </span><span class="default">$rect</span><span class="keyword">[</span><span class="default">7</span><span class="keyword">];<br />
&nbsp;&nbsp;&nbsp; } else {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$rad </span><span class="keyword">= </span><span class="default">deg2rad</span><span class="keyword">( </span><span class="default">$angle </span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$sin </span><span class="keyword">= </span><span class="default">sin</span><span class="keyword">( </span><span class="default">$rad </span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$cos </span><span class="keyword">= </span><span class="default">cos</span><span class="keyword">( </span><span class="default">$rad </span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if( </span><span class="default">$angle </span><span class="keyword">&gt; </span><span class="default">0 </span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$tmp </span><span class="keyword">= </span><span class="default">$rect</span><span class="keyword">[</span><span class="default">6</span><span class="keyword">] * </span><span class="default">$cos </span><span class="keyword">+ </span><span class="default">$rect</span><span class="keyword">[</span><span class="default">7</span><span class="keyword">] * </span><span class="default">$sin</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$bx </span><span class="keyword">= -</span><span class="default">1 </span><span class="keyword">- </span><span class="default">round</span><span class="keyword">( </span><span class="default">$tmp </span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$imw </span><span class="keyword">= </span><span class="default">round</span><span class="keyword">( </span><span class="default">$rect</span><span class="keyword">[</span><span class="default">2</span><span class="keyword">] * </span><span class="default">$cos </span><span class="keyword">+ </span><span class="default">$rect</span><span class="keyword">[</span><span class="default">3</span><span class="keyword">] * </span><span class="default">$sin </span><span class="keyword">- </span><span class="default">$tmp </span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$tmp </span><span class="keyword">= </span><span class="default">$rect</span><span class="keyword">[</span><span class="default">5</span><span class="keyword">] * </span><span class="default">$cos </span><span class="keyword">- </span><span class="default">$rect</span><span class="keyword">[</span><span class="default">4</span><span class="keyword">] * </span><span class="default">$sin</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$by </span><span class="keyword">= -</span><span class="default">1 </span><span class="keyword">- </span><span class="default">round</span><span class="keyword">( </span><span class="default">$tmp </span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$imh </span><span class="keyword">= </span><span class="default">round</span><span class="keyword">( </span><span class="default">$rect</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">] * </span><span class="default">$cos </span><span class="keyword">- </span><span class="default">$rect</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">] * </span><span class="default">$sin </span><span class="keyword">- </span><span class="default">$tmp </span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; } else {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$tmp </span><span class="keyword">= </span><span class="default">$rect</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">] * </span><span class="default">$cos </span><span class="keyword">+ </span><span class="default">$rect</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">] * </span><span class="default">$sin</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$bx </span><span class="keyword">= -</span><span class="default">1 </span><span class="keyword">- </span><span class="default">round</span><span class="keyword">( </span><span class="default">$tmp </span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$imw </span><span class="keyword">= </span><span class="default">round</span><span class="keyword">( </span><span class="default">$rect</span><span class="keyword">[</span><span class="default">4</span><span class="keyword">] * </span><span class="default">$cos </span><span class="keyword">+ </span><span class="default">$rect</span><span class="keyword">[</span><span class="default">5</span><span class="keyword">] * </span><span class="default">$sin </span><span class="keyword">- </span><span class="default">$tmp </span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$tmp </span><span class="keyword">= </span><span class="default">$rect</span><span class="keyword">[</span><span class="default">7</span><span class="keyword">] * </span><span class="default">$cos </span><span class="keyword">- </span><span class="default">$rect</span><span class="keyword">[</span><span class="default">6</span><span class="keyword">] * </span><span class="default">$sin</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$by </span><span class="keyword">= -</span><span class="default">1 </span><span class="keyword">- </span><span class="default">round</span><span class="keyword">( </span><span class="default">$tmp </span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$imh </span><span class="keyword">= </span><span class="default">round</span><span class="keyword">( </span><span class="default">$rect</span><span class="keyword">[</span><span class="default">3</span><span class="keyword">] * </span><span class="default">$cos </span><span class="keyword">- </span><span class="default">$rect</span><span class="keyword">[</span><span class="default">2</span><span class="keyword">] * </span><span class="default">$sin </span><span class="keyword">- </span><span class="default">$tmp </span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$im </span><span class="keyword">= </span><span class="default">imagecreatetruecolor</span><span class="keyword">( </span><span class="default">$imw</span><span class="keyword">, </span><span class="default">$imh </span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">imagefill</span><span class="keyword">( </span><span class="default">$im</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">imagecolorallocate</span><span class="keyword">( </span><span class="default">$im</span><span class="keyword">, </span><span class="default">255</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">255 </span><span class="keyword">) );<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">imagettftext</span><span class="keyword">( </span><span class="default">$im</span><span class="keyword">, </span><span class="default">$size</span><span class="keyword">, </span><span class="default">$angle</span><span class="keyword">, </span><span class="default">$bx</span><span class="keyword">, </span><span class="default">$by</span><span class="keyword">, </span><span class="default">imagecolorallocate</span><span class="keyword">( </span><span class="default">$im</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0 </span><span class="keyword">), </span><span class="default">$font</span><span class="keyword">, </span><span class="default">$char </span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">imagegif</span><span class="keyword">( </span><span class="default">$im</span><span class="keyword">, </span><span class="default">trim</span><span class="keyword">( </span><span class="default">$font</span><span class="keyword">, </span><span class="string">'./' </span><span class="keyword">) . </span><span class="default">ord</span><span class="keyword">( </span><span class="default">$char </span><span class="keyword">) . </span><span class="default">$angle </span><span class="keyword">. </span><span class="string">'.gif' </span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">imagedestroy</span><span class="keyword">( </span><span class="default">$im </span><span class="keyword">);<br />
}<br />
<br />
</span><span class="default">$chars </span><span class="keyword">= </span><span class="string">'abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ1234567890'</span><span class="keyword">;<br />
</span><span class="default">$angles </span><span class="keyword">= array( -</span><span class="default">30</span><span class="keyword">, -</span><span class="default">20</span><span class="keyword">, -</span><span class="default">10</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">10</span><span class="keyword">, </span><span class="default">20</span><span class="keyword">, </span><span class="default">30 </span><span class="keyword">);<br />
</span><span class="default">$fonts </span><span class="keyword">= array( </span><span class="string">'./latinwide.ttf'</span><span class="keyword">, </span><span class="string">'./verdana.ttf'</span><span class="keyword">, </span><span class="string">'./times.ttf'</span><span class="keyword">, </span><span class="string">'./broadway.ttf' </span><span class="keyword">);<br />
foreach( </span><span class="default">$angles </span><span class="keyword">as </span><span class="default">$angle </span><span class="keyword">)<br />
&nbsp;&nbsp;&nbsp; foreach( </span><span class="default">$fonts </span><span class="keyword">as </span><span class="default">$font </span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; for( </span><span class="default">$i </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">; </span><span class="default">$i </span><span class="keyword">&lt; </span><span class="default">strlen</span><span class="keyword">( </span><span class="default">$chars </span><span class="keyword">); ++</span><span class="default">$i </span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">create_font_image</span><span class="keyword">( </span><span class="default">100</span><span class="keyword">, </span><span class="default">$angle</span><span class="keyword">, </span><span class="default">$font</span><span class="keyword">, </span><span class="default">$chars</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">] );<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="77453""></a>
  <div class="note">
   <strong class="user">intuz et gmx dt de</strong>
   <a href="#77453" class="date">29-Aug-2007 11:45</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I still got problems trying to rotate imagettftext using imagettfbbox.<br />
<br />
It's position calculation is mostly wrong. So i tried to rotate ttftext with IMAGEROTATE. <br />
<br />
As a special the result is in black fontcolor and transparent background.<br />
<br />
Hope it helps sombody (thanks for function convertBoundingBox, reading below)<br />
<br />
&lt;?<br />
function ImgText($text,$fontsize,$font,$angle){<br />
$im = '';<br />
&nbsp;&nbsp;&nbsp; if($text){<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if(!$fontsize || $fontsize &lt; 1) $fontsize = 12;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if(!$font) $font = "fonts/arial.ttf";<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $bbox = imagettfbbox($fontsize, 0, $font, $text);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $size=convertBoundingBox($bbox);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $im = ImageCreatetruecolor($size['width'],$size['height']);<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $white = ImageColorAllocate($im, 255, 255, 255);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $black = ImageColorAllocate($im, 0,0,0);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; imagefill ($im, 0, 0, $white );<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; imagettftext($im, $fontsize, 0, $size['xOffset'], $size['yOffset'], $black, $font, $text);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $im = imagerotate( $im,$angle, $white);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; imagecolortransparent ($im,$white);<br />
&nbsp;&nbsp;&nbsp; }else{<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; // No text<br />
&nbsp;&nbsp;&nbsp; }<br />
}<br />
?&gt;</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="76333""></a>
  <div class="note">
   <strong class="user">bushj at rpi dot edu</strong>
   <a href="#76333" class="date">10-Jul-2007 09:11</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Apparently the bounding box returned by imagettftext and imagettfbbox is not the same, and it appears as though imagettftext does a better job at calculating the actual bounding box (maybe because it has to render every character and it then finds out really everywhere it rendered).<br />
<br />
So, you can create a dummy image render the text to it and get a better box. Here is an example function:<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">function </span><span class="default">better_imagettfbbox</span><span class="keyword">(</span><span class="default">$size</span><span class="keyword">, </span><span class="default">$angle</span><span class="keyword">, </span><span class="default">$font</span><span class="keyword">, </span><span class="default">$text</span><span class="keyword">) {<br />
&nbsp; </span><span class="default">$dummy </span><span class="keyword">= </span><span class="default">imagecreate</span><span class="keyword">(</span><span class="default">1</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">);<br />
&nbsp; </span><span class="default">$black </span><span class="keyword">= </span><span class="default">imagecolorallocate</span><span class="keyword">(</span><span class="default">$dummy</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">);<br />
&nbsp; </span><span class="default">$bbox </span><span class="keyword">= </span><span class="default">imagettftext</span><span class="keyword">(</span><span class="default">$dummy</span><span class="keyword">, </span><span class="default">$size</span><span class="keyword">, </span><span class="default">$angle</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">$black</span><span class="keyword">, </span><span class="default">$font</span><span class="keyword">, </span><span class="default">$text</span><span class="keyword">);<br />
&nbsp; </span><span class="default">imagedestroy</span><span class="keyword">(</span><span class="default">$dummy</span><span class="keyword">);<br />
&nbsp; return </span><span class="default">$bbox</span><span class="keyword">;<br />
}<br />
</span><span class="default">?&gt;<br />
</span>If you use this a lot, it would be better to keep one dummy image instead of continually creating and destroying images.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="75530""></a>
  <div class="note">
   <strong class="user">Ruquay</strong>
   <a href="#75530" class="date">04-Jun-2007 04:12</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Several comments show that the output of this function is often not what is expected, especially when the text is rotated.<br />
<br />
For those of you who'd like a visual representation of what is happening to the bounding box as the text is rotated, take a look here:<br />
<br />
<a href="http://ruquay.com/sandbox/imagettf/" rel="nofollow" target="_blank">http://ruquay.com/sandbox/imagettf/</a></span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="75491""></a>
  <div class="note">
   <strong class="user">Nate Sweet</strong>
   <a href="#75491" class="date">01-Jun-2007 12:11</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
An improvement to the convertBoundingBox function. The previous function was completely wrong. My confusion came from characters like "1" and "_" that are rendered to the right or below the basepoint (in the font I'm using). I ended up using mike at mikeleigh dot com's function with a fix for these characters, and a "belowBasepoint" value.<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">function </span><span class="default">convertBoundingBox </span><span class="keyword">(</span><span class="default">$bbox</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; if (</span><span class="default">$bbox</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">] &gt;= -</span><span class="default">1</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$xOffset </span><span class="keyword">= -</span><span class="default">abs</span><span class="keyword">(</span><span class="default">$bbox</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">] + </span><span class="default">1</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; else<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$xOffset </span><span class="keyword">= </span><span class="default">abs</span><span class="keyword">(</span><span class="default">$bbox</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">] + </span><span class="default">2</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$width </span><span class="keyword">= </span><span class="default">abs</span><span class="keyword">(</span><span class="default">$bbox</span><span class="keyword">[</span><span class="default">2</span><span class="keyword">] - </span><span class="default">$bbox</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">]);<br />
&nbsp;&nbsp;&nbsp; if (</span><span class="default">$bbox</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">] &lt; -</span><span class="default">1</span><span class="keyword">) </span><span class="default">$width </span><span class="keyword">= </span><span class="default">abs</span><span class="keyword">(</span><span class="default">$bbox</span><span class="keyword">[</span><span class="default">2</span><span class="keyword">]) + </span><span class="default">abs</span><span class="keyword">(</span><span class="default">$bbox</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">]) - </span><span class="default">1</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$yOffset </span><span class="keyword">= </span><span class="default">abs</span><span class="keyword">(</span><span class="default">$bbox</span><span class="keyword">[</span><span class="default">5</span><span class="keyword">] + </span><span class="default">1</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; if (</span><span class="default">$bbox</span><span class="keyword">[</span><span class="default">5</span><span class="keyword">] &gt;= -</span><span class="default">1</span><span class="keyword">) </span><span class="default">$yOffset </span><span class="keyword">= -</span><span class="default">$yOffset</span><span class="keyword">; </span><span class="comment">// Fixed characters below the baseline.<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$height </span><span class="keyword">= </span><span class="default">abs</span><span class="keyword">(</span><span class="default">$bbox</span><span class="keyword">[</span><span class="default">7</span><span class="keyword">]) - </span><span class="default">abs</span><span class="keyword">(</span><span class="default">$bbox</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">]);<br />
&nbsp;&nbsp;&nbsp; if (</span><span class="default">$bbox</span><span class="keyword">[</span><span class="default">3</span><span class="keyword">] &gt; </span><span class="default">0</span><span class="keyword">) </span><span class="default">$height </span><span class="keyword">= </span><span class="default">abs</span><span class="keyword">(</span><span class="default">$bbox</span><span class="keyword">[</span><span class="default">7</span><span class="keyword">] - </span><span class="default">$bbox</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">]) - </span><span class="default">1</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; return array(<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">'width' </span><span class="keyword">=&gt; </span><span class="default">$width</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">'height' </span><span class="keyword">=&gt; </span><span class="default">$height</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">'xOffset' </span><span class="keyword">=&gt; </span><span class="default">$xOffset</span><span class="keyword">, </span><span class="comment">// Using xCoord + xOffset with imagettftext puts the left most pixel of the text at xCoord.<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">'yOffset' </span><span class="keyword">=&gt; </span><span class="default">$yOffset</span><span class="keyword">, </span><span class="comment">// Using yCoord + yOffset with imagettftext puts the top most pixel of the text at yCoord.<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">'belowBasepoint' </span><span class="keyword">=&gt; </span><span class="default">max</span><span class="keyword">(</span><span class="default">0</span><span class="keyword">, </span><span class="default">$bbox</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">])<br />
&nbsp;&nbsp;&nbsp; );<br />
}<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="75479""></a>
  <div class="note">
   <strong class="user">Nate Sweet</strong>
   <a href="#75479" class="date">01-Jun-2007 12:07</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
It took me some time to make full use of imagettfbbox. Hopefully the following function makes it much easier to use for others.<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">function </span><span class="default">convertBoundingBox </span><span class="keyword">(</span><span class="default">$bbox</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; if (</span><span class="default">$bbox</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">] &gt;= -</span><span class="default">1</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$leftOfBasepoint </span><span class="keyword">= -</span><span class="default">abs</span><span class="keyword">(</span><span class="default">$bbox</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">] + </span><span class="default">1</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; else<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$leftOfBasepoint </span><span class="keyword">= </span><span class="default">abs</span><span class="keyword">(</span><span class="default">$bbox</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">] + </span><span class="default">2</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$rightOfBasepoint </span><span class="keyword">= </span><span class="default">abs</span><span class="keyword">(</span><span class="default">$bbox</span><span class="keyword">[</span><span class="default">2</span><span class="keyword">] - </span><span class="default">$bbox</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">]);<br />
&nbsp;&nbsp;&nbsp; if (</span><span class="default">$bbox</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">] &lt; -</span><span class="default">1</span><span class="keyword">) </span><span class="default">$rightOfBasepoint </span><span class="keyword">= </span><span class="default">abs</span><span class="keyword">(</span><span class="default">$bbox</span><span class="keyword">[</span><span class="default">2</span><span class="keyword">]) + </span><span class="default">abs</span><span class="keyword">(</span><span class="default">$bbox</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">]) - </span><span class="default">1</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$aboveBasepoint </span><span class="keyword">= </span><span class="default">abs</span><span class="keyword">(</span><span class="default">$bbox</span><span class="keyword">[</span><span class="default">5</span><span class="keyword">] + </span><span class="default">1</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$height </span><span class="keyword">= </span><span class="default">abs</span><span class="keyword">(</span><span class="default">$bbox</span><span class="keyword">[</span><span class="default">7</span><span class="keyword">]) - </span><span class="default">abs</span><span class="keyword">(</span><span class="default">$bbox</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">]);<br />
&nbsp;&nbsp;&nbsp; if (</span><span class="default">$bbox</span><span class="keyword">[</span><span class="default">3</span><span class="keyword">] &gt; </span><span class="default">0</span><span class="keyword">) </span><span class="default">$height </span><span class="keyword">= </span><span class="default">abs</span><span class="keyword">(</span><span class="default">$bbox</span><span class="keyword">[</span><span class="default">7</span><span class="keyword">] - </span><span class="default">$bbox</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">]) - </span><span class="default">1</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$width </span><span class="keyword">= </span><span class="default">$leftOfBasepoint </span><span class="keyword">+ </span><span class="default">$rightOfBasepoint</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$belowBasepoint </span><span class="keyword">= </span><span class="default">$height </span><span class="keyword">- </span><span class="default">$aboveBasepoint</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; return array(<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">'width' </span><span class="keyword">=&gt; </span><span class="default">$width</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">'height' </span><span class="keyword">=&gt; </span><span class="default">$height</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">'leftOfBasepoint' </span><span class="keyword">=&gt; </span><span class="default">$leftOfBasepoint</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">'rightOfBasepoint' </span><span class="keyword">=&gt; </span><span class="default">$rightOfBasepoint</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">'aboveBasepoint' </span><span class="keyword">=&gt; </span><span class="default">$aboveBasepoint</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">'belowBasepoint' </span><span class="keyword">=&gt; </span><span class="default">$belowBasepoint<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">);<br />
}<br />
</span><span class="default">?&gt;<br />
</span><br />
Thanks goes to mike at mikeleigh dot com for providing the core of this function.<br />
<br />
Remember, the basepoint is the x, y coords you use to draw text with imagettftext. A useful thing to do is take a string like...<br />
ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz01234567890<br />
...and use the "aboveBasepoint" value for the height of your font. Now you can draw lines and use "the height of your font * leading" as the distance between lines of text, where leading is a number like 1.45 (for 45% leading).</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="75439""></a>
  <div class="note">
   <strong class="user">Nate Sweet</strong>
   <a href="#75439" class="date">30-May-2007 01:36</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
This script shows you side by side the difference between a font rendered at a certain size and the same font rendered at some multiple of that size and then scaled down by the same multiple. It seems to help small sizes and affects large ones less. This script lets you see if it is worth implementing for your situation. Included is the great "imagettfbboxextended" function by mike at mikeleigh dot com below.<br />
<br />
$size = 30;<br />
$factor = 16;<br />
<br />
$smallSize = imagettfbboxextended($size, 0, "fonts/MPlantin.ttf", "The quick brown fox jumps over the lazy dog.");<br />
$smallWidth = $smallSize['width'];<br />
$smallHeight = $smallSize['height'];<br />
$canvas = imagecreatetruecolor($smallWidth + 20, $smallHeight * 2 + 20);<br />
imagefill($canvas, 0, 0, imagecolorallocate($canvas, 255, 255, 255));<br />
imagettftext($canvas, $size, 0, 10 + $smallSize['x'], 10 + $smallSize['y'], imagecolorallocate($canvas, 0, 0, 0), "fonts/MPlantin.ttf", "The quick brown fox jumps over the lazy dog.");<br />
<br />
$largeSize = imagettfbboxextended($size * $factor, 0, "fonts/MPlantin.ttf", "The quick brown fox jumps over the lazy dog.");<br />
$largeWidth = $largeSize['width'];<br />
$largeHeight = $largeSize['height'];<br />
$temp = imagecreatetruecolor($largeWidth, $largeHeight);<br />
imagefill($temp, 0, 0, imagecolorallocate($canvas, 255, 255, 255));<br />
imagettftext($temp, $size * $factor, 0, $largeSize['x'], $largeSize['y'], imagecolorallocate($temp, 0, 0, 0), "fonts/MPlantin.ttf", "The quick brown fox jumps over the lazy dog.");<br />
imagecopyresampled($canvas, $temp, 10 + $smallSize['x'], 10 + $smallSize['y'] + 10, 0, 0, $smallWidth, $smallHeight, $largeWidth, $largeHeight);<br />
imagepng($temp, "temp.png");<br />
<br />
imagepng($canvas, "test.png");<br />
<br />
function imagettfbboxextended($size, $angle, $fontfile, $text) {<br />
&nbsp;&nbsp;&nbsp; /*this function extends imagettfbbox and includes within the returned array<br />
&nbsp;&nbsp;&nbsp; the actual text width and height as well as the x and y coordinates the<br />
&nbsp;&nbsp;&nbsp; text should be drawn from to render correctly.&nbsp; This currently only works<br />
&nbsp;&nbsp;&nbsp; for an angle of zero and corrects the issue of hanging letters e.g. jpqg*/<br />
&nbsp;&nbsp;&nbsp; $bbox = imagettfbbox($size, $angle, $fontfile, $text);<br />
<br />
&nbsp;&nbsp;&nbsp; //calculate x baseline<br />
&nbsp;&nbsp;&nbsp; if($bbox[0] &gt;= -1) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $bbox['x'] = abs($bbox[0] + 1) * -1;<br />
&nbsp;&nbsp;&nbsp; } else {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; //$bbox['x'] = 0;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $bbox['x'] = abs($bbox[0] + 2);<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp;&nbsp; //calculate actual text width<br />
&nbsp;&nbsp;&nbsp; $bbox['width'] = abs($bbox[2] - $bbox[0]);<br />
&nbsp;&nbsp;&nbsp; if($bbox[0] &lt; -1) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $bbox['width'] = abs($bbox[2]) + abs($bbox[0]) - 1;<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp;&nbsp; //calculate y baseline<br />
&nbsp;&nbsp;&nbsp; $bbox['y'] = abs($bbox[5] + 1);<br />
<br />
&nbsp;&nbsp;&nbsp; //calculate actual text height<br />
&nbsp;&nbsp;&nbsp; $bbox['height'] = abs($bbox[7]) - abs($bbox[1]);<br />
&nbsp;&nbsp;&nbsp; if($bbox[3] &gt; 0) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $bbox['height'] = abs($bbox[7] - $bbox[1]) - 1;<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp;&nbsp; return $bbox;<br />
}</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="75407""></a>
  <div class="note">
   <strong class="user">mike at mikeleigh dot com</strong>
   <a href="#75407" class="date">28-May-2007 07:05</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I have been testing this function for a while now and have come up with many of the same issues that other people have touched upon.&nbsp; Not being able to calculate the width of the text correctly.&nbsp; Or if a solution is found then it won't work with a hanging letter or a negative start letter like 'j'.<br />
<br />
Like Ralph I also wanted to draw a box around some text and this would require me being pixel perfect with the font.&nbsp; The trouble is I did not know which font would be used or which size.&nbsp; This led me to come up with a solution which I am sharing below.<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">function </span><span class="default">imagettfbboxextended</span><span class="keyword">(</span><span class="default">$size</span><span class="keyword">, </span><span class="default">$angle</span><span class="keyword">, </span><span class="default">$fontfile</span><span class="keyword">, </span><span class="default">$text</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">/*this function extends imagettfbbox and includes within the returned array<br />
&nbsp;&nbsp;&nbsp; the actual text width and height as well as the x and y coordinates the <br />
&nbsp;&nbsp;&nbsp; text should be drawn from to render correctly.&nbsp; This currently only works<br />
&nbsp;&nbsp;&nbsp; for an angle of zero and corrects the issue of hanging letters e.g. jpqg*/<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$bbox </span><span class="keyword">= </span><span class="default">imagettfbbox</span><span class="keyword">(</span><span class="default">$size</span><span class="keyword">, </span><span class="default">$angle</span><span class="keyword">, </span><span class="default">$fontfile</span><span class="keyword">, </span><span class="default">$text</span><span class="keyword">);<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">//calculate x baseline<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">if(</span><span class="default">$bbox</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">] &gt;= -</span><span class="default">1</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$bbox</span><span class="keyword">[</span><span class="string">'x'</span><span class="keyword">] = </span><span class="default">abs</span><span class="keyword">(</span><span class="default">$bbox</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">] + </span><span class="default">1</span><span class="keyword">) * -</span><span class="default">1</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; } else {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">//$bbox['x'] = 0;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$bbox</span><span class="keyword">[</span><span class="string">'x'</span><span class="keyword">] = </span><span class="default">abs</span><span class="keyword">(</span><span class="default">$bbox</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">] + </span><span class="default">2</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">//calculate actual text width<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$bbox</span><span class="keyword">[</span><span class="string">'width'</span><span class="keyword">] = </span><span class="default">abs</span><span class="keyword">(</span><span class="default">$bbox</span><span class="keyword">[</span><span class="default">2</span><span class="keyword">] - </span><span class="default">$bbox</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">]);<br />
&nbsp;&nbsp;&nbsp; if(</span><span class="default">$bbox</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">] &lt; -</span><span class="default">1</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$bbox</span><span class="keyword">[</span><span class="string">'width'</span><span class="keyword">] = </span><span class="default">abs</span><span class="keyword">(</span><span class="default">$bbox</span><span class="keyword">[</span><span class="default">2</span><span class="keyword">]) + </span><span class="default">abs</span><span class="keyword">(</span><span class="default">$bbox</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">]) - </span><span class="default">1</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">//calculate y baseline<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$bbox</span><span class="keyword">[</span><span class="string">'y'</span><span class="keyword">] = </span><span class="default">abs</span><span class="keyword">(</span><span class="default">$bbox</span><span class="keyword">[</span><span class="default">5</span><span class="keyword">] + </span><span class="default">1</span><span class="keyword">);<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">//calculate actual text height<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$bbox</span><span class="keyword">[</span><span class="string">'height'</span><span class="keyword">] = </span><span class="default">abs</span><span class="keyword">(</span><span class="default">$bbox</span><span class="keyword">[</span><span class="default">7</span><span class="keyword">]) - </span><span class="default">abs</span><span class="keyword">(</span><span class="default">$bbox</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">]);<br />
&nbsp;&nbsp;&nbsp; if(</span><span class="default">$bbox</span><span class="keyword">[</span><span class="default">3</span><span class="keyword">] &gt; </span><span class="default">0</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$bbox</span><span class="keyword">[</span><span class="string">'height'</span><span class="keyword">] = </span><span class="default">abs</span><span class="keyword">(</span><span class="default">$bbox</span><span class="keyword">[</span><span class="default">7</span><span class="keyword">] - </span><span class="default">$bbox</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">]) - </span><span class="default">1</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">$bbox</span><span class="keyword">;<br />
}<br />
</span><span class="default">?&gt;<br />
</span><br />
The function above gives the correct x and y coordinates that the text should be drawn from and also gives the actual image width and height.&nbsp; This has been tested with various fonts and sizes ranging from 6 up to 144 points.&nbsp; Some of the output will appear to be incorrect and have an extra pixel on the right, using verdana at size 144 and outputting the character 'Q' for example.&nbsp; This is not an error as this is part of the anti-aliasing of the font output.<br />
<br />
Example Usage:<br />
<span class="default">&lt;?php<br />
$font </span><span class="keyword">= </span><span class="string">'c:\windows\fonts\verdana.ttf'</span><span class="keyword">;<br />
</span><span class="default">$font_size </span><span class="keyword">= </span><span class="default">144</span><span class="keyword">;<br />
</span><span class="default">$text </span><span class="keyword">= </span><span class="string">'jüyZgQ'</span><span class="keyword">;<br />
</span><span class="default">$bbox </span><span class="keyword">= </span><span class="default">imagettfbboxextended</span><span class="keyword">(</span><span class="default">$font_size</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">$font</span><span class="keyword">, </span><span class="default">$text</span><span class="keyword">);<br />
</span><span class="default">?&gt;<br />
</span><br />
Return Values:<br />
Array<br />
(<br />
&nbsp;&nbsp;&nbsp; [0] =&gt; -8<br />
&nbsp;&nbsp;&nbsp; [1] =&gt; 40<br />
&nbsp;&nbsp;&nbsp; [2] =&gt; 715<br />
&nbsp;&nbsp;&nbsp; [3] =&gt; 40<br />
&nbsp;&nbsp;&nbsp; [4] =&gt; 715<br />
&nbsp;&nbsp;&nbsp; [5] =&gt; -177<br />
&nbsp;&nbsp;&nbsp; [6] =&gt; -8<br />
&nbsp;&nbsp;&nbsp; [7] =&gt; -177<br />
&nbsp;&nbsp;&nbsp; [x] =&gt; 6<br />
&nbsp;&nbsp;&nbsp; [width] =&gt; 722<br />
&nbsp;&nbsp;&nbsp; [y] =&gt; 176<br />
&nbsp;&nbsp;&nbsp; [height] =&gt; 216<br />
)<br />
<br />
Further notes can be found here along with images of the output of the function <a href="http://mikeleigh.com/links/imagettfbbox" rel="nofollow" target="_blank">http://mikeleigh.com/links/imagettfbbox</a></span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="75333""></a>
  <div class="note">
   <strong class="user">lassial dot gmail dot com</strong>
   <a href="#75333" class="date">24-May-2007 04:46</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Ralph Bolton commented about the difference in calculating the bounding box size vs. aligning text base line. <br />
<br />
The workaround for this issue is to calculate the difference in height between a character going below baseline and one above the baseline. This is likely going to vary from font to font, so I'd suggest something like this:<br />
<br />
<span class="default">&lt;?php<br />
<br />
</span><span class="keyword">function </span><span class="default">fontBaselineOffset</span><span class="keyword">(</span><span class="default">$font</span><span class="keyword">, </span><span class="default">$fontSize</span><span class="keyword">)<br />
{<br />
</span><span class="comment">//this should be above baseline<br />
</span><span class="default">$test2</span><span class="keyword">=</span><span class="string">"H"</span><span class="keyword">;<br />
</span><span class="comment">//some of these additional letters should go below it<br />
</span><span class="default">$test3</span><span class="keyword">=</span><span class="string">"Hjgqp"</span><span class="keyword">;<br />
<br />
</span><span class="comment">//get the dimension for these two:<br />
<br />
</span><span class="default">$box2 </span><span class="keyword">= </span><span class="default">imageTTFBbox</span><span class="keyword">(</span><span class="default">$fontSize</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">$font</span><span class="keyword">,</span><span class="default">$test2</span><span class="keyword">);<br />
</span><span class="default">$box3 </span><span class="keyword">= </span><span class="default">imageTTFBbox</span><span class="keyword">(</span><span class="default">$fontSize</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">$font</span><span class="keyword">,</span><span class="default">$test3</span><span class="keyword">);<br />
<br />
</span><span class="comment">//return the offset value<br />
<br />
</span><span class="keyword">return&nbsp; </span><span class="default">abs</span><span class="keyword">((</span><span class="default">abs</span><span class="keyword">(</span><span class="default">$box2</span><span class="keyword">[</span><span class="default">5</span><span class="keyword">]) + </span><span class="default">abs</span><span class="keyword">(</span><span class="default">$box2</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">])) - (</span><span class="default">abs</span><span class="keyword">(</span><span class="default">$box3</span><span class="keyword">[</span><span class="default">5</span><span class="keyword">]) + </span><span class="default">abs</span><span class="keyword">(</span><span class="default">$box3</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">])));<br />
<br />
}<br />
</span><span class="default">?&gt;<br />
</span><br />
This is not perfect yet. You should define a range of allowed characters that can go below baseline, compare them to the ones actually found in your string and use them instead of the string $test3 used in the example function above. This should avoid problems with letters that go further below baseline than the others (e.g. there could be a difference between 'g' and 'p')</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="74686""></a>
  <div class="note">
   <strong class="user">ralphbolton at mail2sexy dot com</strong>
   <a href="#74686" class="date">23-Apr-2007 09:16</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
There's a bit of an annoyance with measuring font sizes and drawing boxes around text. When fonts are measured using ImageTTFbbox, the correct vertical height is returned. That is, the measurement of the phrase "Hanging" will be from the top of the "H" to the bottom of the "g".<br />
<br />
The problem is that functions like imageTTFtext align with the "line" of the text - that is, in the phrase "Hanging", the alignment is below the "H", not the bottom of the "g". That means that if you draw a rectangle behind your text, it'll be incorrectly aligned because the hanging "g" will be outside the box.<br />
<br />
For example, this doesn't work as you might expect (because the "g" hangs below the box):<br />
<span class="default">&lt;?php<br />
</span><span class="comment">// Get the size of the font box<br />
</span><span class="default">$textbox </span><span class="keyword">= </span><span class="default">imageTTFBbox</span><span class="keyword">(</span><span class="default">$size</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">$font</span><span class="keyword">, </span><span class="string">'Hanging'</span><span class="keyword">);<br />
</span><span class="default">$textwidth </span><span class="keyword">= </span><span class="default">abs</span><span class="keyword">(</span><span class="default">$textbox</span><span class="keyword">[</span><span class="default">4</span><span class="keyword">] - </span><span class="default">$textbox</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">]);<br />
</span><span class="default">$textheight </span><span class="keyword">= </span><span class="default">abs</span><span class="keyword">(</span><span class="default">$textbox</span><span class="keyword">[</span><span class="default">5</span><span class="keyword">] - </span><span class="default">$textbox</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">]);<br />
<br />
</span><span class="comment">// Now draw a rectangle on the image<br />
</span><span class="default">$colour </span><span class="keyword">= </span><span class="default">ImageColorAllocate</span><span class="keyword">(</span><span class="default">$im</span><span class="keyword">, </span><span class="default">100</span><span class="keyword">, </span><span class="default">100</span><span class="keyword">, </span><span class="default">100</span><span class="keyword">);<br />
</span><span class="default">imagefilledrectangle</span><span class="keyword">(</span><span class="default">$im</span><span class="keyword">, </span><span class="default">$x</span><span class="keyword">, </span><span class="default">$y </span><span class="keyword">- </span><span class="default">$textheight</span><span class="keyword">, </span><span class="default">$x </span><span class="keyword">+ </span><span class="default">$textwidth</span><span class="keyword">, </span><span class="default">$y</span><span class="keyword">, </span><span class="default">$colour </span><span class="keyword">);<br />
<br />
</span><span class="comment">// Now draw the text<br />
</span><span class="default">$black </span><span class="keyword">= </span><span class="default">ImageColorAllocate</span><span class="keyword">(</span><span class="default">$im</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">);<br />
</span><span class="default">ImageTTFText</span><span class="keyword">(</span><span class="default">$image</span><span class="keyword">[</span><span class="string">'resource'</span><span class="keyword">], </span><span class="default">$size</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">$x</span><span class="keyword">, </span><span class="default">$y</span><span class="keyword">, </span><span class="default">$black</span><span class="keyword">, </span><span class="default">$font</span><span class="keyword">, </span><span class="string">'Hanging'</span><span class="keyword">);<br />
</span><span class="default">?&gt;<br />
</span>It also seems that the rectangle in the above example is located 1 pixel to the left of the text.<br />
<br />
I haven't found a way to resolve this problem correctly. Instead, I have enlarged the rectangle and then put the text into it. I don't think this will work absolutely correctly for all fonts, so it's not exactly a perfect solution. However, it's better than nothing! Here is a snippet of it:<br />
<span class="default">&lt;?php<br />
$enlargex </span><span class="keyword">= </span><span class="default">$textwidth </span><span class="keyword">* </span><span class="default">0.08</span><span class="keyword">;<br />
</span><span class="default">$enlargey </span><span class="keyword">= </span><span class="default">$textheight </span><span class="keyword">* </span><span class="default">0.1</span><span class="keyword">;<br />
</span><span class="default">$enlargey2 </span><span class="keyword">= </span><span class="default">$textheight </span><span class="keyword">* </span><span class="default">0.5</span><span class="keyword">;<br />
<br />
</span><span class="comment">// Now draw a rectangle on the image<br />
</span><span class="default">$colour </span><span class="keyword">= </span><span class="default">ImageColorAllocate</span><span class="keyword">(</span><span class="default">$im</span><span class="keyword">, </span><span class="default">100</span><span class="keyword">, </span><span class="default">100</span><span class="keyword">, </span><span class="default">100</span><span class="keyword">);<br />
</span><span class="default">imagefilledrectangle</span><span class="keyword">(</span><span class="default">$im</span><span class="keyword">, </span><span class="default">$x </span><span class="keyword">- </span><span class="default">$enlargex</span><span class="keyword">, </span><span class="default">$y </span><span class="keyword">- </span><span class="default">$textheight </span><span class="keyword">- </span><span class="default">$enlargey</span><span class="keyword">, </span><span class="default">$x </span><span class="keyword">+ </span><span class="default">$textwidth </span><span class="keyword">+ </span><span class="default">$enlargex</span><span class="keyword">, </span><span class="default">$y </span><span class="keyword">+ </span><span class="default">$enlarge2</span><span class="keyword">, </span><span class="default">$colour </span><span class="keyword">);<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="68518""></a>
  <div class="note">
   <strong class="user">marclaz</strong>
   <a href="#68518" class="date">31-Jul-2006 06:13</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Please note that as imageTTFBbox and imageTTFText functions return an array of coordinates which could be negative numbers care must be taken with height and width calculations.<br />
<br />
The rigth way to do that is to use the abs() function:<br />
<br />
for an horizontal text:<br />
<br />
$box = @imageTTFBbox($size,0,$font,$text);<br />
$width = abs($box[4] - $box[0]);<br />
$height = abs($box[5] - $box[1]);<br />
<br />
Then to center your text at ($x,$y) position the code should be like that:<br />
<br />
$x -= $width/2;<br />
$y += $heigth/2;<br />
<br />
imageTTFText($img,$size,0,$x,$y,$color,$font,$text);<br />
<br />
this because (0,0) page origin is topleft page corner and (0,0) text origin is lower-left readable text corner.<br />
<br />
Hope this help.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="60183""></a>
  <div class="note">
   <strong class="user">peisenmann at gmail dot com</strong>
   <a href="#60183" class="date">28-Dec-2005 06:41</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Another function for centered text string.<br />
What it does: Generate a truecolor .png image of a text string. The image will be just large enough encompass the text and a 2 px border and the text will be centered in it.<br />
<br />
It is called from any other page like so...<br />
&lt;img src="linkImg.php?text=php.net is great&amp;border=out" /&gt; // Text with #&amp;+"'\&lt;&gt; will need to be escaped, but I've found spaces don't cause errors. I haven't tested this with any other languages.<br />
<br />
The following code is the file named linkImg.php<br />
The file was not designed to have anything else here with it, and the open and close php tags should the the very first and very last characters of the page respectively, as outside whitespace can be a little evil sometimes.<br />
<span class="default">&lt;?php <br />
</span><span class="comment">//Obtain text and border via GET<br />
//Border can be out, in, or flat<br />
</span><span class="default">$text </span><span class="keyword">= </span><span class="default">$_GET</span><span class="keyword">[</span><span class="string">'text'</span><span class="keyword">];<br />
</span><span class="default">$border </span><span class="keyword">= </span><span class="default">$_GET</span><span class="keyword">[</span><span class="string">'border'</span><span class="keyword">];<br />
&nbsp;<br />
&nbsp; </span><span class="default">$font </span><span class="keyword">= </span><span class="string">"fontpath"</span><span class="keyword">; </span><span class="comment">//(str) "fonts/sasquatchlives.ttf"<br />
&nbsp; </span><span class="default">$fontsize </span><span class="keyword">= </span><span class="default">font size</span><span class="keyword">; </span><span class="comment">//(int) pixels in GD 1, or points in GD 2<br />
<br />
//Register box<br />
</span><span class="default">$box </span><span class="keyword">= </span><span class="default">imagettfbbox </span><span class="keyword">(</span><span class="default">$fontsize</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">$font</span><span class="keyword">, </span><span class="default">$text</span><span class="keyword">);<br />
</span><span class="comment">//Find out the width and height of the text box<br />
</span><span class="default">$textW </span><span class="keyword">= </span><span class="default">$box</span><span class="keyword">[</span><span class="default">2</span><span class="keyword">] - </span><span class="default">$box</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">];<br />
</span><span class="default">$textH</span><span class="keyword">= </span><span class="default">$box</span><span class="keyword">[</span><span class="default">3</span><span class="keyword">]-</span><span class="default">$box</span><span class="keyword">[</span><span class="default">5</span><span class="keyword">];<br />
</span><span class="comment">//Add padding<br />
</span><span class="default">$paddingx </span><span class="keyword">= </span><span class="default">10</span><span class="keyword">;<br />
</span><span class="default">$paddingy </span><span class="keyword">= </span><span class="default">10</span><span class="keyword">;<br />
</span><span class="comment">//Set image dimentions<br />
</span><span class="default">$width </span><span class="keyword">= </span><span class="default">$textW</span><span class="keyword">+</span><span class="default">$paddingx</span><span class="keyword">;<br />
</span><span class="default">$height</span><span class="keyword">= </span><span class="default">$textH</span><span class="keyword">+</span><span class="default">$paddingy</span><span class="keyword">;<br />
<br />
</span><span class="comment">//Bottom left corner of text<br />
</span><span class="default">$textx </span><span class="keyword">= </span><span class="default">$paddingx</span><span class="keyword">/</span><span class="default">2</span><span class="keyword">;<br />
</span><span class="default">$texty </span><span class="keyword">= </span><span class="default">$height </span><span class="keyword">- </span><span class="default">$paddingy</span><span class="keyword">/</span><span class="default">2</span><span class="keyword">;<br />
<br />
</span><span class="comment">//Shadow offset (pixels)<br />
</span><span class="default">$shadoffx </span><span class="keyword">= </span><span class="default">1</span><span class="keyword">;<br />
</span><span class="default">$shadoffy </span><span class="keyword">= </span><span class="default">1</span><span class="keyword">;<br />
<br />
</span><span class="comment">//Create the image<br />
&nbsp;</span><span class="default">$img </span><span class="keyword">= </span><span class="default">imagecreatetruecolor</span><span class="keyword">(</span><span class="default">$width</span><span class="keyword">,</span><span class="default">$height</span><span class="keyword">);<br />
</span><span class="comment">//Define some colors<br />
&nbsp;</span><span class="default">$white </span><span class="keyword">= </span><span class="default">imagecolorallocate</span><span class="keyword">(</span><span class="default">$img</span><span class="keyword">,</span><span class="default">255</span><span class="keyword">,</span><span class="default">255</span><span class="keyword">,</span><span class="default">255</span><span class="keyword">);<br />
&nbsp;</span><span class="default">$black </span><span class="keyword">= </span><span class="default">imagecolorallocate</span><span class="keyword">(</span><span class="default">$img</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">);<br />
&nbsp;</span><span class="default">$lightgrey </span><span class="keyword">= </span><span class="default">imagecolorallocate</span><span class="keyword">(</span><span class="default">$img</span><span class="keyword">,</span><span class="default">200</span><span class="keyword">,</span><span class="default">200</span><span class="keyword">,</span><span class="default">200</span><span class="keyword">);<br />
&nbsp;</span><span class="default">$grey </span><span class="keyword">= </span><span class="default">imagecolorallocate</span><span class="keyword">(</span><span class="default">$img</span><span class="keyword">,</span><span class="default">100</span><span class="keyword">,</span><span class="default">100</span><span class="keyword">,</span><span class="default">100</span><span class="keyword">);<br />
</span><span class="comment">//Define Text (fg) and background (bg) colors<br />
&nbsp;</span><span class="default">$bgcol </span><span class="keyword">= </span><span class="default">imagecolorallocate</span><span class="keyword">(</span><span class="default">$img</span><span class="keyword">,</span><span class="default">192</span><span class="keyword">,</span><span class="default">213</span><span class="keyword">,</span><span class="default">196</span><span class="keyword">); </span><span class="comment">//Celadon (light pastel green)<br />
&nbsp;</span><span class="default">$fgcol </span><span class="keyword">= </span><span class="default">imagecolorallocate</span><span class="keyword">(</span><span class="default">$img</span><span class="keyword">,</span><span class="default">243</span><span class="keyword">,</span><span class="default">104</span><span class="keyword">,</span><span class="default">88</span><span class="keyword">); </span><span class="comment">//Peach<br />
// Fill image with background color<br />
&nbsp;</span><span class="default">imagefill</span><span class="keyword">(</span><span class="default">$img</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">$bgcol</span><span class="keyword">); <br />
<br />
</span><span class="comment">//Write Shadow<br />
</span><span class="default">imagettftext</span><span class="keyword">(</span><span class="default">$img</span><span class="keyword">, </span><span class="default">$fontsize</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">$textx</span><span class="keyword">+</span><span class="default">$shadoffx</span><span class="keyword">, </span><span class="default">$texty</span><span class="keyword">+</span><span class="default">$shadoffy</span><span class="keyword">, </span><span class="default">$grey</span><span class="keyword">, </span><span class="default">$font</span><span class="keyword">, </span><span class="default">$text</span><span class="keyword">);<br />
<br />
</span><span class="comment">//Write Text<br />
</span><span class="default">imagettftext</span><span class="keyword">(</span><span class="default">$img</span><span class="keyword">, </span><span class="default">$fontsize</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">$textx</span><span class="keyword">, </span><span class="default">$texty</span><span class="keyword">, </span><span class="default">$fgcol</span><span class="keyword">, </span><span class="default">$font</span><span class="keyword">, </span><span class="default">$text</span><span class="keyword">);<br />
<br />
</span><span class="comment">//Bordering<br />
<br />
&nbsp;&nbsp; //Embossed border (button-looking)<br />
&nbsp;</span><span class="keyword">if (</span><span class="default">$border </span><span class="keyword">== </span><span class="string">"out"</span><span class="keyword">) <br />
&nbsp; {<br />
&nbsp;&nbsp; </span><span class="default">imageline </span><span class="keyword">(</span><span class="default">$img</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">$width</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">$white</span><span class="keyword">);</span><span class="default">imageline </span><span class="keyword">(</span><span class="default">$img</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">$height</span><span class="keyword">,</span><span class="default">$white</span><span class="keyword">);<br />
&nbsp;&nbsp; </span><span class="default">imageline </span><span class="keyword">(</span><span class="default">$img</span><span class="keyword">,</span><span class="default">1</span><span class="keyword">,</span><span class="default">1</span><span class="keyword">,</span><span class="default">$width</span><span class="keyword">,</span><span class="default">1</span><span class="keyword">,</span><span class="default">$lightgrey</span><span class="keyword">);</span><span class="default">imageline </span><span class="keyword">(</span><span class="default">$img</span><span class="keyword">,</span><span class="default">1</span><span class="keyword">,</span><span class="default">1</span><span class="keyword">,</span><span class="default">1</span><span class="keyword">,</span><span class="default">$height</span><span class="keyword">-</span><span class="default">1</span><span class="keyword">,</span><span class="default">$lightgrey</span><span class="keyword">);<br />
&nbsp;&nbsp; </span><span class="default">imageline </span><span class="keyword">(</span><span class="default">$img</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">$height</span><span class="keyword">-</span><span class="default">1</span><span class="keyword">,</span><span class="default">$width</span><span class="keyword">-</span><span class="default">1</span><span class="keyword">,</span><span class="default">$height</span><span class="keyword">-</span><span class="default">1</span><span class="keyword">,</span><span class="default">$black</span><span class="keyword">);</span><span class="default">imageline </span><span class="keyword">(</span><span class="default">$img</span><span class="keyword">,</span><span class="default">$width</span><span class="keyword">-</span><span class="default">1</span><span class="keyword">,</span><span class="default">$height</span><span class="keyword">-</span><span class="default">1</span><span class="keyword">,</span><span class="default">$width</span><span class="keyword">-</span><span class="default">1</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">$black</span><span class="keyword">);<br />
&nbsp;&nbsp; </span><span class="default">imageline </span><span class="keyword">(</span><span class="default">$img</span><span class="keyword">,</span><span class="default">2</span><span class="keyword">,</span><span class="default">$height</span><span class="keyword">-</span><span class="default">2</span><span class="keyword">,</span><span class="default">$width</span><span class="keyword">-</span><span class="default">2</span><span class="keyword">,</span><span class="default">$height</span><span class="keyword">-</span><span class="default">2</span><span class="keyword">,</span><span class="default">$grey</span><span class="keyword">);</span><span class="default">imageline </span><span class="keyword">(</span><span class="default">$img</span><span class="keyword">,</span><span class="default">$width</span><span class="keyword">-</span><span class="default">2</span><span class="keyword">,</span><span class="default">$height</span><span class="keyword">-</span><span class="default">2</span><span class="keyword">,</span><span class="default">$width</span><span class="keyword">-</span><span class="default">2</span><span class="keyword">,</span><span class="default">2</span><span class="keyword">,</span><span class="default">$grey</span><span class="keyword">);<br />
<br />
&nbsp; }<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">//Flat border<br />
&nbsp;</span><span class="keyword">if (</span><span class="default">$border </span><span class="keyword">== </span><span class="string">"flat"</span><span class="keyword">) <br />
&nbsp; {<br />
&nbsp;&nbsp; </span><span class="default">imageline </span><span class="keyword">(</span><span class="default">$img</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">$width</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">$white</span><span class="keyword">);</span><span class="default">imageline </span><span class="keyword">(</span><span class="default">$img</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">$height</span><span class="keyword">,</span><span class="default">$white</span><span class="keyword">);<br />
&nbsp;&nbsp; </span><span class="default">imageline </span><span class="keyword">(</span><span class="default">$img</span><span class="keyword">,</span><span class="default">1</span><span class="keyword">,</span><span class="default">1</span><span class="keyword">,</span><span class="default">$width</span><span class="keyword">,</span><span class="default">1</span><span class="keyword">,</span><span class="default">$grey</span><span class="keyword">);</span><span class="default">imageline </span><span class="keyword">(</span><span class="default">$img</span><span class="keyword">,</span><span class="default">1</span><span class="keyword">,</span><span class="default">1</span><span class="keyword">,</span><span class="default">1</span><span class="keyword">,</span><span class="default">$height</span><span class="keyword">-</span><span class="default">1</span><span class="keyword">,</span><span class="default">$grey</span><span class="keyword">);<br />
&nbsp;&nbsp; </span><span class="default">imageline </span><span class="keyword">(</span><span class="default">$img</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">$height</span><span class="keyword">-</span><span class="default">1</span><span class="keyword">,</span><span class="default">$width</span><span class="keyword">-</span><span class="default">1</span><span class="keyword">,</span><span class="default">$height</span><span class="keyword">-</span><span class="default">1</span><span class="keyword">,</span><span class="default">$white</span><span class="keyword">);</span><span class="default">imageline </span><span class="keyword">(</span><span class="default">$img</span><span class="keyword">,</span><span class="default">$width</span><span class="keyword">-</span><span class="default">1</span><span class="keyword">,</span><span class="default">$height</span><span class="keyword">-</span><span class="default">1</span><span class="keyword">,</span><span class="default">$width</span><span class="keyword">-</span><span class="default">1</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">$white</span><span class="keyword">);<br />
&nbsp;&nbsp; </span><span class="default">imageline </span><span class="keyword">(</span><span class="default">$img</span><span class="keyword">,</span><span class="default">2</span><span class="keyword">,</span><span class="default">$height</span><span class="keyword">-</span><span class="default">2</span><span class="keyword">,</span><span class="default">$width</span><span class="keyword">-</span><span class="default">2</span><span class="keyword">,</span><span class="default">$height</span><span class="keyword">-</span><span class="default">2</span><span class="keyword">,</span><span class="default">$grey</span><span class="keyword">);</span><span class="default">imageline </span><span class="keyword">(</span><span class="default">$img</span><span class="keyword">,</span><span class="default">$width</span><span class="keyword">-</span><span class="default">2</span><span class="keyword">,</span><span class="default">$height</span><span class="keyword">-</span><span class="default">2</span><span class="keyword">,</span><span class="default">$width</span><span class="keyword">-</span><span class="default">2</span><span class="keyword">,</span><span class="default">2</span><span class="keyword">,</span><span class="default">$grey</span><span class="keyword">);<br />
&nbsp; }<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">//Engraved border (pushed button)<br />
&nbsp;</span><span class="keyword">if (</span><span class="default">$border </span><span class="keyword">== </span><span class="string">"in"</span><span class="keyword">) <br />
&nbsp; {<br />
&nbsp;&nbsp; </span><span class="default">imageline </span><span class="keyword">(</span><span class="default">$img</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">$width</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">$black</span><span class="keyword">);</span><span class="default">imageline </span><span class="keyword">(</span><span class="default">$img</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">$height</span><span class="keyword">,</span><span class="default">$black</span><span class="keyword">);<br />
&nbsp;&nbsp; </span><span class="default">imageline </span><span class="keyword">(</span><span class="default">$img</span><span class="keyword">,</span><span class="default">1</span><span class="keyword">,</span><span class="default">1</span><span class="keyword">,</span><span class="default">$width</span><span class="keyword">,</span><span class="default">1</span><span class="keyword">,</span><span class="default">$grey</span><span class="keyword">);</span><span class="default">imageline </span><span class="keyword">(</span><span class="default">$img</span><span class="keyword">,</span><span class="default">1</span><span class="keyword">,</span><span class="default">1</span><span class="keyword">,</span><span class="default">1</span><span class="keyword">,</span><span class="default">$height</span><span class="keyword">-</span><span class="default">1</span><span class="keyword">,</span><span class="default">$grey</span><span class="keyword">);<br />
&nbsp;&nbsp; </span><span class="default">imageline </span><span class="keyword">(</span><span class="default">$img</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">$height</span><span class="keyword">-</span><span class="default">1</span><span class="keyword">,</span><span class="default">$width</span><span class="keyword">-</span><span class="default">1</span><span class="keyword">,</span><span class="default">$height</span><span class="keyword">-</span><span class="default">1</span><span class="keyword">,</span><span class="default">$white</span><span class="keyword">);</span><span class="default">imageline </span><span class="keyword">(</span><span class="default">$img</span><span class="keyword">,</span><span class="default">$width</span><span class="keyword">-</span><span class="default">1</span><span class="keyword">,</span><span class="default">$height</span><span class="keyword">-</span><span class="default">1</span><span class="keyword">,</span><span class="default">$width</span><span class="keyword">-</span><span class="default">1</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">$white</span><span class="keyword">);<br />
&nbsp;&nbsp; </span><span class="default">imageline </span><span class="keyword">(</span><span class="default">$img</span><span class="keyword">,</span><span class="default">2</span><span class="keyword">,</span><span class="default">$height</span><span class="keyword">-</span><span class="default">2</span><span class="keyword">,</span><span class="default">$width</span><span class="keyword">-</span><span class="default">2</span><span class="keyword">,</span><span class="default">$height</span><span class="keyword">-</span><span class="default">2</span><span class="keyword">,</span><span class="default">$lightgrey</span><span class="keyword">);</span><span class="default">imageline </span><span class="keyword">(</span><span class="default">$img</span><span class="keyword">,</span><span class="default">$width</span><span class="keyword">-</span><span class="default">2</span><span class="keyword">,</span><span class="default">$height</span><span class="keyword">-</span><span class="default">2</span><span class="keyword">,</span><span class="default">$width</span><span class="keyword">-</span><span class="default">2</span><span class="keyword">,</span><span class="default">2</span><span class="keyword">,</span><span class="default">$lightgrey</span><span class="keyword">);<br />
&nbsp; }<br />
<br />
</span><span class="comment">// Header info<br />
&nbsp;</span><span class="default">header</span><span class="keyword">(</span><span class="string">"Content-type: image/png"</span><span class="keyword">);<br />
</span><span class="comment">//Sends the image<br />
&nbsp;</span><span class="default">imagepng</span><span class="keyword">(</span><span class="default">$img</span><span class="keyword">);<br />
&nbsp;</span><span class="default">imagedestroy</span><span class="keyword">(</span><span class="default">$img</span><span class="keyword">);<br />
</span><span class="default">?&gt;<br />
</span><br />
Hope this helps someone!<br />
-Patrick-</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="51373""></a>
  <div class="note">
   <strong class="user">ryan at retronetworks dot com</strong>
   <a href="#51373" class="date">28-Mar-2005 07:46</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Here is a function that lets you write a string with your own "font tracking" level (the amount of pixels separating each character).&nbsp; It uses imagettfbbox to determine the width of each character, so it doesn't discriminate against the skinnier of characters.&nbsp; For this example, let $t = the amount of distance in pixels you want to separate each character from its neighbors.<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">function </span><span class="default">ImageTTFTextWithTracking</span><span class="keyword">(</span><span class="default">$im</span><span class="keyword">, </span><span class="default">$size</span><span class="keyword">, </span><span class="default">$angle</span><span class="keyword">, </span><span class="default">$t</span><span class="keyword">, </span><span class="default">$x</span><span class="keyword">, </span><span class="default">$y</span><span class="keyword">, </span><span class="default">$color</span><span class="keyword">, </span><span class="default">$font</span><span class="keyword">, </span><span class="default">$text</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$numchar </span><span class="keyword">= </span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$text</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; for(</span><span class="default">$i </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">; </span><span class="default">$i </span><span class="keyword">&lt; </span><span class="default">$numchar</span><span class="keyword">; </span><span class="default">$i</span><span class="keyword">++) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment"># Assign character<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$char</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">] = </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$text</span><span class="keyword">, </span><span class="default">$i</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">);<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment"># Write character<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">imagettftext</span><span class="keyword">(</span><span class="default">$im</span><span class="keyword">, </span><span class="default">$size</span><span class="keyword">, </span><span class="default">$angle</span><span class="keyword">, (</span><span class="default">$x </span><span class="keyword">+ </span><span class="default">$w </span><span class="keyword">+ (</span><span class="default">$i </span><span class="keyword">* </span><span class="default">$t</span><span class="keyword">)), </span><span class="default">$y</span><span class="keyword">, </span><span class="default">$color</span><span class="keyword">, </span><span class="default">$font</span><span class="keyword">, </span><span class="default">$char</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">]);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment"># Get width of character<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$width </span><span class="keyword">= </span><span class="default">imagettfbbox</span><span class="keyword">(</span><span class="default">$size</span><span class="keyword">, </span><span class="default">$angle</span><span class="keyword">, </span><span class="default">$font</span><span class="keyword">, </span><span class="default">$char</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">]);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$w </span><span class="keyword">= </span><span class="default">$w </span><span class="keyword">+ </span><span class="default">$width</span><span class="keyword">[</span><span class="default">2</span><span class="keyword">];<br />
&nbsp;&nbsp;&nbsp; }<br />
}<br />
</span><span class="default">?&gt;<br />
</span><br />
Be aware that it currently does not work for angles other than the 0 default (I have no need for that).</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
</div>
</div>
</div></div></body></html>
