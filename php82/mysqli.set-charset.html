<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
 <head>
  <meta http-equiv="content-type" content="text/html; CHARSET=UTF-8">
  <title>设置客户端字符集</title>
<link media="all" rel="stylesheet" type="text/css" href="styles/03e73060321a0a848018724a6c83de7f-theme-base.css" />
<link media="all" rel="stylesheet" type="text/css" href="styles/03e73060321a0a848018724a6c83de7f-theme-medium.css" />

  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <link media="all" rel="stylesheet" type="text/css" href="style.css"/>
 </head>
 <body class="docs" class="docs"><div class="navbar navbar-fixed-top">
  <div class="navbar-inner clearfix">
    <ul class="nav" style="width: 100%">
      <li style="float: left;"><a href="mysqli.select-db.html">? mysqli::select_db</a></li>
      <li style="float: right;"><a href="mysqli.sqlstate.html">mysqli::$sqlstate ?</a></li>
    </ul>
  </div>
</div>
<div id="breadcrumbs" class="clearfix">
  <ul class="breadcrumbs-container">
    <li><a href="index.html">PHP Manual</a></li>
    <li><a href="class.mysqli.html">mysqli</a></li>
    <li>设置客户端字符集</li>
  </ul>
</div>
<div id="layout">
  <div id="layout-content"><div id="mysqli.set-charset" class="refentry">
 <div class="refnamediv">
  <h1 class="refname">mysqli::set_charset</h1>
  <h1 class="refname">mysqli_set_charset</h1>
  <p class="verinfo">(PHP 5 &gt;= 5.0.5, PHP 7, PHP 8)</p><p class="refpurpose"><span class="refname">mysqli::set_charset</span> -- <span class="refname">mysqli_set_charset</span> &mdash; <span class="dc-title">设置客户端字符集</span></p>

 </div>

 <div class="refsect1 description" id="refsect1-mysqli.set-charset-description">
  <h3 class="title">说明</h3>
  <p class="para">面向对象风格</p>
  <div class="methodsynopsis dc-description">
   <span class="modifier">public</span> <span class="methodname"><strong>mysqli::set_charset</strong></span>(<span class="methodparam"><span class="type">string</span> <code class="parameter">$charset</code></span>): <span class="type">bool</span></div>

  <p class="para rdfs-comment">过程化风格</p>
  <div class="methodsynopsis dc-description"><span class="methodname"><strong>mysqli_set_charset</strong></span>(<span class="methodparam"><span class="type"><a href="class.mysqli.html" class="type mysqli">mysqli</a></span> <code class="parameter">$mysql</code></span>, <span class="methodparam"><span class="type">string</span> <code class="parameter">$charset</code></span>): <span class="type">bool</span></div>

  <p class="para rdfs-comment">
   设置客户端与数据库间传输数据时所用的字符集。
  </p>
 </div>


 <div class="refsect1 parameters" id="refsect1-mysqli.set-charset-parameters">
  <h3 class="title">参数</h3>
  <p class="para">
   <dl>
    <dt>

<code class="parameter">mysql</code></dt>
<dd>
<p class="para">仅以过程化样式：由<span class="function"><a href="function.mysqli-connect.html" class="function">mysqli_connect()</a></span> 或 <span class="function"><a href="mysqli.init.html" class="function">mysqli_init()</a></span>
返回的 <span class="classname"><a href="class.mysqli.html" class="classname">mysqli</a></span> 对象。</p></dd>

    
     <dt>
<code class="parameter">charset</code></dt>

     <dd>

      <p class="para">
       所需的字符集。
      </p>
     </dd>

    
   </dl>

  </p>
 </div>


 <div class="refsect1 returnvalues" id="refsect1-mysqli.set-charset-returnvalues">
  <h3 class="title">返回值</h3>
  <p class="para">
   成功时返回 <strong><code>true</code></strong>， 或者在失败时返回 <strong><code>false</code></strong>。
  </p>
 </div>


 <div class="refsect1 errors" id="refsect1-mysqli.set-charset-errors">
  <h3 class="title">错误／异常</h3>
  <p class="para">
If mysqli error reporting is enabled (<strong><code>MYSQLI_REPORT_ERROR</code></strong>) and the requested operation fails,
a warning is generated. If, in addition, the mode is set to <strong><code>MYSQLI_REPORT_STRICT</code></strong>,
a <span class="classname"><a href="class.mysqli-sql-exception.html" class="classname">mysqli_sql_exception</a></span> is thrown instead.</p>
 </div>


 <div class="refsect1 examples" id="refsect1-mysqli.set-charset-examples">
  <h3 class="title">示例</h3>
  <div class="example" id="example-2972">
   <p><strong>Example #1 <span class="methodname"><strong>mysqli::set_charset()</strong></span> 示例</strong></p>
   <div class="example-contents"><p>面向对象风格</p></div>
   <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br /><br />mysqli_report</span><span style="color: #007700">(</span><span style="color: #0000BB">MYSQLI_REPORT_ERROR </span><span style="color: #007700">| </span><span style="color: #0000BB">MYSQLI_REPORT_STRICT</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">$mysqli </span><span style="color: #007700">= new </span><span style="color: #0000BB">mysqli</span><span style="color: #007700">(</span><span style="color: #DD0000">"localhost"</span><span style="color: #007700">, </span><span style="color: #DD0000">"my_user"</span><span style="color: #007700">, </span><span style="color: #DD0000">"my_password"</span><span style="color: #007700">, </span><span style="color: #DD0000">"test"</span><span style="color: #007700">);<br /><br /></span><span style="color: #0000BB">printf</span><span style="color: #007700">(</span><span style="color: #DD0000">"Initial character set: %s\n"</span><span style="color: #007700">, </span><span style="color: #0000BB">$mysqli</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">character_set_name</span><span style="color: #007700">());<br /><br /></span><span style="color: #FF8000">/* change character set to utf8mb4 */<br /></span><span style="color: #0000BB">$mysqli</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">set_charset</span><span style="color: #007700">(</span><span style="color: #DD0000">"utf8mb4"</span><span style="color: #007700">);<br /><br /></span><span style="color: #0000BB">printf</span><span style="color: #007700">(</span><span style="color: #DD0000">"Current character set: %s\n"</span><span style="color: #007700">, </span><span style="color: #0000BB">$mysqli</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">character_set_name</span><span style="color: #007700">());</span>
</span>
</code></div>
   </div>

   <div class="example-contents"><p>过程化风格</p></div>
   <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br /><br />mysqli_report</span><span style="color: #007700">(</span><span style="color: #0000BB">MYSQLI_REPORT_ERROR </span><span style="color: #007700">| </span><span style="color: #0000BB">MYSQLI_REPORT_STRICT</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">$link </span><span style="color: #007700">= </span><span style="color: #0000BB">mysqli_connect</span><span style="color: #007700">(</span><span style="color: #DD0000">'localhost'</span><span style="color: #007700">, </span><span style="color: #DD0000">'my_user'</span><span style="color: #007700">, </span><span style="color: #DD0000">'my_password'</span><span style="color: #007700">, </span><span style="color: #DD0000">'test'</span><span style="color: #007700">);<br /><br /></span><span style="color: #0000BB">printf</span><span style="color: #007700">(</span><span style="color: #DD0000">"Initial character set: %s\n"</span><span style="color: #007700">, </span><span style="color: #0000BB">mysqli_character_set_name</span><span style="color: #007700">(</span><span style="color: #0000BB">$link</span><span style="color: #007700">));<br /><br /></span><span style="color: #FF8000">/* change character set to utf8mb4 */<br /></span><span style="color: #0000BB">mysqli_set_charset</span><span style="color: #007700">(</span><span style="color: #0000BB">$link</span><span style="color: #007700">, </span><span style="color: #DD0000">"utf8mb4"</span><span style="color: #007700">);<br /><br /></span><span style="color: #0000BB">printf</span><span style="color: #007700">(</span><span style="color: #DD0000">"Current character set: %s\n"</span><span style="color: #007700">, </span><span style="color: #0000BB">mysqli_character_set_name</span><span style="color: #007700">(</span><span style="color: #0000BB">$link</span><span style="color: #007700">));</span>
</span>
</code></div>
   </div>

   <div class="example-contents"><p>以上示例的输出类似于：</p></div>
   <div class="example-contents screen">
<div class="cdata"><pre>
Initial character set: latin1
Current character set: utf8mb4
</pre></div>
   </div>
  </div>
 </div>


 <div class="refsect1 notes" id="refsect1-mysqli.set-charset-notes">
  <h3 class="title">注释</h3>
  <blockquote class="note"><p><strong class="note">Note</strong>: 
   <p class="para">
    如果在 Windows 平台上使用该方法，需要 MySQL 客户端库版本 4.1.11 或以上（且 MySQL 5.0 版本需要 5.0.6 及以上）。
   </p>
  </p></blockquote>
  <blockquote class="note"><p><strong class="note">Note</strong>: 
   <p class="para">
    这是改变字符集的首选方法，不推荐使用 <span class="function"><a href="mysqli.query.html" class="function">mysqli_query()</a></span> 来设置（如 <code class="literal">SET NAMES
    utf8</code>）。有关详细信息，请参阅 <a href="mysqlinfo.concepts.charset.html" class="link">MySQL 字符集概念</a>部分。
   </p>
  </p></blockquote>
 </div>


 <div class="refsect1 seealso" id="refsect1-mysqli.set-charset-seealso">
  <h3 class="title">参见</h3>
  <p class="para">
   <ul class="simplelist">
    <li class="member"><span class="function"><a href="mysqli.character-set-name.html" class="function" rel="rdfs-seeAlso">mysqli_character_set_name()</a> - 返回当前数据库连接的字符编码</span></li>
    <li class="member"><span class="function"><a href="mysqli.real-escape-string.html" class="function" rel="rdfs-seeAlso">mysqli_real_escape_string()</a> - 根据当前连接的字符集，对于 SQL 语句中的特殊字符进行转义</span></li>
    <li class="member"><a href="mysqlinfo.concepts.charset.html" class="link">MySQL 字符集概念</a></li>
    <li class="member"><a href="http://dev.mysql.com/doc/mysql/en/charset-charsets.html" class="link external" title="Link : http://dev.mysql.com/doc/mysql/en/charset-charsets.html">&raquo;&nbsp;MySQL 支持的字符集列表</a></li>
   </ul>
  </p>
 </div>


</div><div id="usernotes">
 <div class="head">
  <h3 class="title">User Contributed Notes</h3>
 </div>
<div id="allnotes">  <a name="122858""></a>
  <div class="note">
   <strong class="user">ASchmidt at Anamera dot net</strong>
   <a href="#122858" class="date">19-Jun-2018 10:54</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
To align both the character set (e.g., utf8mb4) AND the collation sequence with the schema (database) settings:<br />
<br />
<span class="default">&lt;?php<br />
$mysqli </span><span class="keyword">= new </span><span class="default">mysqli</span><span class="keyword">( </span><span class="default">DB_HOST</span><span class="keyword">, </span><span class="default">DB_USER</span><span class="keyword">, </span><span class="default">DB_PASSWORD</span><span class="keyword">, </span><span class="default">DB_SCHEMA</span><span class="keyword">, </span><span class="default">DB_PORT </span><span class="keyword">);<br />
if ( </span><span class="default">0 </span><span class="keyword">!== </span><span class="default">$mysqli</span><span class="keyword">-&gt;</span><span class="default">connect_errno </span><span class="keyword">)<br />
&nbsp;&nbsp;&nbsp; throw new </span><span class="default">\Exception</span><span class="keyword">( </span><span class="default">$mysqli</span><span class="keyword">-&gt;</span><span class="default">connect_error</span><span class="keyword">, </span><span class="default">$mysqli</span><span class="keyword">-&gt;</span><span class="default">connect_errno </span><span class="keyword">);<br />
<br />
if ( </span><span class="default">TRUE </span><span class="keyword">!== </span><span class="default">$mysqli</span><span class="keyword">-&gt;</span><span class="default">set_charset</span><span class="keyword">( </span><span class="string">'utf8mb4' </span><span class="keyword">) )<br />
&nbsp;&nbsp;&nbsp; throw new </span><span class="default">\Exception</span><span class="keyword">( </span><span class="default">$mysql</span><span class="keyword">-&gt;</span><span class="default">error</span><span class="keyword">, </span><span class="default">$mysqli</span><span class="keyword">-&gt;</span><span class="default">errno </span><span class="keyword">);<br />
<br />
if ( </span><span class="default">TRUE </span><span class="keyword">!== </span><span class="default">$mysqli</span><span class="keyword">-&gt;</span><span class="default">query</span><span class="keyword">( </span><span class="string">'SET collation_connection = @@collation_database;' </span><span class="keyword">) )<br />
&nbsp;&nbsp;&nbsp; throw new </span><span class="default">\Exception</span><span class="keyword">( </span><span class="default">$mysql</span><span class="keyword">-&gt;</span><span class="default">error</span><span class="keyword">, </span><span class="default">$mysqli</span><span class="keyword">-&gt;</span><span class="default">errno </span><span class="keyword">);<br />
</span><span class="default">?&gt;<br />
</span><br />
To confirm:<br />
<br />
<span class="default">&lt;?php <br />
</span><span class="keyword">echo </span><span class="string">'character_set_name: '</span><span class="keyword">, </span><span class="default">$mysqli</span><span class="keyword">-&gt;</span><span class="default">character_set_name</span><span class="keyword">(), </span><span class="string">'&lt;br /&gt;'</span><span class="keyword">, </span><span class="default">PHP_EOL</span><span class="keyword">;<br />
foreach( </span><span class="default">$mysqli</span><span class="keyword">-&gt;</span><span class="default">query</span><span class="keyword">( </span><span class="string">"SHOW VARIABLES LIKE '%_connection';" </span><span class="keyword">)-&gt;</span><span class="default">fetch_all</span><span class="keyword">() as </span><span class="default">$setting </span><span class="keyword">)<br />
&nbsp;&nbsp;&nbsp; echo </span><span class="default">$setting</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">], </span><span class="string">': '</span><span class="keyword">, </span><span class="default">$setting</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">], </span><span class="string">'&lt;br /&gt;'</span><span class="keyword">, </span><span class="default">PHP_EOL</span><span class="keyword">;<br />
</span><span class="default">?&gt;<br />
</span><br />
will output something like:<br />
character_set_name: utf8mb4<br />
character_set_connection: utf8mb4<br />
collation_connection: utf8mb4_unicode_520_ci</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="122223""></a>
  <div class="note">
   <strong class="user">chris at ocproducts dot com</strong>
   <a href="#122223" class="date">03-Jan-2018 07:30</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Note that using utf8mb4 with this function may cause this function to return false, depending on the MySQL client library compiled into PHP. If the client library is older than the introduction of utf8mb4, then PHP's call of the libraries 'mysql_set_character_set' will return an error because it won't recognise that character set.<br />
<br />
The only way you will know there's an error is by checking the return value, because PHP warnings are not emitted by this function.<br />
mysqli_error will return something like:<br />
"Can't initialize character set utf8mb4 (path: /usr/share/mysql/charsets/)"<br />
(I don't think the directory has anything to do with it; I think the utf8mb4 vs utf8 distinction is handled internally)<br />
<br />
A workaround is to recall with utf8, then do a 'SET NAMES' query with utf8mb4.<br />
<br />
If your MySQL server is configured to use utf8 by default, then you may not notice any of this until you get obscure bugs. It seems it will still save into the database correctly in terms of bytes. However, you may get "Data too long for column" errors if you are truncating strings to fit fields, because from MySQL's point of view during the length check every 4-byte character will actually be multiple individual characters. This caused me hours of debugging.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="121647""></a>
  <div class="note">
   <strong class="user">Konstantin Rozinov</strong>
   <a href="#121647" class="date">18-Sep-2017 02:20</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
The comment by Claude (<a href="http://php.net/manual/en/mysqli.set-charset.php#121067" rel="nofollow" target="_blank">http://php.net/manual/en/mysqli.set-charset.php#121067</a>) is CORRECT.<br />
<br />
Setting the charset (it's really the encoding) like this after setting up your connection:<br />
$connection-&gt;set_charset("utf8mb4")<br />
<br />
FAILS to set the proper collation for the connection:<br />
<br />
character_set_client: utf8mb4<br />
character_set_connection: utf8mb4<br />
character_set_database: utf8mb4<br />
character_set_filesystem: binary<br />
character_set_results: utf8mb4<br />
character_set_server: utf8mb4<br />
character_set_system: utf8<br />
collation_connection: utf8mb4_general_ci &lt;---- still says general<br />
collation_database: utf8mb4_unicode_ci<br />
collation_server: utf8mb4_unicode_ci<br />
<br />
If you use SET NAMES, that works:<br />
$connection-&gt;query("SET NAMES utf8mb4 COLLATE utf8mb4_unicode_ci");<br />
<br />
character_set_client: utf8mb4<br />
character_set_connection: utf8mb4<br />
character_set_database: utf8mb4<br />
character_set_filesystem: binary<br />
character_set_results: utf8mb4<br />
character_set_server: utf8mb4<br />
character_set_system: utf8<br />
collation_connection: utf8mb4_unicode_ci &lt;-- now says unicode<br />
collation_database: utf8mb4_unicode_ci<br />
collation_server: utf8mb4_unicode_ci<br />
<br />
Please note, that I set the following variables on the server:<br />
<br />
Set the following to be: utf8mb4_unicode_ci<br />
<br />
character_set_client<br />
character_set_connection<br />
character_set_database<br />
character_set_results<br />
character_set_server<br />
<br />
collation_connection <br />
collation_server<br />
<br />
Set:<br />
<br />
character-set-client-handshake = FALSE or 0<br />
skip-character-set-client-handshake = TRUE or 1</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="121067""></a>
  <div class="note">
   <strong class="user">claude dot pache at gmail dot com</strong>
   <a href="#121067" class="date">11-May-2017 08:01</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Although the documentation says that using that function is preferred than using SET NAMES, it is not sufficient in case you use a collation different from the default one:<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="comment">// That will reset collation_connection to latin1_swedish_ci<br />
// (the default collation for latin1):<br />
</span><span class="default">$mysqli</span><span class="keyword">-&gt;</span><span class="default">set_charset</span><span class="keyword">(</span><span class="string">'latin1'</span><span class="keyword">);<br />
<br />
</span><span class="comment">// You have to execute the following statement *after* mysqli::set_charset()<br />
// in order to get the desired value for collation_connection:<br />
</span><span class="default">$mysqli</span><span class="keyword">-&gt;</span><span class="default">query</span><span class="keyword">(</span><span class="string">"SET NAMES latin1 COLLATE latin1_german1_ci"</span><span class="keyword">);</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="119035""></a>
  <div class="note">
   <strong class="user">Emmanuel Appiah</strong>
   <a href="#119035" class="date">20-Mar-2016 05:46</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
So in my case, I had tried changing the collation from utf8mb4_unicode_ci for mysql and had to change it to uft8_general_ci.<br />
<br />
Then pasted : <br />
<br />
mysqli_set_charset( $con, 'utf8');<br />
<br />
right before I did the SELECT command.<br />
<br />
This is my code for reading from db :<br />
<br />
/*<br />
<br />
$DB_SERVER="db_server_name";<br />
$DB_USER_READER="root";<br />
$DB_PASS_READER="passw*rd";<br />
$DB_NAME="db_name";<br />
$DB_PORT="port number";<br />
<br />
$SELECT_WHAT="`name_of_column_as_in_your_table`";<br />
$WHICH_TBL="`table_name`";<br />
$ON_WHAT_CONDITION="`id`='7'";<br />
<br />
*/<br />
<br />
$con = mysqli_connect($DB_SERVER, $DB_USER_READER, $DB_PASS_READER, $DB_NAME, $DB_PORT);//this is the unique connection for the selection<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; mysqli_set_charset( $con, 'utf8');<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $slct_stmnt = "SELECT ".$SELECT_WHAT." FROM ".$WHICH_TBL." WHERE ".$ON_WHAT_CONDITION;<br />
<br />
&nbsp;&nbsp;&nbsp; $slct_query = mysqli_query($con, $slct_stmnt);<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if ($slct_query==true) {<br />
//Do your stuff here . . . <br />
}<br />
<br />
And it worked like a charm. All the best. The above code can work with reading chineese, russian or arabic or any international language from the database's table column holding such data.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
</div>
</div>
</div></div></body></html>
