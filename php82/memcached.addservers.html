<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
 <head>
  <meta http-equiv="content-type" content="text/html; CHARSET=UTF-8">
  <title>向服务器池中增加多台服务器</title>
<link media="all" rel="stylesheet" type="text/css" href="styles/03e73060321a0a848018724a6c83de7f-theme-base.css" />
<link media="all" rel="stylesheet" type="text/css" href="styles/03e73060321a0a848018724a6c83de7f-theme-medium.css" />

  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <link media="all" rel="stylesheet" type="text/css" href="style.css"/>
 </head>
 <body class="docs" class="docs"><div class="navbar navbar-fixed-top">
  <div class="navbar-inner clearfix">
    <ul class="nav" style="width: 100%">
      <li style="float: left;"><a href="memcached.addserver.html">? Memcached::addServer</a></li>
      <li style="float: right;"><a href="memcached.append.html">Memcached::append ?</a></li>
    </ul>
  </div>
</div>
<div id="breadcrumbs" class="clearfix">
  <ul class="breadcrumbs-container">
    <li><a href="index.html">PHP Manual</a></li>
    <li><a href="class.memcached.html">Memcached</a></li>
    <li>向服务器池中增加多台服务器</li>
  </ul>
</div>
<div id="layout">
  <div id="layout-content"><div id="memcached.addservers" class="refentry">
 <div class="refnamediv">
  <h1 class="refname">Memcached::addServers</h1>
  <p class="verinfo">(PECL memcached &gt;= 0.1.1)</p><p class="refpurpose"><span class="refname">Memcached::addServers</span> &mdash; <span class="dc-title">向服务器池中增加多台服务器</span></p>

 </div>

 <div class="refsect1 description" id="refsect1-memcached.addservers-description">
  <h3 class="title">说明</h3>
  <div class="methodsynopsis dc-description">
   <span class="modifier">public</span> <span class="methodname"><strong>Memcached::addServers</strong></span>(<span class="methodparam"><span class="type">array</span> <code class="parameter">$servers</code></span>): <span class="type">bool</span></div>

  <p class="para rdfs-comment">
   <span class="function"><strong>Memcached::addServers()</strong></span> 向服务器池中增加 <code class="parameter">servers</code>。<code class="parameter">servers</code>
   中的每个条目都应该是包含主机名、端口以及可选权重的数组。此时并不会与这些服务端建立连接。
  </p>
  <p class="para">
   同一台服务器可能会在服务器池中多次出现，因为这里没有做重复检测。但这并不可取；相反，应该使用
   <code class="parameter">weight</code> 选项增加此服务器的选择权重。
  </p>
 </div>


 <div class="refsect1 parameters" id="refsect1-memcached.addservers-parameters">
  <h3 class="title">参数</h3>
  <p class="para">
   <dl>
    
     <dt>
<code class="parameter">array</code></dt>

     <dd>

      <p class="para">
      增加到池中的服务器数组。
      </p>
     </dd>

    
   </dl>

  </p>
 </div>


 <div class="refsect1 returnvalues" id="refsect1-memcached.addservers-returnvalues">
  <h3 class="title">返回值</h3>
  <p class="para">
   成功时返回 <strong><code>true</code></strong>， 或者在失败时返回 <strong><code>false</code></strong>。
  </p>
 </div>


 <div class="refsect1 examples" id="refsect1-memcached.addservers-examples">
  <h3 class="title">示例</h3>
  <p class="para">
   <div class="example" id="">
    <p><strong>Example #1 <span class="function"><strong>Memcached::addServers()</strong></span> 示例</strong></p>
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br />$m </span><span style="color: #007700">= new </span><span style="color: #0000BB">Memcached</span><span style="color: #007700">();<br /><br /></span><span style="color: #0000BB">$servers </span><span style="color: #007700">= array(<br />    array(</span><span style="color: #DD0000">'mem1.domain.com'</span><span style="color: #007700">, </span><span style="color: #0000BB">11211</span><span style="color: #007700">, </span><span style="color: #0000BB">33</span><span style="color: #007700">),<br />    array(</span><span style="color: #DD0000">'mem2.domain.com'</span><span style="color: #007700">, </span><span style="color: #0000BB">11211</span><span style="color: #007700">, </span><span style="color: #0000BB">67</span><span style="color: #007700">)<br />);<br /></span><span style="color: #0000BB">$m</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">addServers</span><span style="color: #007700">(</span><span style="color: #0000BB">$servers</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
    </div>

   </div>
  </p>
 </div>


 <div class="refsect1 seealso" id="refsect1-memcached.addservers-seealso">
  <h3 class="title">参见</h3>
  <p class="para">
   <ul class="simplelist">
    <li class="member"><span class="methodname"><a href="memcached.addserver.html" class="methodname" rel="rdfs-seeAlso">Memcached::addServer()</a> - 向服务器池增加服务器</span></li>
    <li class="member"><span class="methodname"><a href="memcached.resetserverlist.html" class="methodname" rel="rdfs-seeAlso">Memcached::resetServerList()</a> - Clears all servers from the server list</span></li>
   </ul>
  </p>
 </div>


</div><div id="usernotes">
 <div class="head">
  <h3 class="title">User Contributed Notes</h3>
 </div>
<div id="allnotes">  <a name="118940""></a>
  <div class="note">
   <strong class="user">Aliaser</strong>
   <a href="#118940" class="date">03-Mar-2016 07:44</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
For a proper FailOver mechanism:<br />
<br />
$memcached = new Memcached();<br />
$memcached-&gt;setOption(Memcached::OPT_CONNECT_TIMEOUT, 10);<br />
$memcached-&gt;setOption(Memcached::OPT_DISTRIBUTION, Memcached::DISTRIBUTION_CONSISTENT);<br />
$memcached-&gt;setOption(Memcached::OPT_SERVER_FAILURE_LIMIT, 2);<br />
$memcached-&gt;setOption(Memcached::OPT_REMOVE_FAILED_SERVERS, true);<br />
$memcached-&gt;setOption(Memcached::OPT_RETRY_TIMEOUT, 1);<br />
$memcached-&gt;addServers($servers);<br />
<br />
Memcached::OPT_DISTRIBUTION: set it to consistent hashing. If one memcached node is dead, its keys (and only its keys) will be evenly distributed to other nodes. This is where the magic is done. This is really different from removing one server in your -&gt;addServers() call.<br />
<br />
Memcached::OPT_SERVER_FAILURE_LIMIT: number of connection issues before a server is marked as DEAD, and removed from the list of servers (default: 5).<br />
<br />
Memcached::OPT_REMOVE_FAILED_SERVERS: set it to ?true?, to enable the removal of dead servers.<br />
<br />
Memcached::OPT_RETRY_TIMEOUT: after a node is declared DEAD, libmemcached will try it again after that many seconds. Here I've set it to 1 second, but I'm working on PHP scripts that run for less than 100ms most of the time. That would only be useful for cron/daemonize scripts.<br />
<br />
Memcached::OPT_CONNECT_TIMEOUT: the timeout after which a server is considered DEAD. As my servers are on the same LAN, ping is ~0.5ms, so 10ms is large enough to consider the server is DEAD. Note that you have to wait twice that time before a node is marked DEAD, so if it's 1000ms, your script will lock for 2 seconds before ignoring the DEAD server. That may affect your response times a lot, and that's why I've set it very low<br />
<br />
Author of this is Yvan from Dugwood</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="102486""></a>
  <div class="note">
   <strong class="user">Michael Brenden</strong>
   <a href="#102486" class="date">17-Feb-2011 03:27</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
See the note for __construct()<br />
<br />
Important to not call -&gt;addServers() every run -- only call it if no servers exist (check getServerList() ); otherwise, since addServers() does not check for dups, it will let you add the same server again and again and again, resultings in hundreds if not thousands of connections to the MC daemon.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
</div>
</div>
</div></div></body></html>
