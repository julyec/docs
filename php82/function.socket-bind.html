<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
 <head>
  <meta http-equiv="content-type" content="text/html; CHARSET=UTF-8">
  <title>给套接字绑定名字</title>
<link media="all" rel="stylesheet" type="text/css" href="styles/03e73060321a0a848018724a6c83de7f-theme-base.css" />
<link media="all" rel="stylesheet" type="text/css" href="styles/03e73060321a0a848018724a6c83de7f-theme-medium.css" />

  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <link media="all" rel="stylesheet" type="text/css" href="style.css"/>
 </head>
 <body class="docs" class="docs"><div class="navbar navbar-fixed-top">
  <div class="navbar-inner clearfix">
    <ul class="nav" style="width: 100%">
      <li style="float: left;"><a href="function.socket-addrinfo-lookup.html">? socket_addrinfo_lookup</a></li>
      <li style="float: right;"><a href="function.socket-clear-error.html">socket_clear_error ?</a></li>
    </ul>
  </div>
</div>
<div id="breadcrumbs" class="clearfix">
  <ul class="breadcrumbs-container">
    <li><a href="index.html">PHP Manual</a></li>
    <li><a href="ref.sockets.html">Socket 函数</a></li>
    <li>给套接字绑定名字</li>
  </ul>
</div>
<div id="layout">
  <div id="layout-content"><div id="function.socket-bind" class="refentry">
 <div class="refnamediv">
  <h1 class="refname">socket_bind</h1>
  <p class="verinfo">(PHP 4 &gt;= 4.1.0, PHP 5, PHP 7, PHP 8)</p><p class="refpurpose"><span class="refname">socket_bind</span> &mdash; <span class="dc-title">给套接字绑定名字</span></p>

 </div>

 <div class="refsect1 description" id="refsect1-function.socket-bind-description">
  <h3 class="title">说明</h3>
  <div class="methodsynopsis dc-description">
   <span class="methodname"><strong>socket_bind</strong></span>(<span class="methodparam"><span class="type"><a href="class.socket.html" class="type Socket">Socket</a></span> <code class="parameter">$socket</code></span>, <span class="methodparam"><span class="type">string</span> <code class="parameter">$address</code></span>, <span class="methodparam"><span class="type">int</span> <code class="parameter">$port</code><span class="initializer"> = 0</span></span>): <span class="type">bool</span></div>

  <p class="para rdfs-comment">
   绑定 <code class="parameter">address</code> 到 <code class="parameter">socket</code>。
   该操作必须是在使用 <span class="function"><a href="function.socket-connect.html" class="function">socket_connect()</a></span> 或者 <span class="function"><a href="function.socket-listen.html" class="function">socket_listen()</a></span>
   建立一个连接之前。
  </p>
 </div>


 <div class="refsect1 parameters" id="refsect1-function.socket-bind-parameters">
  <h3 class="title">参数</h3>
  <p class="para">
   <dl>
    
     <dt>
<code class="parameter">socket</code></dt>

     <dd>

      <p class="para">
       用 <span class="function"><a href="function.socket-create.html" class="function">socket_create()</a></span> 创建的 <span class="classname"><a href="class.socket.html" class="classname">Socket</a></span> 实例。
      </p>
     </dd>

    
    
     <dt>
<code class="parameter">address</code></dt>

     <dd>

      <p class="para">
       如果套接字是 <strong><code>AF_INET</code></strong> 族，那么
       <code class="parameter">address</code> 必须是一个四点分法的 IP 地址（例如 <code class="literal">127.0.0.1</code> ）。
      </p>
      <p class="para">
       如果套接字是 <strong><code>AF_UNIX</code></strong> 族，那么 <code class="parameter">address</code> 是 Unix 域套接字的路径（例如 <var class="filename">/tmp/my.sock</var> ）。
      </p>
     </dd>

    
    
     <dt>
<code class="parameter">port</code> （可选）</dt>

     <dd>

      <p class="para">
       参数 <code class="parameter">port</code> 仅仅用于 <strong><code>AF_INET</code></strong>
       套接字连接的时候，并且指定连接中需要监听的端口号。
      </p>
     </dd>

    
   </dl>

  </p>
 </div>


 <div class="refsect1 returnvalues" id="refsect1-function.socket-bind-returnvalues">
  <h3 class="title">返回值</h3>
  <p class="para">
   成功时返回 <strong><code>true</code></strong>， 或者在失败时返回 <strong><code>false</code></strong>。
  </p>
  <p class="para">
   使用 <span class="function"><a href="function.socket-last-error.html" class="function">socket_last_error()</a></span> 检索错误代码，如果将此代码传入 <span class="function"><a href="function.socket-strerror.html" class="function">socket_strerror()</a></span>
   则可以得到错误的文字说明。
  </p>
 </div>


 <div class="refsect1 changelog" id="refsect1-function.socket-bind-changelog">
  <h3 class="title">更新日志</h3>
  <table class="doctable informaltable">
   
    <thead>
     <tr>
      <th>版本</th>
      <th>说明</th>
     </tr>

    </thead>

    <tbody class="tbody">
     <tr>
  <td>8.0.0</td>
  <td>
   现在 <code class="parameter">socket</code> 是 <span class="classname"><a href="class.socket.html" class="classname">Socket</a></span> 实例，
   之前是 <span class="type">resource</span>。
  </td>
 </tr>

    </tbody>
   
  </table>

 </div>


 <div class="refsect1 examples" id="refsect1-function.socket-bind-examples">
  <h3 class="title">示例</h3>
  <p class="para">
   <div class="example" id="">
    <p><strong>Example #1 使用 <span class="function"><strong>socket_bind()</strong></span> 来设置源地址</strong></p>
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br /></span><span style="color: #FF8000">// 创建新的套接字<br /></span><span style="color: #0000BB">$sock </span><span style="color: #007700">= </span><span style="color: #0000BB">socket_create</span><span style="color: #007700">(</span><span style="color: #0000BB">AF_INET</span><span style="color: #007700">, </span><span style="color: #0000BB">SOCK_STREAM</span><span style="color: #007700">, </span><span style="color: #0000BB">SOL_TCP</span><span style="color: #007700">);<br /><br /></span><span style="color: #FF8000">// 计算机拥有的 IP 地址示例列表<br /></span><span style="color: #0000BB">$sourceips</span><span style="color: #007700">[</span><span style="color: #DD0000">'kevin'</span><span style="color: #007700">]    = </span><span style="color: #DD0000">'127.0.0.1'</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">$sourceips</span><span style="color: #007700">[</span><span style="color: #DD0000">'madcoder'</span><span style="color: #007700">] = </span><span style="color: #DD0000">'127.0.0.2'</span><span style="color: #007700">;<br /><br /></span><span style="color: #FF8000">// 绑定源地址<br /></span><span style="color: #0000BB">socket_bind</span><span style="color: #007700">(</span><span style="color: #0000BB">$sock</span><span style="color: #007700">, </span><span style="color: #0000BB">$sourceips</span><span style="color: #007700">[</span><span style="color: #DD0000">'madcoder'</span><span style="color: #007700">]);<br /><br /></span><span style="color: #FF8000">// 连接到目标地址<br /></span><span style="color: #0000BB">socket_connect</span><span style="color: #007700">(</span><span style="color: #0000BB">$sock</span><span style="color: #007700">, </span><span style="color: #DD0000">'127.0.0.1'</span><span style="color: #007700">, </span><span style="color: #0000BB">80</span><span style="color: #007700">);<br /><br /></span><span style="color: #FF8000">// 写入<br /></span><span style="color: #0000BB">$request </span><span style="color: #007700">= </span><span style="color: #DD0000">'GET / HTTP/1.1' </span><span style="color: #007700">. </span><span style="color: #DD0000">"\r\n" </span><span style="color: #007700">.<br />           </span><span style="color: #DD0000">'Host: example.com' </span><span style="color: #007700">. </span><span style="color: #DD0000">"\r\n\r\n"</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">socket_write</span><span style="color: #007700">(</span><span style="color: #0000BB">$sock</span><span style="color: #007700">, </span><span style="color: #0000BB">$request</span><span style="color: #007700">);<br /><br /></span><span style="color: #FF8000">// 关闭<br /></span><span style="color: #0000BB">socket_close</span><span style="color: #007700">(</span><span style="color: #0000BB">$sock</span><span style="color: #007700">);<br /><br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
    </div>

   </div>
  </p>
 </div>


 <div class="refsect1 notes" id="refsect1-function.socket-bind-notes">
  <h3 class="title">注释</h3>
  <blockquote class="note"><p><strong class="note">Note</strong>: 
   <p class="para">
    该函数必须在 <span class="function"><a href="function.socket-connect.html" class="function">socket_connect()</a></span> 之前使用。
   </p>
  </p></blockquote>
  <blockquote class="note"><p><strong class="note">Note</strong>: 
   <p class="para">
    Windows 9x/ME 兼容性注意点:
    如果尝试绑定套接字资源到一个错误的地址，而这个地址不是本机的地址，那么 <span class="function"><a href="function.socket-last-error.html" class="function">socket_last_error()</a></span> 可能会返回一个无效的错误代码。
   </p>
  </p></blockquote>
 </div>


 <div class="refsect1 seealso" id="refsect1-function.socket-bind-seealso">
  <h3 class="title">参见</h3>
  <p class="para">
   <ul class="simplelist">
    <li class="member"><span class="function"><a href="function.socket-connect.html" class="function" rel="rdfs-seeAlso">socket_connect()</a> - 开启一个套接字连接</span></li>
    <li class="member"><span class="function"><a href="function.socket-listen.html" class="function" rel="rdfs-seeAlso">socket_listen()</a> - 监听套接字的连接</span></li>
    <li class="member"><span class="function"><a href="function.socket-create.html" class="function" rel="rdfs-seeAlso">socket_create()</a> - 创建一个套接字（通讯节点）</span></li>
    <li class="member"><span class="function"><a href="function.socket-last-error.html" class="function" rel="rdfs-seeAlso">socket_last_error()</a> - 返回套接字上的最后一个错误</span></li>
    <li class="member"><span class="function"><a href="function.socket-strerror.html" class="function" rel="rdfs-seeAlso">socket_strerror()</a> - 返回描述套接字错误的字符串</span></li>
   </ul>
  </p>
 </div>


</div><div id="usernotes">
 <div class="head">
  <h3 class="title">User Contributed Notes</h3>
 </div>
<div id="allnotes">  <a name="126870""></a>
  <div class="note">
   <strong class="user">ealexs at gmail dot com</strong>
   <a href="#126870" class="date">22-Feb-2022 12:25</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I am posting this as I've spent a few hours debugging this.<br />
<br />
If you use socket_create / socket_bind with Unix domain sockets, then using socket_close at the end is not sufficient. You will get "address already in use" the second time you run your script. Call unlink on the file that is used for Unix domain sockets, preferably before you start to create the socket.<br />
<br />
<span class="default">&lt;?php<br />
<br />
$socket_file </span><span class="keyword">= </span><span class="string">"./test.sock"</span><span class="keyword">;<br />
<br />
if (</span><span class="default">file_exists</span><span class="keyword">(</span><span class="default">$socket_file</span><span class="keyword">))<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">unlink</span><span class="keyword">(</span><span class="default">$socket_file</span><span class="keyword">);<br />
</span><span class="comment"># optional file lock<br />
</span><span class="default">$socket </span><span class="keyword">= </span><span class="default">socket_create</span><span class="keyword">(</span><span class="default">AF_UNIX</span><span class="keyword">, </span><span class="default">SOCK_STREAM</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">);<br />
</span><span class="comment"># ... socket_set_option ...<br />
</span><span class="default">socket_bind</span><span class="keyword">(</span><span class="default">$socket</span><span class="keyword">, </span><span class="default">$socket_file</span><span class="keyword">);<br />
</span><span class="comment"># ...<br />
</span><span class="default">socket_close</span><span class="keyword">(</span><span class="default">$socket</span><span class="keyword">);<br />
</span><span class="comment"># optional : release lock<br />
</span><span class="default">unlink</span><span class="keyword">(</span><span class="default">$socket_file</span><span class="keyword">);<br />
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="112501""></a>
  <div class="note">
   <strong class="user">gabriel at plenitech dot fr</strong>
   <a href="#112501" class="date">23-Jun-2013 12:29</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
When doing Unix sockets, it might be necessary to chmod the socket file so as to give Write permission to Group and/or Others. Otherwise, only the owner is allowed to write data into the stream.<br />
<br />
Example:<br />
<br />
<span class="default">&lt;?php<br />
$sockpath </span><span class="keyword">= </span><span class="string">'/tmp/my.sock'</span><span class="keyword">;<br />
</span><span class="default">socket_bind</span><span class="keyword">(</span><span class="default">$socket</span><span class="keyword">, </span><span class="default">$sockpath</span><span class="keyword">);<br />
</span><span class="comment">//here: write-only (socket_send) to others, only owner can fetch data.<br />
</span><span class="default">chmod</span><span class="keyword">(</span><span class="default">$sockpath</span><span class="keyword">, </span><span class="default">0702</span><span class="keyword">);<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="106599""></a>
  <div class="note">
   <strong class="user">dresende at thinkdigital dot pt</strong>
   <a href="#106599" class="date">21-Nov-2011 09:39</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Regarding previous post:<br />
<br />
"0" has address is no different from "0.0.0.0"<br />
<br />
127.0.0.1 -&gt; accept only from local host<br />
w.x.y.z (valid local IP) -&gt; accep only from this network<br />
0.0.0.0 -&gt; accept from anywhere</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="105774""></a>
  <div class="note">
   <strong class="user">Mex</strong>
   <a href="#105774" class="date">13-Sep-2011 05:25</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
It appears for the $address parameter:<br />
<br />
'127.0.0.1'<br />
accepts clients from localhost (eg. 127.0.0.1)<br />
<br />
'0.0.0.0'<br />
accepts clients from localhost, and the server's network (eg. 127.0.0.1, 192.168.2.5, 10.20.30.40)<br />
<br />
'0' or 0<br />
accepts clients from localhost, the server's network, and external networks (eg. 127.0.0.1, 192.168.2.5, 10.20.30.40, 209.85.169.99)</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="53786""></a>
  <div class="note">
   <strong class="user">php50613160534 dot 3 dot korkman at spamgourmet dot org</strong>
   <a href="#53786" class="date">13-Jun-2005 06:16</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Use 0 for port to bind a random (free) port for incoming connections:<br />
<br />
socket_bind ($socket, $bind_address, 0);<br />
socket_getsockname($socket, $socket_address, $socket_port);<br />
socket_listen($socket);<br />
...<br />
<br />
$socket_port contains the assigned port, you might want to send it to a remote client connecting. Tested with php 5.03.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="31793""></a>
  <div class="note">
   <strong class="user">gasket at cekkent dot net</strong>
   <a href="#31793" class="date">03-May-2003 06:19</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
The aforementioned tidbit about using NULL to bind to all addresses did not work for me, as I would receive an error about unknown address. Using a 0 worked for me:<br />
<br />
socket_bind ($socket, 0, $port)<br />
<br />
This also allows you to receive UDP broadcasts, which is what I had been trying to figure out.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="22200""></a>
  <div class="note">
   <strong class="user">keksov[at]gmx.de</strong>
   <a href="#22200" class="date">10-Jun-2002 11:22</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you want to reuse address and port, and get rid of error: unable to bind, address already in use, you have to use socket_setopt (check actual spelling for this function in you PHP verison) before calling bind:
<br />

<br />
<span class="default">&lt;?php
<br />
</span><span class="keyword">if (!</span><span class="default">socket_set_option</span><span class="keyword">(</span><span class="default">$sock</span><span class="keyword">, </span><span class="default">SOL_SOCKET</span><span class="keyword">, </span><span class="default">SO_REUSEADDR</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">)) {
<br />
&nbsp;&nbsp;&nbsp; echo </span><span class="default">socket_strerror</span><span class="keyword">(</span><span class="default">socket_last_error</span><span class="keyword">(</span><span class="default">$sock</span><span class="keyword">));
<br />
&nbsp;&nbsp;&nbsp; exit;
<br />
}
<br />
</span><span class="default">?&gt;
<br />
</span>
<br />
This solution was found by 
<br />
Christophe Dirac. Thank you Christophe!</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
</div>
</div>
</div></div></body></html>
