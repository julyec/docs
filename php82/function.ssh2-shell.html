<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
 <head>
  <meta http-equiv="content-type" content="text/html; CHARSET=UTF-8">
  <title>Request an interactive shell</title>
<link media="all" rel="stylesheet" type="text/css" href="styles/03e73060321a0a848018724a6c83de7f-theme-base.css" />
<link media="all" rel="stylesheet" type="text/css" href="styles/03e73060321a0a848018724a6c83de7f-theme-medium.css" />

  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <link media="all" rel="stylesheet" type="text/css" href="style.css"/>
 </head>
 <body class="docs" class="docs"><div class="navbar navbar-fixed-top">
  <div class="navbar-inner clearfix">
    <ul class="nav" style="width: 100%">
      <li style="float: left;"><a href="function.ssh2-sftp.html">? ssh2_sftp</a></li>
      <li style="float: right;"><a href="function.ssh2-tunnel.html">ssh2_tunnel ?</a></li>
    </ul>
  </div>
</div>
<div id="breadcrumbs" class="clearfix">
  <ul class="breadcrumbs-container">
    <li><a href="index.html">PHP Manual</a></li>
    <li><a href="ref.ssh2.html">SSH2 函数</a></li>
    <li>Request an interactive shell</li>
  </ul>
</div>
<div id="layout">
  <div id="layout-content"><div id="function.ssh2-shell" class="refentry">
 <div class="refnamediv">
  <h1 class="refname">ssh2_shell</h1>
  <p class="verinfo">(PECL ssh2 &gt;= 0.9.0)</p><p class="refpurpose"><span class="refname">ssh2_shell</span> &mdash; <span class="dc-title">Request an interactive shell</span></p>

 </div>
 
 <div class="refsect1 description" id="refsect1-function.ssh2-shell-description">
  <h3 class="title">说明</h3>
  <div class="methodsynopsis dc-description">
   <span class="methodname"><strong>ssh2_shell</strong></span>(<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="methodparam"><span class="type">resource</span> <code class="parameter">$session</code></span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="methodparam"><span class="type">string</span> <code class="parameter">$termtype</code><span class="initializer"> = &quot;vanilla&quot;</span></span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="methodparam"><span class="type">?</span><span class="type"><span class="type">array</span><span class="type"></span></span> <code class="parameter">$env</code><span class="initializer"> = <strong><code>null</code></strong></span></span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="methodparam"><span class="type">int</span> <code class="parameter">$width</code><span class="initializer"> = 80</span></span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="methodparam"><span class="type">int</span> <code class="parameter">$height</code><span class="initializer"> = 25</span></span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="methodparam"><span class="type">int</span> <code class="parameter">$width_height_type</code><span class="initializer"> = SSH2_TERM_UNIT_CHARS</span></span><br>): <span class="type"><span class="type">resource</span>|<span class="type"><span class="type false">false</span></span></span></div>

  <p class="para rdfs-comment">
   Open a shell at the remote end and allocate a stream for it.
  </p>
 </div>


 <div class="refsect1 parameters" id="refsect1-function.ssh2-shell-parameters">
  <h3 class="title">参数</h3>
  <p class="para">
   <dl>
    
     <dt>
<code class="parameter">session</code></dt>

     <dd>

      <p class="para">
       An SSH connection link identifier, obtained from a call to
       <span class="function"><a href="function.ssh2-connect.html" class="function">ssh2_connect()</a></span>.
      </p>
     </dd>

    
    
     <dt>
<code class="parameter">termtype</code></dt>

     <dd>

      <p class="para">
       <code class="parameter">termtype</code> should correspond to one of the
       entries in the target system&#039;s <code class="literal">/etc/termcap</code> file.
      </p>
     </dd>

    
    
     <dt>
<code class="parameter">env</code></dt>

     <dd>

      <p class="para">
       <code class="parameter">env</code> may be passed as an associative array of
       name/value pairs to set in the target environment.
      </p>
     </dd>

    
    
     <dt>
<code class="parameter">width</code></dt>

     <dd>

      <p class="para">
       Width of the virtual terminal.
      </p>
     </dd>

    
    
     <dt>
<code class="parameter">height</code></dt>

     <dd>

      <p class="para">
       Height of the virtual terminal.
      </p>
     </dd>

    
    
     <dt>
<code class="parameter">width_height_type</code></dt>

     <dd>

      <p class="para">
       <code class="parameter">width_height_type</code> should be one of
       <strong><code>SSH2_TERM_UNIT_CHARS</code></strong> or
       <strong><code>SSH2_TERM_UNIT_PIXELS</code></strong>.
      </p>
     </dd>

    
   </dl>

  </p>
 </div>


 <div class="refsect1 returnvalues" id="refsect1-function.ssh2-shell-returnvalues">
  <h3 class="title">返回值</h3>
  <p class="para">
   Returns a stream <a href="language.types.resource.html" class="link">资源(resource)</a> on success,  或者在失败时返回 <strong><code>false</code></strong>.
  </p>
 </div>


 <div class="refsect1 examples" id="refsect1-function.ssh2-shell-examples">
  <h3 class="title">示例</h3>
  <p class="para">
   <div class="example" id="">
    <p><strong>Example #1 Requesting an interactive shell</strong></p>
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br />$connection </span><span style="color: #007700">= </span><span style="color: #0000BB">ssh2_connect</span><span style="color: #007700">(</span><span style="color: #DD0000">'shell.example.com'</span><span style="color: #007700">, </span><span style="color: #0000BB">22</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">ssh2_auth_password</span><span style="color: #007700">(</span><span style="color: #0000BB">$connection</span><span style="color: #007700">, </span><span style="color: #DD0000">'username'</span><span style="color: #007700">, </span><span style="color: #DD0000">'password'</span><span style="color: #007700">);<br /><br /></span><span style="color: #0000BB">$stream </span><span style="color: #007700">= </span><span style="color: #0000BB">ssh2_shell</span><span style="color: #007700">(</span><span style="color: #0000BB">$connection</span><span style="color: #007700">, </span><span style="color: #DD0000">'vt102'</span><span style="color: #007700">, </span><span style="color: #0000BB">null</span><span style="color: #007700">, </span><span style="color: #0000BB">80</span><span style="color: #007700">, </span><span style="color: #0000BB">24</span><span style="color: #007700">, </span><span style="color: #0000BB">SSH2_TERM_UNIT_CHARS</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
    </div>

   </div>
  </p>
 </div>


 <div class="refsect1 seealso" id="refsect1-function.ssh2-shell-seealso">
  <h3 class="title">参见</h3>
  <p class="para">
   <ul class="simplelist">
    <li class="member"><span class="function"><a href="function.ssh2-exec.html" class="function" rel="rdfs-seeAlso">ssh2_exec()</a> - Execute a command on a remote server</span></li>
    <li class="member"><span class="function"><a href="function.ssh2-tunnel.html" class="function" rel="rdfs-seeAlso">ssh2_tunnel()</a> - Open a tunnel through a remote server</span></li>
    <li class="member"><span class="function"><a href="function.ssh2-fetch-stream.html" class="function" rel="rdfs-seeAlso">ssh2_fetch_stream()</a> - Fetch an extended data stream</span></li>
   </ul>
  </p>
 </div>


</div><div id="usernotes">
 <div class="head">
  <h3 class="title">User Contributed Notes</h3>
 </div>
<div id="allnotes">  <a name="125227""></a>
  <div class="note">
   <strong class="user">nogueiraconsultoria at gmail dot com</strong>
   <a href="#125227" class="date">29-Jul-2020 01:25</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I get it a work script for multiple commands. This script return&nbsp; output of each command on array, indexed by the "command".<br />
<br />
Att: ssh2_cmd() dont work for multiple commands, thus ssh2_shell(). Attencion for de EOL on witch type of SO. I used "\n" at the end of witch command, but maybe other options like "&lt;br&gt;, ; , etc);<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $connection = ssh2_connect($input_host_ip, 22);<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (false === $connection) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; error_log("ERROR fun??o SSH_UMTELECOM: Connection failed!\n",3,$log_file);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; exit();<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }else{<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if($debugar){error_log("SSH_UMTELECOM: Connection success to $input_host_ip!\n",3,$log_file);}<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $auth = @ssh2_auth_password($connection, $user, $pass);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (false === $auth) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; error_log("ERROR fun??o SSH_UMTELECOM: Authentication failed on $input_host_ip (user: $user)!\n",3,$log_file);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; exit();<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }else{<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if($debugar){error_log("SSH_UMTELECOM: Authentication success to $input_host_ip!\n",3,$log_file);}<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; error_log("Iniciando Stream: $connection\n",3,$log_file);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $output_array = array();<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $shell = ssh2_shell($connection, 'vt100');<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; foreach($input_cmd as $cmd){<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if($debugar){error_log("shell: $cmd\n",3,$log_file);}<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $output_stream = ""; # Limpa variável para cada intera??o<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; fwrite($shell, "$cmd\n"); # N?o esquecer o "\n" ao término de cada comando<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; #stream_set_blocking($shell, true); # N?o funciona, aguarda infinitamente<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; sleep(2); # 2 segundos para redes com alta latência<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; while($output_streams = fgets($shell)){<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $output_stream .= $output_streams;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; flush();# Limpa o conteúdo para a próxima intera??o<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $output_array[] = $output_stream; # Reune cada retorno em seu respectivo comando<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; fclose($shell); # Gracius logout from shell<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }# Fim if false === $auth<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }# Fim if false === $conenection</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="114815""></a>
  <div class="note">
   <strong class="user">tuxedobob at mac dot com</strong>
   <a href="#114815" class="date">08-Apr-2014 08:37</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Keep in mind that when using ssh2_shell, the remote system's EOL may not be the same as PHP's EOL, so it may not be safe to use PHP_EOL. The native EOL for Windows is \r\n, while Unix is typically merely \n, and classic Mac for some reason is \r.<br />
<br />
If you're running PHP on Windows (\r\n) and sshing into a Unix box (\n) you're going to end up sending extra lines. My experience so far is that it just acts as though you typed nothing, which may cause issues with password prompts.<br />
<br />
Oh, and \n\r? Don't do that. Nobody does that.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="101793""></a>
  <div class="note">
   <strong class="user">tsschulz at gmx dot net</strong>
   <a href="#101793" class="date">11-Jan-2011 08:07</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
In my case the ssh2_shell doesn't work every time. There were many problems:<br />
- If I use stream_get_contents, the command(s) never executed<br />
- with while ($buf = fgets...) the loop never stops<br />
- without sleep(1) before stream_set_blocking, the command wasn't execute every time. Anyone knows why?<br />
That's what I made, and it works - but I think it isn't what it should be:<br />
<span class="default">&lt;?php<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $strCommand </span><span class="keyword">= </span><span class="string">'tar -C /path/to/extract -xjf /path/from/file.tar.bz2'</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$sshStream </span><span class="keyword">= </span><span class="default">ssh2_shell</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">sshSession</span><span class="keyword">, </span><span class="string">'xterm'</span><span class="keyword">, </span><span class="default">null</span><span class="keyword">, </span><span class="default">120</span><span class="keyword">, </span><span class="default">24</span><span class="keyword">, </span><span class="default">SSH2_TERM_UNIT_CHARS</span><span class="keyword">); <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">fwrite</span><span class="keyword">(</span><span class="default">$sshStream</span><span class="keyword">, </span><span class="default">$strCommand </span><span class="keyword">. </span><span class="default">PHP_EOL</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">sleep</span><span class="keyword">(</span><span class="default">1</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">stream_set_blocking</span><span class="keyword">(</span><span class="default">$sshStream</span><span class="keyword">, </span><span class="default">true</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$sshUntarRetval </span><span class="keyword">= </span><span class="string">""</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; while (</span><span class="default">$buf </span><span class="keyword">= </span><span class="default">fgets</span><span class="keyword">(</span><span class="default">$sshStream</span><span class="keyword">,</span><span class="default">4096</span><span class="keyword">)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">flush</span><span class="keyword">();<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$sshUntarRetval </span><span class="keyword">.= </span><span class="default">$buf</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">strpos</span><span class="keyword">(</span><span class="default">$buf</span><span class="keyword">, </span><span class="string">'tar -C'</span><span class="keyword">) !== </span><span class="default">false</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; break;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">fclose</span><span class="keyword">(</span><span class="default">$sshStream</span><span class="keyword">);<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="82931""></a>
  <div class="note">
   <strong class="user">stefanov at uk dot ibm dot com</strong>
   <a href="#82931" class="date">02-May-2008 08:26</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Do not use \n to end the command. Some server will fail to process. Use always the standard for PHP end of line: PHP_EOL<br />
<br />
'suri at suribala dot com"'s example should be modified as follows (also change the double quotes to single, for better performance):<br />
<br />
<span class="default">&lt;?php<br />
<br />
$con</span><span class="keyword">=</span><span class="default">ssh2_connect</span><span class="keyword">(</span><span class="string">'192.168.0.1'</span><span class="keyword">, </span><span class="default">22</span><span class="keyword">);<br />
</span><span class="default">ssh2_auth_password</span><span class="keyword">(</span><span class="default">$con</span><span class="keyword">, </span><span class="string">'user'</span><span class="keyword">, </span><span class="string">'password'</span><span class="keyword">);<br />
</span><span class="default">$shell</span><span class="keyword">=</span><span class="default">ssh2_shell</span><span class="keyword">(</span><span class="default">$con</span><span class="keyword">, </span><span class="string">'xterm'</span><span class="keyword">);<br />
</span><span class="default">fwrite</span><span class="keyword">( </span><span class="default">$shell</span><span class="keyword">, </span><span class="string">'cd /dir_one;'</span><span class="keyword">.</span><span class="default">PHP_EOL</span><span class="keyword">);<br />
</span><span class="default">fwrite</span><span class="keyword">( </span><span class="default">$shell</span><span class="keyword">, </span><span class="string">'ls -la;'</span><span class="keyword">.</span><span class="default">PHP_EOL</span><span class="keyword">);<br />
</span><span class="default">fwrite</span><span class="keyword">( </span><span class="default">$shell</span><span class="keyword">, </span><span class="string">'cd /dir_two;'</span><span class="keyword">.</span><span class="default">PHP_EOL</span><span class="keyword">);<br />
</span><span class="default">fwrite</span><span class="keyword">( </span><span class="default">$shell</span><span class="keyword">, </span><span class="string">'ls -la;'</span><span class="keyword">.</span><span class="default">PHP_EOL</span><span class="keyword">);<br />
<br />
</span><span class="default">?&gt;<br />
</span><br />
Cheers,<br />
<br />
Pimmy</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="76389""></a>
  <div class="note">
   <strong class="user">josh at hydril dot com</strong>
   <a href="#76389" class="date">12-Jul-2007 04:49</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
To run a shell script with all the variables that you would have when logged in interactively add bash -l or sh --login infront of your command.&nbsp; The script I use creates a shell script, copies the script to the box with ssh2_scp_send, then executes the script with ssh2_exec.&nbsp; Hope this helps somebody.<br />
<br />
<span class="default">&lt;?php<br />
<br />
</span><span class="comment">//Example<br />
<br />
</span><span class="default">$script1 </span><span class="keyword">= </span><span class="string">"bash -l /etc/rc.d/rc.httpd restart"</span><span class="keyword">;<br />
<br />
</span><span class="default">$connection </span><span class="keyword">= </span><span class="default">ssh2_connect</span><span class="keyword">(</span><span class="string">'shell.example.com'</span><span class="keyword">, </span><span class="default">22</span><span class="keyword">);<br />
</span><span class="default">ssh2_auth_password</span><span class="keyword">(</span><span class="default">$connection</span><span class="keyword">, </span><span class="string">'username'</span><span class="keyword">, </span><span class="string">'password'</span><span class="keyword">);<br />
<br />
</span><span class="default">$stream </span><span class="keyword">= </span><span class="default">ssh2_exec</span><span class="keyword">(</span><span class="default">$connection</span><span class="keyword">, </span><span class="default">$script1</span><span class="keyword">);<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="76276""></a>
  <div class="note">
   <strong class="user">vgopu1 at gmail dot com</strong>
   <a href="#76276" class="date">09-Jul-2007 01:17</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Hi,<br />
<br />
we could also use shell_exec to execute multiple related commands<br />
separated by semicolon (;).<br />
<br />
&nbsp;And I figured out&nbsp; problem that sometimes arise related to the execution of complex java c/c++ programs. All we need to do is to set the required environment variables. I have a environment variable in .bash_profile. This variable would be set when I log into my account normally through shell. But when we use ssh2_connect(), the environment variables in the .bash_profile are not set, all we need to do is export the required environment variables with shell_exec();<br />
<br />
example:<br />
<br />
$conn = ssh2_connect($ipaddress);<br />
ssh2_auth_password($conn,$username,$passwd);<br />
$cmd1="/path/to/program1";<br />
$cmd2="/path/to/program2";<br />
$env1="export Variable_name1=path1";<br />
$env2="export Variable_name2=path2" <br />
$stream = ssh2_exec($connection,"$env1; $env2; $cmd1; $cmd2");//this would execute all the //commands and return <br />
// stream <br />
stream_set_blocking($stream, true);<br />
while($o=fgets($stream)){<br />
echo $o.'&lt;br&gt;';<br />
}<br />
<br />
...<br />
...<br />
<br />
Thanks,<br />
Vikram Gopu .<br />
http:\\my.lsu.edu/vgopu1</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="71832""></a>
  <div class="note">
   <strong class="user">galvao at galvao dot eti dot br</strong>
   <a href="#71832" class="date">18-Dec-2006 09:03</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
In response to webmaster at spectreanime dot com:<br />
<br />
"For some obscur reasons, just after ur command, u need to make a sleep to be sure, that the command has reached the server and is running"<br />
<br />
Actually what you must do is set the blocking of the string to true, so it waits until the server sends data to the STDOUT before echoing it. <br />
<br />
So, instead of:<br />
<br />
sleep(1);<br />
<br />
Just do:<br />
<br />
stream_set_blocking($stdio, true);<br />
<br />
Best regards,</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="53645""></a>
  <div class="note">
   <strong class="user">webmaster at spectreanime dot com</strong>
   <a href="#53645" class="date">08-Jun-2005 01:38</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
// Connection to SSH server<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; echo "Connexion SSH ";<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (!($resource=@ssh2_connect("192.168.0.1"))) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; echo "[FAILED]&lt;br /&gt;";<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; exit(1);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; echo "[OK]&lt;br /&gt;";<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; // Authentification by login/passwd<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; echo "Authentification ";<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (!@ssh2_auth_password($resource,"root","your_password")) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; echo "[FAILED]&lt;br /&gt;";<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; exit(1);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; echo "[OK]&lt;br /&gt;";<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; // We need a shell<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; echo "Shell stdio ";<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (!($stdio = @ssh2_shell($resource,"xterm"))) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; echo "[FAILED]&lt;br /&gt;";<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; exit(1);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; echo "[OK]&lt;br /&gt;";<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; // Execution of any command<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; // Be careful to add an '\n' at the&nbsp; end of the command<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $command = "/bin/ls /tmp\n";<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; fwrite($stdio,$command);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; // IMPORTANT<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; // For some obscur reasons, just after ur command, u need to make a sleep to be sure, that the command has reached the server and is running<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; sleep(1);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; // Then u can fetch the stream to see what happens on stdio<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; while($line = fgets($stdio)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; flush();<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; echo $line."&lt;br /&gt;";<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; // It's always cleaner to close all stream<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; fclose($stdio);<br />
<br />
I truly hope i'll help someone :)</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="49976""></a>
  <div class="note">
   <strong class="user">suri at suribala dot com</strong>
   <a href="#49976" class="date">14-Feb-2005 05:03</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Using ssh_exec, one could execute only one command at a time. However, ssh_shell, offers greater flexibility.
<br />

<br />
Here is an example:
<br />

<br />
<span class="default">&lt;?php
<br />

<br />
$con</span><span class="keyword">=</span><span class="default">ssh2_connect</span><span class="keyword">(</span><span class="string">'192.168.0.1'</span><span class="keyword">, </span><span class="default">22</span><span class="keyword">);
<br />
</span><span class="default">ssh2_auth_password</span><span class="keyword">(</span><span class="default">$con</span><span class="keyword">, </span><span class="string">"user"</span><span class="keyword">, </span><span class="string">"password"</span><span class="keyword">);
<br />
</span><span class="default">$shell</span><span class="keyword">=</span><span class="default">ssh2_shell</span><span class="keyword">(</span><span class="default">$con</span><span class="keyword">, </span><span class="string">'xterm'</span><span class="keyword">);
<br />
</span><span class="default">fwrite</span><span class="keyword">( </span><span class="default">$shell</span><span class="keyword">, </span><span class="string">"cd /dir_one\n"</span><span class="keyword">);
<br />
</span><span class="default">fwrite</span><span class="keyword">( </span><span class="default">$shell</span><span class="keyword">, </span><span class="string">"ls -la\n"</span><span class="keyword">);
<br />
</span><span class="default">fwrite</span><span class="keyword">( </span><span class="default">$shell</span><span class="keyword">, </span><span class="string">"cd /dir_two\n"</span><span class="keyword">);
<br />
</span><span class="default">fwrite</span><span class="keyword">( </span><span class="default">$shell</span><span class="keyword">, </span><span class="string">"ls -la\n"</span><span class="keyword">);
<br />

<br />
</span><span class="default">?&gt;
<br />
</span>
<br />
Thanks Sara for your implementation and your help !</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
</div>
</div>
</div></div></body></html>
