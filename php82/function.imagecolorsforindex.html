<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
 <head>
  <meta http-equiv="content-type" content="text/html; CHARSET=UTF-8">
  <title>获取索引的颜色</title>
<link media="all" rel="stylesheet" type="text/css" href="styles/03e73060321a0a848018724a6c83de7f-theme-base.css" />
<link media="all" rel="stylesheet" type="text/css" href="styles/03e73060321a0a848018724a6c83de7f-theme-medium.css" />

  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <link media="all" rel="stylesheet" type="text/css" href="style.css"/>
 </head>
 <body class="docs" class="docs"><div class="navbar navbar-fixed-top">
  <div class="navbar-inner clearfix">
    <ul class="nav" style="width: 100%">
      <li style="float: left;"><a href="function.imagecolorset.html">? imagecolorset</a></li>
      <li style="float: right;"><a href="function.imagecolorstotal.html">imagecolorstotal ?</a></li>
    </ul>
  </div>
</div>
<div id="breadcrumbs" class="clearfix">
  <ul class="breadcrumbs-container">
    <li><a href="index.html">PHP Manual</a></li>
    <li><a href="ref.image.html">GD 和图像处理 函数</a></li>
    <li>获取索引的颜色</li>
  </ul>
</div>
<div id="layout">
  <div id="layout-content"><div id="function.imagecolorsforindex" class="refentry">
 <div class="refnamediv">
  <h1 class="refname">imagecolorsforindex</h1>
  <p class="verinfo">(PHP 4, PHP 5, PHP 7, PHP 8)</p><p class="refpurpose"><span class="refname">imagecolorsforindex</span> &mdash; <span class="dc-title">获取索引的颜色</span></p>

 </div>
 <div class="refsect1 description" id="refsect1-function.imagecolorsforindex-description">
  <h3 class="title">说明</h3>
  <div class="methodsynopsis dc-description">
   <span class="methodname"><strong>imagecolorsforindex</strong></span>(<span class="methodparam"><span class="type"><a href="class.gdimage.html" class="type GdImage">GdImage</a></span> <code class="parameter">$image</code></span>, <span class="methodparam"><span class="type">int</span> <code class="parameter">$color</code></span>): <span class="type">array</span></div>

  <p class="para rdfs-comment">
   获取指定索引的颜色。
  </p>
 </div>

 <div class="refsect1 parameters" id="refsect1-function.imagecolorsforindex-parameters">
  <h3 class="title">参数</h3>
  <p class="para">
   <dl>
    <dt>

<code class="parameter">image</code></dt>
<dd>
<p class="para">由图象创建函数(例如<span class="function"><a href="function.imagecreatetruecolor.html" class="function">imagecreatetruecolor()</a></span>)返回的 
<span class="classname"><a href="class.gdimage.html" class="classname">GdImage</a></span> 对象。</p></dd>

    
     <dt>
<code class="parameter">color</code></dt>

     <dd>

      <p class="para">
       颜色索引。
      </p>
     </dd>

    
   </dl>

  </p>
 </div>

 <div class="refsect1 returnvalues" id="refsect1-function.imagecolorsforindex-returnvalues">
  <h3 class="title">返回值</h3>
  <p class="para">
   返回具有 red、green、blue 和 alpha 的键名的关联数组，包含了指定颜色索引的适当值。
  </p>
 </div>


 <div class="refsect1 changelog" id="refsect1-function.imagecolorsforindex-changelog">
  <h3 class="title">更新日志</h3>
  <table class="doctable informaltable">
   
    <thead>
     <tr>
      <th>版本</th>
      <th>说明</th>
     </tr>

    </thead>

    <tbody class="tbody">
     <tr>
 <td>8.0.0</td>
 <td>
  <code class="parameter">image</code> 现在需要 <span class="classname"><a href="class.gdimage.html" class="classname">GdImage</a></span> 实例；之前需要有效的 <code class="literal">gd</code> <span class="type">resource</span>。
 </td>
</tr>

     <tr>
      <td>8.0.0</td>
      <td>
       如果 <code class="parameter">color</code> 超出范围，<span class="function"><strong>imagecolorsforindex()</strong></span>
       现在抛出 <span class="classname"><a href="class.valueerror.html" class="classname">ValueError</a></span> 异常；之前返回 <strong><code>false</code></strong>。
      </td>
     </tr>

    </tbody>
   
  </table>

 </div>


 <div class="refsect1 examples" id="refsect1-function.imagecolorsforindex-examples">
  <h3 class="title">示例</h3>
  <p class="para">
   <div class="example" id="example-5412">
    <p><strong>Example #1 <span class="function"><strong>imagecolorsforindex()</strong></span> 示例</strong></p>
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br /><br /></span><span style="color: #FF8000">// 打开图像<br /></span><span style="color: #0000BB">$im </span><span style="color: #007700">= </span><span style="color: #0000BB">imagecreatefrompng</span><span style="color: #007700">(</span><span style="color: #DD0000">'nexen.png'</span><span style="color: #007700">);<br /><br /></span><span style="color: #FF8000">// 获取颜色<br /></span><span style="color: #0000BB">$start_x </span><span style="color: #007700">= </span><span style="color: #0000BB">40</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">$start_y </span><span style="color: #007700">= </span><span style="color: #0000BB">50</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">$color_index </span><span style="color: #007700">= </span><span style="color: #0000BB">imagecolorat</span><span style="color: #007700">(</span><span style="color: #0000BB">$im</span><span style="color: #007700">, </span><span style="color: #0000BB">$start_x</span><span style="color: #007700">, </span><span style="color: #0000BB">$start_y</span><span style="color: #007700">);<br /><br /></span><span style="color: #FF8000">// 使其可读<br /></span><span style="color: #0000BB">$color_tran </span><span style="color: #007700">= </span><span style="color: #0000BB">imagecolorsforindex</span><span style="color: #007700">(</span><span style="color: #0000BB">$im</span><span style="color: #007700">, </span><span style="color: #0000BB">$color_index</span><span style="color: #007700">);<br /><br /></span><span style="color: #FF8000">// 显示该颜色的值<br /></span><span style="color: #0000BB">print_r</span><span style="color: #007700">(</span><span style="color: #0000BB">$color_tran</span><span style="color: #007700">);<br /><br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
    </div>

    <div class="example-contents"><p>以上示例的输出类似于：</p></div>
    <div class="example-contents screen">
<div class="cdata"><pre>
Array
(
   [red] =&gt; 226
   [green] =&gt; 222
   [blue] =&gt; 252
   [alpha] =&gt; 0
)
</pre></div>
    </div>
   </div>
  </p>
 </div>

 <div class="refsect1 seealso" id="refsect1-function.imagecolorsforindex-seealso">
  <h3 class="title">参见</h3>
  <ul class="simplelist">
   <li class="member"><span class="function"><a href="function.imagecolorat.html" class="function" rel="rdfs-seeAlso">imagecolorat()</a> - 取得某像素的颜色索引值</span></li>
   <li class="member"><span class="function"><a href="function.imagecolorexact.html" class="function" rel="rdfs-seeAlso">imagecolorexact()</a> - 取得指定颜色的索引值</span></li>
  </ul>
 </div>

</div><div id="usernotes">
 <div class="head">
  <h3 class="title">User Contributed Notes</h3>
 </div>
<div id="allnotes">  <a name="86198""></a>
  <div class="note">
   <strong class="user">hofstadler dot andi at gmx dot at</strong>
   <a href="#86198" class="date">07-Oct-2008 12:36</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I have optimized the rgb2hsl function from slepichev a bit, so that it is a bit shorter and hopefully a bit faster:<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="comment">/**<br />
&nbsp;* Convert RGB colors array into HSL array<br />
&nbsp;* <br />
&nbsp;* @param array $ RGB colors set, each color component with range 0 to 255<br />
&nbsp;* @return array HSL set, each color component with range 0 to 1<br />
&nbsp;*/<br />
</span><span class="keyword">function </span><span class="default">rgb2hsl</span><span class="keyword">(</span><span class="default">$rgb</span><span class="keyword">){<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$clrR </span><span class="keyword">= (</span><span class="default">$rgb</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">]);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$clrG </span><span class="keyword">= (</span><span class="default">$rgb</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">]);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$clrB </span><span class="keyword">= (</span><span class="default">$rgb</span><span class="keyword">[</span><span class="default">2</span><span class="keyword">]);<br />
&nbsp;&nbsp; &nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$clrMin </span><span class="keyword">= </span><span class="default">min</span><span class="keyword">(</span><span class="default">$clrR</span><span class="keyword">, </span><span class="default">$clrG</span><span class="keyword">, </span><span class="default">$clrB</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$clrMax </span><span class="keyword">= </span><span class="default">max</span><span class="keyword">(</span><span class="default">$clrR</span><span class="keyword">, </span><span class="default">$clrG</span><span class="keyword">, </span><span class="default">$clrB</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$deltaMax </span><span class="keyword">= </span><span class="default">$clrMax </span><span class="keyword">- </span><span class="default">$clrMin</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$L </span><span class="keyword">= (</span><span class="default">$clrMax </span><span class="keyword">+ </span><span class="default">$clrMin</span><span class="keyword">) / </span><span class="default">510</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; <br />
&nbsp;&nbsp;&nbsp; if (</span><span class="default">0 </span><span class="keyword">== </span><span class="default">$deltaMax</span><span class="keyword">){<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$H </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$S </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; else{<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">0.5 </span><span class="keyword">&gt; </span><span class="default">$L</span><span class="keyword">){<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$S </span><span class="keyword">= </span><span class="default">$deltaMax </span><span class="keyword">/ (</span><span class="default">$clrMax </span><span class="keyword">+ </span><span class="default">$clrMin</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; else{<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$S </span><span class="keyword">= </span><span class="default">$deltaMax </span><span class="keyword">/ (</span><span class="default">510 </span><span class="keyword">- </span><span class="default">$clrMax </span><span class="keyword">- </span><span class="default">$clrMin</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">$clrMax </span><span class="keyword">== </span><span class="default">$clrR</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$H </span><span class="keyword">= (</span><span class="default">$clrG </span><span class="keyword">- </span><span class="default">$clrB</span><span class="keyword">) / (</span><span class="default">6.0 </span><span class="keyword">* </span><span class="default">$deltaMax</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; else if (</span><span class="default">$clrMax </span><span class="keyword">== </span><span class="default">$clrG</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$H </span><span class="keyword">= </span><span class="default">1</span><span class="keyword">/</span><span class="default">3 </span><span class="keyword">+ (</span><span class="default">$clrB </span><span class="keyword">- </span><span class="default">$clrR</span><span class="keyword">) / (</span><span class="default">6.0 </span><span class="keyword">* </span><span class="default">$deltaMax</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; else {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$H </span><span class="keyword">= </span><span class="default">2 </span><span class="keyword">/ </span><span class="default">3 </span><span class="keyword">+ (</span><span class="default">$clrR </span><span class="keyword">- </span><span class="default">$clrG</span><span class="keyword">) / (</span><span class="default">6.0 </span><span class="keyword">* </span><span class="default">$deltaMax</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">0 </span><span class="keyword">&gt; </span><span class="default">$H</span><span class="keyword">) </span><span class="default">$H </span><span class="keyword">+= </span><span class="default">1</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">1 </span><span class="keyword">&lt; </span><span class="default">$H</span><span class="keyword">) </span><span class="default">$H </span><span class="keyword">-= </span><span class="default">1</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; return array(</span><span class="default">$H</span><span class="keyword">, </span><span class="default">$S</span><span class="keyword">,</span><span class="default">$L</span><span class="keyword">);<br />
}<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="84969""></a>
  <div class="note">
   <strong class="user">matrebatre</strong>
   <a href="#84969" class="date">07-Aug-2008 11:11</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Be aware that<br />
<br />
<span class="default">&lt;?php<br />
$rgba&nbsp; &nbsp;&nbsp; </span><span class="keyword">= </span><span class="default">imagecolorat</span><span class="keyword">(</span><span class="default">$image</span><span class="keyword">, </span><span class="default">$x</span><span class="keyword">, </span><span class="default">$y</span><span class="keyword">);<br />
</span><span class="default">$r </span><span class="keyword">= (</span><span class="default">$rgba </span><span class="keyword">&gt;&gt; </span><span class="default">16</span><span class="keyword">) &amp; </span><span class="default">0xFF</span><span class="keyword">;<br />
</span><span class="default">$g </span><span class="keyword">= (</span><span class="default">$rgba </span><span class="keyword">&gt;&gt; </span><span class="default">8</span><span class="keyword">) &amp; </span><span class="default">0xFF</span><span class="keyword">;<br />
</span><span class="default">$b </span><span class="keyword">= </span><span class="default">$rgba </span><span class="keyword">&amp; </span><span class="default">0xFF</span><span class="keyword">;<br />
</span><span class="default">$a&nbsp; &nbsp;&nbsp; </span><span class="keyword">= (</span><span class="default">$rgba </span><span class="keyword">&amp; </span><span class="default">0x7F000000</span><span class="keyword">) &gt;&gt; </span><span class="default">24</span><span class="keyword">;<br />
</span><span class="default">?&gt;</span> <br />
<br />
will only work for truecolor images. With eg GIF images, this will have strange results. For GIF images, you should always use imagecolorsforindex().</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="79511""></a>
  <div class="note">
   <strong class="user">derek at idreams dot co dot uk</strong>
   <a href="#79511" class="date">30-Nov-2007 12:45</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
The earlier microsoft sepia example seemed to have a factor in which made it pinky... here is a modified example which uses just the Microsoft sepia (as per the wiki sepia entry)<br />
<br />
&lt;?<br />
function imagetosepia(&amp;$img) {<br />
&nbsp; if (!($t = imagecolorstotal($img))) {<br />
&nbsp;&nbsp;&nbsp; $t = 256;<br />
&nbsp;&nbsp;&nbsp; imagetruecolortopalette($img, true, $t);<br />
&nbsp; }<br />
&nbsp; $total = imagecolorstotal( $img );<br />
&nbsp; for ( $i = 0; $i &lt; $total; $i++ ) {<br />
&nbsp;&nbsp;&nbsp; $index = imagecolorsforindex( $img, $i );<br />
&nbsp;&nbsp;&nbsp; $red = ( $index["red"] * 0.393 + $index["green"] * 0.769 + $index["blue"] * 0.189 );<br />
&nbsp;&nbsp;&nbsp; $green = ( $index["red"] * 0.349 + $index["green"] * 0.686 + $index["blue"] * 0.168 ); <br />
&nbsp;&nbsp;&nbsp; $blue = ( $index["red"] * 0.272 + $index["green"] * 0.534 + $index["blue"] * 0.131 ); <br />
&nbsp;&nbsp;&nbsp; if ($red &gt; 255) { $red = 255; }<br />
&nbsp;&nbsp;&nbsp; if ($green &gt; 255) { $green = 255; }<br />
&nbsp;&nbsp;&nbsp; if ($blue &gt; 255) { $blue = 255; }<br />
&nbsp;&nbsp;&nbsp; imagecolorset( $img, $i, $red, $green, $blue );<br />
&nbsp; }<br />
}<br />
?&gt;</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="79459""></a>
  <div class="note">
   <strong class="user">joe dot scylla at gmail dot com</strong>
   <a href="#79459" class="date">28-Nov-2007 06:35</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
While it's quite easy and intuitive to get the alpha transparency of a pixel with:<br />
<br />
<span class="default">&lt;?php<br />
$rgba&nbsp; &nbsp;&nbsp; </span><span class="keyword">= </span><span class="default">imagecolorsforindex</span><span class="keyword">(</span><span class="default">$image</span><span class="keyword">, </span><span class="default">imagecolorat</span><span class="keyword">(</span><span class="default">$image</span><span class="keyword">, </span><span class="default">$x</span><span class="keyword">, </span><span class="default">$y</span><span class="keyword">));<br />
</span><span class="default">$alpha&nbsp; &nbsp;&nbsp; </span><span class="keyword">= </span><span class="default">$rgba</span><span class="keyword">[</span><span class="string">"alpha"</span><span class="keyword">];<br />
</span><span class="default">?&gt;<br />
</span><br />
you should use the return value of the command imagecolorat to get the alpha transparency with the code below because it's much faster and will have a major impact if you process every pixel of an image:<br />
<br />
<span class="default">&lt;?php<br />
$rgba&nbsp; &nbsp;&nbsp; </span><span class="keyword">= </span><span class="default">imagecolorat</span><span class="keyword">(</span><span class="default">$image</span><span class="keyword">, </span><span class="default">$x</span><span class="keyword">, </span><span class="default">$y</span><span class="keyword">);<br />
</span><span class="default">$alpha&nbsp; &nbsp;&nbsp; </span><span class="keyword">= (</span><span class="default">$rgba </span><span class="keyword">&amp; </span><span class="default">0x7F000000</span><span class="keyword">) &gt;&gt; </span><span class="default">24</span><span class="keyword">;<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="77709""></a>
  <div class="note">
   <strong class="user">tim at leethost dot com</strong>
   <a href="#77709" class="date">09-Sep-2007 10:01</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Here's a better grayscale, sepia, and general tinting function.&nbsp; This function is better because:<br />
<br />
1) Works with true color images (the other sepia code didn't).<br />
2) Provides a more gooder grayscale conversion (yes, I said "more gooder").&nbsp; The other grayscale code used imagetruecolortopalette, which just doesn't work well for grayscale conversion.<br />
3) The other sepia code was really colorful, a little too much for my taste.&nbsp; This function allows you to optionally set the tinting of the grayscale to anything you wish.<br />
4) Single function for grayscale, sepia, and any other tinting you can dream up.<br />
<br />
Here's some examples:<br />
<br />
imagegrayscaletint ($img);&nbsp; // Grayscale, no tinting<br />
imagegrayscaletint ($img,304,242,209);&nbsp; // What I use for sepia<br />
imagegrayscaletint ($img,0,0,255);&nbsp; // A berry blue image<br />
<br />
The RGB values for tinting are normally from 0 to 255.&nbsp; But, you can use values larger than 255 to lighten and "burn" the image.&nbsp; The sepia example above does this a little, the below example provides a better example of lightening the image and burning the light areas out a little:<br />
<br />
imagegrayscaletint ($img,400,400,400);&nbsp; // Lighten image<br />
imagegrayscaletint ($img,127,127,127);&nbsp; // Darken image<br />
<br />
&lt;?<br />
function imagegrayscaletint (&amp;$img, $tint_r = 255, $tint_g = 255, $tint_b = 255) {<br />
&nbsp; $width = imagesx($img); $height = imagesy($img);<br />
&nbsp; $dest = imagecreate ($width, $height);<br />
&nbsp; for ($i=0; $i&lt;256; $i++) imagecolorallocate ($dest, $i, $i, $i);<br />
&nbsp; imagecopyresized ($dest, $img, 0, 0, 0, 0, $width, $height, $width, $height);<br />
&nbsp; for ($i = 0; $i &lt; 256; $i++) imagecolorset ($dest, $i, min($i * abs($tint_r) / 255, 255), min($i * abs($tint_g) / 255, 255), min($i * abs($tint_b) / 255, 255));<br />
&nbsp; $img = imagecreate ($width, $height);<br />
&nbsp; imagecopy ($img, $dest, 0, 0, 0, 0, $width, $height);<br />
&nbsp; imagedestroy ($dest);<br />
}<br />
?&gt;</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="77628""></a>
  <div class="note">
   <strong class="user">slepichev at yahoo dot com</strong>
   <a href="#77628" class="date">06-Sep-2007 03:50</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you would like to change the intensity or lightness level of a specific color, you will need to convert the color format from RGB to HSL. <br />
following function convert RGB array(red,green,blue) to HSL array(hue, saturation, lightness)<br />
<span class="default">&lt;?php<br />
</span><span class="comment">/**<br />
&nbsp;* Convert RGB colors array into HSL array<br />
&nbsp;* <br />
&nbsp;* @param array $ RGB colors set<br />
&nbsp;* @return array HSL set<br />
&nbsp;*/<br />
&nbsp;</span><span class="keyword">function </span><span class="default">rgb2hsl</span><span class="keyword">(</span><span class="default">$rgb</span><span class="keyword">){<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; </span><span class="default">$clrR </span><span class="keyword">= (</span><span class="default">$rgb</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">] / </span><span class="default">255</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; </span><span class="default">$clrG </span><span class="keyword">= (</span><span class="default">$rgb</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">] / </span><span class="default">255</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; </span><span class="default">$clrB </span><span class="keyword">= (</span><span class="default">$rgb</span><span class="keyword">[</span><span class="default">2</span><span class="keyword">] / </span><span class="default">255</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; </span><span class="default">$clrMin </span><span class="keyword">= </span><span class="default">min</span><span class="keyword">(</span><span class="default">$clrR</span><span class="keyword">, </span><span class="default">$clrG</span><span class="keyword">, </span><span class="default">$clrB</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; </span><span class="default">$clrMax </span><span class="keyword">= </span><span class="default">max</span><span class="keyword">(</span><span class="default">$clrR</span><span class="keyword">, </span><span class="default">$clrG</span><span class="keyword">, </span><span class="default">$clrB</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; </span><span class="default">$deltaMax </span><span class="keyword">= </span><span class="default">$clrMax </span><span class="keyword">- </span><span class="default">$clrMin</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; </span><span class="default">$L </span><span class="keyword">= (</span><span class="default">$clrMax </span><span class="keyword">+ </span><span class="default">$clrMin</span><span class="keyword">) / </span><span class="default">2</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; if (</span><span class="default">0 </span><span class="keyword">== </span><span class="default">$deltaMax</span><span class="keyword">){<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$H </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$S </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; }<br />
&nbsp;&nbsp;&nbsp; else{<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; if (</span><span class="default">0.5 </span><span class="keyword">&gt; </span><span class="default">$L</span><span class="keyword">){<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$S </span><span class="keyword">= </span><span class="default">$deltaMax </span><span class="keyword">/ (</span><span class="default">$clrMax </span><span class="keyword">+ </span><span class="default">$clrMin</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; else{<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$S </span><span class="keyword">= </span><span class="default">$deltaMax </span><span class="keyword">/ (</span><span class="default">2 </span><span class="keyword">- </span><span class="default">$clrMax </span><span class="keyword">- </span><span class="default">$clrMin</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$deltaR </span><span class="keyword">= (((</span><span class="default">$clrMax </span><span class="keyword">- </span><span class="default">$clrR</span><span class="keyword">) / </span><span class="default">6</span><span class="keyword">) + (</span><span class="default">$deltaMax </span><span class="keyword">/ </span><span class="default">2</span><span class="keyword">)) / </span><span class="default">$deltaMax</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$deltaG </span><span class="keyword">= (((</span><span class="default">$clrMax </span><span class="keyword">- </span><span class="default">$clrG</span><span class="keyword">) / </span><span class="default">6</span><span class="keyword">) + (</span><span class="default">$deltaMax </span><span class="keyword">/ </span><span class="default">2</span><span class="keyword">)) / </span><span class="default">$deltaMax</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$deltaB </span><span class="keyword">= (((</span><span class="default">$clrMax </span><span class="keyword">- </span><span class="default">$clrB</span><span class="keyword">) / </span><span class="default">6</span><span class="keyword">) + (</span><span class="default">$deltaMax </span><span class="keyword">/ </span><span class="default">2</span><span class="keyword">)) / </span><span class="default">$deltaMax</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; if (</span><span class="default">$clrR </span><span class="keyword">== </span><span class="default">$clrMax</span><span class="keyword">){<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$H </span><span class="keyword">= </span><span class="default">$deltaB </span><span class="keyword">- </span><span class="default">$deltaG</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; else if (</span><span class="default">$clrG </span><span class="keyword">== </span><span class="default">$clrMax</span><span class="keyword">){<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$H </span><span class="keyword">= (</span><span class="default">1 </span><span class="keyword">/ </span><span class="default">3</span><span class="keyword">) + </span><span class="default">$deltaR </span><span class="keyword">- </span><span class="default">$deltaB</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; else if (</span><span class="default">$clrB </span><span class="keyword">== </span><span class="default">$clrMax</span><span class="keyword">){<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$H </span><span class="keyword">= (</span><span class="default">2 </span><span class="keyword">/ </span><span class="default">3</span><span class="keyword">) + </span><span class="default">$deltaG </span><span class="keyword">- </span><span class="default">$deltaR</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; if (</span><span class="default">0 </span><span class="keyword">&gt; </span><span class="default">$H</span><span class="keyword">) </span><span class="default">$H </span><span class="keyword">+= </span><span class="default">1</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; if (</span><span class="default">1 </span><span class="keyword">&lt; </span><span class="default">$H</span><span class="keyword">) </span><span class="default">$H </span><span class="keyword">-= </span><span class="default">1</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; }<br />
&nbsp;&nbsp; &nbsp; return array(</span><span class="default">$H</span><span class="keyword">, </span><span class="default">$S</span><span class="keyword">, </span><span class="default">$L</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; }<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="77366""></a>
  <div class="note">
   <strong class="user">admin at phpgfx dot com</strong>
   <a href="#77366" class="date">26-Aug-2007 09:54</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
this is a sepia filter using microsoft's definition<br />
<br />
<span class="default">&lt;?php<br />
<br />
</span><span class="keyword">function </span><span class="default">imagesepia</span><span class="keyword">( </span><span class="default">$img </span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$total </span><span class="keyword">= </span><span class="default">imagecolorstotal</span><span class="keyword">( </span><span class="default">$img </span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; for ( </span><span class="default">$i </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">; </span><span class="default">$i </span><span class="keyword">&lt; </span><span class="default">$total</span><span class="keyword">; </span><span class="default">$i</span><span class="keyword">++ ) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$index </span><span class="keyword">= </span><span class="default">imagecolorsforindex</span><span class="keyword">( </span><span class="default">$img</span><span class="keyword">, </span><span class="default">$i </span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$red </span><span class="keyword">= ( </span><span class="default">$index</span><span class="keyword">[</span><span class="string">"red"</span><span class="keyword">] * </span><span class="default">0.393 </span><span class="keyword">+ </span><span class="default">$index</span><span class="keyword">[</span><span class="string">"green"</span><span class="keyword">] * </span><span class="default">0.769 </span><span class="keyword">+ </span><span class="default">$index</span><span class="keyword">[</span><span class="string">"blue"</span><span class="keyword">] * </span><span class="default">0.189 </span><span class="keyword">) / </span><span class="default">1.351</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$green </span><span class="keyword">= ( </span><span class="default">$index</span><span class="keyword">[</span><span class="string">"red"</span><span class="keyword">] * </span><span class="default">0.349 </span><span class="keyword">+ </span><span class="default">$index</span><span class="keyword">[</span><span class="string">"green"</span><span class="keyword">] * </span><span class="default">0.686 </span><span class="keyword">+ </span><span class="default">$index</span><span class="keyword">[</span><span class="string">"blue"</span><span class="keyword">] * </span><span class="default">0.168 </span><span class="keyword">) / </span><span class="default">1.203</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$blue </span><span class="keyword">= ( </span><span class="default">$index</span><span class="keyword">[</span><span class="string">"red"</span><span class="keyword">] * </span><span class="default">0.272 </span><span class="keyword">+ </span><span class="default">$index</span><span class="keyword">[</span><span class="string">"green"</span><span class="keyword">] * </span><span class="default">0.534 </span><span class="keyword">+ </span><span class="default">$index</span><span class="keyword">[</span><span class="string">"blue"</span><span class="keyword">] * </span><span class="default">0.131 </span><span class="keyword">) / </span><span class="default">2.140</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">imagecolorset</span><span class="keyword">( </span><span class="default">$img</span><span class="keyword">, </span><span class="default">$i</span><span class="keyword">, </span><span class="default">$red</span><span class="keyword">, </span><span class="default">$green</span><span class="keyword">, </span><span class="default">$blue </span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }<br />
}<br />
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="56111""></a>
  <div class="note">
   <strong class="user">adspeed.com</strong>
   <a href="#56111" class="date">23-Aug-2005 04:05</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
To correct m4551 at abasoft dot it example:<br />
<br />
ImageTrueColorToPalette($im,1,$t);<br />
<br />
might give less colors than $t, so the for loop should call "$i&lt;ImageColorsTotal($im)" instead of "$i&lt;$t" just to be sure, or you'll get the warning: Color index [0-9] out of range</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="43563""></a>
  <div class="note">
   <strong class="user">strozek(a)deas()harvard()edu</strong>
   <a href="#43563" class="date">25-Jun-2004 01:32</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Regarding m4551's method of conversion -- the actual CCIR-approved RGB-to-grayscale conversion is as follows:<br />
<br />
grayscale component = 0.2125*R + 0.7154*G + 0.0721*B<br />
<br />
(cf. CCIR Recommendation 709 for modern monitors)</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="41842""></a>
  <div class="note">
   <strong class="user">m4551 at abasoft dot it</strong>
   <a href="#41842" class="date">23-Apr-2004 09:23</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
here's a function to greyscale an image even from a truecolor source (jpeg or png).<br />
<br />
slightly poor quality, but very fast...<br />
<br />
function imagegreyscale(&amp;$img, $dither=1) {&nbsp; &nbsp; <br />
&nbsp;&nbsp;&nbsp; if (!($t = imagecolorstotal($img))) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $t = 256;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; imagetruecolortopalette($img, $dither, $t);&nbsp; &nbsp; <br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; for ($c = 0; $c &lt; $t; $c++) {&nbsp; &nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $col = imagecolorsforindex($img, $c);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $min = min($col['red'],$col['green'],$col['blue']);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $max = max($col['red'],$col['green'],$col['blue']);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $i = ($max+$min)/2;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; imagecolorset($img, $c, $i, $i, $i);<br />
&nbsp;&nbsp;&nbsp; }<br />
}</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
</div>
</div>
</div></div></body></html>
