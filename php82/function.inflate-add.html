<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
 <head>
  <meta http-equiv="content-type" content="text/html; CHARSET=UTF-8">
  <title>Incrementally inflate encoded data</title>
<link media="all" rel="stylesheet" type="text/css" href="styles/03e73060321a0a848018724a6c83de7f-theme-base.css" />
<link media="all" rel="stylesheet" type="text/css" href="styles/03e73060321a0a848018724a6c83de7f-theme-medium.css" />

  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <link media="all" rel="stylesheet" type="text/css" href="style.css"/>
 </head>
 <body class="docs" class="docs"><div class="navbar navbar-fixed-top">
  <div class="navbar-inner clearfix">
    <ul class="nav" style="width: 100%">
      <li style="float: left;"><a href="function.gzwrite.html">? gzwrite</a></li>
      <li style="float: right;"><a href="function.inflate-get-read-len.html">inflate_get_read_len ?</a></li>
    </ul>
  </div>
</div>
<div id="breadcrumbs" class="clearfix">
  <ul class="breadcrumbs-container">
    <li><a href="index.html">PHP Manual</a></li>
    <li><a href="ref.zlib.html">Zlib 函数</a></li>
    <li>Incrementally inflate encoded data</li>
  </ul>
</div>
<div id="layout">
  <div id="layout-content"><div id="function.inflate-add" class="refentry">
 <div class="refnamediv">
  <h1 class="refname">inflate_add</h1>
  <p class="verinfo">(PHP 7, PHP 8)</p><p class="refpurpose"><span class="refname">inflate_add</span> &mdash; <span class="dc-title">Incrementally inflate encoded data</span></p>

 </div>

 <div class="refsect1 description" id="refsect1-function.inflate-add-description">
  <h3 class="title">说明</h3>
  <div class="methodsynopsis dc-description">
   <span class="methodname"><strong>inflate_add</strong></span>(<span class="methodparam"><span class="type"><a href="class.inflatecontext.html" class="type InflateContext">InflateContext</a></span> <code class="parameter">$context</code></span>, <span class="methodparam"><span class="type">string</span> <code class="parameter">$data</code></span>, <span class="methodparam"><span class="type">int</span> <code class="parameter">$flush_mode</code><span class="initializer"> = <strong><code>ZLIB_SYNC_FLUSH</code></strong></span></span>): <span class="type"><span class="type">string</span>|<span class="type"><span class="type false">false</span></span></span></div>

  <p class="para rdfs-comment">
   Incrementally inflates encoded data in the specified <code class="parameter">context</code>.
  </p>
  <p class="para">
   Limitation: header information from GZIP compressed data are not made
   available.
  </p>
 </div>


 <div class="refsect1 parameters" id="refsect1-function.inflate-add-parameters">
  <h3 class="title">参数</h3>
  <dl>
   
    <dt>
<code class="parameter">context</code></dt>

    <dd>

     <p class="para">
      A context created with <span class="function"><a href="function.inflate-init.html" class="function">inflate_init()</a></span>.
     </p>
    </dd>

   
   
    <dt>
<code class="parameter">data</code></dt>

    <dd>

     <p class="para">
      A chunk of compressed data.
     </p>
    </dd>

   
   
    <dt>
<code class="parameter">flush_mode</code></dt>

    <dd>

     <p class="para">
      One of <strong><code>ZLIB_BLOCK</code></strong>,
      <strong><code>ZLIB_NO_FLUSH</code></strong>,
      <strong><code>ZLIB_PARTIAL_FLUSH</code></strong>,
      <strong><code>ZLIB_SYNC_FLUSH</code></strong> (default),
      <strong><code>ZLIB_FULL_FLUSH</code></strong>, <strong><code>ZLIB_FINISH</code></strong>.
      Normally you will want to set <strong><code>ZLIB_NO_FLUSH</code></strong> to
      maximize compression, and <strong><code>ZLIB_FINISH</code></strong> to terminate
      with the last chunk of data. See the <a href="http://www.zlib.net/manual.html" class="link external" title="Link : http://www.zlib.net/manual.html">&raquo;&nbsp;zlib manual</a> for a
      detailed description of these constants.
     </p>
    </dd>

   
  </dl>

 </div>


 <div class="refsect1 returnvalues" id="refsect1-function.inflate-add-returnvalues">
  <h3 class="title">返回值</h3>
  <p class="para">
   Returns a chunk of uncompressed data,  或者在失败时返回 <strong><code>false</code></strong>.
  </p>
 </div>


 <div class="refsect1 errors" id="refsect1-function.inflate-add-errors">
  <h3 class="title">错误／异常</h3>
  <p class="para">
   If invalid parameters are given, inflating the data requires a preset
   dictionary, but none is specified, the compressed stream is corrupt or has an
   invalid checksum, an error of level <strong><code>E_WARNING</code></strong> is
   generated.
  </p>
 </div>


 <div class="refsect1 changelog" id="refsect1-function.inflate-add-changelog">
  <h3 class="title">更新日志</h3>
  <table class="doctable informaltable">
   
    <thead>
     <tr>
      <th>版本</th>
      <th>说明</th>
     </tr>

    </thead>

    <tbody class="tbody">
     <tr>
      <td>8.0.0</td>
      <td>
       <code class="parameter">context</code> expects an <span class="classname"><a href="class.inflatecontext.html" class="classname">InflateContext</a></span>
       instance now; previously, a <span class="type">resource</span> was expected.
      </td>
     </tr>

    </tbody>
   
  </table>

 </div>


 <div class="refsect1 seealso" id="refsect1-function.inflate-add-seealso">
  <h3 class="title">参见</h3>
  <ul class="simplelist">
   <li class="member"><span class="function"><a href="function.inflate-init.html" class="function" rel="rdfs-seeAlso">inflate_init()</a> - Initialize an incremental inflate context</span></li>
  </ul>
 </div>


</div><div id="usernotes">
 <div class="head">
  <h3 class="title">User Contributed Notes</h3>
 </div>
<div id="allnotes">  <a name="128410""></a>
  <div class="note">
   <strong class="user">burp at -only-in-German-fuerspam dot de</strong>
   <a href="#128410" class="date">20-Apr-2023 12:30</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
It's not obvious how to use this for _incremental_ decompression:<br />
You feed _the compressed data_ into inflate_add() _in pieces_.<br />
The internal state of the zlib context will make sure than you can split at any point and still get the correct total data out, as long as you keep reading until the end.<br />
<br />
In this way, you don't have to hold the complete uncompressed data in memory at any one time (and don't have to materialize it either as a file for gzopen() etc.), allowing you to parse files much bigger than the available php memory limit.<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="comment">/* a good step size depends on the input's level of compression,<br />
unfortunately there's no obvious way to know that beforehand;<br />
in doubt instead choose a rather small value and glue the pieces together,<br />
until there's enough data for processing */<br />
</span><span class="default">$step </span><span class="keyword">= </span><span class="default">500000</span><span class="keyword">;<br />
<br />
</span><span class="default">$dataGz </span><span class="keyword">= </span><span class="default">load_gzip_compressed_data_to_string</span><span class="keyword">();<br />
<br />
</span><span class="default">$start </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;<br />
</span><span class="default">$outLen </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;<br />
</span><span class="default">$ctxt </span><span class="keyword">= </span><span class="default">inflate_init</span><span class="keyword">(</span><span class="default">ZLIB_ENCODING_GZIP</span><span class="keyword">);<br />
</span><span class="default">$status </span><span class="keyword">= </span><span class="default">inflate_get_status</span><span class="keyword">(</span><span class="default">$inflCtxt</span><span class="keyword">);<br />
<br />
while(</span><span class="default">$status </span><span class="keyword">== </span><span class="default">ZLIB_OK</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$split </span><span class="keyword">= </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$dataGz</span><span class="keyword">, </span><span class="default">$start</span><span class="keyword">, </span><span class="default">$step</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$dataFragment </span><span class="keyword">= </span><span class="default">inflate_add</span><span class="keyword">(</span><span class="default">$inflCtxt</span><span class="keyword">, </span><span class="default">$split</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">/* process fragment, potentially keep parts across iterations */<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$outLen </span><span class="keyword">+= </span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$dataFragment</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$status </span><span class="keyword">= </span><span class="default">inflate_get_status</span><span class="keyword">(</span><span class="default">$inflCtxt</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$start </span><span class="keyword">+= </span><span class="default">$step</span><span class="keyword">;<br />
}<br />
echo </span><span class="string">'Input: ' </span><span class="keyword">. </span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$dataGz</span><span class="keyword">) . </span><span class="string">' Bytes / Output: ' </span><span class="keyword">. </span><span class="default">$outLen </span><span class="keyword">. </span><span class="string">' Bytes.'</span><span class="keyword">;<br />
</span><span class="default">?&gt;<br />
</span><br />
N.B.: Archives of extremely high compression will still bomb out with a stupid and unnecessary memory exhaustion, as it's not possible to define a limit in inflate_init() similar to gzuncompress().</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
</div>
</div>
</div></div></body></html>
