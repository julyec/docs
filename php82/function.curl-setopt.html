<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
 <head>
  <meta http-equiv="content-type" content="text/html; CHARSET=UTF-8">
  <title>设置 cURL 传输选项</title>
<link media="all" rel="stylesheet" type="text/css" href="styles/03e73060321a0a848018724a6c83de7f-theme-base.css" />
<link media="all" rel="stylesheet" type="text/css" href="styles/03e73060321a0a848018724a6c83de7f-theme-medium.css" />

  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <link media="all" rel="stylesheet" type="text/css" href="style.css"/>
 </head>
 <body class="docs" class="docs"><div class="navbar navbar-fixed-top">
  <div class="navbar-inner clearfix">
    <ul class="nav" style="width: 100%">
      <li style="float: left;"><a href="function.curl-setopt-array.html">? curl_setopt_array</a></li>
      <li style="float: right;"><a href="function.curl-share-close.html">curl_share_close ?</a></li>
    </ul>
  </div>
</div>
<div id="breadcrumbs" class="clearfix">
  <ul class="breadcrumbs-container">
    <li><a href="index.html">PHP Manual</a></li>
    <li><a href="ref.curl.html">cURL 函数</a></li>
    <li>设置 cURL 传输选项</li>
  </ul>
</div>
<div id="layout">
  <div id="layout-content"><div id="function.curl-setopt" class="refentry">
 <div class="refnamediv">
  <h1 class="refname">curl_setopt</h1>
  <p class="verinfo">(PHP 4 &gt;= 4.0.2, PHP 5, PHP 7, PHP 8)</p><p class="refpurpose"><span class="refname">curl_setopt</span> &mdash; <span class="dc-title">设置 cURL 传输选项</span></p>

 </div>
 
 <div class="refsect1 description" id="refsect1-function.curl-setopt-description">
  <h3 class="title">说明</h3>
  <div class="methodsynopsis dc-description">
   <span class="methodname"><strong>curl_setopt</strong></span>(<span class="methodparam"><span class="type"><a href="class.curlhandle.html" class="type CurlHandle">CurlHandle</a></span> <code class="parameter">$handle</code></span>, <span class="methodparam"><span class="type">int</span> <code class="parameter">$option</code></span>, <span class="methodparam"><span class="type"><a href="language.types.declarations.html#language.types.declarations.mixed" class="type mixed">mixed</a></span> <code class="parameter">$value</code></span>): <span class="type">bool</span></div>

  <p class="para rdfs-comment">
   为 cURL 会话句柄设置选项。
  </p>
 </div>

 
 <div class="refsect1 parameters" id="refsect1-function.curl-setopt-parameters">
  <h3 class="title">参数</h3>
  <p class="para">
   <dl>
    <dt>
<code class="parameter">handle</code>
</dt>
<dd>
<p class="para">由 <span class="function"><a href="function.curl-init.html" class="function">curl_init()</a></span> 返回的 cURL 句柄。</p></dd>

    
     <dt>
<code class="parameter">option</code></dt>

     <dd>

      <p class="para">
       需要设置的<code class="literal">CURLOPT_XXX</code>选项。
      </p>
     </dd>

    
    
     <dt>
<code class="parameter">value</code></dt>

     <dd>

      <p class="para">
       将设置在<code class="parameter">option</code>选项上的值。
      </p>
      <p class="para">
       以下 <code class="parameter">option</code> 参数的 <code class="parameter">value</code>应该被设置成 <span class="type">bool</span> 类型：
       <table class="doctable informaltable">
        
         <thead>
          <tr>
           <th>选项</th>
           <th>将 <code class="parameter">value</code> 设置为</th>
           <th>备注</th>
          </tr>

         </thead>

         <tbody class="tbody">
          <tr>
           <td style="vertical-align: top;"><strong><code>CURLOPT_AUTOREFERER</code></strong></td>
           <td style="vertical-align: top;">
            <strong><code>true</code></strong> 时将根据 <code class="literal">Location:</code> 重定向时，自动设置 header 中的<code class="literal">Referer:</code>信息。
           </td>
           <td style="vertical-align: top;">
           </td>
          </tr>

          <tr>
           <td style="vertical-align: top;"><strong><code>CURLOPT_COOKIESESSION</code></strong></td>
           <td style="vertical-align: top;">
            设为 <strong><code>true</code></strong>  时将开启新的一次 cookie 会话。它将强制 libcurl 忽略之前会话时存的其他 cookie。
            libcurl 在默认状况下无论是否为会话，都会储存、加载所有 cookie。会话 cookie 是指没有过期时间，只存活在会话之中。
           </td>
           <td style="vertical-align: top;">
           </td>
          </tr>

          <tr>
           <td style="vertical-align: top;"><strong><code>CURLOPT_CERTINFO</code></strong></td>
           <td style="vertical-align: top;">
            <strong><code>true</code></strong> 将在安全传输时输出 SSL 证书信息到 <code class="literal">STDERR</code>。
           </td>
           <td style="vertical-align: top;">
            在 cURL 7.19.1 中添加。
            需要开启 <strong><code>CURLOPT_VERBOSE</code></strong> 才有效。
           </td>
          </tr>

          <tr>
           <td style="vertical-align: top;"><strong><code>CURLOPT_CONNECT_ONLY</code></strong></td>
           <td style="vertical-align: top;">
            <strong><code>true</code></strong> 将让库执行所有需要的代理、验证、连接过程，但不传输数据。此选项用于
            HTTP、SMTP 和 POP3。
           </td>
           <td style="vertical-align: top;">
            在 7.15.2 中添加。
           </td>
          </tr>

          <tr>
           <td style="vertical-align: top;"><strong><code>CURLOPT_CRLF</code></strong></td>
           <td style="vertical-align: top;">
            启用时将Unix的换行符转换成回车换行符。
           </td>
           <td style="vertical-align: top;">
           </td>
          </tr>

          <tr>
           <td style="vertical-align: top;"><strong><code>CURLOPT_DNS_USE_GLOBAL_CACHE</code></strong></td>
           <td style="vertical-align: top;">
            <strong><code>true</code></strong> 会启用一个全局的DNS缓存。此选项非线程安全的，默认已开启。
           </td>
           <td style="vertical-align: top;">
           </td>
          </tr>

          <tr>
           <td style="vertical-align: top;"><strong><code>CURLOPT_FAILONERROR</code></strong></td>
           <td style="vertical-align: top;">
           当 HTTP 状态码大于等于 400，<strong><code>true</code></strong> 将将显示错误详情。 默认情况下将返回页面，忽略 HTTP 代码。
           </td>
           <td style="vertical-align: top;">
           </td>
          </tr>

          <tr>
           <td style="vertical-align: top;"><strong><code>CURLOPT_SSL_FALSESTART</code></strong></td>
           <td style="vertical-align: top;">
            <strong><code>true</code></strong>  开启 TLS False Start （一种 TLS 握手优化方式）
           </td>
           <td style="vertical-align: top;">
            cURL 7.42.0 中添加。自 PHP 7.0.7 起有效。
           </td>
          </tr>

          <tr>
           <td style="vertical-align: top;"><strong><code>CURLOPT_FILETIME</code></strong></td>
           <td style="vertical-align: top;">
            <strong><code>true</code></strong>  时，会尝试获取远程文档中的修改时间信息。
            信息可通过<span class="function"><a href="function.curl-getinfo.html" class="function">curl_getinfo()</a></span>函数的<code class="parameter">CURLINFO_FILETIME</code> 选项获取。
           </td>
           <td style="vertical-align: top;">
           </td>
          </tr>

          <tr>
           <td style="vertical-align: top;"><strong><code>CURLOPT_FOLLOWLOCATION</code></strong></td>
           <td style="vertical-align: top;">
            <strong><code>true</code></strong> 时将会根据服务器返回 HTTP 头中的 <code class="literal">&quot;Location: &quot;</code> 重定向。参阅 <strong><code>CURLOPT_MAXREDIRS</code></strong>。
           </td>
           <td style="vertical-align: top;">
           </td>
          </tr>

          <tr>
           <td style="vertical-align: top;"><strong><code>CURLOPT_FORBID_REUSE</code></strong></td>
           <td style="vertical-align: top;">
            <strong><code>true</code></strong> 在完成交互以后强制明确的断开连接，不能在连接池中重用。
           </td>
           <td style="vertical-align: top;">
           </td>
          </tr>

          <tr>
           <td style="vertical-align: top;"><strong><code>CURLOPT_FRESH_CONNECT</code></strong></td>
           <td style="vertical-align: top;">
            <strong><code>true</code></strong> 强制获取一个新的连接，而不是缓存中的连接。
           </td>
           <td style="vertical-align: top;">
           </td>
          </tr>

          <tr>
           <td style="vertical-align: top;"><strong><code>CURLOPT_FTP_USE_EPRT</code></strong></td>
           <td style="vertical-align: top;">
            <strong><code>true</code></strong> 时，当 FTP 下载时，使用 EPRT (和 LPRT)命令。 设置为 <strong><code>false</code></strong> 时禁用 EPRT 和 LPRT，仅仅使用PORT 命令。
           </td>
           <td style="vertical-align: top;">
           </td>
          </tr>

          <tr>
           <td style="vertical-align: top;"><strong><code>CURLOPT_FTP_USE_EPSV</code></strong></td>
           <td style="vertical-align: top;">
            <strong><code>true</code></strong> 时，在FTP传输过程中，回到 PASV 模式前，先尝试 EPSV 命令。设置为 <strong><code>false</code></strong> 时禁用 EPSV。
           </td>
           <td style="vertical-align: top;">
           </td>
          </tr>

          <tr>
           <td style="vertical-align: top;"><strong><code>CURLOPT_FTP_CREATE_MISSING_DIRS</code></strong></td>
           <td style="vertical-align: top;">
            <strong><code>true</code></strong> 时，当 ftp 操作不存在的目录时将创建它。
           </td>
           <td style="vertical-align: top;">
           </td>
          </tr>

          <tr>
           <td style="vertical-align: top;"><strong><code>CURLOPT_FTPAPPEND</code></strong></td>
           <td style="vertical-align: top;">
            <strong><code>true</code></strong> 为追加写入文件，而不是覆盖。
           </td>
           <td style="vertical-align: top;">
           </td>
          </tr>

          <tr>
           <td style="vertical-align: top;"><strong><code>CURLOPT_TCP_NODELAY</code></strong></td>
           <td style="vertical-align: top;">
            <strong><code>true</code></strong> 时禁用 TCP 的 Nagle 算法，就是减少网络上的小数据包数量。
           </td>
           <td style="vertical-align: top;">
            编译的版本在 libcurl 7.11.2 及以上时有效。
           </td>
          </tr>

          <tr>
           <td style="vertical-align: top;"><strong><code>CURLOPT_FTPASCII</code></strong></td>
           <td style="vertical-align: top;">
            <strong><code>CURLOPT_TRANSFERTEXT</code></strong> 的别名。
           </td>
           <td style="vertical-align: top;">
           </td>
          </tr>

          <tr>
           <td style="vertical-align: top;"><strong><code>CURLOPT_FTPLISTONLY</code></strong></td>
           <td style="vertical-align: top;">
            <strong><code>true</code></strong> 时只列出 FTP 目录的名字。
           </td>
           <td style="vertical-align: top;">
           </td>
          </tr>

          <tr>
           <td style="vertical-align: top;"><strong><code>CURLOPT_HEADER</code></strong></td>
           <td style="vertical-align: top;">
            启用时会将头文件的信息作为数据流输出。
           </td>
           <td style="vertical-align: top;">
           </td>
          </tr>

          <tr>
           <td><strong><code>CURLINFO_HEADER_OUT</code></strong></td>
           <td style="vertical-align: top;">
            <strong><code>true</code></strong> 时追踪句柄的请求字符串。
           </td>
           <td style="vertical-align: top;">
            <strong><code>CURLINFO_</code></strong> 的前缀是指向的（intentional）。
           </td>
          </tr>

          <tr>
           <td style="vertical-align: top;"><strong><code>CURLOPT_HTTP09_ALLOWED</code></strong></td>
           <td style="vertical-align: top;">
            是否允许 HTTP/0.9 响应。从 libcurl 7.66.0 开始默认为 <strong><code>false</code></strong>；以前默认为 <strong><code>true</code></strong>。
           </td>
           <td style="vertical-align: top;">
            如果编译的 libcurl 版本 &gt;= 7.64.0，则分别从 PHP 7.3.15 和 7.4.3 开始可用
           </td>
          </tr>

          <tr>
           <td style="vertical-align: top;"><strong><code>CURLOPT_HTTPGET</code></strong></td>
           <td style="vertical-align: top;">
            <strong><code>true</code></strong>  时会设置 HTTP 的 method 为 GET，由于默认是 GET，所以只有 method 被修改时才需要这个选项。
           </td>
           <td style="vertical-align: top;">
           </td>
          </tr>

          <tr>
           <td style="vertical-align: top;"><strong><code>CURLOPT_HTTPPROXYTUNNEL</code></strong></td>
           <td style="vertical-align: top;">
            <strong><code>true</code></strong>  会通过指定的 HTTP 代理来传输。
           </td>
           <td style="vertical-align: top;">
           </td>
          </tr>

          <tr>
           <td style="vertical-align: top;"><strong><code>CURLOPT_HTTP_CONTENT_DECODING</code></strong></td>
           <td style="vertical-align: top;">
            <strong><code>false</code></strong> 时获取原始 HTTP 响应主体。
           </td>
           <td style="vertical-align: top;">
            如果编译的 libcurl &gt;= 7.16.2 时可用。
           </td>
          </tr>

          <tr>
           <td style="vertical-align: top;"><strong><code>CURLOPT_KEEP_SENDING_ON_ERROR</code></strong></td>
           <td style="vertical-align: top;">
            <strong><code>true</code></strong> 时，如果返回的 HTTP 代码等于或大于 300，则继续发送请求主体。默认操作是停止发送并关闭流或连接。适用于手动 NTLM 身份验证。大多数应用程序不需要此选项。
           </td>
           <td style="vertical-align: top;">
            如果编译的 libcurl &gt;= 7.51.0，则从 PHP 7.3.0 开始可用。
           </td>
          </tr>

          <tr>
           <td style="vertical-align: top;"><strong><code>CURLOPT_MUTE</code></strong></td>
           <td style="vertical-align: top;">
            <strong><code>true</code></strong>  时将完全静默，无论是何 cURL 函数。
           </td>
           <td style="vertical-align: top;">
           在 cURL 7.15.5  中移出（可以使用 CURLOPT_RETURNTRANSFER 作为代替）
           </td>
          </tr>

          <tr>
           <td style="vertical-align: top;"><strong><code>CURLOPT_NETRC</code></strong></td>
           <td style="vertical-align: top;">
            <strong><code>true</code></strong>  时，在连接建立时，访问<var class="filename">~/.netrc</var>文件获取用户名和密码来连接远程站点。
           </td>
           <td style="vertical-align: top;">
           </td>
          </tr>

          <tr>
           <td style="vertical-align: top;"><strong><code>CURLOPT_NOBODY</code></strong></td>
           <td style="vertical-align: top;">
           <strong><code>true</code></strong>  时将不输出 BODY 部分。同时 Mehtod 变成了 HEAD。修改为  <strong><code>false</code></strong> 时不会变成 GET。
           </td>
           <td style="vertical-align: top;">
           </td>
          </tr>

          <tr>
           <td style="vertical-align: top;"><strong><code>CURLOPT_NOPROGRESS</code></strong></td>
           <td style="vertical-align: top;"><p class="para">
            <strong><code>true</code></strong> 时关闭 cURL 的传输进度。
            <blockquote class="note"><p><strong class="note">Note</strong>: 
             <p class="para">
              PHP 默认自动设置此选项为 <strong><code>true</code></strong>，只有为了调试才需要改变设置。
             </p>
            </p></blockquote>
            </p></td>
           <td style="vertical-align: top;">
           </td>
          </tr>

          <tr>
           <td style="vertical-align: top;"><strong><code>CURLOPT_NOSIGNAL</code></strong></td>
           <td style="vertical-align: top;">
            <strong><code>true</code></strong> 时忽略所有的 cURL 传递给 PHP 进程的信号。在 SAPI 多线程传输时此项被默认启用，所以超时选项仍能使用。
           </td>
           <td style="vertical-align: top;">
            cURL 7.10时被加入。
           </td>
          </tr>

          <tr>
           <td style="vertical-align: top;"><strong><code>CURLOPT_PATH_AS_IS</code></strong></td>
           <td style="vertical-align: top;">
            <strong><code>true</code></strong> 不处理 dot dot sequences  （即 ../ ）
           </td>
           <td style="vertical-align: top;">
             cURL 7.42.0 时被加入。 PHP 7.0.7 起有效。
           </td>
          </tr>

          <tr>
           <td style="vertical-align: top;"><strong><code>CURLOPT_PIPEWAIT</code></strong></td>
           <td style="vertical-align: top;">
            <strong><code>true</code></strong> 则等待 pipelining/multiplexing。
           </td>
           <td style="vertical-align: top;">
             cURL 7.43.0 时被加入。 PHP 7.0.7 起有效。
           </td>
          </tr>

          <tr>
           <td style="vertical-align: top;"><strong><code>CURLOPT_POST</code></strong></td>
           <td style="vertical-align: top;">
            <strong><code>true</code></strong> 时会发送 POST 请求，类型为：<code class="literal">application/x-www-form-urlencoded</code>，是 HTML 表单提交时最常见的一种。
           </td>
           <td style="vertical-align: top;">
           </td>
          </tr>

          <tr>
           <td style="vertical-align: top;"><strong><code>CURLOPT_PUT</code></strong></td>
           <td style="vertical-align: top;">
            <strong><code>true</code></strong> 时允许 HTTP 发送文件。要被 PUT 的文件必须在 <strong><code>CURLOPT_INFILE</code></strong>和<strong><code>CURLOPT_INFILESIZE</code></strong> 中设置。
           </td>
           <td style="vertical-align: top;">
           </td>
          </tr>

          <tr>
           <td style="vertical-align: top;"><strong><code>CURLOPT_RETURNTRANSFER</code></strong></td>
           <td style="vertical-align: top;">
            <strong><code>true</code></strong>  将<span class="function"><a href="function.curl-exec.html" class="function">curl_exec()</a></span>获取的信息以字符串返回，而不是直接输出。
           </td>
           <td style="vertical-align: top;">
           </td>
          </tr>

          <tr>
           <td style="vertical-align: top;"><strong><code>CURLOPT_SASL_IR</code></strong></td>
           <td style="vertical-align: top;">
            <strong><code>true</code></strong> 开启，收到首包(first packet)后发送初始的响应(initial response)。
           </td>
           <td style="vertical-align: top;">
            cURL 7.31.10 中添加，自 PHP 7.0.7 起有效。
           </td>
          </tr>

          <tr>
           <td style="vertical-align: top;"><strong><code>CURLOPT_SSL_ENABLE_ALPN</code></strong></td>
           <td style="vertical-align: top;">
            <strong><code>false</code></strong>  禁用 SSL 握手中的 ALPN (如果 SSL 后端的
            libcurl 内建支持) 用于协商到 http2。
           </td>
           <td style="vertical-align: top;">
            cURL 7.36.0 中增加， PHP 7.0.7 起有效。
           </td>
          </tr>

          <tr>
           <td style="vertical-align: top;"><strong><code>CURLOPT_SSL_ENABLE_NPN</code></strong></td>
           <td style="vertical-align: top;">
            <strong><code>false</code></strong> 禁用 SSL 握手中的 NPN(如果 SSL 后端的
            libcurl 内建支持)，用于协商到 http2。
           </td>
           <td style="vertical-align: top;">
            cURL 7.36.0 中增加， PHP 7.0.7 起有效。
           </td>
          </tr>

          
          
          
          
          
          
          
          
          
          
          
          
          
          
         
          <tr>
           <td style="vertical-align: top;"><strong><code>CURLOPT_SSL_VERIFYPEER</code></strong></td>
           <td style="vertical-align: top;">
            <strong><code>false</code></strong>  禁止 cURL 验证对等证书（peer&#039;s
            certificate）。要验证的交换证书可以在 <strong><code>CURLOPT_CAINFO</code></strong> 选项中设置，或在 <strong><code>CURLOPT_CAPATH</code></strong>中设置证书目录。
           </td>
           <td style="vertical-align: top;">
            自cURL 7.10开始默认为 <strong><code>true</code></strong>。从 cURL 7.10开始默认绑定安装。
           </td>
          </tr>

          <tr>
           <td style="vertical-align: top;"><strong><code>CURLOPT_SSL_VERIFYSTATUS</code></strong></td>
           <td style="vertical-align: top;">
            <strong><code>true</code></strong> 验证证书状态。
           </td>
           <td style="vertical-align: top;">
             cURL 7.41.0 中添加， PHP 7.0.7 起有效。
           </td>
          </tr>

          <tr>
           <td style="vertical-align: top;"><strong><code>CURLOPT_PROXY_SSL_VERIFYPEER</code></strong></td>
           <td style="vertical-align: top;">
            <strong><code>false</code></strong> 会阻止 CURL 验证对等证书（peer&#039;s certificate）。可以使用 <strong><code>CURLOPT_CAINFO</code></strong>
            选项指定要验证的备用证书，或者可以使用 <strong><code>CURLOPT_CAPATH</code></strong> 选项指定证书目录。设置为
            <strong><code>false</code></strong> 时，无论如何验证对等证书都会成功。
           </td>
           <td style="vertical-align: top;">
            默认为 <strong><code>true</code></strong>。自 PHP 7.3.0 和 libcurl &gt;= cURL 7.52.0 起可用。
           </td>
          </tr>

          <tr>
           <td style="vertical-align: top;"><strong><code>CURLOPT_SAFE_UPLOAD</code></strong></td>
           <td style="vertical-align: top;">
            始终为 <strong><code>true</code></strong>，在 <strong><code>CURLOPT_POSTFIELDS</code></strong> 中禁用了对上传文件的 <code class="literal">@</code>
            前缀的支持，这意味着以 <code class="literal">@</code> 开头的值可以作为字段安全地传递。上传可使用 <span class="classname"><a href="class.curlfile.html" class="classname">CURLFile</a></span> 替代。
           </td>
           <td style="vertical-align: top;">
           </td>
          </tr>

          <tr>
           <td style="vertical-align: top;"><strong><code>CURLOPT_TCP_FASTOPEN</code></strong></td>
           <td style="vertical-align: top;">
            <strong><code>true</code></strong> 开启 TCP Fast Open。
           </td>
           <td style="vertical-align: top;">
            cURL 7.49.0 中添加， PHP 7.0.7 起有效。
           </td>
          </tr>

          <tr>
           <td style="vertical-align: top;"><strong><code>CURLOPT_TFTP_NO_OPTIONS</code></strong></td>
           <td style="vertical-align: top;">
            <strong><code>true</code></strong> 不发送 TFTP 的 options 请求。
           </td>
           <td style="vertical-align: top;">
            自 cURL 7.48.0 添加， PHP 7.0.7 起有效。
           </td>
          </tr>

          <tr>
           <td style="vertical-align: top;"><strong><code>CURLOPT_TRANSFERTEXT</code></strong></td>
           <td style="vertical-align: top;">
            <strong><code>true</code></strong>  对 FTP 传输使用 ASCII 模式。对于LDAP，它检索纯文本信息而非 HTML。在 Windows 系统上，系统不会把 <code class="literal">STDOUT</code> 设置成二进制 模式。
           </td>
           <td style="vertical-align: top;">
           </td>
          </tr>

          <tr>
           <td style="vertical-align: top;"><strong><code>CURLOPT_UNRESTRICTED_AUTH</code></strong></td>
           <td style="vertical-align: top;">
            <strong><code>true</code></strong> 在使用<strong><code>CURLOPT_FOLLOWLOCATION</code></strong>重定向 header 中的多个 location 时继续发送用户名和密码信息，哪怕主机名已改变。
           </td>
           <td style="vertical-align: top;">
           </td>
          </tr>

          <tr>
           <td style="vertical-align: top;"><strong><code>CURLOPT_UPLOAD</code></strong></td>
           <td style="vertical-align: top;">
            <strong><code>true</code></strong>  准备上传。
           </td>
           <td style="vertical-align: top;">
           </td>
          </tr>

          
          
          <tr>
           <td style="vertical-align: top;"><strong><code>CURLOPT_VERBOSE</code></strong></td>
           <td style="vertical-align: top;">
            <strong><code>true</code></strong> 会输出所有的信息，写入到<code class="literal">STDERR</code>，或在<strong><code>CURLOPT_STDERR</code></strong>中指定的文件。
           </td>
           <td style="vertical-align: top;">
           </td>
          </tr>

         </tbody>
        
       </table>

      </p>
      <p class="para">
       以下 <code class="parameter">option</code> 的 <code class="parameter">value</code> 应该被设置成 <span class="type">int</span>：
       <table class="doctable informaltable">
        
         <thead>
          <tr>
           <th>选项</th>
           <th>设置 <code class="parameter">value</code> 为</th>
           <th>备注</th>
          </tr>

         </thead>

         <tbody class="tbody">
          <tr>
           <td style="vertical-align: top;"><strong><code>CURLOPT_BUFFERSIZE</code></strong></td>
           <td style="vertical-align: top;">
            每次读入的缓冲的尺寸。当然不保证每次都会完全填满这个尺寸。
           </td>
           <td style="vertical-align: top;">
            在cURL 7.10中被加入。
           </td>
          </tr>

          <tr>
           <td><strong><code>CURLOPT_CONNECTTIMEOUT</code></strong></td>
           <td style="vertical-align: top;">
            在尝试连接时等待的秒数。设置为0，则无限等待。
           </td>
           <td style="vertical-align: top;">
           </td>
          </tr>

          <tr>
           <td style="vertical-align: top;"><strong><code>CURLOPT_CONNECTTIMEOUT_MS</code></strong></td>
           <td style="vertical-align: top;">
            尝试连接等待的时间，以毫秒为单位。设置为0，则无限等待。 
            
            如果 libcurl 编译时使用系统标准的名称解析器（ standard system name resolver），那部分的连接仍旧使用以秒计的超时解决方案，最小超时时间还是一秒钟。
           </td>
           <td style="vertical-align: top;">
            在 cURL 7.16.2 中被加入。
           </td>
          </tr>

          <tr>
           <td style="vertical-align: top;"><strong><code>CURLOPT_DNS_CACHE_TIMEOUT</code></strong></td>
           <td style="vertical-align: top;">
            设置在内存中缓存 DNS 的时间，默认为120秒（两分钟）。
           </td>
           <td style="vertical-align: top;">
           </td>
          </tr>

          <tr>
           <td style="vertical-align: top;"><strong><code>CURLOPT_EXPECT_100_TIMEOUT_MS</code></strong></td>
           <td style="vertical-align: top;">
            超时预计： 100毫秒内的 continue 响应
            默认为 1000 毫秒。
           </td>
           <td style="vertical-align: top;">
            cURL 7.36.0 中添加，自 PHP 7.0.7 有效。
           </td>
          </tr>

          <tr>
           <td style="vertical-align: top;"><strong><code>CURLOPT_FTPSSLAUTH</code></strong></td>
           <td style="vertical-align: top;">
            FTP验证方式（启用的时候）：<code class="literal">CURLFTPAUTH_SSL</code> (首先尝试SSL)，<code class="literal">CURLFTPAUTH_TLS</code> (首先尝试TLS)或<code class="literal">CURLFTPAUTH_DEFAULT</code> (让cURL 自个儿决定)。
           </td>
           <td style="vertical-align: top;">
            在 cURL 7.12.2 中被加入。
           </td>
          </tr>

          <tr>
           <td style="vertical-align: top;"><strong><code>CURLOPT_HEADEROPT</code></strong></td>
           <td style="vertical-align: top;">
            How to deal with headers. One of the following constants:
            <span class="simpara">
             <strong><code>CURLHEADER_UNIFIED</code></strong>: the headers specified in
             <strong><code>CURLOPT_HTTPHEADER</code></strong> will be used in requests
             both to servers and proxies. With this option enabled, 
             <strong><code>CURLOPT_PROXYHEADER</code></strong> will not have any effect.
            </span>
            <span class="simpara">
             <strong><code>CURLHEADER_SEPARATE</code></strong>: makes
             <strong><code>CURLOPT_HTTPHEADER</code></strong> headers only get sent to
             a server and not to a proxy. Proxy headers must be set with
             <strong><code>CURLOPT_PROXYHEADER</code></strong> to get used. Note that if
             a non-CONNECT request is sent to a proxy, libcurl will send both
             server headers and proxy headers. When doing CONNECT, libcurl will
             send <strong><code>CURLOPT_PROXYHEADER</code></strong> headers only to the
             proxy and then <strong><code>CURLOPT_HTTPHEADER</code></strong> headers
             only to the server.
            </span>
            <span class="simpara">
             Defaults to <strong><code>CURLHEADER_SEPARATE</code></strong> as of cURL
             7.42.1, and <strong><code>CURLHEADER_UNIFIED</code></strong> before.
            </span>
           </td>
           <td style="vertical-align: top;">
            Added in cURL 7.37.0. Available since PHP 7.0.7.
           </td>
          </tr>

          <tr>
           <td style="vertical-align: top;"><strong><code>CURLOPT_HTTP_VERSION</code></strong></td>
           <td style="vertical-align: top;">
            <code class="parameter">CURL_HTTP_VERSION_NONE</code> (默认值，让 cURL 自己判断使用哪个版本)，<code class="parameter">CURL_HTTP_VERSION_1_0</code> (强制使用 HTTP/1.0)或<code class="parameter">CURL_HTTP_VERSION_1_1</code> (强制使用 HTTP/1.1)。
           </td>
           <td style="vertical-align: top;">
           </td>
          </tr>

          
          
          <tr>
           <td style="vertical-align: top;"><strong><code>CURLOPT_HTTPAUTH</code></strong></td>
           <td style="vertical-align: top;">
            <p class="para">
             使用的 HTTP 验证方法。选项有：
             <code class="parameter">CURLAUTH_BASIC</code>、
             <code class="parameter">CURLAUTH_DIGEST</code>、
             <code class="parameter">CURLAUTH_GSSNEGOTIATE</code>、
             <code class="parameter">CURLAUTH_NTLM</code>、
             <code class="parameter">CURLAUTH_ANY</code>和
             <code class="parameter">CURLAUTH_ANYSAFE</code>。
            </p>
            <p class="para">
             可以使用 <code class="literal">|</code> 位域(OR)操作符结合多个值，cURL 会让服务器选择受支持的方法，并选择最好的那个。
            </p>
            <p class="para">
             <code class="parameter">CURLAUTH_ANY</code>是 <code class="literal">CURLAUTH_BASIC | CURLAUTH_DIGEST | CURLAUTH_GSSNEGOTIATE | CURLAUTH_NTLM</code> 的别名。
            </p>
            
            <p class="para">
      <code class="parameter">CURLAUTH_ANYSAFE</code> 是 <code class="literal">CURLAUTH_DIGEST | CURLAUTH_GSSNEGOTIATE | CURLAUTH_NTLM</code> 的别名。
            </p>
           </td>
           <td style="vertical-align: top;">
           </td>
          </tr>

          <tr>
           <td style="vertical-align: top;"><strong><code>CURLOPT_INFILESIZE</code></strong></td>
           <td style="vertical-align: top;">
            希望传给远程站点的文件尺寸，字节(byte)为单位。
            注意无法用这个选项阻止 libcurl 发送更多的数据，确切发送什么取决于 <strong><code>CURLOPT_READFUNCTION</code></strong>。
           </td>
           <td style="vertical-align: top;">
           </td>
          </tr>

          <tr>
           <td style="vertical-align: top;"><strong><code>CURLOPT_LOW_SPEED_LIMIT</code></strong></td>
           <td style="vertical-align: top;">
            传输速度，每秒字节（bytes）数，根据<strong><code>CURLOPT_LOW_SPEED_TIME</code></strong>秒数统计是否因太慢而取消传输。
           </td>
           <td style="vertical-align: top;">
           </td>
          </tr>

          <tr>
           <td style="vertical-align: top;"><strong><code>CURLOPT_LOW_SPEED_TIME</code></strong></td>
           <td style="vertical-align: top;">
            当传输速度小于<strong><code>CURLOPT_LOW_SPEED_LIMIT</code></strong>时(bytes/sec)，PHP会判断是否因太慢而取消传输。
           </td>
           <td style="vertical-align: top;">
           </td>
          </tr>

          <tr>
           <td style="vertical-align: top;"><strong><code>CURLOPT_MAXCONNECTS</code></strong></td>
           <td style="vertical-align: top;">
            允许的最大持久连接数。当达到限制时，将会关闭缓存中最早的连接，以防止增加已打开的连接数。
           </td>
           <td style="vertical-align: top;">
           </td>
          </tr>

          <tr>
           <td style="vertical-align: top;"><strong><code>CURLOPT_MAXREDIRS</code></strong></td>
           <td style="vertical-align: top;">
            指定最多的 HTTP 重定向次数，这个选项是和 <strong><code>CURLOPT_FOLLOWLOCATION</code></strong> 一起使用的。
            默认值 <code class="literal">20</code> 是为了防止无限重定向。设置为 <code class="literal">-1</code> 允许无限重定向，<code class="literal">0</code> 拒绝所有重定向。
           </td>
           <td style="vertical-align: top;">
           </td>
          </tr>

          <tr>
           <td style="vertical-align: top;"><strong><code>CURLOPT_PORT</code></strong></td>
           <td style="vertical-align: top;">
            用来指定连接端口。
           </td>
           <td style="vertical-align: top;">
           </td>
          </tr>

          <tr>
           <td style="vertical-align: top;"><strong><code>CURLOPT_POSTREDIR</code></strong></td>
           <td style="vertical-align: top;">
            位掩码， 1 (301 永久重定向), 2 (302 Found)
           和 4 (303 See Other) 
            设置 <strong><code>CURLOPT_FOLLOWLOCATION</code></strong> 时，什么情况下需要再次  HTTP POST 到重定向网址。
           </td>
           <td style="vertical-align: top;">
            cURL 7.19.1 中添加。
           </td>
          </tr>

          
          
          <tr>
           <td style="vertical-align: top;"><strong><code>CURLOPT_PROTOCOLS</code></strong></td>
           <td style="vertical-align: top;">
            <p class="para">
             <strong><code>CURLPROTO_*</code></strong>的位掩码。
             启用时，会限制 libcurl 在传输过程中可使用哪些协议。
             这将允许你在编译libcurl时支持众多协议，但是限制只用允许的子集。默认 libcurl 将使用所有支持的协议。
             参见<strong><code>CURLOPT_REDIR_PROTOCOLS</code></strong>。
            </p>
            <p class="para">
             可用的协议选项为：
             <code class="parameter">CURLPROTO_HTTP</code>、
             <code class="parameter">CURLPROTO_HTTPS</code>、
             <code class="parameter">CURLPROTO_FTP</code>、
             <code class="parameter">CURLPROTO_FTPS</code>、
             <code class="parameter">CURLPROTO_SCP</code>、
             <code class="parameter">CURLPROTO_SFTP</code>、
             <code class="parameter">CURLPROTO_TELNET</code>、
             <code class="parameter">CURLPROTO_LDAP</code>、
             <code class="parameter">CURLPROTO_LDAPS</code>、
             <code class="parameter">CURLPROTO_DICT</code>、
             <code class="parameter">CURLPROTO_FILE</code>、
             <code class="parameter">CURLPROTO_TFTP</code>、
             <code class="parameter">CURLPROTO_ALL</code>。
            </p>
           </td>
           <td style="vertical-align: top;">
            在 cURL 7.19.4 中被加入。
           </td>
          </tr>

          <tr>
           <td style="vertical-align: top;"><strong><code>CURLOPT_PROXYAUTH</code></strong></td>
           <td style="vertical-align: top;">
            HTTP 代理连接的验证方式。使用在<strong><code>CURLOPT_HTTPAUTH</code></strong>中的位掩码。
            当前仅仅支持 <code class="parameter">CURLAUTH_BASIC</code>和<code class="parameter">CURLAUTH_NTLM</code>。
           </td>
           <td style="vertical-align: top;">
            在 cURL 7.10.7 中被加入。
           </td>
          </tr>

          <tr>
           <td style="vertical-align: top;"><strong><code>CURLOPT_PROXYPORT</code></strong></td>
           <td style="vertical-align: top;">
            代理服务器的端口。端口也可以在<strong><code>CURLOPT_PROXY</code></strong>中设置。
           </td>
           <td style="vertical-align: top;">
           </td>
          </tr>

          <tr>
           <td style="vertical-align: top;"><strong><code>CURLOPT_PROXYTYPE</code></strong></td>
           <td style="vertical-align: top;">
            可以是 <strong><code>CURLPROXY_HTTP</code></strong> (默认值) 
         <strong><code>CURLPROXY_SOCKS4</code></strong>、
            <strong><code>CURLPROXY_SOCKS5</code></strong>、
  <strong><code>CURLPROXY_SOCKS4A</code></strong> 或
            <strong><code>CURLPROXY_SOCKS5_HOSTNAME</code></strong>。
           </td>
           <td style="vertical-align: top;">
            在 cURL 7.10 中被加入。
           </td>
          </tr>

          <tr>
           <td style="vertical-align: top;"><strong><code>CURLOPT_REDIR_PROTOCOLS</code></strong></td>
           <td style="vertical-align: top;">
            <strong><code>CURLPROTO_*</code></strong> 值的位掩码。如果被启用，位掩码会限制 libcurl 在 <strong><code>CURLOPT_FOLLOWLOCATION</code></strong>开启时，使用的协议。
            默认允许除 FILE 和 SCP 外所有协议。
            这和 7.19.4 前的版本无条件支持所有支持的协议不同。关于协议常量，请参照<strong><code>CURLOPT_PROTOCOLS</code></strong>。
           </td>
           <td style="vertical-align: top;">
            在 cURL 7.19.4 中被加入。
           </td>
          </tr>

          <tr>
           <td style="vertical-align: top;"><strong><code>CURLOPT_RESUME_FROM</code></strong></td>
           <td style="vertical-align: top;">
            在恢复传输时，传递字节为单位的偏移量（用来断点续传）。
           </td>
           <td style="vertical-align: top;">
           </td>
          </tr>

          <tr>
           <td style="vertical-align: top;"><strong><code>CURLOPT_SOCKS5_AUTH</code></strong></td>
           <td style="vertical-align: top;">
            <p class="para">
             用于 SOCKS5 验证方法。选项是：<strong><code>CURLAUTH_BASIC</code></strong>、<strong><code>CURLAUTH_GSSAPI</code></strong>、<strong><code>CURLAUTH_NONE</code></strong>。
            </p>
            <p class="para">
             位操作符 <code class="literal">|</code>（or）用于组合多个方法。如果这样做，cURL 将轮询服务器以查看它支持哪些方法并选择最佳方法。
            </p>
            <p class="para">
             <strong><code>CURLAUTH_BASIC</code></strong> 允许用户名/密码验证。
            </p>
            <p class="para">
             <strong><code>CURLAUTH_GSSAPI</code></strong> 允许 GSS-API 身份验证。
            </p>
            <p class="para">
             <strong><code>CURLAUTH_NONE</code></strong> 允许不验证。
            </p>
            <p class="para">
             默认为 <code class="literal">CURLAUTH_BASIC|CURLAUTH_GSSAPI</code>。使用 <strong><code>CURLOPT_PROXYUSERPWD</code></strong> 选项设置真实的用户名和密码。
            </p>
           </td>
           <td style="vertical-align: top;">
            从 7.3.0 和 curl &gt;= 7.55.0 开始可用。
           </td>
          </tr>

          <tr>
           <td style="vertical-align: top;"><strong><code>CURLOPT_SSL_OPTIONS</code></strong></td>
           <td style="vertical-align: top;">
            Set SSL behavior options, which is a bitmask of any of the following constants:
            <span class="simpara">
             <strong><code>CURLSSLOPT_ALLOW_BEAST</code></strong>: do not attempt to use
             any workarounds for a security flaw in the SSL3 and TLS1.0 protocols.
            </span>
            <span class="simpara">
             <strong><code>CURLSSLOPT_NO_REVOKE</code></strong>: disable certificate
             revocation checks for those SSL backends where such behavior is
             present.
            </span>
           </td>
           <td style="vertical-align: top;">
            Added in cURL 7.25.0. Available since PHP 7.0.7.
           </td>
          </tr>

          <tr>
           <td style="vertical-align: top;"><strong><code>CURLOPT_SSL_VERIFYHOST</code></strong></td>
           <td style="vertical-align: top;">
            <code class="literal">2</code> 时验证 SSL 对等证书中的公用名称字段或主题备用名称（Subject Alternate Name，简称 SNA）字段是否与提供的主机名匹配。<code class="literal">0</code>
            时不检查名称。不应使用 <code class="literal">1</code>。在生产环境中，此选项的值应保持为 <code class="literal">2</code>（默认值）。
           </td>
           <td style="vertical-align: top;">
           在 cURL 7.28.1 中移除了对 <code class="literal">1</code> 的支持。
           </td>
          </tr>

          <tr>
           <td style="vertical-align: top;"><strong><code>CURLOPT_SSLVERSION</code></strong></td>
           <td style="vertical-align: top;">
            <strong><code>CURL_SSLVERSION_DEFAULT</code></strong> (0)、<strong><code>CURL_SSLVERSION_TLSv1</code></strong> (1)、<strong><code>CURL_SSLVERSION_SSLv2</code></strong> (2)、<strong><code>CURL_SSLVERSION_SSLv3</code></strong> (3)、<strong><code>CURL_SSLVERSION_TLSv1_0</code></strong> (4)、<strong><code>CURL_SSLVERSION_TLSv1_1</code></strong> (5) 、<strong><code>CURL_SSLVERSION_TLSv1_2</code></strong> (6) 或
            <strong><code>CURL_SSLVERSION_TLSv1_3</code></strong> (7) 中的其中一个。
            <blockquote class="note"><p><strong class="note">Note</strong>: 
             <p class="para">
              最好别设置这个值并让它使用默认值。鉴于 SSLv2 和 SSLv3 中的已知漏洞，将其设置为 2 或 3 非常危险。
             </p>
            </p></blockquote>
           </td>
           <td style="vertical-align: top;">
           </td>
          </tr>

          <tr>
           <td style="vertical-align: top;"><strong><code>CURLOPT_PROXY_SSL_OPTIONS</code></strong></td>
           <td style="vertical-align: top;">
            设置代理 SSL 行为选项，它是以下任何常量的位掩码：
            <span class="simpara">
             <strong><code>CURLSSLOPT_ALLOW_BEAST</code></strong>：不要尝试对 SSL3 和 TLS1.0 协议中的安全漏洞使用任何替代方法。
            </span>
            <span class="simpara">
             <strong><code>CURLSSLOPT_NO_REVOKE</code></strong>：对存在此类行为的 SSL 后端禁用证书吊销检查。（curl &gt;= 7.44.0）
            </span>
            <span class="simpara">
             <strong><code>CURLSSLOPT_NO_PARTIALCHAIN</code></strong>：不接受"部分"（partial）证书链，不然默认接受。（curl &gt;= 7.68.0）
            </span>
           </td>
           <td style="vertical-align: top;">
            自 PHP 7.3.0 和 libcurl &gt;= cURL 7.52.0 起可用。
           </td>
          </tr>

          <tr>
           <td style="vertical-align: top;"><strong><code>CURLOPT_PROXY_SSL_VERIFYHOST</code></strong></td>
           <td style="vertical-align: top;">
            设置为 <code class="literal">2</code> 以根据代理名称验证 HTTPS 代理的证书名称字段。设置为 <code class="literal">0</code> 时，无论证书中使用的名称如何，连接都会成功。谨慎使用该能力！
            在 curl 7.28.0 及更早版本中 <code class="literal">1</code> 视为调试选项。从 curl 7.28.1 到 7.65.3 返回 <strong><code>CURLE_BAD_FUNCTION_ARGUMENT</code></strong>。
            从 curl 7.66.0 开始，<code class="literal">1</code> 和 <code class="literal">2</code> 被视为相同的值。在生产环境中，此选项的值应保持为 <code class="literal">2</code>（默认值）。
           </td>
           <td style="vertical-align: top;">
            自 PHP 7.3.0 和 libcurl &gt;= cURL 7.52.0 起可用。
           </td>
          </tr>

          <tr>
           <td style="vertical-align: top;"><strong><code>CURLOPT_PROXY_SSLVERSION</code></strong></td>
           <td style="vertical-align: top;">
            <strong><code>CURL_SSLVERSION_DEFAULT</code></strong>、<strong><code>CURL_SSLVERSION_TLSv1</code></strong>、<strong><code>CURL_SSLVERSION_TLSv1_0</code></strong>、<strong><code>CURL_SSLVERSION_TLSv1_1</code></strong>、<strong><code>CURL_SSLVERSION_TLSv1_2</code></strong>、<strong><code>CURL_SSLVERSION_TLSv1_3</code></strong>、<strong><code>CURL_SSLVERSION_MAX_DEFAULT</code></strong>、<strong><code>CURL_SSLVERSION_MAX_TLSv1_0</code></strong>、<strong><code>CURL_SSLVERSION_MAX_TLSv1_1</code></strong>、<strong><code>CURL_SSLVERSION_MAX_TLSv1_2</code></strong>、<strong><code>CURL_SSLVERSION_MAX_TLSv1_3</code></strong>
            或 <strong><code>CURL_SSLVERSION_SSLv3</code></strong> 其中之一。
            <blockquote class="note"><p><strong class="note">Note</strong>: 
             <p class="para">
              最好的办法是不要设置它，使用默认的 <strong><code>CURL_SSLVERSION_DEFAULT</code></strong>，这将尝试找出远程 SSL 协议版本。
             </p>
            </p></blockquote>
           </td>
           <td style="vertical-align: top;">
            自 PHP 7.3.0 和 libcurl &gt;= cURL 7.52.0 起可用。
           </td>
          </tr>

          <tr>
           <td style="vertical-align: top;"><strong><code>CURLOPT_STREAM_WEIGHT</code></strong></td>
           <td style="vertical-align: top;">
            设置 stream weight 数值 ( 1 和 256 之间的数字).
           </td>
           <td style="vertical-align: top;">
             cURL 7.46.0 中添加，自 PHP 7.0.7 起有效。
           </td>
          </tr>

          <tr>
           <td style="vertical-align: top;"><strong><code>CURLOPT_TCP_KEEPALIVE</code></strong></td>
           <td style="vertical-align: top;">
            如果设置为 <code class="literal">1</code>，将发送 TCP keepalive 探针。这些探针的延迟和频率可以通过 <strong><code>CURLOPT_TCP_KEEPIDLE</code></strong> 和 <strong><code>CURLOPT_TCP_KEEPINTVL</code></strong>
            选项来控制，前提是操作系统支持它们。如果设置为 <code class="literal">0</code>（默认值），将禁用 keepalive 探针。
           </td>
           <td style="vertical-align: top;">
            在 cURL 7.25.0 中添加。
           </td>
          </tr>

          <tr>
           <td style="vertical-align: top;"><strong><code>CURLOPT_TCP_KEEPIDLE</code></strong></td>
           <td style="vertical-align: top;">
            设置延迟（以秒为单位），如果启用了 <strong><code>CURLOPT_TCP_KEEPALIVE</code></strong>，操作系统将在连接空闲时等待，然后再发送
            keepalive 探针。并非所有操作系统都支持此选项。默认值为 <code class="literal">60</code>。
           </td>
           <td style="vertical-align: top;">
            在 cURL 7.25.0 中添加。
           </td>
          </tr>

          <tr>
           <td style="vertical-align: top;"><strong><code>CURLOPT_TCP_KEEPINTVL</code></strong></td>
           <td style="vertical-align: top;">
            设置间隔（以秒为单位），如果启用了 <strong><code>CURLOPT_TCP_KEEPALIVE</code></strong>，操作系统将在发送
            keepalive 探针之间等待。并非所有操作系统都支持此选项。默认值为 <code class="literal">60</code>。
           </td>
           <td style="vertical-align: top;">
            在 cURL 7.25.0 中添加。
           </td>
          </tr>

          <tr>
           <td style="vertical-align: top;"><strong><code>CURLOPT_TIMECONDITION</code></strong></td>
           <td style="vertical-align: top;">
            设置如何对待 <strong><code>CURLOPT_TIMEVALUE</code></strong>。
            使用 <code class="parameter">CURL_TIMECOND_IFMODSINCE</code>，仅在页面 <strong><code>CURLOPT_TIMEVALUE</code></strong> 之后修改，才返回页面。没有修改则返回
            <code class="literal">&quot;304 Not Modified&quot;</code> 头，假设设置了 <strong><code>CURLOPT_HEADER</code></strong> 为 <strong><code>true</code></strong>。<code class="parameter">CURL_TIMECOND_IFUNMODSINCE</code>
            则起相反的效果。使用 <strong><code>CURL_TIMECOND_NONE</code></strong> 忽略 <strong><code>CURLOPT_TIMEVALUE</code></strong> 并始终返回页面。默认为
            <code class="parameter">CURL_TIMECOND_IFMODSINCE</code>。
           </td>
           <td style="vertical-align: top;">
            在 cURL 7.46.0 之前，默认值为 <strong><code>CURL_TIMECOND_IFMODSINCE</code></strong>。
           </td>
          </tr>

          <tr>
           <td style="vertical-align: top;"><strong><code>CURLOPT_TIMEOUT</code></strong></td>
           <td style="vertical-align: top;">
            允许 cURL 函数执行的最长秒数。
           </td>
           <td style="vertical-align: top;">
           </td>
          </tr>

          <tr>
           <td style="vertical-align: top;"><strong><code>CURLOPT_TIMEOUT_MS</code></strong></td>
           <td style="vertical-align: top;">
            设置cURL允许执行的最长毫秒数。
             
            
            如果 libcurl 编译时使用系统标准的名称解析器（ standard system name resolver），那部分的连接仍旧使用以秒计的超时解决方案，最小超时时间还是一秒钟。
           </td>
           <td style="vertical-align: top;">
            在 cURL 7.16.2 中被加入。
           </td>
          </tr>

          
          <tr>
           <td style="vertical-align: top;"><strong><code>CURLOPT_TIMEVALUE</code></strong></td>
           <td style="vertical-align: top;">
            秒数，从 1970年1月1日开始。这个时间将由 <strong><code>CURLOPT_TIMECONDITION</code></strong> 使用。
           </td>
           <td style="vertical-align: top;">
           </td>
          </tr>

          <tr>
           <td style="vertical-align: top;"><strong><code>CURLOPT_MAX_RECV_SPEED_LARGE</code></strong></td>
           <td style="vertical-align: top;">
            如果下载速度超过了此速度(以每秒字节数来统计) ，即传输过程中累计的平均数，传输就会降速到这个参数的值。默认不限速。
           </td>
           <td style="vertical-align: top;">
             cURL 7.15.5 中添加。
           </td>
          </tr>

          <tr>
           <td style="vertical-align: top;"><strong><code>CURLOPT_MAX_SEND_SPEED_LARGE</code></strong></td>
           <td style="vertical-align: top;">
            如果上传的速度超过了此速度(以每秒字节数来统计)，即传输过程中累计的平均数 
            ，传输就会降速到这个参数的值。默认不限速。
           </td>
           <td style="vertical-align: top;">
             cURL 7.15.5 中添加。
           </td>
          </tr>

          <tr>
           <td style="vertical-align: top;"><strong><code>CURLOPT_SSH_AUTH_TYPES</code></strong></td>
           <td style="vertical-align: top;">
            A bitmask consisting of one or more of 
            <strong><code>CURLSSH_AUTH_PUBLICKEY</code></strong>, 
            <strong><code>CURLSSH_AUTH_PASSWORD</code></strong>, 
            <strong><code>CURLSSH_AUTH_HOST</code></strong>, 
            <strong><code>CURLSSH_AUTH_KEYBOARD</code></strong>. Set to 
            <strong><code>CURLSSH_AUTH_ANY</code></strong> to let libcurl pick one.
           </td>
           <td style="vertical-align: top;">
            cURL 7.16.1 中添加。
           </td>
          </tr>

          <tr>
           <td style="vertical-align: top;"><strong><code>CURLOPT_IPRESOLVE</code></strong></td>
           <td style="vertical-align: top;">
            允许程序选择想要解析的 IP 地址类别。只有在地址有多种 ip 类别的时候才能用，可以的值有：
            <strong><code>CURL_IPRESOLVE_WHATEVER</code></strong>、
            <strong><code>CURL_IPRESOLVE_V4</code></strong>、
            <strong><code>CURL_IPRESOLVE_V6</code></strong>，默认是
            <strong><code>CURL_IPRESOLVE_WHATEVER</code></strong>。
           </td>
           <td style="vertical-align: top;">
            cURL 7.10.8 中添加。
           </td>
          </tr>

          <tr>
           <td style="vertical-align: top;"><strong><code>CURLOPT_FTP_FILEMETHOD</code></strong></td>
           <td style="vertical-align: top;">
            告诉 curl 使用哪种方式来获取 FTP(s) 服务器上的文件。可能的值有：
            <strong><code>CURLFTPMETHOD_MULTICWD</code></strong>、
            <strong><code>CURLFTPMETHOD_NOCWD</code></strong> 和  
            <strong><code>CURLFTPMETHOD_SINGLECWD</code></strong>。
           </td>
           <td style="vertical-align: top;">
            cURL 7.15.1 中添加。
           </td>
          </tr>

         </tbody>
        
       </table>

      </p>
      <p class="para">
       对于下面的这些<code class="parameter">option</code>，<code class="parameter">value</code>应该被设置成 <span class="type">string</span>：
       <table class="doctable informaltable">
        
         <thead>
          <tr>
           <th>选项</th>
           <th>设置的<code class="parameter">value</code></th>
           <th>备注</th>
          </tr>

         </thead>

         <tbody class="tbody">
          <tr>
           <td style="vertical-align: top;"><strong><code>CURLOPT_CAINFO</code></strong></td>
           <td style="vertical-align: top;">
            一个保存着1个或多个用来让服务端验证的证书的文件名。这个参数仅仅在和<strong><code>CURLOPT_SSL_VERIFYPEER</code></strong>一起使用时才有意义。            .
           </td>
           <td style="vertical-align: top;">
            可能需要绝对路径。
           </td>
          </tr>

          <tr>
           <td style="vertical-align: top;"><strong><code>CURLOPT_CAPATH</code></strong></td>
           <td style="vertical-align: top;">
            一个保存着多个CA证书的目录。这个选项是和<strong><code>CURLOPT_SSL_VERIFYPEER</code></strong>一起使用的。
           </td>
           <td style="vertical-align: top;">
           </td>
          </tr>

          <tr>
           <td style="vertical-align: top;"><strong><code>CURLOPT_COOKIE</code></strong></td>
           <td style="vertical-align: top;">
            设定 HTTP 请求中<code class="literal">&quot;Cookie: &quot;</code>部分的内容。多个 cookie 用分号分隔，分号后带一个空格(例如， &quot;<code class="literal">fruit=apple; colour=red</code>&quot;)。
           </td>
           <td style="vertical-align: top;">
           </td>
          </tr>

          <tr>
           <td style="vertical-align: top;"><strong><code>CURLOPT_COOKIEFILE</code></strong></td>
           <td style="vertical-align: top;">
            包含 cookie 数据的文件名，cookie 文件的格式可以是 Netscape 格式，或者只是纯 HTTP 头部风格，存入文件。如果文件名是空的，不会加载 cookie，但 cookie 的处理仍旧启用。
           </td>
           <td style="vertical-align: top;">
           </td>
          </tr>

          <tr>
           <td style="vertical-align: top;"><strong><code>CURLOPT_COOKIEJAR</code></strong></td>
           <td style="vertical-align: top;">
            连接结束后，比如，调用 curl_close 后，保存 cookie 信息的文件。
           </td>
           <td style="vertical-align: top;">
           </td>
          </tr>

          <tr>
           <td style="vertical-align: top;"><strong><code>CURLOPT_COOKIELIST</code></strong></td>
           <td style="vertical-align: top;">
            cookie 字符串（即 Netscape/Mozilla 的单行格式，或常规 HTTP 样式的 Set-Cookie 头）将单个 cookie 添加到内部 cookie 存储中。
            <code class="literal">&quot;ALL&quot;</code> 擦除内存中保存的所有 cookie。
            <code class="literal">&quot;SESS&quot;</code> 擦除内存中保存的所有会话 cookie。
            <code class="literal">&quot;FLUSH&quot;</code> 将所有已知的 cookie 写入到 <strong><code>CURLOPT_COOKIEJAR</code></strong> 指定的文件。
            <code class="literal">&quot;RELOAD&quot;</code> 从 <strong><code>CURLOPT_COOKIEFILE</code></strong> 指定的文件中加载所有 cookie。
           </td>
           <td style="vertical-align: top;">
            自 cURL 7.14.1 起可用。
           </td>
          </tr>

          <tr>
           <td style="vertical-align: top;"><strong><code>CURLOPT_CUSTOMREQUEST</code></strong></td>
           <td style="vertical-align: top;"><p class="para">
            HTTP 请求时，使用自定义的 Method 来代替<code class="literal">&quot;GET&quot;</code>或<code class="literal">&quot;HEAD&quot;</code>。对 <code class="literal">&quot;DELETE&quot;</code> 或者其他更隐蔽的 HTTP 请求有用。
            有效值如 <code class="literal">&quot;GET&quot;</code>，<code class="literal">&quot;POST&quot;</code>，<code class="literal">&quot;CONNECT&quot;</code>等等；也就是说，不要在这里输入整行 HTTP 请求。例如输入<code class="literal">&quot;GET /index.html HTTP/1.0\r\n\r\n&quot;</code>是不正确的。
            <blockquote class="note"><p><strong class="note">Note</strong>: 
             <p class="para">
              不确定服务器支持这个自定义方法则不要使用它。
             </p>
            </p></blockquote>
            </p>
           </td>
           <td style="vertical-align: top;">
           </td>
          </tr>

          
           <tr>
           <td style="vertical-align: top;"><strong><code>CURLOPT_DEFAULT_PROTOCOL</code></strong></td>
           <td style="vertical-align: top;"><p class="para">
            URL不带协议的时候，使用的默认协议。
           </p></td>
           <td style="vertical-align: top;">
            cURL 7.45.0 中添加，自 PHP 7.0.7 起有效。
           </td>
          </tr>

          <tr>
           <td style="vertical-align: top;"><strong><code>CURLOPT_DNS_INTERFACE</code></strong></td>
           <td style="vertical-align: top;"><p class="para">
            Set the name of the network interface that the DNS resolver should bind to.
            This must be an interface name (not an address).
            </p></td>
           <td style="vertical-align: top;">
            Added in cURL 7.33.0. Available since PHP 7.0.7.
           </td>
          </tr>

          <tr>
           <td style="vertical-align: top;"><strong><code>CURLOPT_DNS_LOCAL_IP4</code></strong></td>
           <td style="vertical-align: top;"><p class="para">
            Set the local IPv4 address that the resolver should bind to. The argument
            should contain a single numerical IPv4 address as a string.
            </p></td>
           <td style="vertical-align: top;">
            Added in cURL 7.33.0. Available since PHP 7.0.7.
           </td>
          </tr>

          <tr>
           <td style="vertical-align: top;"><strong><code>CURLOPT_DNS_LOCAL_IP6</code></strong></td>
           <td style="vertical-align: top;"><p class="para">
            Set the local IPv6 address that the resolver should bind to. The argument
            should contain a single numerical IPv6 address as a string.
            </p></td>
           <td style="vertical-align: top;">
            Added in cURL 7.33.0. Available since PHP 7.0.7.
           </td>
          </tr>

          <tr>
           <td style="vertical-align: top;"><strong><code>CURLOPT_EGDSOCKET</code></strong></td>
           <td style="vertical-align: top;">
            类似<strong><code>CURLOPT_RANDOM_FILE</code></strong>，除了一个Entropy Gathering Daemon套接字。
           </td>
           <td style="vertical-align: top;">
           </td>
          </tr>

          <tr>
           <td style="vertical-align: top;"><strong><code>CURLOPT_ENCODING</code></strong></td>
           <td style="vertical-align: top;">
            HTTP请求头中<code class="literal">&quot;Accept-Encoding: &quot;</code>的值。
            这使得能够解码响应的内容。
            支持的编码有<code class="literal">&quot;identity&quot;</code>，<code class="literal">&quot;deflate&quot;</code>和<code class="literal">&quot;gzip&quot;</code>。如果为空字符串<code class="literal">&quot;&quot;</code>，会发送所有支持的编码类型。
           </td>
           <td style="vertical-align: top;">
            在 cURL 7.10 中被加入。
           </td>
          </tr>

          <tr>
           <td style="vertical-align: top;"><strong><code>CURLOPT_FTPPORT</code></strong></td>
           <td style="vertical-align: top;">
            这个值将被用来获取供FTP&quot;PORT&quot;指令所需要的IP地址。
            &quot;PORT&quot; 指令告诉远程服务器连接到我们指定的IP地址。这个字符串可以是纯文本的IP地址、主机名、一个网络接口名（UNIX下）或者只是一个&#039;-&#039;来使用默认的 IP 地址。
           </td>
           <td style="vertical-align: top;">
           </td>
          </tr>

          <tr>
           <td style="vertical-align: top;"><strong><code>CURLOPT_INTERFACE</code></strong></td>
           <td style="vertical-align: top;">
            发送的网络接口（interface），可以是一个接口名、IP 地址或者是一个主机名。
           </td>
           <td style="vertical-align: top;">
           </td>
          </tr>

          <tr>
           <td style="vertical-align: top;"><strong><code>CURLOPT_KEYPASSWD</code></strong></td>
           <td style="vertical-align: top;">
            使用 <strong><code>CURLOPT_SSLKEY</code></strong> 
            或 <strong><code>CURLOPT_SSH_PRIVATE_KEYFILE</code></strong> 私钥时候的密码。
           </td>
           <td style="vertical-align: top;">
            在 cURL 7.16.1 中添加。
           </td>
          </tr>

          <tr>
           <td style="vertical-align: top;"><strong><code>CURLOPT_KRB4LEVEL</code></strong></td>
           <td style="vertical-align: top;">
            KRB4 (Kerberos 4) 安全级别。下面的任何值都是有效的(从低到高的顺序)：<code class="literal">&quot;clear&quot;</code>、<code class="literal">&quot;safe&quot;</code>、<code class="literal">&quot;confidential&quot;</code>、<code class="literal">&quot;private&quot;.</code>。如果字符串以上这些，将使用<code class="literal">&quot;private&quot;</code>。
            这个选项设置为 <strong><code>null</code></strong> 时将禁用 KRB4 安全认证。目前 KRB4 安全认证只能用于 FTP 传输。
           </td>
           <td style="vertical-align: top;">
           </td>
          </tr>

          <tr>
           <td style="vertical-align: top;"><strong><code>CURLOPT_LOGIN_OPTIONS</code></strong></td>
           <td style="vertical-align: top;">
            Can be used to set protocol specific login options, such as the
            preferred authentication mechanism via &quot;AUTH=NTLM&quot; or &quot;AUTH=*&quot;,
            and should be used in conjunction with the
            <strong><code>CURLOPT_USERNAME</code></strong> option.
           </td>
           <td style="vertical-align: top;">
            Added in cURL 7.34.0. Available since PHP 7.0.7.
           </td>
          </tr>

          <tr>
           <td style="vertical-align: top;"><strong><code>CURLOPT_PINNEDPUBLICKEY</code></strong></td>
           <td style="vertical-align: top;">
             Set the pinned public key.
             The string can be the file name of your pinned public key. The file
             format expected is &quot;PEM&quot; or &quot;DER&quot;. The string can also be any
             number of base64 encoded sha256 hashes preceded by &quot;sha256//&quot; and
             separated by &quot;;&quot;.
           </td>
           <td style="vertical-align: top;">
            Added in cURL 7.39.0. Available since PHP 7.0.7.
           </td>
          </tr>

          <tr>
           <td style="vertical-align: top;"><strong><code>CURLOPT_POSTFIELDS</code></strong></td>
           <td style="vertical-align: top;">
            <span class="simpara">
            在 HTTP "POST"操作中要发送的所有数据。
            这个参数可以是 urlencoded 后的字符串，类似&#039;<code class="literal">para1=val1&amp;para2=val2&amp;...</code>&#039;，也可以使用一个以字段名为键值，字段数据为值的数组。
            如果<code class="parameter">value</code>是一个数组，<code class="literal">Content-Type</code>头将会被设置成<code class="literal">multipart/form-data</code>。
            </span>
            <span class="simpara">
             可以使用 <span class="classname"><a href="class.curlfile.html" class="classname">CURLFile</a></span> 或 <span class="classname"><a href="class.curlstringfile.html" class="classname">CURLStringFile</a></span> 发送文件，在这种情况下，<code class="parameter">value</code> 必须是数组。
            </span>
           </td>
           <td style="vertical-align: top;">
           </td>
          </tr>

          <tr>
           <td style="vertical-align: top;"><strong><code>CURLOPT_PRIVATE</code></strong></td>
           <td style="vertical-align: top;">
            Any data that should be associated with this cURL handle. This data
            can subsequently be retrieved with the
            <strong><code>CURLINFO_PRIVATE</code></strong> option of
            <span class="function"><a href="function.curl-getinfo.html" class="function">curl_getinfo()</a></span>. cURL does nothing with this data.
            When using a cURL multi handle, this private data is typically a
            unique key to identify a standard cURL handle.
           </td>
           <td style="vertical-align: top;">
            Added in cURL 7.10.3. 
           </td>
          </tr>

          <tr>
           <td style="vertical-align: top;"><strong><code>CURLOPT_PRE_PROXY</code></strong></td>
           <td style="vertical-align: top;">
            Set a <span class="type">string</span> holding the host name or dotted numerical 
            IP address to be used as the preproxy that curl connects to before 
            it connects to the HTTP(S) proxy specified in the 
            <strong><code>CURLOPT_PROXY</code></strong> option for the upcoming request.
            The preproxy can only be a SOCKS proxy and it should be prefixed with
            <code class="literal">[scheme]://</code> to specify which kind of socks is used.
            A numerical IPv6 address must be written within [brackets].
            Setting the preproxy to an empty string explicitly disables the use of a preproxy. 
            To specify port number in this string, append <code class="literal">:[port]</code>
            to the end of the host name. The proxy&#039;s port number may optionally be 
            specified with the separate option <strong><code>CURLOPT_PROXYPORT</code></strong>. 
            Defaults to using port 1080 for proxies if a port is not specified.
           </td>
           <td style="vertical-align: top;">
            自 PHP 7.3.0 和 libcurl &gt;= cURL 7.52.0 起可用。
           </td>
          </tr>

          <tr>
           <td style="vertical-align: top;"><strong><code>CURLOPT_PROXY</code></strong></td>
           <td style="vertical-align: top;">
            HTTP 代理通道。
           </td>
           <td style="vertical-align: top;">
           </td>
          </tr>

           <tr>
           <td style="vertical-align: top;"><strong><code>CURLOPT_PROXY_SERVICE_NAME</code></strong></td>
           <td style="vertical-align: top;">
            代理验证服务的名称。
           </td>
           <td style="vertical-align: top;">
            在 cURL 7.43.0 中添加了 HTTP 代理，在 cURL 7.49.0 中添加了 SOCKS5 代理。自 PHP 7.0.7 起可用。
           </td>
          </tr>

          <tr>
           <td style="vertical-align: top;"><strong><code>CURLOPT_PROXY_CAINFO</code></strong></td>
           <td style="vertical-align: top;">
            The path to proxy Certificate Authority (CA) bundle. Set the path as a 
            <span class="type">string</span> naming a file holding one or more certificates to 
            verify the HTTPS proxy with.
            This option is for connecting to an HTTPS proxy, not an HTTPS server.
            Defaults set to the system path where libcurl&#039;s cacert bundle is assumed 
            to be stored.
           </td>
           <td style="vertical-align: top;">
            自 PHP 7.3.0 和 libcurl &gt;= cURL 7.52.0 起可用。
           </td>
          </tr>

          <tr>
           <td style="vertical-align: top;"><strong><code>CURLOPT_PROXY_CAPATH</code></strong></td>
           <td style="vertical-align: top;">
            The directory holding multiple CA certificates to verify the HTTPS proxy with.
           </td>
           <td style="vertical-align: top;">
            自 PHP 7.3.0 和 libcurl &gt;= cURL 7.52.0 起可用。
           </td>
          </tr>

          <tr>
           <td style="vertical-align: top;"><strong><code>CURLOPT_PROXY_CRLFILE</code></strong></td>
           <td style="vertical-align: top;">
            Set the file name with the concatenation of CRL (Certificate Revocation List) 
            in PEM format to use in the certificate validation that occurs during 
            the SSL exchange.
           </td>
           <td style="vertical-align: top;">
            自 PHP 7.3.0 和 libcurl &gt;= cURL 7.52.0 起可用。
           </td>
          </tr>

          <tr>
           <td style="vertical-align: top;"><strong><code>CURLOPT_PROXY_KEYPASSWD</code></strong></td>
           <td style="vertical-align: top;">
            Set the string be used as the password required to use the 
            <strong><code>CURLOPT_PROXY_SSLKEY</code></strong> private key. You never needed a 
            passphrase to load a certificate but you need one to load your private key.
            This option is for connecting to an HTTPS proxy, not an HTTPS server.
           </td>
           <td style="vertical-align: top;">
            自 PHP 7.3.0 和 libcurl &gt;= cURL 7.52.0 起可用。
           </td>
          </tr>

          <tr>
           <td style="vertical-align: top;"><strong><code>CURLOPT_PROXY_PINNEDPUBLICKEY</code></strong></td>
           <td style="vertical-align: top;">
            Set the pinned public key for HTTPS proxy. The string can be the file name 
            of your pinned public key. The file format expected is &quot;PEM&quot; or &quot;DER&quot;. 
            The string can also be any number of base64 encoded sha256 hashes preceded by 
            &quot;sha256//&quot; and separated by &quot;;&quot;
           </td>
           <td style="vertical-align: top;">
            自 PHP 7.3.0 和 libcurl &gt;= cURL 7.52.0 起可用。
           </td>
          </tr>

          <tr>
           <td style="vertical-align: top;"><strong><code>CURLOPT_PROXY_SSLCERT</code></strong></td>
           <td style="vertical-align: top;">
            The file name of your client certificate used to connect to the HTTPS proxy. 
            The default format is &quot;P12&quot; on Secure Transport and &quot;PEM&quot; on other engines, 
            and can be changed with <strong><code>CURLOPT_PROXY_SSLCERTTYPE</code></strong>.
            With NSS or Secure Transport, this can also be the nickname of the certificate 
            you wish to authenticate with as it is named in the security database. 
            If you want to use a file from the current directory, please precede it with 
            &quot;./&quot; prefix, in order to avoid confusion with a nickname.
           </td>
           <td style="vertical-align: top;">
            自 PHP 7.3.0 和 libcurl &gt;= cURL 7.52.0 起可用。
           </td>
          </tr>

          <tr>
           <td style="vertical-align: top;"><strong><code>CURLOPT_PROXY_SSLCERTTYPE</code></strong></td>
           <td style="vertical-align: top;">
            The format of your client certificate used when connecting to an HTTPS proxy.
            Supported formats are &quot;PEM&quot; and &quot;DER&quot;, except with Secure Transport. 
            OpenSSL (versions 0.9.3 and later) and Secure Transport 
            (on iOS 5 or later, or OS X 10.7 or later) also support &quot;P12&quot; for 
            PKCS#12-encoded files. Defaults to &quot;PEM&quot;.
           </td>
           <td style="vertical-align: top;">
            自 PHP 7.3.0 和 libcurl &gt;= cURL 7.52.0 起可用。
           </td>
          </tr>

          <tr>
           <td style="vertical-align: top;"><strong><code>CURLOPT_PROXY_SSL_CIPHER_LIST</code></strong></td>
           <td style="vertical-align: top;">
            The list of ciphers to use for the connection to the HTTPS proxy. 
            The list must be syntactically correct, it consists of one or more cipher 
            strings separated by colons. Commas or spaces are also acceptable separators 
            but colons are normally used, !, - and + can be used as operators.
           </td>
           <td style="vertical-align: top;">
            自 PHP 7.3.0 和 libcurl &gt;= cURL 7.52.0 起可用。
           </td>
          </tr>

          <tr>
           <td style="vertical-align: top;"><strong><code>CURLOPT_PROXY_TLS13_CIPHERS</code></strong></td>
           <td style="vertical-align: top;">
            The list of cipher suites to use for the TLS 1.3 connection to a proxy.
            The list must be syntactically correct, it consists of one or more 
            cipher suite strings separated by colons. This option is currently used 
            only when curl is built to use OpenSSL 1.1.1 or later. 
            If you are using a different SSL backend you can try setting 
            TLS 1.3 cipher suites by using the <strong><code>CURLOPT_PROXY_SSL_CIPHER_LIST</code></strong> option.
           </td>
           <td style="vertical-align: top;">
            自 PHP 7.3.0 和 libcurl &gt;= cURL 7.61.0 起可用。使用 OpenSSL &gt;= 1.1.1 编译时可用。
           </td>
          </tr>

          <tr>
           <td style="vertical-align: top;"><strong><code>CURLOPT_PROXY_SSLKEY</code></strong></td>
           <td style="vertical-align: top;">
            The file name of your private key used for connecting to the HTTPS proxy. 
            The default format is &quot;PEM&quot; and can be changed with 
            <strong><code>CURLOPT_PROXY_SSLKEYTYPE</code></strong>. 
            (iOS and Mac OS X only) This option is ignored if curl was built against Secure Transport.
           </td>
           <td style="vertical-align: top;">
            自 PHP 7.3.0 和 libcurl &gt;= cURL 7.52.0 起可用。如果启用内置 TLS，则可用。
           </td>
          </tr>

          <tr>
           <td style="vertical-align: top;"><strong><code>CURLOPT_PROXY_SSLKEYTYPE</code></strong></td>
           <td style="vertical-align: top;">
            The format of your private key. Supported formats are &quot;PEM&quot;, &quot;DER&quot; and &quot;ENG&quot;.
           </td>
           <td style="vertical-align: top;">
            自 PHP 7.3.0 和 libcurl &gt;= cURL 7.52.0 起可用。
           </td>
          </tr>

          <tr>
           <td style="vertical-align: top;"><strong><code>CURLOPT_PROXY_TLSAUTH_PASSWORD</code></strong></td>
           <td style="vertical-align: top;">
            The password to use for the TLS authentication method specified with the 
            <strong><code>CURLOPT_PROXY_TLSAUTH_TYPE</code></strong> option. Requires that the 
            <strong><code>CURLOPT_PROXY_TLSAUTH_USERNAME</code></strong> option to also be set.
           </td>
           <td style="vertical-align: top;">
            自 PHP 7.3.0 和 libcurl &gt;= cURL 7.52.0 起可用。
           </td>
          </tr>

          <tr>
           <td style="vertical-align: top;"><strong><code>CURLOPT_PROXY_TLSAUTH_TYPE</code></strong></td>
           <td style="vertical-align: top;">
            The method of the TLS authentication used for the HTTPS connection. Supported method is &quot;SRP&quot;.
            <blockquote class="note"><p><strong class="note">Note</strong>: 
             <p class="para">
              Secure Remote Password (SRP) authentication for TLS provides mutual authentication 
              if both sides have a shared secret. To use TLS-SRP, you must also set the 
              <strong><code>CURLOPT_PROXY_TLSAUTH_USERNAME</code></strong> and 
              <strong><code>CURLOPT_PROXY_TLSAUTH_PASSWORD</code></strong> options.
             </p>
            </p></blockquote>
           </td>
           <td style="vertical-align: top;">
            自 PHP 7.3.0 和 libcurl &gt;= cURL 7.52.0 起可用。
           </td>
          </tr>

          <tr>
           <td style="vertical-align: top;"><strong><code>CURLOPT_PROXY_TLSAUTH_USERNAME</code></strong></td>
           <td style="vertical-align: top;">
            The username to use for the HTTPS proxy TLS authentication method specified with the
            <strong><code>CURLOPT_PROXY_TLSAUTH_TYPE</code></strong> option. Requires that the
            <strong><code>CURLOPT_PROXY_TLSAUTH_PASSWORD</code></strong> option to also be set.
           </td>
           <td style="vertical-align: top;">
            自 PHP 7.3.0 和 libcurl &gt;= cURL 7.52.0 起可用。
           </td>
          </tr>

          <tr>
           <td style="vertical-align: top;"><strong><code>CURLOPT_PROXYUSERPWD</code></strong></td>
           <td style="vertical-align: top;">
            一个用来连接到代理的 <code class="literal">&quot;[username]:[password]&quot;</code> 格式的字符串。
           </td>
           <td style="vertical-align: top;">
           </td>
          </tr>

          <tr>
           <td style="vertical-align: top;"><strong><code>CURLOPT_RANDOM_FILE</code></strong></td>
           <td style="vertical-align: top;">
            一个被用来生成 SSL 随机数种子的文件名。
           </td>
           <td style="vertical-align: top;">
           </td>
          </tr>

          <tr>
           <td style="vertical-align: top;"><strong><code>CURLOPT_RANGE</code></strong></td>
           <td style="vertical-align: top;">
            以<code class="literal">&quot;X-Y&quot;</code>的形式，其中X和Y都是可选项获取数据的范围，以字节计。HTTP传输线程也支持几个这样的重复项中间用逗号分隔如<code class="literal">&quot;X-Y,N-M&quot;</code>。
           </td>
           <td style="vertical-align: top;">
           </td>
          </tr>

          <tr>
           <td style="vertical-align: top;"><strong><code>CURLOPT_REFERER</code></strong></td>
           <td style="vertical-align: top;">
            在HTTP请求头中<code class="literal">&quot;Referer: &quot;</code>的内容。
           </td>
           <td style="vertical-align: top;">
           </td>
          </tr>

          
          <tr>
           <td style="vertical-align: top;"><strong><code>CURLOPT_SERVICE_NAME</code></strong></td>
           <td style="vertical-align: top;">
            验证服务的名称
           </td>
           <td style="vertical-align: top;">
             cURL 7.43.0 起添加，自 PHP 7.0.7 有效。
           </td>
          </tr>

          <tr>
           <td style="vertical-align: top;"><strong><code>CURLOPT_SSH_HOST_PUBLIC_KEY_MD5</code></strong></td>
           <td style="vertical-align: top;">
            包含 32 位长的 16 进制数值。这个字符串应该是远程主机公钥（public key） 的 MD5 校验值。在不匹配的时候 libcurl 会拒绝连接。
            此选项仅用于  SCP 和 SFTP 的传输。
           </td>
           <td style="vertical-align: top;">
            cURL 7.17.1 中添加。
           </td>
          </tr>

          
          <tr>
           <td style="vertical-align: top;"><strong><code>CURLOPT_SSH_PUBLIC_KEYFILE</code></strong></td>
           <td style="vertical-align: top;">
            The file name for your public key. If not used, libcurl defaults to 
            $HOME/.ssh/id_dsa.pub if the HOME environment variable is set, 
            and just &quot;id_dsa.pub&quot; in the current directory if HOME is not set.
           </td>
           <td style="vertical-align: top;">
            Added in cURL 7.16.1. 
           </td>
          </tr>

          <tr>
           <td style="vertical-align: top;"><strong><code>CURLOPT_SSH_PRIVATE_KEYFILE</code></strong></td>
           <td style="vertical-align: top;">
            The file name for your private key. If not used, libcurl defaults to 
            $HOME/.ssh/id_dsa if the HOME environment variable is set, 
            and just &quot;id_dsa&quot; in the current directory if HOME is not set. 
            If the file is password-protected, set the password with 
            <strong><code>CURLOPT_KEYPASSWD</code></strong>.
           </td>
           <td style="vertical-align: top;">
            Added in cURL 7.16.1. 
           </td>
          </tr>

          <tr>
           <td style="vertical-align: top;"><strong><code>CURLOPT_SSL_CIPHER_LIST</code></strong></td>
           <td style="vertical-align: top;">
            一个SSL的加密算法列表。例如<code class="literal">RC4-SHA</code>和<code class="literal">TLSv1</code>都是可用的加密列表。
           </td>
           <td style="vertical-align: top;">
           </td>
          </tr>

          <tr>
           <td style="vertical-align: top;"><strong><code>CURLOPT_SSLCERT</code></strong></td>
           <td style="vertical-align: top;">
            一个包含 PEM 格式证书的文件名。
           </td>
           <td style="vertical-align: top;">
           </td>
          </tr>

          <tr>
           <td style="vertical-align: top;"><strong><code>CURLOPT_SSLCERTPASSWD</code></strong></td>
           <td style="vertical-align: top;">
            使用<strong><code>CURLOPT_SSLCERT</code></strong>证书需要的密码。
           </td>
           <td style="vertical-align: top;">
           </td>
          </tr>

          <tr>
           <td style="vertical-align: top;"><strong><code>CURLOPT_SSLCERTTYPE</code></strong></td>
           <td style="vertical-align: top;">
            证书的类型。支持的格式有<code class="literal">&quot;PEM&quot;</code> (默认值), <code class="literal">&quot;DER&quot;</code>和<code class="literal">&quot;ENG&quot;</code>。
           </td>
           <td style="vertical-align: top;">
            在 cURL 7.9.3中 被加入。
           </td>
          </tr>

          <tr>
           <td style="vertical-align: top;"><strong><code>CURLOPT_SSLENGINE</code></strong></td>
           <td style="vertical-align: top;">
            用来在<strong><code>CURLOPT_SSLKEY</code></strong>中指定的SSL私钥的加密引擎变量。
           </td>
           <td style="vertical-align: top;">
           </td>
          </tr>

          <tr>
           <td style="vertical-align: top;"><strong><code>CURLOPT_SSLENGINE_DEFAULT</code></strong></td>
           <td style="vertical-align: top;">
            用来做非对称加密操作的变量。
           </td>
           <td style="vertical-align: top;">
           </td>
          </tr>

          <tr>
           <td style="vertical-align: top;"><strong><code>CURLOPT_SSLKEY</code></strong></td>
           <td style="vertical-align: top;">
            包含 SSL 私钥的文件名。
           </td>
           <td style="vertical-align: top;">
           </td>
          </tr>

          <tr>
           <td style="vertical-align: top;"><strong><code>CURLOPT_SSLKEYPASSWD</code></strong></td>
           <td style="vertical-align: top;"><p class="para">
            在 <strong><code>CURLOPT_SSLKEY</code></strong>中指定了的SSL私钥的密码。
            <blockquote class="note"><p><strong class="note">Note</strong>: 
             <p class="para">
              由于这个选项包含了敏感的密码信息，记得保证这个PHP脚本的安全。
             </p>
            </p></blockquote>
            </p></td>
           <td style="vertical-align: top;">
           </td>
          </tr>

          <tr>
           <td style="vertical-align: top;"><strong><code>CURLOPT_SSLKEYTYPE</code></strong></td>
           <td style="vertical-align: top;">
            <strong><code>CURLOPT_SSLKEY</code></strong>中规定的私钥的加密类型，支持的密钥类型为<code class="literal">&quot;PEM&quot;</code>(默认值)、<code class="literal">&quot;DER&quot;</code>和<code class="literal">&quot;ENG&quot;</code>。
           </td>
           <td style="vertical-align: top;">
           </td>
          </tr>

          <tr>
           <td style="vertical-align: top;"><strong><code>CURLOPT_TLS13_CIPHERS</code></strong></td>
           <td style="vertical-align: top;">
            用于 TLS 1.3 连接的加密套件列表。列表必须在语法上正确，它由一个或多个用冒号分隔的加密套件字符串组成。当前仅当 curl 编译为使用 OpenSSL 1.1.1
            或更高版本时才使用此选项。如果使用不同的 SSL 后端，<strong><code>CURLOPT_SSL_CIPHER_LIST</code></strong> 选项设置 TLS 1.3 加密套件。
           </td>
           <td style="vertical-align: top;">
            自 PHP 7.3.0 和 libcurl &gt;= cURL 7.61.0 起可用。使用 OpenSSL &gt;= 1.1.1 编译时可用。
           </td>
          </tr>

          <tr>
           <td style="vertical-align: top;"><strong><code>CURLOPT_UNIX_SOCKET_PATH</code></strong></td>
           <td style="vertical-align: top;">
            使用 Unix 套接字作为连接，并用指定的 <span class="type">string</span> 作为路径。
           </td>
           <td style="vertical-align: top;">
            cURL 7.40.0 中添加， PHP 7.0.7 起有效。
           </td>
          </tr>

          <tr>
           <td style="vertical-align: top;"><strong><code>CURLOPT_URL</code></strong></td>
           <td style="vertical-align: top;">
            需要获取的 URL 地址，也可以在<span class="function"><a href="function.curl-init.html" class="function">curl_init()</a></span> 初始化会话的时候。
           </td>
           <td style="vertical-align: top;">
           </td>
          </tr>

          <tr>
           <td style="vertical-align: top;"><strong><code>CURLOPT_USERAGENT</code></strong></td>
           <td style="vertical-align: top;">
            在HTTP请求中包含一个<code class="literal">&quot;User-Agent: &quot;</code>头的字符串。
           </td>
           <td style="vertical-align: top;">
           </td>
          </tr>

          <tr>
           <td style="vertical-align: top;"><strong><code>CURLOPT_USERNAME</code></strong></td>
           <td style="vertical-align: top;">
            用于身份验证的用户名。
           </td>
           <td style="vertical-align: top;">
            cURL 7.19.1 中添加。
           </td>
          </tr>

          <tr>
           <td style="vertical-align: top;"><strong><code>CURLOPT_PASSWORD</code></strong></td>
           <td style="vertical-align: top;">
            用于身份验证的密码。
           </td>
           <td style="vertical-align: top;">
            cURL 7.19.1 中添加。
           </td>
          </tr>

          <tr>
           <td style="vertical-align: top;"><strong><code>CURLOPT_USERPWD</code></strong></td>
           <td style="vertical-align: top;">
            传递一个连接中需要的用户名和密码，格式为：<code class="literal">&quot;[username]:[password]&quot;</code>。
           </td>
           <td style="vertical-align: top;">
           </td>
          </tr>

          <tr>
           <td style="vertical-align: top;"><strong><code>CURLOPT_XOAUTH2_BEARER</code></strong></td>
           <td style="vertical-align: top;">
            指定 OAuth 2.0 access token。
           </td>
           <td style="vertical-align: top;">
            cURL 7.33.0 中添加，自 PHP 7.0.7 添加。
           </td>
          </tr>

         </tbody>
        
       </table>

      </p>
      <p class="para">以下<code class="parameter">option</code>，<code class="parameter">value</code>应该被设置成数组：
       <table class="doctable informaltable">
        
         <thead>
          <tr>
           <th>选项</th>
           <th>可选<code class="parameter">value</code>值</th>
           <th>备注</th>
          </tr>

         </thead>

         <tbody class="tbody">
          <tr>
           <td style="vertical-align: top;"><strong><code>CURLOPT_CONNECT_TO</code></strong></td>
           <td style="vertical-align: top;">
            连接到指定的主机和端口，替换 URL 中的主机和端口。接受指定字符串格式的数组：
            <code class="literal">HOST:PORT:CONNECT-TO-HOST:CONNECT-TO-PORT</code>。
           </td>
           <td style="vertical-align: top;">
             cURL 7.49.0 中添加， PHP 7.0.7 起有效。
           </td>
          </tr>

          <tr>
           <td style="vertical-align: top;"><strong><code>CURLOPT_HTTP200ALIASES</code></strong></td>
           <td style="vertical-align: top;">
            HTTP 200 响应码数组，数组中的响应码被认为是正确的响应，而非错误。
           </td>
           <td style="vertical-align: top;">
            在 cURL 7.10.3 中被加入。
           </td>
          </tr>

          
          
          
          
          
          <tr>
           <td style="vertical-align: top;"><strong><code>CURLOPT_HTTPHEADER</code></strong></td>
           <td style="vertical-align: top;">
            设置 HTTP 头字段的数组。格式：
            <code class="code">
             array(&#039;Content-type: text/plain&#039;, &#039;Content-length: 100&#039;)
            </code>
           </td>
           <td style="vertical-align: top;">
           </td>
          </tr>

          <tr>
           <td style="vertical-align: top;"><strong><code>CURLOPT_POSTQUOTE</code></strong></td>
           <td style="vertical-align: top;">
            在 FTP 请求执行完成后，在服务器上执行的一组array格式的 FTP 命令。
           </td>
           <td style="vertical-align: top;">
           </td>
          </tr>

          
          <tr>
           <td style="vertical-align: top;"><strong><code>CURLOPT_PROXYHEADER</code></strong></td>
           <td style="vertical-align: top;">
            传给代理的自定义 HTTP 头。
           </td>
           <td style="vertical-align: top;">
             cURL 7.37.0 中添加，自 PHP 7.0.7 添加。
           </td>
          </tr>

          
          
          <tr>
           <td style="vertical-align: top;"><strong><code>CURLOPT_QUOTE</code></strong></td>
           <td style="vertical-align: top;">
            一组先于 FTP 请求的在服务器上执行的FTP命令。
           </td>
           <td style="vertical-align: top;">
           </td>
          </tr>

          
          <tr>
           <td style="vertical-align: top;"><strong><code>CURLOPT_RESOLVE</code></strong></td>
           <td style="vertical-align: top;">
            提供自定义地址，指定了主机和端口。
            包含主机、端口和 ip 地址的字符串，组成 array 的，每个元素以冒号分隔。格式：
            <code class="code">
             array(&quot;example.com:80:127.0.0.1&quot;)
            </code>
           </td>
           <td style="vertical-align: top;">
            在 cURL 7.21.3 中添加。
           </td>
          </tr>

         </tbody>
        
       </table>

      </p>
      <p class="para">
以下 <code class="parameter">option</code>，<code class="parameter">value</code>应该被设置成流资源
        （例如使用<span class="function"><a href="function.fopen.html" class="function">fopen()</a></span>）：
       <table class="doctable informaltable">
        
         <thead>
          <tr>
           <th>选项</th>
           <th>可选<code class="parameter">value</code>值</th>
          </tr>

         </thead>

         <tbody class="tbody">
          
          
          
          
          <tr>
           <td style="vertical-align: top;"><strong><code>CURLOPT_FILE</code></strong></td>
           <td style="vertical-align: top;">
            设置输出文件，默认为<code class="literal">STDOUT</code> (浏览器)。
           </td>
          </tr>

          <tr>
           <td style="vertical-align: top;"><strong><code>CURLOPT_INFILE</code></strong></td>
           <td style="vertical-align: top;">
            上传文件时需要读取的文件。
           </td>
          </tr>

          <tr>
           <td style="vertical-align: top;"><strong><code>CURLOPT_STDERR</code></strong></td>
           <td style="vertical-align: top;">
            错误输出的地址，取代默认的<code class="literal">STDERR</code>。
           </td>
          </tr>

          <tr>
           <td style="vertical-align: top;"><strong><code>CURLOPT_WRITEHEADER</code></strong></td>
           <td style="vertical-align: top;">
            设置 header 部分内容的写入的文件地址。
           </td>
          </tr>

         </tbody>
        
       </table>

      </p>
      <p class="para">
       以下<code class="parameter">option</code> 的 <code class="parameter">value</code>应该是有效的函数或者闭包：
       <table class="doctable informaltable">
        
         <thead>
          <tr>
           <th>选项</th>
           <th>设置 <code class="parameter">value</code> 为</th>
           <th>笔记</th>
          </tr>

         </thead>

         <tbody class="tbody">
          <tr>
           <td style="vertical-align: top;"><strong><code>CURLOPT_HEADERFUNCTION</code></strong></td>
           <td style="vertical-align: top;">
            设置一个回调函数，这个函数有两个参数，第一个是cURL的资源句柄，第二个是输出的 header 数据。header数据的输出必须依赖这个函数，返回已写入的数据大小。
           </td>
           <td class="empty">&nbsp;</td>
          </tr>

          <tr>
           <td style="vertical-align: top;"><strong><code>CURLOPT_PASSWDFUNCTION</code></strong></td>
           <td style="vertical-align: top;">
            设置一个回调函数，有三个参数，第一个是cURL的资源句柄，第二个是一个密码提示符，第三个参数是密码长度允许的最大值。返回密码的值。
           </td>
           <td>从 PHP 7.3.0 开始移除。</td>
          </tr>

          <tr>
           <td style="vertical-align: top;"><strong><code>CURLOPT_PROGRESSFUNCTION</code></strong></td>
           <td style="vertical-align: top;">
            <p class="para">
            设置一个回调函数，有五个参数，第一个是cURL的资源句柄，第二个是预计要下载的总字节（bytes）数。第三个是目前下载的字节数，第四个是预计传输中总上传字节数，第五个是目前上传的字节数。
            </p>
            <blockquote class="note"><p><strong class="note">Note</strong>: 
             <p class="para">
              只有设置 <strong><code>CURLOPT_NOPROGRESS</code></strong>
              选项为 <strong><code>false</code></strong> 时才会调用这个回调函数。
             </p>
            </p></blockquote>
              <p class="para">
               返回非零值将中断传输。
               传输将设置 <strong><code>CURLE_ABORTED_BY_CALLBACK</code></strong> 错误。
            </p>
           </td>
           <td class="empty">&nbsp;</td>
          </tr>

          <tr>
           <td style="vertical-align: top;"><strong><code>CURLOPT_READFUNCTION</code></strong></td>
           <td style="vertical-align: top;">
            回调函数名。该函数应接受三个参数。第一个是 cURL resource；第二个是通过选项 
<strong><code>CURLOPT_INFILE</code></strong> 传给 cURL 的 stream resource；第三个参数是最大可以读取的数据的数量。回
调函数必须返回一个字符串，长度小于或等于请求的数据量（第三个参数）。一般从传入的 stream 
resource 读取。返回空字符串作为 <code class="literal">EOF</code>（文件结束） 信号。
           </td>
           <td class="empty">&nbsp;</td>
          </tr>

          <tr>
           <td style="vertical-align: top;"><strong><code>CURLOPT_WRITEFUNCTION</code></strong></td>
           <td style="vertical-align: top;">
            回调函数名。该函数应接受两个参数。第一个是 cURL resource；第二个是要写入的数据字符串。数
据必须在函数中被保存。
            函数必须准确返回写入数据的字节数，否则传输会被一个错误所中
断。
           </td>
           <td class="empty">&nbsp;</td>
          </tr>

          <tr>
           <td style="vertical-align: top;"><strong><code>CURLOPT_XFERINFOFUNCTION</code></strong></td>
           <td style="vertical-align: top;">
            接受两个参数的回调。与 <strong><code>CURLOPT_PROGRESSFUNCTION</code></strong> 具有相似的目的，但更现代并且是 cURL 的首选选项。
           </td>
           <td style="vertical-align: top;">
            在 7.32.0 中添加。 从 PHP 8.2.0 开始可用。
           </td>
          </tr>

         </tbody>
        
       </table>

      </p>
      <p class="para">
       其他值：
       <table class="doctable informaltable">
        
         <thead>
          <tr>
           <th>Option</th>
           <th>设置 <code class="parameter">value</code> 为</th>
          </tr>

         </thead>

         <tbody class="tbody">
          <tr>
           <td style="vertical-align: top;"><strong><code>CURLOPT_SHARE</code></strong></td>
           <td style="vertical-align: top;"> <span class="function"><a href="function.curl-share-init.html" class="function">curl_share_init()</a></span> 返回的结果。
            使 cURL 可以处理共享句柄里的数据。
           </td>
          </tr>

         </tbody>
        
       </table>

      </p>
     </dd>

    
   </dl>

  </p>
 </div>

 
 <div class="refsect1 returnvalues" id="refsect1-function.curl-setopt-returnvalues">
  <h3 class="title">返回值</h3>
  <p class="para">
   成功时返回 <strong><code>true</code></strong>， 或者在失败时返回 <strong><code>false</code></strong>。
  </p>
 </div>

 
 <div class="refsect1 changelog" id="refsect1-function.curl-setopt-changelog">
  <h3 class="title">更新日志</h3>
  <p class="para">
   <table class="doctable informaltable">
    
     <thead>
      <tr>
       <th>版本</th>
       <th>说明</th>
      </tr>

     </thead>

     <tbody class="tbody">
      <tr>
 <td>8.0.0</td>
 <td>
  <code class="parameter">handle</code> 现在接受 <span class="classname"><a href="class.curlhandle.html" class="classname">CurlHandle</a></span>
  实例；之前接受 <span class="type">resource</span>。
 </td>
</tr>

      <tr>
       <td>7.3.15、7.4.3</td>
       <td>
        引入 <strong><code>CURLOPT_HTTP09_ALLOWED </code></strong>。
       </td>
      </tr>

      <tr>
       <td>7.3.0</td>
       <td>
        引入 <strong><code>CURLOPT_ABSTRACT_UNIX_SOCKET</code></strong>、<strong><code>CURLOPT_KEEP_SENDING_ON_ERROR</code></strong>、<strong><code>CURLOPT_PRE_PROXY</code></strong>、<strong><code>CURLOPT_PROXY_CAINFO</code></strong>、<strong><code>CURLOPT_PROXY_CAPATH</code></strong>、<strong><code>CURLOPT_PROXY_CRLFILE</code></strong>、<strong><code>CURLOPT_PROXY_KEYPASSWD</code></strong>、<strong><code>CURLOPT_PROXY_PINNEDPUBLICKEY</code></strong>、<strong><code>CURLOPT_PROXY_SSLCERT</code></strong>、<strong><code>CURLOPT_PROXY_SSLCERTTYPE</code></strong>、<strong><code>CURLOPT_PROXY_SSL_CIPHER_LIST</code></strong>、<strong><code>CURLOPT_PROXY_SSLKEY</code></strong>、<strong><code>CURLOPT_PROXY_SSLKEYTYPE</code></strong>、<strong><code>CURLOPT_PROXY_SSL_OPTIONS</code></strong>、<strong><code>CURLOPT_PROXY_SSL_VERIFYHOST</code></strong>、<strong><code>CURLOPT_PROXY_SSL_VERIFYPEER</code></strong>、<strong><code>CURLOPT_PROXY_SSLVERSION</code></strong>、<strong><code>CURLOPT_PROXY_TLSAUTH_PASSWORD</code></strong>、<strong><code>CURLOPT_PROXY_TLSAUTH_TYPE</code></strong>、<strong><code>CURLOPT_PROXY_TLSAUTH_USERNAME</code></strong>、<strong><code>CURLOPT_SOCKS5_AUTH</code></strong>、<strong><code>CURLOPT_SUPPRESS_CONNECT_HEADERS</code></strong>、<strong><code>CURLOPT_DISALLOW_USERNAME_IN_URL</code></strong>、<strong><code>CURLOPT_DNS_SHUFFLE_ADDRESSES</code></strong>、<strong><code>CURLOPT_HAPPY_EYEBALLS_TIMEOUT_MS</code></strong>、<strong><code>CURLOPT_HAPROXYPROTOCOL</code></strong>、<strong><code>CURLOPT_PROXY_TLS13_CIPHERS</code></strong>、<strong><code>CURLOPT_SSH_COMPRESSION</code></strong>、<strong><code>CURLOPT_TIMEVALUE_LARGE</code></strong>
        和 <strong><code>CURLOPT_TLS13_CIPHERS</code></strong>。
       </td>
      </tr>

      <tr>
       <td>7.0.7</td>
       <td>
        引入 <strong><code>CURL_HTTP_VERSION_2</code></strong>、<strong><code>CURL_HTTP_VERSION_2_PRIOR_KNOWLEDGE</code></strong>、
        <strong><code>CURL_HTTP_VERSION_2TLS</code></strong>、<strong><code>CURL_REDIR_POST_301</code></strong>、
        <strong><code>CURL_REDIR_POST_302</code></strong>、<strong><code>CURL_REDIR_POST_303</code></strong>、
        <strong><code>CURL_REDIR_POST_ALL</code></strong>、<strong><code>CURL_VERSION_KERBEROS5</code></strong>、
        <strong><code>CURL_VERSION_PSL</code></strong>、<strong><code>CURL_VERSION_UNIX_SOCKETS</code></strong>、
        <strong><code>CURLAUTH_NEGOTIATE</code></strong>、<strong><code>CURLAUTH_NTLM_WB</code></strong>、
        <strong><code>CURLFTP_CREATE_DIR</code></strong>、<strong><code>CURLFTP_CREATE_DIR_NONE</code></strong>、
        <strong><code>CURLFTP_CREATE_DIR_RETRY</code></strong>、<strong><code>CURLHEADER_SEPARATE</code></strong>、
        <strong><code>CURLHEADER_UNIFIED</code></strong>、<strong><code>CURLMOPT_CHUNK_LENGTH_PENALTY_SIZE</code></strong>、
        <strong><code>CURLMOPT_CONTENT_LENGTH_PENALTY_SIZE</code></strong>、<strong><code>CURLMOPT_MAX_HOST_CONNECTIONS</code></strong>、
        <strong><code>CURLMOPT_MAX_PIPELINE_LENGTH</code></strong>、<strong><code>CURLMOPT_MAX_TOTAL_CONNECTIONS</code></strong>、
        <strong><code>CURLOPT_CONNECT_TO</code></strong>、<strong><code>CURLOPT_DEFAULT_PROTOCOL</code></strong>、
        <strong><code>CURLOPT_DNS_INTERFACE</code></strong>、<strong><code>CURLOPT_DNS_LOCAL_IP4</code></strong>、
        <strong><code>CURLOPT_DNS_LOCAL_IP6</code></strong>、<strong><code>CURLOPT_EXPECT_100_TIMEOUT_MS</code></strong>、
        <strong><code>CURLOPT_HEADEROPT</code></strong>、<strong><code>CURLOPT_LOGIN_OPTIONS</code></strong>、
        <strong><code>CURLOPT_PATH_AS_IS</code></strong>、<strong><code>CURLOPT_PINNEDPUBLICKEY</code></strong>、
        <strong><code>CURLOPT_PIPEWAIT</code></strong>、<strong><code>CURLOPT_PROXY_SERVICE_NAME</code></strong>、
        <strong><code>CURLOPT_PROXYHEADER</code></strong>、<strong><code>CURLOPT_SASL_IR</code></strong>、
        <strong><code>CURLOPT_SERVICE_NAME</code></strong>、<strong><code>CURLOPT_SSL_ENABLE_ALPN</code></strong>、
        <strong><code>CURLOPT_SSL_ENABLE_NPN</code></strong>、<strong><code>CURLOPT_SSL_FALSESTART</code></strong>、
        <strong><code>CURLOPT_SSL_VERIFYSTATUS</code></strong>、<strong><code>CURLOPT_STREAM_WEIGHT</code></strong>、
        <strong><code>CURLOPT_TCP_FASTOPEN</code></strong>、<strong><code>CURLOPT_TFTP_NO_OPTIONS</code></strong>、
        <strong><code>CURLOPT_UNIX_SOCKET_PATH</code></strong>、<strong><code>CURLOPT_XOAUTH2_BEARER</code></strong>、
        <strong><code>CURLPROTO_SMB</code></strong>、<strong><code>CURLPROTO_SMBS</code></strong>、
        <strong><code>CURLPROXY_HTTP_1_0</code></strong>、<strong><code>CURLSSH_AUTH_AGENT</code></strong> 和
        <strong><code>CURLSSLOPT_NO_REVOKE</code></strong>。
       </td>
      </tr>

     </tbody>
    
   </table>

  </p>
 </div>

 
 <div class="refsect1 examples" id="refsect1-function.curl-setopt-examples">
  <h3 class="title">示例</h3>
  <p class="para">
   <div class="example" id="">
    <p><strong>Example #1 初始化一个新的cURL会话并获取一个网页</strong></p>
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br /></span><span style="color: #FF8000">// 创建一个新cURL资源<br /></span><span style="color: #0000BB">$ch </span><span style="color: #007700">= </span><span style="color: #0000BB">curl_init</span><span style="color: #007700">();<br /><br /></span><span style="color: #FF8000">// 设置URL和相应的选项<br /></span><span style="color: #0000BB">curl_setopt</span><span style="color: #007700">(</span><span style="color: #0000BB">$ch</span><span style="color: #007700">, </span><span style="color: #0000BB">CURLOPT_URL</span><span style="color: #007700">, </span><span style="color: #DD0000">"http://www.example.com/"</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">curl_setopt</span><span style="color: #007700">(</span><span style="color: #0000BB">$ch</span><span style="color: #007700">, </span><span style="color: #0000BB">CURLOPT_HEADER</span><span style="color: #007700">, </span><span style="color: #0000BB">false</span><span style="color: #007700">);<br /><br /></span><span style="color: #FF8000">// 抓取URL并把它传递给浏览器<br /></span><span style="color: #0000BB">curl_exec</span><span style="color: #007700">(</span><span style="color: #0000BB">$ch</span><span style="color: #007700">);<br /><br /></span><span style="color: #FF8000">//关闭cURL资源，并且释放系统资源<br /></span><span style="color: #0000BB">curl_close</span><span style="color: #007700">(</span><span style="color: #0000BB">$ch</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
    </div>

   </div>
  </p>
 </div>

 
 <div class="refsect1 notes" id="refsect1-function.curl-setopt-notes">
  <h3 class="title">注释</h3>
  <blockquote class="note"><p><strong class="note">Note</strong>: 
   <p class="para">
    传递一个数组到<strong><code>CURLOPT_POSTFIELDS</code></strong>，cURL会把数据编码成
    <em class="emphasis">multipart/form-data</em>，而然传递一个URL-encoded字符串时，数据会被编码成
    <em class="emphasis">application/x-www-form-urlencoded</em>。
   </p>
  </p></blockquote>
 </div>

 
 <div class="refsect1 seealso" id="refsect1-function.curl-setopt-seealso">
  <h3 class="title">参见</h3>
  <p class="para">
   <ul class="simplelist">
    <li class="member"><span class="function"><a href="function.curl-setopt-array.html" class="function" rel="rdfs-seeAlso">curl_setopt_array()</a> - 为 cURL 传输会话批量设置选项</span></li>
    <li class="member"><span class="classname"><a href="class.curlfile.html" class="classname">CURLFile</a></span></li>
    <li class="member"><span class="classname"><a href="class.curlstringfile.html" class="classname">CURLStringFile</a></span></li>
   </ul>
  </p>
 </div>

 
</div><div id="usernotes">
 <div class="head">
  <h3 class="title">User Contributed Notes</h3>
 </div>
<div id="allnotes">  <a name="128365""></a>
  <div class="note">
   <strong class="user">Niki Romagnoli</strong>
   <a href="#128365" class="date">04-Apr-2023 11:44</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Set order when using CURLOPT_POST and CURLOPT_POSTFIELDS *matters*.<br />
Setting CURL_POST to true will ERASE any previous CURLOPT_POSTFIELDS using an array. Result is request be a POST with empty body.<br />
<br />
CURLOPT_POSTFIELDS will set CURLOPT_POST to true for you, no need for repeat.<br />
If you really need to set both, then either:<br />
&nbsp; - set CURLOPT_POST *before* CURLOPT_POSTFIELDS<br />
&nbsp; - or don't use array and convert CURLOPT_POSTFIELDS to URL-encoded string, it will not be affected this way (ie. <span class="default">&lt;?php curl_setopt</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_POSTFIELDS</span><span class="keyword">, </span><span class="default">http_build_query</span><span class="keyword">(</span><span class="default">$yourArray</span><span class="keyword">)); </span><span class="default">?&gt;</span> )</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="128203""></a>
  <div class="note">
   <strong class="user">reed at taeluf dot com</strong>
   <a href="#128203" class="date">09-Feb-2023 07:41</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
setting `CURLOPT_USERPWD` to `user:password` is equivalent to `curl -u user:password`</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="127785""></a>
  <div class="note">
   <strong class="user">simbiat at outlook dot com</strong>
   <a href="#127785" class="date">20-Oct-2022 04:06</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Apparently, when you use CURLOPT_FILE to direct output to a file instead of STDOUT after handle creation, it automatically sets CURLOPT_RETURNTRANSFER to false. If you try to reuse the handle in such a situation (even with a different file), you may get warning like "CURLOPT_FILE resource has gone away, resetting to default" and content of the previous response will be sent to browser (and seemingly exit the script). To avoid this behavior, you need to CURLOPT_RETURNTRANSFER to true after updating CURLOPT_FILE. If you do want the response from the handle as a string, that is.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="125490""></a>
  <div class="note">
   <strong class="user">qwertz182</strong>
   <a href="#125490" class="date">06-Nov-2020 11:18</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
As the "example #2 Uploading file" says it is deprecated as of PHP 5.5.0 but doesn't tell you how it's done right,<br />
here is a really easy example using the CURLFile class:<br />
<br />
<span class="default">&lt;?php<br />
$request </span><span class="keyword">= [<br />
&nbsp;&nbsp;&nbsp; </span><span class="string">'firstName' </span><span class="keyword">=&gt; </span><span class="string">'John'</span><span class="keyword">,<br />
&nbsp;&nbsp;&nbsp; </span><span class="string">'lastName' </span><span class="keyword">=&gt; </span><span class="string">'Doe'</span><span class="keyword">,<br />
&nbsp;&nbsp;&nbsp; </span><span class="string">'file' </span><span class="keyword">=&gt; new </span><span class="default">CURLFile</span><span class="keyword">(</span><span class="string">'example.txt'</span><span class="keyword">, </span><span class="string">'text/plain'</span><span class="keyword">) </span><span class="comment">// or use curl_file_create()<br />
</span><span class="keyword">];<br />
<br />
</span><span class="default">$curlOptions </span><span class="keyword">= [<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">CURLOPT_URL </span><span class="keyword">=&gt; </span><span class="string">'<a href="http://example.com/upload.php" rel="nofollow" target="_blank">http://example.com/upload.php</a>'</span><span class="keyword">,<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">CURLOPT_POST </span><span class="keyword">=&gt; </span><span class="default">true</span><span class="keyword">,<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">CURLOPT_HEADER </span><span class="keyword">=&gt; </span><span class="default">false</span><span class="keyword">,<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">CURLOPT_RETURNTRANSFER </span><span class="keyword">=&gt; </span><span class="default">true</span><span class="keyword">,<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">CURLOPT_POSTFIELDS </span><span class="keyword">=&gt; </span><span class="default">$request</span><span class="keyword">,<br />
];<br />
<br />
</span><span class="default">$ch </span><span class="keyword">= </span><span class="default">curl_init</span><span class="keyword">();<br />
</span><span class="default">curl_setopt_array</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">$curlOptions</span><span class="keyword">);<br />
<br />
</span><span class="default">$response </span><span class="keyword">= </span><span class="default">curl_exec</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">);<br />
</span><span class="default">?&gt;<br />
</span><br />
This is just like posting a html form with an input[type=file] field.<br />
The result on windows could look like this:<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="comment">// $_POST<br />
</span><span class="keyword">Array<br />
(<br />
&nbsp;&nbsp;&nbsp; [</span><span class="default">firstName</span><span class="keyword">] =&gt; </span><span class="default">John<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">[</span><span class="default">lastName</span><span class="keyword">] =&gt; </span><span class="default">Doe<br />
</span><span class="keyword">)<br />
<br />
</span><span class="comment">// $_FILES<br />
</span><span class="keyword">Array<br />
(<br />
&nbsp;&nbsp;&nbsp; [</span><span class="default">file</span><span class="keyword">] =&gt; Array<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; (<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [</span><span class="default">name</span><span class="keyword">] =&gt; </span><span class="default">example</span><span class="keyword">.</span><span class="default">txt<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">[</span><span class="default">type</span><span class="keyword">] =&gt; </span><span class="default">text</span><span class="keyword">/</span><span class="default">plain<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">[</span><span class="default">tmp_name</span><span class="keyword">] =&gt; </span><span class="default">C</span><span class="keyword">:</span><span class="default">\wamp64\tmp\php3016</span><span class="keyword">.</span><span class="default">tmp<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">[</span><span class="default">error</span><span class="keyword">] =&gt; </span><span class="default">0<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">[</span><span class="default">size</span><span class="keyword">] =&gt; </span><span class="default">14<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">)<br />
<br />
)<br />
</span><span class="default">?&gt;<br />
</span><br />
Since the request is an array (and not a string), curl will automatically encode the data as "multipart/form-data".<br />
Please be aware that if you pass an invalid file path to CURLFile, setting the CURLOPT_POSTFIELDS option will fail.<br />
So if you are using curl_setopt_array for setting the options at once, according to the manual, "If an option could not be successfully set, FALSE is immediately returned, ignoring any future options in the options array.".<br />
So you should make sure that the file exists or set CURLOPT_POSTFIELDS with curl_setopt() and check if it returns false and act accordingly.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="123741""></a>
  <div class="note">
   <strong class="user">JM</strong>
   <a href="#123741" class="date">04-Apr-2019 10:34</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Note that CURLOPT_TIMEOUT takes integers, so you cannot use it to set a timeout smaller than one second.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="123340""></a>
  <div class="note">
   <strong class="user">eric dot van dot eldik at peercode dot nl</strong>
   <a href="#123340" class="date">13-Nov-2018 01:21</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
When you get this error using a PUT request: "SSL read: error:00000000:lib(0):func(0):reason(0), errno 104")<br />
<br />
It could be caused by:<br />
<span class="default">&lt;?php<br />
curl_setopt</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_PUT</span><span class="keyword">, </span><span class="default">TRUE</span><span class="keyword">);<br />
</span><span class="default">?&gt;<br />
</span><br />
Instead try:<br />
<span class="default">&lt;?php<br />
curl_setopt</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_CUSTOMREQUEST</span><span class="keyword">, </span><span class="string">"PUT"</span><span class="keyword">);<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="122799""></a>
  <div class="note">
   <strong class="user">bash at noemailaddress dot com</strong>
   <a href="#122799" class="date">04-Jun-2018 08:52</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Be sure not to set CURLOPT_POST to 1 (or True) if you are uploading a file, even if you are also providing textual Post data in your request. Took two hours to discover that including this option was the cause of my receiving script not having $_FILES set. The documentation explains it, but many examples around the web incorrectly include the CURLOPT_POST option in their example code. (Their examples only work because they happen to set this option first, and curl automatically resets it if you set CURLOPT_POSTFIELDS and it includes a file. Set your post fields first and then the CURLOPT_POST option however, and your code will not work.)<br />
<br />
Per the documentation:<br />
CURLOPT_POST: "TRUE to do a regular HTTP POST. This POST is the normal application/x-www-form-urlencoded kind, most commonly used by HTML forms. "</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="122274""></a>
  <div class="note">
   <strong class="user">joel at mojamail dot com</strong>
   <a href="#122274" class="date">16-Jan-2018 11:57</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
In the long documentation, it's easy to miss the fact that CURLOPT_POSTFIELDS will set the Content-Type to "multipart/form-data" (instead of the usual "application/x-www-form-urlencoded") IFF you supply an array (instead of a query string)!<br />
<br />
Some servers will return weird errors (like "SSL read: error:00000000:lib(0):func(0):reason(0), errno 104") for the wrong Content-Type, and you may waste many hours of time trying to figure out why!</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="121973""></a>
  <div class="note">
   <strong class="user">ohcc at 163 dot com</strong>
   <a href="#121973" class="date">04-Dec-2017 02:59</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
This is howto upload an existing file to an FTP server with cURL in PHP.<br />
<br />
You should remember that CURLOPT_URL should contain the file's basename to save on the FTP server. For example, if you upload hello.txt to <a href="ftp://www.wuxiancheng.cn/text/, CURLOPT_URL should be ftp://www.wuxiancheng.cn/text/hello.txt rather than ftp://www.wuxiancheng.cn/text/, otherwise you will get an error message like " rel="nofollow" target="_blank">ftp://www.wuxiancheng.cn/text/, CURLOPT_URL should be ftp://www.wuxiancheng.cn/text/hello.txt rather than ftp://www.wuxiancheng.cn/text/, otherwise you will get an error message like </a>"Uploading to a URL without a file name! " when you call curl_error();<br />
<br />
<span class="default">&lt;?php<br />
&nbsp;&nbsp;&nbsp; $ch </span><span class="keyword">= </span><span class="default">curl_init</span><span class="keyword">();<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$filepath </span><span class="keyword">= </span><span class="string">'D:\Web\www\wuxiancheng.cn\hello.txt'</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$basename </span><span class="keyword">= </span><span class="default">pathInfo</span><span class="keyword">(</span><span class="default">$filepath</span><span class="keyword">, </span><span class="default">PATHINFO_BASENAME</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$filesize </span><span class="keyword">= </span><span class="default">fileSize</span><span class="keyword">(</span><span class="default">$filepath</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">curl_setopt_array</span><span class="keyword">(<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$ch</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; array(<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">CURLOPT_URL </span><span class="keyword">=&gt; </span><span class="string">'<a href="ftp://www.wuxiancheng.cn/text/" rel="nofollow" target="_blank">ftp://www.wuxiancheng.cn/text/</a>' </span><span class="keyword">. </span><span class="default">$basename</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">CURLOPT_USERPWD </span><span class="keyword">=&gt; </span><span class="string">'USERNAME:PASSWORD'</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">CURLOPT_PROTOCOLS </span><span class="keyword">=&gt; </span><span class="default">CURLPROTO_FTP</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">CURLOPT_UPLOAD </span><span class="keyword">=&gt; </span><span class="default">true</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">CURLOPT_INFILE </span><span class="keyword">=&gt; </span><span class="default">$filepath</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">CURLOPT_INFILESIZE </span><span class="keyword">=&gt; </span><span class="default">$filesize</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">CURLOPT_RETURNTRANSFER </span><span class="keyword">=&gt; </span><span class="default">true</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">CURLOPT_HEADER </span><span class="keyword">=&gt; </span><span class="default">false</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; )<br />
&nbsp;&nbsp;&nbsp; );<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">curl_exec</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$message </span><span class="keyword">= </span><span class="default">curl_errno</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">) === </span><span class="default">CURLE_OK </span><span class="keyword">? </span><span class="string">'success' </span><span class="keyword">: </span><span class="string">'failure'</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; echo </span><span class="default">$message</span><span class="keyword">;<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="121874""></a>
  <div class="note">
   <strong class="user">cmatiasvillanueva at gmail dot com</strong>
   <a href="#121874" class="date">15-Nov-2017 07:54</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
What is not mentioned in the documentation is that if you want to set&nbsp; a local-port or local-port-range to establish a connection is possible by adding&nbsp;&nbsp; CURLOPT_LOCALPORT and CURLOPT_LOCALPORTRANGE options.&nbsp;&nbsp; <br />
<br />
Ex:<br />
$conn=curl_init ('example.com');<br />
curl_setopt($conn, CURLOPT_LOCALPORT, 35000);<br />
curl_setopt($conn, CURLOPT_LOCALPORTRANGE, 200);<br />
<br />
CURLOPT_LOCALPORT: This sets the local port number of the socket used for the connection.<br />
<br />
CURLOPT_LOCALPORTRANGE:&nbsp; The range argument is the number of attempts libcurl will make to find a working local port number. It starts with the given CURLOPT_LOCALPORT and adds one to the number for each retry. Setting this option to 1 or below will make libcurl do only one try for the exact port number.<br />
<br />
Interface can be also configured using CURLOPT_INTERFACE:<br />
<br />
Ex:<br />
<br />
curl_setopt($conn,&nbsp; CURLOPT_INTERFACE, "eth1");</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="120793""></a>
  <div class="note">
   <strong class="user">nabikaz at gmail dot com</strong>
   <a href="#120793" class="date">12-Mar-2017 07:28</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
About this post in here:<br />
<a href="http://php.net/manual/en/function.curl-setopt.php#102121" rel="nofollow" target="_blank">http://php.net/manual/en/function.curl-setopt.php#102121</a><br />
&gt;Handling redirections with curl if safe_mode or open_basedir is enabled. <br />
&gt;...<br />
&gt;function curl_exec_follow(/*resource*/ $ch, /*int*/ &amp;$maxredirect = null) { <br />
&gt;...<br />
~~~~~~~~~~~~~<br />
IMPORTANT:<br />
This is not work if set "CURLOPT_FILE".<br />
For resolve this issue, can return $ch instead of curl_exec($ch), and after then set CURLOPT_FILE and use curl_exec($ch).</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="120765""></a>
  <div class="note">
   <strong class="user">markandrewslade at gmail dot com</strong>
   <a href="#120765" class="date">07-Mar-2017 03:22</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Contrary to the documentation, CURLOPT_STDERR should be set to a handle to the file you want to write to, not the file's location.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="120553""></a>
  <div class="note">
   <strong class="user">steve at websmithery dot co dot uk</strong>
   <a href="#120553" class="date">30-Jan-2017 09:17</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
It may not be an issue which affects anyone, but I think it's worth noting that using the CURLOPT_POSTFIELDS option has the side effect of setting the CURLOPT_POST option to TRUE.<br />
<br />
When testing some code that required the post method, I commented out my CURLOPT_POST line to see how it failed and it didn't. Further investigation using curl_getinfo revealed that setting the CURLOPT_POSTFIELDS option was also setting the POST option.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="119350""></a>
  <div class="note">
   <strong class="user">tceburashka at yandex dot ru</strong>
   <a href="#119350" class="date">19-May-2016 02:41</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Send body file use RFC7578 ("multipart/form-data")<br />
<br />
// class contain file<br />
class oFile<br />
&nbsp;{<br />
&nbsp;&nbsp; &nbsp; private $name;<br />
&nbsp;&nbsp; &nbsp; private $mime;<br />
&nbsp;&nbsp; &nbsp; private $content;<br />
<br />
&nbsp;&nbsp; &nbsp; public function __construct($name, $mime=null, $content=null)<br />
&nbsp;&nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if(is_null($content))<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $info = pathinfo($name);<br />
// check is exist and readable file<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if(!empty($info['basename']) &amp;&amp; is_readable($name))<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $this-&gt;name = $info['basename'];<br />
// get MIME<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $this-&gt;mime = mime_content_type($name);<br />
// load file<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $content = file_get_contents($name);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if($content!==false) $this-&gt;content = $content;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; else throw new Exception('Don`t get content - "'.$name.'"');<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; } else throw new Exception('Error param');<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; } else<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $this-&gt;name = $name;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if(is_null($mime)) $mime = mime_content_type($name);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $this-&gt;mime = $mime;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $this-&gt;content = $content;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; };<br />
&nbsp;&nbsp; &nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp;&nbsp; public function Name() { return $this-&gt;name; }<br />
<br />
&nbsp;&nbsp;&nbsp; public function Mime() { return $this-&gt;mime; }<br />
<br />
&nbsp;&nbsp;&nbsp; public function Content() { return $this-&gt;content; }<br />
<br />
&nbsp;};<br />
<br />
// create body for POST request<br />
class BodyPost<br />
&nbsp;{<br />
// part "multipart/form-data"<br />
&nbsp;&nbsp;&nbsp; public static function PartPost($name, $val)<br />
&nbsp;&nbsp; &nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; $body = 'Content-Disposition: form-data; name="' . $name . '"';<br />
// check instance of oFile<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; if($val instanceof oFile)<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $file = $val-&gt;Name();<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $mime = $val-&gt;Mime();<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $cont = $val-&gt;Content();<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $body .= '; filename="' . $file . '"' . "\r\n";<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $body .= 'Content-Type: ' . $mime ."\r\n\r\n";<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $body .= $cont."\r\n";<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; } else $body .= "\r\n\r\n".urlencode($val)."\r\n";<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; return $body;<br />
&nbsp;&nbsp; &nbsp; }<br />
<br />
&nbsp;&nbsp;&nbsp; public static function Get(array $post, $delimiter='-------------0123456789')<br />
&nbsp;&nbsp; &nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; if(is_array($post) &amp;&amp; !empty($post))<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $bool = false;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; foreach($post as $val) if($val instanceof oFile) {$bool = true; break; };<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if($bool)<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $ret = '';<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; foreach($post as $name=&gt;$val)<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $ret .= '--' . $delimiter. "\r\n". self::PartPost($name, $val);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $ret .= "--" . $delimiter . "--\r\n";<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; } else $ret = http_build_query($post);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; } else throw new \Exception('Error input param!');<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; return $ret;<br />
&nbsp;&nbsp; &nbsp; }<br />
&nbsp;};<br />
<br />
$delimiter = '-------------'.uniqid();<br />
$file = new oFile('sample.txt', 'text/plain', 'Content file');<br />
$post = BodyPost::Get(array('field'=&gt;'text', 'file'=&gt;$file), $delimiter);<br />
<br />
var_dump($post);<br />
<br />
$ch = curl_init();<br />
<br />
curl_setopt($ch, CURLOPT_URL, '<a href="http://server/upload/" rel="nofollow" target="_blank">http://server/upload/</a>');<br />
curl_setopt($ch, CURLOPT_POST, 1);<br />
curl_setopt($ch, CURLOPT_POSTFIELDS, $post);<br />
curl_setopt($ch, CURLOPT_HTTPHEADER, array('Content-Type: multipart/form-data; boundary=' . $delimiter,<br />
&nbsp;&nbsp;&nbsp; 'Content-Length: ' . strlen($post)));<br />
<br />
curl_exec($ch);</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="118967""></a>
  <div class="note">
   <strong class="user">joey</strong>
   <a href="#118967" class="date">09-Mar-2016 06:54</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
It is important that anyone working with cURL and PHP keep in mind that not all of the CURLOPT and CURLINFO constants are documented. I always recommend reading the cURL documentation directly as it sometimes contains better information. The cURL API in tends to be fubar as well so do not expect things to be where you would normally logically look for them.<br />
<br />
curl is especially difficult to work with when it comes to cookies. So I will talk about what I found with PHP 5.6 and curl 7.26.<br />
<br />
If you want to manage cookies in memory without using files including reading, writing and clearing custom cookies then continue reading.<br />
<br />
To start with, the way to enable in memory only cookies associated with a cURL handle you should use:<br />
<br />
&nbsp;&nbsp;&nbsp; curl_setopt($curl, CURLOPT_COOKIEFILE, "");<br />
<br />
cURL likes to use magic strings in options as special commands. Rather than having an option to enable the cookie engine in memory it uses a magic string to do that. Although vaguely the documentation here mentions this however most people like me wouldn't even read that because a COOKIEFILE is the complete opposite of what we want.<br />
<br />
To get the cookies for a curl handle you can use:<br />
<br />
&nbsp;&nbsp;&nbsp; curl_getinfo($curl, CURLINFO_COOKIELIST);<br />
<br />
This will give an array containing a string for each cookie. It is tab delimited and unfortunately you will have to parse it yourself if you want to do anything beyond copying the cookies.<br />
<br />
To clear the in memory cookies for a cURL handle you can use:<br />
<br />
&nbsp;&nbsp;&nbsp; curl_setopt($curl, CURLOPT_COOKIELIST, "ALL");<br />
<br />
This is a magic string. There are others in the cURL documentation. If a magic string isn't used, this field should take a cookie in the same string format as in getinfo for the cookielist constant. This can be used to delete individual cookies although it's not the most elegant API for doing so.<br />
<br />
For copying cookies I recommend using curl_share_init.<br />
<br />
You can also copy cookies from one handle to another like so:<br />
<br />
&nbsp;&nbsp;&nbsp; foreach(curl_getinfo($curl_a, CURLINFO_COOKIELIST) as $cookie_line)<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; curl_setopt($curl, CURLOPT_COOKIELIST, $cookie_line);<br />
<br />
An inelegant way to delete a cookie would be to skip the one you don't want. <br />
<br />
I only recommend using COOKIELIST with magic strings because the cookie format is not secure or stable. You can inject tabs into at least path and name so it becomes impossible to parse reliably. If you must parse this then to keep it secure I recommend prohibiting more than 6 tabs in the content which probably isn't a big loss to most people.<br />
<br />
A the absolute minimum for validation I would suggest:<br />
<br />
&nbsp;&nbsp;&nbsp; /^([^\t]+\t){5}[^\t]+$/D<br />
<br />
Here is the format:<br />
<br />
&nbsp;&nbsp;&nbsp; #define SEP&nbsp; "\t"&nbsp; /* Tab separates the fields */<br />
&nbsp;<br />
&nbsp;&nbsp;&nbsp; char *my_cookie =<br />
&nbsp;&nbsp; &nbsp;&nbsp; "example.com"&nbsp; &nbsp; /* Hostname */<br />
&nbsp;&nbsp; &nbsp;&nbsp; SEP "FALSE"&nbsp; &nbsp; &nbsp; /* Include subdomains */<br />
&nbsp;&nbsp; &nbsp;&nbsp; SEP "/"&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; /* Path */<br />
&nbsp;&nbsp; &nbsp;&nbsp; SEP "FALSE"&nbsp; &nbsp; &nbsp; /* Secure */<br />
&nbsp;&nbsp; &nbsp;&nbsp; SEP "0"&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; /* Expiry in epoch time format. 0 == Session */<br />
&nbsp;&nbsp; &nbsp;&nbsp; SEP "foo"&nbsp; &nbsp; &nbsp; &nbsp; /* Name */<br />
&nbsp;&nbsp; &nbsp;&nbsp; SEP "bar";&nbsp; &nbsp; &nbsp;&nbsp; /* Value */</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="118736""></a>
  <div class="note">
   <strong class="user">mikko dot rantalainen at peda dot net</strong>
   <a href="#118736" class="date">28-Jan-2016 02:20</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you need to do DELETE request, use CURLOPT_CUSTOMREQUEST with "DELETE" and use CURLOPT_POSTFIELDS for parameters. Do not put request parameters into the URL (GET-like) or bad things will happen (at least Apache+mod_php does not like such requests).</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="118586""></a>
  <div class="note">
   <strong class="user">joelhy</strong>
   <a href="#118586" class="date">04-Jan-2016 10:19</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Please notice that CURLINFO_HEADER_OUT and CURLOPT_VERBOSE option does not work together:<br />
"When CURLINFO_HEADER_OUT is set to TRUE than CURLOPT_VERBOSE does not work."(from https://bugs.php.net/bug.php?id=65348). <br />
This took me an hour or two to figure it out.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="116866""></a>
  <div class="note">
   <strong class="user">jancister at gmail dot com</strong>
   <a href="#116866" class="date">12-Mar-2015 04:09</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Please note that if you want to handle progress using CURLOPT_PROGRESSFUNCTION option, you need to take into consideration what version of PHP are you using. Since version 5.5.0, compatibility-breaking change was introduced in number/order of the arguments passed to the callback function, and cURL resource is now passed as first argument.<br />
<br />
Prior to version 5.5.0:<br />
<span class="default">&lt;?php<br />
</span><span class="comment">// ...<br />
</span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$resource</span><span class="keyword">, </span><span class="default">CURLOPT_PROGRESSFUNCTION</span><span class="keyword">, </span><span class="string">'progressCallback'</span><span class="keyword">);<br />
</span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$resource</span><span class="keyword">, </span><span class="default">CURLOPT_NOPROGRESS</span><span class="keyword">, </span><span class="default">false</span><span class="keyword">);<br />
</span><span class="comment">// ...<br />
</span><span class="keyword">function </span><span class="default">progressCallback</span><span class="keyword">(</span><span class="default">$download_size </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">, </span><span class="default">$downloaded </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">, </span><span class="default">$upload_size </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">, </span><span class="default">$uploaded </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">)<br />
{<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// Handle progress<br />
</span><span class="keyword">}<br />
</span><span class="default">?&gt;<br />
</span><br />
From version 5.5.0:<br />
<span class="default">&lt;?php<br />
</span><span class="comment">// ...<br />
</span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$resource</span><span class="keyword">, </span><span class="default">CURLOPT_PROGRESSFUNCTION</span><span class="keyword">, </span><span class="string">'progressCallback'</span><span class="keyword">);<br />
</span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$resource</span><span class="keyword">, </span><span class="default">CURLOPT_NOPROGRESS</span><span class="keyword">, </span><span class="default">false</span><span class="keyword">);<br />
</span><span class="comment">// ...<br />
</span><span class="keyword">function </span><span class="default">progressCallback</span><span class="keyword">(</span><span class="default">$resource</span><span class="keyword">, </span><span class="default">$download_size </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">, </span><span class="default">$downloaded </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">, </span><span class="default">$upload_size </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">, </span><span class="default">$uploaded </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">)<br />
{<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// Handle progress<br />
</span><span class="keyword">}<br />
</span><span class="default">?&gt;<br />
</span><br />
However, if your code needs to be compatible with PHP version both before and after 5.5.0, consider adding a version check:<br />
<span class="default">&lt;?php<br />
</span><span class="comment">// ...<br />
</span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$resource</span><span class="keyword">, </span><span class="default">CURLOPT_PROGRESSFUNCTION</span><span class="keyword">, </span><span class="string">'progressCallback'</span><span class="keyword">);<br />
</span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$resource</span><span class="keyword">, </span><span class="default">CURLOPT_NOPROGRESS</span><span class="keyword">, </span><span class="default">false</span><span class="keyword">);<br />
</span><span class="comment">// ...<br />
</span><span class="keyword">function </span><span class="default">progressCallback</span><span class="keyword">(</span><span class="default">$resource</span><span class="keyword">, </span><span class="default">$download_size </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">, </span><span class="default">$downloaded </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">, </span><span class="default">$upload_size </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">, </span><span class="default">$uploaded </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">)<br />
{<br />
&nbsp;&nbsp; </span><span class="comment">/**<br />
&nbsp;&nbsp;&nbsp; * $resource parameter was added in version 5.5.0 breaking backwards compatibility;<br />
&nbsp;&nbsp;&nbsp; * if we are using PHP version lower than 5.5.0, we need to shift the arguments<br />
&nbsp;&nbsp;&nbsp; * @see <a href="http://php.net/manual/en/function.curl-setopt.php#refsect1-function.curl-setopt-changelog" rel="nofollow" target="_blank">http://php.net/manual/en/function.curl-setopt.php#refsect1-function.curl-setopt-changelog</a><br />
&nbsp;&nbsp;&nbsp; */<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">if (</span><span class="default">version_compare</span><span class="keyword">(</span><span class="default">PHP_VERSION</span><span class="keyword">, </span><span class="string">'5.5.0'</span><span class="keyword">) &lt; </span><span class="default">0</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$uploaded </span><span class="keyword">= </span><span class="default">$upload_size</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$upload_size </span><span class="keyword">= </span><span class="default">$downloaded</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$downloaded </span><span class="keyword">= </span><span class="default">$download_size</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$download_size </span><span class="keyword">= </span><span class="default">$resource</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// Handle progress<br />
</span><span class="keyword">}<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="116223""></a>
  <div class="note">
   <strong class="user">Aaron Wells</strong>
   <a href="#116223" class="date">24-Nov-2014 11:34</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you use cURL to fetch user-supplied URLs (for instance, in a web-based RSS aggregator), be aware of the risk of server-side request forgery (SSRF). This is an attack where the user takes advantage of the fact that cURL requests are sent from the web server itself, to reach network locations they wouldn't be able to reach from outside the network.<br />
<br />
For instance, they could enter a "<a href="http://localhost" rel="nofollow" target="_blank">http://localhost</a>" URL, and access things on the web server via "localhost". Or, "<a href="ftp://localhost" rel="nofollow" target="_blank">ftp://localhost</a>". cURL supports a lot of protocols!<br />
<br />
If you are using CURLOPT_FOLLOWLOCATION, the malicious URL could be in a redirect from the original request. cURL also will follow redirect headers to other protocols! (303 See Other; Location: <a href="ftp://localhost" rel="nofollow" target="_blank">ftp://localhost</a>).<br />
<br />
So if you're using cURL with user-supplied URLs, at the very least use CURLOPT_PROTOCOLS (which also sets CURLOPT_REDIR_PROTOCOLS), and either disable CURLOPT_FOLLOWLOCATION or use the "SafeCurl" library to safely follow redirects.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="115993""></a>
  <div class="note">
   <strong class="user">Richard</strong>
   <a href="#115993" class="date">24-Oct-2014 08:10</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
CURL_SSLVERSION_TLSv1_0 (4), CURL_SSLVERSION_TLSv1_1 (5) or CURL_SSLVERSION_TLSv1_2 (6) only work for PHP versions using curl 7.34 or newer.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="115501""></a>
  <div class="note">
   <strong class="user">White Gandalf</strong>
   <a href="#115501" class="date">05-Aug-2014 04:38</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
to complement shiplu's&nbsp; comment on the neccessary option sequence of CURLOPT_POST before CURLOPT_POSTFIELDS:<br />
<br />
The crux is not some error on nginx, but that nothing at all will be send over the line by curl. Parameters set by a "CURLOPT_POSTFIELDS" option setting will be completely ignored, as long as no "CURLOPT_POST" has been encountered beforehand: Neigther the Content-Type header will be set/generated accordingly nor Content-Length nor any data will be send in the body.<br />
<br />
When using curl_setopt_array, the sequence in the array matters as well.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="114571""></a>
  <div class="note">
   <strong class="user">lachlan at radelaide dot net</strong>
   <a href="#114571" class="date">07-Mar-2014 12:29</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
For those using CURLAUTH_NTLM, it may come to no surprise&nbsp; that NTLM request will fail if you have set CURLOPT_FORBID_REUSE to true.<br />
<br />
This is because NTLM authorisation is connect-based, not request-based. If the connection is not kept alive and re-used, cURL can never complete the request.<br />
<br />
You may notice this if you get a 401 status code or max out the number of redirects.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="114497""></a>
  <div class="note">
   <strong class="user">Martin K.</strong>
   <a href="#114497" class="date">27-Feb-2014 05:31</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you need to read page contents in between file downloads, while still using the same curl handle, you'll probably need this code:<br />
<span class="default">&lt;?php<br />
&nbsp;&nbsp;&nbsp; curl_setopt</span><span class="keyword">(</span><span class="default">$handle</span><span class="keyword">, </span><span class="default">CURLOPT_FILE</span><span class="keyword">, </span><span class="default">fopen</span><span class="keyword">(</span><span class="string">'php://stdout'</span><span class="keyword">,</span><span class="string">'w'</span><span class="keyword">));&nbsp;&nbsp; </span><span class="comment">// 'php://output' didn't work for me<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$handle</span><span class="keyword">, </span><span class="default">CURLOPT_RETURNTRANSFER</span><span class="keyword">, </span><span class="default">true</span><span class="keyword">);&nbsp; </span><span class="comment">// using CURLOPT_FILE sets this to false automatically<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="114475""></a>
  <div class="note">
   <strong class="user">Martin K.</strong>
   <a href="#114475" class="date">24-Feb-2014 05:36</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you only want to enable cookie handling and you don't need to save the cookies for a separate session, just set CURLOPT_COOKIEFILE to an empty string.&nbsp; I was given the advice to use php://memory but that did not seem to have the same effect.<br />
<br />
Although this is stated in the documentation I thought it was worth reiterating since it cause me so much trouble.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="114063""></a>
  <div class="note">
   <strong class="user">Joan</strong>
   <a href="#114063" class="date">08-Jan-2014 07:59</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Using CURLOPT_NOPROXY to avoid using the proxy for some urls is very convenient.<br />
For example when the page is trying to look for itself.<br />
The parameter can be found at least in version 5.5.7, (probably earlier)<br />
Unfortunately it's not present on debian wheezy (5.4.4) but it will be on jessie (it's already there)<br />
<br />
A related bug: https://bugs.php.net/bug.php?id=53543</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="113682""></a>
  <div class="note">
   <strong class="user">badman</strong>
   <a href="#113682" class="date">15-Nov-2013 10:36</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Many hosters use PHP safe_mode or/and open_basedir, so you can't use CURLOPT_FOLLOWLOCATION. If you try, you see message like this:<br />
CURLOPT_FOLLOWLOCATION cannot be activated when safe_mode is enabled or an open_basedir is set in [you script name &amp; path] on line XXX<br />
<br />
First, I try to use zsalab function (<a href="http://us2.php.net/manual/en/function.curl-setopt.php#102121" rel="nofollow" target="_blank">http://us2.php.net/manual/en/function.curl-setopt.php#102121</a>) from this page, but for some reason it did not work properly. So, I wrote my own.<br />
<br />
It can be use instead of curl_exec. If server HTTP response codes is 30x, function will forward the request as long as the response is not different from 30x (for example, 200 Ok). Also you can use POST.<br />
<br />
function curlExec(/* Array */$curlOptions='', /* Array */$curlHeaders='', /* Array */$postFields='')<br />
{<br />
&nbsp; $newUrl = '';<br />
&nbsp; $maxRedirection = 10;<br />
&nbsp; do<br />
&nbsp; {<br />
&nbsp;&nbsp;&nbsp; if ($maxRedirection&lt;1) die('Error: reached the limit of redirections');<br />
<br />
&nbsp;&nbsp;&nbsp; $ch = curl_init();<br />
&nbsp;&nbsp;&nbsp; if (!empty($curlOptions)) curl_setopt_array($ch, $curlOptions);<br />
&nbsp;&nbsp;&nbsp; if (!empty($curlHeaders)) curl_setopt($ch, CURLOPT_HTTPHEADER, $curlHeaders);<br />
&nbsp;&nbsp;&nbsp; if (!empty($postFields))<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp;&nbsp; curl_setopt($ch, CURLOPT_POST, 1);<br />
&nbsp;&nbsp; &nbsp;&nbsp; curl_setopt($ch, CURLOPT_POSTFIELDS, $postFields);<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; if (!empty($newUrl)) curl_setopt($ch, CURLOPT_URL, $newUrl); // redirect needed<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; $curlResult = curl_exec($ch);<br />
&nbsp;&nbsp;&nbsp; $code = curl_getinfo($ch, CURLINFO_HTTP_CODE);<br />
<br />
&nbsp;&nbsp;&nbsp; if ($code == 301 || $code == 302 || $code == 303 || $code == 307)<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp;&nbsp; preg_match('/Location:(.*?)\n/', $curlResult, $matches);<br />
&nbsp;&nbsp; &nbsp;&nbsp; $newUrl = trim(array_pop($matches));<br />
&nbsp;&nbsp; &nbsp;&nbsp; curl_close($ch);<br />
<br />
&nbsp;&nbsp; &nbsp;&nbsp; $maxRedirection--;<br />
&nbsp;&nbsp; &nbsp;&nbsp; continue;<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; else // no more redirection<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp;&nbsp; $code = 0;<br />
&nbsp;&nbsp; &nbsp;&nbsp; curl_close($ch);<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp; }<br />
&nbsp; while($code);<br />
&nbsp; return $curlResult;<br />
}</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="112326""></a>
  <div class="note">
   <strong class="user">shiplu at programmer dot net</strong>
   <a href="#112326" class="date">01-Jun-2013 06:23</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
CURLOPT_POST should be set before CURLOPT_POSTFIELDS. Otherwise you might encounter 411 Length required error.<br />
<br />
Following code generates "411 Length Required" on nginx/1.1.15<br />
<span class="default">&lt;?php<br />
curl_setopt </span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_POSTFIELDS</span><span class="keyword">, </span><span class="default">$postfields</span><span class="keyword">); <br />
</span><span class="default">curl_setopt </span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_POST</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">);<br />
</span><span class="default">?&gt;<br />
</span><br />
But this one works.<br />
<br />
<span class="default">&lt;?php<br />
curl_setopt </span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_POST</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">);<br />
</span><span class="default">curl_setopt </span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_POSTFIELDS</span><span class="keyword">, </span><span class="default">$postfields</span><span class="keyword">); <br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="112113""></a>
  <div class="note">
   <strong class="user">Madcat</strong>
   <a href="#112113" class="date">06-May-2013 03:14</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you have a mixture of strings starting with @ (at character) and files in CURLOPT_POSTFIELDS you have a problem (such as posting a tweet with attached media) because curl tries to interpret anything starting with @ as a file.<br />
<br />
<span class="default">&lt;?php<br />
<br />
$postfields </span><span class="keyword">= array(<br />
&nbsp;&nbsp;&nbsp; </span><span class="string">'upload_file' </span><span class="keyword">=&gt; </span><span class="string">'@file_to_upload.png'</span><span class="keyword">,<br />
&nbsp;&nbsp;&nbsp; </span><span class="string">'upload_text' </span><span class="keyword">=&gt; </span><span class="string">'@text_to_upload'<br />
</span><span class="keyword">);<br />
<br />
</span><span class="default">$curl </span><span class="keyword">= </span><span class="default">curl_init</span><span class="keyword">();<br />
</span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$curl</span><span class="keyword">, </span><span class="default">CURLOPT_URL</span><span class="keyword">, </span><span class="string">'<a href="http://example.com/upload-test" rel="nofollow" target="_blank">http://example.com/upload-test</a>'</span><span class="keyword">);<br />
</span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$curl</span><span class="keyword">, </span><span class="default">CURLOPT_POSTFIELDS</span><span class="keyword">, </span><span class="default">$postfields</span><span class="keyword">);<br />
</span><span class="default">curl_exec</span><span class="keyword">(</span><span class="default">$curl</span><span class="keyword">);<br />
</span><span class="default">curl_close</span><span class="keyword">(</span><span class="default">$curl</span><span class="keyword">);<br />
<br />
</span><span class="default">?&gt;<br />
</span><br />
To get around this, prepend the text string with the NULL character like so:<br />
<br />
<span class="default">&lt;?php<br />
&nbsp;&nbsp;&nbsp; $postfields </span><span class="keyword">= array(<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">'upload_file' </span><span class="keyword">=&gt; </span><span class="string">'@file_to_upload.png'</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">'upload_text' </span><span class="keyword">=&gt; </span><span class="default">sprintf</span><span class="keyword">(</span><span class="string">"\0%s"</span><span class="keyword">, </span><span class="string">'@text_to_upload'</span><span class="keyword">)<br />
&nbsp;&nbsp;&nbsp; );<br />
</span><span class="default">?&gt;<br />
</span><br />
Original source: <a href="http://bit.ly/AntMle" rel="nofollow" target="_blank">http://bit.ly/AntMle</a></span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="111978""></a>
  <div class="note">
   <strong class="user">S.F.</strong>
   <a href="#111978" class="date">18-Apr-2013 06:48</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I spent a couple of days trying to upload a file using a curl post.
<br />

<br />
The problem I ran into was the filename had an '@' in the middle of it.&nbsp; It turned out that at least on my system if I encoded the file path using the quoted_printable_encode() function the upload works.
<br />

<br />
I'm posting this in the hopes that it will help someone else, and for my own future reference.
<br />

<br />
Code:
<br />
<span class="default">&lt;?php
<br />

<br />
$filepath </span><span class="keyword">= </span><span class="string">'/tmp/test@example.txt'</span><span class="keyword">;
<br />
</span><span class="default">$postdata</span><span class="keyword">[</span><span class="string">'file'</span><span class="keyword">] = </span><span class="string">'@' </span><span class="keyword">. </span><span class="default">quoted_printable_encode</span><span class="keyword">(</span><span class="default">$filepath</span><span class="keyword">);
<br />

<br />
</span><span class="comment">//... supporting code.
<br />

<br />
</span><span class="default">$result </span><span class="keyword">= </span><span class="default">curl_exec</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">);
<br />

<br />
</span><span class="default">?&gt;
<br />
</span>I'm not exactly sure why this works when escaping the '@' doesn't work but it does for me.
<br />

<br />
If anyone can offer insight into why this works or a better way to handle the '@' symbol in a filename when using curl to upload I would love to hear it.
<br />

<br />
Thanks</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="110473""></a>
  <div class="note">
   <strong class="user">m at mar dot lt</strong>
   <a href="#110473" class="date">25-Oct-2012 03:06</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Be careful when changing CURLOPT_SSL_VERIFYHOST or other options to true (boolean). It may cause insecure behavior [1]
<br />

<br />
This is because boolean true casts into integer 1, and CURLOPT_SSL_VERIFYHOST = 1 is not secure behavior.
<br />

<br />
The *correct* value here is CURLOPT_SSL_VERIFYHOST = 2. By setting this value equal to 1 the peer certificate must contain a Common Name field, but it doesn't matter what name it says.
<br />

<br />
[1] Martin Georgiev and Subodh Iyengar and Suman Jana and Rishita Anubhai and Dan Boneh and Vitaly Shmatikov, The most dangerous code in the world: validating SSL certificates in non-browser software, ACM CCS '12, pp. 38-49, 2012</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="110457""></a>
  <div class="note">
   <strong class="user">rmckay at webaware dot com dot au</strong>
   <a href="#110457" class="date">24-Oct-2012 12:21</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Please everyone, stop setting CURLOPT_SSL_VERIFYPEER to false or 0. If your PHP installation doesn't have an up-to-date CA root certificate bundle, download the one at the curl website and save it on your server:<br />
<br />
<a href="http://curl.haxx.se/docs/caextract.html" rel="nofollow" target="_blank">http://curl.haxx.se/docs/caextract.html</a><br />
<br />
Then set a path to it in your php.ini file, e.g. on Windows:<br />
<br />
curl.cainfo=c:\php\cacert.pem<br />
<br />
Turning off CURLOPT_SSL_VERIFYPEER allows man in the middle (MITM) attacks, which you don't want!</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="110442""></a>
  <div class="note">
   <strong class="user">regan dot corey at gmail dot com</strong>
   <a href="#110442" class="date">22-Oct-2012 10:22</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I spent a couple of days trying to POST a multi-dimensional array of form fields, including a file upload, to a remote server to update a product. Here are the breakthroughs that FINALLY allowed the script to run as desired.<br />
<br />
Firstly, the HTML form used input names like these:<br />
&lt;input type="text" name="product[name]" /&gt;<br />
&lt;input type="text" name="product[cost]" /&gt;<br />
&lt;input type="file" name="product[thumbnail]" /&gt;<br />
in conjunction with two other form inputs not part of the product array<br />
&lt;input type="text" name="method" value="put" /&gt;<br />
&lt;input type="text" name="mode" /&gt;<br />
<br />
I used several cURL options, but the only two (other than URL) that mattered were:<br />
curl_setopt($handle, CURLOPT_POST, true);<br />
curl_setopt($handle, CURLOPT_POSTFIELDS, $postfields);<br />
Pretty standard so far.<br />
Note: headers didn't need to be set, cURL automatically sets headers (like content-type: multipart/form-data; content-length...) when you pass an array into CURLOPT_POSTFIELDS.<br />
Note: even though this is supposed to be a PUT command through an HTTP POST form, no special PUT options needed to be passed natively through cURL. Options such as<br />
curl_setopt($handle, CURLOPT_HTTPHEADER, array('X-HTTP-Method-Override: PUT', 'Content-Length: ' . strlen($fields)));<br />
or<br />
curl_setopt($handle, CURLOPT_PUT, true);<br />
or<br />
curl_setopt($handle, CURLOPT_CUSTOMREQUEST, "PUT);<br />
were not needed to make the code work.<br />
<br />
The fields I wanted to pass through cURL were arranged into an array something like this:<br />
$postfields = array("method" =&gt; $_POST["method"],<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; "mode" =&gt; $_POST["mode"],<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; "product" =&gt; array("name" =&gt; $_POST["product"], <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; "cost" =&gt; $_POST["product"]["cost"], <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; "thumbnail" =&gt; "@{$_FILES["thumbnail"]["tmp_name"]};type={$_FILES["thumbnail"]["type"]}")<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; );<br />
<br />
-Notice how the @ precedes the temporary filename, this creates a link so PHP will upload/transfer an actual file instead of just the file name, which would happen if the @ isn't included.<br />
-Notice how I forcefully set the mime-type of the file to upload. I was having issues where images filetypes were defaulting to octet-stream instead of image/png or image/jpeg or whatever the type of the selected image.<br />
<br />
I then tried passing $postfields straight into curl_setopt($this-&gt;handle, CURLOPT_POSTFIELDS, $postfields); but it didn't work.<br />
I tried using http_build_query($postfields); but that didn't work properly either.<br />
In both cases either the file wouldn't be treated as an actual file and the form data wasn't being sent properly. The problem was HTTP's methods of transmitting arrays. While PHP and other languages can figure out how to handle arrays passed via forms, HTTP isn't quite as sofisticated. I had to rewrite the $postfields array like so:<br />
$postfields = array("method" =&gt; $_POST["method"],<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; "mode" =&gt; $_POST["mode"],<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; "product[name]" =&gt; $_POST["product"], <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; "product[cost]" =&gt; $_POST["product"]["cost"], <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; "product[thumbnail]" =&gt; "@{$_FILES["thumbnail"]["tmp_name"]}");<br />
curl_setopt($handle, CURLOPT_POSTFIELDS, $postfields);<br />
<br />
This, without the use of http_build_query, solved all of my problems. Now the receiving host outputs both $_POST and $_FILES vars correctly.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="110417""></a>
  <div class="note">
   <strong class="user">miloshio at gmail dot com</strong>
   <a href="#110417" class="date">20-Oct-2012 12:06</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Remember: <br />
<br />
- 'Server-side' cookies exists as information even before they were set on browser agent(HTTP COOKIE HEADER),<br />
- javascript cookies does NOT exists as information before they were set on browser agent,<br />
<br />
so, if you're trying to save cookies using CURLOPT_COOKIEJAR to a local file, that cookie must be server - side cookie, otherwise you are wasting time, javascript-produced cookies only exists when client browser's JS interpreter set them.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="110162""></a>
  <div class="note">
   <strong class="user">juozaspo at gmail dot com</strong>
   <a href="#110162" class="date">25-Sep-2012 08:47</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I've created an example that gets the file on url passed to script and outputs it to the browser. <br />
<br />
<span class="default">&lt;?php<br />
</span><span class="comment">//get the file (e.g. image) and output it to the browser<br />
</span><span class="default">$ch </span><span class="keyword">= </span><span class="default">curl_init</span><span class="keyword">(); </span><span class="comment">//open curl handle<br />
</span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_URL</span><span class="keyword">, </span><span class="default">$_GET</span><span class="keyword">[</span><span class="string">'url'</span><span class="keyword">]); </span><span class="comment">//set an url<br />
</span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_RETURNTRANSFER</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">); </span><span class="comment">//do not output directly, use variable<br />
</span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_BINARYTRANSFER</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">); </span><span class="comment">//do a binary transfer<br />
</span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_FAILONERROR</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">); </span><span class="comment">//stop if an error occurred<br />
</span><span class="default">$file</span><span class="keyword">=</span><span class="default">curl_exec</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">); </span><span class="comment">//store the content in variable<br />
</span><span class="keyword">if(!</span><span class="default">curl_errno</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">))<br />
{<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">//send out headers and output<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">header </span><span class="keyword">(</span><span class="string">"Content-type: "</span><span class="keyword">.</span><span class="default">curl_getinfo</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLINFO_CONTENT_TYPE</span><span class="keyword">).</span><span class="string">""</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">header </span><span class="keyword">(</span><span class="string">"Content-Length: "</span><span class="keyword">.</span><span class="default">curl_getinfo</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLINFO_CONTENT_LENGTH_DOWNLOAD</span><span class="keyword">).</span><span class="string">""</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; echo </span><span class="default">$file</span><span class="keyword">;<br />
} else echo </span><span class="string">'Curl error: ' </span><span class="keyword">. </span><span class="default">curl_error</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">);<br />
</span><span class="default">curl_close</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">); </span><span class="comment">//close curl handle<br />
</span><span class="default">?&gt;<br />
</span><br />
p.s. Make sure that there're no new lines before and after code or script may not work.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="109634""></a>
  <div class="note">
   <strong class="user">qeremy [atta] gmail [dotta] com</strong>
   <a href="#109634" class="date">03-Aug-2012 08:57</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you are trying to update something on your server and you need to handle this update operation by PUT;<br />
<br />
<span class="default">&lt;?php<br />
curl_setopt</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_CUSTOMREQUEST</span><span class="keyword">, </span><span class="string">"PUT"</span><span class="keyword">);<br />
</span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_PUT</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">);<br />
</span><span class="default">?&gt;<br />
</span><br />
are "useless" without;<br />
<br />
<span class="default">&lt;?php<br />
curl_setopt</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_HTTPHEADER</span><span class="keyword">, array(</span><span class="string">'X-HTTP-Method-Override: PUT'</span><span class="keyword">));<br />
</span><span class="default">?&gt;<br />
</span><br />
Example;<br />
<br />
Updating a book data in database identified by "id 1";<br />
<br />
--cURL Part--<br />
<span class="default">&lt;?php<br />
$data </span><span class="keyword">= </span><span class="default">http_build_query</span><span class="keyword">(</span><span class="default">$_POST</span><span class="keyword">);<br />
</span><span class="comment">// or<br />
</span><span class="default">$data </span><span class="keyword">= </span><span class="default">http_build_query</span><span class="keyword">(array(<br />
&nbsp;&nbsp; </span><span class="string">'name'&nbsp; </span><span class="keyword">=&gt; </span><span class="string">'PHP in Action'</span><span class="keyword">,<br />
&nbsp;&nbsp; </span><span class="string">'price' </span><span class="keyword">=&gt; </span><span class="default">10.9<br />
</span><span class="keyword">));<br />
<br />
</span><span class="default">$ch </span><span class="keyword">= </span><span class="default">curl_init</span><span class="keyword">();<br />
</span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_URL</span><span class="keyword">, </span><span class="string">"<a href="http://api.localhost/rest/books/1" rel="nofollow" target="_blank">http://api.localhost/rest/books/1</a>"</span><span class="keyword">);<br />
</span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_RETURNTRANSFER</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">);<br />
</span><span class="comment">// curl_setopt($ch, CURLOPT_CUSTOMREQUEST, "PUT"); // no need anymore<br />
// or<br />
// curl_setopt($ch, CURLOPT_PUT, 1); // no need anymore<br />
</span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_HTTPHEADER</span><span class="keyword">, array(</span><span class="string">'X-HTTP-Method-Override: PUT'</span><span class="keyword">));<br />
</span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_POSTFIELDS</span><span class="keyword">, </span><span class="default">$data</span><span class="keyword">);<br />
</span><span class="default">$ce </span><span class="keyword">= </span><span class="default">curl_exec</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">);<br />
</span><span class="default">curl_close</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">);<br />
</span><span class="default">print_r</span><span class="keyword">(</span><span class="default">$ce</span><span class="keyword">);<br />
</span><span class="default">?&gt;<br />
</span><br />
--API class--<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">public function </span><span class="default">putAction</span><span class="keyword">() {<br />
&nbsp;&nbsp;&nbsp; echo </span><span class="string">"putAction() -&gt; id: "</span><span class="keyword">. </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">_getParam</span><span class="keyword">(</span><span class="string">'id'</span><span class="keyword">) .</span><span class="string">"\n"</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">print_r</span><span class="keyword">(</span><span class="default">$_POST</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// do stuff with post data<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">...<br />
</span><span class="default">?&gt;<br />
</span><br />
--Output--<br />
putAction() -&gt; id: 15<br />
Array<br />
(<br />
&nbsp;&nbsp;&nbsp; [name] =&gt; PHP in Action<br />
&nbsp;&nbsp;&nbsp; [price] =&gt; 10.9<br />
)<br />
<br />
---Keywords--<br />
rest, restfull api, restfull put, curl put, curl customrequest put</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="109319""></a>
  <div class="note">
   <strong class="user">adrian at foeder dot de</strong>
   <a href="#109319" class="date">06-Jul-2012 07:37</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
if you want to do a GET request with additional body data it will become tricky not to implicitly change the request to a POST, like many notes below correctly state.<br />
So to do the analogy of command line's<br />
<br />
curl -XGET '<a href="http://example.org?foo=bar" rel="nofollow" target="_blank">http://example.org?foo=bar</a>' -d '&lt;baz&gt;some additional data&lt;/baz&gt;'<br />
<br />
in PHP you'll do, besides your other necessary stuff,<br />
<br />
<span class="default">&lt;?php<br />
&nbsp;&nbsp;&nbsp; curl_setopt</span><span class="keyword">(</span><span class="default">$curlHandle</span><span class="keyword">, </span><span class="default">CURLOPT_CUSTOMREQUEST</span><span class="keyword">, </span><span class="string">'GET'</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$curlHandle</span><span class="keyword">, </span><span class="default">CURLOPT_POSTFIELDS</span><span class="keyword">, </span><span class="string">'&lt;baz&gt;some additional data&lt;/baz&gt;'</span><span class="keyword">);<br />
</span><span class="default">?&gt;<br />
</span><br />
during my experiments, every other "similar" way, like e.g. CURLOPT_HTTPGET, didn't send the additional data or fell into POST.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="108333""></a>
  <div class="note">
   <strong class="user">Joey Hewitt</strong>
   <a href="#108333" class="date">17-Apr-2012 10:52</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Note that if you put a certificate chain in a PEM file, the certificates need to be ordered so that each certificate is followed by its issuer (i.e., root last.)<br />
<br />
Source: <a href="http://publib.boulder.ibm.com/tividd/td/ITIM/SC32-1493-00/en_US/HTML/im451_config09.htm" rel="nofollow" target="_blank">http://publib.boulder.ibm.com/tividd/td/ITIM/SC32-1493-00/en_US/HTML/im451_config09.htm</a></span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="108195""></a>
  <div class="note">
   <strong class="user">ellert at _removeme_ vankoperen dot nl</strong>
   <a href="#108195" class="date">06-Apr-2012 01:41</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you are using curl to do a soap request and consistently get the following error back: <br />
The server cannot service the request because the media type is unsupported.<br />
You are sending the Content-type of soap 1.2 to a 1.1 server.<br />
Soap 1.1 needs Content-Type: text/xml;<br />
Soap 1.2 should have Content-Type: application/soap+xml;</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="108162""></a>
  <div class="note">
   <strong class="user">anonymous</strong>
   <a href="#108162" class="date">03-Apr-2012 03:55</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
This may be not obvious, but if you specify the CURLOPT_POSTFIELDS and don't specify the CURLOPT_POST - it will still send POST, not GET (as you might think - since GET is default).<br />
So the line:<br />
<br />
curl_setopt($ch, CURLOPT_POSTFIELDS, $data);<br />
<br />
is synonym to:<br />
<br />
curl_setopt($ch, CURLOPT_POST, 1);<br />
curl_setopt($ch, CURLOPT_POSTFIELDS, $data);<br />
<br />
Even if you set the options like this (in this order):<br />
<br />
curl_setopt($ch, CURLOPT_POST, 0);<br />
curl_setopt($ch, CURLOPT_POSTFIELDS, $data);<br />
<br />
it will send POST, since CURLOPT_POSTFIELDS is latter.<br />
So if you want GET - make sure you don't have CURLOPT_POSTFIELDS specified somewhere.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="108137""></a>
  <div class="note">
   <strong class="user">mw+php dot net at lw-systems dot de</strong>
   <a href="#108137" class="date">31-Mar-2012 06:45</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
The description of the use of the CURLOPT_POSTFIELDS option should be emphasize, that using POST with HTTP/1.1 with cURL implies the use of a "Expect: 100-continue" header. Some web servers will not understand the handling of chunked transfer of post data.<br />
<br />
To disable this behavior one must disable the use of the "Expect:" header with<br />
<br />
&nbsp;&nbsp;&nbsp; curl_setopt($ch, CURLOPT_HTTPHEADER,array("Expect:"));</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="107621""></a>
  <div class="note">
   <strong class="user">dotpointer at gmail dot com</strong>
   <a href="#107621" class="date">22-Feb-2012 01:13</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I noted something when using CURLOPT_POSTFIELDS in combination with arrays from PHP.
<br />

<br />
You may supply an array, but there may not be any sub-arrays in this array, as this will give Array-to-string-conversion notice.
<br />

<br />
Example:
<br />

<br />
<span class="default">&lt;?php
<br />
$ch </span><span class="keyword">= </span><span class="default">curl_init</span><span class="keyword">();
<br />

<br />
</span><span class="comment"># this works
<br />
</span><span class="default">$data </span><span class="keyword">= array(</span><span class="string">'name' </span><span class="keyword">=&gt; </span><span class="string">'value'</span><span class="keyword">);
<br />

<br />
</span><span class="comment"># this gives "Notice: Array to string conversion..."
<br />
</span><span class="default">$data </span><span class="keyword">= array(</span><span class="string">'name' </span><span class="keyword">=&gt; array(</span><span class="string">'subname' </span><span class="keyword">=&gt; </span><span class="string">'subvalue'</span><span class="keyword">));
<br />

<br />
</span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_URL</span><span class="keyword">, </span><span class="string">'<a href="http://localhost/test.php" rel="nofollow" target="_blank">http://localhost/test.php</a>'</span><span class="keyword">);
<br />
</span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_POST</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">);
<br />
</span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_POSTFIELDS</span><span class="keyword">, </span><span class="default">$data</span><span class="keyword">);
<br />

<br />
</span><span class="default">curl_exec</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">);
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="107546""></a>
  <div class="note">
   <strong class="user">v dot tverdun at gmail dot com</strong>
   <a href="#107546" class="date">16-Feb-2012 04:00</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Make sure to set keys for array if passing to CURLOPT_POSTFIELDS.<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="comment">//This can cause errors<br />
</span><span class="default">$data </span><span class="keyword">= array(</span><span class="string">'bar'</span><span class="keyword">);<br />
<br />
</span><span class="comment">//Use this instead<br />
</span><span class="default">$data </span><span class="keyword">= array(</span><span class="string">'foo' </span><span class="keyword">=&gt; </span><span class="string">'bar'</span><span class="keyword">);<br />
<br />
</span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">CURLOPT_POSTFIELDS</span><span class="keyword">, </span><span class="default">$data</span><span class="keyword">);<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="107314""></a>
  <div class="note">
   <strong class="user">Tim Severien</strong>
   <a href="#107314" class="date">30-Jan-2012 11:51</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I've been stuck when using the CURLOPT_CONNECTTIMEOUT_MS constant. In fact, on my PHP version (5.3.1) it's not a number but rather a string. Same thing for CURLOPT_TIMEOUT_MS.<br />
<br />
I got this error: Warning: curl_setopt() expects parameter 2 to be long, string given<br />
<br />
If you are experiencing simular problems, you can replace the constant with the actual number or (re)define the constant.<br />
<br />
CURLOPT_TIMEOUT_MS should be 155<br />
CURLOPT_CONNECTTIMEOUT_MS should be 156<br />
<br />
curl_setopt($ch, CURLOPT_CONNECTTIMEOUT_MS, 2500); // error<br />
curl_setopt($ch, 156, 2500); // problem solved</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="107146""></a>
  <div class="note">
   <strong class="user">Adam Monsen</strong>
   <a href="#107146" class="date">10-Jan-2012 04:36</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
CURLOPT_POST must be left unset if you want the Content-Type header set to "multipart/form-data" (e.g., when CURLOPT_POSTFIELDS is an array). If you set CURLOPT_POSTFIELDS to an array and have CURLOPT_POST set to TRUE, Content-Length will be -1 and most sane servers will reject the request. If you set CURLOPT_POSTFIELDS to an array and have CURLOPT_POST set to FALSE, cURL will send a GET request.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="104597""></a>
  <div class="note">
   <strong class="user">Steve Kamerman</strong>
   <a href="#104597" class="date">24-Jun-2011 11:47</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you want cURL to timeout in less than one second, you can use CURLOPT_TIMEOUT_MS, although there is a bug/"feature"&nbsp; on "Unix-like systems" that causes libcurl to timeout immediately if the value is &lt; 1000 ms with the error "cURL Error (28): Timeout was reached".&nbsp; The explanation for this behavior is:<br />
<br />
"If libcurl is built to use the standard system name resolver, that portion of the transfer will still use full-second resolution for timeouts with a minimum timeout allowed of one second."<br />
<br />
What this means to PHP developers is "You can use this function without testing it first, because you can't tell if libcurl is using the standard system name resolver (but you can be pretty sure it is)"<br />
<br />
The problem is that on (Li|U)nix, when libcurl uses the standard name resolver, a SIGALRM is raised during name resolution which libcurl thinks is the timeout alarm.<br />
<br />
The solution is to disable signals using CURLOPT_NOSIGNAL.&nbsp; Here's an example script that requests itself causing a 10-second delay so you can test timeouts:<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">if (!isset(</span><span class="default">$_GET</span><span class="keyword">[</span><span class="string">'foo'</span><span class="keyword">])) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// Client<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$ch </span><span class="keyword">= </span><span class="default">curl_init</span><span class="keyword">(</span><span class="string">'<a href="http://localhost/test/test_timeout.php?foo=bar" rel="nofollow" target="_blank">http://localhost/test/test_timeout.php?foo=bar</a>'</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_RETURNTRANSFER</span><span class="keyword">, </span><span class="default">true</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_NOSIGNAL</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_TIMEOUT_MS</span><span class="keyword">, </span><span class="default">200</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$data </span><span class="keyword">= </span><span class="default">curl_exec</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$curl_errno </span><span class="keyword">= </span><span class="default">curl_errno</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$curl_error </span><span class="keyword">= </span><span class="default">curl_error</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">curl_close</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">);<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">$curl_errno </span><span class="keyword">&gt; </span><span class="default">0</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="string">"cURL Error (</span><span class="default">$curl_errno</span><span class="string">): </span><span class="default">$curl_error</span><span class="string">\n"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; } else {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="string">"Data received: </span><span class="default">$data</span><span class="string">\n"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
} else {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// Server<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">sleep</span><span class="keyword">(</span><span class="default">10</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="string">"Done."</span><span class="keyword">;<br />
}<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="103232""></a>
  <div class="note">
   <strong class="user">PHP at RHaworth dot net</strong>
   <a href="#103232" class="date">02-Apr-2011 02:31</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
When CURLOPT_FOLLOWLOCATION and CURLOPT_HEADER are both true and redirect/s have happened then the header returned by curl_exec() will contain all the headers in the redirect chain in the order they were encountered.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="102519""></a>
  <div class="note">
   <strong class="user">S\</strong>
   <a href="#102519" class="date">18-Feb-2011 11:04</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
When using CURLOPT_POSTFIELDS with an array as parameter, you have to pay high attention to user input. Unvalidated user input will lead to serious security issues.<br />
<br />
<span class="default">&lt;?php<br />
<br />
</span><span class="comment">/**<br />
&nbsp;* test.php:<br />
&nbsp;*/<br />
</span><span class="default">$ch </span><span class="keyword">= </span><span class="default">curl_init</span><span class="keyword">(</span><span class="string">'<a href="http://example.com" rel="nofollow" target="_blank">http://example.com</a>'</span><span class="keyword">);<br />
<br />
</span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_POST</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">);<br />
</span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_POSTFIELDS</span><span class="keyword">, array(<br />
&nbsp;&nbsp;&nbsp; </span><span class="string">'foo' </span><span class="keyword">=&gt; </span><span class="default">$_GET</span><span class="keyword">[</span><span class="string">'bar'</span><span class="keyword">]<br />
));<br />
<br />
</span><span class="default">curl_exec</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">);<br />
<br />
</span><span class="default">?&gt;<br />
</span><br />
Requesting "test.php?bar=@/home/user/test.png" will send "test.png" to example.com. <br />
Make sure you remove the leading "@" from user input.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="102121""></a>
  <div class="note">
   <strong class="user">zsalab</strong>
   <a href="#102121" class="date">27-Jan-2011 05:12</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Handling redirections with curl if safe_mode or open_basedir is enabled. The function working transparent, no problem with header and returntransfer options. You can handle the max redirection with the optional second argument (the function is set the variable to zero if max redirection exceeded).
<br />
Second parameter values:
<br />
- maxredirect is null or not set: redirect maximum five time, after raise PHP warning
<br />
- maxredirect is greather then zero: no raiser error, but parameter variable set to zero
<br />
- maxredirect is less or equal zero: no follow redirections
<br />

<br />
<span class="default">&lt;?php
<br />
</span><span class="keyword">function </span><span class="default">curl_exec_follow</span><span class="keyword">(</span><span class="comment">/*resource*/ </span><span class="default">$ch</span><span class="keyword">, </span><span class="comment">/*int*/ </span><span class="keyword">&amp;</span><span class="default">$maxredirect </span><span class="keyword">= </span><span class="default">null</span><span class="keyword">) {
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$mr </span><span class="keyword">= </span><span class="default">$maxredirect </span><span class="keyword">=== </span><span class="default">null </span><span class="keyword">? </span><span class="default">5 </span><span class="keyword">: </span><span class="default">intval</span><span class="keyword">(</span><span class="default">$maxredirect</span><span class="keyword">);
<br />
&nbsp;&nbsp;&nbsp; if (</span><span class="default">ini_get</span><span class="keyword">(</span><span class="string">'open_basedir'</span><span class="keyword">) == </span><span class="string">'' </span><span class="keyword">&amp;&amp; </span><span class="default">ini_get</span><span class="keyword">(</span><span class="string">'safe_mode' </span><span class="keyword">== </span><span class="string">'Off'</span><span class="keyword">)) {
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_FOLLOWLOCATION</span><span class="keyword">, </span><span class="default">$mr </span><span class="keyword">&gt; </span><span class="default">0</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_MAXREDIRS</span><span class="keyword">, </span><span class="default">$mr</span><span class="keyword">);
<br />
&nbsp;&nbsp;&nbsp; } else {
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_FOLLOWLOCATION</span><span class="keyword">, </span><span class="default">false</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">$mr </span><span class="keyword">&gt; </span><span class="default">0</span><span class="keyword">) {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$newurl </span><span class="keyword">= </span><span class="default">curl_getinfo</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLINFO_EFFECTIVE_URL</span><span class="keyword">);
<br />

<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$rch </span><span class="keyword">= </span><span class="default">curl_copy_handle</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$rch</span><span class="keyword">, </span><span class="default">CURLOPT_HEADER</span><span class="keyword">, </span><span class="default">true</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$rch</span><span class="keyword">, </span><span class="default">CURLOPT_NOBODY</span><span class="keyword">, </span><span class="default">true</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$rch</span><span class="keyword">, </span><span class="default">CURLOPT_FORBID_REUSE</span><span class="keyword">, </span><span class="default">false</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$rch</span><span class="keyword">, </span><span class="default">CURLOPT_RETURNTRANSFER</span><span class="keyword">, </span><span class="default">true</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; do {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$rch</span><span class="keyword">, </span><span class="default">CURLOPT_URL</span><span class="keyword">, </span><span class="default">$newurl</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$header </span><span class="keyword">= </span><span class="default">curl_exec</span><span class="keyword">(</span><span class="default">$rch</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">curl_errno</span><span class="keyword">(</span><span class="default">$rch</span><span class="keyword">)) {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$code </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; } else {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$code </span><span class="keyword">= </span><span class="default">curl_getinfo</span><span class="keyword">(</span><span class="default">$rch</span><span class="keyword">, </span><span class="default">CURLINFO_HTTP_CODE</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">$code </span><span class="keyword">== </span><span class="default">301 </span><span class="keyword">|| </span><span class="default">$code </span><span class="keyword">== </span><span class="default">302</span><span class="keyword">) {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">preg_match</span><span class="keyword">(</span><span class="string">'/Location:(.*?)\n/'</span><span class="keyword">, </span><span class="default">$header</span><span class="keyword">, </span><span class="default">$matches</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$newurl </span><span class="keyword">= </span><span class="default">trim</span><span class="keyword">(</span><span class="default">array_pop</span><span class="keyword">(</span><span class="default">$matches</span><span class="keyword">));
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; } else {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$code </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; } while (</span><span class="default">$code </span><span class="keyword">&amp;&amp; --</span><span class="default">$mr</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">curl_close</span><span class="keyword">(</span><span class="default">$rch</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (!</span><span class="default">$mr</span><span class="keyword">) {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">$maxredirect </span><span class="keyword">=== </span><span class="default">null</span><span class="keyword">) {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">trigger_error</span><span class="keyword">(</span><span class="string">'Too many redirects. When following redirects, libcurl hit the maximum amount.'</span><span class="keyword">, </span><span class="default">E_USER_WARNING</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; } else {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$maxredirect </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">false</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_URL</span><span class="keyword">, </span><span class="default">$newurl</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }
<br />
&nbsp;&nbsp;&nbsp; }
<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">curl_exec</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">);
<br />
}
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="102090""></a>
  <div class="note">
   <strong class="user">gskluzacek at gmail dot com</strong>
   <a href="#102090" class="date">26-Jan-2011 01:42</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
FYI... unless you specifically set the user agent, no user agent will be sent in your request as there is no default value like some of the other options.<br />
<br />
As others have said, not sending a user agent may cause you to not&nbsp; get the results that you expected, e.g., 0 byte length content, different content, etc.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="101231""></a>
  <div class="note">
   <strong class="user">john dot david dot steele at gmail dot com</strong>
   <a href="#101231" class="date">03-Dec-2010 01:03</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
A note on the way Curl posts files...<br />
<br />
<span class="default">&lt;?php<br />
&nbsp; curl_setopt</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_POSTFIELDS</span><span class="keyword">, array(</span><span class="string">'file' </span><span class="keyword">=&gt; </span><span class="string">'@/path/to/file.ext'</span><span class="keyword">);<br />
</span><span class="default">?&gt;<br />
</span><br />
will post the FULL PATH of the file in the filename field:<br />
<br />
Content-Disposition: form-data; name="file"; filename="/path/to/file.ext"<br />
<br />
Whereas typical browser behavior only sends the filename:<br />
<br />
Content-Disposition: form-data; name="file"; filename="file.ext"<br />
<br />
Workaround: <br />
<span class="default">&lt;?php<br />
&nbsp; curl_setopt</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_POSTFIELDS</span><span class="keyword">, array(</span><span class="string">'file' </span><span class="keyword">=&gt; </span><span class="string">'@file.ext'</span><span class="keyword">);<br />
&nbsp; </span><span class="default">$cwd </span><span class="keyword">= </span><span class="default">getcwd</span><span class="keyword">();<br />
&nbsp; </span><span class="default">chdir</span><span class="keyword">(</span><span class="string">'/path/to/'</span><span class="keyword">);<br />
&nbsp; </span><span class="default">$receivedData </span><span class="keyword">= </span><span class="default">curl_exec</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">);<br />
&nbsp; </span><span class="default">chdir</span><span class="keyword">(</span><span class="default">$cwd</span><span class="keyword">);<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="101139""></a>
  <div class="note">
   <strong class="user">scy-phpmanual at scytale dot name</strong>
   <a href="#101139" class="date">29-Nov-2010 04:01</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
In order to reset CURLOPT_HTTPHEADER, set it to array(). The cURL C API says you should set it to NULL, but that doesn't work in the PHP wrapper.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="100716""></a>
  <div class="note">
   <strong class="user">prohfesor at gmail dot com</strong>
   <a href="#100716" class="date">02-Nov-2010 01:30</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
This function helps to parse netscape cookie file, generated by cURL into cookie array:
<br />

<br />
<span class="default">&lt;?php
<br />
&nbsp; </span><span class="keyword">function </span><span class="default">_curl_parse_cookiefile</span><span class="keyword">(</span><span class="default">$file</span><span class="keyword">) {
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$aCookies </span><span class="keyword">= array();
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$aLines </span><span class="keyword">= </span><span class="default">file</span><span class="keyword">(</span><span class="default">$file</span><span class="keyword">);
<br />
&nbsp;&nbsp;&nbsp; foreach(</span><span class="default">$aLines </span><span class="keyword">as </span><span class="default">$line</span><span class="keyword">){
<br />
&nbsp;&nbsp; &nbsp;&nbsp; if(</span><span class="string">'#'</span><span class="keyword">==</span><span class="default">$line</span><span class="keyword">{</span><span class="default">0</span><span class="keyword">})
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; continue;
<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">$arr </span><span class="keyword">= </span><span class="default">explode</span><span class="keyword">(</span><span class="string">"\t"</span><span class="keyword">, </span><span class="default">$line</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp;&nbsp; if(isset(</span><span class="default">$arr</span><span class="keyword">[</span><span class="default">5</span><span class="keyword">]) &amp;&amp; isset(</span><span class="default">$arr</span><span class="keyword">[</span><span class="default">6</span><span class="keyword">]))
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$aCookies</span><span class="keyword">[</span><span class="default">$arr</span><span class="keyword">[</span><span class="default">5</span><span class="keyword">]] = </span><span class="default">$arr</span><span class="keyword">[</span><span class="default">6</span><span class="keyword">];
<br />
&nbsp;&nbsp;&nbsp; }
<br />
&nbsp;&nbsp;&nbsp; 
<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">$aCookies</span><span class="keyword">; 
<br />
&nbsp; }
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="100083""></a>
  <div class="note">
   <strong class="user">kavih7 at yahoo dot com</strong>
   <a href="#100083" class="date">23-Sep-2010 08:59</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
When POSTing with cURL, my POSTs were magically being converted to GETs and I debugged it until finding the issue. I was setting the CURLOPT_MUTE option. Not sure why this conflicts, since the documentation doesn't specify as such. Anyways, if your $_POST is empty, make sure you aren't setting CURLOPT_MUTE.<br />
<br />
Cheers!</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="99108""></a>
  <div class="note">
   <strong class="user">sam at def dot reyssi dot net</strong>
   <a href="#99108" class="date">28-Jul-2010 03:43</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Be careful when setting the CURLOPT_POSTFIELDS setting using an array. The array used to set the POST fields must only contain scalar values. Multidimentional arrays or objects lacking a __toString implementation will cause Curl to error.
<br />

<br />
If there is a need to send non-scalar values using a POST request, consider serializing them before transmission.
<br />

<br />
<span class="default">&lt;?php
<br />
$ch </span><span class="keyword">= </span><span class="default">curl_init</span><span class="keyword">(</span><span class="string">'<a href="http://host.example.com" rel="nofollow" target="_blank">http://host.example.com</a>'</span><span class="keyword">);
<br />

<br />
</span><span class="comment">// Data to post
<br />
</span><span class="default">$multiDimensional </span><span class="keyword">= array(
<br />
&nbsp;&nbsp; </span><span class="string">'name' </span><span class="keyword">= </span><span class="string">'foo'</span><span class="keyword">,
<br />
&nbsp;&nbsp; </span><span class="string">'data' </span><span class="keyword">= array(</span><span class="default">1</span><span class="keyword">,</span><span class="default">2</span><span class="keyword">,</span><span class="default">3</span><span class="keyword">,</span><span class="default">4</span><span class="keyword">),
<br />
&nbsp;&nbsp; </span><span class="string">'value' </span><span class="keyword">= </span><span class="string">'bar'
<br />
</span><span class="keyword">);
<br />

<br />
</span><span class="comment">// Will error
<br />
</span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_POSTFIELDS</span><span class="keyword">, </span><span class="default">$multiDimensional</span><span class="keyword">);
<br />

<br />
</span><span class="comment">// Data to post
<br />
</span><span class="default">$postData </span><span class="keyword">= array(
<br />
&nbsp; </span><span class="string">'name' </span><span class="keyword">= </span><span class="string">'foo'</span><span class="keyword">,
<br />
&nbsp; </span><span class="string">'data' </span><span class="keyword">= </span><span class="default">serialize</span><span class="keyword">(array(</span><span class="default">1</span><span class="keyword">,</span><span class="default">2</span><span class="keyword">,</span><span class="default">3</span><span class="keyword">,</span><span class="default">4</span><span class="keyword">)),
<br />
&nbsp; </span><span class="string">'value' </span><span class="keyword">= </span><span class="string">'bar'
<br />
</span><span class="keyword">);
<br />

<br />
</span><span class="comment">// Will not error
<br />
</span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_POSTFIELDS</span><span class="keyword">, </span><span class="default">$postData</span><span class="keyword">);
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="99082""></a>
  <div class="note">
   <strong class="user">joeterranova at gmail dot com</strong>
   <a href="#99082" class="date">26-Jul-2010 12:57</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
It appears that setting CURLOPT_FILE before setting CURLOPT_RETURNTRANSFER doesn't work, presumably because CURLOPT_FILE depends on CURLOPT_RETURNTRANSFER being set.
<br />

<br />
So do this:
<br />

<br />
<span class="default">&lt;?php
<br />
curl_setopt</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_RETURNTRANSFER</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">);
<br />
</span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_FILE</span><span class="keyword">, </span><span class="default">$fp</span><span class="keyword">);
<br />
</span><span class="default">?&gt;
<br />
</span>
<br />
not this:
<br />

<br />
<span class="default">&lt;?php
<br />
curl_setopt</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_FILE</span><span class="keyword">, </span><span class="default">$fp</span><span class="keyword">);
<br />
</span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_RETURNTRANSFER</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">);
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="98491""></a>
  <div class="note">
   <strong class="user">JScott jscott401 at gmail dot com</strong>
   <a href="#98491" class="date">18-Jun-2010 07:29</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Some additional notes for curlopt_writefunction. I struggled with this at first because it really isn't documented very well.<br />
<br />
When you write a callback function and use it with curlopt_writefunction it will be called MULTIPLE times. Your function MUST return the ammount of data written to it each time. It is very picky about this. Here is a snippet from my code that may help you<br />
<br />
<span class="default">&lt;?php<br />
curl_setopt</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">curl_handle</span><span class="keyword">, </span><span class="default">CURLOPT_WRITEFUNCTION</span><span class="keyword">, array(</span><span class="default">$this</span><span class="keyword">, </span><span class="string">"receiveResponse"</span><span class="keyword">));<br />
<br />
</span><span class="comment">// later on in the class I wrote my receive Response method<br />
<br />
</span><span class="keyword">private function </span><span class="default">receiveResponse</span><span class="keyword">(</span><span class="default">$curlHandle</span><span class="keyword">,</span><span class="default">$xmldata</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">responseString </span><span class="keyword">= </span><span class="default">$xmldata</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">responseXML </span><span class="keyword">.=&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">responseString</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">length </span><span class="keyword">= </span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$xmldata</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">size </span><span class="keyword">+= </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">length</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">length</span><span class="keyword">;<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
</span><span class="default">?&gt;<br />
</span><br />
Now I did this for a class. If you aren't doing OOP then you will obviously need to modify this for your own use.<br />
<br />
CURL calls your script MULTIPLE times because the data will not always be sent all at once. Were talking internet here so its broken up into packets. You need to take your data and concatenate it all together until it is all written. I was about to pull my damn hair out because I would get broken chunks of XML back from the server and at random lengths. I finally figured out what was going on. Hope this helps</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="97591""></a>
  <div class="note">
   <strong class="user">obones_remove_me at free dot fr</strong>
   <a href="#97591" class="date">27-Apr-2010 03:27</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
For those of you wondering how to specify the content-type for a file uploaded via curl, the syntax is as follows:<br />
<br />
<span class="default">&lt;?php<br />
<br />
$data </span><span class="keyword">= array(</span><span class="string">'file' </span><span class="keyword">=&gt; </span><span class="string">'@/home/user/test.png;type=image/png'</span><span class="keyword">);<br />
<br />
</span><span class="default">?&gt;<br />
</span><br />
Simply adding a semicolon with the type= at the end.<br />
Note that this has been reported not to work in all versions of PHP and I have done the following tests:<br />
<br />
5.2.6 (libcurl 7.18.2) : Does not work<br />
5.2.13 (libcurl 7.20.0) : Works just fine<br />
<br />
So it might be worth updating your installation of PHP and/or libcurl if you want to be able to use this syntax</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="97383""></a>
  <div class="note">
   <strong class="user">clint at fewbar dot com</strong>
   <a href="#97383" class="date">16-Apr-2010 02:56</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you have turned on conditional gets on a curl handle, and then for a subsequent request, you don't have a good setting for CURLOPT_TIMEVALUE , you can disable If-Modified-Since checking with:<br />
<br />
<span class="default">&lt;?php<br />
<br />
$ch </span><span class="keyword">= </span><span class="default">curl_init</span><span class="keyword">();<br />
</span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_URL</span><span class="keyword">, </span><span class="default">$foo</span><span class="keyword">);<br />
</span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_TIMEVALUE</span><span class="keyword">, </span><span class="default">filemtime</span><span class="keyword">(</span><span class="default">$foo_path</span><span class="keyword">));<br />
</span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_TIMECONDITION</span><span class="keyword">, </span><span class="default">CURLOPT_TIMECOND_IFMODIFIEDSINCE</span><span class="keyword">);<br />
</span><span class="default">curl_exec</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">);<br />
</span><span class="comment">// Reuse same curl handle<br />
</span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_URL</span><span class="keyword">, </span><span class="default">$bar</span><span class="keyword">);<br />
</span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_TIMEVALUE</span><span class="keyword">, </span><span class="default">null</span><span class="keyword">); </span><span class="comment">// don't know mtime<br />
</span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_TIMECONDITION</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">); </span><span class="comment">// set it to 0, turns it off<br />
</span><span class="default">curl_exec</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">);<br />
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="97206""></a>
  <div class="note">
   <strong class="user">julien veneziano</strong>
   <a href="#97206" class="date">08-Apr-2010 03:56</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you need to send deta in a DELETE request, use:<br />
<br />
<span class="default">&lt;?php<br />
$request_body </span><span class="keyword">= </span><span class="string">'some data'</span><span class="keyword">;<br />
</span><span class="default">$ch </span><span class="keyword">= </span><span class="default">curl_init</span><span class="keyword">(</span><span class="string">'<a href="http://www.example.com" rel="nofollow" target="_blank">http://www.example.com</a>'</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_POSTFIELDS</span><span class="keyword">, </span><span class="default">$request_body</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_FOLLOWLOCATION</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_HEADER</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">); <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_RETURNTRANSFER</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_CUSTOMREQUEST</span><span class="keyword">, </span><span class="string">"DELETE"</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$response </span><span class="keyword">= </span><span class="default">curl_exec</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">);<br />
</span><span class="default">var_dump</span><span class="keyword">(</span><span class="default">$response</span><span class="keyword">);<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="96903""></a>
  <div class="note">
   <strong class="user">anderseta at gmail dot com</strong>
   <a href="#96903" class="date">22-Mar-2010 02:48</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you wish to find the size of the file you are streaming and use it as your header this is how:
<br />

<br />
<span class="default">&lt;?php
<br />

<br />
</span><span class="keyword">function </span><span class="default">write_function</span><span class="keyword">(</span><span class="default">$curl_resource</span><span class="keyword">, </span><span class="default">$string</span><span class="keyword">)
<br />
{
<br />
&nbsp;&nbsp;&nbsp; if(</span><span class="default">curl_getinfo</span><span class="keyword">(</span><span class="default">$curl_resource</span><span class="keyword">, </span><span class="default">CURLINFO_SIZE_DOWNLOAD</span><span class="keyword">) &lt;= </span><span class="default">2000</span><span class="keyword">)
<br />
&nbsp;&nbsp;&nbsp; {
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">header</span><span class="keyword">(</span><span class="string">'Expires: 0'</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">header</span><span class="keyword">(</span><span class="string">'Cache-Control: must-revalidate, post-check=0, pre-check=0'</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">header</span><span class="keyword">(</span><span class="string">'Pragma: public'</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">header</span><span class="keyword">(</span><span class="string">'Content-Description: File Transfer'</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">header</span><span class="keyword">(</span><span class="string">"Content-Transfer-Encoding: binary"</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">header</span><span class="keyword">(</span><span class="string">"Content-Type: "</span><span class="keyword">.</span><span class="default">curl_getinfo</span><span class="keyword">(</span><span class="default">$curl_resource</span><span class="keyword">, </span><span class="default">CURLINFO_CONTENT_TYPE</span><span class="keyword">).</span><span class="string">""</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">header</span><span class="keyword">(</span><span class="string">"Content-Length: "</span><span class="keyword">.</span><span class="default">curl_getinfo</span><span class="keyword">(</span><span class="default">$curl_resource</span><span class="keyword">, </span><span class="default">CURLINFO_CONTENT_LENGTH_DOWNLOAD</span><span class="keyword">).</span><span class="string">""</span><span class="keyword">);
<br />
&nbsp;&nbsp;&nbsp; }
<br />
&nbsp;&nbsp;&nbsp; 
<br />
&nbsp;&nbsp;&nbsp; print </span><span class="default">$string</span><span class="keyword">;
<br />

<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">mb_strlen</span><span class="keyword">(</span><span class="default">$string</span><span class="keyword">, </span><span class="string">'8bit'</span><span class="keyword">);
<br />
}
<br />

<br />
</span><span class="default">?&gt;
<br />
</span>
<br />
1440 is the the default number of bytes curl will call the write function (BUFFERSIZE does not affect this, i actually think you can not change this value), so it means the headers are going to be set only one time.
<br />

<br />
write_function must return the exact number of bytes of the string, so you can return a value with mb_strlen.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="96313""></a>
  <div class="note">
   <strong class="user">starosielec at googlemail dot com</strong>
   <a href="#96313" class="date">19-Feb-2010 03:07</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
You can use also use object methods as callback functions. This is usefull if your curl ressource is part of an object handling transfers.
<br />
Instead of curl_setopt($curl, CURLOPT_WRITEFUNCTION, "curl_handler_recv") you can use array($object, "method") as value for callback options.
<br />

<br />
For example:
<br />

<br />
<span class="default">&lt;?php
<br />
</span><span class="keyword">class </span><span class="default">downloader </span><span class="keyword">{
<br />
&nbsp;&nbsp;&nbsp; private </span><span class="default">$curl</span><span class="keyword">;
<br />

<br />
&nbsp;&nbsp;&nbsp; function </span><span class="default">__construct</span><span class="keyword">() {
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">curl </span><span class="keyword">= </span><span class="default">curl_init</span><span class="keyword">();
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">curl</span><span class="keyword">, </span><span class="default">CURLOPT_WRITEFUNCTION</span><span class="keyword">, array(</span><span class="default">$this</span><span class="keyword">, </span><span class="string">"curl_handler_recv"</span><span class="keyword">));
<br />
&nbsp;&nbsp;&nbsp; }
<br />

<br />
&nbsp;&nbsp; &nbsp; function </span><span class="default">curl_handler_recv</span><span class="keyword">(</span><span class="default">$res</span><span class="keyword">, </span><span class="default">$data</span><span class="keyword">) {
<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="comment">//...
<br />
&nbsp;&nbsp; &nbsp; </span><span class="keyword">}
<br />
&nbsp;&nbsp; </span><span class="comment">//... 
<br />
</span><span class="keyword">}
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="96056""></a>
  <div class="note">
   <strong class="user">Ed Cradock</strong>
   <a href="#96056" class="date">05-Feb-2010 10:47</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
PUT requests are very simple, just make sure to specify a content-length header and set post fields as a string.
<br />

<br />
Example:
<br />

<br />
<span class="default">&lt;?php
<br />
</span><span class="keyword">function </span><span class="default">doPut</span><span class="keyword">(</span><span class="default">$url</span><span class="keyword">, </span><span class="default">$fields</span><span class="keyword">)
<br />
{
<br />
&nbsp;&nbsp; </span><span class="default">$fields </span><span class="keyword">= (</span><span class="default">is_array</span><span class="keyword">(</span><span class="default">$fields</span><span class="keyword">)) ? </span><span class="default">http_build_query</span><span class="keyword">(</span><span class="default">$fields</span><span class="keyword">) : </span><span class="default">$fields</span><span class="keyword">;
<br />

<br />
&nbsp;&nbsp; if(</span><span class="default">$ch </span><span class="keyword">= </span><span class="default">curl_init</span><span class="keyword">(</span><span class="default">$url</span><span class="keyword">))
<br />
&nbsp;&nbsp; {
<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_CUSTOMREQUEST</span><span class="keyword">, </span><span class="string">'PUT'</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_RETURNTRANSFER</span><span class="keyword">, </span><span class="default">true</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_HTTPHEADER</span><span class="keyword">, array(</span><span class="string">'Content-Length: ' </span><span class="keyword">. </span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$fields</span><span class="keyword">)));
<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_POSTFIELDS</span><span class="keyword">, </span><span class="default">$fields</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">curl_exec</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">);
<br />

<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">$status </span><span class="keyword">= </span><span class="default">curl_getinfo</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLINFO_HTTP_CODE</span><span class="keyword">);
<br />

<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">curl_close</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">);
<br />

<br />
&nbsp;&nbsp; &nbsp;&nbsp; return (int) </span><span class="default">$status</span><span class="keyword">;
<br />
&nbsp;&nbsp; }
<br />
&nbsp;&nbsp; else
<br />
&nbsp;&nbsp; {
<br />
&nbsp;&nbsp; &nbsp;&nbsp; return </span><span class="default">false</span><span class="keyword">;
<br />
&nbsp;&nbsp; }
<br />
}
<br />

<br />
if(</span><span class="default">doPut</span><span class="keyword">(</span><span class="string">'<a href="http://example.com/api/a/b/c" rel="nofollow" target="_blank">http://example.com/api/a/b/c</a>'</span><span class="keyword">, array(</span><span class="string">'foo' </span><span class="keyword">=&gt; </span><span class="string">'bar'</span><span class="keyword">)) == </span><span class="default">200</span><span class="keyword">)
<br />
&nbsp;&nbsp; </span><span class="comment">// do something
<br />
</span><span class="keyword">else
<br />
&nbsp;&nbsp; </span><span class="comment">// do something else.
<br />
</span><span class="default">?&gt;
<br />
</span>
<br />
You can grab the request data on the other side with:
<br />

<br />
<span class="default">&lt;?php
<br />
</span><span class="keyword">if(</span><span class="default">$_SERVER</span><span class="keyword">[</span><span class="string">'REQUEST_METHOD'</span><span class="keyword">] == </span><span class="string">'PUT'</span><span class="keyword">)
<br />
{
<br />
&nbsp;&nbsp; </span><span class="default">parse_str</span><span class="keyword">(</span><span class="default">file_get_contents</span><span class="keyword">(</span><span class="string">'php://input'</span><span class="keyword">), </span><span class="default">$requestData</span><span class="keyword">);
<br />

<br />
&nbsp;&nbsp; </span><span class="comment">// Array ( [foo] =&gt; bar )
<br />
&nbsp;&nbsp; </span><span class="default">print_r</span><span class="keyword">(</span><span class="default">$requestData</span><span class="keyword">);
<br />

<br />
&nbsp;&nbsp; </span><span class="comment">// Do something with data...
<br />
</span><span class="keyword">}
<br />
</span><span class="default">?&gt;
<br />
</span>
<br />
DELETE&nbsp; can be done in exactly the same way.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="95027""></a>
  <div class="note">
   <strong class="user">Pawel Antczak</strong>
   <a href="#95027" class="date">09-Dec-2009 12:07</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Hello. <br />
During problems with "CURLOPT_FOLLOWLOCATION cannot be activated when in safe_mode or an open_basedir is set" <br />
I was looking for solution. <br />
I've found few methods on this page, but none of them was good enough, so I made one.<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">function </span><span class="default">curl_redirect_exec</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, &amp;</span><span class="default">$redirects</span><span class="keyword">, </span><span class="default">$curlopt_header </span><span class="keyword">= </span><span class="default">false</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_HEADER</span><span class="keyword">, </span><span class="default">true</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_RETURNTRANSFER</span><span class="keyword">, </span><span class="default">true</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$data </span><span class="keyword">= </span><span class="default">curl_exec</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$http_code </span><span class="keyword">= </span><span class="default">curl_getinfo</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLINFO_HTTP_CODE</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; if (</span><span class="default">$http_code </span><span class="keyword">== </span><span class="default">301 </span><span class="keyword">|| </span><span class="default">$http_code </span><span class="keyword">== </span><span class="default">302</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; list(</span><span class="default">$header</span><span class="keyword">) = </span><span class="default">explode</span><span class="keyword">(</span><span class="string">"\r\n\r\n"</span><span class="keyword">, </span><span class="default">$data</span><span class="keyword">, </span><span class="default">2</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$matches </span><span class="keyword">= array();<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">preg_match</span><span class="keyword">(</span><span class="string">'/(Location:|URI:)(.*?)\n/'</span><span class="keyword">, </span><span class="default">$header</span><span class="keyword">, </span><span class="default">$matches</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$url </span><span class="keyword">= </span><span class="default">trim</span><span class="keyword">(</span><span class="default">array_pop</span><span class="keyword">(</span><span class="default">$matches</span><span class="keyword">));<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$url_parsed </span><span class="keyword">= </span><span class="default">parse_url</span><span class="keyword">(</span><span class="default">$url</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (isset(</span><span class="default">$url_parsed</span><span class="keyword">)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_URL</span><span class="keyword">, </span><span class="default">$url</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$redirects</span><span class="keyword">++;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">curl_redirect_exec</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">$redirects</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; if (</span><span class="default">$curlopt_header</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">$data</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; else {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; list(,</span><span class="default">$body</span><span class="keyword">) = </span><span class="default">explode</span><span class="keyword">(</span><span class="string">"\r\n\r\n"</span><span class="keyword">, </span><span class="default">$data</span><span class="keyword">, </span><span class="default">2</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">$body</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
}<br />
</span><span class="default">?&gt;<br />
</span><br />
Main issue in existing functions was lack of information, how many redirects was done. <br />
This one will count it. <br />
First parameter as usual. <br />
Second should be already initialized integer, it will be incremented by number of done redirects. <br />
You can set CURLOPT_HEADER if You need it.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="93686""></a>
  <div class="note">
   <strong class="user">Chris at PureFormSolutions dot com</strong>
   <a href="#93686" class="date">22-Sep-2009 03:54</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I've found that setting CURLOPT_HTTPHEADER more than once will clear out any headers you've set previously with CURLOPT_HTTPHEADER.<br />
<br />
Consider the following:<br />
<span class="default">&lt;?php<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment"># ...<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$cURL</span><span class="keyword">,</span><span class="default">CURLOPT_HTTPHEADER</span><span class="keyword">,array (<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">"Content-Type: text/xml; CHARSET=gb2312"</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">"Expect: 100-continue"<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">));<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment"># ... do some other stuff ...<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$cURL</span><span class="keyword">,</span><span class="default">CURLOPT_HTTPHEADER</span><span class="keyword">,array (<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">"Accept: application/json"<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">));<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment"># ...<br />
</span><span class="default">?&gt;<br />
</span><br />
Both the Content-Type and Expect I set will not be in the outgoing headers, but Accept will.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="93351""></a>
  <div class="note">
   <strong class="user">Tyranoweb</strong>
   <a href="#93351" class="date">04-Sep-2009 02:42</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
There is a function to send POST data in page with five parameters :
<br />

<br />
$post must be an array
<br />
$page is the page where POST datas will be send.
<br />
$n must be true to continue if they are php redirection (Location: )
<br />
$session must be define true if you want to use cookies 
<br />
$referer must be a link to get a wrong referer or only to have a referer.
<br />

<br />
<span class="default">&lt;?php
<br />
</span><span class="keyword">function </span><span class="default">curl_data_post</span><span class="keyword">(</span><span class="default">$post</span><span class="keyword">, </span><span class="default">$page</span><span class="keyword">, </span><span class="default">$n</span><span class="keyword">, </span><span class="default">$session</span><span class="keyword">, </span><span class="default">$referer</span><span class="keyword">)
<br />
&nbsp;&nbsp;&nbsp; {
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if(!</span><span class="default">is_array</span><span class="keyword">(</span><span class="default">$post</span><span class="keyword">))
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; return </span><span class="default">false</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; 
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$DATA_POST </span><span class="keyword">= </span><span class="default">curl_init</span><span class="keyword">();
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$DATA_POST</span><span class="keyword">, </span><span class="default">CURLOPT_RETURNTRANSFER</span><span class="keyword">, </span><span class="default">true</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$DATA_POST</span><span class="keyword">, </span><span class="default">CURLOPT_URL</span><span class="keyword">, </span><span class="default">$page</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$DATA_POST</span><span class="keyword">, </span><span class="default">CURLOPT_POST</span><span class="keyword">, </span><span class="default">true</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">$n</span><span class="keyword">)
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$DATA_POST</span><span class="keyword">, </span><span class="default">CURLOPT_FOLLOWLOCATION</span><span class="keyword">, </span><span class="default">true</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">$session</span><span class="keyword">)
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$DATA_POST</span><span class="keyword">, </span><span class="default">CURLOPT_COOKIEFILE</span><span class="keyword">, </span><span class="string">'cookiefile.txt'</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$DATA_POST</span><span class="keyword">, </span><span class="default">CURLOPT_COOKIEJAR</span><span class="keyword">, </span><span class="string">'cookiefile.txt'</span><span class="keyword">); 
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; 
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">$referer</span><span class="keyword">)
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$DATA_POST</span><span class="keyword">, </span><span class="default">CURLOPT_REFERER</span><span class="keyword">, </span><span class="default">$referer</span><span class="keyword">); 
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; 
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$DATA_POST</span><span class="keyword">, </span><span class="default">CURLOPT_POSTFIELDS</span><span class="keyword">, </span><span class="default">$post</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$data </span><span class="keyword">= </span><span class="default">curl_exec</span><span class="keyword">(</span><span class="default">$DATA_POST</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">$data </span><span class="keyword">== </span><span class="default">false</span><span class="keyword">)
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; echo</span><span class="string">'Warning : ' </span><span class="keyword">. </span><span class="default">curl_error</span><span class="keyword">(</span><span class="default">$DATA_POST</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">curl_close</span><span class="keyword">(</span><span class="default">$DATA_POST</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; return </span><span class="default">false</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; else
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">curl_close</span><span class="keyword">(</span><span class="default">$DATA_POST</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; return </span><span class="default">$data</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }
<br />
&nbsp;&nbsp;&nbsp; }
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="93108""></a>
  <div class="note">
   <strong class="user">rob</strong>
   <a href="#93108" class="date">23-Aug-2009 09:07</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Whats not mentioned in the documentation is that you have to set CURLOPT_COOKIEJAR to a file for the CURL handle to actually use cookies, if it is not set then cookies will not be parsed.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="92522""></a>
  <div class="note">
   <strong class="user">Sylvain R</strong>
   <a href="#92522" class="date">28-Jul-2009 03:05</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
When you are using CURLOPT_FILE to download directly into a file you must close the file handler after the curl_close() otherwise the file will be incomplete and you will not be able to use it until the end of the execution of the php process.
<br />

<br />
<span class="default">&lt;?php
<br />

<br />
$fh </span><span class="keyword">= </span><span class="default">fopen</span><span class="keyword">(</span><span class="string">'/tmp/foo'</span><span class="keyword">, </span><span class="string">'w'</span><span class="keyword">);
<br />
</span><span class="default">$ch </span><span class="keyword">= </span><span class="default">curl_init</span><span class="keyword">(</span><span class="string">'<a href="http://example.com/foo" rel="nofollow" target="_blank">http://example.com/foo</a>'</span><span class="keyword">);
<br />
</span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_FILE</span><span class="keyword">, </span><span class="default">$fh</span><span class="keyword">);
<br />
</span><span class="default">curl_exec</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">);
<br />
</span><span class="default">curl_close</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">);
<br />

<br />
</span><span class="comment"># at this point your file is not complete and corrupted
<br />

<br />
</span><span class="default">fclose</span><span class="keyword">(</span><span class="default">$fh</span><span class="keyword">);
<br />

<br />
</span><span class="comment"># now you can use your file;
<br />

<br />
</span><span class="default">read_file</span><span class="keyword">(</span><span class="string">'/tmp/foo'</span><span class="keyword">);
<br />

<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="91978""></a>
  <div class="note">
   <strong class="user">Victor Jerlin</strong>
   <a href="#91978" class="date">03-Jul-2009 04:12</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Seems like some options not mentioned on this page, but listed on <a href="http://curl.haxx.se/libcurl/c/curl_easy_setopt.html is actually supported." rel="nofollow" target="_blank">http://curl.haxx.se/libcurl/c/curl_easy_setopt.html is actually supported.</a><br />
<br />
I was happy to see that I could actually use CURLOPT_FTP_CREATE_MISSING_DIRS even from PHP.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="91952""></a>
  <div class="note">
   <strong class="user">xektrum at gmail dot com</strong>
   <a href="#91952" class="date">02-Jul-2009 09:14</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
As of php 5.3 CURLOPT_PROGRESSFUNCTION its supported here's how:<br />
<br />
<span class="default">&lt;?php<br />
<br />
</span><span class="keyword">function </span><span class="default">callback</span><span class="keyword">(</span><span class="default">$download_size</span><span class="keyword">, </span><span class="default">$downloaded</span><span class="keyword">, </span><span class="default">$upload_size</span><span class="keyword">, </span><span class="default">$uploaded</span><span class="keyword">)<br />
{<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// do your progress stuff here<br />
</span><span class="keyword">}<br />
<br />
</span><span class="default">$ch </span><span class="keyword">= </span><span class="default">curl_init</span><span class="keyword">(</span><span class="string">'<a href="http://www.example.com" rel="nofollow" target="_blank">http://www.example.com</a>'</span><span class="keyword">);<br />
<br />
</span><span class="comment">// This is required to curl give us some progress<br />
// if this is not set to false the progress function never<br />
// gets called<br />
</span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_NOPROGRESS</span><span class="keyword">, </span><span class="default">false</span><span class="keyword">);<br />
<br />
</span><span class="comment">// Set up the callback<br />
</span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_PROGRESSFUNCTION</span><span class="keyword">, </span><span class="string">'callback'</span><span class="keyword">);<br />
<br />
</span><span class="comment">// Big buffer less progress info/callbacks<br />
// Small buffer more progress info/callbacks<br />
</span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_BUFFERSIZE</span><span class="keyword">, </span><span class="default">128</span><span class="keyword">);<br />
<br />
</span><span class="default">$data </span><span class="keyword">= </span><span class="default">curl_exec</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">);<br />
<br />
</span><span class="default">?&gt;<br />
</span><br />
Hope this help.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="91510""></a>
  <div class="note">
   <strong class="user">Andrew</strong>
   <a href="#91510" class="date">14-Jun-2009 04:56</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I noticed that if you want to get current cookie file after curl_exec() - you need to close current curl handle (like it said in manual), but if you want cookies to be dumped to file after any curl_exec (without curl_close) you can:
<br />

<br />
<span class="default">&lt;?php
<br />
</span><span class="comment">#call it normally
<br />
</span><span class="default">$ch </span><span class="keyword">= </span><span class="default">curl_init</span><span class="keyword">(); 
<br />
</span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_HEADER</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">); 
<br />
</span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_COOKIEFILE</span><span class="keyword">, </span><span class="string">"cookiefile"</span><span class="keyword">); 
<br />
</span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_COOKIEJAR</span><span class="keyword">, </span><span class="string">"cookiefile"</span><span class="keyword">); 
<br />
</span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_FOLLOWLOCATION</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">); 
<br />
</span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_URL</span><span class="keyword">, </span><span class="string">'<a href="http://www.example.com/" rel="nofollow" target="_blank">http://www.example.com/</a>'</span><span class="keyword">); 
<br />
</span><span class="default">$result1 </span><span class="keyword">= </span><span class="default">curl_exec</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">); 
<br />

<br />
</span><span class="comment">#and then&nbsp; make a temp copy
<br />
</span><span class="default">$ch_temp</span><span class="keyword">=</span><span class="default">curl_copy_handle</span><span class="keyword">(</span><span class="default">ch</span><span class="keyword">);
<br />
</span><span class="default">curl_close</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">);
<br />
</span><span class="default">$ch</span><span class="keyword">=</span><span class="default">$ch_temp</span><span class="keyword">;
<br />
</span><span class="default">?&gt;
<br />
</span>
<br />
Only this way, if you close $ch_temp - cookies wont be dumped.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="91297""></a>
  <div class="note">
   <strong class="user">ericbianchetti at gmail dot com</strong>
   <a href="#91297" class="date">04-Jun-2009 03:06</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
if you need to send a SOAP string that is the CURL you must use :
<br />

<br />
<span class="default">&lt;?php
<br />
$ch </span><span class="keyword">= </span><span class="default">curl_init</span><span class="keyword">();
<br />
</span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_URL</span><span class="keyword">, </span><span class="default">XML_POST_URL</span><span class="keyword">); 
<br />
</span><span class="default">curl_setopt </span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_HTTPHEADER</span><span class="keyword">, array(</span><span class="string">'SOAPAction: ""'</span><span class="keyword">));&nbsp; &nbsp; 
<br />
</span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_RETURNTRANSFER</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">); 
<br />
</span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_SSL_VERIFYPEER</span><span class="keyword">, </span><span class="default">FALSE</span><span class="keyword">);
<br />
</span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_POSTFIELDS</span><span class="keyword">, </span><span class="default">XML_PAYLOAD</span><span class="keyword">); 
<br />
</span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_HEADER</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">);
<br />

<br />
</span><span class="default">$output </span><span class="keyword">= </span><span class="default">curl_exec</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">); 
<br />
</span><span class="default">?&gt;
<br />
</span>
<br />
Note : Having based my snipet on Chemo demonstration (oscommerce user know who he is), XML_POST_URL and XML_PAYLOAD where defined as constant with define().
<br />

<br />
The point is : at the opposite of .xml , SOAP must send the header 'SOAPAction: ""' that can be a valid URI, an empty string (that is here) or nothing ('SOAPAction: '). The later case baing not accepted by all server, the second one indicating the target is the URI used to post the SOAP.
<br />
<a href="http://www.w3.org/TR/2000/NOTE-SOAP-20000508/#_Toc478383528" rel="nofollow" target="_blank">http://www.w3.org/TR/2000/NOTE-SOAP-20000508/#_Toc478383528</a></span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="89770""></a>
  <div class="note">
   <strong class="user">ashooner - - gmail , com</strong>
   <a href="#89770" class="date">22-Mar-2009 03:28</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
When passing CURLOPT_POSTFIELDS a url-encoded string in order to use Content-Type: application/x-www-form-urlencoded, you can pass a string directly:<br />
<span class="default">&lt;?php<br />
curl_setopt</span><span class="keyword">(</span><span class="default">CURLOPT_POSTFIELDS</span><span class="keyword">, </span><span class="string">'field1=value&amp;field2=value2'</span><span class="keyword">);<br />
</span><span class="default">?&gt;<br />
</span><br />
rather than passing the string in an array, as in fred at themancan dot com's example.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="88538""></a>
  <div class="note">
   <strong class="user">urkle at outoforder dot cc</strong>
   <a href="#88538" class="date">28-Jan-2009 06:49</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
To send a post as a different content-type (ie.. application/json or text/xml) add this setopt call
<br />

<br />
<span class="default">&lt;?php
<br />
curl_setopt</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_HTTPHEADER</span><span class="keyword">,array(</span><span class="string">'Content-Type: application/json'</span><span class="keyword">));
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="87341""></a>
  <div class="note">
   <strong class="user">fnjordy at gmail dot com</strong>
   <a href="#87341" class="date">30-Nov-2008 11:28</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Note that CURLOPT_RETURNTRANSFER when used with CURLOPT_WRITEFUNCTION has effectively three settings: default, true, and false.<br />
<br />
default - callbacks will be called as expected.<br />
true - content will be returned but callback function will not be called.<br />
false - content will be output and callback function will not be called.<br />
<br />
Note that CURLOPT_HEADERFUNCTION callbacks are always called.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="87112""></a>
  <div class="note">
   <strong class="user">saidk at phirebranding dot com</strong>
   <a href="#87112" class="date">19-Nov-2008 01:31</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Passing in PHP's $_SESSION into your cURL call:
<br />

<br />
<span class="default">&lt;?php
<br />
session_start</span><span class="keyword">();
<br />
</span><span class="default">$strCookie </span><span class="keyword">= </span><span class="string">'PHPSESSID=' </span><span class="keyword">. </span><span class="default">$_COOKIE</span><span class="keyword">[</span><span class="string">'PHPSESSID'</span><span class="keyword">] . </span><span class="string">'; path=/'</span><span class="keyword">;
<br />
</span><span class="default">session_write_close</span><span class="keyword">();
<br />

<br />
</span><span class="default">$curl_handle </span><span class="keyword">= </span><span class="default">curl_init</span><span class="keyword">(</span><span class="string">'enter_external_url_here'</span><span class="keyword">);
<br />
</span><span class="default">curl_setopt</span><span class="keyword">( </span><span class="default">$curl_handle</span><span class="keyword">, </span><span class="default">CURLOPT_COOKIE</span><span class="keyword">, </span><span class="default">$strCookie </span><span class="keyword">);
<br />
</span><span class="default">curl_exec</span><span class="keyword">(</span><span class="default">$curl_handle</span><span class="keyword">);
<br />
</span><span class="default">curl_close</span><span class="keyword">(</span><span class="default">$curl_handle</span><span class="keyword">);
<br />
</span><span class="default">?&gt;
<br />
</span>
<br />
This worked great for me.&nbsp; I was calling pages from the same server and needed to keep the $_SESSION variables.&nbsp; This passes them over.&nbsp; If you want to test, just print_r($_SESSION);
<br />

<br />
Enjoy!</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="85044""></a>
  <div class="note">
   <strong class="user">w dot danford at electronics-software dot com</strong>
   <a href="#85044" class="date">12-Aug-2008 10:12</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Just a small detail I too easily overlooked.<br />
<span class="default">&lt;?php<br />
</span><span class="comment">/*&nbsp; If you set:&nbsp; */<br />
</span><span class="default">curl_setopt </span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_POST</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">);<br />
</span><span class="comment">/* then you must have the data: */<br />
</span><span class="default">curl_setopt </span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_POSTFIELDS</span><span class="keyword">, </span><span class="default">$PostData</span><span class="keyword">);<br />
</span><span class="default">?&gt;<br />
</span>I found with only the CURLOPT_POST set (from copy, paste editing of course) cookies were not getting sent with CURLOPT_COOKIE.&nbsp; Just something subtle to watch out for.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="84916""></a>
  <div class="note">
   <strong class="user">fred at themancan dot com</strong>
   <a href="#84916" class="date">05-Aug-2008 04:28</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
To find what encoding a given HTTP POST request uses is easy -- passing an array to CURLOPT_POSTFIELDS results in&nbsp; multipart/form-data:
<br />

<br />
<span class="default">&lt;?php
<br />
curl_setopt</span><span class="keyword">(</span><span class="default">CURLOPT_POSTFIELDS</span><span class="keyword">, array(</span><span class="string">'field1' </span><span class="keyword">=&gt; </span><span class="string">'value'</span><span class="keyword">));
<br />
</span><span class="default">?&gt;
<br />
</span>
<br />
Passing a URL-encoded string will result in application/x-www-form-urlencoded:
<br />

<br />
<span class="default">&lt;?php
<br />
curl_setopt</span><span class="keyword">(</span><span class="default">CURLOPT_POSTFIELDS</span><span class="keyword">, array(</span><span class="string">'field1=value&amp;field2=value2'</span><span class="keyword">));
<br />
</span><span class="default">?&gt;
<br />
</span>
<br />
I ran across this when integrating with both a warehouse system and an email system; neither would accept multipart/form-data, but both happily accepted application/x-www-form-urlencoded.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="84902""></a>
  <div class="note">
   <strong class="user">jID</strong>
   <a href="#84902" class="date">05-Aug-2008 04:56</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
if you use<br />
<span class="default">&lt;?php<br />
curl_setopt</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_INTERFACE</span><span class="keyword">, </span><span class="string">"XXX.XXX.XXX.XXX"</span><span class="keyword">);<br />
</span><span class="default">?&gt;<br />
</span>to specify IP adress for request, sometimes you need to get list of all your IP's.<br />
<br />
ifconfig command will output something like:<br />
<br />
rl0: flags=8843&lt;UP,BROADCAST,RUNNING,SIMPLEX,MULTICAST&gt; mtu 1500<br />
&nbsp;&nbsp;&nbsp; options=8&lt;VLAN_MTU&gt;<br />
&nbsp;&nbsp;&nbsp; inet 82.146.XXX.XXX netmask 0xffffffff broadcast 82.146.XXX.XXX<br />
&nbsp;&nbsp;&nbsp; inet 78.24.XXX.XXX netmask 0xffffffff broadcast 78.24.XXX.XXX<br />
&nbsp;&nbsp;&nbsp; inet 82.146.XXX.XXX netmask 0xffffffff broadcast 82.146.XXX.XXX<br />
&nbsp;&nbsp;&nbsp; inet 82.146.XXX.XXX netmask 0xffffffff broadcast 82.146.XXX.XXX<br />
&nbsp;&nbsp;&nbsp; inet 82.146.XXX.XXX netmask 0xffffffff broadcast 82.146.XXX.XXX<br />
&nbsp;&nbsp;&nbsp; inet 78.24.XXX.XXX netmask 0xffffffff broadcast 78.24.XXX.XXX<br />
&nbsp;&nbsp;&nbsp; inet 78.24.XXX.XXX netmask 0xffffffff broadcast 78.24.XXX.XXX<br />
&nbsp;&nbsp;&nbsp; ether XX:XX:XX:XX:XX:XX<br />
&nbsp;&nbsp;&nbsp; media: Ethernet autoselect (100baseTX &lt;full-duplex&gt;)<br />
&nbsp;&nbsp;&nbsp; status: active<br />
lo0: flags=8049&lt;UP,LOOPBACK,RUNNING,MULTICAST&gt; mtu 16384<br />
tun0: flags=8051&lt;UP,POINTOPOINT,RUNNING,MULTICAST&gt; mtu 1500<br />
&nbsp;&nbsp;&nbsp; Opened by PID 564<br />
tun1: flags=8051&lt;UP,POINTOPOINT,RUNNING,MULTICAST&gt; mtu 1500<br />
&nbsp;&nbsp;&nbsp; Opened by PID 565<br />
&nbsp;&nbsp;&nbsp; Opened by PID 565<br />
<br />
My solution for FreeBSD 6 and PHP 5 was:<br />
<span class="default">&lt;?php<br />
&nbsp; ob_start</span><span class="keyword">();<br />
&nbsp; </span><span class="default">$ips</span><span class="keyword">=array();<br />
&nbsp; </span><span class="default">$ifconfig</span><span class="keyword">=</span><span class="default">system</span><span class="keyword">(</span><span class="string">"ifconfig"</span><span class="keyword">);<br />
&nbsp; echo </span><span class="default">$ifconfig</span><span class="keyword">;<br />
&nbsp; </span><span class="default">$ifconfig</span><span class="keyword">=</span><span class="default">ob_get_contents</span><span class="keyword">();<br />
&nbsp; </span><span class="default">ob_end_clean</span><span class="keyword">();<br />
&nbsp; </span><span class="default">$ifconfig</span><span class="keyword">=</span><span class="default">explode</span><span class="keyword">(</span><span class="default">chr</span><span class="keyword">(</span><span class="default">10</span><span class="keyword">), </span><span class="default">$ifconfig</span><span class="keyword">);<br />
&nbsp; for (</span><span class="default">$i</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">; </span><span class="default">$i</span><span class="keyword">&lt;</span><span class="default">count</span><span class="keyword">(</span><span class="default">$ifconfig</span><span class="keyword">); </span><span class="default">$i</span><span class="keyword">++) {<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$t</span><span class="keyword">=</span><span class="default">explode</span><span class="keyword">(</span><span class="string">" "</span><span class="keyword">, </span><span class="default">$ifconfig</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">]);<br />
&nbsp;&nbsp;&nbsp; if (</span><span class="default">$t</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">]==</span><span class="string">"\tinet"</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">array_push</span><span class="keyword">(</span><span class="default">$ips</span><span class="keyword">, </span><span class="default">$t</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">]);<br />
&nbsp;&nbsp;&nbsp; }&nbsp; &nbsp;&nbsp; <br />
&nbsp; }<br />
&nbsp; for (</span><span class="default">$i</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">; </span><span class="default">$i</span><span class="keyword">&lt;</span><span class="default">count</span><span class="keyword">(</span><span class="default">$ips</span><span class="keyword">); </span><span class="default">$i</span><span class="keyword">++) {<br />
&nbsp;&nbsp;&nbsp; echo </span><span class="default">$ips</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">].</span><span class="string">"\n"</span><span class="keyword">;<br />
&nbsp; }<br />
</span><span class="default">?&gt;<br />
</span><br />
You will get list of IP adresses in $ips array, like:<br />
82.146.XXX.XXX<br />
78.24.XXX.XXX<br />
82.146.XXX.XXX<br />
82.146.XXX.XXX<br />
82.146.XXX.XXX<br />
78.24.XXX.XXX<br />
78.24.XXX.XXX</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="84374""></a>
  <div class="note">
   <strong class="user">ac at an dot y-co dot de</strong>
   <a href="#84374" class="date">10-Jul-2008 10:08</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you want to connect to a server which requires that you identify yourself with a certificate, use following code. Your certificate and servers certificate are signed by an authority whose certificate is in ca.ctr.
<br />

<br />
<span class="default">&lt;?php
<br />
curl_setopt</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_VERBOSE</span><span class="keyword">, </span><span class="string">'1'</span><span class="keyword">);
<br />
</span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_SSL_VERIFYHOST</span><span class="keyword">, </span><span class="string">'2'</span><span class="keyword">);
<br />
</span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_SSL_VERIFYPEER</span><span class="keyword">, </span><span class="string">'1'</span><span class="keyword">);
<br />
</span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_CAINFO</span><span class="keyword">,&nbsp; </span><span class="default">getcwd</span><span class="keyword">().</span><span class="string">'/cert/ca.crt'</span><span class="keyword">);
<br />
</span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_SSLCERT</span><span class="keyword">, </span><span class="default">getcwd</span><span class="keyword">().</span><span class="string">'/cert/mycert.pem'</span><span class="keyword">);
<br />
</span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_SSLCERTPASSWD</span><span class="keyword">, </span><span class="string">'password'</span><span class="keyword">);
<br />
</span><span class="default">?&gt;
<br />
</span>
<br />
If your original certificate is in .pfx format, you have to convert it to .pem using following commands
<br />
# openssl pkcs12 -in mycert.pfx -out mycert.key
<br />
# openssl rsa -in mycert.key -out mycert.pem
<br />
# openssl x509 -in mycert.key &gt;&gt; mycert.pem</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="83937""></a>
  <div class="note">
   <strong class="user">Salil Kothadia</strong>
   <a href="#83937" class="date">19-Jun-2008 09:02</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
In PHP5, for the "CURLOPT_POSTFIELDS" option, we can use:<br />
<br />
<span class="default">&lt;?php<br />
$ch </span><span class="keyword">= </span><span class="default">curl_init</span><span class="keyword">(</span><span class="default">$URI</span><span class="keyword">);<br />
</span><span class="default">$Post </span><span class="keyword">= </span><span class="default">http_build_query</span><span class="keyword">(</span><span class="default">$PostData</span><span class="keyword">);<br />
</span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_POSTFIELDS</span><span class="keyword">, </span><span class="default">$Post</span><span class="keyword">);<br />
</span><span class="default">$Output </span><span class="keyword">= </span><span class="default">curl_exec</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">);<br />
</span><span class="default">curl_close</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">);<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="82418""></a>
  <div class="note">
   <strong class="user">sgamon at yahoo dot com</strong>
   <a href="#82418" class="date">09-Apr-2008 05:55</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you are doing a POST, and the content length is 1,025 or greater, then curl exploits a feature of http 1.1: 100 (Continue) Status.<br />
<br />
See <a href="http://www.w3.org/Protocols/rfc2616/rfc2616-sec8.html#sec8.2.3" rel="nofollow" target="_blank">http://www.w3.org/Protocols/rfc2616/rfc2616-sec8.html#sec8.2.3</a><br />
<br />
* it adds a header, "Expect: 100-continue".&nbsp; <br />
* it then sends the request head, waits for a 100 response code, then sends the content <br />
<br />
Not all web servers support this though.&nbsp; Various errors are returned depending on the server.&nbsp; If this happens to you, suppress the "Expect" header with this command:<br />
<br />
<span class="default">&lt;?php<br />
curl_setopt</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_HTTPHEADER</span><span class="keyword">, array(</span><span class="string">'Expect:'</span><span class="keyword">));<br />
</span><span class="default">?&gt;<br />
</span><br />
See <a href="http://www.gnegg.ch/2007/02/the-return-of-except-100-continue/" rel="nofollow" target="_blank">http://www.gnegg.ch/2007/02/the-return-of-except-100-continue/</a></span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="81581""></a>
  <div class="note">
   <strong class="user">c00lways at gmail dot com</strong>
   <a href="#81581" class="date">04-Mar-2008 01:16</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
if you would like to send xml request to a server (lets say, making a soap proxy),
<br />
you have to set
<br />

<br />
<span class="default">&lt;?php
<br />
curl_setopt</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_HTTPHEADER</span><span class="keyword">, Array(</span><span class="string">"Content-Type: text/xml"</span><span class="keyword">));
<br />
</span><span class="default">?&gt;
<br />
</span>
<br />
makesure you watch for cache issue:
<br />
the below code will prevent cache...
<br />

<br />
<span class="default">&lt;?php
<br />
curl_setopt</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_FORBID_REUSE</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">);
<br />
</span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_FRESH_CONNECT</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">);
<br />
</span><span class="default">?&gt;
<br />
</span>
<br />
hope it helps ;)</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="81161""></a>
  <div class="note">
   <strong class="user">mavook at gmail dot com</strong>
   <a href="#81161" class="date">15-Feb-2008 10:26</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you try to upload file to a server, you need do CURLOPT_POST first and then fill CURLOPT_POSTFIELDS.
<br />

<br />
<span class="default">&lt;?php
<br />
curl_setopt</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_POST</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">);
<br />
</span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_POSTFIELDS</span><span class="keyword">, </span><span class="default">$postvars</span><span class="keyword">);
<br />
</span><span class="comment">// ^^ This will post multipart/form-data
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="80271""></a>
  <div class="note">
   <strong class="user">jade dot skaggs at gmail dot com</strong>
   <a href="#80271" class="date">07-Jan-2008 09:48</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
After much struggling, I managed to get a SOAP request requiring HTTP authentication to work.&nbsp; Here's some source that will hopefully be useful to others. 
<br />

<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; <span class="default">&lt;?php
<br />

<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; $credentials </span><span class="keyword">= </span><span class="string">"username:password"</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; 
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">// Read the XML to send to the Web Service
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$request_file </span><span class="keyword">= </span><span class="string">"./SampleRequest.xml"</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$fh </span><span class="keyword">= </span><span class="default">fopen</span><span class="keyword">(</span><span class="default">$request_file</span><span class="keyword">, </span><span class="string">'r'</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$xml_data </span><span class="keyword">= </span><span class="default">fread</span><span class="keyword">(</span><span class="default">$fh</span><span class="keyword">, </span><span class="default">filesize</span><span class="keyword">(</span><span class="default">$request_file</span><span class="keyword">));
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">fclose</span><span class="keyword">(</span><span class="default">$fh</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; 
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$url </span><span class="keyword">= </span><span class="string">"<a href="http://www.example.com/services/calculation" rel="nofollow" target="_blank">http://www.example.com/services/calculation</a>"</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$page </span><span class="keyword">= </span><span class="string">"/services/calculation"</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$headers </span><span class="keyword">= array(
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">"POST "</span><span class="keyword">.</span><span class="default">$page</span><span class="keyword">.</span><span class="string">" HTTP/1.0"</span><span class="keyword">,
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">"Content-type: text/xml;charset=\"utf-8\""</span><span class="keyword">,
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">"Accept: text/xml"</span><span class="keyword">,
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">"Cache-Control: no-cache"</span><span class="keyword">,
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">"Pragma: no-cache"</span><span class="keyword">,
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">"SOAPAction: \"run\""</span><span class="keyword">,
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">"Content-length: "</span><span class="keyword">.</span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$xml_data</span><span class="keyword">),
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">"Authorization: Basic " </span><span class="keyword">. </span><span class="default">base64_encode</span><span class="keyword">(</span><span class="default">$credentials</span><span class="keyword">)
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; );
<br />
&nbsp;&nbsp; &nbsp; &nbsp; 
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$ch </span><span class="keyword">= </span><span class="default">curl_init</span><span class="keyword">();
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_URL</span><span class="keyword">,</span><span class="default">$url</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_RETURNTRANSFER</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_TIMEOUT</span><span class="keyword">, </span><span class="default">60</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_HTTPHEADER</span><span class="keyword">, </span><span class="default">$headers</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_USERAGENT</span><span class="keyword">, </span><span class="default">$defined_vars</span><span class="keyword">[</span><span class="string">'HTTP_USER_AGENT'</span><span class="keyword">]);
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; 
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// Apply the XML to our curl call
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_POST</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_POSTFIELDS</span><span class="keyword">, </span><span class="default">$xml_data</span><span class="keyword">); 
<br />

<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$data </span><span class="keyword">= </span><span class="default">curl_exec</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">); 
<br />

<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">curl_errno</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">)) {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; print </span><span class="string">"Error: " </span><span class="keyword">. </span><span class="default">curl_error</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; } else {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// Show me the result
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">var_dump</span><span class="keyword">(</span><span class="default">$data</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">curl_close</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }
<br />

<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="78046""></a>
  <div class="note">
   <strong class="user">Ojas Ojasvi</strong>
   <a href="#78046" class="date">25-Sep-2007 10:52</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
<span class="default">&lt;?php
<br />
</span><span class="comment">/*
<br />
* Author: Ojas Ojasvi
<br />
* Released: September 25, 2007
<br />
* Description: An example of the disguise_curl() function in order to grab contents from a website while remaining fully camouflaged by using a fake user agent and fake headers.
<br />
*/
<br />

<br />
</span><span class="default">$url </span><span class="keyword">= </span><span class="string">'<a href="http://www.php.net" rel="nofollow" target="_blank">http://www.php.net</a>'</span><span class="keyword">;
<br />

<br />
</span><span class="comment">// disguises the curl using fake headers and a fake user agent.
<br />
</span><span class="keyword">function </span><span class="default">disguise_curl</span><span class="keyword">(</span><span class="default">$url</span><span class="keyword">)
<br />
{
<br />
&nbsp; </span><span class="default">$curl </span><span class="keyword">= </span><span class="default">curl_init</span><span class="keyword">();
<br />

<br />
&nbsp; </span><span class="comment">// Setup headers - I used the same headers from Firefox version 2.0.0.6
<br />
&nbsp; // below was split up because php.net said the line was too long. :/
<br />
&nbsp; </span><span class="default">$header</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">] = </span><span class="string">"Accept: text/xml,application/xml,application/xhtml+xml,"</span><span class="keyword">;
<br />
&nbsp; </span><span class="default">$header</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">] .= </span><span class="string">"text/html;q=0.9,text/plain;q=0.8,image/png,*/*;q=0.5"</span><span class="keyword">;
<br />
&nbsp; </span><span class="default">$header</span><span class="keyword">[] = </span><span class="string">"Cache-Control: max-age=0"</span><span class="keyword">;
<br />
&nbsp; </span><span class="default">$header</span><span class="keyword">[] = </span><span class="string">"Connection: keep-alive"</span><span class="keyword">;
<br />
&nbsp; </span><span class="default">$header</span><span class="keyword">[] = </span><span class="string">"Keep-Alive: 300"</span><span class="keyword">;
<br />
&nbsp; </span><span class="default">$header</span><span class="keyword">[] = </span><span class="string">"Accept-Charset: ISO-8859-1,utf-8;q=0.7,*;q=0.7"</span><span class="keyword">;
<br />
&nbsp; </span><span class="default">$header</span><span class="keyword">[] = </span><span class="string">"Accept-Language: en-us,en;q=0.5"</span><span class="keyword">;
<br />
&nbsp; </span><span class="default">$header</span><span class="keyword">[] = </span><span class="string">"Pragma: "</span><span class="keyword">; </span><span class="comment">// browsers keep this blank.
<br />

<br />
&nbsp; </span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$curl</span><span class="keyword">, </span><span class="default">CURLOPT_URL</span><span class="keyword">, </span><span class="default">$url</span><span class="keyword">);
<br />
&nbsp; </span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$curl</span><span class="keyword">, </span><span class="default">CURLOPT_USERAGENT</span><span class="keyword">, </span><span class="string">'Googlebot/2.1 (+<a href="http://www.google.com/bot.html" rel="nofollow" target="_blank">http://www.google.com/bot.html</a>)'</span><span class="keyword">);
<br />
&nbsp; </span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$curl</span><span class="keyword">, </span><span class="default">CURLOPT_HTTPHEADER</span><span class="keyword">, </span><span class="default">$header</span><span class="keyword">);
<br />
&nbsp; </span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$curl</span><span class="keyword">, </span><span class="default">CURLOPT_REFERER</span><span class="keyword">, </span><span class="string">'<a href="http://www.google.com" rel="nofollow" target="_blank">http://www.google.com</a>'</span><span class="keyword">);
<br />
&nbsp; </span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$curl</span><span class="keyword">, </span><span class="default">CURLOPT_ENCODING</span><span class="keyword">, </span><span class="string">'gzip,deflate'</span><span class="keyword">);
<br />
&nbsp; </span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$curl</span><span class="keyword">, </span><span class="default">CURLOPT_AUTOREFERER</span><span class="keyword">, </span><span class="default">true</span><span class="keyword">);
<br />
&nbsp; </span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$curl</span><span class="keyword">, </span><span class="default">CURLOPT_RETURNTRANSFER</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">);
<br />
&nbsp; </span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$curl</span><span class="keyword">, </span><span class="default">CURLOPT_TIMEOUT</span><span class="keyword">, </span><span class="default">10</span><span class="keyword">);
<br />

<br />
&nbsp; </span><span class="default">$html </span><span class="keyword">= </span><span class="default">curl_exec</span><span class="keyword">(</span><span class="default">$curl</span><span class="keyword">); </span><span class="comment">// execute the curl command
<br />
&nbsp; </span><span class="default">curl_close</span><span class="keyword">(</span><span class="default">$curl</span><span class="keyword">); </span><span class="comment">// close the connection
<br />

<br />
&nbsp; </span><span class="keyword">return </span><span class="default">$html</span><span class="keyword">; </span><span class="comment">// and finally, return $html
<br />
</span><span class="keyword">}
<br />

<br />
</span><span class="comment">// uses the function and displays the text off the website
<br />
</span><span class="default">$text </span><span class="keyword">= </span><span class="default">disguise_curl</span><span class="keyword">(</span><span class="default">$url</span><span class="keyword">);
<br />
echo </span><span class="default">$text</span><span class="keyword">;
<br />
</span><span class="default">?&gt;
<br />
</span>
<br />
Ojas Ojasvi</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="77224""></a>
  <div class="note">
   <strong class="user">andrabr at gmail dot com</strong>
   <a href="#77224" class="date">20-Aug-2007 02:03</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
This is very clear in hindsight, but it still cost me several hours:
<br />

<br />
<span class="default">&lt;?php curl_setopt</span><span class="keyword">(</span><span class="default">$session</span><span class="keyword">, </span><span class="default">CURLOPT_HTTPPROXYTUNNEL</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">); </span><span class="default">?&gt;
<br />
</span>
<br />
means that you will tunnel THROUGH the proxy, as in "your communications will go as if the proxy is NOT THERE".
<br />

<br />
Why do you care? - Well, if you are trying to use, say, Paros, to debug HTTP between your cURL and the server, with CURLOPT_HTTPPROXYTUNNEL set to TRUE Paros will not see or log your traffic thus defeating the purpose and driving you nuts.
<br />

<br />
There are other cases, of course, where this option is extremely useful...</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="75525""></a>
  <div class="note">
   <strong class="user">ashw1 - at - no spam - post - dot - cz</strong>
   <a href="#75525" class="date">03-Jun-2007 04:51</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
In case you wonder how come, that cookies don't work under Windows, I've googled for some answers, and here is the result: Under WIN you need to input absolute path of the cookie file.
<br />

<br />
This piece of code solves it:
<br />

<br />
<span class="default">&lt;?php
<br />

<br />
</span><span class="keyword">if (</span><span class="default">$cookies </span><span class="keyword">!= </span><span class="string">''</span><span class="keyword">)
<br />
&nbsp;&nbsp;&nbsp; {
<br />
&nbsp;&nbsp;&nbsp; if (</span><span class="default">substr</span><span class="keyword">(</span><span class="default">PHP_OS</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">3</span><span class="keyword">) == </span><span class="string">'WIN'</span><span class="keyword">)
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {</span><span class="default">$cookies </span><span class="keyword">= </span><span class="default">str_replace</span><span class="keyword">(</span><span class="string">'\\'</span><span class="keyword">,</span><span class="string">'/'</span><span class="keyword">, </span><span class="default">getcwd</span><span class="keyword">().</span><span class="string">'/'</span><span class="keyword">.</span><span class="default">$cookies</span><span class="keyword">);}
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_COOKIEJAR</span><span class="keyword">, </span><span class="default">$cookies</span><span class="keyword">);
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_COOKIEFILE</span><span class="keyword">, </span><span class="default">$cookies</span><span class="keyword">);
<br />
&nbsp;&nbsp;&nbsp; }
<br />

<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="74709""></a>
  <div class="note">
   <strong class="user">rob at infoglobe dot net</strong>
   <a href="#74709" class="date">24-Apr-2007 09:01</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Options not included in the above, but that work (Taken from the libcurl.a C documentation)<br />
<br />
CURLOPT_FTP_SSL <br />
<br />
Pass a long using one of the values from below, to make libcurl use your desired level of SSL for the ftp transfer. (Added in 7.11.0) <br />
<br />
CURLFTPSSL_NONE <br />
<br />
Don't attempt to use SSL. <br />
<br />
CURLFTPSSL_TRY <br />
<br />
Try using SSL, proceed as normal otherwise. <br />
<br />
CURLFTPSSL_CONTROL <br />
<br />
Require SSL for the control connection or fail with CURLE_FTP_SSL_FAILED. <br />
<br />
CURLFTPSSL_ALL <br />
<br />
Require SSL for all communication or fail with CURLE_FTP_SSL_FAILED.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="73742""></a>
  <div class="note">
   <strong class="user">paczor</strong>
   <a href="#73742" class="date">08-Mar-2007 06:50</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
How to get rid of response after POST: just add callback function for returned data (CURLOPT_WRITEFUNCTION) and make this function empty.
<br />

<br />
<span class="default">&lt;?php
<br />
</span><span class="keyword">function </span><span class="default">curlHeaderCallback</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">$strHeader</span><span class="keyword">) {
<br />
}
<br />
</span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_WRITEFUNCTION</span><span class="keyword">, </span><span class="string">'curlHeaderCallback'</span><span class="keyword">);
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="71313""></a>
  <div class="note">
   <strong class="user">eion at bigfoot dot com</strong>
   <a href="#71313" class="date">21-Nov-2006 08:40</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you are trying to use CURLOPT_FOLLOWLOCATION and you get this warning:<br />
Warning: curl_setopt() [function.curl-setopt]: CURLOPT_FOLLOWLOCATION cannot be activated when in safe_mode or an open_basedir is set...<br />
<br />
then you will want to read <a href="http://www.php.net/ChangeLog-4.php which says " rel="nofollow" target="_blank">http://www.php.net/ChangeLog-4.php which says </a>"Disabled CURLOPT_FOLLOWLOCATION in curl when open_basedir or safe_mode are enabled." as of PHP 4.4.4/5.1.5.&nbsp; This is due to the fact that curl is not part of PHP and doesn't know the values of open_basedir or safe_mode, so you could comprimise your webserver operating in safe_mode by redirecting (using header('Location: ...')) to "file://" urls, which curl would have gladly retrieved.<br />
<br />
Until the curl extension is changed in PHP or curl (if it ever will) to deal with "Location:" headers, here is a far from perfect remake of the curl_exec function that I am using.<br />
<br />
Since there's no curl_getopt function equivalent, you'll have to tweak the function to make it work for your specific use.&nbsp; As it is here, it returns the body of the response and not the header.&nbsp; It also doesn't deal with redirection urls with username and passwords in them.<br />
<br />
<span class="default">&lt;?php<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">function </span><span class="default">curl_redir_exec</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">)<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; static </span><span class="default">$curl_loops </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; static </span><span class="default">$curl_max_loops </span><span class="keyword">= </span><span class="default">20</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">$curl_loops</span><span class="keyword">++ &gt;= </span><span class="default">$curl_max_loops</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$curl_loops </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">FALSE</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_HEADER</span><span class="keyword">, </span><span class="default">true</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_RETURNTRANSFER</span><span class="keyword">, </span><span class="default">true</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$data </span><span class="keyword">= </span><span class="default">curl_exec</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; list(</span><span class="default">$header</span><span class="keyword">, </span><span class="default">$data</span><span class="keyword">) = </span><span class="default">explode</span><span class="keyword">(</span><span class="string">"\n\n"</span><span class="keyword">, </span><span class="default">$data</span><span class="keyword">, </span><span class="default">2</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$http_code </span><span class="keyword">= </span><span class="default">curl_getinfo</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLINFO_HTTP_CODE</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">$http_code </span><span class="keyword">== </span><span class="default">301 </span><span class="keyword">|| </span><span class="default">$http_code </span><span class="keyword">== </span><span class="default">302</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$matches </span><span class="keyword">= array();<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">preg_match</span><span class="keyword">(</span><span class="string">'/Location:(.*?)\n/'</span><span class="keyword">, </span><span class="default">$header</span><span class="keyword">, </span><span class="default">$matches</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$url </span><span class="keyword">= @</span><span class="default">parse_url</span><span class="keyword">(</span><span class="default">trim</span><span class="keyword">(</span><span class="default">array_pop</span><span class="keyword">(</span><span class="default">$matches</span><span class="keyword">)));<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (!</span><span class="default">$url</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">//couldn't process the url to redirect to<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$curl_loops </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">$data</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$last_url </span><span class="keyword">= </span><span class="default">parse_url</span><span class="keyword">(</span><span class="default">curl_getinfo</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLINFO_EFFECTIVE_URL</span><span class="keyword">));<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (!</span><span class="default">$url</span><span class="keyword">[</span><span class="string">'scheme'</span><span class="keyword">])<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$url</span><span class="keyword">[</span><span class="string">'scheme'</span><span class="keyword">] = </span><span class="default">$last_url</span><span class="keyword">[</span><span class="string">'scheme'</span><span class="keyword">];<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (!</span><span class="default">$url</span><span class="keyword">[</span><span class="string">'host'</span><span class="keyword">])<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$url</span><span class="keyword">[</span><span class="string">'host'</span><span class="keyword">] = </span><span class="default">$last_url</span><span class="keyword">[</span><span class="string">'host'</span><span class="keyword">];<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (!</span><span class="default">$url</span><span class="keyword">[</span><span class="string">'path'</span><span class="keyword">])<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$url</span><span class="keyword">[</span><span class="string">'path'</span><span class="keyword">] = </span><span class="default">$last_url</span><span class="keyword">[</span><span class="string">'path'</span><span class="keyword">];<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$new_url </span><span class="keyword">= </span><span class="default">$url</span><span class="keyword">[</span><span class="string">'scheme'</span><span class="keyword">] . </span><span class="string">'://' </span><span class="keyword">. </span><span class="default">$url</span><span class="keyword">[</span><span class="string">'host'</span><span class="keyword">] . </span><span class="default">$url</span><span class="keyword">[</span><span class="string">'path'</span><span class="keyword">] . (</span><span class="default">$url</span><span class="keyword">[</span><span class="string">'query'</span><span class="keyword">]?</span><span class="string">'?'</span><span class="keyword">.</span><span class="default">$url</span><span class="keyword">[</span><span class="string">'query'</span><span class="keyword">]:</span><span class="string">''</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_URL</span><span class="keyword">, </span><span class="default">$new_url</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">debug</span><span class="keyword">(</span><span class="string">'Redirecting to'</span><span class="keyword">, </span><span class="default">$new_url</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">curl_redir_exec</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; } else {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$curl_loops</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">$data</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; }<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="69115""></a>
  <div class="note">
   <strong class="user">php at miggy dot org</strong>
   <a href="#69115" class="date">23-Aug-2006 10:35</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Note that if you want to use a proxy and use it as a _cache_, you'll have to do:
<br />

<br />
<span class="default">&lt;?php curl_setopt</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_HTTPHEADER</span><span class="keyword">, array(</span><span class="string">"Pragma: "</span><span class="keyword">)); </span><span class="default">?&gt;
<br />
</span>
<br />
else by default Curl puts a "Pragma: no-cache" header in and thus force cache misses for all requests.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="66832""></a>
  <div class="note">
   <strong class="user">Philippe dot Jausions at 11abacus dot com</strong>
   <a href="#66832" class="date">30-May-2006 11:31</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Clarification on the callback methods:<br />
<br />
- CURLOPT_HEADERFUNCTION is for handling header lines received *in the response*,<br />
- CURLOPT_WRITEFUNCTION is for handling data received *from the response*,<br />
- CURLOPT_READFUNCTION is for handling data passed along *in the request*.<br />
<br />
The callback "string" can be any callable function, that includes the array(&amp;$obj, 'someMethodName') format.<br />
<br />
&nbsp;-Philippe</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="64447""></a>
  <div class="note">
   <strong class="user">mr at coder dot tv</strong>
   <a href="#64447" class="date">14-Apr-2006 07:22</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Sometimes you can't use CURLOPT_COOKIEJAR and CURLOPT_COOKIEFILE becoz of the server php-settings(They say u may grab any files from server using these options). Here is the solution<br />
1)Don't use CURLOPT_FOLLOWLOCATION<br />
2)Use curl_setopt($ch, CURLOPT_HEADER, 1)<br />
3)Grab from the header cookies like this:<br />
preg_match_all('|Set-Cookie: (.*);|U', $content, $results);&nbsp; &nbsp; <br />
$cookies = implode(';', $results[1]);<br />
4)Set them using curl_setopt($ch, CURLOPT_COOKIE,&nbsp; $cookies);<br />
<br />
Good Luck, Yevgen</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="62274""></a>
  <div class="note">
   <strong class="user">heyrocker at yahoo dot com</strong>
   <a href="#62274" class="date">23-Feb-2006 01:57</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
The examples below for HTTP file upload work great, but I wanted to be able to post multiple files through HTTP upload using HTML arrays as specified in example 38.3 at
<br />

<br />
<a href="http://php.net/features.file-upload" rel="nofollow" target="_blank">http://php.net/features.file-upload</a>
<br />

<br />
In this case, you need to set the arrays AND keys in the $post_data, it will not work with just the array names. The following example shows how this works:
<br />

<br />
<span class="default">&lt;?php
<br />

<br />
&nbsp;&nbsp;&nbsp; $post_data </span><span class="keyword">= array();
<br />
&nbsp;&nbsp;&nbsp; 
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$post_data</span><span class="keyword">[</span><span class="string">'pictures[0]'</span><span class="keyword">] = </span><span class="string">"@cat.jpg"</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$post_data</span><span class="keyword">[</span><span class="string">'pictures[1]'</span><span class="keyword">] = </span><span class="string">"@dog.jpg"</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; 
<br />

<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$ch </span><span class="keyword">= </span><span class="default">curl_init</span><span class="keyword">();
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_URL</span><span class="keyword">, </span><span class="string">"<a href="http://example.com/my_url.php" rel="nofollow" target="_blank">http://example.com/my_url.php</a>" </span><span class="keyword">); 
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_POST</span><span class="keyword">, </span><span class="default">1 </span><span class="keyword">);
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_POSTFIELDS</span><span class="keyword">, </span><span class="default">$post_data</span><span class="keyword">);
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_RETURNTRANSFER</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">);
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$postResult </span><span class="keyword">= </span><span class="default">curl_exec</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">);
<br />

<br />
&nbsp;&nbsp;&nbsp; if (</span><span class="default">curl_errno</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">)) {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; print </span><span class="default">curl_error</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">);
<br />
&nbsp;&nbsp;&nbsp; }
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">curl_close</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">);
<br />
&nbsp;&nbsp;&nbsp; print </span><span class="string">"</span><span class="default">$postResult</span><span class="string">"</span><span class="keyword">;
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="61395""></a>
  <div class="note">
   <strong class="user">luca dot manzo at bbsitalia dot com</strong>
   <a href="#61395" class="date">02-Feb-2006 03:55</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you're getting trouble with cookie handling in curl: 
<br />

<br />
- curl manages tranparently cookies in a single curl session
<br />
- the option 
<br />
<span class="default">&lt;?php curl_setopt</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_COOKIEJAR</span><span class="keyword">, </span><span class="string">"/tmp/cookieFileName"</span><span class="keyword">); </span><span class="default">?&gt;
<br />
</span>
<br />
makes curl to store the cookies in a file at the and of the curl session
<br />

<br />
- the option 
<br />
<span class="default">&lt;?php curl_setopt</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_COOKIEFILE</span><span class="keyword">, </span><span class="string">"/tmp/cookieFileName"</span><span class="keyword">); </span><span class="default">?&gt;
<br />
</span>
<br />
makes curl to use the given file as source for the cookies to send to the server. 
<br />

<br />
so to handle correctly cookies between different curl session, the you have to do something like this:
<br />

<br />
<span class="default">&lt;?php
<br />
&nbsp;&nbsp; &nbsp; &nbsp; $ch </span><span class="keyword">= </span><span class="default">curl_init</span><span class="keyword">(); 
<br />
&nbsp;&nbsp; &nbsp; &nbsp; </span><span class="default">curl_setopt </span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_URL</span><span class="keyword">, </span><span class="default">$url</span><span class="keyword">); 
<br />
&nbsp;&nbsp; &nbsp; &nbsp; </span><span class="default">curl_setopt </span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_COOKIEJAR</span><span class="keyword">, </span><span class="default">COOKIE_FILE_PATH</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp; </span><span class="default">curl_setopt </span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_COOKIEFILE</span><span class="keyword">, </span><span class="default">COOKIE_FILE_PATH</span><span class="keyword">);
<br />

<br />
&nbsp;&nbsp; &nbsp; &nbsp; </span><span class="default">curl_setopt </span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_RETURNTRANSFER</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">); 
<br />
&nbsp;&nbsp; &nbsp; &nbsp; </span><span class="default">$result </span><span class="keyword">= </span><span class="default">curl_exec </span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp; </span><span class="default">curl_close</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp; return </span><span class="default">$result</span><span class="keyword">;
<br />
</span><span class="default">?&gt;
<br />
</span>
<br />
in particular this is NECESSARY if you are using PEAR_SOAP libraries to build a webservice client over https and the remote server need to establish a session cookie. in fact each soap message is sent using a different curl session!!
<br />

<br />
I hope this can help someone
<br />
Luca</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="60142""></a>
  <div class="note">
   <strong class="user">Dustin Hawkins</strong>
   <a href="#60142" class="date">27-Dec-2005 02:24</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
To further expand upon use of CURLOPT_CAPATH and CURLOPT_CAINFO...<br />
<br />
In my case I wanted to prevent curl from talking to any HTTPS server except my own using a self signed certificate. To do this, you'll need openssl installed and access to the HTTPS Server Certificate (server.crt by default on apache)<br />
<br />
You can then use a command simiar to this to translate your apache certificate into one that curl likes.<br />
<br />
$ openssl x509 -in server.crt -out outcert.pem -text<br />
<br />
Then set CURLOPT_CAINFO equal to the the full path to outcert.pem and turn on CURLOPT_SSL_VERIFYPEER.<br />
<br />
If you want to use the CURLOPT_CAPATH option, you should create a directory for all the valid certificates you have created, then use the c_rehash script that is included with openssl to "prepare" the directory.<br />
<br />
If you dont use the c_rehash utility, curl will ignore any file in the directory you set.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="59993""></a>
  <div class="note">
   <strong class="user">skyogre __at__ yandex __dot__ ru</strong>
   <a href="#59993" class="date">22-Dec-2005 02:13</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
There is really a problem of transmitting $_POST data with curl in php 4+ at least.<br />
I improved the encoding function by Alejandro Moreno to work properly with mulltidimensional arrays.<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">function </span><span class="default">data_encode</span><span class="keyword">(</span><span class="default">$data</span><span class="keyword">, </span><span class="default">$keyprefix </span><span class="keyword">= </span><span class="string">""</span><span class="keyword">, </span><span class="default">$keypostfix </span><span class="keyword">= </span><span class="string">""</span><span class="keyword">) {<br />
&nbsp; </span><span class="default">assert</span><span class="keyword">( </span><span class="default">is_array</span><span class="keyword">(</span><span class="default">$data</span><span class="keyword">) );<br />
&nbsp; </span><span class="default">$vars</span><span class="keyword">=</span><span class="default">null</span><span class="keyword">;<br />
&nbsp; foreach(</span><span class="default">$data </span><span class="keyword">as </span><span class="default">$key</span><span class="keyword">=&gt;</span><span class="default">$value</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; if(</span><span class="default">is_array</span><span class="keyword">(</span><span class="default">$value</span><span class="keyword">)) </span><span class="default">$vars </span><span class="keyword">.= </span><span class="default">data_encode</span><span class="keyword">(</span><span class="default">$value</span><span class="keyword">, </span><span class="default">$keyprefix</span><span class="keyword">.</span><span class="default">$key</span><span class="keyword">.</span><span class="default">$keypostfix</span><span class="keyword">.</span><span class="default">urlencode</span><span class="keyword">(</span><span class="string">"["</span><span class="keyword">), </span><span class="default">urlencode</span><span class="keyword">(</span><span class="string">"]"</span><span class="keyword">));<br />
&nbsp;&nbsp;&nbsp; else </span><span class="default">$vars </span><span class="keyword">.= </span><span class="default">$keyprefix</span><span class="keyword">.</span><span class="default">$key</span><span class="keyword">.</span><span class="default">$keypostfix</span><span class="keyword">.</span><span class="string">"="</span><span class="keyword">.</span><span class="default">urlencode</span><span class="keyword">(</span><span class="default">$value</span><span class="keyword">).</span><span class="string">"&amp;"</span><span class="keyword">;<br />
&nbsp; }<br />
&nbsp; return </span><span class="default">$vars</span><span class="keyword">;<br />
}<br />
<br />
</span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_POSTFIELDS</span><span class="keyword">, </span><span class="default">substr</span><span class="keyword">(</span><span class="default">data_encode</span><span class="keyword">(</span><span class="default">$_POST</span><span class="keyword">), </span><span class="default">0</span><span class="keyword">, -</span><span class="default">1</span><span class="keyword">) );<br />
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="58074""></a>
  <div class="note">
   <strong class="user">phpnet at wafflehouse dot de</strong>
   <a href="#58074" class="date">23-Oct-2005 06:34</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Resetting CURLOPT_FILE to STDOUT won't work by calling curl_setopt() with the STDOUT constant or a php://output stream handle (at least I get error messages when trying the code from phpnet at andywaite dot com). Instead, one can simply reset it as a side effect of CURLOPT_RETURNTRANSFER. Just say
<br />

<br />
<span class="default">&lt;?php curl_setopt</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">curl</span><span class="keyword">,</span><span class="default">CURLOPT_RETURNTRANSFER</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">); </span><span class="default">?&gt;
<br />
</span>
<br />
and following calls to curl_exec() will output to STDOUT again.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="57005""></a>
  <div class="note">
   <strong class="user">ROXORT at TGNOOB dot FR</strong>
   <a href="#57005" class="date">21-Sep-2005 07:09</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
<span class="default">&lt;?php
<br />
</span><span class="comment">/*
<br />
&nbsp; Here is a script that is usefull to :
<br />
&nbsp; - login to a POST form,
<br />
&nbsp; - store a session cookie,
<br />
&nbsp; - download a file once logged in.
<br />
*/
<br />

<br />
// INIT CURL
<br />
</span><span class="default">$ch </span><span class="keyword">= </span><span class="default">curl_init</span><span class="keyword">();
<br />

<br />
</span><span class="comment">// SET URL FOR THE POST FORM LOGIN
<br />
</span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_URL</span><span class="keyword">, </span><span class="string">'<a href="http://www.example.com/Members/Login.php" rel="nofollow" target="_blank">http://www.example.com/Members/Login.php</a>'</span><span class="keyword">);
<br />

<br />
</span><span class="comment">// ENABLE HTTP POST
<br />
</span><span class="default">curl_setopt </span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_POST</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">);
<br />

<br />
</span><span class="comment">// SET POST PARAMETERS : FORM VALUES FOR EACH FIELD
<br />
</span><span class="default">curl_setopt </span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_POSTFIELDS</span><span class="keyword">, </span><span class="string">'fieldname1=fieldvalue1&amp;fieldname2=fieldvalue2'</span><span class="keyword">);
<br />

<br />
</span><span class="comment">// IMITATE CLASSIC BROWSER'S BEHAVIOUR : HANDLE COOKIES
<br />
</span><span class="default">curl_setopt </span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_COOKIEJAR</span><span class="keyword">, </span><span class="string">'cookie.txt'</span><span class="keyword">);
<br />

<br />
</span><span class="comment"># Setting CURLOPT_RETURNTRANSFER variable to 1 will force cURL
<br />
# not to print out the results of its query.
<br />
# Instead, it will return the results as a string return value
<br />
# from curl_exec() instead of the usual true/false.
<br />
</span><span class="default">curl_setopt </span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_RETURNTRANSFER</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">);
<br />

<br />
</span><span class="comment">// EXECUTE 1st REQUEST (FORM LOGIN)
<br />
</span><span class="default">$store </span><span class="keyword">= </span><span class="default">curl_exec </span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">);
<br />

<br />
</span><span class="comment">// SET FILE TO DOWNLOAD
<br />
</span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_URL</span><span class="keyword">, </span><span class="string">'<a href="http://www.example.com/Members/Downloads/AnnualReport.pdf" rel="nofollow" target="_blank">http://www.example.com/Members/Downloads/AnnualReport.pdf</a>'</span><span class="keyword">);
<br />

<br />
</span><span class="comment">// EXECUTE 2nd REQUEST (FILE DOWNLOAD)
<br />
</span><span class="default">$content </span><span class="keyword">= </span><span class="default">curl_exec </span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">);
<br />

<br />
</span><span class="comment">// CLOSE CURL
<br />
</span><span class="default">curl_close </span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">); 
<br />

<br />
</span><span class="comment">/*
<br />
&nbsp; At this point you can do do whatever you want
<br />
&nbsp; with the downloaded file stored in $content :
<br />
&nbsp; display it, save it as file, and so on.
<br />
*/
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="53445""></a>
  <div class="note">
   <strong class="user">michaeledwards.com</strong>
   <a href="#53445" class="date">01-Jun-2005 02:57</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Problems can occur if you mix CURLOPT_URL with a 'Host:' header in CURLOPT_HEADERS on redirects because cURL will combine the host you explicitly stated in the 'Host:' header with the host from the Location: header of the redirect response. 
<br />

<br />
In short, don't do this:
<br />

<br />
<span class="default">&lt;?php
<br />
$host </span><span class="keyword">= </span><span class="string">"www.example.com"</span><span class="keyword">;
<br />
</span><span class="default">$url </span><span class="keyword">= </span><span class="string">"<a href="http://" rel="nofollow" target="_blank">http://</a></span><span class="default">$host</span><span class="string">/"</span><span class="keyword">;
<br />

<br />
</span><span class="default">$headers </span><span class="keyword">= array(</span><span class="string">"Host: </span><span class="default">$host</span><span class="string">"</span><span class="keyword">);
<br />

<br />
</span><span class="default">$ch </span><span class="keyword">= </span><span class="default">curl_init</span><span class="keyword">();
<br />

<br />
</span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_URL</span><span class="keyword">, </span><span class="default">$url</span><span class="keyword">);
<br />
</span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_HTTPHEADER</span><span class="keyword">, </span><span class="default">$headers</span><span class="keyword">);
<br />

<br />
Do </span><span class="default">this instead</span><span class="keyword">:
<br />

<br />
</span><span class="default">$host </span><span class="keyword">= </span><span class="string">"www.example.com"</span><span class="keyword">;
<br />
</span><span class="default">$url </span><span class="keyword">= </span><span class="string">"<a href="http://" rel="nofollow" target="_blank">http://</a></span><span class="default">$host</span><span class="string">/"</span><span class="keyword">;
<br />

<br />
</span><span class="default">$ch </span><span class="keyword">= </span><span class="default">curl_init</span><span class="keyword">();
<br />

<br />
</span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_URL</span><span class="keyword">, </span><span class="default">$url</span><span class="keyword">);
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="52675""></a>
  <div class="note">
   <strong class="user">ikendra at yken dot nospam dot org</strong>
   <a href="#52675" class="date">09-May-2005 09:26</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Using cURL, I needed to call a third-party script which was returning binary data as attachment to pass on retrieved data again as attachment.
<br />

<br />
Problem was that the third-party script occassionally returned HTTP errors and I wanted to avoid passing on zero-length attachment in such case.
<br />

<br />
Combination of using CURLOPT_FAILONERROR and CURLOPT_HEADERFUNCTION callback helped to process the third-party script HTTP errors neatly:
<br />

<br />
<span class="default">&lt;?php
<br />
</span><span class="keyword">function </span><span class="default">curlHeaderCallback</span><span class="keyword">(</span><span class="default">$resURL</span><span class="keyword">, </span><span class="default">$strHeader</span><span class="keyword">) {
<br />
&nbsp;&nbsp;&nbsp; if (</span><span class="default">preg_match</span><span class="keyword">(</span><span class="string">'/^HTTP/i'</span><span class="keyword">, </span><span class="default">$strHeader</span><span class="keyword">)) {
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">header</span><span class="keyword">(</span><span class="default">$strHeader</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">header</span><span class="keyword">(</span><span class="string">'Content-Disposition: attachment; filename="file-name.zip"'</span><span class="keyword">);
<br />
&nbsp;&nbsp;&nbsp; }
<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$strHeader</span><span class="keyword">);
<br />
}
<br />

<br />
</span><span class="default">$strURL </span><span class="keyword">= </span><span class="string">'<a href="http://www.example.com/script-whichs-dumps-binary-attachment.php" rel="nofollow" target="_blank">http://www.example.com/script-whichs-dumps-binary-attachment.php</a>'</span><span class="keyword">;
<br />

<br />
</span><span class="default">$resURL </span><span class="keyword">= </span><span class="default">curl_init</span><span class="keyword">();
<br />
</span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$resURL</span><span class="keyword">, </span><span class="default">CURLOPT_URL</span><span class="keyword">, </span><span class="default">$strURL</span><span class="keyword">);
<br />
</span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$resURL</span><span class="keyword">, </span><span class="default">CURLOPT_BINARYTRANSFER</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">);
<br />
</span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$resURL</span><span class="keyword">, </span><span class="default">CURLOPT_HEADERFUNCTION</span><span class="keyword">, </span><span class="string">'curlHeaderCallback'</span><span class="keyword">);
<br />
</span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$resURL</span><span class="keyword">, </span><span class="default">CURLOPT_FAILONERROR</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">);
<br />

<br />
</span><span class="default">curl_exec </span><span class="keyword">(</span><span class="default">$resURL</span><span class="keyword">);
<br />

<br />
</span><span class="default">$intReturnCode </span><span class="keyword">= </span><span class="default">curl_getinfo</span><span class="keyword">(</span><span class="default">$resURL</span><span class="keyword">, </span><span class="default">CURLINFO_HTTP_CODE</span><span class="keyword">);
<br />
</span><span class="default">curl_close </span><span class="keyword">(</span><span class="default">$resURL</span><span class="keyword">);
<br />

<br />
if (</span><span class="default">$intReturnCode </span><span class="keyword">!= </span><span class="default">200</span><span class="keyword">) {
<br />
&nbsp;&nbsp;&nbsp; print </span><span class="string">'was error: ' </span><span class="keyword">. </span><span class="default">$intReturnCode</span><span class="keyword">;
<br />
}
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="42201""></a>
  <div class="note">
   <strong class="user">ron at ttvavanti dot nl</strong>
   <a href="#42201" class="date">07-May-2004 08:00</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you specify a CAINFO, note that the file must be in PEM format! (If not, it won't work).<br />
Using Openssl you can use: <br />
openssl x509 -in &lt;cert&gt; -inform d -outform PEM -out cert.pem <br />
To create a pem formatted certificate from a binary certificate (the one you get if you download the ca somewhere).</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="37530""></a>
  <div class="note">
   <strong class="user">tim dot php at ebw dot ca</strong>
   <a href="#37530" class="date">18-Nov-2003 06:18</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
The page <a href="http://curl.haxx.se/libcurl/c/curl_easy_setopt.html at the cURL site has a list of all the CURLOPTS, including many not mentioned here. Also see http://curl.haxx.se/libcurl/php/examples/ for cURL examples in PHP." rel="nofollow" target="_blank">http://curl.haxx.se/libcurl/c/curl_easy_setopt.html at the cURL site has a list of all the CURLOPTS, including many not mentioned here. Also see http://curl.haxx.se/libcurl/php/examples/ for cURL examples in PHP.</a></span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="30906""></a>
  <div class="note">
   <strong class="user">dweingart at pobox dot com</strong>
   <a href="#30906" class="date">02-Apr-2003 03:08</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you want to Curl to follow redirects and you would also like Curl to echo back any cookies that are set in the process, use this:
<br />

<br />
<span class="default">&lt;?php curl_setopt</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_COOKIEJAR</span><span class="keyword">, </span><span class="string">'-'</span><span class="keyword">); </span><span class="default">?&gt;
<br />
</span>
<br />
'-' means stdout
<br />

<br />
-dw</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="26797""></a>
  <div class="note">
   <strong class="user">yann dot corno at free dot fr</strong>
   <a href="#26797" class="date">13-Nov-2002 04:19</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
About the CURLOPT_HTTPHEADER option, it took me some time to figure out how to format the so-called 'Array'. It fact, it is a list of strings. If Curl was already defining a header item, yours will replace it. Here is an example to change the Content Type in a POST:
<br />

<br />
<span class="default">&lt;?php curl_setopt </span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_HTTPHEADER</span><span class="keyword">, Array(</span><span class="string">"Content-Type: text/xml"</span><span class="keyword">)); </span><span class="default">?&gt;
<br />
</span>
<br />
Yann</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
</div>
</div>
</div></div></body></html>
