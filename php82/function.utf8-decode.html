<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
 <head>
  <meta http-equiv="content-type" content="text/html; CHARSET=UTF-8">
  <title>将字符串从 UTF-8 转换为 ISO-8859-1，替换无效或者无法表示的字符。</title>
<link media="all" rel="stylesheet" type="text/css" href="styles/03e73060321a0a848018724a6c83de7f-theme-base.css" />
<link media="all" rel="stylesheet" type="text/css" href="styles/03e73060321a0a848018724a6c83de7f-theme-medium.css" />

  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <link media="all" rel="stylesheet" type="text/css" href="style.css"/>
 </head>
 <body class="docs" class="docs"><div class="navbar navbar-fixed-top">
  <div class="navbar-inner clearfix">
    <ul class="nav" style="width: 100%">
      <li style="float: left;"><a href="function.ucwords.html">? ucwords</a></li>
      <li style="float: right;"><a href="function.utf8-encode.html">utf8_encode ?</a></li>
    </ul>
  </div>
</div>
<div id="breadcrumbs" class="clearfix">
  <ul class="breadcrumbs-container">
    <li><a href="index.html">PHP Manual</a></li>
    <li><a href="ref.strings.html">字符串 函数</a></li>
    <li>将字符串从 UTF-8 转换为 ISO-8859-1，替换无效或者无法表示的字符。</li>
  </ul>
</div>
<div id="layout">
  <div id="layout-content"><div id="function.utf8-decode" class="refentry">
 <div class="refnamediv">
  <h1 class="refname">utf8_decode</h1> 
  <p class="verinfo">(PHP 4, PHP 5, PHP 7, PHP 8)</p><p class="refpurpose"><span class="refname">utf8_decode</span> &mdash; <span class="dc-title">
   将字符串从 UTF-8 转换为 ISO-8859-1，替换无效或者无法表示的字符。
  </span></p>

 </div>

 <div id="function.utf8-decode-refsynopsisdiv">
  <div class="warning"><strong class="warning">Warning</strong><p class="simpara">此函数自 PHP 8.2.0
起<em class="emphasis">弃用</em>。强烈建议不要应用此函数。</p></div>
 </div>

 <div class="refsect1 description" id="refsect1-function.utf8-decode-description">
  <h3 class="title">说明</h3>
  <div class="methodsynopsis dc-description">
   <span class="methodname"><strong>utf8_decode</strong></span>(<span class="methodparam"><span class="type">string</span> <code class="parameter">$string</code></span>): <span class="type">string</span></div>

  <p class="para rdfs-comment">
   该函数将字符串 <code class="parameter">string</code> 从 <code class="literal">UTF-8</code> 编码转换为
   <code class="literal">ISO-8859-1</code>。字符串中不是有效 UTF-8 字节或者不存在于 <code class="literal">ISO-8859-1</code>
   的 <code class="literal">UTF-8</code> 字符（即 <code class="literal">U+00FF</code> 以上的码点）将转化为 <code class="literal">?</code>。
  </p>

  <blockquote class="note"><p><strong class="note">Note</strong>: 
   <p class="para">
    Many web pages marked as using the <code class="literal">ISO-8859-1</code> character
    encoding actually use the similar <code class="literal">Windows-1252</code> encoding,
    and web browsers will interpret <code class="literal">ISO-8859-1</code> web pages as
    <code class="literal">Windows-1252</code>. <code class="literal">Windows-1252</code> features
    additional printable characters, such as the Euro sign
    (<code class="literal">€</code>) and curly quotes (<code class="literal">"</code>
    <code class="literal">"</code>), instead of certain <code class="literal">ISO-8859-1</code>
    control characters. This function will not convert such
    <code class="literal">Windows-1252</code> characters correctly. Use a different
    function if <code class="literal">Windows-1252</code> conversion is required.
   </p>
  </p></blockquote>
 </div>


 <div class="refsect1 parameters" id="refsect1-function.utf8-decode-parameters">
  <h3 class="title">参数</h3>
  <p class="para">
   <dl>
    
     <dt>
<code class="parameter">string</code></dt>

     <dd>

      <p class="para">
       UTF-8 编码的字符串。
      </p>
     </dd>

    
   </dl>

  </p>
 </div>


 <div class="refsect1 returnvalues" id="refsect1-function.utf8-decode-returnvalues">
  <h3 class="title">返回值</h3>
  <p class="para">
   返回 <code class="parameter">string</code> 的 ISO-8859-1 翻译。
  </p>
 </div>


 <div class="refsect1 changelog" id="refsect1-function.utf8-decode-changelog">
  <h3 class="title">更新日志</h3>
  <p class="para">
   <table class="doctable informaltable">
    
     <thead>
      <tr>
       <th>版本</th>
       <th>说明</th>
      </tr>

     </thead>

     <tbody class="tbody">
      <tr>
       <td>8.2.0</td>
       <td>
        弃用此函数。
       </td>
      </tr>

      <tr>
       <td>7.2.0</td>
       <td>
        This function has been moved from the XML extension to the core of PHP.
        In previous versions, it was only available if the XML extension was installed.
       </td>
      </tr>

     </tbody>
    
   </table>

  </p>
 </div>


 <div class="refsect1 examples" id="refsect1-function.utf8-decode-examples">
  <h3 class="title">示例</h3>
  <div class="example" id="">
   <p><strong>Example #1 基础示例</strong></p>
   <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br /></span><span style="color: #FF8000">// Convert the string 'Zo?' from UTF-8 to ISO 8859-1<br /></span><span style="color: #0000BB">$utf8_string </span><span style="color: #007700">= </span><span style="color: #DD0000">"\x5A\x6F\xC3\xAB"</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">$iso8859_1_string </span><span style="color: #007700">= </span><span style="color: #0000BB">utf8_decode</span><span style="color: #007700">(</span><span style="color: #0000BB">$utf8_string</span><span style="color: #007700">);<br />echo </span><span style="color: #0000BB">bin2hex</span><span style="color: #007700">(</span><span style="color: #0000BB">$iso8859_1_string</span><span style="color: #007700">), </span><span style="color: #DD0000">"\n"</span><span style="color: #007700">;<br /><br /></span><span style="color: #FF8000">// Invalid UTF-8 sequences are replaced with '?'<br /></span><span style="color: #0000BB">$invalid_utf8_string </span><span style="color: #007700">= </span><span style="color: #DD0000">"\xC3"</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">$iso8859_1_string </span><span style="color: #007700">= </span><span style="color: #0000BB">utf8_decode</span><span style="color: #007700">(</span><span style="color: #0000BB">$invalid_utf8_string</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">var_dump</span><span style="color: #007700">(</span><span style="color: #0000BB">$iso8859_1_string</span><span style="color: #007700">);<br /><br /></span><span style="color: #FF8000">// Characters which don't exist in ISO 8859-1, such as<br />// '€' (Euro Sign) are also replaced with '?'<br /></span><span style="color: #0000BB">$utf8_string </span><span style="color: #007700">= </span><span style="color: #DD0000">"\xE2\x82\xAC"</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">$iso8859_1_string </span><span style="color: #007700">= </span><span style="color: #0000BB">utf8_decode</span><span style="color: #007700">(</span><span style="color: #0000BB">$utf8_string</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">var_dump</span><span style="color: #007700">(</span><span style="color: #0000BB">$iso8859_1_string</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
   </div>

   <div class="example-contents"><p>以上示例会输出：</p></div>
   <div class="example-contents screen">
<div class="cdata"><pre>
5a6feb
string(1) &quot;?&quot;
string(1) &quot;?&quot;
</pre></div>
   </div>
  </div>
 </div>


 <div class="refsect1 notes" id="refsect1-function.utf8-decode-notes">
  <h3 class="title">注释</h3>
  <blockquote class="note"><p><strong class="note">Note</strong>: 
   <strong>弃用和替代方案</strong><br />
   <p class="para">
    从 PHP 8.2.0 开始，<em class="emphasis">弃用</em>此函数，并将在未来的版本中删除。应检查现有用途并用适当的替代方案。
   </p>
   <p class="para">
    类似的功能可以通过 <span class="function"><a href="function.mb-convert-encoding.html" class="function">mb_convert_encoding()</a></span> 实现，支持 ISO-8859-1 和许多其他字符编码。
    <div class="informalexample">
     <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br />$utf8_string </span><span style="color: #007700">= </span><span style="color: #DD0000">"\xC3\xAB"</span><span style="color: #007700">; </span><span style="color: #FF8000">// '?' (e with diaeresis) in UTF-8<br /></span><span style="color: #0000BB">$iso8859_1_string </span><span style="color: #007700">= </span><span style="color: #0000BB">mb_convert_encoding</span><span style="color: #007700">(</span><span style="color: #0000BB">$utf8_string</span><span style="color: #007700">, </span><span style="color: #DD0000">'ISO-8859-1'</span><span style="color: #007700">, </span><span style="color: #DD0000">'UTF-8'</span><span style="color: #007700">);<br />echo </span><span style="color: #0000BB">bin2hex</span><span style="color: #007700">(</span><span style="color: #0000BB">$iso8859_1_string</span><span style="color: #007700">), </span><span style="color: #DD0000">"\n"</span><span style="color: #007700">;<br /><br /></span><span style="color: #0000BB">$utf8_string </span><span style="color: #007700">= </span><span style="color: #DD0000">"\xCE\xBB"</span><span style="color: #007700">; </span><span style="color: #FF8000">// 'λ' (Greek lower-case lambda) in UTF-8<br /></span><span style="color: #0000BB">$iso8859_7_string </span><span style="color: #007700">= </span><span style="color: #0000BB">mb_convert_encoding</span><span style="color: #007700">(</span><span style="color: #0000BB">$utf8_string</span><span style="color: #007700">, </span><span style="color: #DD0000">'ISO-8859-7'</span><span style="color: #007700">, </span><span style="color: #DD0000">'UTF-8'</span><span style="color: #007700">);<br />echo </span><span style="color: #0000BB">bin2hex</span><span style="color: #007700">(</span><span style="color: #0000BB">$iso8859_7_string</span><span style="color: #007700">), </span><span style="color: #DD0000">"\n"</span><span style="color: #007700">;<br /><br /></span><span style="color: #0000BB">$utf8_string </span><span style="color: #007700">= </span><span style="color: #DD0000">"\xE2\x82\xAC"</span><span style="color: #007700">; </span><span style="color: #FF8000">// '€' (Euro sign) in UTF-8 (not present in ISO-8859-1)<br /></span><span style="color: #0000BB">$windows_1252_string </span><span style="color: #007700">= </span><span style="color: #0000BB">mb_convert_encoding</span><span style="color: #007700">(</span><span style="color: #0000BB">$utf8_string</span><span style="color: #007700">, </span><span style="color: #DD0000">'Windows-1252'</span><span style="color: #007700">, </span><span style="color: #DD0000">'UTF-8'</span><span style="color: #007700">);<br />echo </span><span style="color: #0000BB">bin2hex</span><span style="color: #007700">(</span><span style="color: #0000BB">$windows_1252_string</span><span style="color: #007700">), </span><span style="color: #DD0000">"\n"</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
     </div>

     <p class="para">以上示例会输出：</p>
     <div class="example-contents screen">
<div class="cdata"><pre>
eb
eb
80
</pre></div>
     </div>
    </div>
   </p>
   <p class="para">
    根据安装的扩展，其他有效选项是
    <span class="methodname"><a href="uconverter.transcode.html" class="methodname">UConverter::transcode()</a></span> 和 <span class="function"><a href="function.iconv.html" class="function">iconv()</a></span>。
   </p>
   <p class="para">
    以下都给出相同的结果：
    <div class="informalexample">
     <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br />$utf8_string </span><span style="color: #007700">= </span><span style="color: #DD0000">"\x5A\x6F\xC3\xAB"</span><span style="color: #007700">; </span><span style="color: #FF8000">// 'Zo?' in UTF-8<br /></span><span style="color: #0000BB">$iso8859_1_string </span><span style="color: #007700">= </span><span style="color: #0000BB">utf8_decode</span><span style="color: #007700">(</span><span style="color: #0000BB">$utf8_string</span><span style="color: #007700">);<br />echo </span><span style="color: #0000BB">bin2hex</span><span style="color: #007700">(</span><span style="color: #0000BB">$iso8859_1_string</span><span style="color: #007700">), </span><span style="color: #DD0000">"\n"</span><span style="color: #007700">;<br /><br /></span><span style="color: #0000BB">$iso8859_1_string </span><span style="color: #007700">= </span><span style="color: #0000BB">mb_convert_encoding</span><span style="color: #007700">(</span><span style="color: #0000BB">$utf8_string</span><span style="color: #007700">, </span><span style="color: #DD0000">'ISO-8859-1'</span><span style="color: #007700">, </span><span style="color: #DD0000">'UTF-8'</span><span style="color: #007700">);<br />echo </span><span style="color: #0000BB">bin2hex</span><span style="color: #007700">(</span><span style="color: #0000BB">$iso8859_1_string</span><span style="color: #007700">), </span><span style="color: #DD0000">"\n"</span><span style="color: #007700">;<br /><br /></span><span style="color: #0000BB">$iso8859_1_string </span><span style="color: #007700">= </span><span style="color: #0000BB">iconv</span><span style="color: #007700">(</span><span style="color: #DD0000">'UTF-8'</span><span style="color: #007700">, </span><span style="color: #DD0000">'ISO-8859-1'</span><span style="color: #007700">, </span><span style="color: #0000BB">$utf8_string</span><span style="color: #007700">);<br />echo </span><span style="color: #0000BB">bin2hex</span><span style="color: #007700">(</span><span style="color: #0000BB">$iso8859_1_string</span><span style="color: #007700">), </span><span style="color: #DD0000">"\n"</span><span style="color: #007700">;<br /><br /></span><span style="color: #0000BB">$iso8859_1_string </span><span style="color: #007700">= </span><span style="color: #0000BB">UConverter</span><span style="color: #007700">::</span><span style="color: #0000BB">transcode</span><span style="color: #007700">(</span><span style="color: #0000BB">$utf8_string</span><span style="color: #007700">, </span><span style="color: #DD0000">'ISO-8859-1'</span><span style="color: #007700">, </span><span style="color: #DD0000">'UTF8'</span><span style="color: #007700">);<br />echo </span><span style="color: #0000BB">bin2hex</span><span style="color: #007700">(</span><span style="color: #0000BB">$iso8859_1_string</span><span style="color: #007700">), </span><span style="color: #DD0000">"\n"</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
     </div>

     <p class="para">以上示例会输出：</p>
     <div class="example-contents screen">
<div class="cdata"><pre>
5a6feb
5a6feb
5a6feb
5a6feb
</pre></div>
     </div>
    </div>
    针对无效的字符串或者不能用 ISO 8859-1 表示的字符串，指定 <code class="literal">&#039;?&#039;</code> 作为
    <span class="methodname"><a href="uconverter.transcode.html" class="methodname">UConverter::transcode()</a></span> 的 <code class="literal">&#039;to_subst&#039;</code>
    选项，将获得同 <span class="function"><strong>utf8_decode()</strong></span> 相同的结果。
    <div class="informalexample">
     <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br />$utf8_string </span><span style="color: #007700">= </span><span style="color: #DD0000">"\xE2\x82\xAC"</span><span style="color: #007700">; </span><span style="color: #FF8000">// € (Euro Sign) does not exist in ISO 8859-1<br /></span><span style="color: #0000BB">$iso8859_1_string </span><span style="color: #007700">= </span><span style="color: #0000BB">UConverter</span><span style="color: #007700">::</span><span style="color: #0000BB">transcode</span><span style="color: #007700">(<br />    </span><span style="color: #0000BB">$utf8_string</span><span style="color: #007700">, </span><span style="color: #DD0000">'ISO-8859-1'</span><span style="color: #007700">, </span><span style="color: #DD0000">'UTF-8'</span><span style="color: #007700">, [</span><span style="color: #DD0000">'to_subst' </span><span style="color: #007700">=&gt; </span><span style="color: #DD0000">'?'</span><span style="color: #007700">]<br />);<br /></span><span style="color: #0000BB">var_dump</span><span style="color: #007700">(</span><span style="color: #0000BB">$iso8859_1_string</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
     </div>

     <p class="para">以上示例会输出：</p>
     <div class="example-contents screen">
<div class="cdata"><pre>
sring(1) &quot;?&quot;
</pre></div>
     </div>
    </div>
   </p>
  </p></blockquote>
 </div>


 <div class="refsect1 seealso" id="refsect1-function.utf8-decode-seealso">
  <h3 class="title">参见</h3>
  <p class="para">
   <ul class="simplelist">
    <li class="member"><span class="function"><a href="function.utf8-encode.html" class="function" rel="rdfs-seeAlso">utf8_encode()</a> - 将字符串从 ISO-8859-1 转换为 UTF-8 编码</span></li>
    <li class="member"><span class="function"><a href="function.mb-convert-encoding.html" class="function" rel="rdfs-seeAlso">mb_convert_encoding()</a> - 转换字符串，从一个字符编码到另一个字符编码</span></li>
    <li class="member"><span class="methodname"><a href="uconverter.transcode.html" class="methodname" rel="rdfs-seeAlso">UConverter::transcode()</a> - Convert a string from one character encoding to another</span></li>
    <li class="member"><span class="function"><a href="function.iconv.html" class="function" rel="rdfs-seeAlso">iconv()</a> - 将字符串从一个字符编码转换到另一个字符编码</span></li>
   </ul>
  </p>
 </div>


</div><div id="usernotes">
 <div class="head">
  <h3 class="title">User Contributed Notes</h3>
 </div>
<div id="allnotes">  <a name="128345""></a>
  <div class="note">
   <strong class="user">jamalmarlone at gmail dot com</strong>
   <a href="#128345" class="date">29-Mar-2023 11:33</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
$string = "Bj??rn Johansen";<br />
<br />
echo mb_convert_encoding($string, 'ISO-8859-1', 'UTF-8');<br />
<br />
----<br />
prints: "Bj?rn Johansen"</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="121290""></a>
  <div class="note">
   <strong class="user">Aleksandr</strong>
   <a href="#121290" class="date">30-Jun-2017 02:46</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
In addition to note by yannikh at gmeil dot com, another way to decode strings with non-latin chars from unix console like<br />
<br />
C=RU, L=\xD0\x9C\xD0\xBE\xD1\x81\xD0\xBA\xD0\xB2\xD0\xB0,<br />
<br />
<span class="default">&lt;?php preg_replace_callback</span><span class="keyword">(</span><span class="string">'/\\\\x([0-9A-F]{2})/'</span><span class="keyword">, function(</span><span class="default">$a</span><span class="keyword">){ return </span><span class="default">pack</span><span class="keyword">(</span><span class="string">'H*'</span><span class="keyword">, </span><span class="default">$a</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">]); }, </span><span class="default">$str</span><span class="keyword">); </span><span class="default">?&gt;<br />
</span><br />
The code above will output:<br />
C=RU, L=Москва,</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="119280""></a>
  <div class="note">
   <strong class="user">kode68</strong>
   <a href="#119280" class="date">02-May-2016 06:09</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Update Answer from okx dot oliver dot koenig at gmail dot com for PHP 5.6 since e/ modifier is depreciated<br />
<br />
// This finally helped me to do the job, thanks to Blackbit, had to modify deprecated ereg:<br />
// original comment: "Squirrelmail contains a nice function in the sources to convert unicode to entities:"<br />
<br />
function charset_decode_utf_8($string)<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; /* Only do the slow convert if there are 8-bit characters */<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if ( !preg_match("/[\200-\237]/", $string) &amp;&amp; !preg_match("/[\241-\377]/", $string) )<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return $string;<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; // decode three byte unicode characters<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $string = preg_replace_callback("/([\340-\357])([\200-\277])([\200-\277])/",<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; create_function ('$matches', 'return \'&amp;#\'.((ord($matches[1])-224)*4096+(ord($matches[2])-128)*64+(ord($matches[3])-128)).\';\';'),<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $string);<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; // decode two byte unicode characters<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $string = preg_replace_callback("/([\300-\337])([\200-\277])/",<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; create_function ('$matches', 'return \'&amp;#\'.((ord($matches[1])-192)*64+(ord($matches[2])-128)).\';\';'),<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $string);<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return $string;<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
Enjoy</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="116671""></a>
  <div class="note">
   <strong class="user">okx dot oliver dot koenig at gmail dot com</strong>
   <a href="#116671" class="date">08-Feb-2015 11:48</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
// This finally helped me to do the job, thanks to Blackbit, had to modify deprecated ereg:<br />
// original comment: "Squirrelmail contains a nice function in the sources to convert unicode to entities:"<br />
<br />
function charset_decode_utf_8 ($string) {<br />
&nbsp;&nbsp;&nbsp; /* Only do the slow convert if there are 8-bit characters */<br />
&nbsp;&nbsp;&nbsp; /* avoid using 0xA0 (\240) in ereg ranges. RH73 does not like that */<br />
&nbsp;&nbsp;&nbsp; if (!preg_match("/[\200-\237]/", $string)<br />
&nbsp;&nbsp; &nbsp; &amp;&amp; !preg_match("/[\241-\377]/", $string)<br />
&nbsp;&nbsp;&nbsp; ) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return $string;<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp;&nbsp; // decode three byte unicode characters<br />
&nbsp;&nbsp;&nbsp; $string = preg_replace("/([\340-\357])([\200-\277])([\200-\277])/e",<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; "'&amp;#'.((ord('\\1')-224)*4096 + (ord('\\2')-128)*64 + (ord('\\3')-128)).';'",<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $string<br />
&nbsp;&nbsp;&nbsp; );<br />
<br />
&nbsp;&nbsp;&nbsp; // decode two byte unicode characters<br />
&nbsp;&nbsp;&nbsp; $string = preg_replace("/([\300-\337])([\200-\277])/e",<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; "'&amp;#'.((ord('\\1')-192)*64+(ord('\\2')-128)).';'",<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $string<br />
&nbsp;&nbsp;&nbsp; );<br />
<br />
&nbsp;&nbsp;&nbsp; return $string;<br />
}</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="116271""></a>
  <div class="note">
   <strong class="user">sashott at gmail dot com</strong>
   <a href="#116271" class="date">04-Dec-2014 11:57</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Use of utf8_decode was not enough for me by get page content from another site. Problem appear by different alphabet from standard latin. As example some chars (corresponding to HTML codes &amp;bdquo; , &amp;nbsp; and others) are converted to "?" or "xA0" (hex value). You need to make some conversion before execute utf8_decode. And you can not replace simple, that they can be part of 2 bytes code for a char (UTF-8 use 2 bytes). Next is for cyrillic alphabet, but for other must be very close.<br />
<br />
function convertMethod($text){<br />
&nbsp;&nbsp;&nbsp; //Problem is that utf8_decode convert HTML chars for &amp;bdquo; and other to ? or &amp;nbsp; to \xA0. And you can not replace, that they are in some char bytes and you broke cyrillic (or other alphabet) chars.<br />
&nbsp;&nbsp;&nbsp; $problem_enc=array(<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; 'euro',<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; 'sbquo',<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; 'bdquo',<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; 'hellip',<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; 'dagger',<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; 'Dagger',<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; 'permil',<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; 'lsaquo',<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; 'lsquo',<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; 'rsquo',<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; 'ldquo',<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; 'rdquo',<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; 'bull',<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; 'ndash',<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; 'mdash',<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; 'trade',<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; 'rsquo',<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; 'brvbar',<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; 'copy',<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; 'laquo',<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; 'reg',<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; 'plusmn',<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; 'micro',<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; 'para',<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; 'middot',<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; 'raquo',<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; 'nbsp'<br />
&nbsp;&nbsp;&nbsp; );<br />
&nbsp;&nbsp;&nbsp; $text=mb_convert_encoding($text,'HTML-ENTITIES','UTF-8');<br />
&nbsp;&nbsp;&nbsp; $text=preg_replace('#(?&lt;!\&amp;ETH;)\&amp;('.implode('|',$problem_enc).');#s','--amp{$1}',$text);<br />
&nbsp;&nbsp;&nbsp; $text=mb_convert_encoding($text,'UTF-8','HTML-ENTITIES');<br />
&nbsp;&nbsp;&nbsp; $text=utf8_decode($text);<br />
&nbsp;&nbsp;&nbsp; $text=mb_convert_encoding($text,'HTML-ENTITIES','UTF-8');<br />
&nbsp;&nbsp;&nbsp; $text=preg_replace('#\-\-amp\{([^\}]+)\}#su','&amp;$1;',$text);<br />
&nbsp;&nbsp;&nbsp; $text=mb_convert_encoding($text,'UTF-8','HTML-ENTITIES');<br />
&nbsp;&nbsp;&nbsp; return $text;<br />
}<br />
<br />
If this don't work, try to set "die($text);" on some places to look, what is happen to this row. Is better to test with long text. It is very possible to broke other alphabet character. In this case, it is very possible, that for you alphabet set "&amp;ETH;" is not the right one. You need to set "die($text);" after this preg_replace and look HTML code for character before set "--amp".</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="110494""></a>
  <div class="note">
   <strong class="user">christoffer</strong>
   <a href="#110494" class="date">29-Oct-2012 10:35</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
The preferred way to use this on an array would be with the built in PHP function "array_map()", as for example:<br />
$array = array_map("utf8_decode", $array);</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="104907""></a>
  <div class="note">
   <strong class="user">deceze at gmail dot com</strong>
   <a href="#104907" class="date">14-Jul-2011 07:01</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Please note that utf8_decode simply converts a string encoded in UTF-8 to ISO-8859-1. A more appropriate name for it would be utf8_to_iso88591. If your text is already encoded in ISO-8859-1, you do not need this function. If you don't want to use ISO-8859-1, you do not need this function.<br />
<br />
Note that UTF-8 can represent many more characters than ISO-8859-1. Trying to convert a UTF-8 string that contains characters that can't be represented in ISO-8859-1 to ISO-8859-1 will garble your text and/or cause characters to go missing. Trying to convert text that is not encoded in UTF-8 using this function will most likely garble the text.<br />
<br />
If you need to convert any text from any encoding to any other encoding, look at iconv() instead.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="104379""></a>
  <div class="note">
   <strong class="user">gabriel arobase gabsoftware dot com</strong>
   <a href="#104379" class="date">12-Jun-2011 08:41</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you want to retrieve some UTF-8 data from your database, you don't need utf8_decode().<br />
<br />
Simply do the following query before any SELECT :<br />
<br />
$result = mysql_query("SET NAMES utf8");</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="88488""></a>
  <div class="note">
   <strong class="user">info at vanylla dot it</strong>
   <a href="#88488" class="date">26-Jan-2009 12:21</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
IMPORTANT: when converting UTF8 data that contains the EURO sign DON'T USE utf_decode function.<br />
<br />
utf_decode converts the data into ISO-8859-1 charset. But ISO-8859-1 charset does not contain the EURO sign, therefor the EURO sign will be converted into a question mark character '?'<br />
<br />
In order to convert properly UTF8 data with EURO sign you must use:<br />
<br />
iconv("UTF-8", "CP1252", $data)</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="85034""></a>
  <div class="note">
   <strong class="user">Blackbit</strong>
   <a href="#85034" class="date">12-Aug-2008 04:40</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Squirrelmail contains a nice function in the sources to convert unicode to entities:
<br />

<br />
<span class="default">&lt;?php
<br />
</span><span class="keyword">function </span><span class="default">charset_decode_utf_8 </span><span class="keyword">(</span><span class="default">$string</span><span class="keyword">) {
<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="comment">/* Only do the slow convert if there are 8-bit characters */
<br />
&nbsp;&nbsp;&nbsp; /* avoid using 0xA0 (\240) in ereg ranges. RH73 does not like that */
<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">if (! </span><span class="default">ereg</span><span class="keyword">(</span><span class="string">"[\200-\237]"</span><span class="keyword">, </span><span class="default">$string</span><span class="keyword">) and ! </span><span class="default">ereg</span><span class="keyword">(</span><span class="string">"[\241-\377]"</span><span class="keyword">, </span><span class="default">$string</span><span class="keyword">))
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">$string</span><span class="keyword">;
<br />

<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// decode three byte unicode characters
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$string </span><span class="keyword">= </span><span class="default">preg_replace</span><span class="keyword">(</span><span class="string">"/([\340-\357])([\200-\277])([\200-\277])/e"</span><span class="keyword">,&nbsp; &nbsp; &nbsp; &nbsp; \
<br />
&nbsp;&nbsp;&nbsp; </span><span class="string">"'&amp;#'.((ord('\\1')-224)*4096 + (ord('\\2')-128)*64 + (ord('\\3')-128)).';'"</span><span class="keyword">,&nbsp; &nbsp; \
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$string</span><span class="keyword">);
<br />

<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// decode two byte unicode characters
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$string </span><span class="keyword">= </span><span class="default">preg_replace</span><span class="keyword">(</span><span class="string">"/([\300-\337])([\200-\277])/e"</span><span class="keyword">, \
<br />
&nbsp;&nbsp;&nbsp; </span><span class="string">"'&amp;#'.((ord('\\1')-192)*64+(ord('\\2')-128)).';'"</span><span class="keyword">, \
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$string</span><span class="keyword">);
<br />

<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">$string</span><span class="keyword">;
<br />
}
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="84031""></a>
  <div class="note">
   <strong class="user">punchivan at gmail dot com</strong>
   <a href="#84031" class="date">24-Jun-2008 02:13</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
EY! the bug is not in the function 'utf8_decode'. The bug is in the function 'mb_detect_encoding'. If you put a word with a special char at the end like this 'accentué', that will lead to a wrong result (UTF-8) but if you put another char at the end like this 'accentuée' you will get it right. So you should always add a ISO-8859-1 character to your string for this check. My advise is to use a blank space.<br />
I′ve tried it and it works! <br />
<br />
function ISO_convert($array)<br />
{<br />
&nbsp;&nbsp;&nbsp; $array_temp = array();<br />
&nbsp;&nbsp; &nbsp; <br />
&nbsp;&nbsp;&nbsp; foreach($array as $name =&gt; $value)<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if(is_array($value))<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $array_temp[(mb_detect_encoding($name." ",'UTF-8,ISO-8859-1') == 'UTF-8' ? utf8_decode($name) : $name )] = ISO_convert($value);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; else<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $array_temp[(mb_detect_encoding($name." ",'UTF-8,ISO-8859-1') == 'UTF-8' ? utf8_decode($name) : $name )] = (mb_detect_encoding($value." ",'UTF-8,ISO-8859-1') == 'UTF-8' ? utf8_decode($value) : $value );<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp;&nbsp; return $array_temp; <br />
}</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="83051""></a>
  <div class="note">
   <strong class="user">haugas at gmail dot com</strong>
   <a href="#83051" class="date">08-May-2008 02:11</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you don't know exactly, how many times your string is encoded, you can use this function:<br />
<br />
<span class="default">&lt;?php<br />
<br />
</span><span class="keyword">function </span><span class="default">_utf8_decode</span><span class="keyword">(</span><span class="default">$string</span><span class="keyword">)<br />
{<br />
&nbsp; </span><span class="default">$tmp </span><span class="keyword">= </span><span class="default">$string</span><span class="keyword">;<br />
&nbsp; </span><span class="default">$count </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;<br />
&nbsp; while (</span><span class="default">mb_detect_encoding</span><span class="keyword">(</span><span class="default">$tmp</span><span class="keyword">)==</span><span class="string">"UTF-8"</span><span class="keyword">)<br />
&nbsp; {<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$tmp </span><span class="keyword">= </span><span class="default">utf8_decode</span><span class="keyword">(</span><span class="default">$tmp</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$count</span><span class="keyword">++;<br />
&nbsp; }<br />
&nbsp; <br />
&nbsp; for (</span><span class="default">$i </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">; </span><span class="default">$i </span><span class="keyword">&lt; </span><span class="default">$count</span><span class="keyword">-</span><span class="default">1 </span><span class="keyword">; </span><span class="default">$i</span><span class="keyword">++)<br />
&nbsp; {<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$string </span><span class="keyword">= </span><span class="default">utf8_decode</span><span class="keyword">(</span><span class="default">$string</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp; }<br />
&nbsp; return </span><span class="default">$string</span><span class="keyword">;<br />
&nbsp; <br />
}<br />
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="81599""></a>
  <div class="note">
   <strong class="user">lukasz dot mlodzik at gmail dot com</strong>
   <a href="#81599" class="date">05-Mar-2008 04:46</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Update to MARC13 function utf2iso()<br />
I'm using it to handle AJAX POST calls. <br />
Despite using <br />
http.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded'; charset='utf-8'); <br />
it still code Polish letters using UTF-16<br />
<br />
This is only for Polish letters:<br />
&nbsp;<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">function </span><span class="default">utf16_2_utf8 </span><span class="keyword">(</span><span class="default">$nowytekst</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$nowytekst </span><span class="keyword">= </span><span class="default">str_replace</span><span class="keyword">(</span><span class="string">'%u0104'</span><span class="keyword">,</span><span class="string">'?'</span><span class="keyword">,</span><span class="default">$nowytekst</span><span class="keyword">);&nbsp; &nbsp; </span><span class="comment">//?<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$nowytekst </span><span class="keyword">= </span><span class="default">str_replace</span><span class="keyword">(</span><span class="string">'%u0106'</span><span class="keyword">,</span><span class="string">'?'</span><span class="keyword">,</span><span class="default">$nowytekst</span><span class="keyword">);&nbsp; &nbsp; </span><span class="comment">//?<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$nowytekst </span><span class="keyword">= </span><span class="default">str_replace</span><span class="keyword">(</span><span class="string">'%u0118'</span><span class="keyword">,</span><span class="string">'?'</span><span class="keyword">,</span><span class="default">$nowytekst</span><span class="keyword">);&nbsp; &nbsp; </span><span class="comment">//?<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$nowytekst </span><span class="keyword">= </span><span class="default">str_replace</span><span class="keyword">(</span><span class="string">'%u0141'</span><span class="keyword">,</span><span class="string">'?'</span><span class="keyword">,</span><span class="default">$nowytekst</span><span class="keyword">);&nbsp; &nbsp; </span><span class="comment">//?<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$nowytekst </span><span class="keyword">= </span><span class="default">str_replace</span><span class="keyword">(</span><span class="string">'%u0143'</span><span class="keyword">,</span><span class="string">'?'</span><span class="keyword">,</span><span class="default">$nowytekst</span><span class="keyword">);&nbsp; &nbsp; </span><span class="comment">//?<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$nowytekst </span><span class="keyword">= </span><span class="default">str_replace</span><span class="keyword">(</span><span class="string">'%u00D3'</span><span class="keyword">,</span><span class="string">'ó'</span><span class="keyword">,</span><span class="default">$nowytekst</span><span class="keyword">);&nbsp; &nbsp; </span><span class="comment">//ó<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$nowytekst </span><span class="keyword">= </span><span class="default">str_replace</span><span class="keyword">(</span><span class="string">'%u015A'</span><span class="keyword">,</span><span class="string">'?'</span><span class="keyword">,</span><span class="default">$nowytekst</span><span class="keyword">);&nbsp; &nbsp; </span><span class="comment">//?<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$nowytekst </span><span class="keyword">= </span><span class="default">str_replace</span><span class="keyword">(</span><span class="string">'%u0179'</span><span class="keyword">,</span><span class="string">'?'</span><span class="keyword">,</span><span class="default">$nowytekst</span><span class="keyword">);&nbsp; &nbsp; </span><span class="comment">//?<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$nowytekst </span><span class="keyword">= </span><span class="default">str_replace</span><span class="keyword">(</span><span class="string">'%u017B'</span><span class="keyword">,</span><span class="string">'?'</span><span class="keyword">,</span><span class="default">$nowytekst</span><span class="keyword">);&nbsp; &nbsp; </span><span class="comment">//?<br />
&nbsp;&nbsp; &nbsp; &nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$nowytekst </span><span class="keyword">= </span><span class="default">str_replace</span><span class="keyword">(</span><span class="string">'%u0105'</span><span class="keyword">,</span><span class="string">'?'</span><span class="keyword">,</span><span class="default">$nowytekst</span><span class="keyword">);&nbsp; &nbsp; </span><span class="comment">//?<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$nowytekst </span><span class="keyword">= </span><span class="default">str_replace</span><span class="keyword">(</span><span class="string">'%u0107'</span><span class="keyword">,</span><span class="string">'?'</span><span class="keyword">,</span><span class="default">$nowytekst</span><span class="keyword">);&nbsp; &nbsp; </span><span class="comment">//?<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$nowytekst </span><span class="keyword">= </span><span class="default">str_replace</span><span class="keyword">(</span><span class="string">'%u0119'</span><span class="keyword">,</span><span class="string">'?'</span><span class="keyword">,</span><span class="default">$nowytekst</span><span class="keyword">);&nbsp; &nbsp; </span><span class="comment">//?<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$nowytekst </span><span class="keyword">= </span><span class="default">str_replace</span><span class="keyword">(</span><span class="string">'%u0142'</span><span class="keyword">,</span><span class="string">'?'</span><span class="keyword">,</span><span class="default">$nowytekst</span><span class="keyword">);&nbsp; &nbsp; </span><span class="comment">//?<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$nowytekst </span><span class="keyword">= </span><span class="default">str_replace</span><span class="keyword">(</span><span class="string">'%u0144'</span><span class="keyword">,</span><span class="string">'ń'</span><span class="keyword">,</span><span class="default">$nowytekst</span><span class="keyword">);&nbsp; &nbsp; </span><span class="comment">//ń<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$nowytekst </span><span class="keyword">= </span><span class="default">str_replace</span><span class="keyword">(</span><span class="string">'%u00F3'</span><span class="keyword">,</span><span class="string">'ó'</span><span class="keyword">,</span><span class="default">$nowytekst</span><span class="keyword">);&nbsp; &nbsp; </span><span class="comment">//ó<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$nowytekst </span><span class="keyword">= </span><span class="default">str_replace</span><span class="keyword">(</span><span class="string">'%u015B'</span><span class="keyword">,</span><span class="string">'?'</span><span class="keyword">,</span><span class="default">$nowytekst</span><span class="keyword">);&nbsp; &nbsp; </span><span class="comment">//?<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$nowytekst </span><span class="keyword">= </span><span class="default">str_replace</span><span class="keyword">(</span><span class="string">'%u017A'</span><span class="keyword">,</span><span class="string">'?'</span><span class="keyword">,</span><span class="default">$nowytekst</span><span class="keyword">);&nbsp; &nbsp; </span><span class="comment">//?<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$nowytekst </span><span class="keyword">= </span><span class="default">str_replace</span><span class="keyword">(</span><span class="string">'%u017C'</span><span class="keyword">,</span><span class="string">'?'</span><span class="keyword">,</span><span class="default">$nowytekst</span><span class="keyword">);&nbsp; &nbsp; </span><span class="comment">//?<br />
&nbsp;&nbsp; </span><span class="keyword">return (</span><span class="default">$nowytekst</span><span class="keyword">);<br />
&nbsp;&nbsp; }&nbsp; &nbsp; <br />
</span><span class="default">?&gt;<br />
</span><br />
Everything goes smooth, but it doesn't change '%u00D3','ó' and '%u00F3','ó'. I dont have idea what to do with that.<br />
<br />
Remember! File must be saved in UTF-8 coding.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="76434""></a>
  <div class="note">
   <strong class="user">ludvig dot ericson at gmail dot com</strong>
   <a href="#76434" class="date">15-Jul-2007 10:52</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
A better way to convert would be to use iconv, see <a href="http://www.php.net/iconv -- example:" rel="nofollow" target="_blank">http://www.php.net/iconv -- example:</a><br />
<br />
<span class="default">&lt;?php<br />
$myUnicodeString </span><span class="keyword">= </span><span class="string">"???"</span><span class="keyword">;<br />
echo </span><span class="default">iconv</span><span class="keyword">(</span><span class="string">"UTF-8"</span><span class="keyword">, </span><span class="string">"ISO-8859-1"</span><span class="keyword">, </span><span class="default">$myUnicodeString</span><span class="keyword">);<br />
</span><span class="default">?&gt;<br />
</span><br />
Above would echo out the given variable in ISO-8859-1 encoding, you may replace it with whatever you prefer.<br />
<br />
Another solution to the issue of misdisplayed glyphs is to simply send the document as UTF-8, and of course send UTF-8 data:<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="comment"># Replace text/html with whatever MIME-type you prefer.<br />
</span><span class="default">header</span><span class="keyword">(</span><span class="string">"Content-Type: text/html; CHARSET=gb2312"</span><span class="keyword">);<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="76250""></a>
  <div class="note">
   <strong class="user">MARC13</strong>
   <a href="#76250" class="date">07-Jul-2007 07:50</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I did this function to convert data from AJAX call to insert to my database.<br />
It converts UTF-8 from XMLHttpRequest() to ISO-8859-2 that I use in LATIN2 MySQL database.<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">function </span><span class="default">utf2iso</span><span class="keyword">(</span><span class="default">$tekst</span><span class="keyword">)<br />
{<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$nowytekst </span><span class="keyword">= </span><span class="default">str_replace</span><span class="keyword">(</span><span class="string">"%u0104"</span><span class="keyword">,</span><span class="string">"\xA1"</span><span class="keyword">,</span><span class="default">$tekst</span><span class="keyword">);&nbsp; &nbsp; </span><span class="comment">//?<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$nowytekst </span><span class="keyword">= </span><span class="default">str_replace</span><span class="keyword">(</span><span class="string">"%u0106"</span><span class="keyword">,</span><span class="string">"\xC6"</span><span class="keyword">,</span><span class="default">$nowytekst</span><span class="keyword">);&nbsp; &nbsp; </span><span class="comment">//?<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$nowytekst </span><span class="keyword">= </span><span class="default">str_replace</span><span class="keyword">(</span><span class="string">"%u0118"</span><span class="keyword">,</span><span class="string">"\xCA"</span><span class="keyword">,</span><span class="default">$nowytekst</span><span class="keyword">);&nbsp; &nbsp; </span><span class="comment">//?<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$nowytekst </span><span class="keyword">= </span><span class="default">str_replace</span><span class="keyword">(</span><span class="string">"%u0141"</span><span class="keyword">,</span><span class="string">"\xA3"</span><span class="keyword">,</span><span class="default">$nowytekst</span><span class="keyword">);&nbsp; &nbsp; </span><span class="comment">//?<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$nowytekst </span><span class="keyword">= </span><span class="default">str_replace</span><span class="keyword">(</span><span class="string">"%u0143"</span><span class="keyword">,</span><span class="string">"\xD1"</span><span class="keyword">,</span><span class="default">$nowytekst</span><span class="keyword">);&nbsp; &nbsp; </span><span class="comment">//?<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$nowytekst </span><span class="keyword">= </span><span class="default">str_replace</span><span class="keyword">(</span><span class="string">"%u00D3"</span><span class="keyword">,</span><span class="string">"\xD3"</span><span class="keyword">,</span><span class="default">$nowytekst</span><span class="keyword">);&nbsp; &nbsp; </span><span class="comment">//ó<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$nowytekst </span><span class="keyword">= </span><span class="default">str_replace</span><span class="keyword">(</span><span class="string">"%u015A"</span><span class="keyword">,</span><span class="string">"\xA6"</span><span class="keyword">,</span><span class="default">$nowytekst</span><span class="keyword">);&nbsp; &nbsp; </span><span class="comment">//?<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$nowytekst </span><span class="keyword">= </span><span class="default">str_replace</span><span class="keyword">(</span><span class="string">"%u0179"</span><span class="keyword">,</span><span class="string">"\xAC"</span><span class="keyword">,</span><span class="default">$nowytekst</span><span class="keyword">);&nbsp; &nbsp; </span><span class="comment">//?<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$nowytekst </span><span class="keyword">= </span><span class="default">str_replace</span><span class="keyword">(</span><span class="string">"%u017B"</span><span class="keyword">,</span><span class="string">"\xAF"</span><span class="keyword">,</span><span class="default">$nowytekst</span><span class="keyword">);&nbsp; &nbsp; </span><span class="comment">//?<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$nowytekst </span><span class="keyword">= </span><span class="default">str_replace</span><span class="keyword">(</span><span class="string">"%u0105"</span><span class="keyword">,</span><span class="string">"\xB1"</span><span class="keyword">,</span><span class="default">$nowytekst</span><span class="keyword">);&nbsp; &nbsp; </span><span class="comment">//?<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$nowytekst </span><span class="keyword">= </span><span class="default">str_replace</span><span class="keyword">(</span><span class="string">"%u0107"</span><span class="keyword">,</span><span class="string">"\xE6"</span><span class="keyword">,</span><span class="default">$nowytekst</span><span class="keyword">);&nbsp; &nbsp; </span><span class="comment">//?<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$nowytekst </span><span class="keyword">= </span><span class="default">str_replace</span><span class="keyword">(</span><span class="string">"%u0119"</span><span class="keyword">,</span><span class="string">"\xEA"</span><span class="keyword">,</span><span class="default">$nowytekst</span><span class="keyword">);&nbsp; &nbsp; </span><span class="comment">//?<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$nowytekst </span><span class="keyword">= </span><span class="default">str_replace</span><span class="keyword">(</span><span class="string">"%u0142"</span><span class="keyword">,</span><span class="string">"\xB3"</span><span class="keyword">,</span><span class="default">$nowytekst</span><span class="keyword">);&nbsp; &nbsp; </span><span class="comment">//?<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$nowytekst </span><span class="keyword">= </span><span class="default">str_replace</span><span class="keyword">(</span><span class="string">"%u0144"</span><span class="keyword">,</span><span class="string">"\xF1"</span><span class="keyword">,</span><span class="default">$nowytekst</span><span class="keyword">);&nbsp; &nbsp; </span><span class="comment">//ń<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$nowytekst </span><span class="keyword">= </span><span class="default">str_replace</span><span class="keyword">(</span><span class="string">"%u00D4"</span><span class="keyword">,</span><span class="string">"\xF3"</span><span class="keyword">,</span><span class="default">$nowytekst</span><span class="keyword">);&nbsp; &nbsp; </span><span class="comment">//ó<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$nowytekst </span><span class="keyword">= </span><span class="default">str_replace</span><span class="keyword">(</span><span class="string">"%u015B"</span><span class="keyword">,</span><span class="string">"\xB6"</span><span class="keyword">,</span><span class="default">$nowytekst</span><span class="keyword">);&nbsp; &nbsp; </span><span class="comment">//?<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$nowytekst </span><span class="keyword">= </span><span class="default">str_replace</span><span class="keyword">(</span><span class="string">"%u017A"</span><span class="keyword">,</span><span class="string">"\xBC"</span><span class="keyword">,</span><span class="default">$nowytekst</span><span class="keyword">);&nbsp; &nbsp; </span><span class="comment">//?<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$nowytekst </span><span class="keyword">= </span><span class="default">str_replace</span><span class="keyword">(</span><span class="string">"%u017C"</span><span class="keyword">,</span><span class="string">"\xBF"</span><span class="keyword">,</span><span class="default">$nowytekst</span><span class="keyword">);&nbsp; &nbsp; </span><span class="comment">//?<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">return (</span><span class="default">$nowytekst</span><span class="keyword">);<br />
}<br />
</span><span class="default">?&gt;<br />
</span><br />
In my case also the code file that deals with AJAX calls must be in UTF-8 coding.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="75952""></a>
  <div class="note">
   <strong class="user">visus at portsonline dot net</strong>
   <a href="#75952" class="date">23-Jun-2007 09:08</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Following code helped me with mixed (UTF8+ISO-8859-1(x)) encodings. In this case, I have template files made and maintained by designers who do not care about encoding and MySQL data in utf8_binary_ci encoded tables.<br />
<br />
<span class="default">&lt;?php<br />
<br />
</span><span class="keyword">class </span><span class="default">Helper<br />
</span><span class="keyword">{<br />
&nbsp;&nbsp;&nbsp; function </span><span class="default">strSplit</span><span class="keyword">(</span><span class="default">$text</span><span class="keyword">, </span><span class="default">$split </span><span class="keyword">= </span><span class="default">1</span><span class="keyword">)<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (!</span><span class="default">is_string</span><span class="keyword">(</span><span class="default">$text</span><span class="keyword">)) return </span><span class="default">false</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (!</span><span class="default">is_numeric</span><span class="keyword">(</span><span class="default">$split</span><span class="keyword">) &amp;&amp; </span><span class="default">$split </span><span class="keyword">&lt; </span><span class="default">1</span><span class="keyword">) return </span><span class="default">false</span><span class="keyword">;<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$len </span><span class="keyword">= </span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$text</span><span class="keyword">);<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$array </span><span class="keyword">= array();<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$i </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; while (</span><span class="default">$i </span><span class="keyword">&lt; </span><span class="default">$len</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$key </span><span class="keyword">= </span><span class="default">NULL</span><span class="keyword">;<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; for (</span><span class="default">$j </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">; </span><span class="default">$j </span><span class="keyword">&lt; </span><span class="default">$split</span><span class="keyword">; </span><span class="default">$j </span><span class="keyword">+= </span><span class="default">1</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$key </span><span class="keyword">.= </span><span class="default">$text</span><span class="keyword">{</span><span class="default">$i</span><span class="keyword">};<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$i </span><span class="keyword">+= </span><span class="default">1</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$array</span><span class="keyword">[] = </span><span class="default">$key</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">$array</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp;&nbsp; function </span><span class="default">UTF8ToHTML</span><span class="keyword">(</span><span class="default">$str</span><span class="keyword">)<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$search </span><span class="keyword">= array();<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$search</span><span class="keyword">[] = </span><span class="string">"/([\\xC0-\\xF7]{1,1}[\\x80-\\xBF]+)/e"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$search</span><span class="keyword">[] = </span><span class="string">"/&amp;#228;/"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$search</span><span class="keyword">[] = </span><span class="string">"/&amp;#246;/"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$search</span><span class="keyword">[] = </span><span class="string">"/&amp;#252;/"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$search</span><span class="keyword">[] = </span><span class="string">"/&amp;#196;/"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$search</span><span class="keyword">[] = </span><span class="string">"/&amp;#214;/"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$search</span><span class="keyword">[] = </span><span class="string">"/&amp;#220;/"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$search</span><span class="keyword">[] = </span><span class="string">"/&amp;#223;/"</span><span class="keyword">;<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$replace </span><span class="keyword">= array();<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$replace</span><span class="keyword">[] = </span><span class="string">'Helper::_UTF8ToHTML("\\1")'</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$replace</span><span class="keyword">[] = </span><span class="string">"?"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$replace</span><span class="keyword">[] = </span><span class="string">"?"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$replace</span><span class="keyword">[] = </span><span class="string">"ü"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$replace</span><span class="keyword">[] = </span><span class="string">"?"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$replace</span><span class="keyword">[] = </span><span class="string">"?"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$replace</span><span class="keyword">[] = </span><span class="string">"ü"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$replace</span><span class="keyword">[] = </span><span class="string">"?"</span><span class="keyword">;<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$str </span><span class="keyword">= </span><span class="default">preg_replace</span><span class="keyword">(</span><span class="default">$search</span><span class="keyword">, </span><span class="default">$replace</span><span class="keyword">, </span><span class="default">$str</span><span class="keyword">);<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">$str</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp;&nbsp; function </span><span class="default">_UTF8ToHTML</span><span class="keyword">(</span><span class="default">$str</span><span class="keyword">)<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$ret </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; foreach((</span><span class="default">Helper</span><span class="keyword">::</span><span class="default">strSplit</span><span class="keyword">(</span><span class="default">strrev</span><span class="keyword">(</span><span class="default">chr</span><span class="keyword">((</span><span class="default">ord</span><span class="keyword">(</span><span class="default">$str</span><span class="keyword">{</span><span class="default">0</span><span class="keyword">}) % </span><span class="default">252 </span><span class="keyword">% </span><span class="default">248 </span><span class="keyword">% </span><span class="default">240 </span><span class="keyword">% </span><span class="default">224 </span><span class="keyword">% </span><span class="default">192</span><span class="keyword">) + </span><span class="default">128</span><span class="keyword">).</span><span class="default">substr</span><span class="keyword">(</span><span class="default">$str</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">)))) as </span><span class="default">$k </span><span class="keyword">=&gt; </span><span class="default">$v</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$ret </span><span class="keyword">+= (</span><span class="default">ord</span><span class="keyword">(</span><span class="default">$v</span><span class="keyword">) % </span><span class="default">128</span><span class="keyword">) * </span><span class="default">pow</span><span class="keyword">(</span><span class="default">64</span><span class="keyword">, </span><span class="default">$k</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="string">"&amp;#"</span><span class="keyword">.</span><span class="default">$ret</span><span class="keyword">.</span><span class="string">";"</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
}<br />
<br />
</span><span class="comment">// Usage example:<br />
<br />
</span><span class="default">$tpl </span><span class="keyword">= </span><span class="default">file_get_contents</span><span class="keyword">(</span><span class="string">"template.tpl"</span><span class="keyword">);<br />
</span><span class="comment">/* ... */<br />
</span><span class="default">$row </span><span class="keyword">= </span><span class="default">mysql_fetch_assoc</span><span class="keyword">(</span><span class="default">$result</span><span class="keyword">);<br />
<br />
print(</span><span class="default">Helper</span><span class="keyword">::</span><span class="default">UTF8ToHTML</span><span class="keyword">(</span><span class="default">str_replace</span><span class="keyword">(</span><span class="string">"{VAR}"</span><span class="keyword">, </span><span class="default">$row</span><span class="keyword">[</span><span class="string">'var'</span><span class="keyword">], </span><span class="default">$tpl</span><span class="keyword">)));<br />
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="75941""></a>
  <div class="note">
   <strong class="user">luka8088 at gmail dot com</strong>
   <a href="#75941" class="date">22-Jun-2007 07:03</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
simple UTF-8 to HTML conversion:<br />
<br />
function utf8_to_html ($data)<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp;&nbsp; return preg_replace("/([\\xC0-\\xF7]{1,1}[\\x80-\\xBF]+)/e", '_utf8_to_html("\\1")', $data);<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
function _utf8_to_html ($data)<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp;&nbsp; $ret = 0;<br />
&nbsp;&nbsp;&nbsp; foreach((str_split(strrev(chr((ord($data{0}) % 252 % 248 % 240 % 224 % 192) + 128) . substr($data, 1)))) as $k =&gt; $v)<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $ret += (ord($v) % 128) * pow(64, $k);<br />
&nbsp;&nbsp;&nbsp; return "&amp;#$ret;";<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
Example:<br />
echo utf8_to_html("a b ? ? ? こ に ち わ ()[]{}!#$?*");<br />
<br />
Output:<br />
a b &amp;#269; &amp;#263; &amp;#382; &amp;#12371; &amp;#12395; &amp;#12385; &amp;#12431; ()[]{}!#$?*</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="75723""></a>
  <div class="note">
   <strong class="user">Sadi</strong>
   <a href="#75723" class="date">13-Jun-2007 03:38</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Once again about polish letters. If you use fananf's solution, make sure that PHP file is coded with cp1250 or else it won't work. It's quite obvious, however I spent some time before I finally figured that out, so I thought I post it here.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="75261""></a>
  <div class="note">
   <strong class="user">alexlevin at kvadro dot net</strong>
   <a href="#75261" class="date">20-May-2007 08:20</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you running Gentoo Linux and encounter problems with some PHP4 applications saying:<br />
Call to undefined function: utf8_decode()<br />
Try reemerge PHP4 with 'expat' flag enabled.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="72978""></a>
  <div class="note">
   <strong class="user">sam</strong>
   <a href="#72978" class="date">06-Feb-2007 08:20</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
In addition to yannikh's note, to convert a hex utf8 string<br />
<br />
<span class="default">&lt;?php<br />
<br />
</span><span class="keyword">echo </span><span class="default">utf8_decode</span><span class="keyword">(</span><span class="string">"\x61\xc3\xb6\x61"</span><span class="keyword">);<br />
</span><span class="comment">// works as expected<br />
<br />
</span><span class="default">$abc</span><span class="keyword">=</span><span class="string">"61c3b661"</span><span class="keyword">;<br />
</span><span class="default">$newstr </span><span class="keyword">= </span><span class="string">""</span><span class="keyword">;<br />
</span><span class="default">$l </span><span class="keyword">= </span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$abc</span><span class="keyword">);<br />
for (</span><span class="default">$i</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">;</span><span class="default">$i</span><span class="keyword">&lt;</span><span class="default">$l</span><span class="keyword">;</span><span class="default">$i</span><span class="keyword">+=</span><span class="default">2</span><span class="keyword">){<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$newstr </span><span class="keyword">.= </span><span class="string">"\x"</span><span class="keyword">.</span><span class="default">$abc</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">].</span><span class="default">$abc</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">+</span><span class="default">1</span><span class="keyword">];<br />
}<br />
echo </span><span class="default">utf8_decode</span><span class="keyword">(</span><span class="default">$newstr</span><span class="keyword">);<br />
</span><span class="comment">// or varieties&nbsp; of "\x": "\\x" etc does NOT output what you want<br />
<br />
</span><span class="keyword">echo </span><span class="default">utf8_decode</span><span class="keyword">(</span><span class="default">pack</span><span class="keyword">(</span><span class="string">'H*'</span><span class="keyword">,</span><span class="default">$abc</span><span class="keyword">));<br />
</span><span class="comment">// this outputs the correct string, like the first line.<br />
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="71999""></a>
  <div class="note">
   <strong class="user">Ajgor</strong>
   <a href="#71999" class="date">28-Dec-2006 05:38</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
small upgrade for polish decoding:<br />
<br />
function utf82iso88592($text) {<br />
&nbsp;$text = str_replace("\xC4\x85", '?', $text);<br />
&nbsp;$text = str_replace("\xC4\x84", '?', $text);<br />
&nbsp;$text = str_replace("\xC4\x87", '?', $text);<br />
&nbsp;$text = str_replace("\xC4\x86", '?', $text);<br />
&nbsp;$text = str_replace("\xC4\x99", '?', $text);<br />
&nbsp;$text = str_replace("\xC4\x98", '?', $text);<br />
&nbsp;$text = str_replace("\xC5\x82", '?', $text);<br />
&nbsp;$text = str_replace("\xC5\x81", '?', $text);<br />
&nbsp;$text = str_replace("\xC3\xB3", 'ó', $text);<br />
&nbsp;$text = str_replace("\xC3\x93", 'ó', $text);<br />
&nbsp;$text = str_replace("\xC5\x9B", '?', $text);<br />
&nbsp;$text = str_replace("\xC5\x9A", '?', $text);<br />
&nbsp;$text = str_replace("\xC5\xBC", '?', $text);<br />
&nbsp;$text = str_replace("\xC5\xBB", '?', $text);<br />
&nbsp;$text = str_replace("\xC5\xBA", '?', $text);<br />
&nbsp;$text = str_replace("\xC5\xB9", '?', $text);<br />
&nbsp;$text = str_replace("\xc5\x84", 'ń', $text);<br />
&nbsp;$text = str_replace("\xc5\x83", '?', $text);<br />
<br />
return $text;<br />
} // utf82iso88592</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="70776""></a>
  <div class="note">
   <strong class="user">paul.hayes at entropedia.co.uk</strong>
   <a href="#70776" class="date">27-Oct-2006 07:10</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I noticed that the utf-8 to html functions below are only for 2 byte long codes. Well I wanted 3 byte support (sorry haven't done 4, 5 or 6). Also I noticed the concatination of the character codes did have the hex prefix 0x and so failed with the large 2 byte codes)<br />
<br />
&lt;?<br />
&nbsp; public function utf2html (&amp;$str) {<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; $ret = "";<br />
&nbsp;&nbsp;&nbsp; $max = strlen($str);<br />
&nbsp;&nbsp;&nbsp; $last = 0;&nbsp; // keeps the index of the last regular character<br />
&nbsp;&nbsp;&nbsp; for ($i=0; $i&lt;$max; $i++) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $c = $str{$i};<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $c1 = ord($c);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if ($c1&gt;&gt;5 == 6) {&nbsp; // 110x xxxx, 110 prefix for 2 bytes unicode<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $ret .= substr($str, $last, $i-$last); // append all the regular characters we've passed<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $c1 &amp;= 31; // remove the 3 bit two bytes prefix<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $c2 = ord($str{++$i}); // the next byte<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $c2 &amp;= 63;&nbsp; // remove the 2 bit trailing byte prefix<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $c2 |= (($c1 &amp; 3) &lt;&lt; 6); // last 2 bits of c1 become first 2 of c2<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $c1 &gt;&gt;= 2; // c1 shifts 2 to the right<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $ret .= "&amp;#" . ($c1 * 0x100 + $c2) . ";"; // this is the fastest string concatenation<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $last = $i+1;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; elseif ($c1&gt;&gt;4 == 14) {&nbsp; // 1110 xxxx, 110 prefix for 3 bytes unicode<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $ret .= substr($str, $last, $i-$last); // append all the regular characters we've passed<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $c2 = ord($str{++$i}); // the next byte<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $c3 = ord($str{++$i}); // the third byte<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $c1 &amp;= 15; // remove the 4 bit three bytes prefix<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $c2 &amp;= 63;&nbsp; // remove the 2 bit trailing byte prefix<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $c3 &amp;= 63;&nbsp; // remove the 2 bit trailing byte prefix<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $c3 |= (($c2 &amp; 3) &lt;&lt; 6); // last 2 bits of c2 become first 2 of c3<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $c2 &gt;&gt;=2; //c2 shifts 2 to the right<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $c2 |= (($c1 &amp; 15) &lt;&lt; 4); // last 4 bits of c1 become first 4 of c2<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $c1 &gt;&gt;= 4; // c1 shifts 4 to the right<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $ret .= '&amp;#' . (($c1 * 0x10000) + ($c2 * 0x100) + $c3) . ';'; // this is the fastest string concatenation<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $last = $i+1;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; $str=$ret . substr($str, $last, $i); // append the last batch of regular characters<br />
} <br />
?&gt;</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="70561""></a>
  <div class="note">
   <strong class="user">tobias at code-x dot de</strong>
   <a href="#70561" class="date">20-Oct-2006 05:13</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
converting uft8-html sign &amp;#301; to uft8<br />
<br />
&lt;?<br />
function uft8html2utf8( $s ) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if ( !function_exists('uft8html2utf8_callback') ) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; function uft8html2utf8_callback($t) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $dec = $t[1];<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if ($dec &lt; 128) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $utf = chr($dec);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; } else if ($dec &lt; 2048) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $utf = chr(192 + (($dec - ($dec % 64)) / 64));<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $utf .= chr(128 + ($dec % 64));<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; } else {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $utf = chr(224 + (($dec - ($dec % 4096)) / 4096));<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $utf .= chr(128 + ((($dec % 4096) - ($dec % 64)) / 64));<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $utf .= chr(128 + ($dec % 64));<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return $utf;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return preg_replace_callback('|&amp;#([0-9]{1,});|', 'uft8html2utf8_callback', $s );&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
}<br />
echo uft8html2utf8('test: &amp;#301;');<br />
?&gt;</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="61120""></a>
  <div class="note">
   <strong class="user">2ge at NO2geSPAM dot us</strong>
   <a href="#61120" class="date">26-Jan-2006 01:00</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Hello all,
<br />

<br />
I like to use COOL (nice) URIs, example: <a href="http://example.com/try-something" rel="nofollow" target="_blank">http://example.com/try-something</a>
<br />
I'm using UTF8 as input, so I have to write a function UTF8toASCII to have nice URI. Here is what I come with:
<br />

<br />
<span class="default">&lt;?php
<br />
</span><span class="keyword">function </span><span class="default">urlize</span><span class="keyword">(</span><span class="default">$url</span><span class="keyword">) {
<br />
&nbsp;</span><span class="default">$search </span><span class="keyword">= array(</span><span class="string">'/[^a-z0-9]/'</span><span class="keyword">, </span><span class="string">'/--+/'</span><span class="keyword">, </span><span class="string">'/^-+/'</span><span class="keyword">, </span><span class="string">'/-+$/' </span><span class="keyword">);
<br />
&nbsp;</span><span class="default">$replace </span><span class="keyword">= array( </span><span class="string">'-'</span><span class="keyword">, </span><span class="string">'-'</span><span class="keyword">, </span><span class="string">''</span><span class="keyword">, </span><span class="string">''</span><span class="keyword">);
<br />
&nbsp;return </span><span class="default">preg_replace</span><span class="keyword">(</span><span class="default">$search</span><span class="keyword">, </span><span class="default">$replace</span><span class="keyword">, </span><span class="default">utf2ascii</span><span class="keyword">(</span><span class="default">$url</span><span class="keyword">));
<br />
}&nbsp; &nbsp;&nbsp; 
<br />

<br />
function </span><span class="default">utf2ascii</span><span class="keyword">(</span><span class="default">$string</span><span class="keyword">) {
<br />
&nbsp;</span><span class="default">$iso88591&nbsp; </span><span class="keyword">= </span><span class="string">"\\xE0\\xE1\\xE2\\xE3\\xE4\\xE5\\xE6\\xE7"</span><span class="keyword">;
<br />
&nbsp;</span><span class="default">$iso88591 </span><span class="keyword">.= </span><span class="string">"\\xE8\\xE9\\xEA\\xEB\\xEC\\xED\\xEE\\xEF"</span><span class="keyword">;
<br />
&nbsp;</span><span class="default">$iso88591 </span><span class="keyword">.= </span><span class="string">"\\xF0\\xF1\\xF2\\xF3\\xF4\\xF5\\xF6\\xF7"</span><span class="keyword">;
<br />
&nbsp;</span><span class="default">$iso88591 </span><span class="keyword">.= </span><span class="string">"\\xF8\\xF9\\xFA\\xFB\\xFC\\xFD\\xFE\\xFF"</span><span class="keyword">;
<br />
&nbsp;</span><span class="default">$ascii </span><span class="keyword">= </span><span class="string">"aaaaaaaceeeeiiiidnooooooouuuuyyy"</span><span class="keyword">;
<br />
&nbsp;return </span><span class="default">strtr</span><span class="keyword">(</span><span class="default">mb_strtolower</span><span class="keyword">(</span><span class="default">utf8_decode</span><span class="keyword">(</span><span class="default">$string</span><span class="keyword">), </span><span class="string">'ISO-8859-1'</span><span class="keyword">),</span><span class="default">$iso88591</span><span class="keyword">,</span><span class="default">$ascii</span><span class="keyword">);
<br />
}
<br />

<br />
echo </span><span class="default">urlize</span><span class="keyword">(</span><span class="string">"Fucking ?m?l"</span><span class="keyword">);
<br />

<br />
</span><span class="default">?&gt;
<br />
</span>
<br />
I hope this helps someone.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="59485""></a>
  <div class="note">
   <strong class="user">php-net at ---NOSPAM---lc dot yi dot org</strong>
   <a href="#59485" class="date">08-Dec-2005 12:04</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I've just created this code snippet to improve the user-customizable emails sent by one of my websites.<br />
<br />
The goal was to use UTF-8 (Unicode) so that non-english users have all the Unicode benefits, BUT also make life seamless for English (or specifically, English MS-Outlook users).&nbsp; The niggle: Outlook prior to 2003 (?)&nbsp; does not properly detect unicode emails.&nbsp; When "smart quotes" from MS Word were pasted into a rich text area and saved in Unicode, then sent by email to an Outlook user, more often than not, these characters were wrongly rendered as "greek". <br />
<br />
So, the following code snippet replaces a few strategic characters into html entities which Outlook XP (and possibly earlier) will render as expected.&nbsp; [Code based on bits of code from previous posts on this and the htmlenties page]<br />
<span class="default">&lt;?php<br />
&nbsp;&nbsp;&nbsp; $badwordchars</span><span class="keyword">=array(<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">"\xe2\x80\x98"</span><span class="keyword">, </span><span class="comment">// left single quote<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">"\xe2\x80\x99"</span><span class="keyword">, </span><span class="comment">// right single quote<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">"\xe2\x80\x9c"</span><span class="keyword">, </span><span class="comment">// left double quote<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">"\xe2\x80\x9d"</span><span class="keyword">, </span><span class="comment">// right double quote<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">"\xe2\x80\x94"</span><span class="keyword">, </span><span class="comment">// em dash<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">"\xe2\x80\xa6" </span><span class="comment">// elipses<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$fixedwordchars</span><span class="keyword">=array(<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">"&amp;#8216;"</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">"&amp;#8217;"</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">'&amp;#8220;'</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">'&amp;#8221;'</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">'&amp;mdash;'</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">'&amp;#8230;'<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$html</span><span class="keyword">=</span><span class="default">str_replace</span><span class="keyword">(</span><span class="default">$badwordchars</span><span class="keyword">,</span><span class="default">$fixedwordchars</span><span class="keyword">,</span><span class="default">$html</span><span class="keyword">);<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="59484""></a>
  <div class="note">
   <strong class="user">yannikh at gmeil dot com</strong>
   <a href="#59484" class="date">07-Dec-2005 11:34</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I had to tackle a very interesting problem:<br />
<br />
I wanted to replace all \xXX in a text by it's letters. Unfortunatelly XX were ASCII and not utf8. I solved my problem that way:<br />
<span class="default">&lt;?php preg_replace </span><span class="keyword">(</span><span class="string">'/\\\\x([0-9a-fA-F]{2})/e'</span><span class="keyword">, </span><span class="string">"pack('H*',utf8_decode('\\1'))"</span><span class="keyword">,</span><span class="default">$v</span><span class="keyword">); </span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="57339""></a>
  <div class="note">
   <strong class="user">thierry.bo # netcourrier point com</strong>
   <a href="#57339" class="date">30-Sep-2005 12:38</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
In response to fhoech (22-Sep-2005 11:55), I just tried a simultaneous test with the file UTF-8-test.txt using your regexp, 'j dot dittmer' (20-Sep-2005 06:30) regexp (message #56962), `php-note-2005` (17-Feb-2005 08:57) regexp in his message on `mb-detect-encoding` page (<a href="http://us3.php.net/manual/en/function.mb-detect-encoding.php#50087" rel="nofollow" target="_blank">http://us3.php.net/manual/en/function.mb-detect-encoding.php#50087</a>) who is using a regexp from the W3C (<a href="http://w3.org/International/questions/qa-forms-utf-8.html" rel="nofollow" target="_blank">http://w3.org/International/questions/qa-forms-utf-8.html</a>), and PHP mb_detect_encoding function.<br />
<br />
Here are a summarize of the results :<br />
<br />
201 lines are valid UTF8 strings using phpnote regexp<br />
203 lines are valid UTF8 strings using j.dittmer regexp<br />
200 lines are valid UTF8 strings using fhoech regexp<br />
239 lines are valid&nbsp; UTF8 strings using using mb_detect_encoding<br />
<br />
Here are the lines with differences (left to right, phpnote, j.dittmer and fhoech) :<br />
<br />
Line #70 : NOT UTF8|IS UTF8!|IS UTF8! :2.1.1 1 byte (U-00000000): "" <br />
Line #79 : NOT UTF8|IS UTF8!|IS UTF8! :2.2.1 1 byte (U-0000007F): "" <br />
Line #81 : IS UTF8!|IS UTF8!|NOT UTF8 :2.2.3 3 bytes (U-0000FFFF): "&amp;#65535;" | <br />
Line #267 : IS UTF8!|IS UTF8!|NOT UTF8 :5.3.1 U+FFFE = ef bf be = "&amp;#65534;" |<br />
Line #268 : IS UTF8!|IS UTF8!|NOT UTF8 :5.3.2 U+FFFF = ef bf bf = "&amp;#65535;" | <br />
<br />
Interesting is that you said that your regexp corrected j.dittmer regexp that failed on 5.3 section, but it my test I have the opposite result ?!<br />
<br />
I ran this test on windows XP with PHP 4.3.11dev. Maybe these differences come from operating system, or PHP version. <br />
<br />
For mb_detect_encoding I used the command :<br />
<br />
mb_detect_encoding($line, 'UTF-8, ISO-8859-1, ASCII');</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="57070""></a>
  <div class="note">
   <strong class="user">fhoech</strong>
   <a href="#57070" class="date">22-Sep-2005 10:55</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Sorry, I had a typo in my last comment. Corrected regexp:<br />
<br />
^([\\x00-\\x7f]|<br />
[\\xc2-\\xdf][\\x80-\\xbf]|<br />
\\xe0[\\xa0-\\xbf][\\x80-\\xbf]|<br />
[\\xe1-\\xec][\\x80-\\xbf]{2}|<br />
\\xed[\\x80-\\x9f][\\x80-\\xbf]|<br />
\\xef[\\x80-\\xbf][\\x80-\\xbd]|<br />
\\xee[\\x80-\\xbf]{2}|<br />
\xf0[\\x90-\\xbf][\\x80-\\xbf]{2}|<br />
[\\xf1-\\xf3][\\x80-\\xbf]{3}|<br />
\\xf4[\\x80-\\x8f][\\x80-\\xbf]{2})*$</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="57069""></a>
  <div class="note">
   <strong class="user">fhoech</strong>
   <a href="#57069" class="date">22-Sep-2005 10:12</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
JF Sebastian's regex is almost perfect as far as I'm concerned. I found one error (it failed section 5.3 "Other illegal code positions" from <a href="http://www.cl.cam.ac.uk/~mgk25/ucs/examples/UTF-8-test.txt" rel="nofollow" target="_blank">http://www.cl.cam.ac.uk/~mgk25/ucs/examples/UTF-8-test.txt</a>) which I corrected as follows:<br />
<br />
^([\\x00-\\x7f]|<br />
[\\xc2-\\xdf][\\x80-\\xbf]|<br />
\\xe0[\\xa0-\\xbf][\\x80-\\xbf]|<br />
[\\xe1-\\xec][\\x80-\\xbf]{2}|<br />
\\xed[\\x80-\\x9f][\\x80-\\xbf]|<br />
\\xef[\\x80-\\xbf][\\x80-\\xbc]|<br />
\\xee[\\x80-\\xbf]{2}|<br />
\\xf0[\\x90-\\xbf][\\x80-\\xbf]{2}|<br />
[\\xf1-\\xf3][\\x80-\\xbf]{3}|<br />
\\xf4[\\x80-\\x8f][\\x80-\\xbf]{2})*$<br />
<br />
(Again, concatenate to one single line to make it work)</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="56962""></a>
  <div class="note">
   <strong class="user">j dot dittmer at portrix dot net</strong>
   <a href="#56962" class="date">20-Sep-2005 05:30</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
The regex in the last comment has some typos. This is a<br />
syntactically valid one, don't know if it's correct though.<br />
You've to concat the expression in one long line.<br />
<br />
^(<br />
[\x00-\x7f]|<br />
[\xc2-\xdf][\x80-\xbf]|<br />
[\xe0][\xa0-\xbf][\x80-\xbf]|<br />
[\xe1-\xec][\x80-\xbf]{2}|<br />
[\xed][\x80-\x9f][\x80-\xbf]|<br />
[\xee-\xef][\x80-\xbf]{2}|<br />
[\xf0][\x90-\xbf][\x80-\xbf]{2}|<br />
[\xf1-\xf3][\x80-\xbf]{3}|<br />
[\xf4][\x80-\x8f][\x80-\xbf]{2}<br />
)*$</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="49185""></a>
  <div class="note">
   <strong class="user">rasmus at flajm dot se</strong>
   <a href="#49185" class="date">19-Jan-2005 02:57</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you don't have the multibyte extension installed, here's a function to decode UTF-16 encoded strings. It support both BOM-less and BOM'ed strings, (big- and little-endian byte order.)<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="comment">/**<br />
&nbsp;* Decode UTF-16 encoded strings.<br />
&nbsp;* <br />
&nbsp;* Can handle both BOM'ed data and un-BOM'ed data. <br />
&nbsp;* Assumes Big-Endian byte order if no BOM is available.<br />
&nbsp;* <br />
&nbsp;* @param&nbsp;&nbsp; string&nbsp; $str&nbsp; UTF-16 encoded data to decode.<br />
&nbsp;* @return&nbsp; string&nbsp; UTF-8 / ISO encoded data.<br />
&nbsp;* @access&nbsp; public<br />
&nbsp;* @version 0.1 / 2005-01-19<br />
&nbsp;* @author&nbsp; Rasmus Andersson {@link <a href="http://rasmusandersson.se/}" rel="nofollow" target="_blank">http://rasmusandersson.se/}</a><br />
&nbsp;* @package Groupies<br />
&nbsp;*/<br />
</span><span class="keyword">function </span><span class="default">utf16_decode</span><span class="keyword">( </span><span class="default">$str </span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; if( </span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$str</span><span class="keyword">) &lt; </span><span class="default">2 </span><span class="keyword">) return </span><span class="default">$str</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$bom_be </span><span class="keyword">= </span><span class="default">true</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$c0 </span><span class="keyword">= </span><span class="default">ord</span><span class="keyword">(</span><span class="default">$str</span><span class="keyword">{</span><span class="default">0</span><span class="keyword">});<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$c1 </span><span class="keyword">= </span><span class="default">ord</span><span class="keyword">(</span><span class="default">$str</span><span class="keyword">{</span><span class="default">1</span><span class="keyword">});<br />
&nbsp;&nbsp;&nbsp; if( </span><span class="default">$c0 </span><span class="keyword">== </span><span class="default">0xfe </span><span class="keyword">&amp;&amp; </span><span class="default">$c1 </span><span class="keyword">== </span><span class="default">0xff </span><span class="keyword">) { </span><span class="default">$str </span><span class="keyword">= </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$str</span><span class="keyword">,</span><span class="default">2</span><span class="keyword">); }<br />
&nbsp;&nbsp;&nbsp; elseif( </span><span class="default">$c0 </span><span class="keyword">== </span><span class="default">0xff </span><span class="keyword">&amp;&amp; </span><span class="default">$c1 </span><span class="keyword">== </span><span class="default">0xfe </span><span class="keyword">) { </span><span class="default">$str </span><span class="keyword">= </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$str</span><span class="keyword">,</span><span class="default">2</span><span class="keyword">); </span><span class="default">$bom_be </span><span class="keyword">= </span><span class="default">false</span><span class="keyword">; }<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$len </span><span class="keyword">= </span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$str</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$newstr </span><span class="keyword">= </span><span class="string">''</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; for(</span><span class="default">$i</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">;</span><span class="default">$i</span><span class="keyword">&lt;</span><span class="default">$len</span><span class="keyword">;</span><span class="default">$i</span><span class="keyword">+=</span><span class="default">2</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if( </span><span class="default">$bom_be </span><span class="keyword">) { </span><span class="default">$val </span><span class="keyword">= </span><span class="default">ord</span><span class="keyword">(</span><span class="default">$str</span><span class="keyword">{</span><span class="default">$i</span><span class="keyword">})&nbsp;&nbsp; &lt;&lt; </span><span class="default">4</span><span class="keyword">; </span><span class="default">$val </span><span class="keyword">+= </span><span class="default">ord</span><span class="keyword">(</span><span class="default">$str</span><span class="keyword">{</span><span class="default">$i</span><span class="keyword">+</span><span class="default">1</span><span class="keyword">}); }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; else {&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$val </span><span class="keyword">= </span><span class="default">ord</span><span class="keyword">(</span><span class="default">$str</span><span class="keyword">{</span><span class="default">$i</span><span class="keyword">+</span><span class="default">1</span><span class="keyword">}) &lt;&lt; </span><span class="default">4</span><span class="keyword">; </span><span class="default">$val </span><span class="keyword">+= </span><span class="default">ord</span><span class="keyword">(</span><span class="default">$str</span><span class="keyword">{</span><span class="default">$i</span><span class="keyword">}); }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$newstr </span><span class="keyword">.= (</span><span class="default">$val </span><span class="keyword">== </span><span class="default">0x228</span><span class="keyword">) ? </span><span class="string">"\n" </span><span class="keyword">: </span><span class="default">chr</span><span class="keyword">(</span><span class="default">$val</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">$newstr</span><span class="keyword">;<br />
}<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="39517""></a>
  <div class="note">
   <strong class="user">Aidan Kehoe &lt;php-manual at parhasard dot net&gt;</strong>
   <a href="#39517" class="date">31-Jan-2004 05:35</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
The fastest way I've found to check if something is valid UTF-8 is <br />
<span class="default">&lt;?php <br />
</span><span class="keyword">if (</span><span class="default">iconv</span><span class="keyword">(</span><span class="string">'UTF-8'</span><span class="keyword">, </span><span class="string">'UTF-8'</span><span class="keyword">, </span><span class="default">$input</span><span class="keyword">) != </span><span class="default">$input</span><span class="keyword">) { <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">/* It's not UTF-8--for me, it's probably CP1252, the Windows<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; version of Latin 1, with directed quotation marks and<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; the Euro sign.&nbsp; */<br />
</span><span class="keyword">}<br />
&nbsp;</span><span class="default">?&gt;</span>. <br />
The iconv() C library fails if it's told a string is UTF-8 and it isn't; the PHP one doesn't, it just returns the conversion up to the point of failure, so you have to compare the result to the input to find out if the conversion succeeded.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="37747""></a>
  <div class="note">
   <strong class="user">gto at interia dot pl</strong>
   <a href="#37747" class="date">25-Nov-2003 07:12</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Correction to function converting utf82iso88592 and iso88592tutf8.<br />
Janusz forgot about "&amp;#324;", and "&amp;#380;" exchanged from "&amp;#378;" here and there.<br />
<br />
GTo<br />
<br />
function utf82iso88592($tekscik) {<br />
&nbsp;&nbsp; &nbsp; $tekscik = str_replace("\xC4\x85", "&amp;#261;", $tekscik);<br />
&nbsp;&nbsp; &nbsp; $tekscik = str_replace("\xC4\x84", '&amp;#260;', $tekscik);<br />
&nbsp;&nbsp; &nbsp; $tekscik = str_replace("\xC4\x87", '&amp;#263;', $tekscik);<br />
&nbsp;&nbsp; &nbsp; $tekscik = str_replace("\xC4\x86", '&amp;#262;', $tekscik);<br />
&nbsp;&nbsp; &nbsp; $tekscik = str_replace("\xC4\x99", '&amp;#281;', $tekscik);<br />
&nbsp;&nbsp; &nbsp; $tekscik = str_replace("\xC4\x98", '&amp;#280;', $tekscik);<br />
&nbsp;&nbsp; &nbsp; $tekscik = str_replace("\xC5\x82", '&amp;#322;', $tekscik);<br />
&nbsp;&nbsp; &nbsp; $tekscik = str_replace("\xC5\x81", '&amp;#321;', $tekscik);<br />
&nbsp;&nbsp; &nbsp; $tekscik = str_replace("\xC5\x84", '&amp;#324;', $tekscik);&nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; $tekscik = str_replace("\xC5\x83", '&amp;#323;', $tekscik);<br />
&nbsp;&nbsp; &nbsp; $tekscik = str_replace("\xC3\xB3", '?', $tekscik);<br />
&nbsp;&nbsp; &nbsp; $tekscik = str_replace("\xC3\x93", '?', $tekscik);<br />
&nbsp;&nbsp; &nbsp; $tekscik = str_replace("\xC5\x9B", '&amp;#347;', $tekscik);<br />
&nbsp;&nbsp; &nbsp; $tekscik = str_replace("\xC5\x9A", '&amp;#346;', $tekscik);<br />
&nbsp;&nbsp; &nbsp; $tekscik = str_replace("\xC5\xBC", '&amp;#380;', $tekscik);<br />
&nbsp;&nbsp; &nbsp; $tekscik = str_replace("\xC5\xBB", '&amp;#379;', $tekscik);<br />
&nbsp;&nbsp; &nbsp; $tekscik = str_replace("\xC5\xBA", '&amp;#378;', $tekscik);<br />
&nbsp;&nbsp; &nbsp; $tekscik = str_replace("\xC5\xB9", '&amp;#377;', $tekscik);<br />
&nbsp;&nbsp; &nbsp; return $tekscik;<br />
} // utf82iso88592<br />
<br />
function iso885922utf8($tekscik) {<br />
&nbsp;&nbsp; &nbsp; $tekscik = str_replace("&amp;#261;", "\xC4\x85", $tekscik);<br />
&nbsp;&nbsp; &nbsp; $tekscik = str_replace('&amp;#260;', "\xC4\x84", $tekscik);<br />
&nbsp;&nbsp; &nbsp; $tekscik = str_replace('&amp;#263;', "\xC4\x87", $tekscik);<br />
&nbsp;&nbsp; &nbsp; $tekscik = str_replace('&amp;#262;', "\xC4\x86", $tekscik);<br />
&nbsp;&nbsp; &nbsp; $tekscik = str_replace('&amp;#281;', "\xC4\x99", $tekscik);<br />
&nbsp;&nbsp; &nbsp; $tekscik = str_replace('&amp;#280;', "\xC4\x98", $tekscik);<br />
&nbsp;&nbsp; &nbsp; $tekscik = str_replace('&amp;#322;', "\xC5\x82", $tekscik);<br />
&nbsp;&nbsp; &nbsp; $tekscik = str_replace('&amp;#321;', "\xC5\x81", $tekscik);<br />
&nbsp;&nbsp; &nbsp; $tekscik = str_replace('&amp;#324;', "\xC5\x84", $tekscik);<br />
&nbsp;&nbsp; &nbsp; $tekscik = str_replace('&amp;#323;',"\xC5\x83", $tekscik);<br />
&nbsp;&nbsp; &nbsp; $tekscik = str_replace('?', "\xC3\xB3", $tekscik);<br />
&nbsp;&nbsp; &nbsp; $tekscik = str_replace('?', "\xC3\x93", $tekscik);<br />
&nbsp;&nbsp; &nbsp; $tekscik = str_replace('&amp;#347;', "\xC5\x9B", $tekscik);<br />
&nbsp;&nbsp; &nbsp; $tekscik = str_replace('&amp;#346;', "\xC5\x9A", $tekscik);<br />
&nbsp;&nbsp; &nbsp; $tekscik = str_replace('&amp;#380;', "\xC5\xBC", $tekscik);<br />
&nbsp;&nbsp; &nbsp; $tekscik = str_replace('&amp;#379;', "\xC5\xBB", $tekscik);<br />
&nbsp;&nbsp; &nbsp; $tekscik = str_replace('&amp;#378;', "\xC5\xBA", $tekscik);<br />
&nbsp;&nbsp; &nbsp; $tekscik = str_replace('&amp;#377;', "\xC5\xB9", $tekscik);&nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; return $tekscik;<br />
} // iso885922utf8</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
</div>
</div>
</div></div></body></html>
