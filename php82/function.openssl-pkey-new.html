<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
 <head>
  <meta http-equiv="content-type" content="text/html; CHARSET=UTF-8">
  <title>生成一个新的私钥</title>
<link media="all" rel="stylesheet" type="text/css" href="styles/03e73060321a0a848018724a6c83de7f-theme-base.css" />
<link media="all" rel="stylesheet" type="text/css" href="styles/03e73060321a0a848018724a6c83de7f-theme-medium.css" />

  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <link media="all" rel="stylesheet" type="text/css" href="style.css"/>
 </head>
 <body class="docs" class="docs"><div class="navbar navbar-fixed-top">
  <div class="navbar-inner clearfix">
    <ul class="nav" style="width: 100%">
      <li style="float: left;"><a href="function.openssl-pkey-get-public.html">? openssl_pkey_get_public</a></li>
      <li style="float: right;"><a href="function.openssl-private-decrypt.html">openssl_private_decrypt ?</a></li>
    </ul>
  </div>
</div>
<div id="breadcrumbs" class="clearfix">
  <ul class="breadcrumbs-container">
    <li><a href="index.html">PHP Manual</a></li>
    <li><a href="ref.openssl.html">OpenSSL 函数</a></li>
    <li>生成一个新的私钥</li>
  </ul>
</div>
<div id="layout">
  <div id="layout-content"><div id="function.openssl-pkey-new" class="refentry">
 <div class="refnamediv">
  <h1 class="refname">openssl_pkey_new</h1>
  <p class="verinfo">(PHP 4 &gt;= 4.2.0, PHP 5, PHP 7, PHP 8)</p><p class="refpurpose"><span class="refname">openssl_pkey_new</span> &mdash; <span class="dc-title">生成一个新的私钥</span></p>

 </div>

 <div class="refsect1 description" id="refsect1-function.openssl-pkey-new-description">
  <h3 class="title">说明</h3>
  <div class="methodsynopsis dc-description">
   <span class="methodname"><strong>openssl_pkey_new</strong></span>(<span class="methodparam"><span class="type">?</span><span class="type"><span class="type">array</span><span class="type"></span></span> <code class="parameter">$options</code><span class="initializer"> = <strong><code>null</code></strong></span></span>): <span class="type"><span class="type"><a href="class.opensslasymmetrickey.html" class="type OpenSSLAsymmetricKey">OpenSSLAsymmetricKey</a></span>|<span class="type"><span class="type false">false</span></span></span></div>

  <p class="para rdfs-comment">
   <span class="function"><strong>openssl_pkey_new()</strong></span> 生成一个新的私钥和公钥对。如何获取该密钥的公共组件参见以下示例。
  </p>
  <blockquote class="note"><p><strong class="note">Note</strong>: 
<span class="simpara">
 必须安装有效的 <var class="filename">openssl.cnf</var> 以保证此函数正确运行。参考有关<a href="openssl.installation.html" class="link">安装</a>的说明以获得更多信息。
</span>
</p></blockquote>
 </div>


 <div class="refsect1 parameters" id="refsect1-function.openssl-pkey-new-parameters">
  <h3 class="title">参数</h3>
  <p class="para">
   <dl>
    
     <dt>
<code class="parameter">options</code></dt>

     <dd>

      <p class="para">
       你可以使用 <code class="parameter">options</code> 参数微调密钥的生成（比如指定位数）。查看
       <span class="function"><a href="function.openssl-csr-new.html" class="function">openssl_csr_new()</a></span> 获取更多关于
       <code class="parameter">options</code> 的信息。
      </p>
     </dd>

    
   </dl>

  </p>
 </div>


 <div class="refsect1 returnvalues" id="refsect1-function.openssl-pkey-new-returnvalues">
  <h3 class="title">返回值</h3>
  <p class="para">
   成功时返回 <span class="classname"><a href="class.opensslasymmetrickey.html" class="classname">OpenSSLAsymmetricKey</a></span> 实例，错误则返回 <strong><code>false</code></strong> 。
  </p>
 </div>


 <div class="refsect1 changelog" id="refsect1-function.openssl-pkey-new-changelog">
  <h3 class="title">更新日志</h3>
  <table class="doctable informaltable">
   
    <thead>
     <tr>
      <th>版本</th>
      <th>说明</th>
     </tr>

    </thead>

    <tbody class="tbody">
     <tr>
      <td>8.0.0</td>
      <td>
       成功时此函数会返回 <span class="classname"><a href="class.opensslasymmetrickey.html" class="classname">OpenSSLAsymmetricKey</a></span> 的实例；在之前版本中，则会返回类似为
       <code class="literal">OpenSSL key</code> 的 <a href="language.types.resource.html" class="link">资源(resource)</a>。
      </td>
     </tr>

     <tr>
      <td>7.1.0</td>
      <td>添加了 <code class="parameter">curve_name</code> 配置参数使得可以创建 EC 密钥。</td>
     </tr>

    </tbody>
   
  </table>

 </div>


 <div class="refsect1 examples" id="refsect1-function.openssl-pkey-new-examples">
  <h3 class="title">示例</h3>
  <div class="example" id="example-1908">
   <p><strong>Example #1 Obtain the public key from a private key</strong></p>
   <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br />$private_key </span><span style="color: #007700">= </span><span style="color: #0000BB">openssl_pkey_new</span><span style="color: #007700">();<br /></span><span style="color: #0000BB">$public_key_pem </span><span style="color: #007700">= </span><span style="color: #0000BB">openssl_pkey_get_details</span><span style="color: #007700">(</span><span style="color: #0000BB">$private_key</span><span style="color: #007700">)[</span><span style="color: #DD0000">'key'</span><span style="color: #007700">];<br />echo </span><span style="color: #0000BB">$public_key_pem</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">$public_key </span><span style="color: #007700">= </span><span style="color: #0000BB">openssl_pkey_get_public</span><span style="color: #007700">(</span><span style="color: #0000BB">$public_key_pem</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">var_dump</span><span style="color: #007700">(</span><span style="color: #0000BB">$public_key</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
   </div>

   <div class="example-contents"><p>以上示例的输出类似于：</p></div>
   <div class="example-contents screen">
<div class="cdata"><pre>
-----BEGIN PUBLIC KEY-----
MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEArZFsmN2P6rx1Xt7YV95o
gcdlal0k3ryiIhFNzjwtRNNTXfEfBr6lUuaIJYQ8/XqEBX0hpcfuuF6tTRlonA3t
WLME0QFD93YVsAaXcy76YqjjqcRRodIBphAbYyyMI/lXkQAdn7kbAmr7neSOsMYJ
El9Wo4Hl4oG6e52ZnYHyqW9dxh4hX93eupR2TmcCdVf+r9xoHewP0KJYSHt7vDUX
AQlWYcQiWHIadFsmL0orr6mutlXFReoHbesgKY9/3YLOu0JfxflSjIZ2JeL1NTl1
MsmODsUwgAUrwnWKKx+eQUP5g3GnSB3dPkRh9zRVRiLNWbCugyjrf3e6DgQWrW7j
pwIDAQAB
-----END PUBLIC KEY-----
resource(5) of type (OpenSSL key)
</pre></div>
   </div>
  </div>
 </div>


</div><div id="usernotes">
 <div class="head">
  <h3 class="title">User Contributed Notes</h3>
 </div>
<div id="allnotes">  <a name="126637""></a>
  <div class="note">
   <strong class="user">Andrew</strong>
   <a href="#126637" class="date">24-Nov-2021 07:17</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
It's not documented here but you can also create ECC keys from existing key parameters (e.g. from JWK):<br />
<br />
<span class="default">&lt;?php<br />
$key </span><span class="keyword">= </span><span class="default">openssl_pkey_new</span><span class="keyword">([<br />
&nbsp;&nbsp;&nbsp; </span><span class="string">'ec' </span><span class="keyword">=&gt; [<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">'curve_name' </span><span class="keyword">=&gt; </span><span class="string">'prime256v1'</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">'x' </span><span class="keyword">=&gt; </span><span class="default">$someXValue</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">'y' </span><span class="keyword">=&gt; </span><span class="default">$someYValue</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">'d' </span><span class="keyword">=&gt; </span><span class="default">$someDValue<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">]<br />
]);<br />
</span><span class="default">?&gt;<br />
</span><br />
You can just provide x/y if it's a public key, or you can just provide d if it's a private key.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="123488""></a>
  <div class="note">
   <strong class="user">Jan</strong>
   <a href="#123488" class="date">03-Jan-2019 09:02</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
In case this function returns false, then check your openssl.cnf and make sure that in the [req] section of this file the entry default_bits is not commented out.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="123410""></a>
  <div class="note">
   <strong class="user">gomez dot alejandre at gmail dot com</strong>
   <a href="#123410" class="date">08-Dec-2018 01:43</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Not forget the $configArgs for windows users :D, or the method throws a error with the primary key<br />
<br />
//write your configurations :D<br />
$configargs = array(<br />
&nbsp; "config" =&gt; "C:/xampp/php/extras/openssl/openssl.cnf",<br />
&nbsp; 'private_key_bits'=&gt; 2048,<br />
&nbsp; 'default_md' =&gt; "sha256",<br />
);<br />
<br />
// Create the keypair<br />
$res=openssl_pkey_new($configargs);<br />
// Get private key<br />
openssl_pkey_export($res, $privKey,NULL,$configargs);<br />
<br />
and it's for all methods ._ .<br />
<br />
a full implementation example here.<br />
<br />
https://gist.github.com/DuckHunter213/269a0efd17e709f7f1f177ae7da46ad1<br />
<br />
this error take me 3 full days you'r welcome :)</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="120814""></a>
  <div class="note">
   <strong class="user">dodginess at yahoo dot com</strong>
   <a href="#120814" class="date">15-Mar-2017 11:39</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you're using openssl_pkey_new() in conjunction with openssl_csr_new() and want to change the CSR digest algorithm as well as specify a custom key size, the configuration override should be defined once and sent to both functions:<br />
<br />
<span class="default">&lt;?php<br />
$config </span><span class="keyword">= array(<br />
&nbsp;&nbsp;&nbsp; </span><span class="string">'digest_alg' </span><span class="keyword">=&gt; </span><span class="string">'sha1'</span><span class="keyword">,<br />
&nbsp;&nbsp;&nbsp; </span><span class="string">'private_key_bits' </span><span class="keyword">=&gt; </span><span class="default">2048</span><span class="keyword">,<br />
&nbsp;&nbsp;&nbsp; </span><span class="string">'private_key_type' </span><span class="keyword">=&gt; </span><span class="default">OPENSSL_KEYTYPE_RSA</span><span class="keyword">,<br />
);<br />
<br />
</span><span class="default">$privkey </span><span class="keyword">= </span><span class="default">openssl_pkey_new</span><span class="keyword">(</span><span class="default">$config</span><span class="keyword">);<br />
<br />
</span><span class="default">$csr </span><span class="keyword">= </span><span class="default">openssl_csr_new</span><span class="keyword">(</span><span class="default">$dn</span><span class="keyword">, </span><span class="default">$privkey</span><span class="keyword">, </span><span class="default">$config</span><span class="keyword">);<br />
</span><span class="default">?&gt;<br />
</span><br />
Although openssl_pkey_new() will accept the 'digest_alg' argument it won't use it, and setting the value has no effect unless you also set this value for openssl_csr_new(). The reason for this is that the $config array is acting as a drop-in replacement for the values found in the openssl.cnf file, so it must contain all of the override values that you need even if the function they're being sent to won't use them.<br />
<br />
Also, if you change the 'digest_alg' to something like 'sha256' and still get an MD5 signed CSR check your openssl.cnf file to see whether the digest algorithm you want to use is actually supported.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="116765""></a>
  <div class="note">
   <strong class="user">scott at brynen dot com</strong>
   <a href="#116765" class="date">24-Feb-2015 09:36</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you try and generate a new key using openssl_pkey_new(), and need to specify the size of the key, the key MUST be type-bound to integer<br />
<br />
// works<br />
$keysize = 1024;<br />
$ssl = openssl_pkey_new (array('private_key_bits' =&gt; $keysize));<br />
<br />
// fails<br />
$keysize = "1024";<br />
$ssl = openssl_pkey_new (array('private_key_bits' =&gt; $keysize));<br />
<br />
// works (force to int)<br />
$keysize = "1024";<br />
$ssl = openssl_pkey_new (array('private_key_bits' =&gt; (int)$keysize));</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="111769""></a>
  <div class="note">
   <strong class="user">dirt at awoms dot com</strong>
   <a href="#111769" class="date">26-Mar-2013 08:52</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Working example:<br />
<br />
$config = array(<br />
&nbsp;&nbsp;&nbsp; "digest_alg" =&gt; "sha512",<br />
&nbsp;&nbsp;&nbsp; "private_key_bits" =&gt; 4096,<br />
&nbsp;&nbsp;&nbsp; "private_key_type" =&gt; OPENSSL_KEYTYPE_RSA,<br />
);<br />
&nbsp;&nbsp;&nbsp; <br />
// Create the private and public key<br />
$res = openssl_pkey_new($config);<br />
<br />
// Extract the private key from $res to $privKey<br />
openssl_pkey_export($res, $privKey);<br />
<br />
// Extract the public key from $res to $pubKey<br />
$pubKey = openssl_pkey_get_details($res);<br />
$pubKey = $pubKey["key"];<br />
<br />
$data = 'plaintext data goes here';<br />
<br />
// Encrypt the data to $encrypted using the public key<br />
openssl_public_encrypt($data, $encrypted, $pubKey);<br />
<br />
// Decrypt the data using the private key and store the results in $decrypted<br />
openssl_private_decrypt($encrypted, $decrypted, $privKey);<br />
<br />
echo $decrypted;</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="108951""></a>
  <div class="note">
   <strong class="user">zelnaga at gmail dot com</strong>
   <a href="#108951" class="date">07-Jun-2012 05:21</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Getting the public key corresponding to a particular private key, through the methods provided for by OpenSSL, is a bit cumbersome. An easier way to do it is to use phpseclib, a pure PHP RSA implementation:<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">include(</span><span class="string">'Crypt/RSA.php'</span><span class="keyword">);<br />
<br />
</span><span class="default">$rsa </span><span class="keyword">= new </span><span class="default">Crypt_RSA</span><span class="keyword">();<br />
</span><span class="default">$rsa</span><span class="keyword">-&gt;</span><span class="default">loadKey</span><span class="keyword">(</span><span class="string">'...'</span><span class="keyword">);<br />
<br />
</span><span class="default">$privatekey </span><span class="keyword">= </span><span class="default">$rsa</span><span class="keyword">-&gt;</span><span class="default">getPrivateKey</span><span class="keyword">();<br />
</span><span class="default">$publickey </span><span class="keyword">= </span><span class="default">$rsa</span><span class="keyword">-&gt;</span><span class="default">getPublicKey</span><span class="keyword">();<br />
</span><span class="default">?&gt;<br />
</span><br />
Doesn't require any extensions be installed.&nbsp; It'll use bcmath or gmp if they're available, for speed, but doesn't even require those.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="102392""></a>
  <div class="note">
   <strong class="user">jthijssen at notloxic dot nl</strong>
   <a href="#102392" class="date">11-Feb-2011 06:17</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you want to change the default private key size (1024) too something else you can use the following code:<br />
&nbsp;<br />
<span class="default">&lt;?php <br />
$config </span><span class="keyword">= array(</span><span class="string">'private_key_bits' </span><span class="keyword">=&gt; </span><span class="default">512</span><span class="keyword">);<br />
</span><span class="default">$privKey </span><span class="keyword">= </span><span class="default">openssl_pkey_new</span><span class="keyword">(</span><span class="default">$config</span><span class="keyword">);<br />
<br />
</span><span class="default">?&gt;<br />
</span><br />
Mind though that the minimum number of bits is 384. Any lower will trigger an error.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="82253""></a>
  <div class="note">
   <strong class="user">Brad</strong>
   <a href="#82253" class="date">02-Apr-2008 12:17</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
It's easier than all that, if you just want the keys:<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="comment">// Create the keypair<br />
</span><span class="default">$res</span><span class="keyword">=</span><span class="default">openssl_pkey_new</span><span class="keyword">();<br />
<br />
</span><span class="comment">// Get private key<br />
</span><span class="default">openssl_pkey_export</span><span class="keyword">(</span><span class="default">$res</span><span class="keyword">, </span><span class="default">$privkey</span><span class="keyword">);<br />
<br />
</span><span class="comment">// Get public key<br />
</span><span class="default">$pubkey</span><span class="keyword">=</span><span class="default">openssl_pkey_get_details</span><span class="keyword">(</span><span class="default">$res</span><span class="keyword">);<br />
</span><span class="default">$pubkey</span><span class="keyword">=</span><span class="default">$pubkey</span><span class="keyword">[</span><span class="string">"key"</span><span class="keyword">];<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="42800""></a>
  <div class="note">
   <strong class="user">NOSPAM dot alchaemist at hiperlinux dot com dot ar</strong>
   <a href="#42800" class="date">30-May-2004 12:17</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
As you probably found, getting the public key is not as direct as you might think with this documentation.<br />
<br />
You can easily get into messages like:<br />
<br />
Warning: openssl_pkey_get_public(): Don't know how to get public key from this private key (the documentation lied) in D:\www\keys.php on line 4<br />
<br />
The correct steps to get the whole thing seem to be these:<br />
<br />
&lt;?<br />
$dn = array("countryName" =&gt; 'XX', "stateOrProvinceName" =&gt; 'State', "localityName" =&gt; 'SomewhereCity', "organizationName" =&gt; 'MySelf', "organizationalUnitName" =&gt; 'Whatever', "commonName" =&gt; 'mySelf', "emailAddress" =&gt; 'user@domain.com');<br />
$privkeypass = '1234';<br />
$numberofdays = 365;<br />
<br />
$privkey = openssl_pkey_new();<br />
$csr = openssl_csr_new($dn, $privkey);<br />
$sscert = openssl_csr_sign($csr, null, $privkey, $numberofdays);<br />
openssl_x509_export($sscert, $publickey);<br />
openssl_pkey_export($privkey, $privatekey, $privkeypass);<br />
openssl_csr_export($csr, $csrStr);<br />
<br />
echo $privatekey; // Will hold the exported PriKey<br />
echo $publickey;&nbsp; // Will hold the exported PubKey<br />
echo $csrStr;&nbsp; &nbsp;&nbsp; // Will hold the exported Certificate<br />
?&gt;<br />
<br />
Now all you need to do is to make some research on each individual function.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
</div>
</div>
</div></div></body></html>
