<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
 <head>
  <meta http-equiv="content-type" content="text/html; CHARSET=UTF-8">
  <title>从服务端检回一个元素</title>
<link media="all" rel="stylesheet" type="text/css" href="styles/03e73060321a0a848018724a6c83de7f-theme-base.css" />
<link media="all" rel="stylesheet" type="text/css" href="styles/03e73060321a0a848018724a6c83de7f-theme-medium.css" />

  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <link media="all" rel="stylesheet" type="text/css" href="style.css"/>
 </head>
 <body class="docs" class="docs"><div class="navbar navbar-fixed-top">
  <div class="navbar-inner clearfix">
    <ul class="nav" style="width: 100%">
      <li style="float: left;"><a href="memcache.flush.html">? Memcache::flush</a></li>
      <li style="float: right;"><a href="memcache.getextendedstats.html">Memcache::getExtendedStats ?</a></li>
    </ul>
  </div>
</div>
<div id="breadcrumbs" class="clearfix">
  <ul class="breadcrumbs-container">
    <li><a href="index.html">PHP Manual</a></li>
    <li><a href="class.memcache.html">Memcache</a></li>
    <li>从服务端检回一个元素</li>
  </ul>
</div>
<div id="layout">
  <div id="layout-content"><div id="memcache.get" class="refentry">
 <div class="refnamediv">
  <h1 class="refname">Memcache::get</h1>
  <p class="verinfo">(PECL memcache &gt;= 0.2.0)</p><p class="refpurpose"><span class="refname">Memcache::get</span> &mdash; <span class="dc-title">从服务端检回一个元素</span></p>

 </div>

 <div class="refsect1 description" id="refsect1-memcache.get-description">
  <h3 class="title">说明</h3>
  <div class="methodsynopsis dc-description">
   <span class="methodname"><strong>Memcache::get</strong></span>(<span class="methodparam"><span class="type">string</span> <code class="parameter">$key</code></span>, <span class="methodparam"><span class="type">int</span> <code class="parameter reference">&$flags</code><span class="initializer"> = ?</span></span>): <span class="type">string</span></div>

  <div class="methodsynopsis dc-description"><span class="methodname"><strong>Memcache::get</strong></span>(<span class="methodparam"><span class="type">array</span> <code class="parameter">$keys</code></span>, <span class="methodparam"><span class="type">array</span> <code class="parameter reference">&$flags</code><span class="initializer"> = ?</span></span>): <span class="type">array</span></div>

  
  <p class="para rdfs-comment">
   如果此时服务器上存在这样的 <code class="parameter">key</code>，<span class="function"><strong>Memcache::get()</strong></span> 返回先前存储的元素数据。
  </p>

  <p class="para">
  你可以给<span class="function"><strong>Memcache::get()</strong></span>方法传递一个数组（多个key）来获取一个数组的元素值，返回的数组仅仅包含从
  服务端查找到的key-value对。
  </p>
  
 </div>

  
 <div class="refsect1 parameters" id="refsect1-memcache.get-parameters">
  <h3 class="title">参数</h3>
  <p class="para">
   <dl>
    
     <dt>
<code class="parameter">key</code></dt>

     <dd>

      <p class="para">
       要获取值的key或key数组。
      </p>
     </dd>

    
    
     <dt>
<code class="parameter">flags</code></dt>

     <dd>

      <p class="para">
      如果给定这个参数（以引用方式传递），该参数会被写入一些key对应的信息。这些标记和<span class="function"><a href="memcache.set.html" class="function">Memcache::set()</a></span>方法中的同名参数
      意义相同。用int值的低位保留了pecl/memcache的内部用法（比如：用来说明压缩和序列化状态）。（译注：最后一位表明是否序列化，倒数第二位表明是否经过压缩， 
      比如：如果此值为1表示经过序列化，但未经过压缩，2表明压缩而未序列化，3表明压缩并且序列化，0表明未经过压缩和序列化，具体算法可查找linux文件权限算法相关资料）
      </p>
     </dd>

    
   </dl>

  </p>
 </div>


 <div class="refsect1 returnvalues" id="refsect1-memcache.get-returnvalues">
  <h3 class="title">返回值</h3>
  <p class="para">
   返回与 <code class="parameter">key</code> 关联的值或当 <code class="parameter">key</code> 为 <span class="type">array</span> 时找到的键值对数组。失败时返回
   <strong><code>false</code></strong>，未找到 <code class="parameter">key</code> 或 <code class="parameter">key</code> 为空 <span class="type">array</span>。
  </p>
 </div>


 <div class="refsect1 examples" id="refsect1-memcache.get-examples">
  <h3 class="title">示例</h3>
  <p class="para">
   <div class="example" id="">
    <p><strong>Example #1 <span class="function"><strong>Memcache::get()</strong></span> 示例</strong></p>
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br /><br /></span><span style="color: #FF8000">/* procedural API */<br /></span><span style="color: #0000BB">$memcache_obj </span><span style="color: #007700">= </span><span style="color: #0000BB">memcache_connect</span><span style="color: #007700">(</span><span style="color: #DD0000">'memcache_host'</span><span style="color: #007700">, </span><span style="color: #0000BB">11211</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">$var </span><span style="color: #007700">= </span><span style="color: #0000BB">memcache_get</span><span style="color: #007700">(</span><span style="color: #0000BB">$memcache_obj</span><span style="color: #007700">, </span><span style="color: #DD0000">'some_key'</span><span style="color: #007700">);<br /><br /></span><span style="color: #FF8000">/* OO API */<br /></span><span style="color: #0000BB">$memcache_obj </span><span style="color: #007700">= new </span><span style="color: #0000BB">Memcache</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">$memcache_obj</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">connect</span><span style="color: #007700">(</span><span style="color: #DD0000">'memcache_host'</span><span style="color: #007700">, </span><span style="color: #0000BB">11211</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">$var </span><span style="color: #007700">= </span><span style="color: #0000BB">$memcache_obj</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">get</span><span style="color: #007700">(</span><span style="color: #DD0000">'some_key'</span><span style="color: #007700">);<br /><br /></span><span style="color: #FF8000">/* <br />你同样可以使用数组key作为参数，如果某个元素没有在服务端发现，结果数组中将不会包含这些key。<br />*/<br /><br />/* procedural API */<br /></span><span style="color: #0000BB">$memcache_obj </span><span style="color: #007700">= </span><span style="color: #0000BB">memcache_connect</span><span style="color: #007700">(</span><span style="color: #DD0000">'memcache_host'</span><span style="color: #007700">, </span><span style="color: #0000BB">11211</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">$var </span><span style="color: #007700">= </span><span style="color: #0000BB">memcache_get</span><span style="color: #007700">(</span><span style="color: #0000BB">$memcache_obj</span><span style="color: #007700">, Array(</span><span style="color: #DD0000">'some_key'</span><span style="color: #007700">, </span><span style="color: #DD0000">'another_key'</span><span style="color: #007700">));<br /><br /></span><span style="color: #FF8000">/* OO API */<br /></span><span style="color: #0000BB">$memcache_obj </span><span style="color: #007700">= new </span><span style="color: #0000BB">Memcache</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">$memcache_obj</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">connect</span><span style="color: #007700">(</span><span style="color: #DD0000">'memcache_host'</span><span style="color: #007700">, </span><span style="color: #0000BB">11211</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">$var </span><span style="color: #007700">= </span><span style="color: #0000BB">$memcache_obj</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">get</span><span style="color: #007700">(Array(</span><span style="color: #DD0000">'some_key'</span><span style="color: #007700">, </span><span style="color: #DD0000">'second_key'</span><span style="color: #007700">));<br /><br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
    </div>

   </div>
  </p>
 </div>


</div><div id="usernotes">
 <div class="head">
  <h3 class="title">User Contributed Notes</h3>
 </div>
<div id="allnotes">  <a name="115870""></a>
  <div class="note">
   <strong class="user">csongor at halmai dot hu</strong>
   <a href="#115870" class="date">07-Oct-2014 04:27</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Avoid reading too many values from memcahce. Each get() consumes some memory. You should cache the values instead, once they are read. Illustration of bad practice:<br />
<br />
<span class="default">&lt;?php&nbsp;&nbsp; </span><span class="comment">// reading from memcache leaks<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$m </span><span class="keyword">= new </span><span class="default">Memcache</span><span class="keyword">();<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$m </span><span class="keyword">-&gt; </span><span class="default">connect</span><span class="keyword">( </span><span class="string">"localhost"</span><span class="keyword">, </span><span class="string">"11211" </span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$m </span><span class="keyword">-&gt; </span><span class="default">add</span><span class="keyword">(</span><span class="string">"foo"</span><span class="keyword">, </span><span class="string">"bar"</span><span class="keyword">);<br />
<br />
&nbsp;&nbsp;&nbsp; for(;;) {&nbsp; </span><span class="comment">// this "endless" loop will finish because it eats up all the memory<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$res </span><span class="keyword">= </span><span class="default">$m </span><span class="keyword">-&gt; </span><span class="default">get</span><span class="keyword">(</span><span class="string">"foo"</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; print </span><span class="default">memory_get_usage</span><span class="keyword">().</span><span class="string">"\n"</span><span class="keyword">;&nbsp; </span><span class="comment">// this writes bigger and bigger numbers<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">}</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="114227""></a>
  <div class="note">
   <strong class="user">a dot karabiowski at gmx dot net</strong>
   <a href="#114227" class="date">27-Jan-2014 09:19</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Signature is not correct.<br />
<br />
<span class="default">&lt;?php <br />
$memcache </span><span class="keyword">= new </span><span class="default">Memcache</span><span class="keyword">();<br />
</span><span class="default">$memcache</span><span class="keyword">-&gt;</span><span class="default">connect</span><span class="keyword">(</span><span class="string">'localhost'</span><span class="keyword">, </span><span class="default">11211</span><span class="keyword">);<br />
class </span><span class="default">Test </span><span class="keyword">{ public </span><span class="default">$property </span><span class="keyword">= </span><span class="string">"testvalue"</span><span class="keyword">; }<br />
</span><span class="default">$test </span><span class="keyword">= new </span><span class="default">Test</span><span class="keyword">();<br />
</span><span class="default">$memcache</span><span class="keyword">-&gt;</span><span class="default">set</span><span class="keyword">(</span><span class="string">"asdf"</span><span class="keyword">, </span><span class="default">$test</span><span class="keyword">);<br />
</span><span class="default">var_dump</span><span class="keyword">(</span><span class="default">$memcache</span><span class="keyword">-&gt;</span><span class="default">get</span><span class="keyword">(</span><span class="string">"asdf"</span><span class="keyword">));<br />
</span><span class="comment">/* will return the object, not the string:<br />
&nbsp;&nbsp;&nbsp; class Test#3 (1) {<br />
&nbsp;&nbsp; &nbsp;&nbsp; public $property =&gt;<br />
&nbsp;&nbsp; &nbsp;&nbsp; string(9) "testvalue"<br />
&nbsp;&nbsp;&nbsp; }<br />
*/<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="112236""></a>
  <div class="note">
   <strong class="user">bijay dot rungta at gmail dot com</strong>
   <a href="#112236" class="date">21-May-2013 06:31</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Note that if you include spaces in your keys when saving Data and use array of keys to get the Data, The returned array will replace spaces with underscores in the keys. <br />
<br />
<span class="default">&lt;?php<br />
<br />
$memcache </span><span class="keyword">= new </span><span class="default">Memcache</span><span class="keyword">;<br />
</span><span class="default">$memcache</span><span class="keyword">-&gt;</span><span class="default">connect</span><span class="keyword">(</span><span class="string">'localhost'</span><span class="keyword">);<br />
</span><span class="default">$memcache</span><span class="keyword">-&gt;</span><span class="default">set</span><span class="keyword">(</span><span class="string">'my-key'</span><span class="keyword">, </span><span class="string">'value1'</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">300</span><span class="keyword">);<br />
</span><span class="default">$memcache</span><span class="keyword">-&gt;</span><span class="default">set</span><span class="keyword">(</span><span class="string">'key with space'</span><span class="keyword">, </span><span class="string">'value 2'</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">300</span><span class="keyword">);<br />
<br />
</span><span class="default">print_r</span><span class="keyword">(</span><span class="default">$memcache</span><span class="keyword">-&gt;</span><span class="default">get</span><span class="keyword">(array(</span><span class="string">'my-key'</span><span class="keyword">, </span><span class="string">'key with space'</span><span class="keyword">))); </span><span class="comment">// Array ( [my-key] =&gt; value1 [key_with_space] =&gt; value 2 )<br />
<br />
</span><span class="default">?&gt;<br />
</span><br />
Memcache replaces spaces with underscores when saving, it does so when doing a get too, but when you do a get with single key (string) you don't notice this as it merely returns the value. But when you do a get for array of keys, you would expect the same keys in the returned array but it replaces spaces by underscores in them.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="112056""></a>
  <div class="note">
   <strong class="user">clover at fromru dot com</strong>
   <a href="#112056" class="date">27-Apr-2013 12:14</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
$flags stays untouched if $key was not found on the server, it's helpfull to determine if bool(false) was stored:<br />
<br />
<span class="default">&lt;?php<br />
<br />
$memcache </span><span class="keyword">= new </span><span class="default">Memcache</span><span class="keyword">();<br />
<br />
</span><span class="default">$memcache</span><span class="keyword">-&gt;</span><span class="default">set</span><span class="keyword">(</span><span class="string">'test'</span><span class="keyword">, </span><span class="default">false</span><span class="keyword">); </span><span class="comment">// <br />
</span><span class="default">$flags </span><span class="keyword">= </span><span class="default">false</span><span class="keyword">;<br />
</span><span class="default">var_dump</span><span class="keyword">(</span><span class="default">$memcache</span><span class="keyword">-&gt;</span><span class="default">get</span><span class="keyword">(</span><span class="string">'test'</span><span class="keyword">, </span><span class="default">$flags</span><span class="keyword">)); </span><span class="comment">// bool(false)<br />
</span><span class="default">var_dump</span><span class="keyword">(</span><span class="default">$flags</span><span class="keyword">); </span><span class="comment">// int(256) - changed to int<br />
<br />
</span><span class="default">$memcache</span><span class="keyword">-&gt;</span><span class="default">delete</span><span class="keyword">(</span><span class="string">'test'</span><span class="keyword">);<br />
<br />
</span><span class="default">$flags </span><span class="keyword">= </span><span class="default">false</span><span class="keyword">;<br />
</span><span class="default">var_dump</span><span class="keyword">(</span><span class="default">$memcache</span><span class="keyword">-&gt;</span><span class="default">get</span><span class="keyword">(</span><span class="string">'test'</span><span class="keyword">, </span><span class="default">$flags</span><span class="keyword">)); </span><span class="comment">// bool(false)<br />
</span><span class="default">var_dump</span><span class="keyword">(</span><span class="default">$flags</span><span class="keyword">); </span><span class="comment">// bool(false) - untouched<br />
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="102485""></a>
  <div class="note">
   <strong class="user">Michael Brenden</strong>
   <a href="#102485" class="date">17-Feb-2011 02:46</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Beware, if there's a backslash present in the key name then the results are unpredictable and random.<br />
<br />
I was generating keys like this:<br />
<br />
$mc_key = get_called_class(). $_COOKIE['crumb'];<br />
<br />
This works fine when get_called_class() returns CLASSNAME.<br />
<br />
But then I began using namespaces, and get_class_class() of course returned NAMESPACE\CLASSNAME<br />
<br />
Well that backslash sends Memcache into quite the tizzy.<br />
No errors, mind you, just insanity.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="96912""></a>
  <div class="note">
   <strong class="user">janis at unrepublic dot com</strong>
   <a href="#96912" class="date">22-Mar-2010 02:00</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
For me it was the case that if such key doesn't exist, null is returned not false.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="86351""></a>
  <div class="note">
   <strong class="user">nate</strong>
   <a href="#86351" class="date">14-Oct-2008 08:18</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Be aware that when using the multi-key version, Memcache::get returns bool false if no servers are configured for the pool (and possibly if other errors occur as well while attempting to fetch). Also, Memcache class throws annoying warnings on every get/set/delete-type calls if you have no servers added to the pool.
<br />

<br />
The following snippet var_dump's bool false, not an empty array like you might expect.
<br />

<br />
<span class="default">&lt;?php
<br />
$cache </span><span class="keyword">= new </span><span class="default">Memcache</span><span class="keyword">;
<br />

<br />
</span><span class="comment">// no $cache-&gt;addServer calls (for example,
<br />
</span><span class="default">due to temporarily disabling </span><span class="keyword">use </span><span class="default">of cache</span><span class="keyword">)
<br />

<br />
</span><span class="comment">// use @ symbol to ignore warning
<br />

<br />
</span><span class="default">var_dump</span><span class="keyword">(
<br />
&nbsp;&nbsp;&nbsp; @</span><span class="default">$cache</span><span class="keyword">-&gt;</span><span class="default">get</span><span class="keyword">(array(</span><span class="string">'one'</span><span class="keyword">, </span><span class="string">'two'</span><span class="keyword">))
<br />
);
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="84275""></a>
  <div class="note">
   <strong class="user">jakub dot lopuszanski at nasza-klasa dot pl</strong>
   <a href="#84275" class="date">07-Jul-2008 07:39</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If deserialization fails for some reason, that is when memcache server returned flag 1 set, but the value was not a correctly serialized PHP data,
<br />
then Memcache::get acts in a following way:
<br />

<br />
If it was called with a single key to retrieve, then a warning is raised, but since it was not actually a bug of a server, the warning says something confusing like "Memcached Server Error: null" and the function returns bool(false).
<br />

<br />
If it was called by passing an array (even with a single element in it), then the warning is not raised and the resulting array contains a value bool(false).
<br />

<br />
Since there are some buffer overrun bugs present in Memcached Server, which from time to time cause overwriting of [part of] data and therefore rendering it impossible to deserialize, make sure to check if the result of Memcache::get contains only string, or deserialized structure. If the result is bool,dobule or long, then something went wrong.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
</div>
</div>
</div></div></body></html>
