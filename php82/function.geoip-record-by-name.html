<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
 <head>
  <meta http-equiv="content-type" content="text/html; CHARSET=UTF-8">
  <title>返回 GeoIP 数据库中详细的城市信息</title>
<link media="all" rel="stylesheet" type="text/css" href="styles/03e73060321a0a848018724a6c83de7f-theme-base.css" />
<link media="all" rel="stylesheet" type="text/css" href="styles/03e73060321a0a848018724a6c83de7f-theme-medium.css" />

  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <link media="all" rel="stylesheet" type="text/css" href="style.css"/>
 </head>
 <body class="docs" class="docs"><div class="navbar navbar-fixed-top">
  <div class="navbar-inner clearfix">
    <ul class="nav" style="width: 100%">
      <li style="float: left;"><a href="function.geoip-org-by-name.html">? geoip_org_by_name</a></li>
      <li style="float: right;"><a href="function.geoip-region-by-name.html">geoip_region_by_name ?</a></li>
    </ul>
  </div>
</div>
<div id="breadcrumbs" class="clearfix">
  <ul class="breadcrumbs-container">
    <li><a href="index.html">PHP Manual</a></li>
    <li><a href="ref.geoip.html">GeoIP 函数</a></li>
    <li>返回 GeoIP 数据库中详细的城市信息</li>
  </ul>
</div>
<div id="layout">
  <div id="layout-content"><div id="function.geoip-record-by-name" class="refentry">
 <div class="refnamediv">
  <h1 class="refname">geoip_record_by_name</h1>
  <p class="verinfo">(PECL geoip &gt;= 0.2.0)</p><p class="refpurpose"><span class="refname">geoip_record_by_name</span> &mdash; <span class="dc-title">返回 GeoIP 数据库中详细的城市信息</span></p>

 </div>
 <div class="refsect1 description" id="refsect1-function.geoip-record-by-name-description">
  <h3 class="title">说明</h3>
  <div class="methodsynopsis dc-description">
   <span class="methodname"><strong>geoip_record_by_name</strong></span>(<span class="methodparam"><span class="type">string</span> <code class="parameter">$hostname</code></span>): <span class="type">array</span></div>


  <p class="para rdfs-comment">
   <span class="function"><strong>geoip_record_by_name()</strong></span> 函数将会返回主机或者 IP 地址所对应的记录信息。
  </p>
  <p class="para">
   该函数在 GeoLite City 版本和商业 GeoIP City 版本中可用。 版本不对的话，将会抛出一个警告。
  </p>
  <p class="para">
   返回的关联数组不同的键名对应如下：
  </p>
  <p class="para">
   <ul class="itemizedlist">
    <li class="listitem">
     <span class="simpara">
      &quot;continent_code&quot; -- 由两个字符组成的洲简称。(要求 GeoIP 的库版本是1.0.4以上)
     </span>
    </li>
    <li class="listitem">
     <span class="simpara">
      &quot;country_code&quot; -- 由2个字母组成的国家简称。(参见
      <span class="function"><a href="function.geoip-country-code-by-name.html" class="function">geoip_country_code_by_name()</a></span>)
     </span>
    </li>
    <li class="listitem">
     <span class="simpara">
      &quot;country_code3&quot; -- 由三个字母组成的国家简称。(参见
      <span class="function"><a href="function.geoip-country-code3-by-name.html" class="function">geoip_country_code3_by_name()</a></span>)
     </span>
    </li>
    <li class="listitem">
     <span class="simpara">
      &quot;country_name&quot; -- 国家名称 (参见
      <span class="function"><a href="function.geoip-country-name-by-name.html" class="function">geoip_country_name_by_name()</a></span>)
     </span>
    </li>
    <li class="listitem">
     <span class="simpara">
      &quot;region&quot; -- 地区代码 (比如: CA 对应 California)
     </span>
    </li>
    <li class="listitem">
     <span class="simpara">
      &quot;city&quot; -- 城市名称。
     </span>
    </li>
    <li class="listitem">
     <span class="simpara">
      &quot;postal_code&quot; -- 邮编，FSA 或者 Zip 编码。
     </span>
    </li>
    <li class="listitem">
     <span class="simpara">
      &quot;latitude&quot; -- 有符号的 <span class="type">float</span> 纬度。
     </span>
    </li>
    <li class="listitem">
     <span class="simpara">
      &quot;longitude&quot; -- 有符号的 <span class="type">float</span> 经度。
     </span>
    </li>
    <li class="listitem">
     <span class="simpara">
      &quot;dma_code&quot; -- 指定市场区号 (只支持美国和加拿大)
     </span>
    </li>
    <li class="listitem">
     <span class="simpara">
      &quot;area_code&quot; -- PSTN （公共交换电话网络）地区代码。 (比如: 212)
     </span>
    </li>
   </ul>
  </p>
 </div>


 <div class="refsect1 parameters" id="refsect1-function.geoip-record-by-name-parameters">
  <h3 class="title">参数</h3>
  <p class="para">
   <dl>
    
     <dt>
<code class="parameter">hostname</code></dt>

     <dd>

      <p class="para">
       所要查找的主机或者 IP 地址。
      </p>
     </dd>

    
   </dl>

  </p>
 </div>

 <div class="refsect1 returnvalues" id="refsect1-function.geoip-record-by-name-returnvalues">
  <h3 class="title">返回值</h3>
  <p class="para">
   成功，返回关联数组，未找到相关信息则返回 <strong><code>false</code></strong> 。
  </p>
 </div>


 <div class="refsect1 changelog" id="refsect1-function.geoip-record-by-name-changelog">
  <h3 class="title">更新日志</h3>
  <p class="para">
   <table class="doctable informaltable">
    
     <thead>
      <tr>
       <th>版本</th>
       <th>说明</th>
      </tr>

     </thead>

     <tbody class="tbody">
      <tr>
       <td>PECL geoip 1.0.4</td>
       <td>
        给 GeoIP 1.4.4及以上版本的库添加 continent_code 字段。
       </td>
      </tr>

      <tr>
       <td>PECL geoip 1.0.3</td>
       <td>
        添加 country_code3 和 country_name 字段。
       </td>
      </tr>

     </tbody>
    
   </table>

  </p>
 </div>


 <div class="refsect1 examples" id="refsect1-function.geoip-record-by-name-examples">
  <h3 class="title">示例</h3>
  <p class="para">
   <div class="example" id="">
    <p><strong>Example #1  <span class="function"><strong>geoip_record_by_name()</strong></span> 例子：</strong></p>
    <div class="example-contents"><p>
     以下示例将会输出包含 example.com 主机记录的数组。
    </p></div>
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br />$record </span><span style="color: #007700">= </span><span style="color: #0000BB">geoip_record_by_name</span><span style="color: #007700">(</span><span style="color: #DD0000">'www.example.com'</span><span style="color: #007700">);<br />if (</span><span style="color: #0000BB">$record</span><span style="color: #007700">) {<br />    </span><span style="color: #0000BB">print_r</span><span style="color: #007700">(</span><span style="color: #0000BB">$record</span><span style="color: #007700">);<br />}<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
    </div>

    <div class="example-contents"><p>以上示例会输出：</p></div>
    <div class="example-contents screen">
<div class="cdata"><pre>
Array
(
    [continent_code] =&gt; NA
    [country_code] =&gt; US
    [country_code3] =&gt; USA
    [country_name] =&gt; United States
    [region] =&gt; CA
    [city] =&gt; Marina Del Rey
    [postal_code] =&gt; 
    [latitude] =&gt; 33.9776992798
    [longitude] =&gt; -118.435096741
    [dma_code] =&gt; 803
    [area_code] =&gt; 310
)
</pre></div>
    </div>
   </div>
  </p>
 </div>


</div><div id="usernotes">
 <div class="head">
  <h3 class="title">User Contributed Notes</h3>
 </div>
<div id="allnotes">  <a name="128429""></a>
  <div class="note">
   <strong class="user">Anonymous</strong>
   <a href="#128429" class="date">25-Apr-2023 06:49</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
The array for region produces a number now instead of the 2 letter code.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="114177""></a>
  <div class="note">
   <strong class="user">bogdan at grabinski dot com</strong>
   <a href="#114177" class="date">21-Jan-2014 05:02</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I use this additional code in my error handler class to suppress "PHP Notice" send by the function geoip_record_by_name() in case of IP not found. No e-mails or echo on display is welcome for this notice in development environment. <br />
<br />
public static function Handler($errNo, $errStr, $errFile, $errLine){<br />
&nbsp;&nbsp; $backtrace = ErrorHandler::GetBacktrace(2);<br />
&nbsp;&nbsp; // detection of unwelcome&nbsp; PHP Notice and its ignoring.<br />
&nbsp;&nbsp; if($errNo == E_NOTICE &amp;&amp; preg_match('/^geoip_record_by_name.*Host.*not found$/', $errStr)){<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
<br />
The rest of normal error handler code remains.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="112120""></a>
  <div class="note">
   <strong class="user">etbwebdesign.com</strong>
   <a href="#112120" class="date">07-May-2013 03:42</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I know this may be obvious to some but I thought I would post it anyway to help others. The GEOIP section of the PHP site is a bit limited in useful tips/documentation other than the initial functions and examples.<br />
<br />
If you are trying to get information about the specific user visiting your site, you should use their IP address via the remote address in the GEOIP function. In addition here are some useful bits of code to pull certain information from the function.<br />
<span class="default">&lt;?php<br />
</span><span class="comment"># Collect a specific users GEOIP info<br />
</span><span class="default">$info </span><span class="keyword">= </span><span class="default">geoip_record_by_name</span><span class="keyword">(</span><span class="default">$_SERVER</span><span class="keyword">[</span><span class="string">'REMOTE_ADDR'</span><span class="keyword">]);<br />
</span><span class="default">print_r </span><span class="keyword">(</span><span class="default">$info</span><span class="keyword">);<br />
<br />
</span><span class="comment"># To get the info from one specific field<br />
</span><span class="default">$country </span><span class="keyword">= </span><span class="default">$info</span><span class="keyword">[</span><span class="string">'country_name'</span><span class="keyword">];<br />
echo </span><span class="default">$country</span><span class="keyword">;<br />
<br />
</span><span class="comment"># To combine information from the array into a string<br />
</span><span class="default">$info </span><span class="keyword">= </span><span class="default">implode</span><span class="keyword">(</span><span class="string">"/"</span><span class="keyword">, </span><span class="default">$info</span><span class="keyword">);<br />
echo </span><span class="default">$info</span><span class="keyword">;<br />
</span><span class="default">?&gt;<br />
</span><br />
Note on field in this array is NOT included, the connection speed of the user. To find the connection speed/connection type the visitor has, you can use the geoip_id_by_name() function. Lastly it is a good idea on whatever platform you are using GEOIP on to make sure it's data is up-to-date. On most Linux/UNIX systems with terminal you can use "pear update-channels" and "pecl update-channels" commands to keep your libraries updated. This is a good idea because GEOIP databases and country/location codes often change over time.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="107150""></a>
  <div class="note">
   <strong class="user">wouter dot berben at ignitione dot com</strong>
   <a href="#107150" class="date">11-Jan-2012 01:04</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
This function returns a PHP Notice when a address can not be found.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
</div>
</div>
</div></div></body></html>
