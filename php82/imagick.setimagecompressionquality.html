<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
 <head>
  <meta http-equiv="content-type" content="text/html; CHARSET=UTF-8">
  <title>设置图片压缩的质量</title>
<link media="all" rel="stylesheet" type="text/css" href="styles/03e73060321a0a848018724a6c83de7f-theme-base.css" />
<link media="all" rel="stylesheet" type="text/css" href="styles/03e73060321a0a848018724a6c83de7f-theme-medium.css" />

  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <link media="all" rel="stylesheet" type="text/css" href="style.css"/>
 </head>
 <body class="docs" class="docs"><div class="navbar navbar-fixed-top">
  <div class="navbar-inner clearfix">
    <ul class="nav" style="width: 100%">
      <li style="float: left;"><a href="imagick.setimagecompression.html">? Imagick::setImageCompression</a></li>
      <li style="float: right;"><a href="imagick.setimagedelay.html">Imagick::setImageDelay ?</a></li>
    </ul>
  </div>
</div>
<div id="breadcrumbs" class="clearfix">
  <ul class="breadcrumbs-container">
    <li><a href="index.html">PHP Manual</a></li>
    <li><a href="class.imagick.html">Imagick</a></li>
    <li>设置图片压缩的质量</li>
  </ul>
</div>
<div id="layout">
  <div id="layout-content"><div id="imagick.setimagecompressionquality" class="refentry">
 <div class="refnamediv">
  <h1 class="refname">Imagick::setImageCompressionQuality</h1>
  <p class="verinfo">(PECL imagick 2, PECL imagick 3)</p><p class="refpurpose"><span class="refname">Imagick::setImageCompressionQuality</span> &mdash; <span class="dc-title">设置图片压缩的质量</span></p>

 </div>

 <div class="refsect1 description" id="refsect1-imagick.setimagecompressionquality-description">
  <h3 class="title">说明</h3>
  <div class="methodsynopsis dc-description">
   <span class="modifier">public</span> <span class="methodname"><strong>Imagick::setImageCompressionQuality</strong></span>(<span class="methodparam"><span class="type">int</span> <code class="parameter">$quality</code></span>): <span class="type">bool</span></div>

  <p class="para rdfs-comment">
    设置图片压缩的质量
  </p>
 </div>


 <div class="refsect1 parameters" id="refsect1-imagick.setimagecompressionquality-parameters">
  <h3 class="title">参数</h3>
  <p class="para">
   <dl>
    
     <dt>
<code class="parameter">quality</code></dt>

     <dd>

      <p class="para">
       配置压缩质量的整数
      </p>
     </dd>

    
   </dl>

  </p>
 </div>


 <div class="refsect1 returnvalues" id="refsect1-imagick.setimagecompressionquality-returnvalues">
  <h3 class="title">返回值</h3>
  <p class="para">
   成功时返回 <strong><code>true</code></strong>。
  </p>
 </div>


 <div class="refsect1 errors" id="refsect1-imagick.setimagecompressionquality-errors">
  <h3 class="title">错误／异常</h3>
  <p class="para">
   错误时抛出 ImagickException。
  </p>
 </div>




 <div class="refsect1 examples" id="refsect1-imagick.setimagecompressionquality-examples">
  <h3 class="title">示例</h3>
  <p class="para">
    <div class="example" id="">
      <p><strong>Example #1  <span class="function"><strong>Imagick::setImageCompressionQuality()</strong></span></strong></p>
      <div class="example-contents">
      <div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br /></span><span style="color: #007700">function </span><span style="color: #0000BB">setImageCompressionQuality</span><span style="color: #007700">(</span><span style="color: #0000BB">$imagePath</span><span style="color: #007700">, </span><span style="color: #0000BB">$quality</span><span style="color: #007700">) {<br />    </span><span style="color: #0000BB">$imagick </span><span style="color: #007700">= new </span><span style="color: #0000BB">\Imagick</span><span style="color: #007700">(</span><span style="color: #0000BB">realpath</span><span style="color: #007700">(</span><span style="color: #0000BB">$imagePath</span><span style="color: #007700">));<br />    </span><span style="color: #0000BB">$imagick</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">setImageCompressionQuality</span><span style="color: #007700">(</span><span style="color: #0000BB">$quality</span><span style="color: #007700">);<br />    </span><span style="color: #0000BB">header</span><span style="color: #007700">(</span><span style="color: #DD0000">"Content-Type: image/jpg"</span><span style="color: #007700">);<br />    echo </span><span style="color: #0000BB">$imagick</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">getImageBlob</span><span style="color: #007700">();<br />}<br /><br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
      </div>

    </div>
  </p>
 </div>


</div><div id="usernotes">
 <div class="head">
  <h3 class="title">User Contributed Notes</h3>
 </div>
<div id="allnotes">  <a name="128660""></a>
  <div class="note">
   <strong class="user">Anonymous</strong>
   <a href="#128660" class="date">04-Jul-2023 11:35</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
The setImageCompressionQuality method accepts an integer value as its argument, representing the desired compression quality for the image, from 0 to 100, where 0 represents the lowest quality (highest compression, most lossy), and 100 represents the highest quality (lowest compression, lossless).<br />
<br />
* Quality 0: Lowest quality, highest compression, most lossy. This will result in a very small file size, but the image will likely have noticeable artifacts and reduced clarity.<br />
<br />
* Quality 100: Highest quality, lowest compression, lossless. The image will retain all its original details, but the file size will be larger.<br />
<br />
In most cases, a quality value between 70 and 90 provides a good balance between file size and image quality. However, the optimal value depends on your specific use case and the level of compression you can tolerate while maintaining acceptable image clarity. It's best to experiment with different quality values to find the one that best suits you</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="123322""></a>
  <div class="note">
   <strong class="user">vhpvhp at msn dot com</strong>
   <a href="#123322" class="date">08-Nov-2018 09:30</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
For a PNG image, `setImageCompressionQuality()` is not work at all, length of the generated files are totally same.<br />
<br />
But I found an effective way, that is use `setOption('png:compression-level', 9)`, the value range is 0-9.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="109807""></a>
  <div class="note">
   <strong class="user">dylan dot arnold at gmail dot com</strong>
   <a href="#109807" class="date">23-Aug-2012 03:23</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I had strange results when trying to get good png compression.<br />
<br />
I used Imagick::COMPRESSION_ZIP<br />
<br />
Here are a few file sizes for a few compression levels.<br />
<br />
0: 236,100<br />
1: 274,035<br />
9: 258,379<br />
50: 241,282<br />
100: 240,156<br />
<br />
Note the best result at 0. Also I got thrown off for a long time trying to get similar results to gimp. Make sure your image depth is set to 8, it appears to be 16 bits per channel, at least for me.<br />
<br />
You can check with identify -verbose filename.png<br />
<br />
You can also strip a bit more file size with $image-&gt;stripImage();</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="109099""></a>
  <div class="note">
   <strong class="user">Anonymous</strong>
   <a href="#109099" class="date">20-Jun-2012 02:56</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
The default value fot the JPEG compression quality appears to be 86.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="97017""></a>
  <div class="note">
   <strong class="user">snipes2083 [at] yahoo com</strong>
   <a href="#97017" class="date">28-Mar-2010 11:35</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
This example shows how to set the compression type, set the compression quality, create a thumbnail and remove unnecessary data in order to reduce file size.
<br />

<br />
This will use the following functions in reference:
<br />
Imagick::setImageCompression
<br />
Imagick::setImageCompressionQuality
<br />
Imagick::stripImage
<br />
Imagick::thumbnailImage
<br />
Imagick::writeImage
<br />

<br />
<span class="default">&lt;?php
<br />
&nbsp;&nbsp;&nbsp; $image </span><span class="keyword">= </span><span class="string">'image.jpg'</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$directory </span><span class="keyword">= </span><span class="string">'/path/to/image'</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$image_location </span><span class="keyword">= </span><span class="default">$directory </span><span class="keyword">. </span><span class="string">"/" </span><span class="keyword">. </span><span class="default">$image</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$thumb_destination </span><span class="keyword">= </span><span class="default">$directory </span><span class="keyword">. </span><span class="string">"/t" </span><span class="keyword">. </span><span class="default">$image</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$compression_type </span><span class="keyword">= </span><span class="default">Imagick</span><span class="keyword">::</span><span class="default">COMPRESSION_JPEG</span><span class="keyword">;
<br />
&nbsp;&nbsp; 
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$im </span><span class="keyword">= new </span><span class="default">Imagick</span><span class="keyword">(</span><span class="default">$image_location</span><span class="keyword">);
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$thumbnail </span><span class="keyword">= </span><span class="default">$im</span><span class="keyword">-&gt;</span><span class="default">clone</span><span class="keyword">;
<br />

<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$thumbnail</span><span class="keyword">-&gt;</span><span class="default">setImageCompression</span><span class="keyword">(</span><span class="default">$compression_type</span><span class="keyword">);
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$thumbnail</span><span class="keyword">-&gt;</span><span class="default">setImageCompressionQuality</span><span class="keyword">(</span><span class="default">40</span><span class="keyword">);
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$thumbnail</span><span class="keyword">-&gt;</span><span class="default">stripImage</span><span class="keyword">();
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$thumbnail</span><span class="keyword">-&gt;</span><span class="default">thumbnailImage</span><span class="keyword">(</span><span class="default">100</span><span class="keyword">,</span><span class="default">null</span><span class="keyword">);
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$thumbnail</span><span class="keyword">-&gt;</span><span class="default">writeImage</span><span class="keyword">(</span><span class="default">$thumb_destination</span><span class="keyword">);
<br />
</span><span class="default">?&gt;
<br />
</span>
<br />
Now, obviously you don't have to do so much with the variables and the file location.&nbsp; I only used so many to demonstrate where the images are coming from and where they are going.
<br />

<br />
NOTE:&nbsp; The $thumbnail-&gt;thumbnailImage(100,null); keeps the aspect ration by setting the second parameter to null.&nbsp; Read about this at Imagick::thumbnailImage
<br />

<br />
There is another way to create thumbnails that works quite well if you want to crop the image rather than using the entire image.&nbsp; Check out Imagick::cropThumbnailImage</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
</div>
</div>
</div></div></body></html>
