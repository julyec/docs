<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
 <head>
  <meta http-equiv="content-type" content="text/html; CHARSET=UTF-8">
  <title>输出图象到浏览器或文件。</title>
<link media="all" rel="stylesheet" type="text/css" href="styles/03e73060321a0a848018724a6c83de7f-theme-base.css" />
<link media="all" rel="stylesheet" type="text/css" href="styles/03e73060321a0a848018724a6c83de7f-theme-medium.css" />

  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <link media="all" rel="stylesheet" type="text/css" href="style.css"/>
 </head>
 <body class="docs" class="docs"><div class="navbar navbar-fixed-top">
  <div class="navbar-inner clearfix">
    <ul class="nav" style="width: 100%">
      <li style="float: left;"><a href="function.imageistruecolor.html">? imageistruecolor</a></li>
      <li style="float: right;"><a href="function.imagelayereffect.html">imagelayereffect ?</a></li>
    </ul>
  </div>
</div>
<div id="breadcrumbs" class="clearfix">
  <ul class="breadcrumbs-container">
    <li><a href="index.html">PHP Manual</a></li>
    <li><a href="ref.image.html">GD 和图像处理 函数</a></li>
    <li>输出图象到浏览器或文件。</li>
  </ul>
</div>
<div id="layout">
  <div id="layout-content"><div id="function.imagejpeg" class="refentry">
 <div class="refnamediv">
  <h1 class="refname">imagejpeg</h1>
  <p class="verinfo">(PHP 4, PHP 5, PHP 7, PHP 8)</p><p class="refpurpose"><span class="refname">imagejpeg</span> &mdash; <span class="dc-title">输出图象到浏览器或文件。</span></p>

 </div>
 <div class="refsect1 description" id="refsect1-function.imagejpeg-description">
  <h3 class="title">说明</h3>
  <div class="methodsynopsis dc-description">
   <span class="methodname"><strong>imagejpeg</strong></span>(<span class="methodparam"><span class="type"><a href="class.gdimage.html" class="type GdImage">GdImage</a></span> <code class="parameter">$image</code></span>, <span class="methodparam"><span class="type"><span class="type">resource</span>|<span class="type">string</span>|<span class="type">null</span></span> <code class="parameter">$file</code><span class="initializer"> = <strong><code>null</code></strong></span></span>, <span class="methodparam"><span class="type">int</span> <code class="parameter">$quality</code><span class="initializer"> = -1</span></span>): <span class="type">bool</span></div>

  <p class="para rdfs-comment">
   <span class="function"><strong>imagejpeg()</strong></span> 从指定 <code class="parameter">image</code> 图像创建 <abbr title="Joint Photographic Experts Group">JPEG</abbr> 文件。
  </p>
 </div>

 <div class="refsect1 parameters" id="refsect1-function.imagejpeg-parameters">
  <h3 class="title">参数</h3>
  <p class="para">
   <dl>
    <dt>

<code class="parameter">image</code></dt>
<dd>
<p class="para">由图象创建函数(例如<span class="function"><a href="function.imagecreatetruecolor.html" class="function">imagecreatetruecolor()</a></span>)返回的 
<span class="classname"><a href="class.gdimage.html" class="classname">GdImage</a></span> 对象。</p></dd>

    
     <dt>
<code class="parameter">file</code></dt>

     <dd>

      <p class="para">文件保存的路径或者已打开的流资源（此方法返回后自动关闭该流资源），如果未设置或为 <strong><code>null</code></strong>，将会直接输出原始图象流。</p>
     </dd>

    
    
     <dt>
<code class="parameter">quality</code></dt>

     <dd>

      <p class="para">
       <code class="parameter">quality</code> 为可选项，范围从
       0（最差质量，文件最小）到 100（最佳质量，文件最大）。默认值（<code class="literal">-1</code>）使用
       IJG 默认的质量值（大约 75）。
      </p>
     </dd>

    
   </dl>

  </p>
 </div>

 <div class="refsect1 returnvalues" id="refsect1-function.imagejpeg-returnvalues">
  <h3 class="title">返回值</h3>
  <p class="para">
   成功时返回 <strong><code>true</code></strong>， 或者在失败时返回 <strong><code>false</code></strong>。
  </p>
  <div class="caution"><strong class="caution">Caution</strong><p class="simpara">如果 libgd 输出图像失败，函数会返回 <strong><code>true</code></strong>。</p></div>
 </div>


 <div class="refsect1 changelog" id="refsect1-function.imagejpeg-changelog">
  <h3 class="title">更新日志</h3>
  <table class="doctable informaltable">
   
    <thead>
     <tr>
      <th>版本</th>
      <th>说明</th>
     </tr>

    </thead>

    <tbody class="tbody">
     <tr>
 <td>8.0.0</td>
 <td>
  <code class="parameter">image</code> 现在需要 <span class="classname"><a href="class.gdimage.html" class="classname">GdImage</a></span> 实例；之前需要有效的 <code class="literal">gd</code> <span class="type">resource</span>。
 </td>
</tr>

    </tbody>
   
  </table>

 </div>


 <div class="refsect1 examples" id="refsect1-function.imagejpeg-examples">
  <h3 class="title">示例</h3>
  <p class="para">
   <div class="example" id="example-5538">
    <p><strong>Example #1 输出 JPEG 图像到浏览器</strong></p>
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br /></span><span style="color: #FF8000">// 创键空白图像并添加一些文本<br /></span><span style="color: #0000BB">$im </span><span style="color: #007700">= </span><span style="color: #0000BB">imagecreatetruecolor</span><span style="color: #007700">(</span><span style="color: #0000BB">120</span><span style="color: #007700">, </span><span style="color: #0000BB">20</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">$text_color </span><span style="color: #007700">= </span><span style="color: #0000BB">imagecolorallocate</span><span style="color: #007700">(</span><span style="color: #0000BB">$im</span><span style="color: #007700">, </span><span style="color: #0000BB">233</span><span style="color: #007700">, </span><span style="color: #0000BB">14</span><span style="color: #007700">, </span><span style="color: #0000BB">91</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">imagestring</span><span style="color: #007700">(</span><span style="color: #0000BB">$im</span><span style="color: #007700">, </span><span style="color: #0000BB">1</span><span style="color: #007700">, </span><span style="color: #0000BB">5</span><span style="color: #007700">, </span><span style="color: #0000BB">5</span><span style="color: #007700">,  </span><span style="color: #DD0000">'A Simple Text String'</span><span style="color: #007700">, </span><span style="color: #0000BB">$text_color</span><span style="color: #007700">);<br /><br /></span><span style="color: #FF8000">// 设置内容类型标头 &mdash;&mdash; 这个例子里是 image/jpeg<br /></span><span style="color: #0000BB">header</span><span style="color: #007700">(</span><span style="color: #DD0000">'Content-Type: image/jpeg'</span><span style="color: #007700">);<br /><br /></span><span style="color: #FF8000">// 输出图像<br /></span><span style="color: #0000BB">imagejpeg</span><span style="color: #007700">(</span><span style="color: #0000BB">$im</span><span style="color: #007700">);<br /><br /></span><span style="color: #FF8000">// 释放内存<br /></span><span style="color: #0000BB">imagedestroy</span><span style="color: #007700">(</span><span style="color: #0000BB">$im</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
    </div>

    <div class="example-contents"><p>以上示例的输出类似于：</p></div>
    <div class="mediaobject">
     
     <div class="imageobject">
      <img src="images/21009b70229598c6a80eef8b45bf282b-imagejpeg.jpg" alt="示例输出：输出 JPEG 图像" width="120" height="20" />
     </div>
    </div>
   </div>
  </p>
  <p class="para">
   <div class="example" id="example-5540">
    <p><strong>Example #2 保存 JPEG 图像到文件</strong></p>
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br /></span><span style="color: #FF8000">// 创键空白图像并添加一些文本<br /></span><span style="color: #0000BB">$im </span><span style="color: #007700">= </span><span style="color: #0000BB">imagecreatetruecolor</span><span style="color: #007700">(</span><span style="color: #0000BB">120</span><span style="color: #007700">, </span><span style="color: #0000BB">20</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">$text_color </span><span style="color: #007700">= </span><span style="color: #0000BB">imagecolorallocate</span><span style="color: #007700">(</span><span style="color: #0000BB">$im</span><span style="color: #007700">, </span><span style="color: #0000BB">233</span><span style="color: #007700">, </span><span style="color: #0000BB">14</span><span style="color: #007700">, </span><span style="color: #0000BB">91</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">imagestring</span><span style="color: #007700">(</span><span style="color: #0000BB">$im</span><span style="color: #007700">, </span><span style="color: #0000BB">1</span><span style="color: #007700">, </span><span style="color: #0000BB">5</span><span style="color: #007700">, </span><span style="color: #0000BB">5</span><span style="color: #007700">,  </span><span style="color: #DD0000">'A Simple Text String'</span><span style="color: #007700">, </span><span style="color: #0000BB">$text_color</span><span style="color: #007700">);<br /><br /></span><span style="color: #FF8000">// 保存图像为"simpletext.jpg"<br /></span><span style="color: #0000BB">imagejpeg</span><span style="color: #007700">(</span><span style="color: #0000BB">$im</span><span style="color: #007700">, </span><span style="color: #DD0000">'simpletext.jpg'</span><span style="color: #007700">);<br /><br /></span><span style="color: #FF8000">// 释放内存<br /></span><span style="color: #0000BB">imagedestroy</span><span style="color: #007700">(</span><span style="color: #0000BB">$im</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
    </div>

   </div>
  </p>
  <p class="para">
   <div class="example" id="example-5542">
    <p><strong>Example #3 以 75% 的图像质量输出图像到浏览器</strong></p>
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br /></span><span style="color: #FF8000">// 创键空白图像并添加一些文本<br /></span><span style="color: #0000BB">$im </span><span style="color: #007700">= </span><span style="color: #0000BB">imagecreatetruecolor</span><span style="color: #007700">(</span><span style="color: #0000BB">120</span><span style="color: #007700">, </span><span style="color: #0000BB">20</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">$text_color </span><span style="color: #007700">= </span><span style="color: #0000BB">imagecolorallocate</span><span style="color: #007700">(</span><span style="color: #0000BB">$im</span><span style="color: #007700">, </span><span style="color: #0000BB">233</span><span style="color: #007700">, </span><span style="color: #0000BB">14</span><span style="color: #007700">, </span><span style="color: #0000BB">91</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">imagestring</span><span style="color: #007700">(</span><span style="color: #0000BB">$im</span><span style="color: #007700">, </span><span style="color: #0000BB">1</span><span style="color: #007700">, </span><span style="color: #0000BB">5</span><span style="color: #007700">, </span><span style="color: #0000BB">5</span><span style="color: #007700">,  </span><span style="color: #DD0000">'A Simple Text String'</span><span style="color: #007700">, </span><span style="color: #0000BB">$text_color</span><span style="color: #007700">);<br /><br /></span><span style="color: #FF8000">// 设置内容类型标头 &mdash;&mdash; 这个例子里是 image/jpeg<br /></span><span style="color: #0000BB">header</span><span style="color: #007700">(</span><span style="color: #DD0000">'Content-Type: image/jpeg'</span><span style="color: #007700">);<br /><br /></span><span style="color: #FF8000">// 使用 NULL 跳过 file 参数，并设置图像质量为 75%<br /></span><span style="color: #0000BB">imagejpeg</span><span style="color: #007700">(</span><span style="color: #0000BB">$im</span><span style="color: #007700">, </span><span style="color: #0000BB">NULL</span><span style="color: #007700">, </span><span style="color: #0000BB">75</span><span style="color: #007700">);<br /><br /></span><span style="color: #FF8000">// 释放内存<br /></span><span style="color: #0000BB">imagedestroy</span><span style="color: #007700">(</span><span style="color: #0000BB">$im</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
    </div>

   </div>
  </p>
 </div>

 <div class="refsect1 notes" id="refsect1-function.imagejpeg-notes">
  <h3 class="title">注释</h3>
  <blockquote class="note"><p><strong class="note">Note</strong>: 
   <p class="para">
    如果想输出渐进式 JPEG，需要使用 <span class="function"><a href="function.imageinterlace.html" class="function">imageinterlace()</a></span> 设置隔行扫描。
   </p>
  </p></blockquote>
 </div>


 <div class="refsect1 seealso" id="refsect1-function.imagejpeg-seealso">
  <h3 class="title">参见</h3>
  <ul class="simplelist">
   <li class="member"><span class="function"><a href="function.imagepng.html" class="function" rel="rdfs-seeAlso">imagepng()</a> - 将 PNG 图像输出到浏览器或文件</span></li>
   <li class="member"><span class="function"><a href="function.imagegif.html" class="function" rel="rdfs-seeAlso">imagegif()</a> - 输出图象到浏览器或文件。</span></li>
   <li class="member"><span class="function"><a href="function.imagewbmp.html" class="function" rel="rdfs-seeAlso">imagewbmp()</a> - 输出图象到浏览器或文件。</span></li>
   <li class="member"><span class="function"><a href="function.imageinterlace.html" class="function" rel="rdfs-seeAlso">imageinterlace()</a> - 启用或禁用隔行扫描</span></li>
   <li class="member"><span class="function"><a href="function.imagetypes.html" class="function" rel="rdfs-seeAlso">imagetypes()</a> - 返回 PHP 内置支持的图像类型</span></li>
  </ul>
 </div>

</div><div id="usernotes">
 <div class="head">
  <h3 class="title">User Contributed Notes</h3>
 </div>
<div id="allnotes">  <a name="128280""></a>
  <div class="note">
   <strong class="user">Uplink</strong>
   <a href="#128280" class="date">03-Mar-2023 11:01</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you use the official Docker images and enable gd with `docker-php-ext-install gd`, you don't get JPEG support by default.<br />
<br />
If that's you, and you get "Call to undefined function imagejpeg()", the you need to do this before docker-php-ext-install:<br />
<br />
docker-php-ext-configure gd --with-jpeg<br />
<br />
You'll also want to install libjpeg-dev for this to work.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="124248""></a>
  <div class="note">
   <strong class="user">flying man</strong>
   <a href="#124248" class="date">29-Sep-2019 08:10</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
ZERO BYTE FILE RESULT - HERE'S WHY!<br />
<br />
Take to heart that CAUTION note on this function. If gdlib fails to output, it still returns true!&nbsp; I'd call that a bug personally.<br />
<br />
GD will fail to output if you have an image exceeding its maximum undisclosed dimensions of 65500 pixels.<br />
<br />
You'll get a zero byte file instead</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="112796""></a>
  <div class="note">
   <strong class="user">Bruno de Lima - bruno at tthedreamstone dot net</strong>
   <a href="#112796" class="date">23-Jul-2013 07:23</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
[[Editor's note: removed the header()-call since it is not required when outputting inline image-data]]
<br />
One single code line, solve-me after 3 hours of blind search!
<br />

<br />
here is:
<br />

<br />
... ob_start();
<br />
&nbsp; imagejpeg( $img, NULL, 100 );
<br />
&nbsp; imagedestroy( $img );
<br />
&nbsp; $i = ob_get_clean();
<br />

<br />
echo "&lt;img src='data:image/jpeg;base64," . base64_encode( $i )."'&gt;"; //saviour line!</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="103826""></a>
  <div class="note">
   <strong class="user">bernytech at gmail dot com</strong>
   <a href="#103826" class="date">05-May-2011 03:32</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Don't be like me racking my brain for hours trying to figure out why my xxx.php file outputs <a href="http://localhost/xxx.php as a one line response." rel="nofollow" target="_blank">http://localhost/xxx.php as a one line response.</a><br />
<br />
Why?<br />
<br />
Most likely, you have either:<br />
<br />
1. whitespaces before or after the php tags<br />
2. need to set header('Content-type: image/jpeg');<br />
3. if you have required files...be sure nothing is outputted...no test print statements because page expects image information<br />
4.&nbsp; there is an error in your code<br />
<br />
in my case, it was 4.&nbsp; there is a reason why the function call base64decode does not work... <br />
<br />
it's actually: base64_decode()<br />
<br />
by the way, other ways to validate your image encoded in base64 is to use the following tag:<br />
<br />
echo '&lt;img src="data:image/jpeg;base64,'.$row['IMAGE'].'" alt="photo"&gt;';<br />
<br />
I was pulling a blob encoded base 64 data from mysql database and trying to render it on a page<br />
<br />
hope this helps someone.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="100059""></a>
  <div class="note">
   <strong class="user">Ray.Paseur sometimes uses Gmail</strong>
   <a href="#100059" class="date">22-Sep-2010 03:06</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If string $filename is given and it exists, it will be overwritten.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="91368""></a>
  <div class="note">
   <strong class="user">tomas at dundacek dot cz</strong>
   <a href="#91368" class="date">08-Jun-2009 01:31</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I had a problem with denied permissions when trying to upload AND resize an image having safe_mode on. This caused that I couldn't create the new file in which I wanted to resampled the image with nor with imagejpeg() nor with touch() and imagejpeg() after it. <br />
<br />
Here is my solution, I didn't test, but it's possible, it is biting some memory:<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">function </span><span class="default">resize</span><span class="keyword">(</span><span class="default">$image</span><span class="keyword">, </span><span class="default">$target_file</span><span class="keyword">) {<br />
&nbsp; </span><span class="comment">// $image is the uploaded image<br />
&nbsp; </span><span class="keyword">list(</span><span class="default">$width</span><span class="keyword">, </span><span class="default">$height</span><span class="keyword">) = </span><span class="default">getimagesize</span><span class="keyword">(</span><span class="default">$image</span><span class="keyword">[</span><span class="string">'tmp_name'</span><span class="keyword">]);<br />
<br />
&nbsp; </span><span class="comment">//setup the new size of the image<br />
&nbsp; </span><span class="default">$ratio </span><span class="keyword">= </span><span class="default">$width</span><span class="keyword">/</span><span class="default">$height</span><span class="keyword">;<br />
&nbsp; </span><span class="default">$new_height </span><span class="keyword">= </span><span class="default">500</span><span class="keyword">;<br />
&nbsp; </span><span class="default">$new_width </span><span class="keyword">= </span><span class="default">$new_height </span><span class="keyword">* </span><span class="default">$ratio</span><span class="keyword">;<br />
<br />
&nbsp; </span><span class="comment">//move the file in the new location<br />
&nbsp; </span><span class="default">move_uploaded_file</span><span class="keyword">(</span><span class="default">$image</span><span class="keyword">[</span><span class="string">'tmp_name'</span><span class="keyword">], </span><span class="default">$target_file</span><span class="keyword">);<br />
&nbsp; <br />
&nbsp; </span><span class="comment">// resample the image&nbsp; &nbsp; &nbsp; &nbsp; <br />
&nbsp; </span><span class="default">$new_image </span><span class="keyword">= </span><span class="default">imagecreatetruecolor</span><span class="keyword">(</span><span class="default">$new_width</span><span class="keyword">, </span><span class="default">$new_height</span><span class="keyword">);<br />
&nbsp; </span><span class="default">$old_image </span><span class="keyword">= </span><span class="default">imagecreatefromjpeg</span><span class="keyword">(</span><span class="default">$target_file</span><span class="keyword">);<br />
&nbsp; </span><span class="default">imagecopyresampled</span><span class="keyword">(</span><span class="default">$new_image</span><span class="keyword">,</span><span class="default">$old_image</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">$new_width</span><span class="keyword">, </span><span class="default">$new_height</span><span class="keyword">, </span><span class="default">$width</span><span class="keyword">, </span><span class="default">$height</span><span class="keyword">);&nbsp; &nbsp; &nbsp; &nbsp; <br />
<br />
&nbsp; </span><span class="comment">//output<br />
&nbsp; </span><span class="default">imagejpeg</span><span class="keyword">(</span><span class="default">$new_image</span><span class="keyword">, </span><span class="default">$target_file</span><span class="keyword">, </span><span class="default">100</span><span class="keyword">);<br />
}<br />
<br />
</span><span class="default">?&gt;<br />
</span><br />
As you can see, the function moves the uploaded file where you want to save the resampled image (move_uploaded_file is not restricted by safe_mode) and then you can resample the image, because it was created by moving it already. <br />
<br />
Note: the directory where you want to save the file must have permissions set to 0777.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="90102""></a>
  <div class="note">
   <strong class="user">viciousVelo</strong>
   <a href="#90102" class="date">06-Apr-2009 07:49</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
for those who get the message "permission denied" or "unable to access": it looks like a problem with your writepermissions to this folder. no matter if you use windows- or linuxserver, be sure the correct user has the permission to write to the correct folder.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="89866""></a>
  <div class="note">
   <strong class="user">francesco@essensys</strong>
   <a href="#89866" class="date">26-Mar-2009 05:23</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I didn't find any example like this on the Web, so I mixed pieces together.. hope this will save time to other people!<br />
<br />
Here's a complete solution to READ any image (gif jpg png) from the FILESYSTEM, SCALE it to a max width/height, SAVE the scaled image to a BLOB field keeping the original image type. Quite tricky.. <br />
<br />
<span class="default">&lt;?php<br />
<br />
</span><span class="keyword">function </span><span class="default">scaleImageFileToBlob</span><span class="keyword">(</span><span class="default">$file</span><span class="keyword">) {<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$source_pic </span><span class="keyword">= </span><span class="default">$file</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$max_width </span><span class="keyword">= </span><span class="default">200</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$max_height </span><span class="keyword">= </span><span class="default">200</span><span class="keyword">;<br />
<br />
&nbsp;&nbsp;&nbsp; list(</span><span class="default">$width</span><span class="keyword">, </span><span class="default">$height</span><span class="keyword">, </span><span class="default">$image_type</span><span class="keyword">) = </span><span class="default">getimagesize</span><span class="keyword">(</span><span class="default">$file</span><span class="keyword">);<br />
<br />
&nbsp;&nbsp;&nbsp; switch (</span><span class="default">$image_type</span><span class="keyword">)<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="default">1</span><span class="keyword">: </span><span class="default">$src </span><span class="keyword">= </span><span class="default">imagecreatefromgif</span><span class="keyword">(</span><span class="default">$file</span><span class="keyword">); break;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="default">2</span><span class="keyword">: </span><span class="default">$src </span><span class="keyword">= </span><span class="default">imagecreatefromjpeg</span><span class="keyword">(</span><span class="default">$file</span><span class="keyword">);&nbsp; break;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="default">3</span><span class="keyword">: </span><span class="default">$src </span><span class="keyword">= </span><span class="default">imagecreatefrompng</span><span class="keyword">(</span><span class="default">$file</span><span class="keyword">); break;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; default: return </span><span class="string">''</span><span class="keyword">;&nbsp; break;<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$x_ratio </span><span class="keyword">= </span><span class="default">$max_width </span><span class="keyword">/ </span><span class="default">$width</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$y_ratio </span><span class="keyword">= </span><span class="default">$max_height </span><span class="keyword">/ </span><span class="default">$height</span><span class="keyword">;<br />
<br />
&nbsp;&nbsp;&nbsp; if( (</span><span class="default">$width </span><span class="keyword">&lt;= </span><span class="default">$max_width</span><span class="keyword">) &amp;&amp; (</span><span class="default">$height </span><span class="keyword">&lt;= </span><span class="default">$max_height</span><span class="keyword">) ){<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$tn_width </span><span class="keyword">= </span><span class="default">$width</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$tn_height </span><span class="keyword">= </span><span class="default">$height</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }elseif ((</span><span class="default">$x_ratio </span><span class="keyword">* </span><span class="default">$height</span><span class="keyword">) &lt; </span><span class="default">$max_height</span><span class="keyword">){<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$tn_height </span><span class="keyword">= </span><span class="default">ceil</span><span class="keyword">(</span><span class="default">$x_ratio </span><span class="keyword">* </span><span class="default">$height</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$tn_width </span><span class="keyword">= </span><span class="default">$max_width</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }else{<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$tn_width </span><span class="keyword">= </span><span class="default">ceil</span><span class="keyword">(</span><span class="default">$y_ratio </span><span class="keyword">* </span><span class="default">$width</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$tn_height </span><span class="keyword">= </span><span class="default">$max_height</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$tmp </span><span class="keyword">= </span><span class="default">imagecreatetruecolor</span><span class="keyword">(</span><span class="default">$tn_width</span><span class="keyword">,</span><span class="default">$tn_height</span><span class="keyword">);<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">/* Check if this image is PNG or GIF, then set if Transparent*/<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">if((</span><span class="default">$image_type </span><span class="keyword">== </span><span class="default">1</span><span class="keyword">) OR (</span><span class="default">$image_type</span><span class="keyword">==</span><span class="default">3</span><span class="keyword">))<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">imagealphablending</span><span class="keyword">(</span><span class="default">$tmp</span><span class="keyword">, </span><span class="default">false</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">imagesavealpha</span><span class="keyword">(</span><span class="default">$tmp</span><span class="keyword">,</span><span class="default">true</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$transparent </span><span class="keyword">= </span><span class="default">imagecolorallocatealpha</span><span class="keyword">(</span><span class="default">$tmp</span><span class="keyword">, </span><span class="default">255</span><span class="keyword">, </span><span class="default">255</span><span class="keyword">, </span><span class="default">255</span><span class="keyword">, </span><span class="default">127</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">imagefilledrectangle</span><span class="keyword">(</span><span class="default">$tmp</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">$tn_width</span><span class="keyword">, </span><span class="default">$tn_height</span><span class="keyword">, </span><span class="default">$transparent</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">imagecopyresampled</span><span class="keyword">(</span><span class="default">$tmp</span><span class="keyword">,</span><span class="default">$src</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">$tn_width</span><span class="keyword">, </span><span class="default">$tn_height</span><span class="keyword">,</span><span class="default">$width</span><span class="keyword">,</span><span class="default">$height</span><span class="keyword">);<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">/*<br />
&nbsp;&nbsp; &nbsp; * imageXXX() only has two options, save as a file, or send to the browser.<br />
&nbsp;&nbsp; &nbsp; * It does not provide you the oppurtunity to manipulate the final GIF/JPG/PNG file stream<br />
&nbsp;&nbsp; &nbsp; * So I start the output buffering, use imageXXX() to output the data stream to the browser, <br />
&nbsp;&nbsp; &nbsp; * get the contents of the stream, and use clean to silently discard the buffered contents.<br />
&nbsp;&nbsp; &nbsp; */<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">ob_start</span><span class="keyword">();<br />
<br />
&nbsp;&nbsp;&nbsp; switch (</span><span class="default">$image_type</span><span class="keyword">)<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="default">1</span><span class="keyword">: </span><span class="default">imagegif</span><span class="keyword">(</span><span class="default">$tmp</span><span class="keyword">); break;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="default">2</span><span class="keyword">: </span><span class="default">imagejpeg</span><span class="keyword">(</span><span class="default">$tmp</span><span class="keyword">, </span><span class="default">NULL</span><span class="keyword">, </span><span class="default">100</span><span class="keyword">);&nbsp; break; </span><span class="comment">// best quality<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">case </span><span class="default">3</span><span class="keyword">: </span><span class="default">imagepng</span><span class="keyword">(</span><span class="default">$tmp</span><span class="keyword">, </span><span class="default">NULL</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">); break; </span><span class="comment">// no compression<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">default: echo </span><span class="string">''</span><span class="keyword">; break;<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$final_image </span><span class="keyword">= </span><span class="default">ob_get_contents</span><span class="keyword">();<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">ob_end_clean</span><span class="keyword">();<br />
<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">$final_image</span><span class="keyword">;<br />
}<br />
<br />
</span><span class="default">?&gt;<br />
</span><br />
So, let's suppose you have a form where a user can upload an image, and you have to scale it and save it into your database.<br />
<br />
<span class="default">&lt;?php<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">[..] </span><span class="comment">// the user has clicked the Submit button..<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; // Check if the user entered an image<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">if (</span><span class="default">$_FILES</span><span class="keyword">[</span><span class="string">'imagefile'</span><span class="keyword">][</span><span class="string">'name'</span><span class="keyword">] != </span><span class="string">''</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$image </span><span class="keyword">= </span><span class="default">scaleImageFileToBlob</span><span class="keyword">(</span><span class="default">$_FILES</span><span class="keyword">[</span><span class="string">'imagefile'</span><span class="keyword">][</span><span class="string">'tmp_name'</span><span class="keyword">]);<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">$image </span><span class="keyword">== </span><span class="string">''</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="string">'Image type not supported'</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; } else {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$image_type </span><span class="keyword">= </span><span class="default">$_FILES</span><span class="keyword">[</span><span class="string">'imagefile'</span><span class="keyword">][</span><span class="string">'type'</span><span class="keyword">];<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$image </span><span class="keyword">= </span><span class="default">addslashes</span><span class="keyword">(</span><span class="default">$image</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$query&nbsp; </span><span class="keyword">= </span><span class="string">"UPDATE yourtable SET image_type='</span><span class="default">$image_type</span><span class="string">', image='</span><span class="default">$image</span><span class="string">' WHERE ..."</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$result </span><span class="keyword">= </span><span class="default">mysql_query</span><span class="keyword">(</span><span class="default">$query</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">$result</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; echo </span><span class="string">'Image scaled and uploaded'</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; } else {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; echo </span><span class="string">'Error running the query'</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="86858""></a>
  <div class="note">
   <strong class="user">soapergem at gmail dot com</strong>
   <a href="#86858" class="date">06-Nov-2008 01:48</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I came here looking for something similar to the getJPEGresolution function, but noticed the drawbacks that were pointed out in the last post. So, after drawing on some other code examples on the web, I put together the following function which should always properly return the correct values. (But remember that you still need to have the EXIF extension installed with your instance of PHP for this to work!)<br />
<br />
<span class="default">&lt;?php<br />
<br />
</span><span class="keyword">function </span><span class="default">jpeg_dpi</span><span class="keyword">(</span><span class="default">$filename</span><span class="keyword">)<br />
{<br />
&nbsp;&nbsp;&nbsp; if ( </span><span class="default">exif_imagetype</span><span class="keyword">(</span><span class="default">$filename</span><span class="keyword">) != </span><span class="default">IMAGETYPE_JPEG </span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">false</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; } else {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$exif </span><span class="keyword">= </span><span class="default">exif_read_data</span><span class="keyword">(</span><span class="default">$filename</span><span class="keyword">, </span><span class="string">'IFD0'</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$x </span><span class="keyword">= </span><span class="default">$y </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; if ( isset(</span><span class="default">$exif</span><span class="keyword">[</span><span class="string">'XResolution'</span><span class="keyword">]) &amp;&amp; isset(</span><span class="default">$exif</span><span class="keyword">[</span><span class="string">'YResolution'</span><span class="keyword">]) ) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$x </span><span class="keyword">= </span><span class="default">intval</span><span class="keyword">(</span><span class="default">preg_replace</span><span class="keyword">(</span><span class="string">'@^(\\d+)/(\\d+)$@e'</span><span class="keyword">, </span><span class="string">'$1/$2'</span><span class="keyword">, </span><span class="default">$exif</span><span class="keyword">[</span><span class="string">'XResolution'</span><span class="keyword">]));<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$y </span><span class="keyword">= </span><span class="default">intval</span><span class="keyword">(</span><span class="default">preg_replace</span><span class="keyword">(</span><span class="string">'@^(\\d+)/(\\d+)$@e'</span><span class="keyword">, </span><span class="string">'$1/$2'</span><span class="keyword">, </span><span class="default">$exif</span><span class="keyword">[</span><span class="string">'YResolution'</span><span class="keyword">]));<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; if ( !</span><span class="default">$x </span><span class="keyword">&amp;&amp; !</span><span class="default">$y </span><span class="keyword">&amp;&amp; </span><span class="default">$fp </span><span class="keyword">= </span><span class="default">fopen</span><span class="keyword">(</span><span class="default">$filename</span><span class="keyword">, </span><span class="string">'r'</span><span class="keyword">) ) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$string </span><span class="keyword">= </span><span class="default">fread</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">, </span><span class="default">20</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">fclose</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$data </span><span class="keyword">= </span><span class="default">bin2hex</span><span class="keyword">(</span><span class="default">substr</span><span class="keyword">(</span><span class="default">$string</span><span class="keyword">, </span><span class="default">14</span><span class="keyword">, </span><span class="default">4</span><span class="keyword">));<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$x </span><span class="keyword">= </span><span class="default">hexdec</span><span class="keyword">(</span><span class="default">substr</span><span class="keyword">(</span><span class="default">$data</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">4</span><span class="keyword">));<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$y </span><span class="keyword">= </span><span class="default">hexdec</span><span class="keyword">(</span><span class="default">substr</span><span class="keyword">(</span><span class="default">$data</span><span class="keyword">, </span><span class="default">4</span><span class="keyword">, </span><span class="default">4</span><span class="keyword">));<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; if ( </span><span class="default">$x </span><span class="keyword">|| </span><span class="default">$y </span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return array(</span><span class="default">$x</span><span class="keyword">, </span><span class="default">$y</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">false</span><span class="keyword">;<br />
}<br />
<br />
</span><span class="default">?&gt;<br />
</span><br />
This function returns an array with the x-resolution, y-resolution when they can be determined, otherwise FALSE.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="86493""></a>
  <div class="note">
   <strong class="user">ahows at noggin dot com dot au</strong>
   <a href="#86493" class="date">21-Oct-2008 10:36</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Regarding the code below, it only grabs the last byte of the DPI information in JFIF-mode. I was wondering why my 300-DPI file was being reported as 44. 300 - 256 = 44 of course.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="85711""></a>
  <div class="note">
   <strong class="user">lorezyra (at) lorezyra (dot) com</strong>
   <a href="#85711" class="date">13-Sep-2008 06:50</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
For those looking to grab the resolution of a JPEG image without using GD nor ImageMagic... I wrote this simple function.<br />
<br />
Too bad GD doesn't have this very simple function for us to use...<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">function </span><span class="default">getJPEGresolution</span><span class="keyword">(</span><span class="default">$filename</span><span class="keyword">){<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$outRez</span><span class="keyword">=array();<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// Read the file<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">ob_start</span><span class="keyword">(); </span><span class="comment">// start a new output buffer<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$image&nbsp;&nbsp; </span><span class="keyword">= </span><span class="default">file_get_contents</span><span class="keyword">(</span><span class="default">$filename</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// grab DPI information from the JPG header<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$outRez</span><span class="keyword">[</span><span class="string">"xDPI"</span><span class="keyword">] = </span><span class="default">ord</span><span class="keyword">(</span><span class="default">$image</span><span class="keyword">[</span><span class="default">15</span><span class="keyword">]);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$outRez</span><span class="keyword">[</span><span class="string">"yDPI"</span><span class="keyword">] = </span><span class="default">ord</span><span class="keyword">(</span><span class="default">$image</span><span class="keyword">[</span><span class="default">17</span><span class="keyword">]);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">ob_end_clean</span><span class="keyword">(); </span><span class="comment">// stop this output buffer<br />
<br />
&nbsp;&nbsp;&nbsp; //xDPI and yDPI should equal in value... but we output both anyway...<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">return(</span><span class="default">$outRez</span><span class="keyword">);<br />
}</span><span class="comment">//end function getJPEGresolution<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="83537""></a>
  <div class="note">
   <strong class="user">stefan at colulus dot com</strong>
   <a href="#83537" class="date">30-May-2008 11:16</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I worked out a script that allows the transfer of alphanumeric data to be placed on an image. The HTML feature is img src and the php feature is imagettftext. This simple code will increment from 1 to 3 on images.<br />
<br />
code:<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="comment">//ImageCall.php -- This script will call a script to produce the image.<br />
</span><span class="keyword">for(</span><span class="default">$next </span><span class="keyword">= </span><span class="default">1</span><span class="keyword">;</span><span class="default">$next </span><span class="keyword">&lt; </span><span class="default">4</span><span class="keyword">; </span><span class="default">$next</span><span class="keyword">++){<br />
print </span><span class="string">"Image </span><span class="default">$next</span><span class="string">:&lt;br&gt;"</span><span class="keyword">;<br />
print </span><span class="string">"&lt;img src = 'Image.php?\$text=</span><span class="default">$next</span><span class="string">'&gt;"</span><span class="keyword">;<br />
print </span><span class="string">"&lt;br&gt;&lt;br&gt;"</span><span class="keyword">;<br />
}<br />
</span><span class="default">?&gt;<br />
</span><br />
<span class="default">&lt;?php<br />
</span><span class="comment">//Image.php -- This script creates a square image and places the text on it.<br />
<br />
// image size and color<br />
</span><span class="default">$im </span><span class="keyword">= </span><span class="default">ImageCreate</span><span class="keyword">(</span><span class="default">77</span><span class="keyword">,</span><span class="default">77</span><span class="keyword">);<br />
</span><span class="default">$color1 </span><span class="keyword">= </span><span class="default">ImageColorAllocate</span><span class="keyword">(</span><span class="default">$im</span><span class="keyword">,</span><span class="default">0x66</span><span class="keyword">,</span><span class="default">0xCC</span><span class="keyword">,</span><span class="default">0x00</span><span class="keyword">);<br />
</span><span class="default">$color2 </span><span class="keyword">= </span><span class="default">ImageColorAllocate</span><span class="keyword">(</span><span class="default">$im</span><span class="keyword">,</span><span class="default">0x33</span><span class="keyword">,</span><span class="default">0x66</span><span class="keyword">,</span><span class="default">0x00</span><span class="keyword">);<br />
</span><span class="default">$color3 </span><span class="keyword">= </span><span class="default">ImageColorAllocate</span><span class="keyword">(</span><span class="default">$im</span><span class="keyword">,</span><span class="default">0x00</span><span class="keyword">,</span><span class="default">0x99</span><span class="keyword">,</span><span class="default">0x00</span><span class="keyword">);<br />
</span><span class="default">$color4 </span><span class="keyword">= </span><span class="default">ImageColorAllocate</span><span class="keyword">(</span><span class="default">$im</span><span class="keyword">,</span><span class="default">0x3D</span><span class="keyword">,</span><span class="default">0x3D</span><span class="keyword">,</span><span class="default">0x3D</span><span class="keyword">);<br />
<br />
</span><span class="comment">// image creation<br />
</span><span class="default">ImageFilledRectangle</span><span class="keyword">(</span><span class="default">$im</span><span class="keyword">,</span><span class="default">1</span><span class="keyword">,</span><span class="default">1</span><span class="keyword">,</span><span class="default">76</span><span class="keyword">,</span><span class="default">76</span><span class="keyword">,</span><span class="default">$color1</span><span class="keyword">);<br />
</span><span class="default">ImageFilledpolygon</span><span class="keyword">(</span><span class="default">$im</span><span class="keyword">, array (</span><span class="default">76</span><span class="keyword">,</span><span class="default">1</span><span class="keyword">,</span><span class="default">1</span><span class="keyword">,</span><span class="default">76</span><span class="keyword">,</span><span class="default">76</span><span class="keyword">,</span><span class="default">76</span><span class="keyword">),</span><span class="default">3</span><span class="keyword">,</span><span class="default">$color2</span><span class="keyword">);<br />
</span><span class="default">ImageFilledRectangle</span><span class="keyword">(</span><span class="default">$im</span><span class="keyword">,</span><span class="default">5</span><span class="keyword">,</span><span class="default">5</span><span class="keyword">,</span><span class="default">72</span><span class="keyword">,</span><span class="default">72</span><span class="keyword">,</span><span class="default">$color3</span><span class="keyword">);<br />
<br />
</span><span class="comment">// determine numeric center of image<br />
</span><span class="default">$size </span><span class="keyword">= </span><span class="default">ImageTTFBBox</span><span class="keyword">(</span><span class="default">45</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="string">'impact'</span><span class="keyword">,</span><span class="default">$_GET</span><span class="keyword">[</span><span class="string">'$text'</span><span class="keyword">]);<br />
</span><span class="default">$X </span><span class="keyword">= (</span><span class="default">77 </span><span class="keyword">- (</span><span class="default">abs</span><span class="keyword">(</span><span class="default">$size</span><span class="keyword">[</span><span class="default">2</span><span class="keyword">]- </span><span class="default">$size</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">])))/</span><span class="default">2</span><span class="keyword">;<br />
</span><span class="default">$Y </span><span class="keyword">= ((</span><span class="default">77 </span><span class="keyword">- (</span><span class="default">abs</span><span class="keyword">(</span><span class="default">$size</span><span class="keyword">[</span><span class="default">5</span><span class="keyword">] - </span><span class="default">$size</span><span class="keyword">[</span><span class="default">3</span><span class="keyword">])))/</span><span class="default">2 </span><span class="keyword">+ (</span><span class="default">abs</span><span class="keyword">(</span><span class="default">$size</span><span class="keyword">[</span><span class="default">5</span><span class="keyword">] - </span><span class="default">$size</span><span class="keyword">[</span><span class="default">3</span><span class="keyword">])));<br />
<br />
</span><span class="comment">//places numeric information on image<br />
</span><span class="default">ImageTTFText</span><span class="keyword">(</span><span class="default">$im</span><span class="keyword">,</span><span class="default">45</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,(</span><span class="default">$X</span><span class="keyword">-</span><span class="default">1</span><span class="keyword">),</span><span class="default">$Y</span><span class="keyword">,</span><span class="default">$color4</span><span class="keyword">,</span><span class="string">'impact'</span><span class="keyword">,</span><span class="default">$_GET</span><span class="keyword">[</span><span class="string">'$text'</span><span class="keyword">]);<br />
<br />
</span><span class="comment">//returns completed image to calling script<br />
</span><span class="default">Header</span><span class="keyword">(</span><span class="string">'Content-Type: image/png'</span><span class="keyword">);<br />
</span><span class="default">Imagejpeg</span><span class="keyword">(</span><span class="default">$im</span><span class="keyword">);<br />
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="81854""></a>
  <div class="note">
   <strong class="user">Anonymous</strong>
   <a href="#81854" class="date">16-Mar-2008 10:24</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Here is a function to resize an image and maintain aspect ratio. It will resize jpeg, gif or png and could easily be modified to add bmp. The name field is the destination of the file minus the file extension:<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="comment">//name= filename minus type<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">function </span><span class="default">createImage</span><span class="keyword">(</span><span class="default">$uploadedfile</span><span class="keyword">,</span><span class="default">$newWidth</span><span class="keyword">,</span><span class="default">$name</span><span class="keyword">) <br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// Capture the original size of the uploaded image<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">if(!</span><span class="default">$info</span><span class="keyword">=</span><span class="default">getimagesize</span><span class="keyword">(</span><span class="default">$uploadedfile</span><span class="keyword">))<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">false</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; switch (</span><span class="default">$info</span><span class="keyword">[</span><span class="string">'mime'</span><span class="keyword">]) <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="string">'image/jpeg'</span><span class="keyword">:<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$src </span><span class="keyword">= </span><span class="default">imagecreatefromjpeg</span><span class="keyword">(</span><span class="default">$uploadedfile</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; break;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="string">'image/gif'</span><span class="keyword">:<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$src </span><span class="keyword">= </span><span class="default">imagecreatefromgif</span><span class="keyword">(</span><span class="default">$uploadedfile</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; break;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="string">'image/png'</span><span class="keyword">:<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$src </span><span class="keyword">= </span><span class="default">imagecreatefrompng</span><span class="keyword">(</span><span class="default">$uploadedfile</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; break;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; default:<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">false</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">//Change the filename to add the filetype<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$mime</span><span class="keyword">=</span><span class="default">split</span><span class="keyword">(</span><span class="string">"image/"</span><span class="keyword">,</span><span class="default">$info</span><span class="keyword">[</span><span class="string">'mime'</span><span class="keyword">]);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$filename</span><span class="keyword">=</span><span class="default">$name</span><span class="keyword">.</span><span class="string">"."</span><span class="keyword">.</span><span class="default">$mime</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">];<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$size </span><span class="keyword">= </span><span class="default">getimagesize</span><span class="keyword">(</span><span class="default">$uploadedfile</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$newHeight</span><span class="keyword">=</span><span class="default">aspect_ratio</span><span class="keyword">(</span><span class="default">$size</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">],</span><span class="default">$newWidth</span><span class="keyword">,</span><span class="default">$size</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">]);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$tmp</span><span class="keyword">=</span><span class="default">imagecreatetruecolor</span><span class="keyword">(</span><span class="default">$newWidth</span><span class="keyword">,</span><span class="default">$newHeight</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// this line actually does the image resizing, copying from the original<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; // image into the $tmp image<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">imagecopyresampled</span><span class="keyword">(</span><span class="default">$tmp</span><span class="keyword">,</span><span class="default">$src</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">$newWidth</span><span class="keyword">,</span><span class="default">$newHeight</span><span class="keyword">,</span><span class="default">$info</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">], </span><span class="default">$info</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">]);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; switch (</span><span class="default">$info</span><span class="keyword">[</span><span class="string">'mime'</span><span class="keyword">])<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="string">'image/jpeg'</span><span class="keyword">:<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">imagejpeg</span><span class="keyword">(</span><span class="default">$tmp</span><span class="keyword">,</span><span class="default">$filename</span><span class="keyword">,</span><span class="default">100</span><span class="keyword">); </span><span class="comment">//100 is the quality settings, values range from 0-100.<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">break;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="string">'image/gif'</span><span class="keyword">:<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">imagegif</span><span class="keyword">(</span><span class="default">$tmp</span><span class="keyword">,</span><span class="default">$filename</span><span class="keyword">,</span><span class="default">100</span><span class="keyword">); </span><span class="comment">//100 is the quality settings, values range from 0-100.<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">break;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="string">'image/png'</span><span class="keyword">:<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">imagepng</span><span class="keyword">(</span><span class="default">$tmp</span><span class="keyword">,</span><span class="default">$filename</span><span class="keyword">); </span><span class="comment">//100 is the quality settings, values range from 0-100.<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">break;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">imagedestroy</span><span class="keyword">(</span><span class="default">$src</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">imagedestroy</span><span class="keyword">(</span><span class="default">$tmp</span><span class="keyword">); </span><span class="comment">// NOTE: PHP will clean up the temp file it created when the request<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; // has completed.<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">return </span><span class="default">true</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp;&nbsp; if(!</span><span class="default">createImage</span><span class="keyword">(</span><span class="default">$uploadedfile</span><span class="keyword">,</span><span class="default">100</span><span class="keyword">, </span><span class="string">"uploaded_images/imgname"</span><span class="keyword">))<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp;&nbsp; echo </span><span class="string">"error"</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="78523""></a>
  <div class="note">
   <strong class="user">Michaelsoft</strong>
   <a href="#78523" class="date">16-Oct-2007 02:50</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
[Editor's note: fixed according to the note of roberto at ilpiola.it]
<br />

<br />
I could not find any information on changing the DPI information on a JPG file using the GD lib. Since changing this does not resize or scale the actual image, it is only a header-setting.
<br />
The following snipplet will save your $image to $file and set the DPI to 150.
<br />

<br />
<span class="default">&lt;?php
<br />

<br />
&nbsp; imagejpeg</span><span class="keyword">(</span><span class="default">$image</span><span class="keyword">, </span><span class="default">$file</span><span class="keyword">, </span><span class="default">75</span><span class="keyword">);
<br />

<br />
&nbsp; </span><span class="comment">// Change DPI
<br />
&nbsp; </span><span class="default">$dpi_x&nbsp;&nbsp; </span><span class="keyword">= </span><span class="default">150</span><span class="keyword">;
<br />
&nbsp; </span><span class="default">$dpi_y&nbsp;&nbsp; </span><span class="keyword">= </span><span class="default">150</span><span class="keyword">;
<br />
&nbsp; 
<br />
&nbsp; </span><span class="comment">// Read the file
<br />
&nbsp; </span><span class="default">$size&nbsp; &nbsp; </span><span class="keyword">= </span><span class="default">filesize</span><span class="keyword">(</span><span class="default">$file</span><span class="keyword">);
<br />
&nbsp; </span><span class="default">$image&nbsp;&nbsp; </span><span class="keyword">= </span><span class="default">file_get_contents</span><span class="keyword">(</span><span class="default">$file</span><span class="keyword">);
<br />

<br />
&nbsp; </span><span class="comment">// Update DPI information in the JPG header
<br />
&nbsp; </span><span class="default">$image</span><span class="keyword">[</span><span class="default">13</span><span class="keyword">] = </span><span class="default">chr</span><span class="keyword">(</span><span class="default">1</span><span class="keyword">);
<br />
&nbsp; </span><span class="default">$image</span><span class="keyword">[</span><span class="default">14</span><span class="keyword">] = </span><span class="default">chr</span><span class="keyword">(</span><span class="default">floor</span><span class="keyword">(</span><span class="default">$dpi_x</span><span class="keyword">/</span><span class="default">256</span><span class="keyword">));
<br />
&nbsp; </span><span class="default">$image</span><span class="keyword">[</span><span class="default">15</span><span class="keyword">] = </span><span class="default">chr</span><span class="keyword">(&nbsp; &nbsp; &nbsp; </span><span class="default">$dpi_x</span><span class="keyword">%</span><span class="default">256</span><span class="keyword">);
<br />
&nbsp; </span><span class="default">$image</span><span class="keyword">[</span><span class="default">16</span><span class="keyword">] = </span><span class="default">chr</span><span class="keyword">(</span><span class="default">floor</span><span class="keyword">(</span><span class="default">$dpi_y</span><span class="keyword">/</span><span class="default">256</span><span class="keyword">));
<br />
&nbsp; </span><span class="default">$image</span><span class="keyword">[</span><span class="default">17</span><span class="keyword">] = </span><span class="default">chr</span><span class="keyword">(&nbsp; &nbsp; &nbsp; </span><span class="default">$dpi_y</span><span class="keyword">%</span><span class="default">256</span><span class="keyword">);
<br />

<br />
&nbsp; </span><span class="comment">// Write the new JPG
<br />
&nbsp; </span><span class="default">$f </span><span class="keyword">= </span><span class="default">fopen</span><span class="keyword">(</span><span class="default">$file</span><span class="keyword">, </span><span class="string">'w'</span><span class="keyword">);
<br />
&nbsp; </span><span class="default">fwrite</span><span class="keyword">(</span><span class="default">$f</span><span class="keyword">, </span><span class="default">$msg</span><span class="keyword">, </span><span class="default">$size</span><span class="keyword">);
<br />
&nbsp; </span><span class="default">fclose</span><span class="keyword">(</span><span class="default">$f</span><span class="keyword">);
<br />

<br />
</span><span class="default">?&gt;
<br />
</span>
<br />
P.s. not fully tested (yet) but it works for my images ...</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="76780""></a>
  <div class="note">
   <strong class="user">Elliott Brueggeman</strong>
   <a href="#76780" class="date">30-Jul-2007 09:37</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I did an experiment with the image quality parameter of the imagejpeg() function when creating jpegs. I found the optimal image quality with file size is taken into account to be 80 - very close to the default value of 75.<br />
<br />
Anything over 80 results in an unnecessary increase in file size without much increase in image quality.<br />
<br />
Results and sample pictures: <a href="http://www.ebrueggeman.com/article_php_image_optimization.php" rel="nofollow" target="_blank">http://www.ebrueggeman.com/article_php_image_optimization.php</a></span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="76698""></a>
  <div class="note">
   <strong class="user">Pedja (pedja at supurovic dot net)</strong>
   <a href="#76698" class="date">26-Jul-2007 10:59</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Here is sample function that creates thumbnail of source JPEG file. Thumbnail wil be in square form (with and height are the same), and original image cropped to fit in.<br />
<br />
Parameters:<br />
<br />
$p_thumb_file - name of the file (including path) where thumb should be saved to<br />
<br />
$p_photo_file - nam of the source JPEG file (including path) thatthumbnail should be created of<br />
<br />
$p_max_size - with and height (they will be the same) in pixels for thumbnail image<br />
<br />
$p_quality - quality of jpeg thumbnail<br />
<br />
<span class="default">&lt;?php<br />
<br />
</span><span class="keyword">function </span><span class="default">photoCreateCropThumb </span><span class="keyword">(</span><span class="default">$p_thumb_file</span><span class="keyword">, </span><span class="default">$p_photo_file</span><span class="keyword">, </span><span class="default">$p_max_size</span><span class="keyword">, </span><span class="default">$p_quality </span><span class="keyword">= </span><span class="default">75</span><span class="keyword">) {<br />
&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$pic </span><span class="keyword">= @</span><span class="default">imagecreatefromjpeg</span><span class="keyword">(</span><span class="default">$p_photo_file</span><span class="keyword">);<br />
<br />
&nbsp;&nbsp;&nbsp; if (</span><span class="default">$pic</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$thumb </span><span class="keyword">= @</span><span class="default">imagecreatetruecolor </span><span class="keyword">(</span><span class="default">$p_max_size</span><span class="keyword">, </span><span class="default">$p_max_size</span><span class="keyword">) or die (</span><span class="string">"Can't create Image!"</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$width </span><span class="keyword">= </span><span class="default">imagesx</span><span class="keyword">(</span><span class="default">$pic</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$height </span><span class="keyword">= </span><span class="default">imagesy</span><span class="keyword">(</span><span class="default">$pic</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">$width </span><span class="keyword">&lt; </span><span class="default">$height</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$twidth </span><span class="keyword">= </span><span class="default">$p_max_size</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$theight </span><span class="keyword">= </span><span class="default">$twidth </span><span class="keyword">* </span><span class="default">$height </span><span class="keyword">/ </span><span class="default">$width</span><span class="keyword">; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">imagecopyresized</span><span class="keyword">(</span><span class="default">$thumb</span><span class="keyword">, </span><span class="default">$pic</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, (</span><span class="default">$height</span><span class="keyword">/</span><span class="default">2</span><span class="keyword">)-(</span><span class="default">$width</span><span class="keyword">/</span><span class="default">2</span><span class="keyword">), </span><span class="default">$twidth</span><span class="keyword">, </span><span class="default">$theight</span><span class="keyword">, </span><span class="default">$width</span><span class="keyword">, </span><span class="default">$height</span><span class="keyword">); <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; } else {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$theight </span><span class="keyword">= </span><span class="default">$p_max_size</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$twidth </span><span class="keyword">= </span><span class="default">$theight </span><span class="keyword">* </span><span class="default">$width </span><span class="keyword">/ </span><span class="default">$height</span><span class="keyword">; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">imagecopyresized</span><span class="keyword">(</span><span class="default">$thumb</span><span class="keyword">, </span><span class="default">$pic</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, (</span><span class="default">$width</span><span class="keyword">/</span><span class="default">2</span><span class="keyword">)-(</span><span class="default">$height</span><span class="keyword">/</span><span class="default">2</span><span class="keyword">), </span><span class="default">0</span><span class="keyword">, </span><span class="default">$twidth</span><span class="keyword">, </span><span class="default">$theight</span><span class="keyword">, </span><span class="default">$width</span><span class="keyword">, </span><span class="default">$height</span><span class="keyword">); <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">ImageJPEG </span><span class="keyword">(</span><span class="default">$thumb</span><span class="keyword">, </span><span class="default">$p_thumb_file</span><span class="keyword">, </span><span class="default">$p_quality</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
}<br />
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="69168""></a>
  <div class="note">
   <strong class="user">webmaster at jongliertreff dot de</strong>
   <a href="#69168" class="date">25-Aug-2006 04:56</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Here's another on-the-fly thumbnail creation script.
<br />
When I scripted the pictuerviewer on my page, I had all the pictures only in full size and qualit, because I wanted the posibility für visitors to download the pictures.
<br />
But as Imagesizes of more than 4 MP are to large for websites, I created thumbnails and the smaller pictures on the fly. But I found out, that the Script needed too much RAM, especially in the thumbnail overview, when I had more then 50 thumbnails to create on the fly at the same time.
<br />

<br />
So I modified my image creator and my viewer to let them store images, that are created. So only the first visitor has to wait (which is usually me for controlling the uploads und updates), all other visitors get the stored images, which is much faster.
<br />

<br />
Create different folders. I have a main folder called 'imagesdb' and the tree subfolders full (Full quality images), show (images for the picture viewer) and thumb (for thumbnails in overview).
<br />

<br />
Store the script for example as image.php and link it like that:
<br />

<br />
<span class="default">&lt;?PHP
<br />
$image_name </span><span class="keyword">= </span><span class="string">"foo.jpg"</span><span class="keyword">;
<br />
</span><span class="default">$style </span><span class="keyword">= </span><span class="string">"show"</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; </span><span class="comment">// I've taken the foldernames. It's easier. For the 
<br />
&nbsp;&nbsp; &nbsp; //thumbnails replace "show" with "thumb".
<br />
</span><span class="default">$image_name </span><span class="keyword">= </span><span class="string">"imagesdb/</span><span class="default">$style</span><span class="string">/</span><span class="default">$image_name</span><span class="string">"</span><span class="keyword">;
<br />
if(!</span><span class="default">file_exists</span><span class="keyword">(</span><span class="default">$image_name</span><span class="keyword">))
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$image_name </span><span class="keyword">= </span><span class="string">"image.php?image_name=</span><span class="default">$image_name</span><span class="string">&amp;style=</span><span class="default">$style</span><span class="string">"</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; </span><span class="comment">// only if file doesn't exist call the on-the-fly creating file
<br />
</span><span class="default">?&gt;
<br />
</span>
<br />
Now the main script, stored in the file image.php:
<br />

<br />
<span class="default">&lt;?PHP
<br />

<br />
$image_name </span><span class="keyword">= </span><span class="default">$_GET</span><span class="keyword">[</span><span class="string">'image_name'</span><span class="keyword">];
<br />
</span><span class="default">$style </span><span class="keyword">= </span><span class="default">$_GET</span><span class="keyword">[</span><span class="string">'style'</span><span class="keyword">];
<br />

<br />
&nbsp;&nbsp; &nbsp; </span><span class="comment">// Now set the maximum sizes to the different styles.
<br />
&nbsp;&nbsp; &nbsp; // You may set additional styles, but remember to
<br />
&nbsp;&nbsp; &nbsp; // create the according subfolders.
<br />

<br />
</span><span class="keyword">switch(</span><span class="default">$style</span><span class="keyword">) {
<br />
&nbsp; case </span><span class="string">"show"</span><span class="keyword">:
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$max_size </span><span class="keyword">= </span><span class="default">800</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; break;
<br />
&nbsp; case </span><span class="string">"thumb"</span><span class="keyword">:
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$max_size </span><span class="keyword">= </span><span class="default">125</span><span class="keyword">;
<br />
}
<br />

<br />
</span><span class="default">$dest_file </span><span class="keyword">= </span><span class="string">"imagesdb/</span><span class="default">$style</span><span class="string">/</span><span class="default">$image_name</span><span class="string">"</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; </span><span class="comment">// set output file
<br />
</span><span class="default">$image_file </span><span class="keyword">= </span><span class="string">"imagesdb/full/</span><span class="default">$image_name</span><span class="string">"</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; </span><span class="comment">// set source file
<br />
</span><span class="default">$size </span><span class="keyword">= </span><span class="default">getimagesize</span><span class="keyword">(</span><span class="default">$image_file</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; </span><span class="comment">// get original size
<br />

<br />
</span><span class="keyword">if(</span><span class="default">$size</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">] &gt; </span><span class="default">$size</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">]) {
<br />
&nbsp; </span><span class="default">$divisor </span><span class="keyword">= </span><span class="default">$size</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">] / </span><span class="default">$max_size</span><span class="keyword">;
<br />
}
<br />
else {
<br />
&nbsp; </span><span class="default">$divisor </span><span class="keyword">= </span><span class="default">$size</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">] / </span><span class="default">$max_size</span><span class="keyword">;
<br />
}
<br />
&nbsp;&nbsp; &nbsp; </span><span class="comment">// to get allways pictures of the same size, which ist
<br />
&nbsp;&nbsp; &nbsp; // mostly wanted in imageviewers, look what ist larger:
<br />
&nbsp;&nbsp; &nbsp; // width or height
<br />

<br />
</span><span class="default">$new_width </span><span class="keyword">= </span><span class="default">$size</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">] / </span><span class="default">$divisor</span><span class="keyword">;
<br />
</span><span class="default">$new_height </span><span class="keyword">= </span><span class="default">$size</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">] / </span><span class="default">$divisor</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; </span><span class="comment">// set new sizes
<br />

<br />
</span><span class="default">settype</span><span class="keyword">(</span><span class="default">$new_width</span><span class="keyword">, </span><span class="string">'integer'</span><span class="keyword">);
<br />
</span><span class="default">settype</span><span class="keyword">(</span><span class="default">$new_height</span><span class="keyword">, </span><span class="string">'integer'</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; </span><span class="comment">// sizes should be integers
<br />

<br />
</span><span class="default">$image_big </span><span class="keyword">= </span><span class="default">imagecreatefromjpeg</span><span class="keyword">(</span><span class="default">$image_file</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; </span><span class="comment">// load original image
<br />
</span><span class="default">$image_small </span><span class="keyword">= </span><span class="default">imagecreatetruecolor</span><span class="keyword">(</span><span class="default">$new_width</span><span class="keyword">, </span><span class="default">$new_height</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; </span><span class="comment">// create new image
<br />
</span><span class="default">imagecopyresampled</span><span class="keyword">(</span><span class="default">$image_small</span><span class="keyword">, </span><span class="default">$image_big</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">, </span><span class="default">$new_width</span><span class="keyword">,</span><span class="default">$new_height</span><span class="keyword">, </span><span class="default">$size</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">],</span><span class="default">$size</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">]);
<br />
&nbsp;&nbsp; &nbsp; </span><span class="comment">// imageresampled whill result in a much higher quality
<br />
&nbsp;&nbsp; &nbsp; // than imageresized
<br />
</span><span class="default">imagedestroy</span><span class="keyword">(</span><span class="default">$image_big</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; </span><span class="comment">// the original data are no longer used
<br />

<br />
</span><span class="default">header</span><span class="keyword">(</span><span class="string">"Content-type: image/jpeg"</span><span class="keyword">);
<br />

<br />
if(</span><span class="default">$style</span><span class="keyword">==</span><span class="string">"show" </span><span class="keyword">|| </span><span class="default">$style</span><span class="keyword">==</span><span class="string">"thumb"</span><span class="keyword">) {
<br />
&nbsp; if(!</span><span class="default">file_exists</span><span class="keyword">(</span><span class="default">$dest_file</span><span class="keyword">))
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">imagejpeg</span><span class="keyword">(</span><span class="default">$image_small</span><span class="keyword">, </span><span class="default">$dest_file</span><span class="keyword">, </span><span class="default">100</span><span class="keyword">);
<br />
}
<br />
&nbsp;&nbsp; &nbsp; </span><span class="comment">// if you have set additional sizese put them in the
<br />
&nbsp;&nbsp; &nbsp; // if-arguments, too.
<br />
&nbsp;&nbsp; &nbsp; // if someone calls the image.php directly in the
<br />
&nbsp;&nbsp; &nbsp; // browser with imagenames allready existing, they
<br />
&nbsp;&nbsp; &nbsp; // won't be overwritten
<br />

<br />
</span><span class="default">imagejpeg</span><span class="keyword">(</span><span class="default">$image_small</span><span class="keyword">, </span><span class="string">''</span><span class="keyword">, </span><span class="default">100</span><span class="keyword">);
<br />
</span><span class="default">imagedestroy</span><span class="keyword">(</span><span class="default">$image_small</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; </span><span class="comment">// finally send image to browser and destroy no longer
<br />
&nbsp;&nbsp; &nbsp; // needed data.
<br />

<br />
</span><span class="default">?&gt;
<br />
</span>
<br />
As this website helped me for several times in the past and for creating this script, I hope I can help others with this script saving the time for developing a much more performant solution than an allways-on-the-fly-creating script.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="68356""></a>
  <div class="note">
   <strong class="user">chris dot calo at gmail dot com</strong>
   <a href="#68356" class="date">24-Jul-2006 07:30</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Thanks to Stuart and Darren for the corrections to the create_thumbnail function.&nbsp; Another note on that function: imagecreatefromwbmp was incorrectly used.&nbsp; WBMPs are wireless bitmaps, not windows bitmaps (thanks to clambert at whitecrown), so the thumbnail routine as is will not be able to handle windows bitmaps.&nbsp; See the notes at <a href="http://us2.php.net/manual/en/function.imagecreatefromwbmp.php for tips on working with windows bitmaps." rel="nofollow" target="_blank">http://us2.php.net/manual/en/function.imagecreatefromwbmp.php for tips on working with windows bitmaps.</a></span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="68333""></a>
  <div class="note">
   <strong class="user">stuart at purpletoucan dot com</strong>
   <a href="#68333" class="date">23-Jul-2006 10:55</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Thanks to Chris dot Calo for the thumbnail snippet.&nbsp; The file type issue is easily resolved by getting the type from the file with getimagesize, and you can handle unsupported types at that stage too.&nbsp; Thus:<br />
<br />
&nbsp;&nbsp; list($img_width,$img_height, $type) = getimagesize($source_file); // Get the original dimentions<br />
&nbsp;&nbsp; if ($type != 1 &amp;&amp; $type != 2 &amp;&amp; $type != 3 &amp;&amp; $type != 15) { die("Your file is not a supported format"); }<br />
<br />
...and then later check the type again to open the image correctly:<br />
<br />
&nbsp;&nbsp; if ( $type == 1 ) { $img_source = imagecreatefromgif($source_file); }<br />
&nbsp;&nbsp; else if ( $type == 2 ) { $img_source = imagecreatefromjpeg($source_file); }<br />
&nbsp;&nbsp; else if ( $type == 3 ) { $img_source = imagecreatefrompng($source_file); }<br />
&nbsp;&nbsp; else if ( $type == 15 ) { $img_source = imagecreatefromwbmp($source_file); }</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="68231""></a>
  <div class="note">
   <strong class="user">Darren Kulp ( kulp at thekulp dot com )</strong>
   <a href="#68231" class="date">18-Jul-2006 08:47</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
With regard to chris.calo's code:<br />
<br />
// The following block retrieves the source file.&nbsp; It assumes the filename extensions match the file's format.<br />
&nbsp;&nbsp; if ( strpos($source_file,".gif") ) { $img_source = imagecreatefromgif($source_file); }<br />
&nbsp;&nbsp; if ( (strpos($source_file,".jpg")) || (strpos($source_file,".jpeg")) )<br />
&nbsp;... etc.<br />
<br />
It assumes more than that, namely that the filename does not contain the strings '.gif', '.jpg', '.jpeg', '.bmp', or '.png' *anywhere* in the string. Some valid files with special filenames could break this; for example, a file named "used.to.be.a.png.file.gif" would cause this script to attempt to load the file as a PNG. Obviously this is a rare case, but the issue could be easily avoided by using "else ifs" (uses less CPU time) or checking that the extension abuts the end of the string or both.<br />
<br />
That said, the whole business could be avoided if PHP didn't clutter the namespace with different functions to do the same thing with different image formats. Ick.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="68194""></a>
  <div class="note">
   <strong class="user">chris dot calo at gmail dot com</strong>
   <a href="#68194" class="date">17-Jul-2006 02:44</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
function create_thumbnail( $source_file, $destination_file, $max_dimension)<br />
{<br />
&nbsp;&nbsp;&nbsp; list($img_width,$img_height) = getimagesize($source_file); // Get the original dimentions<br />
&nbsp;&nbsp;&nbsp; $aspect_ratio = $img_width / $img_height;<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; if ( ($img_width &gt; $max_dimension) || ($img_height &gt; $max_dimension) ) // If either dimension is too big...<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if ( $img_width &gt; $img_height ) // For wide images...<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $new_width = $max_dimension;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $new_height = $new_width / $aspect_ratio;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; elseif ( $img_width &lt; $img_height ) // For tall images...<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $new_height = $max_dimension;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $new_width = $new_height * $aspect_ratio;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; elseif ( $img_width == $img_height ) // For square images...<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $new_width = $max_dimension;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $new_height = $max_dimension;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; else { echo "Error reading image size."; return FALSE; }<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; else { $new_width = $img_width; $new_height = $img_height; } // If it's already smaller, don't change the size.<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; // Make sure these are integers.<br />
&nbsp;&nbsp;&nbsp; $new_width = intval($new_width);<br />
&nbsp;&nbsp;&nbsp; $new_height = intval($new_height);<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; $thumbnail = imagecreatetruecolor($new_width,$new_height); // Creates a new image in memory.<br />
<br />
&nbsp;&nbsp;&nbsp; // The following block retrieves the source file.&nbsp; It assumes the filename extensions match the file's format.<br />
&nbsp;&nbsp;&nbsp; if ( strpos($source_file,".gif") ) { $img_source = imagecreatefromgif($source_file); }<br />
&nbsp;&nbsp;&nbsp; if ( (strpos($source_file,".jpg")) || (strpos($source_file,".jpeg")) )<br />
&nbsp;&nbsp;&nbsp; { $img_source = imagecreatefromjpeg($source_file); }<br />
&nbsp;&nbsp;&nbsp; if ( strpos($source_file,".bmp") ) { $img_source = imagecreatefromwbmp($source_file); }<br />
&nbsp;&nbsp;&nbsp; if ( strpos($source_file,".png") ) { $img_source = imagecreatefrompng($source_file); }<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; // Here we resample and create the new jpeg.<br />
&nbsp;&nbsp;&nbsp; imagecopyresampled($thumbnail, $img_source, 0, 0, 0, 0, $new_width, $new_height, $img_width, $img_height);<br />
&nbsp;&nbsp;&nbsp; imagejpeg( $thumbnail, $destination_file, 100 );<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; // Finally, we destroy the two images in memory.<br />
&nbsp;&nbsp;&nbsp; imagedestroy($img_source);<br />
&nbsp;&nbsp;&nbsp; imagedestroy($thumbnail);<br />
}</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="63887""></a>
  <div class="note">
   <strong class="user">your [dot] sheepy [at] gmail [dot] com</strong>
   <a href="#63887" class="date">03-Apr-2006 01:34</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Regarding Carl Gieringer's comment, it is possible to have PHP files in utf-8.&nbsp; Just make sure the editor does not output BOM, which is unnecessary in utf-8 anyway.<br />
<br />
Except for any editors from Microsoft, most programmer's editors that supports utf allows you to surpress BOM.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="60315""></a>
  <div class="note">
   
   <a href="#60315" class="date">03-Jan-2006 05:59</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Hi<br />
<br />
I had similar problem with safe mode. My solution is:<br />
<br />
before imagejpeg(), touch() etc.<br />
write:<br />
ini_set(safe_mode,Off);<br />
and after everything:<br />
ini_set(safe_mode,On);<br />
<br />
strange, but it works <br />
Chears2All</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="59848""></a>
  <div class="note">
   <strong class="user">Kenneth Keiter</strong>
   <a href="#59848" class="date">17-Dec-2005 08:59</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
So.. after messing around with this beast of a function for hours, I discovered that it DOES NOT preserve the resource it is using the create the image, nor do imagepng() or imagegif(). By this I mean that you can not run two imagejpeg(), imagepng() or imagegif() calls on the same resource. Another possibly undocumented quirk... :-(</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="58391""></a>
  <div class="note">
   <strong class="user">moron at industrial dot org</strong>
   <a href="#58391" class="date">02-Nov-2005 08:12</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Please note that there is a bug report open for the currently broken safe_mode behaviour on this function:<br />
<br />
<a href="http://bugs.php.net/?id=35060" rel="nofollow" target="_blank">http://bugs.php.net/?id=35060</a><br />
<br />
According to the PHP staffer who has responded the docs are wrong (I don't agree but I'm also not their employee).&nbsp; <br />
<br />
The work around is to use touch() (or any other file system function that can do this) to create the file first before using imagejpeg().</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="56893""></a>
  <div class="note">
   <strong class="user">mbailey [at] aethon [dt] co [dt] uk</strong>
   <a href="#56893" class="date">18-Sep-2005 01:46</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
&gt;&gt;Bram Van Dam's<br />
<br />
note below is missing "()" from the ob_end_clean call:<br />
<br />
ob_end_clean; // stop this output buffer<br />
<br />
should read<br />
<br />
ob_end_clean(); // stop this output buffer<br />
<br />
You can then use this for adding content-length headers (for example flash requires a content length in advance to create loaders)<br />
<br />
e.g.<br />
<br />
...<br />
<br />
ob_start(); // start a new output buffer<br />
&nbsp;&nbsp; imagejpeg( $newimage, "", 90 );<br />
&nbsp;&nbsp; $ImageData = ob_get_contents();<br />
&nbsp;&nbsp; $ImageDataLength = ob_get_length();<br />
ob_end_clean(); // stop this output buffer<br />
<br />
header("Content-type: image/jpeg") ;<br />
header("Content-Length: ".$ImageDataLength);<br />
echo $ImageData;<br />
<br />
...</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="55987""></a>
  <div class="note">
   <strong class="user">Bram Van Dam</strong>
   <a href="#55987" class="date">19-Aug-2005 12:50</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you wish to capture the jpg data into a variable, rather than outputting it or saving it into a file (perhaps so you can put it in a database), you might want to consider output buffering. Something along these lines should work:<br />
<br />
<span class="default">&lt;?php<br />
ob_start</span><span class="keyword">(); </span><span class="comment">// start a new output buffer<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">imagejpeg</span><span class="keyword">( </span><span class="default">$newimage</span><span class="keyword">, </span><span class="default">NULL</span><span class="keyword">, </span><span class="default">100 </span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$ImageData </span><span class="keyword">= </span><span class="default">ob_get_contents</span><span class="keyword">();<br />
</span><span class="default">ob_end_clean</span><span class="keyword">; </span><span class="comment">// stop this output buffer<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="55530""></a>
  <div class="note">
   <strong class="user">John Luetke &lt;johnl1479 gmail com&gt;</strong>
   <a href="#55530" class="date">05-Aug-2005 05:53</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Rewrote the manual example into this function for creating a thumbnail image:<br />
<br />
function thumbnail_jpeg ($original, $thumbnail, $width, $height, $quality) {<br />
&nbsp; list($width_orig, $height_orig) = getimagesize($original);<br />
&nbsp; if ($width &amp;&amp; ($width_orig &lt; $height_orig)) {<br />
&nbsp;&nbsp;&nbsp; $width = ($height / $height_orig) * $width_orig;<br />
&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; else {<br />
&nbsp;&nbsp;&nbsp; $height = ($width / $width_orig) * $height_orig;<br />
&nbsp; }<br />
&nbsp; $image_p = imagecreatetruecolor($width, $height);<br />
&nbsp; $image = imagecreatefromjpeg($originial);<br />
&nbsp; imagecopyresampled($image_p, $image, 0, 0, 0, 0, $width, $height, $width_orig, $height_orig);<br />
&nbsp; imagejpeg($image_p, $thumbnail, $quality);<br />
&nbsp; return;<br />
}</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="53666""></a>
  <div class="note">
   <strong class="user">ghokanso at cs dot ndsu dot edu</strong>
   <a href="#53666" class="date">08-Jun-2005 09:54</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
When displaying an image using imagepng or imagejpeg, you may want/need to call "header("Content-type: image/jpeg")" before the imagepng and imagejpeg functions.<br />
It appears that some servers/browers are striping out the default header so the image is not rendered and appears as raw data.<br />
(Firefox 1.02+ and OSX Safari for example)</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="51553""></a>
  <div class="note">
   <strong class="user">wojteksw at go2 dot pl</strong>
   <a href="#51553" class="date">03-Apr-2005 03:37</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I have changed one line in the script of Kokesh<br />
25-Jun-2004 06:42 listed above, and now it generates better quality thumbnails. <br />
You have to change function imagecopyresized() to imagecopyresampled()</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="43560""></a>
  <div class="note">
   <strong class="user">Kokesh</strong>
   <a href="#43560" class="date">25-Jun-2004 09:42</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Here is the simple, but powerful script for creating thumbnails on the fly. <br />
You can include the script <br />
directly to www page - just put it in &lt;img src= tag. <br />
with width 150pix. <br />
This resizer respects the ASPECT RATIO.<br />
Here is the script:<br />
<span class="default">&lt;?php<br />
</span><span class="comment">// Use it this way: resize.php?pic=imageurl&amp;width=width_in_pixels<br />
// kokesh@kokeshnet.com 2004<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">header</span><span class="keyword">(</span><span class="string">"Content-type: image/jpeg"</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$im&nbsp; &nbsp;&nbsp; </span><span class="keyword">= </span><span class="default">imagecreatefromjpeg</span><span class="keyword">(</span><span class="default">$pic</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$orange </span><span class="keyword">= </span><span class="default">imagecolorallocate</span><span class="keyword">(</span><span class="default">$im</span><span class="keyword">, </span><span class="default">220</span><span class="keyword">, </span><span class="default">210</span><span class="keyword">, </span><span class="default">60</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$px&nbsp; &nbsp;&nbsp; </span><span class="keyword">= (</span><span class="default">imagesx</span><span class="keyword">(</span><span class="default">$im</span><span class="keyword">) - </span><span class="default">7.5 </span><span class="keyword">* </span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$string</span><span class="keyword">)) / </span><span class="default">2</span><span class="keyword">;<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$old_x</span><span class="keyword">=</span><span class="default">imageSX</span><span class="keyword">(</span><span class="default">$im</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$old_y</span><span class="keyword">=</span><span class="default">imageSY</span><span class="keyword">(</span><span class="default">$im</span><span class="keyword">);<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$new_w</span><span class="keyword">=(int)(</span><span class="default">$width</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; if ((</span><span class="default">$new_w</span><span class="keyword">&lt;=</span><span class="default">0</span><span class="keyword">) or (</span><span class="default">$new_w</span><span class="keyword">&gt;</span><span class="default">$old_x</span><span class="keyword">)) {<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">$new_w</span><span class="keyword">=</span><span class="default">$old_x</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$new_h</span><span class="keyword">=(</span><span class="default">$old_x</span><span class="keyword">*(</span><span class="default">$new_w</span><span class="keyword">/</span><span class="default">$old_x</span><span class="keyword">));<br />
<br />
&nbsp;&nbsp;&nbsp; if (</span><span class="default">$old_x </span><span class="keyword">&gt; </span><span class="default">$old_y</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$thumb_w</span><span class="keyword">=</span><span class="default">$new_w</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$thumb_h</span><span class="keyword">=</span><span class="default">$old_y</span><span class="keyword">*(</span><span class="default">$new_h</span><span class="keyword">/</span><span class="default">$old_x</span><span class="keyword">);<br />
<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; if (</span><span class="default">$old_x </span><span class="keyword">&lt; </span><span class="default">$old_y</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$thumb_w</span><span class="keyword">=</span><span class="default">$old_x</span><span class="keyword">*(</span><span class="default">$new_w</span><span class="keyword">/</span><span class="default">$old_y</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$thumb_h</span><span class="keyword">=</span><span class="default">$new_h</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; if (</span><span class="default">$old_x </span><span class="keyword">== </span><span class="default">$old_y</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$thumb_w</span><span class="keyword">=</span><span class="default">$new_w</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$thumb_h</span><span class="keyword">=</span><span class="default">$new_h</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; </span><span class="default">$thumb</span><span class="keyword">=</span><span class="default">ImageCreateTrueColor</span><span class="keyword">(</span><span class="default">$thumb_w</span><span class="keyword">,</span><span class="default">$thumb_h</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; </span><span class="default">imagecopyresized</span><span class="keyword">(</span><span class="default">$thumb</span><span class="keyword">,</span><span class="default">$im</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">$thumb_w</span><span class="keyword">,</span><span class="default">$thumb_h</span><span class="keyword">,</span><span class="default">$old_x</span><span class="keyword">,</span><span class="default">$old_y</span><span class="keyword">);<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">imagejpeg</span><span class="keyword">(</span><span class="default">$thumb</span><span class="keyword">,</span><span class="string">""</span><span class="keyword">,</span><span class="default">90</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">imagedestroy</span><span class="keyword">(</span><span class="default">$thumb</span><span class="keyword">);<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="42654""></a>
  <div class="note">
   
   <a href="#42654" class="date">25-May-2004 11:42</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
A word of warning when outputting images to the browser...<br />
<br />
Make sure there is no extra spaces around the <span class="default">&lt;?php ?&gt;</span> tags, in the file you are editing, and also any included files.<br />
<br />
I began to think there was a bug in GD or something, and I checked the file I was working on, but forgot about the includes...<br />
<br />
Hours gone..</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="38652""></a>
  <div class="note">
   <strong class="user">gzink at zinkconsulting dot com</strong>
   <a href="#38652" class="date">01-Jan-2004 03:17</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Don't forget that JPEG compression has artifacts! And they're not all really obvious. The PHP JPEG compression is pretty decent, but it seems to generally:<br />
<br />
-Lighten the image overall, by a reasonable amount (never seen this before, but it will drive graphic designers crazy, you might want to darken the image before compressing it)<br />
-Reduce saturation, especially with images with lots of points of different color within a few pixels of each other (this is a documented feature of JPEG)<br />
-Seriously mess with blue colors, which is common to all JPEG but really annoying in some situations with blue and black or other detailed blue parts<br />
<br />
You might want to consider using imagepng() and outputting a PNG image instead of a JPEG if any of the above affect you, or your image is not very photo-like. Sometimes I have an algorithm compare JPEG to PNG for an image and send the smaller version to the user. <br />
<br />
Also, when using imagepng(), you should use imageinterlace() before it 95% of the time. Interlaced JPEGs load progressively, improving in quality as the image loads, so users on slower connections see the whole image at low quality. All this happens without affecting the file size (actually, sometimes the file size is smaller!) or final quality.<br />
<br />
Hope this helps a few people out. It's not all that obvious without lots of playing around.<br />
<br />
-Galen<br />
<a href="http://zinkconsulting.com/" rel="nofollow" target="_blank">http://zinkconsulting.com/</a></span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="32503""></a>
  <div class="note">
   <strong class="user">irishcybernerd at email dot com</strong>
   <a href="#32503" class="date">29-May-2003 10:33</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Rather than using the temporary file, as described above, you can buffer the output stream. Someone else showed me this, and it seems to work very nicely.<br />
<br />
&nbsp;&nbsp;&nbsp; //Start buffering the output stream<br />
&nbsp;&nbsp;&nbsp; ob_start();<br />
<br />
&nbsp;&nbsp;&nbsp; // output the image as a file to the output stream<br />
&nbsp;&nbsp;&nbsp; Imagejpeg($im);<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; //Read the output buffer<br />
&nbsp;&nbsp;&nbsp; $buffer = ob_get_contents();<br />
<br />
&nbsp;&nbsp;&nbsp; //clear the buffer<br />
&nbsp;&nbsp;&nbsp; ob_end_clean();<br />
<br />
&nbsp;&nbsp;&nbsp; //use $buffer as you wish...</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="17491""></a>
  <div class="note">
   <strong class="user">dklein at gmx dot de</strong>
   <a href="#17491" class="date">11-Dec-2001 08:52</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Looks like any specified resolution settings in a JPEG file get lost when using imageJPEG() function in a script.
<br />
I had a high resolution JPEG which i added text to with imagestringup() so my customer can print the emailed JPEG as a filled form, but printing both Graphics from Photoshop revealed that any JPEG created is downsampled to 72 dpi, while width and height is kept.
<br />
(72 dpi is the standard web resolution)
<br />
Nothing to wonder about, but maybe if you read this you dont need to scratch your head :)</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
</div>
</div>
</div></div></body></html>
