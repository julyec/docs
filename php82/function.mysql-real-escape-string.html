<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
 <head>
  <meta http-equiv="content-type" content="text/html; CHARSET=UTF-8">
  <title>将字符串中的特殊字符进行转义，以在 SQL 语句中使用</title>
<link media="all" rel="stylesheet" type="text/css" href="styles/03e73060321a0a848018724a6c83de7f-theme-base.css" />
<link media="all" rel="stylesheet" type="text/css" href="styles/03e73060321a0a848018724a6c83de7f-theme-medium.css" />

  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <link media="all" rel="stylesheet" type="text/css" href="style.css"/>
 </head>
 <body class="docs" class="docs"><div class="navbar navbar-fixed-top">
  <div class="navbar-inner clearfix">
    <ul class="nav" style="width: 100%">
      <li style="float: left;"><a href="function.mysql-query.html">? mysql_query</a></li>
      <li style="float: right;"><a href="function.mysql-result.html">mysql_result ?</a></li>
    </ul>
  </div>
</div>
<div id="breadcrumbs" class="clearfix">
  <ul class="breadcrumbs-container">
    <li><a href="index.html">PHP Manual</a></li>
    <li><a href="ref.mysql.html">MySQL 函数</a></li>
    <li>将字符串中的特殊字符进行转义，以在 SQL 语句中使用</li>
  </ul>
</div>
<div id="layout">
  <div id="layout-content"><div id="function.mysql-real-escape-string" class="refentry">
 <div class="refnamediv">
  <h1 class="refname">mysql_real_escape_string</h1>
  <p class="verinfo">(PHP 4 &gt;= 4.3.0, PHP 5)</p><p class="refpurpose"><span class="refname">mysql_real_escape_string</span> &mdash; <span class="dc-title">将字符串中的特殊字符进行转义，以在 SQL 语句中使用</span></p>

 </div>

 <div id="function.mysql-real-escape-string-refsynopsisdiv">
  <div class="warning"><strong class="warning">Warning</strong>
   <p class="para">本扩展自 PHP 5.5.0
起已废弃，并在自 PHP 7.0.0 开始被移除。应使用 <a href="book.mysqli.html" class="link">MySQLi</a>
或 <a href="ref.pdo-mysql.html" class="link">PDO_MySQL</a> 扩展来替换之。参见 <a href="mysqlinfo.api.choosing.html" class="link">MySQL：选择 API</a> 
指南来获取更多信息。用以替代本函数的有：</p>
   <ul class="simplelist">
    <li class="member"><span class="function"><a href="mysqli.real-escape-string.html" class="function">mysqli_real_escape_string()</a></span></li>
    <li class="member"><span class="methodname"><a href="pdo.quote.html" class="methodname">PDO::quote()</a></span></li>
   </ul>
  </div>
 </div>

 <div class="refsect1 description" id="refsect1-function.mysql-real-escape-string-description">
  <h3 class="title">说明</h3>
  <div class="methodsynopsis dc-description">
   <span class="methodname"><strong>mysql_real_escape_string</strong></span>(<span class="methodparam"><span class="type">string</span> <code class="parameter">$unescaped_string</code></span>, <span class="methodparam"><span class="type">resource</span> <code class="parameter">$link_identifier</code><span class="initializer"> = NULL</span></span>): <span class="type">string</span></div>

  <p class="para rdfs-comment">
   考虑到连接的当前字符集，对 <code class="parameter">unescaped_string</code> 进行特殊字符转义，以便安全地将其放置在 <span class="function"><a href="function.mysql-query.html" class="function">mysql_query()</a></span> 中。如果要插入二进制数据，则必须使用此函数。
  </p>
  <p class="para">
   <span class="function"><strong>mysql_real_escape_string()</strong></span> 调用 mysql 库的函数
   mysql_real_escape_string, 在以下字符前添加反斜线：<code class="literal">\x00</code>、<code class="literal">\n</code>、<code class="literal">\r</code>、<code class="literal">\</code>、<code class="literal">&#039;</code>、<code class="literal">&quot;</code>
   和 <code class="literal">\x1a</code>.
  </p>
  <p class="para">
   在向 MySQL 发送查询之前，必须始终（有少数例外）使用此函数来确保数据的安全。
  </p>
  
  <div class="caution"><strong class="caution">Caution</strong>
   <h1 class="title">安全: 默认字符集</h1>
   <p class="para">
    The character set must be set either at the server level, or with
    the API function <span class="function"><a href="function.mysql-set-charset.html" class="function">mysql_set_charset()</a></span> for it to affect
    <span class="function"><strong>mysql_real_escape_string()</strong></span>. See the concepts section
    on <a href="mysqlinfo.concepts.charset.html" class="link">character sets</a> for
    more information.
   </p>
  </div>
 </div>


 <div class="refsect1 parameters" id="refsect1-function.mysql-real-escape-string-parameters">
  <h3 class="title">参数</h3>
  <p class="para">
   <dl>
    
     <dt>
<code class="parameter">unescaped_string</code></dt>

     <dd>

      <p class="para">
       The string that is to be escaped.
      </p>
     </dd>

    
    <dt>

<code class="parameter">link_identifier</code></dt>
<dd>
<p class="para">MySQL
连接。如不指定连接标识，则使用由 <span class="function"><a href="function.mysql-connect.html" class="function">mysql_connect()</a></span>
最近打开的连接。如果没有找到该连接，会尝试不带参数调用
<span class="function"><a href="function.mysql-connect.html" class="function">mysql_connect()</a></span>
来创建。如没有找到连接或无法建立连接，则会生成
<strong><code>E_WARNING</code></strong> 级别的错误。</p></dd>


   </dl>

  </p>
 </div>


 <div class="refsect1 returnvalues" id="refsect1-function.mysql-real-escape-string-returnvalues">
  <h3 class="title">返回值</h3>
  <p class="para">
   Returns the escaped string, or <strong><code>false</code></strong> on error.
  </p>
 </div>


 <div class="refsect1 errors" id="refsect1-function.mysql-real-escape-string-errors">
  <h3 class="title">错误／异常</h3>
  <p class="para">
   Executing this function without a MySQL connection present will
   also emit <strong><code>E_WARNING</code></strong> level PHP errors. Only
   execute this function with a valid MySQL connection present.
  </p>
 </div>

 
 <div class="refsect1 examples" id="refsect1-function.mysql-real-escape-string-examples">
  <h3 class="title">示例</h3>
  <p class="para">
   <div class="example" id="example-3586">
    <p><strong>Example #1 简单 <span class="function"><strong>mysql_real_escape_string()</strong></span> 示例</strong></p>
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br /></span><span style="color: #FF8000">// Connect<br /></span><span style="color: #0000BB">$link </span><span style="color: #007700">= </span><span style="color: #0000BB">mysql_connect</span><span style="color: #007700">(</span><span style="color: #DD0000">'mysql_host'</span><span style="color: #007700">, </span><span style="color: #DD0000">'mysql_user'</span><span style="color: #007700">, </span><span style="color: #DD0000">'mysql_password'</span><span style="color: #007700">)<br />    OR die(</span><span style="color: #0000BB">mysql_error</span><span style="color: #007700">());<br /><br /></span><span style="color: #FF8000">// Query<br /></span><span style="color: #0000BB">$query </span><span style="color: #007700">= </span><span style="color: #0000BB">sprintf</span><span style="color: #007700">(</span><span style="color: #DD0000">"SELECT * FROM users WHERE user='%s' AND password='%s'"</span><span style="color: #007700">,<br />            </span><span style="color: #0000BB">mysql_real_escape_string</span><span style="color: #007700">(</span><span style="color: #0000BB">$user</span><span style="color: #007700">),<br />            </span><span style="color: #0000BB">mysql_real_escape_string</span><span style="color: #007700">(</span><span style="color: #0000BB">$password</span><span style="color: #007700">));<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
    </div>

   </div>
  </p>
  <p class="para">
   <div class="example" id="example-3588">
    <p><strong>Example #2 <span class="function"><strong>mysql_real_escape_string()</strong></span> requires a connection example</strong></p>
    <div class="example-contents"><p>
     This example demonstrates what happens if a MySQL connection is not
     present when calling this function.
    </p></div>
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br /></span><span style="color: #FF8000">// We have not connected to MySQL<br /><br /></span><span style="color: #0000BB">$lastname  </span><span style="color: #007700">= </span><span style="color: #DD0000">"O'Reilly"</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">$_lastname </span><span style="color: #007700">= </span><span style="color: #0000BB">mysql_real_escape_string</span><span style="color: #007700">(</span><span style="color: #0000BB">$lastname</span><span style="color: #007700">);<br /><br /></span><span style="color: #0000BB">$query </span><span style="color: #007700">= </span><span style="color: #DD0000">"SELECT * FROM actors WHERE last_name = '</span><span style="color: #0000BB">$_lastname</span><span style="color: #DD0000">'"</span><span style="color: #007700">;<br /><br /></span><span style="color: #0000BB">var_dump</span><span style="color: #007700">(</span><span style="color: #0000BB">$_lastname</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">var_dump</span><span style="color: #007700">(</span><span style="color: #0000BB">$query</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
    </div>

    <div class="example-contents"><p>以上示例的输出类似于：</p></div>
    <div class="example-contents screen">
<div class="cdata"><pre>
Warning: mysql_real_escape_string(): No such file or directory in /this/test/script.php on line 5
Warning: mysql_real_escape_string(): A link to the server could not be established in /this/test/script.php on line 5

bool(false)
string(41) &quot;SELECT * FROM actors WHERE last_name = &#039;&#039;&quot;
</pre></div>
    </div>
   </div>
  </p>
  <p class="para">
   <div class="example" id="example-3590">
    <p><strong>Example #3 An example SQL Injection Attack</strong></p>
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br /></span><span style="color: #FF8000">// We didn't check $_POST['password'], it could be anything the user wanted! For example:<br /></span><span style="color: #0000BB">$_POST</span><span style="color: #007700">[</span><span style="color: #DD0000">'username'</span><span style="color: #007700">] = </span><span style="color: #DD0000">'aidan'</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">$_POST</span><span style="color: #007700">[</span><span style="color: #DD0000">'password'</span><span style="color: #007700">] = </span><span style="color: #DD0000">"' OR ''='"</span><span style="color: #007700">;<br /><br /></span><span style="color: #FF8000">// Query database to check if there are any matching users<br /></span><span style="color: #0000BB">$query </span><span style="color: #007700">= </span><span style="color: #DD0000">"SELECT * FROM users WHERE user='</span><span style="color: #007700">{</span><span style="color: #0000BB">$_POST</span><span style="color: #007700">[</span><span style="color: #DD0000">'username'</span><span style="color: #007700">]}</span><span style="color: #DD0000">' AND password='</span><span style="color: #007700">{</span><span style="color: #0000BB">$_POST</span><span style="color: #007700">[</span><span style="color: #DD0000">'password'</span><span style="color: #007700">]}</span><span style="color: #DD0000">'"</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">mysql_query</span><span style="color: #007700">(</span><span style="color: #0000BB">$query</span><span style="color: #007700">);<br /><br /></span><span style="color: #FF8000">// This means the query sent to MySQL would be:<br /></span><span style="color: #007700">echo </span><span style="color: #0000BB">$query</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
    </div>

     <div class="example-contents"><p>
      The query sent to MySQL:
     </p></div>
    <div class="example-contents screen">
<div class="cdata"><pre>
SELECT * FROM users WHERE user=&#039;aidan&#039; AND password=&#039;&#039; OR &#039;&#039;=&#039;&#039;
</pre></div>
    </div>
    <div class="example-contents"><p>
     This would allow anyone to log in without a valid password.
    </p></div>
   </div>
  </p>
 </div>


 <div class="refsect1 notes" id="refsect1-function.mysql-real-escape-string-notes">
  <h3 class="title">注释</h3>
  <blockquote class="note"><p><strong class="note">Note</strong>: 
   <p class="para">
    A MySQL connection is required before using 
    <span class="function"><strong>mysql_real_escape_string()</strong></span> otherwise an error of
    level <strong><code>E_WARNING</code></strong> is generated, and <strong><code>false</code></strong> is 
    returned. If <code class="parameter">link_identifier</code> isn&#039;t defined, the
    last MySQL connection is used.
   </p>
  </p></blockquote>
  <blockquote class="note"><p><strong class="note">Note</strong>: 
   <p class="para">
    If this function is not used to escape data, the query is vulnerable to
    <a href="security.database.sql-injection.html" class="link">SQL Injection Attacks</a>.
   </p>
  </p></blockquote>
  <blockquote class="note"><p><strong class="note">Note</strong>: 
   <span class="simpara">
    <span class="function"><strong>mysql_real_escape_string()</strong></span> does not escape
    <code class="literal">%</code> and <code class="literal">_</code>. These are wildcards in
    MySQL if combined with <code class="literal">LIKE</code>, <code class="literal">GRANT</code>,
    or <code class="literal">REVOKE</code>.
   </span>
  </p></blockquote>
 </div>


 <div class="refsect1 seealso" id="refsect1-function.mysql-real-escape-string-seealso">
  <h3 class="title">参见</h3>
  <p class="para">
   <ul class="simplelist">
    <li class="member"><span class="function"><a href="function.mysql-set-charset.html" class="function" rel="rdfs-seeAlso">mysql_set_charset()</a> - 设置客户端的字符集</span></li>
    <li class="member"><span class="function"><a href="function.mysql-client-encoding.html" class="function" rel="rdfs-seeAlso">mysql_client_encoding()</a> - 返回字符集的名称</span></li>
   </ul>
  </p>
 </div>

</div><div id="usernotes">
 <div class="head">
  <h3 class="title">User Contributed Notes</h3>
 </div>
<div id="allnotes">  <a name="126328""></a>
  <div class="note">
   <strong class="user">rohankumar dot 1524 at gmail dot com</strong>
   <a href="#126328" class="date">11-Aug-2021 07:26</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
There is requirement for old projects which are using `mysql_escape_string`, and upgrading the PHP version to 7 and above. Basically this happens in maintenance projects where we don't know how many files the functions are used in application. We can use [mysqli.real-escape-string][1] for the function:<br />
<br />
If you have a typical connection file like `conn.php`<br />
<br />
&nbsp;&nbsp;&nbsp; $conn = new mysqli($host, $user, $password, $db);<br />
&nbsp;&nbsp;&nbsp; // may be few more lines to handle the $conn<br />
&nbsp;&nbsp;&nbsp; if (!function_exists('mysql_escape_string')) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; function mysql_escape_string($sting){ // if mysql_escape_string not available<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return $conn-&gt;real_escape_string($string); // escape using the $conn instance<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
&nbsp; [1]: https://www.php.net/manual/en/mysqli.real-escape-string.php</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="121826""></a>
  <div class="note">
   <strong class="user">Aljo</strong>
   <a href="#121826" class="date">04-Nov-2017 05:14</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
@feedr<br />
I elaborated his note as following:<br />
$string = "asda\0sd\x1aas\\\\\\\\dasd\'asdasd\na\'\'sdasdad";<br />
$array1 = array('\\\\\\\\', '\0', '\n', '\r', "'", '"', '\x1a');<br />
$array2 = array('\\\\\\\\\\\\\\\\', '\\\0', '\\\n', '\\\r', "\\\'", '\\\"', '\\\Z');<br />
echo($string);<br />
echo(PHP_EOL);<br />
for( $i=0; $i&lt;count($array1); $i++ ) {<br />
&nbsp;&nbsp;&nbsp; if ($i==0)<br />
&nbsp;&nbsp;&nbsp; $p = '/(?&lt;!\\\\)'.$array1[$i].'(?!\\\\)/';<br />
&nbsp;&nbsp;&nbsp; else<br />
&nbsp;&nbsp;&nbsp; $p = '/(?&lt;!\\\\)'.$array1[$i].'/';<br />
&nbsp;&nbsp;&nbsp; echo($i);<br />
&nbsp;&nbsp;&nbsp; echo($p);<br />
&nbsp;&nbsp;&nbsp; echo( $array2[$i]);<br />
&nbsp;&nbsp;&nbsp; $string = preg_replace($p, $array2[$i], $string);<br />
&nbsp;&nbsp;&nbsp; echo("\t");<br />
&nbsp;&nbsp;&nbsp; echo($string);<br />
&nbsp;&nbsp;&nbsp; echo(PHP_EOL);<br />
}<br />
echo(PHP_EOL);<br />
echo($string);</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="120914""></a>
  <div class="note">
   <strong class="user">jonnie</strong>
   <a href="#120914" class="date">31-Mar-2017 10:53</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
To Quote Sam at Numb Safari<br />
<br />
[ "No discussion of escaping is complete without telling everyone that you should basically never use external input to generate interpreted code. This goes for SQL statements, or anything you would call any sort of "eval" function on.<br />
<br />
So, instead of using this terribly broken function, use parametric prepared statements instead.<br />
<br />
Honestly, using user provided data to compose SQL statements should be considered professional negligence and you should be held accountable by your employer or client for not using parametric prepared statements." ]<br />
<br />
Sam is right........<br />
<br />
However I do not think it is sensible to stop all sanitising and simply pass the task on to parametric prepared statements.<br />
<br />
A particular developer working in a particular situation will always know more about valid input (specific to that context). <br />
<br />
If you ask a user to pass in a value you have already given them and you know that all such values start AB****** and the string should be of length 7 or 11 but never any other length then you have the basis of a good pre-sanitiser - different allowable lengths of a string might indicate legacy data.<br />
<br />
I would never want to simply pass the rubbish that a malicious user may have passed in through a form to the parametric prepared statements, I would always want to do my own sanity checks first and in some cases these may err on the side of caution and simply choose to abort the Database op completely. <br />
<br />
That way my DB does not get clogged up with unsafe statements made safe - it simply does not get clogged up which is better.<br />
<br />
Security in layers - sanitisation and validation should still be considered in every situation BEFORE using prepared statements.<br />
<br />
In addition as far as I can read into the official doc<br />
==============================================<br />
<br />
"Escaping and SQL injection<br />
<br />
Bound variables are sent to the server separately from the query and thus cannot interfere with it. The server uses these values directly at the point of execution, after the statement template is parsed. Bound parameters do not need to be escaped as they are never substituted into the query string directly"<br />
<br />
That suggests to me that danger is avoided in the internals by alternative handling not by nullification.<br />
<br />
This means that a large project with incomplete conversion to prepared statements, legacy code in different parts of an organisation or servers talking to one another could all pass on the bad news from an immune location or situation to one that is not immune.<br />
<br />
As long as the sanitisation is competently performed without incurring additional risks then personally I would stick with certain layers of sanitisation and then call the prepared statements.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="110413""></a>
  <div class="note">
   <strong class="user">sam at numbsafari dot com</strong>
   <a href="#110413" class="date">19-Oct-2012 05:33</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
No discussion of escaping is complete without telling everyone that you should basically never use external input to generate interpreted code. This goes for SQL statements, or anything you would call any sort of "eval" function on.
<br />

<br />
So, instead of using this terribly broken function, use parametric prepared statements instead.
<br />

<br />
Honestly, using user provided data to compose SQL statements should be considered professional negligence and you should be held accountable by your employer or client for not using parametric prepared statements.
<br />

<br />
What does that mean?
<br />

<br />
It means instead of building a SQL statement like this:
<br />

<br />
"INSERT INTO X (A) VALUES(".$_POST["a"].")"
<br />

<br />
You should use mysqli's prepare() function (<a href="http://php.net/manual/en/mysqli.prepare.php" rel="nofollow" target="_blank">http://php.net/manual/en/mysqli.prepare.php</a>) to execute a statement that looks like this:
<br />

<br />
"INSERT INTO X (A) VALUES(?)"
<br />

<br />
NB: This doesn't mean you should never generate dynamic SQL statements. What it means is that you should never use user-provided data to generate those statements. Any user-provided data should be passed through as parameters to the statement after it has been prepared.
<br />

<br />
So, for example, if you are building up a little framework and want to do an insert to a table based on the request URI, it's in your best interest to not take the $_SERVER['REQUEST_URI'] value (or any part of it) and directly concatenate that with your query. Instead,&nbsp; you should parse out the portion of the $_SERVER['REQUEST_URI'] value that you want, and map that through some kind of function or associative array to a non-user provided value. If the mapping produces no value, you know that something is wrong with the user provided data.
<br />

<br />
Failing to follow this has been the cause of a number of SQL-injection problems in the Ruby On Rails framework, even though it uses parametric prepared statements. This is how GitHub was hacked at one point. So, no language is immune to this problem. That's why this is a general best practice and not something specific to PHP and why you should REALLY adopt it.
<br />

<br />
Also, you should still do some kind of validation of the data provided by users, even when using parametric prepared statements. This is because that user-provided data will often become part of some generated HTML, and you want to ensure that the user provided data isn't going to cause security problems in the browser.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="108125""></a>
  <div class="note">
   <strong class="user">Walter Tross</strong>
   <a href="#108125" class="date">30-Mar-2012 02:20</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
For further information:<br />
<a href="http://dev.mysql.com/doc/refman/5.5/en/mysql-real-escape-string.html" rel="nofollow" target="_blank">http://dev.mysql.com/doc/refman/5.5/en/mysql-real-escape-string.html</a><br />
(replace your MySQL version in the URL)</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="101248""></a>
  <div class="note">
   <strong class="user">feedr</strong>
   <a href="#101248" class="date">05-Dec-2010 08:38</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Just a little function which mimics the original mysql_real_escape_string but which doesn't need an active mysql connection. Could be implemented as a static function in a database class. Hope it helps someone.
<br />

<br />
<span class="default">&lt;?php
<br />
</span><span class="keyword">function </span><span class="default">mysql_escape_mimic</span><span class="keyword">(</span><span class="default">$inp</span><span class="keyword">) {
<br />
&nbsp;&nbsp;&nbsp; if(</span><span class="default">is_array</span><span class="keyword">(</span><span class="default">$inp</span><span class="keyword">))
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">array_map</span><span class="keyword">(</span><span class="default">__METHOD__</span><span class="keyword">, </span><span class="default">$inp</span><span class="keyword">);
<br />

<br />
&nbsp;&nbsp;&nbsp; if(!empty(</span><span class="default">$inp</span><span class="keyword">) &amp;&amp; </span><span class="default">is_string</span><span class="keyword">(</span><span class="default">$inp</span><span class="keyword">)) {
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">str_replace</span><span class="keyword">(array(</span><span class="string">'\\'</span><span class="keyword">, </span><span class="string">"\0"</span><span class="keyword">, </span><span class="string">"\n"</span><span class="keyword">, </span><span class="string">"\r"</span><span class="keyword">, </span><span class="string">"'"</span><span class="keyword">, </span><span class="string">'"'</span><span class="keyword">, </span><span class="string">"\x1a"</span><span class="keyword">), array(</span><span class="string">'\\\\'</span><span class="keyword">, </span><span class="string">'\\0'</span><span class="keyword">, </span><span class="string">'\\n'</span><span class="keyword">, </span><span class="string">'\\r'</span><span class="keyword">, </span><span class="string">"\\'"</span><span class="keyword">, </span><span class="string">'\\"'</span><span class="keyword">, </span><span class="string">'\\Z'</span><span class="keyword">), </span><span class="default">$inp</span><span class="keyword">);
<br />
&nbsp;&nbsp;&nbsp; }
<br />

<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">$inp</span><span class="keyword">;
<br />
}
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="95915""></a>
  <div class="note">
   <strong class="user">presto dot dk at gmail dot com</strong>
   <a href="#95915" class="date">28-Jan-2010 07:05</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you want to make sure that the ID you're using to do a query is a number, use sprint() of (int) or intval(), but don't use mysql_real_escape_string.<br />
<br />
There is no difference between ISO-8859-1's number 10 and UTF-8's number 10.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="95009""></a>
  <div class="note">
   <strong class="user">strata_ranger at hotmail dot com</strong>
   <a href="#95009" class="date">08-Dec-2009 11:17</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
There's an interesting quirk in the example #2 about SQL injection:&nbsp; AND takes priority over OR, so the injected query actually executes as WHERE (user='aidan' AND password='') OR ''='', so instead of returning a database record corresponding to an arbitrary username (in this case 'aidan'), it would actually return ALL database records.&nbsp; In no particular order.&nbsp; So an attacker might be able to log in as any account, but not necessarily with any control over which account it is.<br />
<br />
Of course a potential attacker could simply modify their parameters to target specific users of interest:<br />
<br />
<span class="default">&lt;?php<br />
<br />
</span><span class="comment">// E.g. attacker's values<br />
</span><span class="default">$_POST</span><span class="keyword">[</span><span class="string">'username'</span><span class="keyword">] = </span><span class="string">''</span><span class="keyword">;<br />
</span><span class="default">$_POST</span><span class="keyword">[</span><span class="string">'password'</span><span class="keyword">] = </span><span class="string">"' OR user = 'administrator' AND '' = '"</span><span class="keyword">;<br />
<br />
</span><span class="comment">// Malformed query<br />
</span><span class="default">$query </span><span class="keyword">= </span><span class="string">"SELECT * FROM users WHERE user='</span><span class="default">$_POST</span><span class="keyword">[</span><span class="default">username</span><span class="keyword">]</span><span class="string">' AND password='</span><span class="default">$_POST</span><span class="keyword">[</span><span class="default">password</span><span class="keyword">]</span><span class="string">'"</span><span class="keyword">;<br />
<br />
echo </span><span class="default">$query</span><span class="keyword">;<br />
<br />
</span><span class="comment">// The query sent to MySQL would read:<br />
// SELECT * FROM users WHERE user='' AND password='' OR user='administrator' AND ''='';<br />
// which would allow anyone to gain access to the account named 'administrator'<br />
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="92493""></a>
  <div class="note">
   <strong class="user">plgs at ozemail dot com dot au</strong>
   <a href="#92493" class="date">27-Jul-2009 01:05</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Don't forget that if you're using Mysqli (ie, the "improved" Mysql extension) then you need to use the corresponding mysqli function mysqli_real_escape_string().&nbsp; The parameter order is also different.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="66836""></a>
  <div class="note">
   <strong class="user">nicolas</strong>
   <a href="#66836" class="date">30-May-2006 01:38</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Note that mysql_real_escape_string doesn't prepend backslashes to \x00, \n, \r, and and \x1a as mentionned in the documentation, but actually replaces the character with a MySQL acceptable representation for queries (e.g. \n is replaced with the '\n' litteral). (\, ', and " are escaped as documented) This doesn't change how you should use this function, but I think it's good to know.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
</div>
</div>
</div></div></body></html>
