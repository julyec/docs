<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
 <head>
  <meta http-equiv="content-type" content="text/html; CHARSET=UTF-8">
  <title>向大对象写入数据</title>
<link media="all" rel="stylesheet" type="text/css" href="styles/03e73060321a0a848018724a6c83de7f-theme-base.css" />
<link media="all" rel="stylesheet" type="text/css" href="styles/03e73060321a0a848018724a6c83de7f-theme-medium.css" />

  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <link media="all" rel="stylesheet" type="text/css" href="style.css"/>
 </head>
 <body class="docs" class="docs"><div class="navbar navbar-fixed-top">
  <div class="navbar-inner clearfix">
    <ul class="nav" style="width: 100%">
      <li style="float: left;"><a href="function.pg-lo-unlink.html">? pg_lo_unlink</a></li>
      <li style="float: right;"><a href="function.pg-meta-data.html">pg_meta_data ?</a></li>
    </ul>
  </div>
</div>
<div id="breadcrumbs" class="clearfix">
  <ul class="breadcrumbs-container">
    <li><a href="index.html">PHP Manual</a></li>
    <li><a href="ref.pgsql.html">PostgreSQL 函数</a></li>
    <li>向大对象写入数据</li>
  </ul>
</div>
<div id="layout">
  <div id="layout-content"><div id="function.pg-lo-write" class="refentry">
 <div class="refnamediv">
  <h1 class="refname">pg_lo_write</h1>
   <p class="verinfo">(PHP 4 &gt;= 4.2.0, PHP 5, PHP 7, PHP 8)</p><p class="refpurpose"><span class="refname">pg_lo_write</span> &mdash; <span class="dc-title">向大对象写入数据</span></p>

 </div>

 <div class="refsect1 description" id="refsect1-function.pg-lo-write-description">
  <h3 class="title">说明</h3>
  <div class="methodsynopsis dc-description">
   <span class="methodname"><strong>pg_lo_write</strong></span>(<span class="methodparam"><span class="type"><a href="class.pgsql-lob.html" class="type PgSql\Lob">PgSql\Lob</a></span> <code class="parameter">$lob</code></span>, <span class="methodparam"><span class="type">string</span> <code class="parameter">$data</code></span>, <span class="methodparam"><span class="type">?</span><span class="type"><span class="type">int</span><span class="type"></span></span> <code class="parameter">$length</code><span class="initializer"> = <strong><code>null</code></strong></span></span>): <span class="type"><span class="type">int</span>|<span class="type"><span class="type false">false</span></span></span></div>

  <p class="para rdfs-comment">
   <span class="function"><strong>pg_lo_write()</strong></span> 在大对象的当前位置写入数据。
  </p>
  <p class="para">
   要使用大对象接口，必须将其封装在一个事务块中。
  </p>
  <blockquote class="note"><p><strong class="note">Note</strong>: 
   <p class="para">
    本函数以前的名字为 <span class="function"><strong>pg_lowrite()</strong></span>。
   </p>
  </p></blockquote>
 </div>


 <div class="refsect1 parameters" id="refsect1-function.pg-lo-write-parameters">
  <h3 class="title">参数</h3>
  <p class="para">
   <dl>
    
     <dt>
<code class="parameter">lob</code></dt>

     <dd>

      <p class="para">通过 <span class="function"><a href="function.pg-lo-open.html" class="function">pg_lo_open()</a></span> 返回的 <span class="classname"><a href="class.pgsql-lob.html" class="classname">PgSql\Lob</a></span> 实例。</p>
     </dd>

    
    
     <dt>
<code class="parameter">data</code></dt>

     <dd>

      <p class="para">
       写入到大对象中的数据。如果 <code class="parameter">length</code> 是 <span class="type">int</span> 并且少于
       <code class="parameter">data</code> 的长度，仅会写入 <code class="parameter">length</code> 个字节。
      </p>
     </dd>

    
    
     <dt>
<code class="parameter">length</code></dt>

     <dd>

      <p class="para">
       可选的最大写入字节数。必须大于零且不大于 <code class="parameter">data</code> 的长度。默认为 <code class="parameter">data</code> 的长度。
      </p>
     </dd>

    
   </dl>

  </p>
 </div>


 <div class="refsect1 returnvalues" id="refsect1-function.pg-lo-write-returnvalues">
  <h3 class="title">返回值</h3>
  <p class="para">
   写入到大对象的字节数，或出错时为 <strong><code>false</code></strong>。
  </p>
 </div>


 <div class="refsect1 changelog" id="refsect1-function.pg-lo-write-changelog">
  <h3 class="title">更新日志</h3>
  <table class="doctable informaltable">
   
    <thead>
     <tr>
      <th>版本</th>
      <th>说明</th>
     </tr>

    </thead>

    <tbody class="tbody">
     <tr>
 <td>8.1.0</td>
 <td>
  现在 <code class="parameter">lob</code> 接受 <span class="classname"><a href="class.pgsql-lob.html" class="classname">PgSql\Lob</a></span> 
  实例，之前接受 <a href="language.types.resource.html" class="link">资源(resource)</a>。
 </td>
</tr>

     <tr>
      <td>8.0.0</td>
      <td>
       <code class="parameter">length</code> 现在可为 null。
      </td>
     </tr>

    </tbody>
   
  </table>

 </div>


 <div class="refsect1 examples" id="refsect1-function.pg-lo-write-examples">
  <h3 class="title">示例</h3>
  <p class="para">
   <div class="example" id="example-3924">
    <p><strong>Example #1 <span class="function"><strong>pg_lo_write()</strong></span> 示例</strong></p>
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br />   $doc_oid </span><span style="color: #007700">= </span><span style="color: #0000BB">189762345</span><span style="color: #007700">;<br />   </span><span style="color: #0000BB">$data </span><span style="color: #007700">= </span><span style="color: #DD0000">"This will overwrite the start of the large object."</span><span style="color: #007700">;<br />   </span><span style="color: #0000BB">$database </span><span style="color: #007700">= </span><span style="color: #0000BB">pg_connect</span><span style="color: #007700">(</span><span style="color: #DD0000">"dbname=jacarta"</span><span style="color: #007700">);<br />   </span><span style="color: #0000BB">pg_query</span><span style="color: #007700">(</span><span style="color: #0000BB">$database</span><span style="color: #007700">, </span><span style="color: #DD0000">"begin"</span><span style="color: #007700">);<br />   </span><span style="color: #0000BB">$handle </span><span style="color: #007700">= </span><span style="color: #0000BB">pg_lo_open</span><span style="color: #007700">(</span><span style="color: #0000BB">$database</span><span style="color: #007700">, </span><span style="color: #0000BB">$doc_oid</span><span style="color: #007700">, </span><span style="color: #DD0000">"w"</span><span style="color: #007700">);<br />   </span><span style="color: #0000BB">$data </span><span style="color: #007700">= </span><span style="color: #0000BB">pg_lo_write</span><span style="color: #007700">(</span><span style="color: #0000BB">$handle</span><span style="color: #007700">, </span><span style="color: #0000BB">$data</span><span style="color: #007700">);<br />   </span><span style="color: #0000BB">pg_query</span><span style="color: #007700">(</span><span style="color: #0000BB">$database</span><span style="color: #007700">, </span><span style="color: #DD0000">"commit"</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
    </div>

   </div>
  </p>
 </div>


 <div class="refsect1 seealso" id="refsect1-function.pg-lo-write-seealso">
  <h3 class="title">参见</h3>
  <p class="para">
   <ul class="simplelist">
    <li class="member"><span class="function"><a href="function.pg-lo-create.html" class="function" rel="rdfs-seeAlso">pg_lo_create()</a> - 新建大对象</span></li>
    <li class="member"><span class="function"><a href="function.pg-lo-open.html" class="function" rel="rdfs-seeAlso">pg_lo_open()</a> - 打开大对象</span></li>
   </ul>
  </p>
 </div>

</div><div id="usernotes">
 <div class="head">
  <h3 class="title">User Contributed Notes</h3>
 </div>
<div id="allnotes">  <a name="32732""></a>
  <div class="note">
   <strong class="user">nandrews at logictree dot co dot uk</strong>
   <a href="#32732" class="date">05-Jun-2003 08:17</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Using php 4.3.0 and PostgreSQL 7.3.1<br />
<br />
I can write a simple script in which pg_lo_write seems to always return 1 and not the number of bytes written, as evidenced by extracting the data through another means.<br />
<br />
Further more, I can make this pg_lo_write fail, or at least fail to write all the data it's pretty difficult to tell without the number of bytes written being returned, and not return the false value. In addition to this, the lo resource has been adjusted so that the oid it contains is 0.<br />
<br />
Unfortunately, I do not know what exactly the failure mode is, it does seem to be in the ip network communication side of PostgreSQL, which is odd since the unix domain comms works fine for this. However, it would have been useful to have the pg_lo_write() function return as advertised, it would have saved some of the 2 man hours me and the dev. team put into diagnosing this problem.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="12663""></a>
  <div class="note">
   <strong class="user">cedric at isoca.com</strong>
   <a href="#12663" class="date">27-Apr-2001 05:26</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Be aware when you modify a lo with pg_lowrite() to remove first the old one : if the new lo is smaller than the one before, it only overwrite the begining and you keep the end of the old lo (open with "w" parameter, PHP 4.04 Linux RH).</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
</div>
</div>
</div></div></body></html>
