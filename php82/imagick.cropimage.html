<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
 <head>
  <meta http-equiv="content-type" content="text/html; CHARSET=UTF-8">
  <title>截图图片的一块区域</title>
<link media="all" rel="stylesheet" type="text/css" href="styles/03e73060321a0a848018724a6c83de7f-theme-base.css" />
<link media="all" rel="stylesheet" type="text/css" href="styles/03e73060321a0a848018724a6c83de7f-theme-medium.css" />

  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <link media="all" rel="stylesheet" type="text/css" href="style.css"/>
 </head>
 <body class="docs" class="docs"><div class="navbar navbar-fixed-top">
  <div class="navbar-inner clearfix">
    <ul class="nav" style="width: 100%">
      <li style="float: left;"><a href="imagick.count.html">? Imagick::count</a></li>
      <li style="float: right;"><a href="imagick.cropthumbnailimage.html">Imagick::cropThumbnailImage ?</a></li>
    </ul>
  </div>
</div>
<div id="breadcrumbs" class="clearfix">
  <ul class="breadcrumbs-container">
    <li><a href="index.html">PHP Manual</a></li>
    <li><a href="class.imagick.html">Imagick</a></li>
    <li>截图图片的一块区域</li>
  </ul>
</div>
<div id="layout">
  <div id="layout-content"><div id="imagick.cropimage" class="refentry">
 <div class="refnamediv">
  <h1 class="refname">Imagick::cropImage</h1>
  <p class="verinfo">(PECL imagick 2, PECL imagick 3)</p><p class="refpurpose"><span class="refname">Imagick::cropImage</span> &mdash; <span class="dc-title">截图图片的一块区域</span></p>

 </div>

 <div class="refsect1 description" id="refsect1-imagick.cropimage-description">
  <h3 class="title">说明</h3>
  <div class="methodsynopsis dc-description">
   <span class="modifier">public</span> <span class="methodname"><strong>Imagick::cropImage</strong></span>(<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="methodparam"><span class="type">int</span> <code class="parameter">$width</code></span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="methodparam"><span class="type">int</span> <code class="parameter">$height</code></span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="methodparam"><span class="type">int</span> <code class="parameter">$x</code></span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="methodparam"><span class="type">int</span> <code class="parameter">$y</code></span><br>): <span class="type">bool</span></div>

  <p class="para rdfs-comment">
   截图图片的一块区域
  </p>
 </div>


 <div class="refsect1 parameters" id="refsect1-imagick.cropimage-parameters">
  <h3 class="title">参数</h3>
  <p class="para">
   <dl>
    
     <dt>
<code class="parameter">width</code></dt>

     <dd>

      <p class="para">
       截图的宽度
      </p>
     </dd>

    
    
     <dt>
<code class="parameter">height</code></dt>

     <dd>

      <p class="para">
       截图的高度
      </p>
     </dd>

    
    
     <dt>
<code class="parameter">x</code></dt>

     <dd>

      <p class="para">
       裁剪区域左上角的 X 轴坐标（以原图的左上角为原点）
      </p>
     </dd>

    
    
     <dt>
<code class="parameter">y</code></dt>

     <dd>

      <p class="para">
       裁剪区域左上角的 X 轴坐标（以原图的左上角为原点）
      </p>
     </dd>

    
   </dl>

  </p>
 </div>


 <div class="refsect1 returnvalues" id="refsect1-imagick.cropimage-returnvalues">
  <h3 class="title">返回值</h3>
  <p class="para">
   成功时返回 <strong><code>true</code></strong>。
  </p>
 </div>


 <div class="refsect1 errors" id="refsect1-imagick.cropimage-errors">
  <h3 class="title">错误／异常</h3>
  <p class="para">
   错误时抛出 ImagickException。
  </p>
 </div>




 <div class="refsect1 examples" id="refsect1-imagick.cropimage-examples">
  <h3 class="title">示例</h3>
  <p class="para">
    <div class="example" id="">
      <p><strong>Example #1  <span class="function"><strong>Imagick::cropImage()</strong></span></strong></p>
      <div class="example-contents">
      <div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br /></span><span style="color: #007700">function </span><span style="color: #0000BB">cropImage</span><span style="color: #007700">(</span><span style="color: #0000BB">$imagePath</span><span style="color: #007700">, </span><span style="color: #0000BB">$startX</span><span style="color: #007700">, </span><span style="color: #0000BB">$startY</span><span style="color: #007700">, </span><span style="color: #0000BB">$width</span><span style="color: #007700">, </span><span style="color: #0000BB">$height</span><span style="color: #007700">) {<br />    </span><span style="color: #0000BB">$imagick </span><span style="color: #007700">= new </span><span style="color: #0000BB">\Imagick</span><span style="color: #007700">(</span><span style="color: #0000BB">realpath</span><span style="color: #007700">(</span><span style="color: #0000BB">$imagePath</span><span style="color: #007700">));<br />    </span><span style="color: #0000BB">$imagick</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">cropImage</span><span style="color: #007700">(</span><span style="color: #0000BB">$width</span><span style="color: #007700">, </span><span style="color: #0000BB">$height</span><span style="color: #007700">, </span><span style="color: #0000BB">$startX</span><span style="color: #007700">, </span><span style="color: #0000BB">$startY</span><span style="color: #007700">);<br />    </span><span style="color: #0000BB">header</span><span style="color: #007700">(</span><span style="color: #DD0000">"Content-Type: image/jpg"</span><span style="color: #007700">);<br />    echo </span><span style="color: #0000BB">$imagick</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">getImageBlob</span><span style="color: #007700">();<br />}<br /><br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
      </div>

    </div>
  </p>
 </div>


</div><div id="usernotes">
 <div class="head">
  <h3 class="title">User Contributed Notes</h3>
 </div>
<div id="allnotes">  <a name="119086""></a>
  <div class="note">
   <strong class="user">olav at schettler dot net</strong>
   <a href="#119086" class="date">30-Mar-2016 08:06</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Here is a simple function to create a thumbnail. It accepts an additional parameter to set the focus point of the generated thumbnail:<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">function </span><span class="default">thumbnail</span><span class="keyword">(</span><span class="default">$image</span><span class="keyword">, </span><span class="default">$new_w</span><span class="keyword">, </span><span class="default">$new_h</span><span class="keyword">, </span><span class="default">$focus </span><span class="keyword">= </span><span class="string">'center'</span><span class="keyword">)<br />
{<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$w </span><span class="keyword">= </span><span class="default">$image</span><span class="keyword">-&gt;</span><span class="default">getImageWidth</span><span class="keyword">();<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$h </span><span class="keyword">= </span><span class="default">$image</span><span class="keyword">-&gt;</span><span class="default">getImageHeight</span><span class="keyword">();<br />
<br />
&nbsp;&nbsp;&nbsp; if (</span><span class="default">$w </span><span class="keyword">&gt; </span><span class="default">$h</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$resize_w </span><span class="keyword">= </span><span class="default">$w </span><span class="keyword">* </span><span class="default">$new_h </span><span class="keyword">/ </span><span class="default">$h</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$resize_h </span><span class="keyword">= </span><span class="default">$new_h</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; else {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$resize_w </span><span class="keyword">= </span><span class="default">$new_w</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$resize_h </span><span class="keyword">= </span><span class="default">$h </span><span class="keyword">* </span><span class="default">$new_w </span><span class="keyword">/ </span><span class="default">$w</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$image</span><span class="keyword">-&gt;</span><span class="default">resizeImage</span><span class="keyword">(</span><span class="default">$resize_w</span><span class="keyword">, </span><span class="default">$resize_h</span><span class="keyword">, </span><span class="default">Imagick</span><span class="keyword">::</span><span class="default">FILTER_LANCZOS</span><span class="keyword">, </span><span class="default">0.9</span><span class="keyword">);<br />
<br />
&nbsp;&nbsp;&nbsp; switch (</span><span class="default">$focus</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="string">'northwest'</span><span class="keyword">:<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$image</span><span class="keyword">-&gt;</span><span class="default">cropImage</span><span class="keyword">(</span><span class="default">$new_w</span><span class="keyword">, </span><span class="default">$new_h</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; break;<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="string">'center'</span><span class="keyword">:<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$image</span><span class="keyword">-&gt;</span><span class="default">cropImage</span><span class="keyword">(</span><span class="default">$new_w</span><span class="keyword">, </span><span class="default">$new_h</span><span class="keyword">, (</span><span class="default">$resize_w </span><span class="keyword">- </span><span class="default">$new_w</span><span class="keyword">) / </span><span class="default">2</span><span class="keyword">, (</span><span class="default">$resize_h </span><span class="keyword">- </span><span class="default">$new_h</span><span class="keyword">) / </span><span class="default">2</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; break;<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="string">'northeast'</span><span class="keyword">:<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$image</span><span class="keyword">-&gt;</span><span class="default">cropImage</span><span class="keyword">(</span><span class="default">$new_w</span><span class="keyword">, </span><span class="default">$new_h</span><span class="keyword">, </span><span class="default">$resize_w </span><span class="keyword">- </span><span class="default">$new_w</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; break;<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="string">'southwest'</span><span class="keyword">:<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$image</span><span class="keyword">-&gt;</span><span class="default">cropImage</span><span class="keyword">(</span><span class="default">$new_w</span><span class="keyword">, </span><span class="default">$new_h</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">$resize_h </span><span class="keyword">- </span><span class="default">$new_h</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; break;<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="string">'southeast'</span><span class="keyword">:<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$image</span><span class="keyword">-&gt;</span><span class="default">cropImage</span><span class="keyword">(</span><span class="default">$new_w</span><span class="keyword">, </span><span class="default">$new_h</span><span class="keyword">, </span><span class="default">$resize_w </span><span class="keyword">- </span><span class="default">$new_w</span><span class="keyword">, </span><span class="default">$resize_h </span><span class="keyword">- </span><span class="default">$new_h</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; break;<br />
&nbsp;&nbsp;&nbsp; }<br />
}<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="117087""></a>
  <div class="note">
   <strong class="user">oxxido at gmail dot com</strong>
   <a href="#117087" class="date">13-Apr-2015 05:58</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I have a function that takes an image, resize and crop it, and save it as normal, then resize it again and crop it again to create the thumbnail. The numbers of the second crop were WAY off, and the calculations were perfect, the problem, was the second crop wasn't resetting the imagePage, so if you try to crop the same image twice, it will be a good idea to reset it first:<br />
<span class="default">&lt;?php<br />
$thumb </span><span class="keyword">= new </span><span class="default">Imagick</span><span class="keyword">(</span><span class="default">$file</span><span class="keyword">)<br />
</span><span class="default">$thumb</span><span class="keyword">-&gt;</span><span class="default">resizeImage</span><span class="keyword">(</span><span class="default">$r_w1</span><span class="keyword">,</span><span class="default">$r_h1</span><span class="keyword">,</span><span class="default">Imagick</span><span class="keyword">::</span><span class="default">FILTER_CATROM</span><span class="keyword">,</span><span class="default">0.9</span><span class="keyword">, </span><span class="default">false</span><span class="keyword">);<br />
</span><span class="default">$thumb</span><span class="keyword">-&gt;</span><span class="default">cropImage</span><span class="keyword">(</span><span class="default">$w1</span><span class="keyword">,</span><span class="default">$h1</span><span class="keyword">,</span><span class="default">$l1</span><span class="keyword">,</span><span class="default">$t1</span><span class="keyword">);<br />
</span><span class="default">$thumb</span><span class="keyword">-&gt;</span><span class="default">writeImage</span><span class="keyword">(</span><span class="default">$destinationPath</span><span class="keyword">.</span><span class="string">'/'</span><span class="keyword">.</span><span class="default">$fileName</span><span class="keyword">);<br />
<br />
</span><span class="default">$thumb</span><span class="keyword">-&gt;</span><span class="default">resizeImage</span><span class="keyword">(</span><span class="default">$r_w2</span><span class="keyword">,</span><span class="default">$r_h2</span><span class="keyword">,</span><span class="default">Imagick</span><span class="keyword">::</span><span class="default">FILTER_CATROM</span><span class="keyword">,</span><span class="default">0.9</span><span class="keyword">, </span><span class="default">false</span><span class="keyword">);<br />
</span><span class="default">$thumb</span><span class="keyword">-&gt;</span><span class="default">setImagePage</span><span class="keyword">(</span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">);<br />
</span><span class="default">$thumb</span><span class="keyword">-&gt;</span><span class="default">cropImage</span><span class="keyword">(</span><span class="default">$w2</span><span class="keyword">,</span><span class="default">$h2</span><span class="keyword">,</span><span class="default">$l2</span><span class="keyword">,</span><span class="default">$t2</span><span class="keyword">);<br />
</span><span class="default">$thumb</span><span class="keyword">-&gt;</span><span class="default">writeImage</span><span class="keyword">(</span><span class="default">$destinationPath</span><span class="keyword">.</span><span class="string">'/'</span><span class="keyword">.</span><span class="default">$fileNameThumb</span><span class="keyword">);<br />
<br />
</span><span class="default">?&gt;<br />
</span><br />
BTW, i needed perfect dimentions so i had to set the "bestfit" to false.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="100772""></a>
  <div class="note">
   <strong class="user">ElPadre</strong>
   <a href="#100772" class="date">05-Nov-2010 08:55</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Actually, the Imagick::setImagePage(0,0,0,0) is also handy with jpgs and pngs, if you plan to do any more changes on the cropped image that involves positioning and/or gravity (I created a script that does crop, face blur and watermarking in one go, and had a hell of a time determining why the blurs and the watermark text never showed up...).</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="97232""></a>
  <div class="note">
   <strong class="user">Christian Dehning</strong>
   <a href="#97232" class="date">09-Apr-2010 03:57</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
When cropping gif-images (I had no problems with jpg and png images), the canvas is not removed. Please run the following command on the cropped gif, to remove the blank space:<br />
<br />
$im-&gt;setImagePage(0, 0, 0, 0);</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
</div>
</div>
</div></div></body></html>
