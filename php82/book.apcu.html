<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
 <head>
  <meta http-equiv="content-type" content="text/html; CHARSET=UTF-8">
  <title>APC 用户缓存</title>
<link media="all" rel="stylesheet" type="text/css" href="styles/03e73060321a0a848018724a6c83de7f-theme-base.css" />
<link media="all" rel="stylesheet" type="text/css" href="styles/03e73060321a0a848018724a6c83de7f-theme-medium.css" />

  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <link media="all" rel="stylesheet" type="text/css" href="style.css"/>
 </head>
 <body class="docs" class="docs"><div class="navbar navbar-fixed-top">
  <div class="navbar-inner clearfix">
    <ul class="nav" style="width: 100%">
      <li style="float: left;"><a href="refs.basic.php.html">? 影响 PHP 行为的扩展</a></li>
      <li style="float: right;"><a href="intro.apcu.html">简介 ?</a></li>
    </ul>
  </div>
</div>
<div id="breadcrumbs" class="clearfix">
  <ul class="breadcrumbs-container">
    <li><a href="index.html">PHP Manual</a></li>
    <li><a href="refs.basic.php.html">影响 PHP 行为的扩展</a></li>
    <li>APC 用户缓存</li>
  </ul>
</div>
<div id="layout">
  <div id="layout-content"><div id="book.apcu" class="book">
 
 <h1 class="title">APC 用户缓存</h1>
 

 

 







 






 







 







<ul class="chunklist chunklist_book"><li><a href="intro.apcu.html">简介</a></li><li><a href="apcu.setup.html">安装/配置</a><ul class="chunklist chunklist_book chunklist_children"><li><a href="apcu.requirements.html">需求</a></li><li><a href="apcu.installation.html">安装</a></li><li><a href="apcu.configuration.html">运行时配置</a></li><li><a href="apcu.resources.html">资源类型</a></li></ul></li><li><a href="apcu.constants.html">预定义常量</a></li><li><a href="ref.apcu.html">APCu 函数</a><ul class="chunklist chunklist_book chunklist_children"><li><a href="function.apcu-add.html">apcu_add</a> &mdash; 缓存一个新变量到存储中</li><li><a href="function.apcu-cache-info.html">apcu_cache_info</a> &mdash; 从 APCu 存储中获取缓存信息</li><li><a href="function.apcu-cas.html">apcu_cas</a> &mdash; Updates an old value with a new value</li><li><a href="function.apcu-clear-cache.html">apcu_clear_cache</a> &mdash; Clears the APCu cache</li><li><a href="function.apcu-dec.html">apcu_dec</a> &mdash; Decrease a stored number</li><li><a href="function.apcu-delete.html">apcu_delete</a> &mdash; Removes a stored variable from the cache</li><li><a href="function.apcu-enabled.html">apcu_enabled</a> &mdash; Whether APCu is usable in the current environment</li><li><a href="function.apcu-entry.html">apcu_entry</a> &mdash; Atomically fetch or generate a cache entry</li><li><a href="function.apcu-exists.html">apcu_exists</a> &mdash; Checks if entry exists</li><li><a href="function.apcu-fetch.html">apcu_fetch</a> &mdash; Fetch a stored variable from the cache</li><li><a href="function.apcu-inc.html">apcu_inc</a> &mdash; Increase a stored number</li><li><a href="function.apcu-key-info.html">apcu_key_info</a> &mdash; Get detailed information about the cache key</li><li><a href="function.apcu-sma-info.html">apcu_sma_info</a> &mdash; Retrieves APCu Shared Memory Allocation information</li><li><a href="function.apcu-store.html">apcu_store</a> &mdash; 缓存一个变量到存储中</li></ul></li><li><a href="class.apcuiterator.html">APCUIterator</a> &mdash; APCUIterator 类<ul class="chunklist chunklist_book chunklist_children"><li><a href="apcuiterator.construct.html">APCUIterator::__construct</a> &mdash; Constructs an APCUIterator iterator object</li><li><a href="apcuiterator.current.html">APCUIterator::current</a> &mdash; Get current item</li><li><a href="apcuiterator.gettotalcount.html">APCUIterator::getTotalCount</a> &mdash; Get total count</li><li><a href="apcuiterator.gettotalhits.html">APCUIterator::getTotalHits</a> &mdash; Get total cache hits</li><li><a href="apcuiterator.gettotalsize.html">APCUIterator::getTotalSize</a> &mdash; Get total cache size</li><li><a href="apcuiterator.key.html">APCUIterator::key</a> &mdash; Get iterator key</li><li><a href="apcuiterator.next.html">APCUIterator::next</a> &mdash; Move pointer to next item</li><li><a href="apcuiterator.rewind.html">APCUIterator::rewind</a> &mdash; Rewinds iterator</li><li><a href="apcuiterator.valid.html">APCUIterator::valid</a> &mdash; Checks if current position is valid</li></ul></li></ul></div><div id="usernotes">
 <div class="head">
  <h3 class="title">User Contributed Notes</h3>
 </div>
<div id="allnotes">  <a name="125382""></a>
  <div class="note">
   <strong class="user">alex at modula-shop-systems dot de</strong>
   <a href="#125382" class="date">21-Sep-2020 11:43</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
For PHP-FPM :<br />
Note that all ini values are PHP_INI_SYSTEM and can't be set via php_admin_value in pool.d/xxx.conf and therefore not via different webhosting control/configuration panels.<br />
<br />
Use /etc/php/7.x/fpm/conf.d/20-apcu.ini or /etc/php/7.x/fpm/php.ini</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="125057""></a>
  <div class="note">
   <strong class="user">boefje at hotmail dot com</strong>
   <a href="#125057" class="date">29-May-2020 10:55</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
To use apcu, the apcu extension has to be installed. You can find it here https://pecl.php.net/package/APCu<br />
<br />
Note: apcu is not the same as apc! <br />
<br />
APCu is the official replacement for the outdated APC extension. APC provided both opcode caching (opcache) and object caching. As PHP versions 5.5 and above include their own opcache, APC was no longer compatible, and its opcache functionality became useless. The developers of APC then created APCu, which offers only the object caching (read "in memory data caching") functionality (they removed the outdated opcache).<br />
<br />
Wondering how to use apcu? The following example should give you a basic understanding.<br />
<br />
<span class="default">&lt;?php<br />
<br />
date_default_timezone_set</span><span class="keyword">(</span><span class="string">'Europe/Amsterdam'</span><span class="keyword">);<br />
<br />
</span><span class="default">$apcuAvailabe </span><span class="keyword">= </span><span class="default">function_exists</span><span class="keyword">(</span><span class="string">'apcu_enabled'</span><span class="keyword">) &amp;&amp; </span><span class="default">apcu_enabled</span><span class="keyword">();<br />
<br />
if(</span><span class="default">$apcuAvailabe</span><span class="keyword">)<br />
{<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">//apcu_clear_cache();<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$test1 </span><span class="keyword">= </span><span class="default">apcu_fetch</span><span class="keyword">(</span><span class="string">'test1'</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$test2 </span><span class="keyword">= </span><span class="default">apcu_fetch</span><span class="keyword">(</span><span class="string">'test2'</span><span class="keyword">);<br />
}<br />
<br />
</span><span class="default">$test1</span><span class="keyword">[] = </span><span class="default">rand</span><span class="keyword">(</span><span class="default">1</span><span class="keyword">, </span><span class="default">1000</span><span class="keyword">);<br />
</span><span class="default">$test2</span><span class="keyword">[] = </span><span class="default">rand</span><span class="keyword">(</span><span class="default">1</span><span class="keyword">, </span><span class="default">1000</span><span class="keyword">);<br />
<br />
if(</span><span class="default">$apcuAvailabe</span><span class="keyword">)<br />
{<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">apcu_store</span><span class="keyword">(</span><span class="string">'test1'</span><span class="keyword">, </span><span class="default">$test1</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">apcu_store</span><span class="keyword">(</span><span class="string">'test2'</span><span class="keyword">, </span><span class="default">$test2</span><span class="keyword">);<br />
}<br />
<br />
echo </span><span class="default">sprintf</span><span class="keyword">(</span><span class="string">'current - value = %s&lt;br/&gt;'</span><span class="keyword">, </span><span class="default">implode</span><span class="keyword">(</span><span class="string">' ,'</span><span class="keyword">, </span><span class="default">$test1</span><span class="keyword">));<br />
echo </span><span class="default">sprintf</span><span class="keyword">(</span><span class="string">'current - value = %s&lt;br/&gt;'</span><span class="keyword">, </span><span class="default">implode</span><span class="keyword">(</span><span class="string">' ,'</span><span class="keyword">, </span><span class="default">$test2</span><span class="keyword">));<br />
<br />
</span><span class="default">$aPCUIterator </span><span class="keyword">= new </span><span class="default">APCUIterator</span><span class="keyword">();<br />
<br />
echo </span><span class="default">sprintf</span><span class="keyword">(</span><span class="string">'totalCount = %s&lt;br/&gt;'</span><span class="keyword">, </span><span class="default">$aPCUIterator</span><span class="keyword">-&gt;</span><span class="default">getTotalCount</span><span class="keyword">());<br />
</span><span class="comment">//echo sprintf('totalHits = %s&lt;br/&gt;', $aPCUIterator-&gt;getTotalHits()); // Not implemneted/available?<br />
</span><span class="keyword">echo </span><span class="default">sprintf</span><span class="keyword">(</span><span class="string">'totalSize = %s&lt;br/&gt;'</span><span class="keyword">, </span><span class="default">$aPCUIterator</span><span class="keyword">-&gt;</span><span class="default">getTotalSize</span><span class="keyword">());<br />
<br />
echo </span><span class="string">'----------------------------------&lt;br/&gt;'</span><span class="keyword">;<br />
<br />
</span><span class="default">$aPCUIterator</span><span class="keyword">-&gt;</span><span class="default">rewind</span><span class="keyword">();<br />
echo </span><span class="default">sprintf</span><span class="keyword">(</span><span class="string">'key = %s&lt;br/&gt;'</span><span class="keyword">, </span><span class="default">$aPCUIterator</span><span class="keyword">-&gt;</span><span class="default">key</span><span class="keyword">());<br />
</span><span class="default">echoCurrent</span><span class="keyword">(</span><span class="default">$aPCUIterator</span><span class="keyword">-&gt;</span><span class="default">current</span><span class="keyword">());<br />
</span><span class="default">$aPCUIterator</span><span class="keyword">-&gt;</span><span class="default">next</span><span class="keyword">();<br />
<br />
echo </span><span class="string">'----------------------------------&lt;br/&gt;'</span><span class="keyword">;<br />
<br />
echo </span><span class="default">sprintf</span><span class="keyword">(</span><span class="string">'key = %s&lt;br/&gt;'</span><span class="keyword">, </span><span class="default">$aPCUIterator</span><span class="keyword">-&gt;</span><span class="default">key</span><span class="keyword">());<br />
</span><span class="default">echoCurrent</span><span class="keyword">(</span><span class="default">$aPCUIterator</span><span class="keyword">-&gt;</span><span class="default">current</span><span class="keyword">());<br />
echo </span><span class="default">sprintf</span><span class="keyword">(</span><span class="string">'valid = %s&lt;br/&gt;'</span><span class="keyword">, </span><span class="default">$aPCUIterator</span><span class="keyword">-&gt;</span><span class="default">valid</span><span class="keyword">() ? </span><span class="string">'true' </span><span class="keyword">: </span><span class="string">'false'</span><span class="keyword">);<br />
<br />
function </span><span class="default">echoCurrent</span><span class="keyword">(</span><span class="default">$current</span><span class="keyword">)<br />
{<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; echo </span><span class="default">sprintf</span><span class="keyword">(</span><span class="string">'current - type = %s&lt;br/&gt;'</span><span class="keyword">, </span><span class="default">$current</span><span class="keyword">[</span><span class="string">'type'</span><span class="keyword">]);<br />
&nbsp;&nbsp;&nbsp; echo </span><span class="default">sprintf</span><span class="keyword">(</span><span class="string">'current - key = %s&lt;br/&gt;'</span><span class="keyword">, </span><span class="default">$current</span><span class="keyword">[</span><span class="string">'key'</span><span class="keyword">]);<br />
&nbsp;&nbsp;&nbsp; echo </span><span class="default">sprintf</span><span class="keyword">(</span><span class="string">'current - value = %s&lt;br/&gt;'</span><span class="keyword">, </span><span class="default">implode</span><span class="keyword">(</span><span class="string">' ,'</span><span class="keyword">, </span><span class="default">$current</span><span class="keyword">[</span><span class="string">'value'</span><span class="keyword">]));<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">//echo sprintf('current - num_hits = %s&lt;br/&gt;', $current['num_hits']); // Not implemneted/available?<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">echo </span><span class="default">sprintf</span><span class="keyword">(</span><span class="string">'current - mtime = %s&lt;br/&gt;'</span><span class="keyword">, </span><span class="default">date</span><span class="keyword">(</span><span class="string">"d-m-Y H:i:s"</span><span class="keyword">, </span><span class="default">$current</span><span class="keyword">[</span><span class="string">'mtime'</span><span class="keyword">]));<br />
&nbsp;&nbsp;&nbsp; echo </span><span class="default">sprintf</span><span class="keyword">(</span><span class="string">'current - creation_time = %s&lt;br/&gt;'</span><span class="keyword">, </span><span class="default">date</span><span class="keyword">(</span><span class="string">"d-m-Y H:i:s"</span><span class="keyword">, </span><span class="default">$current</span><span class="keyword">[</span><span class="string">'creation_time'</span><span class="keyword">]));<br />
&nbsp;&nbsp;&nbsp; echo </span><span class="default">sprintf</span><span class="keyword">(</span><span class="string">'current - deletion_time = %s&lt;br/&gt;'</span><span class="keyword">, </span><span class="default">date</span><span class="keyword">(</span><span class="string">"d-m-Y H:i:s"</span><span class="keyword">, </span><span class="default">$current</span><span class="keyword">[</span><span class="string">'deletion_time'</span><span class="keyword">]));<br />
&nbsp;&nbsp;&nbsp; echo </span><span class="default">sprintf</span><span class="keyword">(</span><span class="string">'current - access_time = %s&lt;br/&gt;'</span><span class="keyword">, </span><span class="default">date</span><span class="keyword">(</span><span class="string">"d-m-Y H:i:s"</span><span class="keyword">, </span><span class="default">$current</span><span class="keyword">[</span><span class="string">'access_time'</span><span class="keyword">]));<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">//echo sprintf('current - ref_count = %s&lt;br/&gt;', $current['ref_count']); // Not implemneted/available?<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">echo </span><span class="default">sprintf</span><span class="keyword">(</span><span class="string">'current - mem_size = %s&lt;br/&gt;'</span><span class="keyword">, </span><span class="default">$current</span><span class="keyword">[</span><span class="string">'mem_size'</span><span class="keyword">]);<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">//echo sprintf('current - ttl = %s&lt;br/&gt;', $current['ttl']); // Not implemneted/available?<br />
</span><span class="keyword">}<br />
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
</div>
</div>
</div></div></body></html>
