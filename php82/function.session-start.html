<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
 <head>
  <meta http-equiv="content-type" content="text/html; CHARSET=UTF-8">
  <title>启动新会话或者重用现有会话</title>
<link media="all" rel="stylesheet" type="text/css" href="styles/03e73060321a0a848018724a6c83de7f-theme-base.css" />
<link media="all" rel="stylesheet" type="text/css" href="styles/03e73060321a0a848018724a6c83de7f-theme-medium.css" />

  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <link media="all" rel="stylesheet" type="text/css" href="style.css"/>
 </head>
 <body class="docs" class="docs"><div class="navbar navbar-fixed-top">
  <div class="navbar-inner clearfix">
    <ul class="nav" style="width: 100%">
      <li style="float: left;"><a href="function.session-set-save-handler.html">? session_set_save_handler</a></li>
      <li style="float: right;"><a href="function.session-status.html">session_status ?</a></li>
    </ul>
  </div>
</div>
<div id="breadcrumbs" class="clearfix">
  <ul class="breadcrumbs-container">
    <li><a href="index.html">PHP Manual</a></li>
    <li><a href="ref.session.html">Session 函数</a></li>
    <li>启动新会话或者重用现有会话</li>
  </ul>
</div>
<div id="layout">
  <div id="layout-content"><div id="function.session-start" class="refentry">
 <div class="refnamediv">
  <h1 class="refname">session_start</h1>
  <p class="verinfo">(PHP 4, PHP 5, PHP 7, PHP 8)</p><p class="refpurpose"><span class="refname">session_start</span> &mdash; <span class="dc-title">启动新会话或者重用现有会话</span></p>

 </div>

 <div class="refsect1 description" id="refsect1-function.session-start-description">
  <h3 class="title">说明</h3>
  <div class="methodsynopsis dc-description">
   <span class="methodname"><strong>session_start</strong></span>(<span class="methodparam"><span class="type">array</span> <code class="parameter">$options</code><span class="initializer"> = []</span></span>): <span class="type">bool</span></div>

  <p class="para rdfs-comment">
   <span class="function"><strong>session_start()</strong></span> 会创建新会话或者重用现有会话。
   如果通过 GET 或者 POST 方式，或者使用 cookie 提交了会话 ID，
   则会重用现有会话。
  </p>
  <p class="para">
   当会话自动开始或者通过 <span class="function"><strong>session_start()</strong></span> 手动开始的时候，
   PHP 内部会调用会话处理程序的 open 和 read 回调函数。
   会话处理程序可能是 PHP 默认的，
   也可能是扩展提供的（SQLite 或者 Memcached 扩展），
   也可能是通过 <span class="function"><a href="function.session-set-save-handler.html" class="function">session_set_save_handler()</a></span> 设定的用户自定义会话处理程序。
   通过 read 回调函数返回的现有会话数据（使用特殊的序列化格式存储），
   PHP 会自动反序列化数据并且填充 $_SESSION 超级全局变量。
  </p>
  <p class="para">
   要想使用命名会话，请在调用 <span class="function"><strong>session_start()</strong></span> 函数
   之前调用 <span class="function"><a href="function.session-name.html" class="function">session_name()</a></span> 函数。
  </p>
  <p class="para">
   如果启用了 <a href="session.configuration.html#ini.session.use-trans-sid" class="link">session.use_trans_sid</a> 选项，
   <span class="function"><strong>session_start()</strong></span> 函数会注册一个内部输出处理程序，
   该输出处理程序完成 URL 重写的工作。
  </p>
  <p class="para">
   如果用户联合使用 <span class="function"><a href="function.ob-start.html" class="function">ob_start()</a></span> 
   和 <code class="literal">ob_gzhandler</code> 函数，
   那么函数的调用顺序会影响输出结果。
   例如，必须在开始会话之前调用 <code class="literal">ob_gzhandler</code> 函数完成注册。
  </p>
 </div>

 
 <div class="refsect1 parameters" id="refsect1-function.session-start-parameters">
  <h3 class="title">参数</h3>
  <dl>
   
    <dt>
<code class="parameter">options</code></dt>

    <dd>

     <p class="para">
      此参数是一个关联数组，如果提供，那么会用其中的项目覆盖 <a href="session.configuration.html" class="link">会话配置指示</a> 中的配置项。此数组中的键无需包含 <code class="literal">session.</code> 前缀。
     </p>
     <p class="para">
      除了常规的会话配置指示项，
      还可以在此数组中包含 <code class="literal">read_and_close</code>
      选项。如果将此选项的值设置为 <strong><code>true</code></strong>，
      那么会话文件会在读取完毕之后马上关闭，
      因此，可以在会话数据没有变动的时候，避免不必要的文件锁。
     </p>
    </dd>

   
  </dl>

 </div>

 
 <div class="refsect1 returnvalues" id="refsect1-function.session-start-returnvalues">
  <h3 class="title">返回值</h3>
  <p class="para">
   成功开始会话返回 <strong><code>true</code></strong> ，反之返回 <strong><code>false</code></strong>
  </p>
 </div>


 <div class="refsect1 changelog" id="refsect1-function.session-start-changelog">
  <h3 class="title">更新日志</h3>
  <p class="para">
   <table class="doctable informaltable">
    
     <thead>
      <tr>
       <th>版本</th>
       <th>说明</th>
      </tr>

     </thead>

     <tbody class="tbody">
      <tr>
       <td>7.1.0</td>
       <td>
        当 <span class="function"><strong>session_start()</strong></span> 执行失败，
        无法开始一个会话的时候，会返回 <strong><code>false</code></strong>，
        并且不会初始化超级变量 <var class="varname"><a href="reserved.variables.session.html" class="classname">$_SESSION</a></var>。
       </td>
      </tr>

     </tbody>
    
   </table>

  </p>
 </div>


 <div class="refsect1 examples" id="refsect1-function.session-start-examples">
  <h3 class="title">示例</h3>
  <div class="refsect2 unknown-unknown-exampleu" id="refsect2-function.session-start-unknown-unknown-exampleu">
  <h4 class="title">基本的会话示例</h4>
  <p class="para">
   <div class="example" id="">
    <p><strong>Example #1 <var class="filename">page1.php</var></strong></p>
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br /></span><span style="color: #FF8000">// page1.php<br /><br /></span><span style="color: #0000BB">session_start</span><span style="color: #007700">();<br /><br />echo </span><span style="color: #DD0000">'Welcome to page #1'</span><span style="color: #007700">;<br /><br /></span><span style="color: #0000BB">$_SESSION</span><span style="color: #007700">[</span><span style="color: #DD0000">'favcolor'</span><span style="color: #007700">] = </span><span style="color: #DD0000">'green'</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">$_SESSION</span><span style="color: #007700">[</span><span style="color: #DD0000">'animal'</span><span style="color: #007700">]   = </span><span style="color: #DD0000">'cat'</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">$_SESSION</span><span style="color: #007700">[</span><span style="color: #DD0000">'time'</span><span style="color: #007700">]     = </span><span style="color: #0000BB">time</span><span style="color: #007700">();<br /><br /></span><span style="color: #FF8000">// 如果使用 cookie 方式传送会话 ID<br /></span><span style="color: #007700">echo </span><span style="color: #DD0000">'&lt;br /&gt;&lt;a href="page2.php"&gt;page 2&lt;/a&gt;'</span><span style="color: #007700">;<br /><br /></span><span style="color: #FF8000">// 如果不是使用 cookie 方式传送会话 ID，则使用 URL 改写的方式传送会话 ID<br /></span><span style="color: #007700">echo </span><span style="color: #DD0000">'&lt;br /&gt;&lt;a href="page2.php?' </span><span style="color: #007700">. </span><span style="color: #0000BB">SID </span><span style="color: #007700">. </span><span style="color: #DD0000">'"&gt;page 2&lt;/a&gt;'</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
    </div>

   </div>
  </p>
  <p class="para">
   请求 <var class="filename">page1.php</var> 页面之后，
   第二个页面 <var class="filename">page2.php</var> 
   会包含会话数据。
   请查阅 <a href="ref.session.html" class="link">会话参考</a>
   获取更多关于 <a href="session.idpassing.html" class="link">会话 ID 传送</a>的信息，
   在该参考页面中有关于常量 <strong><code>SID</code></strong> 的详细说明。
  </p>
  <p class="para">
   <div class="example" id="">
    <p><strong>Example #2 <var class="filename">page2.php</var></strong></p>
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br /></span><span style="color: #FF8000">// page2.php<br /><br /></span><span style="color: #0000BB">session_start</span><span style="color: #007700">();<br /><br />echo </span><span style="color: #DD0000">'Welcome to page #2&lt;br /&gt;'</span><span style="color: #007700">;<br /><br />echo </span><span style="color: #0000BB">$_SESSION</span><span style="color: #007700">[</span><span style="color: #DD0000">'favcolor'</span><span style="color: #007700">]; </span><span style="color: #FF8000">// green<br /></span><span style="color: #007700">echo </span><span style="color: #0000BB">$_SESSION</span><span style="color: #007700">[</span><span style="color: #DD0000">'animal'</span><span style="color: #007700">];   </span><span style="color: #FF8000">// cat<br /></span><span style="color: #007700">echo </span><span style="color: #0000BB">date</span><span style="color: #007700">(</span><span style="color: #DD0000">'Y m d H:i:s'</span><span style="color: #007700">, </span><span style="color: #0000BB">$_SESSION</span><span style="color: #007700">[</span><span style="color: #DD0000">'time'</span><span style="color: #007700">]);<br /><br /></span><span style="color: #FF8000">// 类似 page1.php 中的代码，你可能需要在这里处理使用 SID 的场景<br /></span><span style="color: #007700">echo </span><span style="color: #DD0000">'&lt;br /&gt;&lt;a href="page1.php"&gt;page 1&lt;/a&gt;'</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
    </div>

   </div>
  </p>
 </div>

 <div class="refsect2 unknown-unknown-unknown-unknown-examplew" id="refsect2-function.session-start-unknown-unknown-unknown-unknown-examplew">
   <h4 class="title">调用 <span class="function"><strong>session_start()</strong></span> 的时候指定选项</h4>

   <div class="example" id="">
    <p><strong>Example #3 覆盖 Cookie 超时时间设定</strong></p>
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br /></span><span style="color: #FF8000">// 设置 cookie 的有效时间为 1 天<br /></span><span style="color: #0000BB">session_start</span><span style="color: #007700">([<br />    </span><span style="color: #DD0000">'cookie_lifetime' </span><span style="color: #007700">=&gt; </span><span style="color: #0000BB">86400</span><span style="color: #007700">,<br />]);<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
    </div>

   </div>

   <div class="example" id="">
    <p><strong>Example #4 读取会话之后立即关闭会话存储文件</strong></p>
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br /></span><span style="color: #FF8000">// 如果确定不修改会话中的数据，<br />// 我们可以在会话文件读取完毕之后立即关闭它<br />// 来避免由于给会话文件加锁导致其他页面阻塞<br /></span><span style="color: #0000BB">session_start</span><span style="color: #007700">([<br />    </span><span style="color: #DD0000">'cookie_lifetime' </span><span style="color: #007700">=&gt; </span><span style="color: #0000BB">86400</span><span style="color: #007700">,<br />    </span><span style="color: #DD0000">'read_and_close'  </span><span style="color: #007700">=&gt; </span><span style="color: #0000BB">true</span><span style="color: #007700">,<br />]);</span>
</span>
</code></div>
    </div>

   </div>
  </div>

  
 </div>


 <div class="refsect1 notes" id="refsect1-function.session-start-notes">
  <h3 class="title">注释</h3>
  <blockquote class="note"><p><strong class="note">Note</strong>: 
   <p class="para">
    要使用基于 cookie 的会话，
    必须在输出开始之前调用 <span class="function"><strong>session_start()</strong></span> 函数。
   </p>
  </p></blockquote>
  <blockquote class="note"><p><strong class="note">Note</strong>: 
   <p class="para">
    建议使用 <a href="zlib.configuration.html#ini.zlib.output-compression" class="link">zlib.output_compression</a>
    来替代 <span class="function"><a href="function.ob-gzhandler.html" class="function">ob_gzhandler()</a></span>。
   </p>
  </p></blockquote>
  <blockquote class="note"><p><strong class="note">Note</strong>: 
   <p class="para">
    根据配置不同，本函数会发送几个 HTTP 响应头。
    参考 <span class="function"><a href="function.session-cache-limiter.html" class="function">session_cache_limiter()</a></span>
    来自定义 HTTP 响应头。
   </p>
  </p></blockquote>
 </div>


 <div class="refsect1 seealso" id="refsect1-function.session-start-seealso">
  <h3 class="title">参见</h3>
  <p class="para">
   <ul class="simplelist">
    <li class="member"><var class="varname"><a href="reserved.variables.session.html" class="classname">$_SESSION</a></var></li>
    <li class="member">
     <a href="session.configuration.html#ini.session.auto-start" class="link">session.auto_start</a>
     配置指示
    </li>
    <li class="member"><span class="function"><a href="function.session-id.html" class="function" rel="rdfs-seeAlso">session_id()</a> - 获取/设置当前会话 ID</span></li>
   </ul>
  </p>
 </div>


</div><div id="usernotes">
 <div class="head">
  <h3 class="title">User Contributed Notes</h3>
 </div>
<div id="allnotes">  <a name="128197""></a>
  <div class="note">
   <strong class="user">bwz</strong>
   <a href="#128197" class="date">08-Feb-2023 02:19</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Be warned of another issue with blocking sessions: if you want to call an external program (or use an external service) that needs to access your website using the same session.<br />
<br />
For example I am printing a page as a PDF. I can just save the web page as a HTML file. But the images in the HTML are also private and require the current user session to be seen.<br />
<br />
What will happen is that this program might hang indefinitely (or timeout) as session_start waits for the parent PHP process to release the lock. And session_start doesn't obey max_execution_time (as documented in this bug: https://bugs.php.net/bug.php?id=72345 ), so this will effectively kill the server after a few requests, as each one will be hanging forever<br />
<br />
It's the same if you use an external HTTP service:<br />
<br />
<span class="default">&lt;?php<br />
$pdf </span><span class="keyword">= </span><span class="default">file_get_contents</span><span class="keyword">(</span><span class="string">'<a href="http://pdf.website.tld/?url=http://website.tld/print.php" rel="nofollow" target="_blank">http://pdf.website.tld/?url=http://website.tld/print.php</a>'</span><span class="keyword">);<br />
</span><span class="default">?&gt;<br />
</span><br />
The service will wait for the website host to release the lock, but it can't as it is waiting for the PDF service to finish...<br />
<br />
The nice solution is to release the lock immediately by calling session_write_close after session_start, and when you need to write to the session you do the same again, but as noted it has its own issues. Using a custom session handler is probably the best solution.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="126566""></a>
  <div class="note">
   <strong class="user">polygon dot co dot in at gmail dot com</strong>
   <a href="#126566" class="date">07-Nov-2021 10:01</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Websites are prone to Session Attack where its proper usage is not done.<br />
<br />
There are tools like "Apache Benchmark" (ab) and many others which can hit the website with load for load / performance testing.<br />
<br />
Code below starts the session for every request.<br />
<br />
<span class="default">&lt;?php<br />
session_start</span><span class="keyword">();<br />
<br />
</span><span class="default">$username </span><span class="keyword">= </span><span class="default">$_POST</span><span class="keyword">[</span><span class="string">'username'</span><span class="keyword">];<br />
</span><span class="default">$password </span><span class="keyword">= </span><span class="default">$_POST</span><span class="keyword">[</span><span class="string">'password'</span><span class="keyword">];<br />
<br />
if(</span><span class="default">isValidUser</span><span class="keyword">(</span><span class="default">$username</span><span class="keyword">, </span><span class="default">$password</span><span class="keyword">)) {<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">Suserdetails </span><span class="keyword">= </span><span class="default">getUserDetails</span><span class="keyword">(</span><span class="default">$username</span><span class="keyword">);<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$_SESSION</span><span class="keyword">[</span><span class="string">'user_id'</span><span class="keyword">]&nbsp; &nbsp; = </span><span class="default">Suserdetails</span><span class="keyword">[</span><span class="string">'user_id'</span><span class="keyword">];<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$_SESSION</span><span class="keyword">[</span><span class="string">'username'</span><span class="keyword">]&nbsp; &nbsp; = </span><span class="default">Suserdetails</span><span class="keyword">[</span><span class="string">'username'</span><span class="keyword">];<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$_SESSION</span><span class="keyword">[</span><span class="string">'firstname'</span><span class="keyword">]&nbsp; &nbsp; = </span><span class="default">Suserdetails</span><span class="keyword">[</span><span class="string">'firstname'</span><span class="keyword">];<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">header</span><span class="keyword">(</span><span class="string">'Location: dashboard.php'</span><span class="keyword">);<br />
}<br />
</span><span class="default">?&gt;<br />
</span><br />
This generates session file for every request irrespective of PHPSESSID cookie value when I use tools like ab, there by creating inode issue.<br />
<br />
One should start the session after properly authenticating.<br />
<br />
<span class="default">&lt;?php<br />
<br />
$username </span><span class="keyword">= </span><span class="default">$_POST</span><span class="keyword">[</span><span class="string">'username'</span><span class="keyword">];<br />
</span><span class="default">$password </span><span class="keyword">= </span><span class="default">$_POST</span><span class="keyword">[</span><span class="string">'password'</span><span class="keyword">];<br />
<br />
if(</span><span class="default">isValidUser</span><span class="keyword">(</span><span class="default">$username</span><span class="keyword">, </span><span class="default">$password</span><span class="keyword">)) {<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">Suserdetails </span><span class="keyword">= </span><span class="default">getUserDetails</span><span class="keyword">(</span><span class="default">$username</span><span class="keyword">);<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">session_start</span><span class="keyword">();<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$_SESSION</span><span class="keyword">[</span><span class="string">'user_id'</span><span class="keyword">]&nbsp; &nbsp; = </span><span class="default">Suserdetails</span><span class="keyword">[</span><span class="string">'user_id'</span><span class="keyword">];<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$_SESSION</span><span class="keyword">[</span><span class="string">'username'</span><span class="keyword">]&nbsp; &nbsp; = </span><span class="default">Suserdetails</span><span class="keyword">[</span><span class="string">'username'</span><span class="keyword">];<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$_SESSION</span><span class="keyword">[</span><span class="string">'firstname'</span><span class="keyword">]&nbsp; &nbsp; = </span><span class="default">Suserdetails</span><span class="keyword">[</span><span class="string">'firstname'</span><span class="keyword">];<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">header</span><span class="keyword">(</span><span class="string">'Location: dashboard.php'</span><span class="keyword">);<br />
}<br />
</span><span class="default">?&gt;<br />
</span><br />
Scripts other then login first validates session which requires session.<br />
<br />
<span class="default">&lt;?php<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">if(</span><span class="default">session_status</span><span class="keyword">()!=</span><span class="default">PHP_SESSION_NONE</span><span class="keyword">)&nbsp; </span><span class="default">header</span><span class="keyword">(</span><span class="string">'Location: login.php'</span><span class="keyword">);<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">session_start</span><span class="keyword">();<br />
<br />
&nbsp;&nbsp;&nbsp; if(!isset(</span><span class="default">$_SESSION</span><span class="keyword">[</span><span class="string">'user_id'</span><span class="keyword">])) </span><span class="default">header</span><span class="keyword">(</span><span class="string">'Location: login.php'</span><span class="keyword">);<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">code logic below</span><span class="keyword">....<br />
}<br />
</span><span class="default">?&gt;<br />
</span><br />
This example is for file based session.<br />
For other modes of session check function session_set_save_handler.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="125487""></a>
  <div class="note">
   <strong class="user">Anonymous</strong>
   <a href="#125487" class="date">04-Nov-2020 02:44</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Be careful with the 'read_and_close' option. It doesn't update the session file's last modification time unlike the default PHP behaviour when you don't close the session (or when you use session_write_close explicitly).<br />
Old session files (for me, older than 24 minutes) will be occasionally cleared by the garbage collector (for me every 09 and 39 minute of every hour).<br />
So a session can disappear even if the page regularly sends requests to the server that only reads and closes the session.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="123917""></a>
  <div class="note">
   <strong class="user">hu60 dot cn at gmail dot com</strong>
   <a href="#123917" class="date">09-Jun-2019 12:43</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
The following code shows how the PHP session works. The function my_session_start() does almost the same thing as session_start().<br />
<br />
<span class="default">&lt;?php<br />
error_reporting</span><span class="keyword">(</span><span class="default">E_ALL</span><span class="keyword">);<br />
</span><span class="default">ini_set</span><span class="keyword">(</span><span class="string">'display_errors'</span><span class="keyword">, </span><span class="default">true</span><span class="keyword">);<br />
</span><span class="default">ini_set</span><span class="keyword">(</span><span class="string">'session.save_path'</span><span class="keyword">, </span><span class="default">__DIR__</span><span class="keyword">);<br />
<br />
</span><span class="default">my_session_start</span><span class="keyword">();<br />
<br />
echo </span><span class="string">'&lt;p&gt;session id: '</span><span class="keyword">.</span><span class="default">my_session_id</span><span class="keyword">().</span><span class="string">'&lt;/p&gt;'</span><span class="keyword">;<br />
<br />
echo </span><span class="string">'&lt;code&gt;&lt;pre&gt;'</span><span class="keyword">;<br />
</span><span class="default">var_dump</span><span class="keyword">(</span><span class="default">$_SESSION</span><span class="keyword">);<br />
echo </span><span class="string">'&lt;/pre&gt;&lt;/code&gt;'</span><span class="keyword">;<br />
<br />
</span><span class="default">$now </span><span class="keyword">= </span><span class="default">date</span><span class="keyword">(</span><span class="string">'H:i:s'</span><span class="keyword">);<br />
if (isset(</span><span class="default">$_SESSION</span><span class="keyword">[</span><span class="string">'last_visit_time'</span><span class="keyword">])) {<br />
&nbsp; echo </span><span class="string">'&lt;p&gt;Last Visit Time: '</span><span class="keyword">.</span><span class="default">$_SESSION</span><span class="keyword">[</span><span class="string">'last_visit_time'</span><span class="keyword">].</span><span class="string">'&lt;/p&gt;'</span><span class="keyword">;<br />
}<br />
echo </span><span class="string">'&lt;p&gt;Current Time: '</span><span class="keyword">.</span><span class="default">$now</span><span class="keyword">.</span><span class="string">'&lt;/p&gt;'</span><span class="keyword">;<br />
<br />
</span><span class="default">$_SESSION</span><span class="keyword">[</span><span class="string">'last_visit_time'</span><span class="keyword">] = </span><span class="default">$now</span><span class="keyword">;<br />
<br />
function </span><span class="default">my_session_start</span><span class="keyword">() {<br />
&nbsp; global </span><span class="default">$phpsessid</span><span class="keyword">, </span><span class="default">$sessfile</span><span class="keyword">;<br />
&nbsp;<br />
&nbsp; if (!isset(</span><span class="default">$_COOKIE</span><span class="keyword">[</span><span class="string">'PHPSESSID'</span><span class="keyword">]) || empty(</span><span class="default">$_COOKIE</span><span class="keyword">[</span><span class="string">'PHPSESSID'</span><span class="keyword">])) {<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$phpsessid </span><span class="keyword">= </span><span class="default">my_base32_encode</span><span class="keyword">(</span><span class="default">my_random_bytes</span><span class="keyword">(</span><span class="default">16</span><span class="keyword">));<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">setcookie</span><span class="keyword">(</span><span class="string">'PHPSESSID'</span><span class="keyword">, </span><span class="default">$phpsessid</span><span class="keyword">, </span><span class="default">ini_get</span><span class="keyword">(</span><span class="string">'session.cookie_lifetime'</span><span class="keyword">), </span><span class="default">ini_get</span><span class="keyword">(</span><span class="string">'session.cookie_path'</span><span class="keyword">), </span><span class="default">ini_get</span><span class="keyword">(</span><span class="string">'session.cookie_domain'</span><span class="keyword">), </span><span class="default">ini_get</span><span class="keyword">(</span><span class="string">'session.cookie_secure'</span><span class="keyword">), </span><span class="default">ini_get</span><span class="keyword">(</span><span class="string">'session.cookie_httponly'</span><span class="keyword">));<br />
&nbsp; } else {<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$phpsessid </span><span class="keyword">= </span><span class="default">substr</span><span class="keyword">(</span><span class="default">preg_replace</span><span class="keyword">(</span><span class="string">'/[^a-z0-9]/'</span><span class="keyword">, </span><span class="string">''</span><span class="keyword">, </span><span class="default">$_COOKIE</span><span class="keyword">[</span><span class="string">'PHPSESSID'</span><span class="keyword">]), </span><span class="default">0</span><span class="keyword">, </span><span class="default">26</span><span class="keyword">);<br />
&nbsp; }<br />
&nbsp;<br />
&nbsp; </span><span class="default">$sessfile </span><span class="keyword">= </span><span class="default">ini_get</span><span class="keyword">(</span><span class="string">'session.save_path'</span><span class="keyword">).</span><span class="string">'/sess_'</span><span class="keyword">.</span><span class="default">$phpsessid</span><span class="keyword">;<br />
&nbsp; if (</span><span class="default">is_file</span><span class="keyword">(</span><span class="default">$sessfile</span><span class="keyword">)) {<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$_SESSION </span><span class="keyword">= </span><span class="default">unserialize</span><span class="keyword">(</span><span class="default">file_get_contents</span><span class="keyword">(</span><span class="default">$sessfile</span><span class="keyword">));<br />
&nbsp; } else {<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$_SESSION </span><span class="keyword">= array();<br />
&nbsp; }<br />
&nbsp; </span><span class="default">register_shutdown_function</span><span class="keyword">(</span><span class="string">'my_session_save'</span><span class="keyword">);<br />
}<br />
<br />
function </span><span class="default">my_session_save</span><span class="keyword">() {<br />
&nbsp; global </span><span class="default">$sessfile</span><span class="keyword">;<br />
&nbsp;<br />
&nbsp; </span><span class="default">file_put_contents</span><span class="keyword">(</span><span class="default">$sessfile</span><span class="keyword">, </span><span class="default">serialize</span><span class="keyword">(</span><span class="default">$_SESSION</span><span class="keyword">));<br />
}<br />
<br />
function </span><span class="default">my_session_id</span><span class="keyword">() {<br />
&nbsp; global </span><span class="default">$phpsessid</span><span class="keyword">;<br />
&nbsp; return </span><span class="default">$phpsessid</span><span class="keyword">;<br />
}<br />
<br />
function </span><span class="default">my_random_bytes</span><span class="keyword">(</span><span class="default">$length</span><span class="keyword">) {<br />
&nbsp; if (</span><span class="default">function_exists</span><span class="keyword">(</span><span class="string">'random_bytes'</span><span class="keyword">)) {<br />
&nbsp;&nbsp; &nbsp;&nbsp; return </span><span class="default">random_bytes</span><span class="keyword">(</span><span class="default">$length</span><span class="keyword">);<br />
&nbsp; }<br />
&nbsp; </span><span class="default">$randomString </span><span class="keyword">= </span><span class="string">''</span><span class="keyword">;<br />
&nbsp; for (</span><span class="default">$i </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">; </span><span class="default">$i </span><span class="keyword">&lt; </span><span class="default">$length</span><span class="keyword">; </span><span class="default">$i</span><span class="keyword">++) { <br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">$randomString </span><span class="keyword">.= </span><span class="default">chr</span><span class="keyword">(</span><span class="default">rand</span><span class="keyword">(</span><span class="default">0</span><span class="keyword">, </span><span class="default">255</span><span class="keyword">));<br />
&nbsp; } <br />
&nbsp; return </span><span class="default">$randomString</span><span class="keyword">;<br />
}<br />
<br />
function </span><span class="default">my_base32_encode</span><span class="keyword">(</span><span class="default">$input</span><span class="keyword">) {<br />
&nbsp; </span><span class="default">$BASE32_ALPHABET </span><span class="keyword">= </span><span class="string">'abcdefghijklmnopqrstuvwxyz234567'</span><span class="keyword">;<br />
&nbsp; </span><span class="default">$output </span><span class="keyword">= </span><span class="string">''</span><span class="keyword">;<br />
&nbsp; </span><span class="default">$v </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;<br />
&nbsp; </span><span class="default">$vbits </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;<br />
&nbsp; for (</span><span class="default">$i </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">, </span><span class="default">$j </span><span class="keyword">= </span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$input</span><span class="keyword">); </span><span class="default">$i </span><span class="keyword">&lt; </span><span class="default">$j</span><span class="keyword">; </span><span class="default">$i</span><span class="keyword">++) {<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$v </span><span class="keyword">&lt;&lt;= </span><span class="default">8</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$v </span><span class="keyword">+= </span><span class="default">ord</span><span class="keyword">(</span><span class="default">$input</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">]);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$vbits </span><span class="keyword">+= </span><span class="default">8</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; while (</span><span class="default">$vbits </span><span class="keyword">&gt;= </span><span class="default">5</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">$vbits </span><span class="keyword">-= </span><span class="default">5</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">$output </span><span class="keyword">.= </span><span class="default">$BASE32_ALPHABET</span><span class="keyword">[</span><span class="default">$v </span><span class="keyword">&gt;&gt; </span><span class="default">$vbits</span><span class="keyword">];<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">$v </span><span class="keyword">&amp;= ((</span><span class="default">1 </span><span class="keyword">&lt;&lt; </span><span class="default">$vbits</span><span class="keyword">) - </span><span class="default">1</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp; }<br />
&nbsp; if (</span><span class="default">$vbits </span><span class="keyword">&gt; </span><span class="default">0</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$v </span><span class="keyword">&lt;&lt;= (</span><span class="default">5 </span><span class="keyword">- </span><span class="default">$vbits</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$output </span><span class="keyword">.= </span><span class="default">$BASE32_ALPHABET</span><span class="keyword">[</span><span class="default">$v</span><span class="keyword">];<br />
&nbsp; }<br />
&nbsp; return </span><span class="default">$output</span><span class="keyword">;<br />
}</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="123632""></a>
  <div class="note">
   <strong class="user">Nathan</strong>
   <a href="#123632" class="date">21-Feb-2019 03:30</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Btw you can use:<br />
<br />
if (!isset($_SESSION)) {<br />
// We love every user<br />
session_start();<br />
// Then refresh for changes to take affect<br />
header("location: ../../");<br />
} elseif ($_SESSION["user] == "123ABC - abcmouse.com") {<br />
/* We don't like this user, so let's kick them out of<br />
&nbsp;the session */<br />
session_destroy();<br />
// Then refresh for changes to take affect<br />
header("location: ../../");<br />
}</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="121507""></a>
  <div class="note">
   <strong class="user">marco dot agnoli at me dot com</strong>
   <a href="#121507" class="date">10-Aug-2017 07:50</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I recently made an interesting observation:<br />
<br />
It seems that `session_start()` can return `true` even if the session was not properly created. In my case, the disk storage was full and so the session data could not be written to disk. I had some logic that resulted in an infinite loop when the session was not written to disk.<br />
<br />
To check if the session really was saved to disk I used:<br />
<br />
```<br />
<span class="default">&lt;?php<br />
<br />
</span><span class="keyword">function </span><span class="default">safe_session_start</span><span class="keyword">() {<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment"># Attempt to start a session<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">if (!@</span><span class="default">\session_start</span><span class="keyword">()) return </span><span class="default">false</span><span class="keyword">;<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">#<br />
&nbsp;&nbsp;&nbsp; # Check if we need to perform<br />
&nbsp;&nbsp;&nbsp; # the write test.<br />
&nbsp;&nbsp;&nbsp; #<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">if (!isset(</span><span class="default">$_SESSION</span><span class="keyword">[</span><span class="string">'__validated'</span><span class="keyword">])) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$_SESSION</span><span class="keyword">[</span><span class="string">'__validated'</span><span class="keyword">] = </span><span class="default">1</span><span class="keyword">;<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment"># Attempt to write session to disk<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">@</span><span class="default">\session_write_close</span><span class="keyword">();<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment"># Unset the variable from memory.<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; # This step may be unnecessary<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">unset(</span><span class="default">$_SESSION</span><span class="keyword">[</span><span class="string">'__validated'</span><span class="keyword">]);<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment"># Re-start session<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">@</span><span class="default">\session_start</span><span class="keyword">();<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment"># Check if variable value is retained<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">if (!isset(</span><span class="default">$_SESSION</span><span class="keyword">[</span><span class="string">'__validated'</span><span class="keyword">])) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment"># Session was not written to disk<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">return </span><span class="default">false</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">true</span><span class="keyword">;<br />
}<br />
<br />
if (!</span><span class="default">safe_session_start</span><span class="keyword">()) {<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment"># Sessions are probably not written to disk...<br />
&nbsp;&nbsp;&nbsp; # Handle error accordingly.<br />
</span><span class="keyword">}<br />
<br />
</span><span class="default">?&gt;<br />
</span>```<br />
<br />
Took me quite a while to figure this out. <br />
<br />
Maybe it helps someone!</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="121313""></a>
  <div class="note">
   <strong class="user">axew3 at axew3 dot com</strong>
   <a href="#121313" class="date">04-Jul-2017 12:23</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
X Maintainers ... Sorry to be such pain the ass, please delete this duplicate, because submitted in a crazy 'session' where i've mess things between browser tabs ... sorry again, alessio<br />
<a href="http://php.net/manual/en/function.session-start.php#121310" rel="nofollow" target="_blank">http://php.net/manual/en/function.session-start.php#121310</a></span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="121311""></a>
  <div class="note">
   <strong class="user">axew3 at axew3 dot com</strong>
   <a href="#121311" class="date">04-Jul-2017 10:30</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I just need with easy, count how many times the page reload over the site, may to add a warning popup, while the counter is 0:<br />
<br />
session_start();<br />
if(isset($_SESSION['count'])){<br />
$count = $_SESSION['count'];<br />
$count++; <br />
$count = $_SESSION['count'] = $count;<br />
} else {<br />
&nbsp;&nbsp;&nbsp; $count = $_SESSION['count'] = 0;<br />
}<br />
echo $count;<br />
<br />
//session_destroy();</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="121310""></a>
  <div class="note">
   <strong class="user">axew3 at axew3 dot com</strong>
   <a href="#121310" class="date">04-Jul-2017 10:19</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I need, with easy, count how many times the page reload over the site, may to add a warning popup, while the counter is 0 ...<br />
session_start();<br />
if(isset($_SESSION['count'])){<br />
$count = $_SESSION['count'];<br />
$count++; <br />
$count = $_SESSION['count'] = $count;<br />
} else {<br />
&nbsp;&nbsp;&nbsp; $count = $_SESSION['count'] = 0;<br />
}<br />
echo $count;<br />
<br />
//session_destroy();</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="121209""></a>
  <div class="note">
   <strong class="user">tom at bitworks dot de</strong>
   <a href="#121209" class="date">11-Jun-2017 02:15</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
A simple session_start() will not be sufficiant to kepp you Session alive. <br />
Due to the filesystems mounting parameters, atime will normally not be updated. Instead of atime, mtime will be delivered.<br />
<br />
This behavior may cause an early session death and your users my be kicked of your login system.&nbsp; <br />
<br />
To keep the session alive it will be necessary to write something into the sessionfile at each request, e. g. a simple <br />
<br />
&nbsp;"$_SESSION['time'] = time();"<br />
<br />
That would keep your session alive, even if the client in reality is only clicking around the site.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="120708""></a>
  <div class="note">
   <strong class="user">ivijan dot stefan at gmail dot com</strong>
   <a href="#120708" class="date">26-Feb-2017 07:59</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
How to fix session_start error?<br />
<br />
Sometimes when you made plugins, addons or some components in projects you need to check if session is started and if is not, you need to start it with no session_start() errors.<br />
<br />
Here is my tested solution what currently work on +9000 domains and in one my plugin but also in some custom works.<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">if (</span><span class="default">strnatcmp</span><span class="keyword">(</span><span class="default">phpversion</span><span class="keyword">(),</span><span class="string">'5.4.0'</span><span class="keyword">) &gt;= </span><span class="default">0</span><span class="keyword">)<br />
{<br />
&nbsp;&nbsp;&nbsp; if (</span><span class="default">session_status</span><span class="keyword">() == </span><span class="default">PHP_SESSION_NONE</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">session_start</span><span class="keyword">();<br />
&nbsp;&nbsp;&nbsp; }<br />
}<br />
else<br />
{<br />
&nbsp;&nbsp;&nbsp; if(</span><span class="default">session_id</span><span class="keyword">() == </span><span class="string">''</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">session_start</span><span class="keyword">();<br />
&nbsp;&nbsp;&nbsp; }<br />
}<br />
</span><span class="default">?&gt;<br />
</span><br />
Feel free to use it and don't worry, be happy. ;)</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="120589""></a>
  <div class="note">
   <strong class="user">bachtel at [googles email service]dotcom</strong>
   <a href="#120589" class="date">03-Feb-2017 07:54</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you are using a custom session handler via session_set_save_handler() then calling session_start() in PHP 7.1 you might see an error like this:<br />
session_start(): Failed to read session data: user (path: /var/lib/php/session) in ...<br />
<br />
As of this writing, it seems to be happening in PHP 7.1, and things look OK in PHP7.0. <br />
<br />
It is also hard to track down because if a session already exists for this id (maybe created by an earlier version of PHP), it will not trigger this issue because the $session_data will not be null.<br />
<br />
The fix is simple... you just need to check for 'null' during your read function:<br />
<br />
<span class="default">&lt;?php<br />
<br />
</span><span class="keyword">function </span><span class="default">read</span><span class="keyword">(</span><span class="default">$id</span><span class="keyword">)<br />
{<br />
&nbsp; </span><span class="comment">//... pull the data out of the DB, off the disk, memcache, etc<br />
&nbsp; </span><span class="default">$session_data </span><span class="keyword">= </span><span class="default">getSessionDataFromSomewhere</span><span class="keyword">(</span><span class="default">$id</span><span class="keyword">);<br />
&nbsp; <br />
&nbsp; </span><span class="comment">//check to see if $session_data is null before returning (CRITICAL)<br />
&nbsp; </span><span class="keyword">if(</span><span class="default">is_null</span><span class="keyword">(</span><span class="default">$session_data</span><span class="keyword">))<br />
&nbsp; {<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$session_data </span><span class="keyword">= </span><span class="string">''</span><span class="keyword">;&nbsp; </span><span class="comment">//use empty string instead of null!<br />
&nbsp; </span><span class="keyword">}<br />
<br />
&nbsp; return </span><span class="default">$session_data</span><span class="keyword">;<br />
}<br />
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="120497""></a>
  <div class="note">
   <strong class="user">chris at ocproducts dot com</strong>
   <a href="#120497" class="date">21-Jan-2017 06:56</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Initiating a session may overwrite your own custom cache control header, which may break clicking back to get back to a prior post request (on Chrome at least).<br />
On my system it was setting 'no-store', which is much more severe than 'no-cache' and what was breaking the back-button.<br />
<br />
If you are controlling your own cache headers carefully you need to call:<br />
session_cache_limiter('');<br />
<br />
...to stop it changing your cache control headers.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="118561""></a>
  <div class="note">
   <strong class="user">fabmlk at hotmail dot com</strong>
   <a href="#118561" class="date">28-Dec-2015 02:04</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you ever need to open multiple distinct sessions in the same script and still let PHP generate session ids for you, here is a simple function I came up with (PHP default session handler is assumed):<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="comment">/**<br />
&nbsp; * Switch to or transparently create session with name $name.<br />
&nbsp; * It can easily be expanded to manage different sessions lifetime.<br />
&nbsp; */<br />
</span><span class="keyword">function </span><span class="default">session_switch</span><span class="keyword">(</span><span class="default">$name </span><span class="keyword">= </span><span class="string">"PHPSESSID"</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; static </span><span class="default">$created_sessions </span><span class="keyword">= array();<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">session_id</span><span class="keyword">() != </span><span class="string">''</span><span class="keyword">) { </span><span class="comment">// if a session is currently opened, close it<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">session_write_close</span><span class="keyword">();<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">session_name</span><span class="keyword">(</span><span class="default">$name</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (isset(</span><span class="default">$_COOKIE</span><span class="keyword">[</span><span class="default">$name</span><span class="keyword">])) {&nbsp; &nbsp; </span><span class="comment">// if a specific session already exists, merge with $created_sessions<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$created_sessions</span><span class="keyword">[</span><span class="default">$name</span><span class="keyword">] = </span><span class="default">$_COOKIE</span><span class="keyword">[</span><span class="default">$name</span><span class="keyword">];<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (isset(</span><span class="default">$created_sessions</span><span class="keyword">[</span><span class="default">$name</span><span class="keyword">])) { </span><span class="comment">// if existing session, impersonate it<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">session_id</span><span class="keyword">(</span><span class="default">$created_sessions</span><span class="keyword">[</span><span class="default">$name</span><span class="keyword">]);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">session_start</span><span class="keyword">();<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; } else { </span><span class="comment">// create new session<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">session_start</span><span class="keyword">();<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$_SESSION </span><span class="keyword">= array(); </span><span class="comment">// empty content before duplicating session file<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; // duplicate last session file with new id and current $_SESSION content<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; // If this is the first created session, there is nothing to duplicate from and passing true as argument will take care of "creating" only one session file<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">session_regenerate_id</span><span class="keyword">(empty(</span><span class="default">$created_sessions</span><span class="keyword">));<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$created_sessions</span><span class="keyword">[</span><span class="default">$name</span><span class="keyword">] = </span><span class="default">session_id</span><span class="keyword">();<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
}<br />
<br />
</span><span class="default">session_switch</span><span class="keyword">(</span><span class="string">"SESSION1"</span><span class="keyword">);<br />
</span><span class="default">$_SESSION</span><span class="keyword">[</span><span class="string">"key"</span><span class="keyword">] = </span><span class="string">"value1"</span><span class="keyword">; </span><span class="comment">// specific to session 1<br />
</span><span class="default">session_switch</span><span class="keyword">(</span><span class="string">"SESSION2"</span><span class="keyword">);<br />
</span><span class="default">$_SESSION</span><span class="keyword">[</span><span class="string">"key"</span><span class="keyword">] = </span><span class="string">"value2"</span><span class="keyword">; </span><span class="comment">// specific to session 2<br />
</span><span class="default">session_switch</span><span class="keyword">(</span><span class="string">"SESSION1"</span><span class="keyword">);<br />
</span><span class="comment">// back to session 1<br />
// ...<br />
</span><span class="default">?&gt;<br />
</span><br />
When using this function, session_start() should not be called on its own anymore (can be replaced with a call to session_switch() without argument).<br />
Also remember that session_start() sets a Set-Cookie HTTP header on each call, so if you echo in-between sessions, wrap with ouput buffering.<br />
<br />
Note: it's probably rarely a good idea to handle multiple sessions so think again if you think you have a good use for it.<br />
Personally it played its role for some quick patching of legacy code I had to maintain.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="117157""></a>
  <div class="note">
   <strong class="user">aaronw at catalyst dot net dot nz</strong>
   <a href="#117157" class="date">23-Apr-2015 06:56</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
As others have noted, PHP's session handler is blocking. When one of your scripts calls session_start(), any other script that also calls session_start() with the same session ID will sleep until the first script closes the session.<br />
<br />
A common workaround to this is call session_start() and session_write_close() each time you want to update the session.<br />
<br />
The problem with this, is that each time you call session_start(), PHP prints a duplicate copy of the session cookie to the HTTP response header. Do this enough times (as you might do in a long-running script), and the response header can get so large that it causes web servers &amp; browsers to crash or reject your response as malformed.<br />
<br />
This error has been reported to PHP HQ, but they've marked it "Won't fix" because they say you're not supposed to open and close the session during a single script like this. https://bugs.php.net/bug.php?id=31455<br />
<br />
As a workaround, I've written a function that uses headers_list() and header_remove() to clear out the duplicate cookies. It's interesting to note that even on requests when PHP sends duplicate session cookies, headers_list() still only lists one copy of the session cookie. Nonetheless, calling header_remove() removes all the duplicate copies.<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="comment">/**<br />
&nbsp;* Every time you call session_start(), PHP adds another<br />
&nbsp;* identical session cookie to the response header. Do this<br />
&nbsp;* enough times, and your response header becomes big enough<br />
&nbsp;* to choke the web server.<br />
&nbsp;*<br />
&nbsp;* This method clears out the duplicate session cookies. You can<br />
&nbsp;* call it after each time you've called session_start(), or call it<br />
&nbsp;* just before you send your headers.<br />
&nbsp;*/<br />
</span><span class="keyword">function </span><span class="default">clear_duplicate_cookies</span><span class="keyword">() {<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// If headers have already been sent, there's nothing we can do<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">if (</span><span class="default">headers_sent</span><span class="keyword">()) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return;<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$cookies </span><span class="keyword">= array();<br />
&nbsp;&nbsp;&nbsp; foreach (</span><span class="default">headers_list</span><span class="keyword">() as </span><span class="default">$header</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// Identify cookie headers<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">if (</span><span class="default">strpos</span><span class="keyword">(</span><span class="default">$header</span><span class="keyword">, </span><span class="string">'Set-Cookie:'</span><span class="keyword">) === </span><span class="default">0</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$cookies</span><span class="keyword">[] = </span><span class="default">$header</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// Removes all cookie headers, including duplicates<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">header_remove</span><span class="keyword">(</span><span class="string">'Set-Cookie'</span><span class="keyword">);<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// Restore one copy of each cookie<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">foreach(</span><span class="default">array_unique</span><span class="keyword">(</span><span class="default">$cookies</span><span class="keyword">) as </span><span class="default">$cookie</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">header</span><span class="keyword">(</span><span class="default">$cookie</span><span class="keyword">, </span><span class="default">false</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }<br />
}<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="114209""></a>
  <div class="note">
   <strong class="user">elitescripts2000 at yahoo dot com</strong>
   <a href="#114209" class="date">25-Jan-2014 03:56</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
3 easy but vital things about Sessions in AJAX Apps.<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="comment">// session start<br />
<br />
//&nbsp; It is VERY important to include a Period if using<br />
// a whole domain.&nbsp; (.yourdomain.com)<br />
// It is VERY important to set the root path your session will always<br />
// operate in... (/members) will ensure sessions will NOT be interfered<br />
// with a session with a path of say (/admin) ... so you can log in<br />
// as /admin and as /members... NEVER do unset($_SESSION)<br />
// $_SESSION=array(); is preferred, session_unset();&nbsp; session_destroy();<br />
<br />
</span><span class="default">session_set_cookie_params</span><span class="keyword">(</span><span class="default">0</span><span class="keyword">, </span><span class="string">'/members'</span><span class="keyword">, </span><span class="string">'.yourdomain.com'</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">);<br />
</span><span class="default">session_start</span><span class="keyword">();<br />
</span><span class="default">$_SESSION </span><span class="keyword">= array();<br />
</span><span class="default">session_unset</span><span class="keyword">();<br />
</span><span class="default">session_destroy</span><span class="keyword">();<br />
<br />
</span><span class="default">session_set_cookie_params</span><span class="keyword">(</span><span class="default">0</span><span class="keyword">, </span><span class="string">'/members'</span><span class="keyword">, </span><span class="string">'.yourdomain.com'</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">);<br />
</span><span class="default">session_start</span><span class="keyword">();<br />
<br />
</span><span class="default">$_SESSION</span><span class="keyword">[</span><span class="string">'whatever'</span><span class="keyword">] = </span><span class="string">'youwhat'</span><span class="keyword">;<br />
<br />
</span><span class="comment">// session destroying <br />
<br />
// To be safe, clear out your $_SESSION array<br />
// Next, what most people do NOT do is delete the session cookie!<br />
// It is easy to delete a cookie by expiring it long before the current time.<br />
// The ONLY WAY to delete a cookie, is to make sure ALL parameters match the<br />
// cookie to be deleted...which is easy to get those params with <br />
// session_get_cookie_params()...<br />
// FInally, use&nbsp; session_unset(); and session_destroy(); in this order to ensure<br />
// Chrome, IE, Firefox and others, are properly destroying the session.<br />
</span><span class="default">$_SESSION </span><span class="keyword">= array();<br />
if (</span><span class="default">ini_get</span><span class="keyword">(</span><span class="string">'session.use_cookies'</span><span class="keyword">))<br />
{<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$p </span><span class="keyword">= </span><span class="default">session_get_cookie_params</span><span class="keyword">();<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">setcookie</span><span class="keyword">(</span><span class="default">session_name</span><span class="keyword">(), </span><span class="string">''</span><span class="keyword">, </span><span class="default">time</span><span class="keyword">() - </span><span class="default">31536000</span><span class="keyword">, </span><span class="default">$p</span><span class="keyword">[</span><span class="string">'path'</span><span class="keyword">], </span><span class="default">$p</span><span class="keyword">[</span><span class="string">'domain'</span><span class="keyword">], </span><span class="default">$p</span><span class="keyword">[</span><span class="string">'secure'</span><span class="keyword">], </span><span class="default">$p</span><span class="keyword">[</span><span class="string">'httponly'</span><span class="keyword">]);<br />
&nbsp;}<br />
</span><span class="default">session_unset</span><span class="keyword">();<br />
</span><span class="default">session_destroy</span><span class="keyword">();<br />
<br />
</span><span class="comment">// AJAX and SESSIONS.<br />
// Example... you start a session based PHP page, which then calls an Ajax (XMLHTTP) authenticated<br />
// using the SAME SESSION to Poll and output the data, for example.&nbsp; But, you notice when you<br />
// try to start the Polling AJAX call always HANGS and seems to hang at the session_start().<br />
// This is because the session is opened in the first page, calls the AJAX polling example, and<br />
// tries to open the same session (for authentication) and do the AJAX call, you MUST call<br />
// session_write_close(); meaning you are done writing to the $_SESSION variable, which really<br />
// represents a file that must be CLOSED with session_write_close();....<br />
// THAN you can call your AJAX Polling code to reopen the same session and do its polling...<br />
// Normally, the $_SESSION is closed automatically when the script is closed or finished executing<br />
// So, if you need to keep a PHP page running after opening a SESSION, simply close it when finished<br />
// writing to $_SESSION so the AJAX polling page can authenticate and use the same session in a<br />
// seperate web page...<br />
<br />
</span><span class="default">session_write_close</span><span class="keyword">();<br />
<br />
</span><span class="default">?&gt;<br />
</span><br />
Hope this helps someone with their sessions...<br />
Thanks.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="113985""></a>
  <div class="note">
   <strong class="user">ohcc at 163 dot com</strong>
   <a href="#113985" class="date">25-Dec-2013 04:00</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
The constant SID would always be '' (an empty string) if directive session.use_trans_sid in php ini file is set to 0. <br />
<br />
So remember to set session.use_trans_sid to 1 and restart your server before you use SID in your php script.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="112973""></a>
  <div class="note">
   <strong class="user">ilnomedellaccount at gmail dot com</strong>
   <a href="#112973" class="date">13-Aug-2013 03:53</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
A note about session_start(), custom handlers and database foreign key constraints, which I think may be of some use...<br />
<br />
We know that if we want our sessions into a database table (rather than the default storage), we can refer to session_set_save_handler(...) to get them there. Note that session_set_save_handler must (obviously) be called before session_start(), but let me get to the point...<br />
<br />
Upon calling session_start() the "first time", when the session does not already exist, php will spawn a new session but will not call the write handler until script execution finishes.<br />
<br />
Thus, the session at this point exists in the server process memory, but won't be visible as a row in the DB before the script ends.<br />
<br />
This seems reasonable, because this avoids some unnecessary database access and resource usage before we even populate our session with meaningfull and definitive data, but this also has side-effects.<br />
<br />
In my case, the script called session_start() to make sure a session was initiated, then used session_id() to populate another table in the DB, which had foreign_key constraint to the "sessions" table. This failed because no session was in the db at that point, yet!<br />
<br />
I know I could simply force the creation of the row in the DB by manually calling the write handler after session_start(), when necessary, but I am not sure if this is the best possible approach.<br />
<br />
As soon as I find an "elegant" solution, or a completely different approach, I will post some working sample code.<br />
<br />
In the meanwhile... have fun!</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="110649""></a>
  <div class="note">
   <strong class="user">someOne_01 at somewhere dot com</strong>
   <a href="#110649" class="date">17-Nov-2012 02:30</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
When you have an import script that takes long to execute, the browser seem to lock up and you cannot access the website anymore. this is because a request is reading and locking the session file to prevent corruption.
<br />

<br />
you can either 
<br />
- use a different session handler with session_set_save_handler()
<br />
- use session_write_close() in the import script as soon you don't need session anymore (best moment is just before the long during part takes place), you can session_start when ever you want and as many times you like if your import script requires session variables changed. 
<br />

<br />
example
<br />
<span class="default">&lt;?php
<br />
session_start</span><span class="keyword">(); </span><span class="comment">//initiate / open session
<br />
</span><span class="default">$_SESSION</span><span class="keyword">[</span><span class="string">'count'</span><span class="keyword">] = </span><span class="default">0</span><span class="keyword">; </span><span class="comment">// store something in the session
<br />
</span><span class="default">session_write_close</span><span class="keyword">(); </span><span class="comment">//now close it, 
<br />
# from here every other script can be run (and makes it seem like multitasking)
<br />
</span><span class="keyword">for(</span><span class="default">$i</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">; </span><span class="default">$i</span><span class="keyword">&lt;=</span><span class="default">100</span><span class="keyword">; </span><span class="default">$i</span><span class="keyword">++){ </span><span class="comment">//do 100 cycles
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">session_start</span><span class="keyword">(); </span><span class="comment">//open the session again for editing a variable
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$_SESSION</span><span class="keyword">[</span><span class="string">'count'</span><span class="keyword">] += </span><span class="default">1</span><span class="keyword">; </span><span class="comment">//change variable
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">session_write_close</span><span class="keyword">(); </span><span class="comment">//now close the session again!
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">sleep</span><span class="keyword">(</span><span class="default">2</span><span class="keyword">); </span><span class="comment">//every cycle sleep two seconds, or do a heavy task
<br />
</span><span class="keyword">}
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="105447""></a>
  <div class="note">
   <strong class="user">sanjuro at 1up-games dot com</strong>
   <a href="#105447" class="date">18-Aug-2011 11:56</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
The problem with SID is that if on occasions you don't start a session, instead of outputting an empty string for transparent integration it will return the regular undefined constant notice. So you might want to test the constant with defined() beforehand.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="102460""></a>
  <div class="note">
   <strong class="user">linblow at hotmail dot fr</strong>
   <a href="#102460" class="date">16-Feb-2011 05:06</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you want to handle sessions with a class, I wrote this little class:<br />
<br />
<span class="default">&lt;?php<br />
<br />
</span><span class="comment">/*<br />
&nbsp;&nbsp;&nbsp; Use the static method getInstance to get the object.<br />
*/<br />
<br />
</span><span class="keyword">class </span><span class="default">Session<br />
</span><span class="keyword">{<br />
&nbsp;&nbsp;&nbsp; const </span><span class="default">SESSION_STARTED </span><span class="keyword">= </span><span class="default">TRUE</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; const </span><span class="default">SESSION_NOT_STARTED </span><span class="keyword">= </span><span class="default">FALSE</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// The state of the session<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">private </span><span class="default">$sessionState </span><span class="keyword">= </span><span class="default">self</span><span class="keyword">::</span><span class="default">SESSION_NOT_STARTED</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// THE only instance of the class<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">private static </span><span class="default">$instance</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; private function </span><span class="default">__construct</span><span class="keyword">() {}<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">/**<br />
&nbsp;&nbsp;&nbsp; *&nbsp; &nbsp; Returns THE instance of 'Session'.<br />
&nbsp;&nbsp;&nbsp; *&nbsp; &nbsp; The session is automatically initialized if it wasn't.<br />
&nbsp;&nbsp;&nbsp; *&nbsp; &nbsp; <br />
&nbsp;&nbsp;&nbsp; *&nbsp; &nbsp; @return&nbsp; &nbsp; object<br />
&nbsp;&nbsp;&nbsp; **/<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">public static function </span><span class="default">getInstance</span><span class="keyword">()<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if ( !isset(</span><span class="default">self</span><span class="keyword">::</span><span class="default">$instance</span><span class="keyword">))<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">self</span><span class="keyword">::</span><span class="default">$instance </span><span class="keyword">= new </span><span class="default">self</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">self</span><span class="keyword">::</span><span class="default">$instance</span><span class="keyword">-&gt;</span><span class="default">startSession</span><span class="keyword">();<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">self</span><span class="keyword">::</span><span class="default">$instance</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">/**<br />
&nbsp;&nbsp;&nbsp; *&nbsp; &nbsp; (Re)starts the session.<br />
&nbsp;&nbsp;&nbsp; *&nbsp; &nbsp; <br />
&nbsp;&nbsp;&nbsp; *&nbsp; &nbsp; @return&nbsp; &nbsp; bool&nbsp; &nbsp; TRUE if the session has been initialized, else FALSE.<br />
&nbsp;&nbsp;&nbsp; **/<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">public function </span><span class="default">startSession</span><span class="keyword">()<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if ( </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">sessionState </span><span class="keyword">== </span><span class="default">self</span><span class="keyword">::</span><span class="default">SESSION_NOT_STARTED </span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">sessionState </span><span class="keyword">= </span><span class="default">session_start</span><span class="keyword">();<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">sessionState</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">/**<br />
&nbsp;&nbsp;&nbsp; *&nbsp; &nbsp; Stores datas in the session.<br />
&nbsp;&nbsp;&nbsp; *&nbsp; &nbsp; Example: $instance-&gt;foo = 'bar';<br />
&nbsp;&nbsp;&nbsp; *&nbsp; &nbsp; <br />
&nbsp;&nbsp;&nbsp; *&nbsp; &nbsp; @param&nbsp; &nbsp; name&nbsp; &nbsp; Name of the datas.<br />
&nbsp;&nbsp;&nbsp; *&nbsp; &nbsp; @param&nbsp; &nbsp; value&nbsp; &nbsp; Your datas.<br />
&nbsp;&nbsp;&nbsp; *&nbsp; &nbsp; @return&nbsp; &nbsp; void<br />
&nbsp;&nbsp;&nbsp; **/<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">public function </span><span class="default">__set</span><span class="keyword">( </span><span class="default">$name </span><span class="keyword">, </span><span class="default">$value </span><span class="keyword">)<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$_SESSION</span><span class="keyword">[</span><span class="default">$name</span><span class="keyword">] = </span><span class="default">$value</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">/**<br />
&nbsp;&nbsp;&nbsp; *&nbsp; &nbsp; Gets datas from the session.<br />
&nbsp;&nbsp;&nbsp; *&nbsp; &nbsp; Example: echo $instance-&gt;foo;<br />
&nbsp;&nbsp;&nbsp; *&nbsp; &nbsp; <br />
&nbsp;&nbsp;&nbsp; *&nbsp; &nbsp; @param&nbsp; &nbsp; name&nbsp; &nbsp; Name of the datas to get.<br />
&nbsp;&nbsp;&nbsp; *&nbsp; &nbsp; @return&nbsp; &nbsp; mixed&nbsp; &nbsp; Datas stored in session.<br />
&nbsp;&nbsp;&nbsp; **/<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">public function </span><span class="default">__get</span><span class="keyword">( </span><span class="default">$name </span><span class="keyword">)<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if ( isset(</span><span class="default">$_SESSION</span><span class="keyword">[</span><span class="default">$name</span><span class="keyword">]))<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">$_SESSION</span><span class="keyword">[</span><span class="default">$name</span><span class="keyword">];<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; public function </span><span class="default">__isset</span><span class="keyword">( </span><span class="default">$name </span><span class="keyword">)<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return isset(</span><span class="default">$_SESSION</span><span class="keyword">[</span><span class="default">$name</span><span class="keyword">]);<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; public function </span><span class="default">__unset</span><span class="keyword">( </span><span class="default">$name </span><span class="keyword">)<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; unset( </span><span class="default">$_SESSION</span><span class="keyword">[</span><span class="default">$name</span><span class="keyword">] );<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">/**<br />
&nbsp;&nbsp;&nbsp; *&nbsp; &nbsp; Destroys the current session.<br />
&nbsp;&nbsp;&nbsp; *&nbsp; &nbsp; <br />
&nbsp;&nbsp;&nbsp; *&nbsp; &nbsp; @return&nbsp; &nbsp; bool&nbsp; &nbsp; TRUE is session has been deleted, else FALSE.<br />
&nbsp;&nbsp;&nbsp; **/<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">public function </span><span class="default">destroy</span><span class="keyword">()<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if ( </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">sessionState </span><span class="keyword">== </span><span class="default">self</span><span class="keyword">::</span><span class="default">SESSION_STARTED </span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">sessionState </span><span class="keyword">= !</span><span class="default">session_destroy</span><span class="keyword">();<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; unset( </span><span class="default">$_SESSION </span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return !</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">sessionState</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">FALSE</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
}<br />
<br />
</span><span class="comment">/*<br />
&nbsp;&nbsp;&nbsp; Examples:<br />
*/<br />
<br />
// We get the instance<br />
</span><span class="default">$data </span><span class="keyword">= </span><span class="default">Session</span><span class="keyword">::</span><span class="default">getInstance</span><span class="keyword">();<br />
<br />
</span><span class="comment">// Let's store datas in the session<br />
</span><span class="default">$data</span><span class="keyword">-&gt;</span><span class="default">nickname </span><span class="keyword">= </span><span class="string">'Someone'</span><span class="keyword">;<br />
</span><span class="default">$data</span><span class="keyword">-&gt;</span><span class="default">age </span><span class="keyword">= </span><span class="default">18</span><span class="keyword">;<br />
<br />
</span><span class="comment">// Let's display datas<br />
</span><span class="default">printf</span><span class="keyword">( </span><span class="string">'&lt;p&gt;My name is %s and I\'m %d years old.&lt;/p&gt;' </span><span class="keyword">, </span><span class="default">$data</span><span class="keyword">-&gt;</span><span class="default">nickname </span><span class="keyword">, </span><span class="default">$data</span><span class="keyword">-&gt;</span><span class="default">age </span><span class="keyword">);<br />
<br />
</span><span class="comment">/*<br />
&nbsp;&nbsp;&nbsp; It will display:<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; Array<br />
&nbsp;&nbsp;&nbsp; (<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; [nickname] =&gt; Someone<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; [age] =&gt; 18<br />
&nbsp;&nbsp;&nbsp; )<br />
*/<br />
<br />
</span><span class="default">printf</span><span class="keyword">( </span><span class="string">'&lt;pre&gt;%s&lt;/pre&gt;' </span><span class="keyword">, </span><span class="default">print_r</span><span class="keyword">( </span><span class="default">$_SESSION </span><span class="keyword">, </span><span class="default">TRUE </span><span class="keyword">));<br />
<br />
</span><span class="comment">// TRUE<br />
</span><span class="default">var_dump</span><span class="keyword">( isset( </span><span class="default">$data</span><span class="keyword">-&gt;</span><span class="default">nickname </span><span class="keyword">));<br />
<br />
</span><span class="comment">// We destroy the session<br />
</span><span class="default">$data</span><span class="keyword">-&gt;</span><span class="default">destroy</span><span class="keyword">();<br />
<br />
</span><span class="comment">// FALSE<br />
</span><span class="default">var_dump</span><span class="keyword">( isset( </span><span class="default">$data</span><span class="keyword">-&gt;</span><span class="default">nickname </span><span class="keyword">));<br />
<br />
</span><span class="default">?&gt;<br />
</span><br />
I prefer using this class instead of using directly the array $_SESSION.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="102254""></a>
  <div class="note">
   <strong class="user">anon at ymous dot com</strong>
   <a href="#102254" class="date">04-Feb-2011 01:51</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I am trying to get a session created by a browser call to be used by a command line cli-&gt;curl php call (in this case, both calls to the same server and php.ini), for a set of flexible media import routines, <br />
<br />
but the cli-&gt;curl call always starts a new session despite me putting PHPSESSID=validID as the first parameter for the url called by curl.<br />
<br />
I was able to fix it by calling session_id($_GET['PHPSESSID']) before calling session_start() in the script called via curl.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="101452""></a>
  <div class="note">
   <strong class="user">dave1010 at gmail dot com</strong>
   <a href="#101452" class="date">17-Dec-2010 01:35</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
PHP locks the session file until it is closed. If you have 2 scripts using the same session (i.e. from the same user) then the 2nd script will not finish its call to session_start() until the first script finishes execution.<br />
<br />
If you have scripts that run for more than a second and users may be making more than 1 request at a time then it is worth calling session_write_close() as soon as you've finished writing session data.<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="comment">// a lock is places on the session, so other scripts will have to wait<br />
</span><span class="default">session_start</span><span class="keyword">();<br />
<br />
</span><span class="comment">// do all your writing to $_SESSION<br />
</span><span class="default">$_SESSION</span><span class="keyword">[</span><span class="string">'a'</span><span class="keyword">] = </span><span class="default">1</span><span class="keyword">;<br />
<br />
</span><span class="comment">// $_SESSION can still be read, but writing will not update the session.<br />
// the lock is removed and other scripts can now read the session<br />
</span><span class="default">session_write_close</span><span class="keyword">();<br />
<br />
</span><span class="default">do_something_slow</span><span class="keyword">();<br />
</span><span class="default">?&gt;<br />
</span><br />
Found this out from <a href="http://konrness.com/php5/how-to-prevent-blocking-php-requests/" rel="nofollow" target="_blank">http://konrness.com/php5/how-to-prevent-blocking-php-requests/</a></span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="96491""></a>
  <div class="note">
   <strong class="user">info.at.merchandisinginteractive.sk</strong>
   <a href="#96491" class="date">01-Mar-2010 06:46</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
A handy script that checks fot the presence of uft-8 byte order mark (BOM) in all files in all directories starting on current dir. Combined from the work of other people here...
<br />

<br />
<span class="default">&lt;?php
<br />
</span><span class="keyword">function </span><span class="default">fopen_utf8 </span><span class="keyword">(</span><span class="default">$filename</span><span class="keyword">) {
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$file </span><span class="keyword">= @</span><span class="default">fopen</span><span class="keyword">(</span><span class="default">$filename</span><span class="keyword">, </span><span class="string">"r"</span><span class="keyword">);
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$bom </span><span class="keyword">= </span><span class="default">fread</span><span class="keyword">(</span><span class="default">$file</span><span class="keyword">, </span><span class="default">3</span><span class="keyword">);
<br />
&nbsp;&nbsp;&nbsp; if (</span><span class="default">$bom </span><span class="keyword">!= </span><span class="string">b"\xEF\xBB\xBF"</span><span class="keyword">)
<br />
&nbsp;&nbsp;&nbsp; {
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">false</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; }
<br />
&nbsp;&nbsp;&nbsp; else
<br />
&nbsp;&nbsp;&nbsp; {
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">true</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; }
<br />
} 
<br />

<br />
function </span><span class="default">file_array</span><span class="keyword">(</span><span class="default">$path</span><span class="keyword">, </span><span class="default">$exclude </span><span class="keyword">= </span><span class="string">".|..|design"</span><span class="keyword">, </span><span class="default">$recursive </span><span class="keyword">= </span><span class="default">true</span><span class="keyword">) {
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$path </span><span class="keyword">= </span><span class="default">rtrim</span><span class="keyword">(</span><span class="default">$path</span><span class="keyword">, </span><span class="string">"/"</span><span class="keyword">) . </span><span class="string">"/"</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$folder_handle </span><span class="keyword">= </span><span class="default">opendir</span><span class="keyword">(</span><span class="default">$path</span><span class="keyword">);
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$exclude_array </span><span class="keyword">= </span><span class="default">explode</span><span class="keyword">(</span><span class="string">"|"</span><span class="keyword">, </span><span class="default">$exclude</span><span class="keyword">);
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$result </span><span class="keyword">= array();
<br />
&nbsp;&nbsp;&nbsp; while(</span><span class="default">false </span><span class="keyword">!== (</span><span class="default">$filename </span><span class="keyword">= </span><span class="default">readdir</span><span class="keyword">(</span><span class="default">$folder_handle</span><span class="keyword">))) {
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if(!</span><span class="default">in_array</span><span class="keyword">(</span><span class="default">strtolower</span><span class="keyword">(</span><span class="default">$filename</span><span class="keyword">), </span><span class="default">$exclude_array</span><span class="keyword">)) {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">is_dir</span><span class="keyword">(</span><span class="default">$path </span><span class="keyword">. </span><span class="default">$filename </span><span class="keyword">. </span><span class="string">"/"</span><span class="keyword">)) {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// Need to include full "path" or it's an infinite loop
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">if(</span><span class="default">$recursive</span><span class="keyword">) </span><span class="default">$result</span><span class="keyword">[] = </span><span class="default">file_array</span><span class="keyword">(</span><span class="default">$path </span><span class="keyword">. </span><span class="default">$filename </span><span class="keyword">. </span><span class="string">"/"</span><span class="keyword">, </span><span class="default">$exclude</span><span class="keyword">, </span><span class="default">true</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; } else {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if ( </span><span class="default">fopen_utf8</span><span class="keyword">(</span><span class="default">$path </span><span class="keyword">. </span><span class="default">$filename</span><span class="keyword">) )
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">//$result[] = $filename;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">echo (</span><span class="default">$path </span><span class="keyword">. </span><span class="default">$filename </span><span class="keyword">. </span><span class="string">"&lt;br&gt;"</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }
<br />
&nbsp;&nbsp;&nbsp; }
<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">$result</span><span class="keyword">;
<br />
}
<br />

<br />
</span><span class="default">$files </span><span class="keyword">= </span><span class="default">file_array</span><span class="keyword">(</span><span class="string">"."</span><span class="keyword">);
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="95377""></a>
  <div class="note">
   <strong class="user">info at nospam dot mmfilm dot sk</strong>
   <a href="#95377" class="date">29-Dec-2009 07:58</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
For those of you running in problems with UTF-8 encoded files:<br />
<br />
I was getting an error because of the BOM, although i set Dreamweaver to "save as" the without the BOM. It appears that DW will not change this setting in already existing files. After creating a new file withou the BOM, everything worked well.<br />
<br />
I also recommend <a href="http://people.w3.org/rishida/utils/bomtester/index.php - a utility that remote checks for the presence of BOM." rel="nofollow" target="_blank">http://people.w3.org/rishida/utils/bomtester/index.php - a utility that remote checks for the presence of BOM.</a></span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="95372""></a>
  <div class="note">
   <strong class="user">jamestrowbridge at gmail dot com</strong>
   <a href="#95372" class="date">29-Dec-2009 09:57</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Unfortunately, after pulling my hair out trying to figure out why my application was working fine in every browser other than IE ( Internet Explorer) (Opera, Chrome, Firefox, Safari are what I've tested this in) - when using a DNS CNAME record (like a vanity name that is different from the DNS A record, which is the hostname of the server) sessions do not work correctly.
<br />

<br />
If you store a session var while on the CNAME:
<br />
vanity.example.com and the hostname of the server is hosname.example.com
<br />
Then try to call the variable from a different page, it will not find it because of the CNAME (I guess it store the variable under the hostname, then when trying to read it it's still looking under the CNAME) the same application works fine when accessing it under the hostname directly.&nbsp; Keep in mind that I was testing this on an internal network.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="93673""></a>
  <div class="note">
   <strong class="user">Charlie at NOSPAM dot example dot com</strong>
   <a href="#93673" class="date">22-Sep-2009 07:04</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Be warned that depending on end of script to close the session will effectively serialize concurrent session requests.&nbsp;&nbsp; Concurrent background "data retrieval" (e.g. applications such as AJAX or amfphp/Flex) expecting to retrieve data in parallel can fall into this trap easily.<br />
<br />
Holding the session_write_close until after an expensive operation is likewise problematic.<br />
<br />
To minimize effects, call session_write_close (aka session_commit) as early as practical (e.g. without introducing race conditions) or otherwise avoid the serialization bottleneck.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="92490""></a>
  <div class="note">
   <strong class="user">schlang</strong>
   <a href="#92490" class="date">26-Jul-2009 10:44</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
if you store your sessions in a database, always ensure that the type of the database column is large enough for your session values</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="92432""></a>
  <div class="note">
   <strong class="user">emre@yazici</strong>
   <a href="#92432" class="date">23-Jul-2009 02:46</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
PHP Manual specifically denotes this common mistake:<br />
<br />
Depending on the session handler, not all characters are allowed within the session id. For example, the file session handler only allows characters in the range a-z A-Z 0-9 , (comma) and - (minus)!<br />
<br />
See session_id() manual page for more details.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="92356""></a>
  <div class="note">
   <strong class="user">dstuff at brainsware dot org</strong>
   <a href="#92356" class="date">21-Jul-2009 05:53</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
It seems like spaces in the name don't work either - got a new session id generated each time</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="87069""></a>
  <div class="note">
   <strong class="user">andy_isherwood at hotmail dot com</strong>
   <a href="#87069" class="date">18-Nov-2008 06:54</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
A session created with session_start will only be available to pages within the directory tree of the page that first created it.<br />
<br />
i.e. If the page that first creates the session is /dir1/dir2/index.php and the user then goes to any page above dir2 (e.g. /dir1/index.php), session_start will create a new session rather than use the existing one.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="81378""></a>
  <div class="note">
   <strong class="user">jphansen at uga dot edu</strong>
   <a href="#81378" class="date">25-Feb-2008 11:12</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I just wrote that session_start() will erase your querystring variable(s) once called. I want to clarify that it will only do this if a variable by the same subscript is defined in $_SESSION[].</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="73952""></a>
  <div class="note">
   <strong class="user">leandroico---at---gmail---dot---com</strong>
   <a href="#73952" class="date">17-Mar-2007 04:21</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
TAGS: session_start headers output errors include_once require_once php tag new line<br />
<br />
Errors with output headers related to *session_start()* being called inside include files.<br />
<br />
If you are starting your session inside an include file you must be aware of the presence of undesired characters after php end tag.<br />
<br />
Let's take an example:<br />
&gt; page.php<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">include_once </span><span class="string">'i_have_php_end_tag.inc.php'</span><span class="keyword">;<br />
include_once </span><span class="string">'init_session.inc.php'</span><span class="keyword">;<br />
<br />
echo </span><span class="string">"Damn! Why I'm having these output header errors?"</span><span class="keyword">;<br />
</span><span class="default">?&gt;<br />
</span><br />
&gt; i_have_php_end_tag.inc.php<br />
<span class="default">&lt;?php<br />
$_JUST_A_GLOBAL_VAR </span><span class="keyword">= </span><span class="string">'Yes, a global var, indeed'</span><span class="keyword">;<br />
</span><span class="default">?&gt;<br />
</span><br />
&gt; init_session.inc.php<br />
<span class="default">&lt;?php<br />
session_start</span><span class="keyword">();<br />
</span><span class="default">$_SESSION</span><span class="keyword">[</span><span class="string">'blabla'</span><span class="keyword">] = </span><span class="default">123</span><span class="keyword">;<br />
</span><span class="default">?&gt;<br />
</span><br />
With all this stuff we will get an error, something like:<br />
"... Cannot send session cache limiter - headers already sent (output started at ...", right?<br />
<br />
To solve this problem we have to ignore all output sent by include files. To ensure that we need to use the couple of functions: *ob_start()* and *ob_end_clean()* to suppress the output. So, all we have to do is changing the *page.php* to this:<br />
<br />
<span class="default">&lt;?php<br />
ob_start</span><span class="keyword">();<br />
include_once </span><span class="string">'i_have_php_end_tag.inc.php'</span><span class="keyword">;<br />
include_once </span><span class="string">'init_session.inc.php'</span><span class="keyword">;<br />
</span><span class="default">ob_end_clean</span><span class="keyword">();<br />
<br />
echo </span><span class="string">"Woo hoo! All right! Die you undesired outputs!!!"</span><span class="keyword">;<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="70007""></a>
  <div class="note">
   <strong class="user">ben dot morin at spaboom dot com</strong>
   <a href="#70007" class="date">29-Sep-2006 09:49</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
James at skinsupport dot com raises a good point (warning) about additional requests from the browser.&nbsp; The request for favicon.ico, depending on how it is handled, can have unintended results on your sessions.&nbsp; <br />
<br />
For example, suppose you have ErrorDocument 404 /signin.php, no favicon.ico file and all pages in your site where the user signs in are also redirected to /signin.php if they're not already signed in.&nbsp; <br />
<br />
If signin.php does any clean up or reassigning of session_id (as all good signin.php pages should) then the additional request from the browser for favicon.ico could potentially corrupt the session as set by the actual request.&nbsp; <br />
<br />
Kudos to James for pointing it out and shame on me for skimming past it and not seeing how it applied to my problem.&nbsp; Thanks too to the Firefox Live HTTP Headers extension for showing the additional request.&nbsp; <br />
<br />
Don't waste days or even hours on this if your session cookies are not being sent or if the session data isn't what you expect it to be.&nbsp; At a minimum, eliminate this case and see if any additional requests could be at fault.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="68123""></a>
  <div class="note">
   <strong class="user">James</strong>
   <a href="#68123" class="date">13-Jul-2006 04:22</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
To avoid the notice commited by PHP since 4.3.3 when you start a session twice, check session_id() first:<br />
<br />
if (session_id() == "")<br />
&nbsp; session_start();</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="60018""></a>
  <div class="note">
   <strong class="user">james at skinsupport dot com</strong>
   <a href="#60018" class="date">22-Dec-2005 06:17</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
One thing of note that caused me three days of trouble:<br />
<br />
It's important to note that Firefox (for one) makes two calls to the server automatically.&nbsp; One for the page, and one for favicon.ico.<br />
<br />
If you are setting session variables (as I was) to certain values when a page exists, and other values when pages don't exist, the values for non-existent pages will overwrite the values for existing pages if favicon.ico doesn't exist.<br />
<br />
I doubt many of you are doing this, but if you are, this is a consideration you need to address or you'll be bald over the course of a three day period!</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="53293""></a>
  <div class="note">
   <strong class="user">erm[at]the[dash]erm[dot]com</strong>
   <a href="#53293" class="date">27-May-2005 01:04</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you are insane like me, and want to start a session from the cli so other scripts can access the same information.<br />
<br />
I don't know how reliable this is.&nbsp; The most obvious use I can see is setting pids.<br />
<br />
// temp.php<br />
<br />
#!/usr/bin/php -q<br />
<span class="default">&lt;?php<br />
<br />
session_id </span><span class="keyword">(</span><span class="string">"temp"</span><span class="keyword">);<br />
</span><span class="default">session_start</span><span class="keyword">();<br />
<br />
if (</span><span class="default">$_SESSION</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">print_r </span><span class="keyword">(</span><span class="default">$_SESSION</span><span class="keyword">);<br />
}<br />
<br />
</span><span class="default">$_SESSION</span><span class="keyword">[</span><span class="string">'test'</span><span class="keyword">] = </span><span class="string">"this is a test if sessions are usable inside scripts"</span><span class="keyword">;<br />
<br />
</span><span class="default">?&gt;<br />
</span><br />
// Temp 2<br />
<br />
#!/usr/bin/php -q<br />
<span class="default">&lt;?php<br />
<br />
session_id </span><span class="keyword">(</span><span class="string">"temp"</span><span class="keyword">);<br />
</span><span class="default">session_start</span><span class="keyword">();<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">print_r </span><span class="keyword">(</span><span class="default">$_SESSION</span><span class="keyword">);<br />
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="51520""></a>
  <div class="note">
   <strong class="user">jorrizza at gmail dot com</strong>
   <a href="#51520" class="date">02-Apr-2005 05:33</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you open a popup window (please no commercial ones!) with javascript window.open it might happen IE blocks the session cookie.<br />
A simple fix for that is opening the new window with the session ID in a GET value. Note I don't use SID for this, because it will not allways be available.<br />
<br />
----page.php----<br />
//you must have a session active here<br />
window.open('popup.php?sid=<span class="default">&lt;?php </span><span class="keyword">echo </span><span class="default">session_id</span><span class="keyword">(); </span><span class="default">?&gt;</span>', '700x500', 'toolbar=no, status=no, scrollbars=yes, location=no, menubar=no, directories=no, width=700, height=500');<br />
<br />
----popup.php----<br />
<span class="default">&lt;?php<br />
session_id</span><span class="keyword">(</span><span class="default">strip_tags</span><span class="keyword">(</span><span class="default">$_GET</span><span class="keyword">[</span><span class="string">'sid'</span><span class="keyword">]));<br />
</span><span class="default">session_start</span><span class="keyword">();<br />
</span><span class="comment">//and go on with your session vars<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="50905""></a>
  <div class="note">
   <strong class="user">hbertini at sapo dot pt</strong>
   <a href="#50905" class="date">13-Mar-2005 12:29</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
workaround when using session variables in a .php file referred by a frame (.html, or other file type) at a different server than the one serving the .php:<br />
<br />
Under these conditions IE6 or later silently refuses the session cookie that is attempted to create (either implicitly or explicitly by invoquing session_start()).<br />
<br />
As a consequence, your session variable will return an empty value.<br />
<br />
According to MS kb, the workaround is to add a header that says your remote .php page will not abuse from the fact that permission has been granted.<br />
<br />
Place this header on the .php file that will create/update the session variables you want:<br />
<br />
<span class="default">&lt;?php header</span><span class="keyword">(</span><span class="string">'P3P: CP="CAO PSA OUR"'</span><span class="keyword">); </span><span class="default">?&gt;<br />
</span><br />
Regards,<br />
Hugo</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="33369""></a>
  <div class="note">
   <strong class="user">m dot kuiphuis at hccnet dot nl</strong>
   <a href="#33369" class="date">24-Jun-2003 03:37</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
[Editors Note: For more information about this
<br />
<a href="http://www.zvon.org/tmRFC/RFC882/Output/chapter5.html ]" rel="nofollow" target="_blank">http://www.zvon.org/tmRFC/RFC882/Output/chapter5.html ]</a>
<br />
&nbsp;
<br />
I use name-based virtual hosting on Linux with Apache and PHP 4.3.2. 
<br />
Every time when I refreshed (by pressing F5 in Internet Explorer) I noticed that I got a new session_id. Simultaneously browsing the same site with Netscape didn't give me that problem. First I thought this was some PHP issue (before I tested it with Netscape), but after searching a lot on the internet I found the problem.
<br />
Since I was using name based virtual hosting for my testserver and we have different webshops for different customers I used the syntax webshop_customername.servername.nl as the domain-name.
<br />
The _ in the domain name seemed to be the problem. Internet Explorer just denies setting the cookie on the client when there is a special character (like an _ ) in the domain name. For more information regarding this issue: <a href="http://support.microsoft.com/default.aspx?scid=kb;EN-US;316112 " rel="nofollow" target="_blank">http://support.microsoft.com/default.aspx?scid=kb;EN-US;316112 </a>
<br />
Stupidly enough, this information was related to asp (yuk :o)</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
</div>
</div>
</div></div></body></html>
