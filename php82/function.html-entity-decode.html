<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
 <head>
  <meta http-equiv="content-type" content="text/html; CHARSET=UTF-8">
  <title>Convert HTML entities to their corresponding characters</title>
<link media="all" rel="stylesheet" type="text/css" href="styles/03e73060321a0a848018724a6c83de7f-theme-base.css" />
<link media="all" rel="stylesheet" type="text/css" href="styles/03e73060321a0a848018724a6c83de7f-theme-medium.css" />

  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <link media="all" rel="stylesheet" type="text/css" href="style.css"/>
 </head>
 <body class="docs" class="docs"><div class="navbar navbar-fixed-top">
  <div class="navbar-inner clearfix">
    <ul class="nav" style="width: 100%">
      <li style="float: left;"><a href="function.hex2bin.html">? hex2bin</a></li>
      <li style="float: right;"><a href="function.htmlentities.html">htmlentities ?</a></li>
    </ul>
  </div>
</div>
<div id="breadcrumbs" class="clearfix">
  <ul class="breadcrumbs-container">
    <li><a href="index.html">PHP Manual</a></li>
    <li><a href="ref.strings.html">字符串 函数</a></li>
    <li>Convert HTML entities to their corresponding characters</li>
  </ul>
</div>
<div id="layout">
  <div id="layout-content"><div id="function.html-entity-decode" class="refentry">
 <div class="refnamediv">
  <h1 class="refname">html_entity_decode</h1>
  <p class="verinfo">(PHP 4 &gt;= 4.3.0, PHP 5, PHP 7, PHP 8)</p><p class="refpurpose"><span class="refname">html_entity_decode</span> &mdash; <span class="dc-title">Convert HTML entities to their corresponding characters</span></p>

 </div>
 
 <div class="refsect1 description" id="refsect1-function.html-entity-decode-description">
  <h3 class="title">说明</h3>
  <div class="methodsynopsis dc-description">
   <span class="methodname"><strong>html_entity_decode</strong></span>(<span class="methodparam"><span class="type">string</span> <code class="parameter">$string</code></span>, <span class="methodparam"><span class="type">int</span> <code class="parameter">$flags</code><span class="initializer"> = ENT_QUOTES | ENT_SUBSTITUTE | ENT_HTML401</span></span>, <span class="methodparam"><span class="type">?</span><span class="type"><span class="type">string</span><span class="type"></span></span> <code class="parameter">$encoding</code><span class="initializer"> = <strong><code>null</code></strong></span></span>): <span class="type">string</span></div>

  <p class="para rdfs-comment">
   <span class="function"><strong>html_entity_decode()</strong></span> is the opposite of
   <span class="function"><a href="function.htmlentities.html" class="function">htmlentities()</a></span> in that it converts HTML entities
   in the <code class="parameter">string</code> to their corresponding characters.
  </p>
  <p class="para">
   More precisely, this function decodes all the entities (including all numeric
   entities) that a) are necessarily valid for the chosen document type &mdash; i.e.,
   for XML, this function does not decode named entities that might be defined
   in some DTD &mdash; and b) whose character or characters are in the coded character
   set associated with the chosen encoding and are permitted in the chosen
   document type. All other entities are left as is.
  </p>
 </div>


 <div class="refsect1 parameters" id="refsect1-function.html-entity-decode-parameters">
  <h3 class="title">参数</h3>
  <p class="para">
   <dl>
    
     <dt>
<code class="parameter">string</code></dt>

     <dd>

      <p class="para">
       The input string.
      </p>
     </dd>

    
    
     <dt>
<code class="parameter">flags</code></dt>

     <dd>

      <p class="para">
       A bitmask of one or more of the following flags, which specify how to handle quotes and
       which document type to use. The default is <code class="literal">ENT_QUOTES | ENT_SUBSTITUTE | ENT_HTML401</code>.
       <table class="doctable table">
        <caption><strong>Available <code class="parameter">flags</code> constants</strong></caption>
        
         <thead>
          <tr>
           <th>Constant Name</th>
           <th>Description</th>
          </tr>

         </thead>

         <tbody class="tbody">
          <tr>
           <td><strong><code>ENT_COMPAT</code></strong></td>
           <td>Will convert double-quotes and leave single-quotes alone.</td>
          </tr>

          <tr>
           <td><strong><code>ENT_QUOTES</code></strong></td>
           <td>Will convert both double and single quotes.</td>
          </tr>

          <tr>
           <td><strong><code>ENT_NOQUOTES</code></strong></td>
           <td>Will leave both double and single quotes unconverted.</td>
          </tr>

          <tr>
           <td><strong><code>ENT_SUBSTITUTE</code></strong></td>
           <td>
            Replace invalid code unit sequences with a Unicode Replacement Character
            U+FFFD (UTF-8) or &amp;#xFFFD; (otherwise) instead of returning an empty string.
           </td>
          </tr>

          <tr>
           <td><strong><code>ENT_HTML401</code></strong></td>
           <td>
            Handle code as HTML 4.01.
           </td>
          </tr>

          <tr>
           <td><strong><code>ENT_XML1</code></strong></td>
           <td>
            Handle code as XML 1.
           </td>
          </tr>

          <tr>
           <td><strong><code>ENT_XHTML</code></strong></td>
           <td>
            Handle code as XHTML.
           </td>
          </tr>

          <tr>
           <td><strong><code>ENT_HTML5</code></strong></td>
           <td>
            Handle code as HTML 5.
           </td>
          </tr>

         </tbody>
        
       </table>

      </p>
     </dd>

    
    
     <dt>
<code class="parameter">encoding</code></dt>

     <dd>

      
 <p class="para">
  An optional argument defining the encoding used when converting characters.
 </p>

 <p class="para">
  If omitted, <code class="parameter">encoding</code> defaults to the value of the
  <a href="ini.core.html#ini.default-charset" class="link">default_charset</a> configuration
  option.
 </p>

 <p class="para">
  Although this argument is technically optional, you are highly encouraged to
  specify the correct value for your code
  if the <a href="ini.core.html#ini.default-charset" class="link">default_charset</a>
  configuration option may be set incorrectly for the given input.
 </p>

      


<p class="para">
 支持以下字符集：
 <table class="doctable table">
  <caption><strong>支持的字符集列表</strong></caption>
  
   <thead>
    <tr>
     <th>字符集</th>
     <th>别名</th>
     <th>描述</th>
    </tr>

   </thead>

   <tbody class="tbody">
    <tr>
     <td>ISO-8859-1</td>
     <td>ISO8859-1</td>
     <td>
      西欧，Latin-1
     </td>
    </tr>

    <tr>
     <td>ISO-8859-5</td>
     <td>ISO8859-5</td>
     <td>
      Little used cyrillic charset (Latin/Cyrillic).
     </td>
    </tr>

    <tr>
     <td>ISO-8859-15</td>
     <td>ISO8859-15</td>
     <td>
      西欧，Latin-9。增加欧元符号，法语和芬兰语字母在 Latin-1(ISO-8859-1) 中缺失。
     </td>
    </tr>

    <tr>
     <td>UTF-8</td>
     <td class="empty">&nbsp;</td>
     <td>
      ASCII 兼容的多字节 8 位 Unicode。
     </td>
    </tr>

    <tr>
     <td>cp866</td>
     <td>ibm866, 866</td>
     <td>
      DOS 特有的西里尔编码。本字符集在 4.3.2 版本中得到支持。
     </td>
    </tr>

    <tr>
     <td>cp1251</td>
     <td>Windows-1251, win-1251, 1251</td>
     <td>
      Windows 特有的西里尔编码。本字符集在 4.3.2 版本中得到支持。
     </td>
    </tr>

    <tr>
     <td>cp1252</td>
     <td>Windows-1252, 1252</td>
     <td>
      Windows 特有的西欧编码。
     </td>
    </tr>

    <tr>
     <td>KOI8-R</td>
     <td>koi8-ru, koi8r</td>
     <td>
      俄语。本字符集在 4.3.2 版本中得到支持。
     </td>
    </tr>

    <tr>
     <td>BIG5</td>
     <td>950</td>
     <td>
      繁体中文，主要用于中国台湾省。
     </td>
    </tr>

    <tr>
     <td>GB2312</td>
     <td>936</td>
     <td>
      简体中文，中国国家标准字符集。
     </td>
    </tr>

    <tr>
     <td>BIG5-HKSCS</td>
     <td class="empty">&nbsp;</td>
     <td>
      繁体中文，附带香港扩展的 Big5 字符集。
     </td>
    </tr>

    <tr>
     <td>Shift_JIS</td>
     <td>SJIS, 932</td>
     <td>
      日语
     </td>
    </tr>

    <tr>
     <td>EUC-JP</td>
     <td>EUCJP</td>
     <td>
      日语
     </td>
    </tr>

    <tr>
     <td>MacRoman</td>
     <td class="empty">&nbsp;</td>
     <td>
      Mac OS 使用的字符串。
     </td>
    </tr>

    <tr>
     <td><code class="literal">&#039;&#039;</code></td>
     <td class="empty">&nbsp;</td>
     <td>
      An empty string activates detection from script encoding (Zend multibyte),
      <a href="ini.core.html#ini.default-charset" class="link">default_charset</a> and current
      locale (see <span class="function"><a href="function.nl-langinfo.html" class="function">nl_langinfo()</a></span> and
      <span class="function"><a href="function.setlocale.html" class="function">setlocale()</a></span>), in this order. Not recommended.
     </td>
    </tr>

   </tbody>
  
 </table>

 <blockquote class="note"><p><strong class="note">Note</strong>: 
  <span class="simpara">
   其他字符集没有认可。将会使用默认编码并抛出异常。
  </span>
 </p></blockquote>
</p>


     </dd>

    
   </dl>

  </p>
 </div>


 <div class="refsect1 returnvalues" id="refsect1-function.html-entity-decode-returnvalues">
  <h3 class="title">返回值</h3>
  <p class="para">
   Returns the decoded string.
  </p>
 </div>


 <div class="refsect1 changelog" id="refsect1-function.html-entity-decode-changelog">
  <h3 class="title">更新日志</h3>
  <table class="doctable informaltable">
   
    <thead>
     <tr>
      <th>版本</th>
      <th>说明</th>
     </tr>

    </thead>

    <tbody class="tbody">
     <tr>
      <td>8.1.0</td>
      <td>
       <code class="parameter">flags</code> changed from <strong><code>ENT_COMPAT</code></strong> to <strong><code>ENT_QUOTES</code></strong> | <strong><code>ENT_SUBSTITUTE</code></strong> | <strong><code>ENT_HTML401</code></strong>.
      </td>
     </tr>

     <tr>
      <td>8.0.0</td>
      <td>
       <code class="parameter">encoding</code> is nullable now.
      </td>
     </tr>

    </tbody>
   
  </table>

 </div>


 <div class="refsect1 examples" id="refsect1-function.html-entity-decode-examples">
  <h3 class="title">示例</h3>
  <p class="para">
   <div class="example" id="">
    <p><strong>Example #1 Decoding HTML entities</strong></p>
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br />$orig </span><span style="color: #007700">= </span><span style="color: #DD0000">"I'll \"walk\" the &lt;b&gt;dog&lt;/b&gt; now"</span><span style="color: #007700">;<br /><br /></span><span style="color: #0000BB">$a </span><span style="color: #007700">= </span><span style="color: #0000BB">htmlentities</span><span style="color: #007700">(</span><span style="color: #0000BB">$orig</span><span style="color: #007700">);<br /><br /></span><span style="color: #0000BB">$b </span><span style="color: #007700">= </span><span style="color: #0000BB">html_entity_decode</span><span style="color: #007700">(</span><span style="color: #0000BB">$a</span><span style="color: #007700">);<br /><br />echo </span><span style="color: #0000BB">$a</span><span style="color: #007700">; </span><span style="color: #FF8000">// I'll &amp;quot;walk&amp;quot; the &amp;lt;b&amp;gt;dog&amp;lt;/b&amp;gt; now<br /><br /></span><span style="color: #007700">echo </span><span style="color: #0000BB">$b</span><span style="color: #007700">; </span><span style="color: #FF8000">// I'll "walk" the &lt;b&gt;dog&lt;/b&gt; now<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
    </div>

   </div>   
  </p>
 </div>


 <div class="refsect1 notes" id="refsect1-function.html-entity-decode-notes">
  <h3 class="title">注释</h3>
  <blockquote class="note"><p><strong class="note">Note</strong>: 
   <p class="para">
    You might wonder why trim(html_entity_decode(&#039;&amp;nbsp;&#039;)); doesn&#039;t
    reduce the string to an empty string, that&#039;s because the &#039;&amp;nbsp;&#039;
    entity is not ASCII code 32 (which is stripped by
    <span class="function"><a href="function.trim.html" class="function">trim()</a></span>) but ASCII code 160 (0xa0) in the default ISO
    8859-1 encoding.
   </p>
  </p></blockquote>
 </div>


 <div class="refsect1 seealso" id="refsect1-function.html-entity-decode-seealso">
  <h3 class="title">参见</h3>
  <p class="para">
   <ul class="simplelist">
    <li class="member"><span class="function"><a href="function.htmlentities.html" class="function" rel="rdfs-seeAlso">htmlentities()</a> - 将字符转换为 HTML 转义字符</span></li>
    <li class="member"><span class="function"><a href="function.htmlspecialchars.html" class="function" rel="rdfs-seeAlso">htmlspecialchars()</a> - 将特殊字符转换为 HTML 实体</span></li>
    <li class="member"><span class="function"><a href="function.get-html-translation-table.html" class="function" rel="rdfs-seeAlso">get_html_translation_table()</a> - 返回使用 htmlspecialchars 和 htmlentities 后的转换表</span></li>
    <li class="member"><span class="function"><a href="function.urldecode.html" class="function" rel="rdfs-seeAlso">urldecode()</a> - 解码已编码的 URL 字符串</span></li>
   </ul>
  </p>
 </div>


</div><div id="usernotes">
 <div class="head">
  <h3 class="title">User Contributed Notes</h3>
 </div>
<div id="allnotes">  <a name="125870""></a>
  <div class="note">
   <strong class="user">Anonymous</strong>
   <a href="#125870" class="date">01-Mar-2021 03:30</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Why doesn't the html_entity_decode() function convert entities without the last semicolon (like &amp;#x41 or &amp;#65) to characters? <br />
<br />
---<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">echo </span><span class="string">'like &amp;#x41 or &amp;#65'</span><span class="keyword">;<br />
---<br />
<br />
</span><span class="default">Browser displays fine</span><span class="keyword">:<br />
----<br />
</span><span class="default">like A </span><span class="keyword">or </span><span class="default">A</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="123004""></a>
  <div class="note">
   <strong class="user">Daniel A.</strong>
   <a href="#123004" class="date">03-Aug-2018 03:34</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I wanted to use this function today and I found the documentation, especially about the flags, not particularly helpful.<br />
<br />
Running the code below, for example, failed because the flag I used was the wrong one...<br />
<br />
$string = 'Donna&amp;#039;s Bakery';<br />
$title = html_entity_decode($string, ENT_HTML401, 'UTF-8');<br />
echo $title;<br />
<br />
The correct flag to use in this case is ENT_QUOTES.<br />
<br />
My understanding of the flag to use is the one that would correspond to the expected, converted outcome. So, ENT_QUOTES for a character that would be a single or double quote when converted... and so on.<br />
<br />
Please help make the documentation a bit clearer.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="120005""></a>
  <div class="note">
   <strong class="user">slickriptide at gmail dot com</strong>
   <a href="#120005" class="date">07-Oct-2016 03:54</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
When using this function, it's a good idea to pay attention when it says that leaving the charset parameter empty is "not recommended". <br />
<br />
I had an issue where I was storing text files, with entities converted, into a database. When I retrieved them later and ran<br />
<br />
$text_file = html_entity_decode($text_data);<br />
<br />
the entities were NOT decoded.<br />
<br />
Once I was aware of the problem, I changed the decode call to fully specify all of the parameters:<br />
<br />
$text_file = html_entity_decode($text_data, ENT_COMPAT | ENT_HTML5,'utf-8');<br />
<br />
This converted the entities as expected.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="117876""></a>
  <div class="note">
   <strong class="user">txnull</strong>
   <a href="#117876" class="date">25-Aug-2015 08:06</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Use the following to decode all entities:<br />
<span class="default">&lt;?php html_entity_decode</span><span class="keyword">(</span><span class="default">$string</span><span class="keyword">, </span><span class="default">ENT_QUOTES </span><span class="keyword">| </span><span class="default">ENT_XML1</span><span class="keyword">, </span><span class="string">'UTF-8'</span><span class="keyword">) </span><span class="default">?&gt;<br />
</span><br />
I've checked these special entities: <br />
- double quotes (&amp;#34;)<br />
- single quotes (&amp;#39; and &amp;apos;) <br />
- non printable chars (e.g. &amp;#13;)<br />
With other $flags some or all won't be decoded.<br />
<br />
It seems that ENT_XML1 and ENT_XHTML are identical when decoding.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="111859""></a>
  <div class="note">
   <strong class="user">Benjamin</strong>
   <a href="#111859" class="date">05-Apr-2013 11:07</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
The following function decodes named and numeric HTML entities and works on UTF-8. Requires iconv.<br />
<br />
function decodeHtmlEnt($str) {<br />
&nbsp;&nbsp;&nbsp; $ret = html_entity_decode($str, ENT_COMPAT, 'UTF-8');<br />
&nbsp;&nbsp;&nbsp; $p2 = -1;<br />
&nbsp;&nbsp;&nbsp; for(;;) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $p = strpos($ret, '&amp;#', $p2+1);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if ($p === FALSE)<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; break;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $p2 = strpos($ret, ';', $p);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if ($p2 === FALSE)<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; break;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (substr($ret, $p+2, 1) == 'x')<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $char = hexdec(substr($ret, $p+3, $p2-$p-3));<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; else<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $char = intval(substr($ret, $p+2, $p2-$p-2));<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; //echo "$char\n";<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $newchar = iconv(<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; 'UCS-4', 'UTF-8',<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; chr(($char&gt;&gt;24)&amp;0xFF).chr(($char&gt;&gt;16)&amp;0xFF).chr(($char&gt;&gt;8)&amp;0xFF).chr($char&amp;0xFF) <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; );<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; //echo "$newchar&lt;$p&lt;$p2&lt;&lt;\n";<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $ret = substr_replace($ret, $newchar, $p, 1+$p2-$p);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $p2 = $p + strlen($newchar);<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; return $ret;<br />
}</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="106871""></a>
  <div class="note">
   <strong class="user">Victor</strong>
   <a href="#106871" class="date">14-Dec-2011 06:22</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
We were having very peculiar behavior regarding foreign characters such as e-acute.<br />
<br />
However, it was only showing up as a problem when extracting those characters out of our mysql database and when being displayed through a proxy server of ours that handles dns issues.<br />
<br />
As other users have made a note of, the default character setting wasn't what they were expecting it to be when they left theirs blank.<br />
<br />
When we changed our default_charset to "UTF-8", our problems and needs for using functions like these were no longer necessary in handling foreign characters such as e-acute. Good enough for us!</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="104617""></a>
  <div class="note">
   <strong class="user">Martin</strong>
   <a href="#104617" class="date">26-Jun-2011 04:37</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you need something that converts &amp;#[0-9]+ entities to UTF-8, this is simple and works:
<br />

<br />
<span class="default">&lt;?php
<br />
</span><span class="comment">/* Entity crap. /
<br />
$input = "Fovi&amp;#269;";
<br />

<br />
$output = preg_replace_callback("/(&amp;#[0-9]+;)/", function($m) { return mb_convert_encoding($m[1], "UTF-8", "HTML-ENTITIES"); }, $input);
<br />

<br />
/* Plain UTF-8. */
<br />
</span><span class="keyword">echo </span><span class="default">$output</span><span class="keyword">;
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="99322""></a>
  <div class="note">
   <strong class="user">neurotic dot neu at gmail dot com</strong>
   <a href="#99322" class="date">10-Aug-2010 12:25</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
This is a safe rawurldecode with utf8 detection:
<br />

<br />
<span class="default">&lt;?php
<br />
</span><span class="keyword">function </span><span class="default">utf8_rawurldecode</span><span class="keyword">(</span><span class="default">$raw_url_encoded</span><span class="keyword">){
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$enc </span><span class="keyword">= </span><span class="default">rawurldecode</span><span class="keyword">(</span><span class="default">$raw_url_encoded</span><span class="keyword">);
<br />
&nbsp;&nbsp;&nbsp; if(</span><span class="default">utf8_encode</span><span class="keyword">(</span><span class="default">utf8_decode</span><span class="keyword">(</span><span class="default">$enc</span><span class="keyword">))==</span><span class="default">$enc</span><span class="keyword">){;
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">rawurldecode</span><span class="keyword">(</span><span class="default">$raw_url_encoded</span><span class="keyword">);
<br />
&nbsp;&nbsp;&nbsp; }else{
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">utf8_encode</span><span class="keyword">(</span><span class="default">rawurldecode</span><span class="keyword">(</span><span class="default">$raw_url_encoded</span><span class="keyword">));
<br />
&nbsp;&nbsp;&nbsp; }
<br />
}
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="98697""></a>
  <div class="note">
   <strong class="user">Free at Key dot no</strong>
   <a href="#98697" class="date">01-Jul-2010 05:51</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Handy function to convert remaining HTML-entities into human readable chars (for entities which do not exist in target charset):
<br />

<br />
<span class="default">&lt;?php
<br />
</span><span class="keyword">function </span><span class="default">cleanString</span><span class="keyword">(</span><span class="default">$in</span><span class="keyword">,</span><span class="default">$offset</span><span class="keyword">=</span><span class="default">null</span><span class="keyword">)
<br />
{
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$out </span><span class="keyword">= </span><span class="default">trim</span><span class="keyword">(</span><span class="default">$in</span><span class="keyword">);
<br />
&nbsp;&nbsp;&nbsp; if (!empty(</span><span class="default">$out</span><span class="keyword">))
<br />
&nbsp;&nbsp;&nbsp; {
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$entity_start </span><span class="keyword">= </span><span class="default">strpos</span><span class="keyword">(</span><span class="default">$out</span><span class="keyword">,</span><span class="string">'&amp;'</span><span class="keyword">,</span><span class="default">$offset</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">$entity_start </span><span class="keyword">=== </span><span class="default">false</span><span class="keyword">)
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// ideal
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">return </span><span class="default">$out</span><span class="keyword">;&nbsp; &nbsp; 
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; else
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$entity_end </span><span class="keyword">= </span><span class="default">strpos</span><span class="keyword">(</span><span class="default">$out</span><span class="keyword">,</span><span class="string">';'</span><span class="keyword">,</span><span class="default">$entity_start</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">$entity_end </span><span class="keyword">=== </span><span class="default">false</span><span class="keyword">)
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return </span><span class="default">$out</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// zu lang um eine entity zu sein
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">else if (</span><span class="default">$entity_end </span><span class="keyword">&gt; </span><span class="default">$entity_start</span><span class="keyword">+</span><span class="default">7</span><span class="keyword">)
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">// und weiter gehts
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$out </span><span class="keyword">= </span><span class="default">cleanString</span><span class="keyword">(</span><span class="default">$out</span><span class="keyword">,</span><span class="default">$entity_start</span><span class="keyword">+</span><span class="default">1</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// gottcha!
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">else
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$clean </span><span class="keyword">= </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$out</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">$entity_start</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$subst </span><span class="keyword">= </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$out</span><span class="keyword">,</span><span class="default">$entity_start</span><span class="keyword">+</span><span class="default">1</span><span class="keyword">,</span><span class="default">1</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">// &amp;scaron; =&gt; "s" / &amp;#353; =&gt; "_"
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$clean </span><span class="keyword">.= (</span><span class="default">$subst </span><span class="keyword">!= </span><span class="string">"#"</span><span class="keyword">) ? </span><span class="default">$subst </span><span class="keyword">: </span><span class="string">"_"</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$clean </span><span class="keyword">.= </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$out</span><span class="keyword">,</span><span class="default">$entity_end</span><span class="keyword">+</span><span class="default">1</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">// und weiter gehts
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$out </span><span class="keyword">= </span><span class="default">cleanString</span><span class="keyword">(</span><span class="default">$clean</span><span class="keyword">,</span><span class="default">$entity_start</span><span class="keyword">+</span><span class="default">1</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }
<br />
&nbsp;&nbsp;&nbsp; }
<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">$out</span><span class="keyword">;
<br />
}
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="93378""></a>
  <div class="note">
   <strong class="user">Matt Robinson</strong>
   <a href="#93378" class="date">06-Sep-2009 02:11</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I wrote in a previous comment that html_entity_decode() only handled about 100 characters. That's not quite true; it only handles entities that exist in the output character set (the third argument). If you want to get ALL HTML entities, make sure you use ENT_QUOTES and set the third argument to 'UTF-8'. <br />
<br />
If you don't want a UTF-8 string, you'll need to convert it afterward with something like utf8_decode(), iconv(), or mb_convert_encoding(). <br />
<br />
If you're producing XML, which doesn't recognise most HTML entities:<br />
<br />
When producing a UTF-8 document (the default), then htmlspecialchars(html_entity_decode($string, ENT_QUOTES, 'UTF-8'), ENT_NOQUOTES, 'UTF-8') (because you only need to escape &lt; and &gt; and &amp; unless you're printing inside the XML tags themselves).<br />
<br />
Otherwise, either convert all the named entities to numeric ones, or declare the named entities in the document's DTD. The full list of 252 entities can be found in the HTML 4.01 Spec, or you can cut and paste the function from my site (<a href="http://inanimatt.com/php-convert-entities.php" rel="nofollow" target="_blank">http://inanimatt.com/php-convert-entities.php</a>).</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="89483""></a>
  <div class="note">
   <strong class="user">marion at figmentthinking dot com</strong>
   <a href="#89483" class="date">10-Mar-2009 05:11</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I just ran into the:
<br />
Bug #27626 html_entity_decode bug - cannot yet handle MBCS in html_entity_decode()!
<br />

<br />
The simple solution if you're still running PHP 4 is to wrap the html_entity_decode() function with the utf8_decode() function.
<br />

<br />
<span class="default">&lt;?php
<br />
$string </span><span class="keyword">= </span><span class="string">'&amp;nbsp;'</span><span class="keyword">;
<br />
</span><span class="default">$utf8_encode </span><span class="keyword">= </span><span class="default">utf8_encode</span><span class="keyword">(</span><span class="default">html_entity_decode</span><span class="keyword">(</span><span class="default">$string</span><span class="keyword">));
<br />
</span><span class="default">?&gt;
<br />
</span>
<br />
By default html_entity_decode() returns the ISO-8859-1 character set, and by default utf8_decode()...
<br />

<br />
<a href="http://us.php.net/manual/en/function.utf8-decode.php" rel="nofollow" target="_blank">http://us.php.net/manual/en/function.utf8-decode.php</a>
<br />
"Converts a string with ISO-8859-1 characters encoded with UTF-8 to single-byte ISO-8859-1"</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="89371""></a>
  <div class="note">
   <strong class="user">jl dot garcia at gmail dot com</strong>
   <a href="#89371" class="date">04-Mar-2009 03:33</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I created this function to filter all the text that goes in or comes out of the database.
<br />

<br />
<span class="default">&lt;?php
<br />
</span><span class="keyword">function </span><span class="default">filter_string</span><span class="keyword">(</span><span class="default">$string</span><span class="keyword">, </span><span class="default">$nohtml</span><span class="keyword">=</span><span class="string">''</span><span class="keyword">, </span><span class="default">$save</span><span class="keyword">=</span><span class="string">''</span><span class="keyword">) {
<br />
&nbsp;&nbsp;&nbsp; if(!empty(</span><span class="default">$nohtml</span><span class="keyword">)) {
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$string </span><span class="keyword">= </span><span class="default">trim</span><span class="keyword">(</span><span class="default">$string</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if(!empty(</span><span class="default">$save</span><span class="keyword">)) </span><span class="default">$string </span><span class="keyword">= </span><span class="default">htmlentities</span><span class="keyword">(</span><span class="default">trim</span><span class="keyword">(</span><span class="default">$string</span><span class="keyword">), </span><span class="default">ENT_QUOTES</span><span class="keyword">, </span><span class="string">'ISO-8859-15'</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; else </span><span class="default">$string </span><span class="keyword">= </span><span class="default">html_entity_decode</span><span class="keyword">(</span><span class="default">$string</span><span class="keyword">, </span><span class="default">ENT_QUOTES</span><span class="keyword">, </span><span class="string">'ISO-8859-15'</span><span class="keyword">);
<br />
&nbsp;&nbsp;&nbsp; }
<br />
&nbsp;&nbsp;&nbsp; if(!empty(</span><span class="default">$save</span><span class="keyword">)) </span><span class="default">$string </span><span class="keyword">= </span><span class="default">mysql_real_escape_string</span><span class="keyword">(</span><span class="default">$string</span><span class="keyword">);
<br />
&nbsp;&nbsp;&nbsp; else </span><span class="default">$string </span><span class="keyword">= </span><span class="default">stripslashes</span><span class="keyword">(</span><span class="default">$string</span><span class="keyword">);
<br />
&nbsp;&nbsp;&nbsp; return(</span><span class="default">$string</span><span class="keyword">);
<br />
}
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="83089""></a>
  <div class="note">
   <strong class="user">kae at verens dot com</strong>
   <a href="#83089" class="date">09-May-2008 06:11</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
the references to 'chr()' in the example unhtmlentities() function should be changed to unichr, using the example unichr() function described in the 'chr' reference (<a href="http://php.net/chr" rel="nofollow" target="_blank">http://php.net/chr</a>).<br />
<br />
the reason for this is characters such as &amp;#x20AC; which do not break down into an ASCII number (that's the Euro, by the way).</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="80539""></a>
  <div class="note">
   <strong class="user">me at richardsnazell dot com</strong>
   <a href="#80539" class="date">21-Jan-2008 04:19</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I had a problem getting the 'TM' trademark symbol to display correctly in an email subject line. Using html_entity_decode() with different charsets didn't work, but directly replacing the entity with it's ASCII equivalent did:<br />
<br />
$subject = str_replace('&amp;trade;', chr(153), $subject);</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="70921""></a>
  <div class="note">
   <strong class="user">jojo</strong>
   <a href="#70921" class="date">03-Nov-2006 08:27</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
The decipherment does the character encoded by the escape function of JavaScript. 
<br />
When the multi byte is used on the page, it is effective. 
<br />

<br />
javascript escape('aaああaa') ..... 'aa%u3042%u3042aa'
<br />
php&nbsp; jsEscape_decode('aa%u3042%u3042aa')..'aaああaa'
<br />

<br />
<span class="default">&lt;?php
<br />
</span><span class="keyword">function </span><span class="default">jsEscape_decode</span><span class="keyword">(</span><span class="default">$jsEscaped</span><span class="keyword">,</span><span class="default">$outCharCode</span><span class="keyword">=</span><span class="string">'SJIS'</span><span class="keyword">){
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$arrMojis </span><span class="keyword">= </span><span class="default">explode</span><span class="keyword">(</span><span class="string">"%u"</span><span class="keyword">,</span><span class="default">$jsEscaped</span><span class="keyword">);
<br />
&nbsp;&nbsp;&nbsp; for (</span><span class="default">$i </span><span class="keyword">= </span><span class="default">1</span><span class="keyword">;</span><span class="default">$i </span><span class="keyword">&lt; </span><span class="default">count</span><span class="keyword">(</span><span class="default">$arrMojis</span><span class="keyword">);</span><span class="default">$i</span><span class="keyword">++){
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$c </span><span class="keyword">= </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$arrMojis</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">],</span><span class="default">0</span><span class="keyword">,</span><span class="default">4</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$cc </span><span class="keyword">= </span><span class="default">mb_convert_encoding</span><span class="keyword">(</span><span class="default">pack</span><span class="keyword">(</span><span class="string">'H*'</span><span class="keyword">,</span><span class="default">$c</span><span class="keyword">),</span><span class="default">$outCharCode</span><span class="keyword">,</span><span class="string">'UTF-16'</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$arrMojis</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">] = </span><span class="default">substr_replace</span><span class="keyword">(</span><span class="default">$arrMojis</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">],</span><span class="default">$cc</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">4</span><span class="keyword">);
<br />
&nbsp;&nbsp;&nbsp; }
<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">implode</span><span class="keyword">(</span><span class="string">''</span><span class="keyword">,</span><span class="default">$arrMojis</span><span class="keyword">);
<br />
}
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="68491""></a>
  <div class="note">
   <strong class="user">grvg (at) free (dot) fr</strong>
   <a href="#68491" class="date">29-Jul-2006 09:44</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Here is the ultimate functions to convert HTML entities to UTF-8&nbsp;:
<br />
The main function is&nbsp;htmlentities2utf8
<br />
Others are helper functions
<br />

<br />
<span class="default">&lt;?php
<br />
</span><span class="keyword">function </span><span class="default">chr_utf8</span><span class="keyword">(</span><span class="default">$code</span><span class="keyword">)
<br />
&nbsp;&nbsp;&nbsp; {
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">$code </span><span class="keyword">&lt; </span><span class="default">0</span><span class="keyword">) return </span><span class="default">false</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; elseif (</span><span class="default">$code </span><span class="keyword">&lt; </span><span class="default">128</span><span class="keyword">) return </span><span class="default">chr</span><span class="keyword">(</span><span class="default">$code</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; elseif (</span><span class="default">$code </span><span class="keyword">&lt; </span><span class="default">160</span><span class="keyword">) </span><span class="comment">// Remove Windows Illegals Cars
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">{
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">$code</span><span class="keyword">==</span><span class="default">128</span><span class="keyword">) </span><span class="default">$code</span><span class="keyword">=</span><span class="default">8364</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; elseif (</span><span class="default">$code</span><span class="keyword">==</span><span class="default">129</span><span class="keyword">) </span><span class="default">$code</span><span class="keyword">=</span><span class="default">160</span><span class="keyword">; </span><span class="comment">// not affected
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">elseif (</span><span class="default">$code</span><span class="keyword">==</span><span class="default">130</span><span class="keyword">) </span><span class="default">$code</span><span class="keyword">=</span><span class="default">8218</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; elseif (</span><span class="default">$code</span><span class="keyword">==</span><span class="default">131</span><span class="keyword">) </span><span class="default">$code</span><span class="keyword">=</span><span class="default">402</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; elseif (</span><span class="default">$code</span><span class="keyword">==</span><span class="default">132</span><span class="keyword">) </span><span class="default">$code</span><span class="keyword">=</span><span class="default">8222</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; elseif (</span><span class="default">$code</span><span class="keyword">==</span><span class="default">133</span><span class="keyword">) </span><span class="default">$code</span><span class="keyword">=</span><span class="default">8230</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; elseif (</span><span class="default">$code</span><span class="keyword">==</span><span class="default">134</span><span class="keyword">) </span><span class="default">$code</span><span class="keyword">=</span><span class="default">8224</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; elseif (</span><span class="default">$code</span><span class="keyword">==</span><span class="default">135</span><span class="keyword">) </span><span class="default">$code</span><span class="keyword">=</span><span class="default">8225</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; elseif (</span><span class="default">$code</span><span class="keyword">==</span><span class="default">136</span><span class="keyword">) </span><span class="default">$code</span><span class="keyword">=</span><span class="default">710</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; elseif (</span><span class="default">$code</span><span class="keyword">==</span><span class="default">137</span><span class="keyword">) </span><span class="default">$code</span><span class="keyword">=</span><span class="default">8240</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; elseif (</span><span class="default">$code</span><span class="keyword">==</span><span class="default">138</span><span class="keyword">) </span><span class="default">$code</span><span class="keyword">=</span><span class="default">352</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; elseif (</span><span class="default">$code</span><span class="keyword">==</span><span class="default">139</span><span class="keyword">) </span><span class="default">$code</span><span class="keyword">=</span><span class="default">8249</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; elseif (</span><span class="default">$code</span><span class="keyword">==</span><span class="default">140</span><span class="keyword">) </span><span class="default">$code</span><span class="keyword">=</span><span class="default">338</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; elseif (</span><span class="default">$code</span><span class="keyword">==</span><span class="default">141</span><span class="keyword">) </span><span class="default">$code</span><span class="keyword">=</span><span class="default">160</span><span class="keyword">; </span><span class="comment">// not affected
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">elseif (</span><span class="default">$code</span><span class="keyword">==</span><span class="default">142</span><span class="keyword">) </span><span class="default">$code</span><span class="keyword">=</span><span class="default">381</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; elseif (</span><span class="default">$code</span><span class="keyword">==</span><span class="default">143</span><span class="keyword">) </span><span class="default">$code</span><span class="keyword">=</span><span class="default">160</span><span class="keyword">; </span><span class="comment">// not affected
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">elseif (</span><span class="default">$code</span><span class="keyword">==</span><span class="default">144</span><span class="keyword">) </span><span class="default">$code</span><span class="keyword">=</span><span class="default">160</span><span class="keyword">; </span><span class="comment">// not affected
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">elseif (</span><span class="default">$code</span><span class="keyword">==</span><span class="default">145</span><span class="keyword">) </span><span class="default">$code</span><span class="keyword">=</span><span class="default">8216</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; elseif (</span><span class="default">$code</span><span class="keyword">==</span><span class="default">146</span><span class="keyword">) </span><span class="default">$code</span><span class="keyword">=</span><span class="default">8217</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; elseif (</span><span class="default">$code</span><span class="keyword">==</span><span class="default">147</span><span class="keyword">) </span><span class="default">$code</span><span class="keyword">=</span><span class="default">8220</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; elseif (</span><span class="default">$code</span><span class="keyword">==</span><span class="default">148</span><span class="keyword">) </span><span class="default">$code</span><span class="keyword">=</span><span class="default">8221</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; elseif (</span><span class="default">$code</span><span class="keyword">==</span><span class="default">149</span><span class="keyword">) </span><span class="default">$code</span><span class="keyword">=</span><span class="default">8226</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; elseif (</span><span class="default">$code</span><span class="keyword">==</span><span class="default">150</span><span class="keyword">) </span><span class="default">$code</span><span class="keyword">=</span><span class="default">8211</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; elseif (</span><span class="default">$code</span><span class="keyword">==</span><span class="default">151</span><span class="keyword">) </span><span class="default">$code</span><span class="keyword">=</span><span class="default">8212</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; elseif (</span><span class="default">$code</span><span class="keyword">==</span><span class="default">152</span><span class="keyword">) </span><span class="default">$code</span><span class="keyword">=</span><span class="default">732</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; elseif (</span><span class="default">$code</span><span class="keyword">==</span><span class="default">153</span><span class="keyword">) </span><span class="default">$code</span><span class="keyword">=</span><span class="default">8482</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; elseif (</span><span class="default">$code</span><span class="keyword">==</span><span class="default">154</span><span class="keyword">) </span><span class="default">$code</span><span class="keyword">=</span><span class="default">353</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; elseif (</span><span class="default">$code</span><span class="keyword">==</span><span class="default">155</span><span class="keyword">) </span><span class="default">$code</span><span class="keyword">=</span><span class="default">8250</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; elseif (</span><span class="default">$code</span><span class="keyword">==</span><span class="default">156</span><span class="keyword">) </span><span class="default">$code</span><span class="keyword">=</span><span class="default">339</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; elseif (</span><span class="default">$code</span><span class="keyword">==</span><span class="default">157</span><span class="keyword">) </span><span class="default">$code</span><span class="keyword">=</span><span class="default">160</span><span class="keyword">; </span><span class="comment">// not affected
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">elseif (</span><span class="default">$code</span><span class="keyword">==</span><span class="default">158</span><span class="keyword">) </span><span class="default">$code</span><span class="keyword">=</span><span class="default">382</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; elseif (</span><span class="default">$code</span><span class="keyword">==</span><span class="default">159</span><span class="keyword">) </span><span class="default">$code</span><span class="keyword">=</span><span class="default">376</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">$code </span><span class="keyword">&lt; </span><span class="default">2048</span><span class="keyword">) return </span><span class="default">chr</span><span class="keyword">(</span><span class="default">192 </span><span class="keyword">| (</span><span class="default">$code </span><span class="keyword">&gt;&gt; </span><span class="default">6</span><span class="keyword">)) . </span><span class="default">chr</span><span class="keyword">(</span><span class="default">128 </span><span class="keyword">| (</span><span class="default">$code </span><span class="keyword">&amp; </span><span class="default">63</span><span class="keyword">));
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; elseif (</span><span class="default">$code </span><span class="keyword">&lt; </span><span class="default">65536</span><span class="keyword">) return </span><span class="default">chr</span><span class="keyword">(</span><span class="default">224 </span><span class="keyword">| (</span><span class="default">$code </span><span class="keyword">&gt;&gt; </span><span class="default">12</span><span class="keyword">)) . </span><span class="default">chr</span><span class="keyword">(</span><span class="default">128 </span><span class="keyword">| ((</span><span class="default">$code </span><span class="keyword">&gt;&gt; </span><span class="default">6</span><span class="keyword">) &amp; </span><span class="default">63</span><span class="keyword">)) . </span><span class="default">chr</span><span class="keyword">(</span><span class="default">128 </span><span class="keyword">| (</span><span class="default">$code </span><span class="keyword">&amp; </span><span class="default">63</span><span class="keyword">));
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; else return </span><span class="default">chr</span><span class="keyword">(</span><span class="default">240 </span><span class="keyword">| (</span><span class="default">$code </span><span class="keyword">&gt;&gt; </span><span class="default">18</span><span class="keyword">)) . </span><span class="default">chr</span><span class="keyword">(</span><span class="default">128 </span><span class="keyword">| ((</span><span class="default">$code </span><span class="keyword">&gt;&gt; </span><span class="default">12</span><span class="keyword">) &amp; </span><span class="default">63</span><span class="keyword">)) . </span><span class="default">chr</span><span class="keyword">(</span><span class="default">128 </span><span class="keyword">| ((</span><span class="default">$code </span><span class="keyword">&gt;&gt; </span><span class="default">6</span><span class="keyword">) &amp; </span><span class="default">63</span><span class="keyword">)) . </span><span class="default">chr</span><span class="keyword">(</span><span class="default">128 </span><span class="keyword">| (</span><span class="default">$code </span><span class="keyword">&amp; </span><span class="default">63</span><span class="keyword">));
<br />
&nbsp;&nbsp;&nbsp; }
<br />

<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// Callback for preg_replace_callback('~&amp;(#(x?))?([^;]+);~', 'html_entity_replace', $str);
<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">function </span><span class="default">html_entity_replace</span><span class="keyword">(</span><span class="default">$matches</span><span class="keyword">)
<br />
&nbsp;&nbsp;&nbsp; {
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">$matches</span><span class="keyword">[</span><span class="default">2</span><span class="keyword">])
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">chr_utf8</span><span class="keyword">(</span><span class="default">hexdec</span><span class="keyword">(</span><span class="default">$matches</span><span class="keyword">[</span><span class="default">3</span><span class="keyword">]));
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; } elseif (</span><span class="default">$matches</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">])
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">chr_utf8</span><span class="keyword">(</span><span class="default">$matches</span><span class="keyword">[</span><span class="default">3</span><span class="keyword">]);
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; switch (</span><span class="default">$matches</span><span class="keyword">[</span><span class="default">3</span><span class="keyword">])
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="string">"nbsp"</span><span class="keyword">: return </span><span class="default">chr_utf8</span><span class="keyword">(</span><span class="default">160</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="string">"iexcl"</span><span class="keyword">: return </span><span class="default">chr_utf8</span><span class="keyword">(</span><span class="default">161</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="string">"cent"</span><span class="keyword">: return </span><span class="default">chr_utf8</span><span class="keyword">(</span><span class="default">162</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="string">"pound"</span><span class="keyword">: return </span><span class="default">chr_utf8</span><span class="keyword">(</span><span class="default">163</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="string">"curren"</span><span class="keyword">: return </span><span class="default">chr_utf8</span><span class="keyword">(</span><span class="default">164</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="string">"yen"</span><span class="keyword">: return </span><span class="default">chr_utf8</span><span class="keyword">(</span><span class="default">165</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">//... etc with all named HTML entities
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">}
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">false</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; }
<br />
&nbsp;&nbsp;&nbsp; 
<br />
&nbsp;&nbsp;&nbsp; function </span><span class="default">htmlentities2utf8 </span><span class="keyword">(</span><span class="default">$string</span><span class="keyword">) </span><span class="comment">// because of the html_entity_decode() bug with UTF-8
<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">{
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$string </span><span class="keyword">= </span><span class="default">preg_replace_callback</span><span class="keyword">(</span><span class="string">'~&amp;(#(x?))?([^;]+);~'</span><span class="keyword">, </span><span class="string">'html_entity_replace'</span><span class="keyword">, </span><span class="default">$string</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">$string</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; }
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="54943""></a>
  <div class="note">
   <strong class="user">florianborn (at) yahoo (dot) de</strong>
   <a href="#54943" class="date">20-Jul-2005 03:43</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Note that<br />
<br />
<span class="default">&lt;?php<br />
<br />
&nbsp;</span><span class="keyword">echo </span><span class="default">urlencode</span><span class="keyword">(</span><span class="default">html_entity_decode</span><span class="keyword">(</span><span class="string">"&amp;nbsp;"</span><span class="keyword">));<br />
<br />
</span><span class="default">?&gt;<br />
</span><br />
will output "%A0" instead of "+".</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="51055""></a>
  <div class="note">
   <strong class="user">php dot net at c dash ovidiu dot tk</strong>
   <a href="#51055" class="date">18-Mar-2005 12:37</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Quick &amp; dirty code that translates numeric entities to UTF-8.<br />
<br />
<span class="default">&lt;?php<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">function </span><span class="default">replace_num_entity</span><span class="keyword">(</span><span class="default">$ord</span><span class="keyword">)<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$ord </span><span class="keyword">= </span><span class="default">$ord</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">];<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">preg_match</span><span class="keyword">(</span><span class="string">'/^x([0-9a-f]+)$/i'</span><span class="keyword">, </span><span class="default">$ord</span><span class="keyword">, </span><span class="default">$match</span><span class="keyword">))<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$ord </span><span class="keyword">= </span><span class="default">hexdec</span><span class="keyword">(</span><span class="default">$match</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">]);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; else<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$ord </span><span class="keyword">= </span><span class="default">intval</span><span class="keyword">(</span><span class="default">$ord</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$no_bytes </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$byte </span><span class="keyword">= array();<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">$ord </span><span class="keyword">&lt; </span><span class="default">128</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">chr</span><span class="keyword">(</span><span class="default">$ord</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; elseif (</span><span class="default">$ord </span><span class="keyword">&lt; </span><span class="default">2048</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$no_bytes </span><span class="keyword">= </span><span class="default">2</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; elseif (</span><span class="default">$ord </span><span class="keyword">&lt; </span><span class="default">65536</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$no_bytes </span><span class="keyword">= </span><span class="default">3</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; elseif (</span><span class="default">$ord </span><span class="keyword">&lt; </span><span class="default">1114112</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$no_bytes </span><span class="keyword">= </span><span class="default">4</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; else<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; switch(</span><span class="default">$no_bytes</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="default">2</span><span class="keyword">:<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$prefix </span><span class="keyword">= array(</span><span class="default">31</span><span class="keyword">, </span><span class="default">192</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; break;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="default">3</span><span class="keyword">:<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$prefix </span><span class="keyword">= array(</span><span class="default">15</span><span class="keyword">, </span><span class="default">224</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; break;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="default">4</span><span class="keyword">:<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$prefix </span><span class="keyword">= array(</span><span class="default">7</span><span class="keyword">, </span><span class="default">240</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; for (</span><span class="default">$i </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">; </span><span class="default">$i </span><span class="keyword">&lt; </span><span class="default">$no_bytes</span><span class="keyword">; </span><span class="default">$i</span><span class="keyword">++)<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$byte</span><span class="keyword">[</span><span class="default">$no_bytes </span><span class="keyword">- </span><span class="default">$i </span><span class="keyword">- </span><span class="default">1</span><span class="keyword">] = ((</span><span class="default">$ord </span><span class="keyword">&amp; (</span><span class="default">63 </span><span class="keyword">* </span><span class="default">pow</span><span class="keyword">(</span><span class="default">2</span><span class="keyword">, </span><span class="default">6 </span><span class="keyword">* </span><span class="default">$i</span><span class="keyword">))) / </span><span class="default">pow</span><span class="keyword">(</span><span class="default">2</span><span class="keyword">, </span><span class="default">6 </span><span class="keyword">* </span><span class="default">$i</span><span class="keyword">)) &amp; </span><span class="default">63 </span><span class="keyword">| </span><span class="default">128</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$byte</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">] = (</span><span class="default">$byte</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">] &amp; </span><span class="default">$prefix</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">]) | </span><span class="default">$prefix</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">];<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$ret </span><span class="keyword">= </span><span class="string">''</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; for (</span><span class="default">$i </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">; </span><span class="default">$i </span><span class="keyword">&lt; </span><span class="default">$no_bytes</span><span class="keyword">; </span><span class="default">$i</span><span class="keyword">++)<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$ret </span><span class="keyword">.= </span><span class="default">chr</span><span class="keyword">(</span><span class="default">$byte</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">]);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">$ret</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$test </span><span class="keyword">= </span><span class="string">'This is a &amp;#269;&amp;#x5d0; test&amp;#39;'</span><span class="keyword">;<br />
<br />
&nbsp;&nbsp;&nbsp; echo </span><span class="default">$test </span><span class="keyword">. </span><span class="string">"&lt;br /&gt;\n"</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; echo </span><span class="default">preg_replace_callback</span><span class="keyword">(</span><span class="string">'/&amp;#([0-9a-fx]+);/mi'</span><span class="keyword">, </span><span class="string">'replace_num_entity'</span><span class="keyword">, </span><span class="default">$test</span><span class="keyword">);<br />
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="47371""></a>
  <div class="note">
   <strong class="user">daniel at brightbyte dot de</strong>
   <a href="#47371" class="date">13-Nov-2004 06:12</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
This function seems to have to have two limitations (at least in PHP 4.3.8):<br />
<br />
a) it does not work with multibyte character codings, such as UTF-8<br />
b) it does not decode numeric entity references<br />
<br />
a) can be solved by using iconv to convert to ISO-8859-1, then decoding the entities, than convert to UTF-8 again. But that's quite ugly and detroys all characters not present in Latin-1.<br />
<br />
b) can be solved rather nicely using the following code:<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">function </span><span class="default">decode_entities</span><span class="keyword">(</span><span class="default">$text</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$text</span><span class="keyword">= </span><span class="default">html_entity_decode</span><span class="keyword">(</span><span class="default">$text</span><span class="keyword">,</span><span class="default">ENT_QUOTES</span><span class="keyword">,</span><span class="string">"ISO-8859-1"</span><span class="keyword">); </span><span class="comment">#NOTE: UTF-8 does not work!<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$text</span><span class="keyword">= </span><span class="default">preg_replace</span><span class="keyword">(</span><span class="string">'/&amp;#(\d+);/me'</span><span class="keyword">,</span><span class="string">"chr(\\1)"</span><span class="keyword">,</span><span class="default">$text</span><span class="keyword">); </span><span class="comment">#decimal notation<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$text</span><span class="keyword">= </span><span class="default">preg_replace</span><span class="keyword">(</span><span class="string">'/&amp;#x([a-f0-9]+);/mei'</span><span class="keyword">,</span><span class="string">"chr(0x\\1)"</span><span class="keyword">,</span><span class="default">$text</span><span class="keyword">);&nbsp; </span><span class="comment">#hex notation<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">return </span><span class="default">$text</span><span class="keyword">;<br />
}<br />
</span><span class="default">?&gt;<br />
</span><br />
HTH</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="45649""></a>
  <div class="note">
   <strong class="user">aidan at php dot net</strong>
   <a href="#45649" class="date">14-Sep-2004 12:57</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
This functionality is now implemented in the PEAR package PHP_Compat.<br />
<br />
More information about using this function without upgrading your version of PHP can be found on the below link:<br />
<br />
<a href="http://pear.php.net/package/PHP_Compat" rel="nofollow" target="_blank">http://pear.php.net/package/PHP_Compat</a></span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
</div>
</div>
</div></div></body></html>
