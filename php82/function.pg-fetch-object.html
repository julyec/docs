<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
 <head>
  <meta http-equiv="content-type" content="text/html; CHARSET=UTF-8">
  <title>获取一行作为对象</title>
<link media="all" rel="stylesheet" type="text/css" href="styles/03e73060321a0a848018724a6c83de7f-theme-base.css" />
<link media="all" rel="stylesheet" type="text/css" href="styles/03e73060321a0a848018724a6c83de7f-theme-medium.css" />

  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <link media="all" rel="stylesheet" type="text/css" href="style.css"/>
 </head>
 <body class="docs" class="docs"><div class="navbar navbar-fixed-top">
  <div class="navbar-inner clearfix">
    <ul class="nav" style="width: 100%">
      <li style="float: left;"><a href="function.pg-fetch-assoc.html">? pg_fetch_assoc</a></li>
      <li style="float: right;"><a href="function.pg-fetch-result.html">pg_fetch_result ?</a></li>
    </ul>
  </div>
</div>
<div id="breadcrumbs" class="clearfix">
  <ul class="breadcrumbs-container">
    <li><a href="index.html">PHP Manual</a></li>
    <li><a href="ref.pgsql.html">PostgreSQL 函数</a></li>
    <li>获取一行作为对象</li>
  </ul>
</div>
<div id="layout">
  <div id="layout-content"><div id="function.pg-fetch-object" class="refentry">
 <div class="refnamediv">
  <h1 class="refname">pg_fetch_object</h1>
  <p class="verinfo">(PHP 4, PHP 5, PHP 7, PHP 8)</p><p class="refpurpose"><span class="refname">pg_fetch_object</span> &mdash; <span class="dc-title">获取一行作为对象</span></p>

 </div>

 <div class="refsect1 description" id="refsect1-function.pg-fetch-object-description">
  <h3 class="title">说明</h3>
  <div class="methodsynopsis dc-description">
   <span class="methodname"><strong>pg_fetch_object</strong></span>(<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="methodparam"><span class="type"><a href="class.pgsql-result.html" class="type PgSql\Result">PgSql\Result</a></span> <code class="parameter">$result</code></span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="methodparam"><span class="type">?</span><span class="type"><span class="type">int</span><span class="type"></span></span> <code class="parameter">$row</code><span class="initializer"> = <strong><code>null</code></strong></span></span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="methodparam"><span class="type">string</span> <code class="parameter">$class</code><span class="initializer"> = &quot;stdClass&quot;</span></span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="methodparam"><span class="type">array</span> <code class="parameter">$constructor_args</code><span class="initializer"> = []</span></span><br>): <span class="type"><span class="type">object</span>|<span class="type"><span class="type false">false</span></span></span></div>

  <p class="para rdfs-comment">
   <span class="function"><strong>pg_fetch_object()</strong></span> 返回对象，该对象的属性对应于获取的行的字段名称。它可以选择实例化特定类的对象，并将参数传递给该类的构造方法。
  </p>
  <blockquote class="note"><p><strong class="note">Note</strong>: <span class="simpara">此函数将 NULL 字段设置为 PHP <strong><code>null</code></strong> 值。</span></p></blockquote>
  <p class="para">
   在速度方面，该函数与 <span class="function"><a href="function.pg-fetch-array.html" class="function">pg_fetch_array()</a></span> 相同，并且几乎与 <span class="function"><a href="function.pg-fetch-row.html" class="function">pg_fetch_row()</a></span> 一样快（差别不大）。
  </p>
 </div>


 <div class="refsect1 parameters" id="refsect1-function.pg-fetch-object-parameters">
  <h3 class="title">参数</h3>
  <p class="para">
   <dl>
    
     <dt>
<code class="parameter">result</code></dt>

     <dd>

      <p class="para"><span class="classname"><a href="class.pgsql-result.html" class="classname">PgSql\Result</a></span> 实例，由
<span class="function"><a href="function.pg-query.html" class="function">pg_query()</a></span>、<span class="function"><a href="function.pg-query-params.html" class="function">pg_query_params()</a></span> 或者 <span class="function"><a href="function.pg-execute.html" class="function">pg_execute()</a></span>（等）返回。</p>
     </dd>

    
    
     <dt>
<code class="parameter">row</code></dt>

     <dd>

      <p class="para">
       要获取的结果中的行号。行从 0 向上编号。如果省略或为 <strong><code>null</code></strong>，则获取下一行。
      </p>
     </dd>

    
    
     <dt>
<code class="parameter">class</code></dt>

      <dd>

       <p class="para">
        要实例化、设置属性并返回的类的名称。如果未指定，则返回 <span class="classname"><a href="class.stdclass.html" class="classname">stdClass</a></span> 对象。
       </p>
     </dd>

    
    
     <dt>
<code class="parameter">constructor_args</code></dt>

      <dd>

       <p class="para">
        要传递给 <code class="parameter">class</code> 对象的构造方法的可选参数 <span class="type">array</span>。
       </p>
     </dd>

    
   </dl>

  </p>
 </div>


 <div class="refsect1 returnvalues" id="refsect1-function.pg-fetch-object-returnvalues">
  <h3 class="title">返回值</h3>
  <p class="para">
   结果中的每个字段名称都有在 <span class="type">object</span> 中对应的属性。数据库 <code class="literal">NULL</code> 值作为 <strong><code>null</code></strong> 返回。
  </p>
  <p class="para">
   如果 <code class="parameter">row</code> 超过集合中的行数、没有更多行或任何其他错误，则返回 <strong><code>false</code></strong>。
  </p>
 </div>


 <div class="refsect1 changelog" id="refsect1-function.pg-fetch-object-changelog">
  <h3 class="title">更新日志</h3>
  <table class="doctable informaltable">
   
    <thead>
     <tr>
      <th>版本</th>
      <th>说明</th>
     </tr>

    </thead>

    <tbody class="tbody">
     <tr>
 <td>8.1.0</td>
 <td>
  现在 <code class="parameter">result</code> 参数接受 <span class="classname"><a href="class.pgsql-result.html" class="classname">PgSql\Result</a></span>
  实例，之前接受 <a href="language.types.resource.html" class="link">资源(resource)</a>。
 </td>
</tr>

    </tbody>
   
  </table>

 </div>


 <div class="refsect1 examples" id="refsect1-function.pg-fetch-object-examples">
  <h3 class="title">示例</h3>
  <p class="para">
   <div class="example" id="stream-notification-callback.example.download">
    <p><strong>Example #1 <span class="function"><strong>pg_fetch_object()</strong></span> 示例</strong></p>
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php <br /><br />$database </span><span style="color: #007700">= </span><span style="color: #DD0000">"store"</span><span style="color: #007700">;<br /><br /></span><span style="color: #0000BB">$db_conn </span><span style="color: #007700">= </span><span style="color: #0000BB">pg_connect</span><span style="color: #007700">(</span><span style="color: #DD0000">"host=localhost port=5432 dbname=</span><span style="color: #0000BB">$database</span><span style="color: #DD0000">"</span><span style="color: #007700">);<br />if (!</span><span style="color: #0000BB">$db_conn</span><span style="color: #007700">) {<br />  echo </span><span style="color: #DD0000">"Failed connecting to postgres database </span><span style="color: #0000BB">$database</span><span style="color: #DD0000">\n"</span><span style="color: #007700">;<br />  exit;<br />}<br /><br /></span><span style="color: #0000BB">$qu </span><span style="color: #007700">= </span><span style="color: #0000BB">pg_query</span><span style="color: #007700">(</span><span style="color: #0000BB">$db_conn</span><span style="color: #007700">, </span><span style="color: #DD0000">"SELECT * FROM books ORDER BY author"</span><span style="color: #007700">);<br /><br /><br />while (</span><span style="color: #0000BB">$data </span><span style="color: #007700">= </span><span style="color: #0000BB">pg_fetch_object</span><span style="color: #007700">(</span><span style="color: #0000BB">$qu</span><span style="color: #007700">)) {<br />  echo </span><span style="color: #0000BB">$data</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">author </span><span style="color: #007700">. </span><span style="color: #DD0000">" ("</span><span style="color: #007700">;<br />  echo </span><span style="color: #0000BB">$data</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">year </span><span style="color: #007700">. </span><span style="color: #DD0000">"): "</span><span style="color: #007700">;<br />  echo </span><span style="color: #0000BB">$data</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">title </span><span style="color: #007700">. </span><span style="color: #DD0000">"&lt;br /&gt;"</span><span style="color: #007700">;<br />}<br /><br /></span><span style="color: #0000BB">pg_free_result</span><span style="color: #007700">(</span><span style="color: #0000BB">$qu</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">pg_close</span><span style="color: #007700">(</span><span style="color: #0000BB">$db_conn</span><span style="color: #007700">);<br /><br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
    </div>

   </div>
  </p>
 </div>


 <div class="refsect1 seealso" id="refsect1-function.pg-fetch-object-seealso">
  <h3 class="title">参见</h3>
  <p class="para">
   <ul class="simplelist">
    <li class="member"><span class="function"><a href="function.pg-query.html" class="function" rel="rdfs-seeAlso">pg_query()</a> - 执行查询</span></li>
    <li class="member"><span class="function"><a href="function.pg-fetch-array.html" class="function" rel="rdfs-seeAlso">pg_fetch_array()</a> - 获取一行作为数组</span></li>
    <li class="member"><span class="function"><a href="function.pg-fetch-assoc.html" class="function" rel="rdfs-seeAlso">pg_fetch_assoc()</a> - 获取一行作为关联数组</span></li>
    <li class="member"><span class="function"><a href="function.pg-fetch-row.html" class="function" rel="rdfs-seeAlso">pg_fetch_row()</a> - 提取一行作为枚举数组</span></li>
    <li class="member"><span class="function"><a href="function.pg-fetch-result.html" class="function" rel="rdfs-seeAlso">pg_fetch_result()</a> - 从结果实例返回值</span></li>
   </ul>
  </p>
 </div>

</div><div id="usernotes">
 <div class="head">
  <h3 class="title">User Contributed Notes</h3>
 </div>
<div id="allnotes">  <a name="109545""></a>
  <div class="note">
   <strong class="user">qeremy [atta] gmail [dotta] com</strong>
   <a href="#109545" class="date">27-Jul-2012 12:20</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Getting db results as object.
<br />

<br />
<span class="default">&lt;?php
<br />
$qry </span><span class="keyword">= </span><span class="default">pg_query</span><span class="keyword">(</span><span class="string">"SELECT * FROM users"</span><span class="keyword">);
<br />

<br />
</span><span class="default">$rows </span><span class="keyword">= array();
<br />
while (</span><span class="default">$fch </span><span class="keyword">= </span><span class="default">pg_fetch_object</span><span class="keyword">(</span><span class="default">$qry</span><span class="keyword">)) {
<br />
&nbsp;&nbsp; </span><span class="default">$rows</span><span class="keyword">[] = </span><span class="default">$fch</span><span class="keyword">;
<br />
}
<br />

<br />
</span><span class="comment">// or
<br />

<br />
</span><span class="default">$rows </span><span class="keyword">= </span><span class="default">array_map</span><span class="keyword">(function(</span><span class="default">$a</span><span class="keyword">){
<br />
&nbsp;&nbsp; return (object) </span><span class="default">$a</span><span class="keyword">;
<br />
}, (array) </span><span class="default">pg_fetch_all</span><span class="keyword">(</span><span class="default">$qry</span><span class="keyword">));
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="76148""></a>
  <div class="note">
   <strong class="user">ekevu at yahoo dot com</strong>
   <a href="#76148" class="date">02-Jul-2007 07:36</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
PostgreSQL boolean true becomes string "t"<br />
PostgreSQL boolean false becomes string "f"<br />
This is ambiguous, and leads to code duplication. I wonder why aren't the types correctly typed when fetching values. We could at least have an optional parameter to enable that.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="61191""></a>
  <div class="note">
   <strong class="user">robeddielee at hotmail dot com</strong>
   <a href="#61191" class="date">27-Jan-2006 11:38</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I noticed that many people use FOR loops to extract query data. This is the method I use to extract data.<br />
<br />
<span class="default">&lt;?php<br />
&nbsp;</span><span class="keyword">@</span><span class="default">$members </span><span class="keyword">= </span><span class="default">pg_query</span><span class="keyword">(</span><span class="default">$db_conn</span><span class="keyword">, </span><span class="string">'SELECT id,name FROM boards.members ORDER BY name;'</span><span class="keyword">);<br />
&nbsp;if (</span><span class="default">$members </span><span class="keyword">AND </span><span class="default">pg_num_rows</span><span class="keyword">(</span><span class="default">$members</span><span class="keyword">)) {<br />
&nbsp; while (</span><span class="default">$member </span><span class="keyword">= </span><span class="default">pg_fetch_object</span><span class="keyword">(</span><span class="default">$members</span><span class="keyword">)) {<br />
&nbsp;&nbsp; echo </span><span class="default">$member</span><span class="keyword">-&gt;</span><span class="default">name</span><span class="keyword">.</span><span class="string">' ('</span><span class="keyword">.</span><span class="default">$member</span><span class="keyword">-&gt;</span><span class="default">id</span><span class="keyword">.</span><span class="string">')'</span><span class="keyword">;<br />
&nbsp; }<br />
&nbsp;}<br />
</span><span class="default">?&gt;<br />
</span><br />
If an error occurs (or nothing is returned) in the above code nothing will output. An ELSE clause can be added to the IF to handle query errors (or nothing being returned). Or a seperate check can be performed for the event that nothing is returned by using an ELSEIF clause.<br />
<br />
I like this method because it doesn't use any temporary counter variables.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="47422""></a>
  <div class="note">
   <strong class="user">oracle dot shinoda at gmail dot com</strong>
   <a href="#47422" class="date">15-Nov-2004 06:13</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you're wanting to use objects for your results, but are put off because you can't seem to apply a function to each field of the result (like stripslashes for example), try this code:<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="comment">// Code to connect, do query etc etc...<br />
<br />
</span><span class="default">$row </span><span class="keyword">= </span><span class="default">pg_fetch_object</span><span class="keyword">(</span><span class="default">$result</span><span class="keyword">);<br />
</span><span class="default">$vars </span><span class="keyword">= </span><span class="default">get_object_vars</span><span class="keyword">(</span><span class="default">$row</span><span class="keyword">);<br />
foreach ( </span><span class="default">$vars </span><span class="keyword">as </span><span class="default">$key </span><span class="keyword">=&gt; </span><span class="default">$var </span><span class="keyword">)<br />
{<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$row</span><span class="keyword">-&gt;{</span><span class="default">$key</span><span class="keyword">} = </span><span class="default">stripslashes</span><span class="keyword">(</span><span class="default">$var</span><span class="keyword">);<br />
}<br />
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="43271""></a>
  <div class="note">
   <strong class="user">michiel at minas-2 dot demon dot nl</strong>
   <a href="#43271" class="date">16-Jun-2004 08:13</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Something I have learned to use:<br />
<br />
$result=$pg_query (...);<br />
$num = pg_numrows($result);<br />
<br />
for($count=0;$count &lt; $num &amp;&amp; $data=pg_fetch_object($result,$count);$count++)<br />
{<br />
&nbsp;&nbsp;&nbsp; printf("&lt;tr&gt;\n");<br />
&nbsp;&nbsp;&nbsp; printf("&nbsp; &nbsp; &lt;td&gt;%s&lt;/td&gt;\n",$data-&gt;foo);<br />
&nbsp;&nbsp;&nbsp; printf("&nbsp; &nbsp; &lt;td&gt;%s&lt;/td&gt;\n",$data-&gt;bar);<br />
&nbsp;&nbsp;&nbsp; printf("&lt;/tr&gt;\n");<br />
}</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="36541""></a>
  <div class="note">
   <strong class="user">Lars at dybdahl dot dk</strong>
   <a href="#36541" class="date">14-Oct-2003 08:43</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
When you retrieve the contents of a "timestamp with timezone" field, this will set the environment's timezone variables. Therefore, this is dangerous:<br />
<br />
$s=$row-&gt;mydatefield;<br />
$unixtimestamp=postgresqltimestamp2unix($s);<br />
echo date("Y-m-d H:i:s",$unixtimestamp);<br />
<br />
Here, postgresqltimestamp2unix is a function that converts the postgresql timestamp to Unix. The retrieval of the field data in the first line of the example above will influence the timezone used in date() in the third line.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="29321""></a>
  <div class="note">
   <strong class="user">ian at eiloart dot com</strong>
   <a href="#29321" class="date">09-Feb-2003 07:27</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
This isn't all that useful. If you do, for example, foreach($row as $field) then you still get every value twice!<br />
<br />
You can do something like this, though:<br />
<br />
foreach ($line as $key =&gt; $cell){<br />
&nbsp;&nbsp; &nbsp; if (! is_numeric($key)){<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; echo "&lt;td&gt;$key $cell&lt;/td&gt;";<br />
&nbsp;&nbsp; &nbsp; }<br />
}<br />
<br />
is is_numeric strict enough?</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="19951""></a>
  <div class="note">
   <strong class="user">inbox at bucksvsbytes dot com</strong>
   <a href="#19951" class="date">16-Mar-2002 09:13</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
The result_type arg is either invalid or incorrectly documented, since the "result_type is optional..." paragraph is copied verbatim from pg_fetch_array, and the PGSQL_NUM option is in conflict with the preceding paragraph's, "you can only access the data by the field names, and not by their<br />
offsets."</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
</div>
</div>
</div></div></body></html>
