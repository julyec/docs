<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
 <head>
  <meta http-equiv="content-type" content="text/html; CHARSET=UTF-8">
  <title>Merges a sequence of images</title>
<link media="all" rel="stylesheet" type="text/css" href="styles/03e73060321a0a848018724a6c83de7f-theme-base.css" />
<link media="all" rel="stylesheet" type="text/css" href="styles/03e73060321a0a848018724a6c83de7f-theme-medium.css" />

  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <link media="all" rel="stylesheet" type="text/css" href="style.css"/>
 </head>
 <body class="docs" class="docs"><div class="navbar navbar-fixed-top">
  <div class="navbar-inner clearfix">
    <ul class="nav" style="width: 100%">
      <li style="float: left;"><a href="imagick.filter.html">? Imagick::filter</a></li>
      <li style="float: right;"><a href="imagick.flipimage.html">Imagick::flipImage ?</a></li>
    </ul>
  </div>
</div>
<div id="breadcrumbs" class="clearfix">
  <ul class="breadcrumbs-container">
    <li><a href="index.html">PHP Manual</a></li>
    <li><a href="class.imagick.html">Imagick</a></li>
    <li>Merges a sequence of images</li>
  </ul>
</div>
<div id="layout">
  <div id="layout-content"><div id="imagick.flattenimages" class="refentry">
 <div class="refnamediv">
  <h1 class="refname">Imagick::flattenImages</h1>
  <p class="verinfo">(PECL imagick 2, PECL imagick 3)</p><p class="refpurpose"><span class="refname">Imagick::flattenImages</span> &mdash; <span class="dc-title">Merges a sequence of images</span></p>

 </div>

 <div id="imagick.flattenimages-refsynopsisdiv">
   <div class="warning"><strong class="warning">Warning</strong><p class="simpara">此函数在 Imagick 3.4.4 中被 <em class="emphasis">废弃</em>，强烈建议不要应用此函数。</p></div>
 </div>

 <div class="refsect1 description" id="refsect1-imagick.flattenimages-description">
  <h3 class="title">说明</h3>
  <div class="methodsynopsis dc-description">
   <span class="modifier">public</span> <span class="methodname"><strong>Imagick::flattenImages</strong></span>(): <span class="type"><a href="class.imagick.html" class="type Imagick">Imagick</a></span></div>

  <p class="para rdfs-comment">
   Merges a sequence of images.  This is useful for combining Photoshop layers into a single image.
  </p>
 </div>


 <div class="refsect1 parameters" id="refsect1-imagick.flattenimages-parameters">
  <h3 class="title">参数</h3>
  <p class="para">此函数没有参数。</p>
 </div>


 <div class="refsect1 returnvalues" id="refsect1-imagick.flattenimages-returnvalues">
  <h3 class="title">返回值</h3>
  <p class="para">
   成功时返回 <strong><code>true</code></strong>。
  </p>
 </div>


 <div class="refsect1 errors" id="refsect1-imagick.flattenimages-errors">
  <h3 class="title">错误／异常</h3>
  <p class="para">
   错误时抛出 ImagickException。
  </p>
 </div>


</div><div id="usernotes">
 <div class="head">
  <h3 class="title">User Contributed Notes</h3>
 </div>
<div id="allnotes">  <a name="116956""></a>
  <div class="note">
   <strong class="user">A.Ross</strong>
   <a href="#116956" class="date">26-Mar-2015 01:44</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Replying to Francois:<br />
<span class="default">&lt;?php<br />
$im</span><span class="keyword">-&gt;</span><span class="default">setImageBackgroundColor</span><span class="keyword">(</span><span class="string">'white'</span><span class="keyword">);<br />
</span><span class="default">$im</span><span class="keyword">-&gt;</span><span class="default">setImageAlphaChannel</span><span class="keyword">(</span><span class="default">Imagick</span><span class="keyword">::</span><span class="default">ALPHACHANNEL_REMOVE</span><span class="keyword">);<br />
</span><span class="default">$im</span><span class="keyword">-&gt;</span><span class="default">mergeImageLayers</span><span class="keyword">(</span><span class="default">Imagick</span><span class="keyword">::</span><span class="default">LAYERMETHOD_FLATTEN</span><span class="keyword">);<br />
</span><span class="default">?&gt;<br />
</span><br />
Imagick::ALPHACHANNEL_REMOVE has been added in 3.2.0b2 (before the RC): <a href="http://pecl.php.net/package-info.php?package=imagick&amp;version=3.2.0b2" rel="nofollow" target="_blank">http://pecl.php.net/package-info.php?package=imagick&amp;version=3.2.0b2</a><br />
<br />
The problem is with people who want to implement this, but are stuck with an Imagick version &lt; 3.2.0b2. They can't use this constant. However, all is not lost. I've found a reference where someone got this to work using an integer: <a href="http://stackoverflow.com/q/28154179/1000608" rel="nofollow" target="_blank">http://stackoverflow.com/q/28154179/1000608</a><br />
<br />
The number he used is 11, which seems to suggest that the value of Imagick::ALPHACHANNEL_REMOVE is 11, and the function worked correctly in this usecase even before the constant was implemented. So if you're stuck with &lt;3.2.0b2 this is the code you need:<br />
<br />
<span class="default">&lt;?php<br />
$im</span><span class="keyword">-&gt;</span><span class="default">setImageBackgroundColor</span><span class="keyword">(</span><span class="string">'white'</span><span class="keyword">);<br />
</span><span class="default">$im</span><span class="keyword">-&gt;</span><span class="default">setImageAlphaChannel</span><span class="keyword">(</span><span class="default">11</span><span class="keyword">);<br />
</span><span class="default">$im</span><span class="keyword">-&gt;</span><span class="default">mergeImageLayers</span><span class="keyword">(</span><span class="default">Imagick</span><span class="keyword">::</span><span class="default">LAYERMETHOD_FLATTEN</span><span class="keyword">);<br />
</span><span class="default">?&gt;<br />
</span><br />
This works at least as far back as version 3.1.0~rc1-1 (current version of the php5-imagick package in Debian 7).</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="116844""></a>
  <div class="note">
   <strong class="user">thomasbachem</strong>
   <a href="#116844" class="date">10-Mar-2015 12:05</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
The actual replacement now that flattenImages() has been deprecated is:<br />
<br />
<span class="default">&lt;?php<br />
$im </span><span class="keyword">= </span><span class="default">$im</span><span class="keyword">-&gt;</span><span class="default">mergeImageLayers</span><span class="keyword">(</span><span class="default">Imagick</span><span class="keyword">::</span><span class="default">LAYERMETHOD_FLATTEN</span><span class="keyword">);<br />
</span><span class="default">?&gt;<br />
</span><br />
So you need to (re)assign the returned Imagick object.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="116665""></a>
  <div class="note">
   <strong class="user">francois</strong>
   <a href="#116665" class="date">06-Feb-2015 07:57</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
As nick said, the function Imagick::flattenImages() is deprecated. Replacing it by Imagick::mergeImageLayers(Imagick::LAYERMETHOD_FLATTEN) partially worked. Images with transparency (ex: .png) get black background even if the image background is set to white.<br />
<br />
Old working code:<br />
$im-&gt;setImageBackgroundColor('white');<br />
$im = $im-&gt;flattenImages();<br />
<br />
New working code:<br />
$im-&gt;setImageBackgroundColor('white');<br />
$im-&gt;setImageAlphaChannel(imagick::ALPHACHANNEL_REMOVE);<br />
$im-&gt;mergeImageLayers(imagick::LAYERMETHOD_FLATTEN);<br />
<br />
imagick::ALPHACHANNEL_REMOVE is not shown on the constants page but do works with Imagick 3.2.0RC1.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="116114""></a>
  <div class="note">
   <strong class="user">nick at nickdobie dot com</strong>
   <a href="#116114" class="date">11-Nov-2014 02:38</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
This function is deprecated and will throw a warning in PHP 5.6. Simply replace this call with Imagick::mergeImageLayers(Imagick::LAYERMETHOD_FLATTEN) and it will behave the same way.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="114337""></a>
  <div class="note">
   <strong class="user">ureimers</strong>
   <a href="#114337" class="date">10-Feb-2014 11:15</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Small correction to Jairu5's code:<br />
<br />
If you want to set the background color of a transparent image you have to set it _before_ loading the image.<br />
Flattening images by default uses the background color 'white'. That's why Jairu5's code seem to work at first, but only until you want to actually change the background color to something different than white.<br />
<br />
Try using this instead:<br />
<br />
<span class="default">&lt;?php<br />
<br />
$im </span><span class="keyword">= new </span><span class="default">Imagick</span><span class="keyword">();<br />
</span><span class="default">$im</span><span class="keyword">-&gt;</span><span class="default">setImageBackgroundColor</span><span class="keyword">(</span><span class="string">'green'</span><span class="keyword">);<br />
</span><span class="default">$im</span><span class="keyword">-&gt;</span><span class="default">readimage</span><span class="keyword">(</span><span class="string">'image.png'</span><span class="keyword">);<br />
<br />
</span><span class="default">$im </span><span class="keyword">= </span><span class="default">$im</span><span class="keyword">-&gt;</span><span class="default">flattenImages</span><span class="keyword">();<br />
<br />
</span><span class="default">$im</span><span class="keyword">-&gt;</span><span class="default">setImageFormat</span><span class="keyword">(</span><span class="string">'jpg'</span><span class="keyword">);<br />
</span><span class="default">$im</span><span class="keyword">-&gt;</span><span class="default">writeImage</span><span class="keyword">(</span><span class="string">'image.jpg'</span><span class="keyword">);<br />
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="106770""></a>
  <div class="note">
   <strong class="user">Samuel Fine (hi at samuelfine dot com)</strong>
   <a href="#106770" class="date">05-Dec-2011 09:32</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
This is also useful for accurately converting .ico files to .png. (Other types as well, in theory, but I've only tested ico-&gt;png.) Simply using setFormat will create a valid .png file, but will result in image artifacts if the original .ico had any transparency. The following code will create an accurate copy:<br />
<br />
<span class="default">&lt;?php<br />
<br />
$im </span><span class="keyword">= new </span><span class="default">Imagick</span><span class="keyword">();<br />
<br />
</span><span class="comment">// When dealing with .ico files, make sure to setFormat before loading the image or you'll get a nasty exception. See https://bugs.php.net/bug.php?id=58515 for more details.<br />
</span><span class="default">$im</span><span class="keyword">-&gt;</span><span class="default">setFormat</span><span class="keyword">(</span><span class="string">"ico"</span><span class="keyword">);<br />
<br />
</span><span class="default">$im</span><span class="keyword">-&gt;</span><span class="default">readImage</span><span class="keyword">(</span><span class="string">"favicon.ico"</span><span class="keyword">);<br />
<br />
</span><span class="default">$im </span><span class="keyword">= </span><span class="default">$im</span><span class="keyword">-&gt;</span><span class="default">flattenImages</span><span class="keyword">(); </span><span class="comment">// Thanks for the tip, Jairu5!<br />
<br />
</span><span class="default">$im</span><span class="keyword">-&gt;</span><span class="default">setFormat</span><span class="keyword">(</span><span class="string">"png"</span><span class="keyword">);<br />
<br />
</span><span class="default">$new </span><span class="keyword">= </span><span class="default">fopen</span><span class="keyword">(</span><span class="string">"favicon.png"</span><span class="keyword">, </span><span class="string">"w"</span><span class="keyword">);<br />
</span><span class="default">$im</span><span class="keyword">-&gt;</span><span class="default">writeImageFile</span><span class="keyword">(</span><span class="default">$new</span><span class="keyword">);<br />
</span><span class="default">$im</span><span class="keyword">-&gt;</span><span class="default">clear</span><span class="keyword">();<br />
</span><span class="default">$im</span><span class="keyword">-&gt;</span><span class="default">destroy</span><span class="keyword">();<br />
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="101164""></a>
  <div class="note">
   <strong class="user">Jairu5</strong>
   <a href="#101164" class="date">30-Nov-2010 08:29</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Note that the function returns an Imagick object and does not modify the existing object. Below is my code for converting a PNG with transparency into a JPG with a background color. This code illustrates the difference.<br />
<br />
<span class="default">&lt;?php<br />
<br />
$im </span><span class="keyword">= new </span><span class="default">Imagick</span><span class="keyword">(</span><span class="string">'image.png'</span><span class="keyword">);<br />
</span><span class="default">$im</span><span class="keyword">-&gt;</span><span class="default">setImageBackgroundColor</span><span class="keyword">(</span><span class="string">'white'</span><span class="keyword">);<br />
<br />
</span><span class="default">$im</span><span class="keyword">-&gt;</span><span class="default">flattenImages</span><span class="keyword">(); </span><span class="comment">// This does not do anything.<br />
</span><span class="default">$im </span><span class="keyword">= </span><span class="default">$im</span><span class="keyword">-&gt;</span><span class="default">flattenImages</span><span class="keyword">(); </span><span class="comment">// Use this instead.<br />
<br />
</span><span class="default">$im</span><span class="keyword">-&gt;</span><span class="default">setImageFormat</span><span class="keyword">(</span><span class="string">'jpg'</span><span class="keyword">);<br />
</span><span class="default">$im</span><span class="keyword">-&gt;</span><span class="default">writeImage</span><span class="keyword">(</span><span class="string">'image.jpg'</span><span class="keyword">);<br />
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
</div>
</div>
</div></div></body></html>
