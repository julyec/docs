<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
 <head>
  <meta http-equiv="content-type" content="text/html; CHARSET=UTF-8">
  <title>Get all binary values from a result entry</title>
<link media="all" rel="stylesheet" type="text/css" href="styles/03e73060321a0a848018724a6c83de7f-theme-base.css" />
<link media="all" rel="stylesheet" type="text/css" href="styles/03e73060321a0a848018724a6c83de7f-theme-medium.css" />

  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <link media="all" rel="stylesheet" type="text/css" href="style.css"/>
 </head>
 <body class="docs" class="docs"><div class="navbar navbar-fixed-top">
  <div class="navbar-inner clearfix">
    <ul class="nav" style="width: 100%">
      <li style="float: left;"><a href="function.ldap-get-option.html">? ldap_get_option</a></li>
      <li style="float: right;"><a href="function.ldap-get-values.html">ldap_get_values ?</a></li>
    </ul>
  </div>
</div>
<div id="breadcrumbs" class="clearfix">
  <ul class="breadcrumbs-container">
    <li><a href="index.html">PHP Manual</a></li>
    <li><a href="ref.ldap.html">LDAP 函数</a></li>
    <li>Get all binary values from a result entry</li>
  </ul>
</div>
<div id="layout">
  <div id="layout-content"><div id="function.ldap-get-values-len" class="refentry">
 <div class="refnamediv">
  <h1 class="refname">ldap_get_values_len</h1>
  <p class="verinfo">(PHP 4, PHP 5, PHP 7, PHP 8)</p><p class="refpurpose"><span class="refname">ldap_get_values_len</span> &mdash; <span class="dc-title">Get all binary values from a result entry</span></p>

 </div>
 
 <div class="refsect1 description" id="refsect1-function.ldap-get-values-len-description">
  <h3 class="title">说明</h3>
  <div class="methodsynopsis dc-description">
   <span class="methodname"><strong>ldap_get_values_len</strong></span>(<span class="methodparam"><span class="type"><a href="class.ldap-connection.html" class="type LDAP\Connection">LDAP\Connection</a></span> <code class="parameter">$ldap</code></span>, <span class="methodparam"><span class="type"><span class="type LDAP\ResultEntry">LDAP\ResultEntry</span></span> <code class="parameter">$entry</code></span>, <span class="methodparam"><span class="type">string</span> <code class="parameter">$attribute</code></span>): <span class="type"><span class="type">array</span>|<span class="type"><span class="type false">false</span></span></span></div>

  <p class="para rdfs-comment">
   Reads all the values of the attribute in the entry in the result.
  </p>
  <p class="para">
   This function is used exactly like <span class="function"><a href="function.ldap-get-values.html" class="function">ldap_get_values()</a></span>
   except that it handles binary data and not string data.
  </p>
 </div>


 <div class="refsect1 parameters" id="refsect1-function.ldap-get-values-len-parameters">
  <h3 class="title">参数</h3>
  <p class="para">
   <dl>
    
     <dt>
<code class="parameter">ldap</code></dt>

     <dd>

      <p class="para">
       通过 <span class="function"><a href="function.ldap-connect.html" class="function">ldap_connect()</a></span> 返回的 <span class="classname"><a href="class.ldap-connection.html" class="classname">LDAP\Connection</a></span> 实例。
      </p>
     </dd>

    
    
     <dt>
<code class="parameter">entry</code></dt>

     <dd>

      <p class="para">
       <span class="classname"><a href="class.ldap-result-entry.html" class="classname">LDAP\ResultEntry</a></span> 实例。
      </p>
     </dd>

    
    
     <dt>
<code class="parameter">attribute</code></dt>

     <dd>

      <p class="para">
      </p>
     </dd>

    
   </dl>

  </p>
 </div>


 <div class="refsect1 returnvalues" id="refsect1-function.ldap-get-values-len-returnvalues">
  <h3 class="title">返回值</h3>
  <p class="para">
   Returns an array of values for the attribute on success and <strong><code>false</code></strong> on
   error. Individual values are accessed by integer index in the array. The
   first index is 0. The number of values can be found by indexing &quot;count&quot;
   in the resultant array. 
  </p>
 </div>


 <div class="refsect1 changelog" id="refsect1-function.ldap-get-values-len-changelog">
  <h3 class="title">更新日志</h3>
  <table class="doctable informaltable">
   
    <thead>
     <tr>
      <th>版本</th>
      <th>说明</th>
     </tr>

    </thead>

    <tbody class="tbody">
     <tr>
 <td>8.1.0</td>
 <td>
  现在 <code class="parameter">ldap</code> 参数接受 <span class="classname"><a href="class.ldap-connection.html" class="classname">LDAP\Connection</a></span>
  实例，之前接受有效的 <code class="literal">ldap link</code> <a href="language.types.resource.html" class="link">资源(resource)</a>。
 </td>
</tr>

     <tr>
 <td>8.1.0</td>
 <td>
  The <code class="parameter">entry</code> parameter expects an <span class="classname"><a href="class.ldap-result-entry.html" class="classname">LDAP\ResultEntry</a></span>
  instance now; previously, a valid <code class="literal">ldap result entry</code> <a href="language.types.resource.html" class="link">资源(resource)</a> was expected.
 </td>
</tr>

    </tbody>
   
  </table>

 </div>


 <div class="refsect1 seealso" id="refsect1-function.ldap-get-values-len-seealso">
  <h3 class="title">参见</h3>
  <p class="para">
   <ul class="simplelist">
    <li class="member"><span class="function"><a href="function.ldap-get-values.html" class="function" rel="rdfs-seeAlso">ldap_get_values()</a> - Get all values from a result entry</span></li>
   </ul>
  </p>
 </div>


</div><div id="usernotes">
 <div class="head">
  <h3 class="title">User Contributed Notes</h3>
 </div>
<div id="allnotes">  <a name="119809""></a>
  <div class="note">
   <strong class="user">m1tk0123123 at abv dot bg</strong>
   <a href="#119809" class="date">30-Aug-2016 11:52</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Hi<br />
Here solution for WINDOWS objectsid:<br />
// LIB .............................<br />
class LDAP_OBJECT_SID {<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; public function toString($SID_BINARY) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $split = str_split($SID_BINARY, 8);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $hexArray = array();<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; foreach ($split as $key =&gt; $byte) { <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $hexArray[$key] = strToUpper(substr('0'.dechex(bindec($byte)), -2));&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $BLOCK_COUNT = hexdec($hexArray[1]);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $DEC_GROUP['SUB-ID-BLOCKS'] = array();<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; for ($i=0; $i&lt;$BLOCK_COUNT; $i++) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $offset = 8 + (4 * $i);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $DEC_GROUP['SUB-ID-BLOCKS'][$i] = array();<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $DEC_GROUP['SUB-ID-BLOCKS'][$i][1] = hexdec($hexArray[$offset+3]);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $DEC_GROUP['SUB-ID-BLOCKS'][$i][2] = hexdec($hexArray[$offset+2]);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $DEC_GROUP['SUB-ID-BLOCKS'][$i][3] = hexdec($hexArray[$offset+1]);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $DEC_GROUP['SUB-ID-BLOCKS'][$i][4] = hexdec($hexArray[$offset]);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $SID = 'S-'.hexdec($hexArray[0]).'-'.$this-&gt;byte6ToLong(<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; hexdec($hexArray[2]), <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; hexdec($hexArray[3]), <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; hexdec($hexArray[4]), <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; hexdec($hexArray[5]), <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; hexdec($hexArray[6]), <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; hexdec($hexArray[7])<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; );<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; foreach ($DEC_GROUP['SUB-ID-BLOCKS'] as $BLOCK) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $SID .= '-'.$this-&gt;byte4ToLong(<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $BLOCK[1], <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $BLOCK[2], <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $BLOCK[3], <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $BLOCK[4]<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; );<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return $SID;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; private function byte6ToLong($b1, $b2, $b3, $b4, $b5, $b6) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $byte6ToLong = $b1;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $byte6ToLong = $byte6ToLong*256 + $b2;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $byte6ToLong = $byte6ToLong*256 + $b3;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $byte6ToLong = $byte6ToLong*256 + $b4;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $byte6ToLong = $byte6ToLong*256 + $b5;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $byte6ToLong = $byte6ToLong*256 + $b6;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return $byte6ToLong;<br />
&nbsp;&nbsp;&nbsp; }&nbsp; <br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; private function byte4ToLong($b1, $b2, $b3, $b4) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $byte4ToLong = $b1;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $byte4ToLong = $byte4ToLong*256 + $b2;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $byte4ToLong = $byte4ToLong*256 + $b3;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $byte4ToLong = $byte4ToLong*256 + $b4;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return $byte4ToLong;<br />
&nbsp;&nbsp;&nbsp; }&nbsp;&nbsp; <br />
<br />
}<br />
<br />
TEST:<br />
<br />
$sr=ldap_search($conn, $base_dn, $filter,$fields);<br />
$entry = ldap_first_entry($conn, $sr);<br />
$objectsid_binary = ldap_get_values_len($conn, $entry, "objectsid");<br />
<br />
$Obj = new LDAP_OBJECT_SID();<br />
echo $Obj-&gt;toString($objectsid_binary[0]);</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="117700""></a>
  <div class="note">
   <strong class="user">gizmotronic at gmail dot com</strong>
   <a href="#117700" class="date">24-Jul-2015 04:30</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Revisiting the question of converting a binary objectGUID to a string, there's a simpler method that doesn't involve a lot of string manipulation:<br />
<br />
function GUIDtoStr($binary_guid) {<br />
&nbsp; $unpacked = unpack('Va/v2b/n2c/Nd', $binary_guid);<br />
&nbsp; return sprintf('%08X-%04X-%04X-%04X-%04X%08X', $unpacked['a'], $unpacked['b1'], $unpacked['b2'], $unpacked['c1'], $unpacked['c2'], $unpacked['d']);<br />
}<br />
<br />
You can of course replace "X" with "x" in the sprintf format string if you prefer lower-case hex digits.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="111899""></a>
  <div class="note">
   <strong class="user">ashwini at majestik dot net</strong>
   <a href="#111899" class="date">09-Apr-2013 10:52</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Just a minor update to the note below from "jhgustafsson" regarding the "objectGUID" field... <br />
<br />
Going a step further, sometimes its useful to display this GUID as a String, and Microsoft has a support article and script detailing how to convert objectGUID from Hex to String. That article is here: <a href="http://support.microsoft.com/default.aspx?scid=kb%3Ben-us%3B325649" rel="nofollow" target="_blank">http://support.microsoft.com/default.aspx?scid=kb%3Ben-us%3B325649</a><br />
<br />
Below is a PHP function that does the same thing as Microsoft's VB script, it takes input of objectGUID in binary format and returns it formatted as a string (after converting it to Hex as a middle step). This will return the exact "objectGUID" value that is displayed for any Active Directory object in ADUC.<br />
<br />
Example output: 3f79048f-42cd-4c77-8426-835cd9f8a3ad<br />
<br />
function GUIDtoStr($binary_guid) {<br />
&nbsp; $hex_guid = unpack("H*hex", $binary_guid); <br />
&nbsp; $hex = $hex_guid["hex"];<br />
&nbsp; <br />
&nbsp; $hex1 = substr($hex, -26, 2) . substr($hex, -28, 2) . substr($hex, -30, 2) . substr($hex, -32, 2);<br />
&nbsp; $hex2 = substr($hex, -22, 2) . substr($hex, -24, 2);<br />
&nbsp; $hex3 = substr($hex, -18, 2) . substr($hex, -20, 2);<br />
&nbsp; $hex4 = substr($hex, -16, 4);<br />
&nbsp; $hex5 = substr($hex, -12, 12);<br />
<br />
&nbsp; $guid_str = $hex1 . "-" . $hex2 . "-" . $hex3 . "-" . $hex4 . "-" . $hex5;<br />
<br />
&nbsp; return $guid_str;<br />
}</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="103586""></a>
  <div class="note">
   <strong class="user">Stav</strong>
   <a href="#103586" class="date">21-Apr-2011 05:38</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I had a lot of issues with decoding errors using ldap_get_values_len() and found a of unanswered calls for help on a lot of forums.
<br />

<br />
The error message is - Warning: ldap_get_values(): Cannot get the value(s) of attribute Decoding error in xxx.php.
<br />

<br />
It appears that this error seems to cover a multitude sins including simple typos in the attribute name.
<br />

<br />
After using PHP to list the attributes of a particular record I noticed that the attribute userCertificate wasn't listed simply as userCertificate but userCertificate;binary instead.&nbsp; I wrote this into my code and all was fixed.
<br />

<br />
So my code looks as follows.
<br />

<br />
<span class="default">&lt;?php
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">if (!</span><span class="default">$val </span><span class="keyword">= @</span><span class="default">ldap_get_values_len</span><span class="keyword">(</span><span class="default">$con</span><span class="keyword">, </span><span class="default">$entry</span><span class="keyword">, </span><span class="string">"</span><span class="default">$attribute</span><span class="string">;binary"</span><span class="keyword">))
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; die (</span><span class="string">'Error retrieving value (' </span><span class="keyword">. </span><span class="default">ldap_error</span><span class="keyword">(</span><span class="default">$con</span><span class="keyword">) . </span><span class="string">')'</span><span class="keyword">);
<br />
</span><span class="default">?&gt;
<br />
</span>
<br />
I hope this saves someone the pain I went through trawling Google for an answer.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="91251""></a>
  <div class="note">
   <strong class="user">jhgustafsson at gmail dot com</strong>
   <a href="#91251" class="date">02-Jun-2009 03:07</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Tried a couple of different ways to do this but this seems to work best:
<br />

<br />
<span class="default">&lt;?php
<br />
$info </span><span class="keyword">= </span><span class="default">ldap_first_entry</span><span class="keyword">(</span><span class="default">$ds</span><span class="keyword">,</span><span class="default">$sr</span><span class="keyword">);
<br />

<br />
</span><span class="comment">// get it binary-safe.
<br />
</span><span class="default">$bin_guid </span><span class="keyword">= </span><span class="default">ldap_get_values_len</span><span class="keyword">(</span><span class="default">$ds</span><span class="keyword">,</span><span class="default">$info</span><span class="keyword">,</span><span class="string">"objectguid"</span><span class="keyword">);
<br />

<br />
</span><span class="comment">// convert to hex, bin2hex failed here for me. Unpack() seems to work though.
<br />
</span><span class="default">$hex_guid </span><span class="keyword">= </span><span class="default">unpack</span><span class="keyword">(</span><span class="string">"H*hex"</span><span class="keyword">, </span><span class="default">$bin_guid</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">]);
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="90032""></a>
  <div class="note">
   <strong class="user">alexey_baranov at inbox dot ru</strong>
   <a href="#90032" class="date">02-Apr-2009 04:26</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
no more need to use ldap_get_values_len (). ldap_get_attributes() works well now.
<br />

<br />
<span class="default">&lt;?php
<br />
$attrs </span><span class="keyword">= </span><span class="default">ldap_get_attributes</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">cid</span><span class="keyword">, </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">re</span><span class="keyword">);
<br />
</span><span class="default">$hex_Sid</span><span class="keyword">= </span><span class="default">bin2hex</span><span class="keyword">(</span><span class="default">$attrs</span><span class="keyword">[</span><span class="string">'objectSid'</span><span class="keyword">][</span><span class="default">0</span><span class="keyword">]); </span><span class="comment">//returns 010500000000000515000000c94d7d363d787b17e77b80109d060000
<br />
</span><span class="default">$hex_GUID</span><span class="keyword">= </span><span class="default">bin2hex</span><span class="keyword">(</span><span class="default">$attrs</span><span class="keyword">[</span><span class="string">'objectGUID'</span><span class="keyword">][</span><span class="default">0</span><span class="keyword">]); </span><span class="comment">//returns 710234bbc2abc148ade8c1f9b4567b24
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="73717""></a>
  <div class="note">
   <strong class="user">derek dot ethier at gmail dot com</strong>
   <a href="#73717" class="date">07-Mar-2007 11:25</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
One more function to add that complements the bin_to_str_guid function I posted below:<br />
<br />
// This function will convert a string GUID value into a HEX value to search AD.<br />
function str_to_hex_guid($str_guid) {<br />
&nbsp;&nbsp;&nbsp; $str_guid = str_replace('-', '', $str_guid);<br />
<br />
&nbsp;&nbsp;&nbsp; $octet_str = substr($str_guid, 6, 2);<br />
&nbsp;&nbsp;&nbsp; $octet_str .= substr($str_guid, 4, 2);<br />
&nbsp;&nbsp;&nbsp; $octet_str .= substr($str_guid, 2, 2);<br />
&nbsp;&nbsp;&nbsp; $octet_str .= substr($str_guid, 0, 2);<br />
&nbsp;&nbsp;&nbsp; $octet_str .= substr($str_guid, 10, 2);<br />
&nbsp;&nbsp;&nbsp; $octet_str .= substr($str_guid, 8, 2);<br />
&nbsp;&nbsp;&nbsp; $octet_str .= substr($str_guid, 14, 2);<br />
&nbsp;&nbsp;&nbsp; $octet_str .= substr($str_guid, 12, 2);<br />
&nbsp;&nbsp;&nbsp; $octet_str .= substr($str_guid, 16, strlen($str_guid));<br />
<br />
&nbsp;&nbsp;&nbsp; return $octet_str;<br />
}<br />
<br />
If you want to convert the string GUID back to the HEX format (required if you want to search AD based on the GUID string, make sure you escape the HEX string with double backslashes when searching -- ie. \\AE\\0F\\88...).</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="73198""></a>
  <div class="note">
   <strong class="user">derek dot ethier at gmail dot com</strong>
   <a href="#73198" class="date">12-Feb-2007 07:49</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
To elaborate on rcrow's post, if you want to convert the objectSID value to a usable string (from Active Directory) the following function will do the trick (this was borrowed from another section of the manual, just thought I'd add it here):<br />
<br />
// Returns the textual SID<br />
function bin_to_str_sid($binsid) {<br />
&nbsp;&nbsp;&nbsp; $hex_sid = bin2hex($binsid);<br />
&nbsp;&nbsp;&nbsp; $rev = hexdec(substr($hex_sid, 0, 2));<br />
&nbsp;&nbsp;&nbsp; $subcount = hexdec(substr($hex_sid, 2, 2));<br />
&nbsp;&nbsp;&nbsp; $auth = hexdec(substr($hex_sid, 4, 12));<br />
&nbsp;&nbsp;&nbsp; $result&nbsp; &nbsp; = "$rev-$auth";<br />
<br />
&nbsp;&nbsp;&nbsp; for ($x=0;$x &lt; $subcount; $x++) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $subauth[$x] = <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; hexdec($this-&gt;little_endian(substr($hex_sid, 16 + ($x * 8), 8)));<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $result .= "-" . $subauth[$x];<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp;&nbsp; // Cheat by tacking on the S-<br />
&nbsp;&nbsp;&nbsp; return 'S-' . $result;<br />
}<br />
<br />
// Converts a little-endian hex-number to one, that 'hexdec' can convert<br />
function little_endian($hex) {<br />
&nbsp;&nbsp;&nbsp; for ($x = strlen($hex) - 2; $x &gt;= 0; $x = $x - 2) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $result .= substr($hex, $x, 2);<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; return $result;<br />
}<br />
<br />
This function is not related to the ldap_get_values_len function but is still helpful if you want to convert the objectGUID binary value to a string format (converted from some vbscript provided by Richard Mueller):<br />
<br />
// This function will convert a binary value guid into a valid string.<br />
function bin_to_str_guid($object_guid) {<br />
&nbsp;&nbsp;&nbsp; $hex_guid = bin2hex($object_guid);<br />
&nbsp;&nbsp;&nbsp; $hex_guid_to_guid_str = '';<br />
&nbsp;&nbsp;&nbsp; for($k = 1; $k &lt;= 4; ++$k) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $hex_guid_to_guid_str .= substr($hex_guid, 8 - 2 * $k, 2);<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; $hex_guid_to_guid_str .= '-';<br />
&nbsp;&nbsp;&nbsp; for($k = 1; $k &lt;= 2; ++$k) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $hex_guid_to_guid_str .= substr($hex_guid, 12 - 2 * $k, 2);<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; $hex_guid_to_guid_str .= '-';<br />
&nbsp;&nbsp;&nbsp; for($k = 1; $k &lt;= 2; ++$k) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $hex_guid_to_guid_str .= substr($hex_guid, 16 - 2 * $k, 2);<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; $hex_guid_to_guid_str .= '-' . substr($hex_guid, 16, 4);<br />
&nbsp;&nbsp;&nbsp; $hex_guid_to_guid_str .= '-' . substr($hex_guid, 20);<br />
<br />
&nbsp;&nbsp;&nbsp; return strtoupper($hex_guid_to_guid_str);<br />
}<br />
<br />
Here's an example on how to use both:<br />
<br />
$filter="samaccountname=".$username;<br />
$fields=array("objectguid","objectsid");<br />
<br />
//establish the connection and specify the base_dn first. there are a lot of examples in the manual for this<br />
<br />
$sr=ldap_search($this-&gt;_conn,$this-&gt;_base_dn,$filter,$fields);<br />
$entries = ldap_get_entries($this-&gt;_conn, $sr);<br />
<br />
if (in_array("objectguid", $fields)) {<br />
&nbsp;&nbsp;&nbsp; $entries[0]["objectguid"][0]=<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $this-&gt;bin_to_str_guid($entries[0]["objectguid"][0]);<br />
}<br />
<br />
if (in_array("objectsid", $fields)) {<br />
&nbsp;&nbsp;&nbsp; $entry = ldap_first_entry($this-&gt;_conn, $sr);<br />
&nbsp;&nbsp;&nbsp; $objectsid_binary = ldap_get_values_len($this-&gt;_conn, $entry, "objectsid");<br />
&nbsp;&nbsp;&nbsp; $entries[0]["objectsid"][0] = $this-&gt;bin_to_str_sid($objectsid_binary[0]);<br />
}<br />
<br />
Hope this helps someone!</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="42023""></a>
  <div class="note">
   <strong class="user">rcrow at NOSPAM dot laptv dot com</strong>
   <a href="#42023" class="date">29-Apr-2004 05:06</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you are trying to access BINARY DATA, such as ObjectSID within LDAP, you must first get an individual entry, as stated under ldap_get_values() function -- "This call needs a result_entry_identifier, so needs to be preceded by one of the ldap search calls and one of the calls to get an individual entry."<br />
<br />
The following code snippet will get the LDAP objectSID for a specific user.<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="comment">/* Get the binary objectsid entry&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; */<br />
/* Be sure that you have included the binary field in your ldap_search.&nbsp; &nbsp; */<br />
</span><span class="default">$criteria </span><span class="keyword">=&nbsp; </span><span class="string">"samaccountname=</span><span class="default">$ldapUser</span><span class="string">"</span><span class="keyword">;<br />
</span><span class="default">$justthese </span><span class="keyword">= array(</span><span class="string">"memberOf"</span><span class="keyword">, </span><span class="string">"objectsid"</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; <br />
</span><span class="default">$ldapSearchResult </span><span class="keyword">= </span><span class="default">ldap_search</span><span class="keyword">(</span><span class="default">$ldapConnectionResult</span><span class="keyword">, </span><span class="default">$ldapBase</span><span class="keyword">, </span><span class="default">$criteria</span><span class="keyword">, </span><span class="default">$justthese</span><span class="keyword">);<br />
&nbsp; <br />
if (</span><span class="default">ldap_count_entries</span><span class="keyword">(</span><span class="default">$ldapConnectionResult</span><span class="keyword">, </span><span class="default">$ldapSearchResult</span><span class="keyword">)){<br />
&nbsp;&nbsp; &nbsp; </span><span class="default">$ldapResults </span><span class="keyword">= </span><span class="default">ldap_get_entries</span><span class="keyword">(</span><span class="default">$ldapConnectionResult</span><span class="keyword">, </span><span class="default">$ldapSearchResult</span><span class="keyword">);<br />
<br />
&nbsp;&nbsp; </span><span class="default">$entry </span><span class="keyword">= </span><span class="default">ldap_first_entry</span><span class="keyword">(</span><span class="default">$ldapConnectionResult</span><span class="keyword">, </span><span class="default">$ldapSearchResult</span><span class="keyword">);<br />
&nbsp;&nbsp; </span><span class="default">$ldapBinary </span><span class="keyword">= </span><span class="default">ldap_get_values_len </span><span class="keyword">(</span><span class="default">$ldapConnectionResult</span><span class="keyword">, </span><span class="default">$entry</span><span class="keyword">, </span><span class="string">"objectsid"</span><span class="keyword">);<br />
<br />
</span><span class="comment">/* your code here */<br />
&nbsp; <br />
</span><span class="keyword">}<br />
</span><span class="default">?&gt;<br />
</span><br />
You then can use something like bin2hex to put the data in a more usable form.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
</div>
</div>
</div></div></body></html>
