<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
 <head>
  <meta http-equiv="content-type" content="text/html; CHARSET=UTF-8">
  <title>断言检测</title>
<link media="all" rel="stylesheet" type="text/css" href="styles/03e73060321a0a848018724a6c83de7f-theme-base.css" />
<link media="all" rel="stylesheet" type="text/css" href="styles/03e73060321a0a848018724a6c83de7f-theme-medium.css" />

  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <link media="all" rel="stylesheet" type="text/css" href="style.css"/>
 </head>
 <body class="docs" class="docs"><div class="navbar navbar-fixed-top">
  <div class="navbar-inner clearfix">
    <ul class="nav" style="width: 100%">
      <li style="float: left;"><a href="function.assert-options.html">? assert_options</a></li>
      <li style="float: right;"><a href="function.cli-get-process-title.html">cli_get_process_title ?</a></li>
    </ul>
  </div>
</div>
<div id="breadcrumbs" class="clearfix">
  <ul class="breadcrumbs-container">
    <li><a href="index.html">PHP Manual</a></li>
    <li><a href="ref.info.html">PHP 选项/信息 函数</a></li>
    <li>断言检测</li>
  </ul>
</div>
<div id="layout">
  <div id="layout-content"><div id="function.assert" class="refentry">
 <div class="refnamediv">
  <h1 class="refname">assert</h1>
  <p class="verinfo">(PHP 4, PHP 5, PHP 7, PHP 8)</p><p class="refpurpose"><span class="refname">assert</span> &mdash; <span class="dc-title">断言检测</span></p>

 </div>

 <div class="refsect1 description" id="refsect1-function.assert-description">
  <h3 class="title">说明</h3>
  <div class="methodsynopsis dc-description">
   <span class="methodname"><strong>assert</strong></span>(<span class="methodparam"><span class="type"><a href="language.types.declarations.html#language.types.declarations.mixed" class="type mixed">mixed</a></span> <code class="parameter">$assertion</code></span>, <span class="methodparam"><span class="type"><span class="type"><a href="class.throwable.html" class="type Throwable">Throwable</a></span>|<span class="type">string</span>|<span class="type">null</span></span> <code class="parameter">$description</code><span class="initializer"> = <strong><code>null</code></strong></span></span>): <span class="type">bool</span></div>

  <p class="para rdfs-comment">
   <span class="function"><strong>assert()</strong></span> 不是函数，而是语言结构。允许定义预期（expectations）：在开发和测试环境中生效的断言，但在生产环境中会优化掉以达到零成本。
  </p>
  <p class="para">
   断言应该只用于调试功能。其中一个用例是检查健全性的前提条件，应该始终为
   <strong><code>true</code></strong>，如果不满足这些条件，则表示存在某些编程错误。
   另一个用例是确保某些功能的存在，例如扩展函数或某些系统限制和特性。
  </p>
  <p class="para">
   由于断言可以配置为已消除，因此<em class="emphasis">不</em>应该用于普通运行时操作，比如检查输入参数。一般来说，代码应该在禁用断言检查的情况下仍然按预期运行。
  </p>
  <p class="para">
   <span class="function"><strong>assert()</strong></span> 将检查 <code class="parameter">assertion</code> 中指定的预期（expectations）是否成立。如果不成立，也就是结果为
   <strong><code>false</code></strong>，它将根据 <span class="function"><strong>assert()</strong></span> 的配置采取适当的操作。
  </p>

  <p class="para">
   <span class="function"><strong>assert()</strong></span> 的行为由以下 INI 设置决定：
   <table class="doctable table">
    <caption><strong>断言 配置选项</strong></caption>
    
     <thead>
      <tr>
       <th>名字</th>
       <th>默认</th>
       <th>说明</th>
       <th>更新日志</th>
      </tr>

     </thead>

     <tbody class="tbody">
      <tr>
       <td><a href="ini.core.html#ini.zend.assertions" class="link">zend.assertions</a></td>
       <td><code class="literal">1</code></td>
       <td>
        <ul class="simplelist">
         <li class="member">
          <code class="literal">1</code>：生成并执行代码（开发模式）
         </li>
         <li class="member">
          
          <code class="literal">0</code>：生成代码但在运行时跳转
         </li>
         <li class="member">
          <code class="literal">-1</code>：生成代码但在运行时跳转（生产模式）
         </li>
        </ul>
       </td>
       <td class="empty">&nbsp;</td>
      </tr>

      <tr>
       <td><a href="info.configuration.html#ini.assert.active" class="link">assert.active</a></td>
       <td><strong><code>true</code></strong></td>
       <td>
        为 <strong><code>false</code></strong> 时，<span class="function"><strong>assert()</strong></span> 将不会检查预期（expectation）并且无条件返回 <strong><code>true</code></strong>。
       </td>
       <td class="empty">&nbsp;</td>
      </tr>

      <tr>
       <td><a href="info.configuration.html#ini.assert.callback" class="link">assert.callback</a></td>
       <td><strong><code>null</code></strong></td>
       <td>
        当断言失败时，将调用用户定义的函数，其签名应该是：
        <div class="methodsynopsis dc-description">
         <span class="methodname"><strong>assert_callback</strong></span>(<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="methodparam"><span class="type">string</span> <code class="parameter">$file</code></span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="methodparam"><span class="type">int</span> <code class="parameter">$line</code></span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="methodparam"><span class="type">null</span> <code class="parameter">$assertion</code></span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="methodparam"><span class="type">string</span> <code class="parameter">$description</code><span class="initializer"> = ?</span></span><br>): <span class="type"><span class="type void">void</span></span></div>

       </td>
       <td>
        在 PHP 8.0.0 之前，回调的签名应该是：
        <div class="methodsynopsis dc-description"><span class="methodname"><strong>assert_callback</strong></span>(<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="methodparam"><span class="type">string</span> <code class="parameter">$file</code></span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="methodparam"><span class="type">int</span> <code class="parameter">$line</code></span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="methodparam"><span class="type">string</span> <code class="parameter">$assertion</code></span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="methodparam"><span class="type">string</span> <code class="parameter">$description</code><span class="initializer"> = ?</span></span><br>): <span class="type"><span class="type void">void</span></span></div>

       </td>
      </tr>

      <tr>
       <td><a href="info.configuration.html#ini.assert.exception" class="link">assert.exception</a></td>
       <td><strong><code>true</code></strong></td>
       <td>
        如果为 <strong><code>true</code></strong>，则如果不能满足预期（expectations），将抛出 <span class="classname"><a href="class.assertionerror.html" class="classname">AssertionError</a></span> 异常。
       </td>
       <td class="empty">&nbsp;</td>
      </tr>

      <tr>
       <td><a href="info.configuration.html#ini.assert.bail" class="link">assert.bail</a></td>
       <td><strong><code>false</code></strong></td>
       <td>
        为 <strong><code>true</code></strong> 时，如果预期（expectation）不支持，将会中止 PHP 脚本的执行。
       </td>
       <td class="empty">&nbsp;</td>
      </tr>

      <tr>
       <td><a href="info.configuration.html#ini.assert.warning" class="link">assert.warning</a></td>
       <td><strong><code>true</code></strong></td>
       <td>
        为 <strong><code>true</code></strong> 时，则如果预期（expectation）不支持，将发出 <strong><code>E_WARNING</code></strong> 警告。如果启用了
        <a href="info.configuration.html#ini.assert.exception" class="link">assert.exception</a>，此 INI 设置将无效。
       </td>
       <td class="empty">&nbsp;</td>
      </tr>

     </tbody>
    
   </table>


   以 <code class="literal">assert.</code> 开头的选项可以通过 <span class="function"><a href="function.assert-options.html" class="function">assert_options()</a></span>
   进行配置。然而，这并不推荐使用。
  </p>
 </div>


 <div class="refsect1 parameters" id="refsect1-function.assert-parameters">
  <h3 class="title">参数</h3>
  <p class="para">
   <dl>
    
     <dt>
<code class="parameter">assertion</code></dt>

     <dd>

      <p class="para">
       可以是任何带返回值的表达式，运行后的结果用于表示断言成功还是失败。
      </p>

      <div class="warning"><strong class="warning">Warning</strong>
       <p class="para">
        在 PHP 8.0.0 之前，如果 <code class="parameter">assertion</code> 是 <span class="type">string</span>，将解释为
        PHP 代码，并通过 <span class="function"><a href="function.eval.html" class="function">eval()</a></span> 执行。这个字符串将作为第三个参数传递给回调函数。这种行为在
        PHP 7.2.0 中<em class="emphasis">弃用</em>，并在 PHP 8.0.0 中<em class="emphasis">移除</em>。
       </p>
      </div>
     </dd>

    
    
     <dt>
<code class="parameter">description</code></dt>

     <dd>

      <p class="para">
       如果 <code class="parameter">description</code> 是 <span class="classname"><a href="class.throwable.html" class="classname">Throwable</a></span>
       的实例，只有在 <code class="parameter">assertion</code> 执行失败时才会抛出。
       <blockquote class="note"><p><strong class="note">Note</strong>: 
        <p class="para">
         自 PHP 8.0.0 开始，在调用可能定义的断言回调<em class="emphasis">之前</em>执行此操作。
        </p>
       </p></blockquote>
       <blockquote class="note"><p><strong class="note">Note</strong>: 
        <p class="para">
         自 PHP 8.0.0 开始，无论 <a href="info.configuration.html#ini.assert.exception" class="link">assert.exception</a> 的配置如何，都将会抛出该 <span class="type">object</span>。
        </p>
       </p></blockquote>
       <blockquote class="note"><p><strong class="note">Note</strong>: 
        <p class="para">
         自 PHP 8.0.0 开始，在这种情况下，<a href="info.configuration.html#ini.assert.bail" class="link">assert.bail</a> 设置不起作用。
        </p>
       </p></blockquote>
      </p>
      <p class="para">
       如果 <code class="parameter">description</code> 是 <span class="type">string</span>，当发出异常或警告时，将使用该消息。
       如果 <code class="parameter">assertion</code> 失败了，可选的 description 将会包括在失败信息里。
      </p>
      <p class="para">
       如果省略 <code class="parameter">description</code>，
       
       将在编译时创建默认 description，该 description 等于对 <span class="function"><strong>assert()</strong></span> 调用的源代码。
      </p>
     </dd>

    
   </dl>

  </p>
 </div>


 <div class="refsect1 returnvalues" id="refsect1-function.assert-returnvalues">
  <h3 class="title">返回值</h3>
  <p class="para">
   如果 <code class="parameter">assertion</code> 是 false 则返回 <strong><code>false</code></strong>，否则为 <strong><code>true</code></strong>。
  </p>
 </div>


 <div class="refsect1 changelog" id="refsect1-function.assert-changelog">
  <h3 class="title">更新日志</h3>
  <p class="para">
   <table class="doctable informaltable">
    
     <thead>
      <tr>
       <th>版本</th>
       <th>说明</th>
      </tr>

     </thead>

     <tbody class="tbody">
      <tr>
       <td>8.0.0</td>
       <td>
         <span class="function"><strong>assert()</strong></span> 将不再对字符串参数求值，而是跟其他参数一样对待。应该使用 <code class="code">assert($a == $b)</code>
         替代 <code class="code">assert(&#039;$a == $b&#039;)</code>。已移除 <code class="literal">assert.quiet_eval</code> <var class="filename">php.ini</var> 指令和
         <strong><code>ASSERT_QUIET_EVAL</code></strong> 常量，因为它们不再有任何作用。
       </td>
      </tr>

      <tr>
       <td>8.0.0</td>
       <td>
        如果 <code class="parameter">description</code> 是 <span class="classname"><a href="class.throwable.html" class="classname">Throwable</a></span> 的实例，无论
        <a href="info.configuration.html#ini.assert.exception" class="link">assert.exception</a> 的值如何，如果断言失败，该对象都会被抛出。
       </td>
      </tr>

      <tr>
       <td>8.0.0</td>
       <td>
        如果 <code class="parameter">description</code> 是 <span class="classname"><a href="class.throwable.html" class="classname">Throwable</a></span> 的实例，即使设置了用户回调，也不会调用该回调。
       </td>
      </tr>

      <tr>
       <td>8.0.0</td>
       <td>
        不再允许在命名空间中声明叫做 <code class="literal">assert()</code> 的函数，并发出 <strong><code>E_COMPILE_ERROR</code></strong>。
       </td>
      </tr>

      <tr>
       <td>7.3.0</td>
       <td>
        弃用在命名空间中声明 <code class="literal">assert()</code> 函数。这样声明会发出 <strong><code>E_DEPRECATED</code></strong>。
       </td>
      </tr>

      <tr>
       <td>7.2.0</td>
       <td>
        弃用使用 <span class="type">string</span> 作为 <code class="parameter">assertion</code>。当 <a href="info.configuration.html#ini.assert.active" class="link">assert.active</a>
        和 <a href="ini.core.html#ini.zend.assertions" class="link">zend.assertions</a> 都设为 <code class="literal">1</code> 时，现在会发出
        <strong><code>E_DEPRECATED</code></strong> 通知。
       </td>
      </tr>

     </tbody>
    
   </table>

  </p>
 </div>


 <div class="refsect1 examples" id="refsect1-function.assert-examples">
  <h3 class="title">示例</h3>
  <div class="refsect2 unknown-unknown-exampleu" id="refsect2-function.assert-unknown-unknown-exampleu">
   <h4 class="title">Expectations</h4>
   <div class="example" id="example-1096">
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br />assert</span><span style="color: #007700">(</span><span style="color: #0000BB">true </span><span style="color: #007700">== </span><span style="color: #0000BB">false</span><span style="color: #007700">);<br />echo </span><span style="color: #DD0000">'Hi!'</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
    </div>

    <div class="example-contents"><p>
     <a href="ini.core.html#ini.zend.assertions" class="link">zend.assertions</a> 设为
     0，以上示例会输出：
    </p></div>
    <div class="example-contents screen">
<div class="cdata"><pre>
Hi!
</pre></div>
    </div>
    <div class="example-contents"><p>
     <a href="ini.core.html#ini.zend.assertions" class="link">zend.assertions</a> 设为
     1，<a href="info.configuration.html#ini.assert.exception" class="link">assert.exception</a> 设为
     0，以上示例会输出：
    </p></div>
    <div class="example-contents screen">
<div class="cdata"><pre>
Warning: assert(): assert(true == false) failed in - on line 2
Hi!
</pre></div>
    </div>
    <div class="example-contents"><p>
     <a href="ini.core.html#ini.zend.assertions" class="link">zend.assertions</a> 和
     <a href="info.configuration.html#ini.assert.exception" class="link">assert.exception</a> 都设为 1，以上示例会输出：
    </p></div>
    <div class="example-contents screen">
<div class="cdata"><pre>
Fatal error: Uncaught AssertionError: assert(true == false) in -:2
Stack trace:
#0 -(2): assert(false, &#039;assert(true == ...&#039;)
#1 {main}
  thrown in - on line 2
</pre></div>
    </div>
   </div>
   <div class="example" id="example-1098">
    <p><strong>Example #1 包含自定义异常的 Expectations</strong></p>
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br /></span><span style="color: #007700">class </span><span style="color: #0000BB">CustomError </span><span style="color: #007700">extends </span><span style="color: #0000BB">AssertionError </span><span style="color: #007700">{}<br /><br /></span><span style="color: #0000BB">assert</span><span style="color: #007700">(</span><span style="color: #0000BB">true </span><span style="color: #007700">== </span><span style="color: #0000BB">false</span><span style="color: #007700">, new </span><span style="color: #0000BB">CustomError</span><span style="color: #007700">(</span><span style="color: #DD0000">'True is not false!'</span><span style="color: #007700">));<br />echo </span><span style="color: #DD0000">'Hi!'</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
    </div>

    <div class="example-contents"><p>
     <a href="ini.core.html#ini.zend.assertions" class="link">zend.assertions</a> 设为
     0，以上示例会输出：
    </p></div>
    <div class="example-contents screen">
<div class="cdata"><pre>
Hi!
</pre></div>
    </div>
    <div class="example-contents"><p>
     <a href="ini.core.html#ini.zend.assertions" class="link">zend.assertions</a> 设为
     1，<a href="info.configuration.html#ini.assert.exception" class="link">assert.exception</a> 设为
     0，以上示例会输出：
    </p></div>
    <div class="example-contents screen">
<div class="cdata"><pre>
Warning: assert(): CustomError: True is not false! in -:4
Stack trace:
#0 {main} failed in - on line 4
Hi!
</pre></div>
    </div>
    <div class="example-contents"><p>
     <a href="ini.core.html#ini.zend.assertions" class="link">zend.assertions</a> 和
     <a href="info.configuration.html#ini.assert.exception" class="link">assert.exception</a> 都设为 1，以上示例会输出：
    </p></div>
    <div class="example-contents screen">
<div class="cdata"><pre>
Fatal error: Uncaught CustomError: True is not false! in -:4
Stack trace:
#0 {main}
  thrown in - on line 4
</pre></div>
    </div>
   </div>
  </div>

  <div class="refsect2 unknown-unknown-unknown-unknown-examplew" id="refsect2-function.assert-unknown-unknown-unknown-unknown-examplew">
   <h4 class="title">Evaluated code assertions (PHP 7 only)</h4>

   <p class="para">
    With evaluated code assertions, <span class="function"><strong>assert()</strong></span> callbacks
    can be particularly useful as the code used for the assertion is passed
    to the callback alongside information on where the assertion was done.
   </p>
   <p class="para">
    <div class="example" id="example-1100">
     <p><strong>Example #2 使用自定义处理程序处理失败的断言</strong></p>
     <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br /></span><span style="color: #FF8000">// Activate assert and make it quiet<br /></span><span style="color: #0000BB">assert_options</span><span style="color: #007700">(</span><span style="color: #0000BB">ASSERT_ACTIVE</span><span style="color: #007700">, </span><span style="color: #0000BB">1</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">assert_options</span><span style="color: #007700">(</span><span style="color: #0000BB">ASSERT_WARNING</span><span style="color: #007700">, </span><span style="color: #0000BB">0</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">assert_options</span><span style="color: #007700">(</span><span style="color: #0000BB">ASSERT_QUIET_EVAL</span><span style="color: #007700">, </span><span style="color: #0000BB">1</span><span style="color: #007700">);<br /><br /></span><span style="color: #FF8000">// Create a handler function<br /></span><span style="color: #007700">function </span><span style="color: #0000BB">my_assert_handler</span><span style="color: #007700">(</span><span style="color: #0000BB">$file</span><span style="color: #007700">, </span><span style="color: #0000BB">$line</span><span style="color: #007700">, </span><span style="color: #0000BB">$code</span><span style="color: #007700">)<br />{<br />    echo </span><span style="color: #DD0000">"&lt;hr&gt;Assertion Failed:<br />        File '</span><span style="color: #0000BB">$file</span><span style="color: #DD0000">'&lt;br /&gt;<br />        Line '</span><span style="color: #0000BB">$line</span><span style="color: #DD0000">'&lt;br /&gt;<br />        Code '</span><span style="color: #0000BB">$code</span><span style="color: #DD0000">'&lt;br /&gt;&lt;hr /&gt;"</span><span style="color: #007700">;<br />}<br /><br /></span><span style="color: #FF8000">// Set up the callback<br /></span><span style="color: #0000BB">assert_options</span><span style="color: #007700">(</span><span style="color: #0000BB">ASSERT_CALLBACK</span><span style="color: #007700">, </span><span style="color: #DD0000">'my_assert_handler'</span><span style="color: #007700">);<br /><br /></span><span style="color: #FF8000">// Make an assertion that should fail<br /></span><span style="color: #0000BB">$array </span><span style="color: #007700">= [];<br /></span><span style="color: #0000BB">assert</span><span style="color: #007700">(</span><span style="color: #DD0000">'count($array);'</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
     </div>

     <div class="example-contents"><p>Output of the above example in PHP 7.2:</p></div>
     <div class="example-contents screen">
<div class="cdata"><pre>
Deprecated: assert(): Calling assert() with a string argument is deprecated in test.php on line 21
&lt;hr&gt;Assertion Failed:
        File &#039;test.php&#039;&lt;br /&gt;
        Line &#039;21&#039;&lt;br /&gt;
        Code &#039;count($array);&#039;&lt;br /&gt;&lt;hr /&gt;
</pre></div>
     </div>
     <div class="example-contents"><p>以上示例在 PHP 7.1 中的输出：</p></div>
     <div class="example-contents screen">
<div class="cdata"><pre>
&lt;hr&gt;Assertion Failed:
        File &#039;test.php&#039;&lt;br /&gt;
        Line &#039;21&#039;&lt;br /&gt;
        Code &#039;count($array);&#039;&lt;br /&gt;&lt;hr /&gt;
</pre></div>
     </div>
    </div>
   </p>
   <p class="para">
    <div class="example" id="example-1102">
     <p><strong>Example #3 使用自定义处理程序打印 description</strong></p>
     <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br /></span><span style="color: #FF8000">// Activate assert and make it quiet<br /></span><span style="color: #0000BB">assert_options</span><span style="color: #007700">(</span><span style="color: #0000BB">ASSERT_ACTIVE</span><span style="color: #007700">, </span><span style="color: #0000BB">1</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">assert_options</span><span style="color: #007700">(</span><span style="color: #0000BB">ASSERT_WARNING</span><span style="color: #007700">, </span><span style="color: #0000BB">0</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">assert_options</span><span style="color: #007700">(</span><span style="color: #0000BB">ASSERT_QUIET_EVAL</span><span style="color: #007700">, </span><span style="color: #0000BB">1</span><span style="color: #007700">);<br /><br /></span><span style="color: #FF8000">// Create a handler function<br /></span><span style="color: #007700">function </span><span style="color: #0000BB">my_assert_handler</span><span style="color: #007700">(</span><span style="color: #0000BB">$file</span><span style="color: #007700">, </span><span style="color: #0000BB">$line</span><span style="color: #007700">, </span><span style="color: #0000BB">$code</span><span style="color: #007700">, </span><span style="color: #0000BB">$desc </span><span style="color: #007700">= </span><span style="color: #0000BB">null</span><span style="color: #007700">)<br />{<br />    echo </span><span style="color: #DD0000">"Assertion failed at </span><span style="color: #0000BB">$file</span><span style="color: #DD0000">:</span><span style="color: #0000BB">$line</span><span style="color: #DD0000">: </span><span style="color: #0000BB">$code</span><span style="color: #DD0000">"</span><span style="color: #007700">;<br />    if (</span><span style="color: #0000BB">$desc</span><span style="color: #007700">) {<br />        echo </span><span style="color: #DD0000">": </span><span style="color: #0000BB">$desc</span><span style="color: #DD0000">"</span><span style="color: #007700">;<br />    }<br />    echo </span><span style="color: #DD0000">"\n"</span><span style="color: #007700">;<br />}<br /><br /></span><span style="color: #FF8000">// Set up the callback<br /></span><span style="color: #0000BB">assert_options</span><span style="color: #007700">(</span><span style="color: #0000BB">ASSERT_CALLBACK</span><span style="color: #007700">, </span><span style="color: #DD0000">'my_assert_handler'</span><span style="color: #007700">);<br /><br /></span><span style="color: #FF8000">// Make an assertion that should fail<br /></span><span style="color: #0000BB">assert</span><span style="color: #007700">(</span><span style="color: #DD0000">'2 &lt; 1'</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">assert</span><span style="color: #007700">(</span><span style="color: #DD0000">'2 &lt; 1'</span><span style="color: #007700">, </span><span style="color: #DD0000">'Two is less than one'</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
     </div>

     <div class="example-contents"><p>Output of the above example in PHP 7.2:</p></div>
     <div class="example-contents screen">
<div class="cdata"><pre>
Deprecated: assert(): Calling assert() with a string argument is deprecated in test.php on line 21
Assertion failed at test.php:21: 2 &lt; 1

Deprecated: assert(): Calling assert() with a string argument is deprecated in test.php on line 22
Assertion failed at test.php:22: 2 &lt; 1: Two is less than one
</pre></div>
     </div>
     <div class="example-contents"><p>以上示例在 PHP 7.1 中的输出：</p></div>
     <div class="example-contents screen">
<div class="cdata"><pre>
Assertion failed at test.php:21: 2 &lt; 1
Assertion failed at test.php:22: 2 &lt; 1: Two is less than one
</pre></div>
     </div>
    </div>
   </p>
  </div>

 </div>


 <div class="refsect1 seealso" id="refsect1-function.assert-seealso">
  <h3 class="title">参见</h3>
  <p class="para">
   <ul class="simplelist">
    <li class="member"><span class="function"><a href="function.assert-options.html" class="function" rel="rdfs-seeAlso">assert_options()</a> - 设置/获取各种断言 flag</span></li>
   </ul>
  </p>
 </div>


</div><div id="usernotes">
 <div class="head">
  <h3 class="title">User Contributed Notes</h3>
 </div>
<div id="allnotes">  <a name="126781""></a>
  <div class="note">
   <strong class="user">Julien MOREAU aka PixEye</strong>
   <a href="#126781" class="date">19-Jan-2022 09:18</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
In order to change zend.assertions or assert.exception values, try with the ini_set() function but be aware that it may fail.<br />
<br />
Example:<br />
<span class="default">&lt;?php<br />
$ret </span><span class="keyword">= @</span><span class="default">ini_set</span><span class="keyword">(</span><span class="string">'zend.assertions'</span><span class="keyword">, </span><span class="string">'1'</span><span class="keyword">);<br />
if (</span><span class="default">$ret </span><span class="keyword">=== </span><span class="default">false</span><span class="keyword">) echo </span><span class="string">'ini_set() failed before line '</span><span class="keyword">, </span><span class="default">__LINE__</span><span class="keyword">, </span><span class="default">PHP_EOL</span><span class="keyword">;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="124272""></a>
  <div class="note">
   <strong class="user">Tom</strong>
   <a href="#124272" class="date">08-Oct-2019 09:01</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
When migrating older code to PHP 7.2+, you may get E_DEPRECATED warnings for every call to assert() you ever wrote, urging you to not pass the assertion as a string.<br />
<br />
It may be tempting to just run a regular expression across your files to convert all strings within "assert(...)" to statements. But, before you do that, be aware of the following caveat!<br />
<br />
For example, this code simply asserts that $input is not empty.<br />
<br />
assert('$input;');<br />
<br />
This works, because the string passed to assert() is evaluated as a PHP statement and the result cast to Boolean.<br />
<br />
If you want to have an equivalent statement that doesn't pass the first parameter as a string, your regular expression should rewrite this statement as:<br />
<br />
assert((bool) ($input));<br />
<br />
However, this looks a bit bulky and it is tempting to instead opt for the more direct approach to convert the above line to this:<br />
<br />
assert($input);<br />
<br />
But! This new statement will do one of three things:<br />
<br />
1) Looks as if it worked as intended because $input just happens to be Boolean to begin with<br />
2) Throw a parse error if $input is a string (best case)<br />
3) Allow an attacker on a poorly configured server to execute arbitrary PHP-Code (worst case)<br />
<br />
The reason is that, even though on PHP 7.2+ a E_DEPRECATED warning is raised, if assert() finds the first parameter to be a string, it will still execute it as PHP-Code, just as if it was called with a string to begin with.<br />
<br />
If an attacker finds a way to manipulate the contents of $input, you might end up with a remote code execution vulnerability. So just be extra careful when migrating assertions.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="122198""></a>
  <div class="note">
   <strong class="user">jason at jaypha dot com</strong>
   <a href="#122198" class="date">29-Dec-2017 11:13</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
You can take advantage of how assert is handled to use it for crude conditional compilation.<br />
<br />
For example<br />
<br />
<span class="default">&lt;?php<br />
&nbsp; assert</span><span class="keyword">(print(</span><span class="string">"Some debug message\n"</span><span class="keyword">));<br />
&nbsp; </span><span class="default">assert</span><span class="keyword">((</span><span class="default">$val </span><span class="keyword">= </span><span class="string">"dev"</span><span class="keyword">) || </span><span class="default">true</span><span class="keyword">);<br />
</span><span class="default">?&gt;<br />
</span><br />
Since print() always returns 1, the topmost assertion will pass. For others, you may need to add a || true. Always enclose the expression in ().<br />
<br />
In a development environment where zend.assertions=1, the above code will execute. In production environments where zend.assertions=-1, it wont even compile, thus not burdening performance.<br />
<br />
Another, more real world, example.<br />
<br />
<span class="default">&lt;?php<br />
&nbsp; $cssSrc </span><span class="keyword">= </span><span class="string">'https://code.jquery.com/jquery-3.2.1.min.js'</span><span class="keyword">;<br />
&nbsp; </span><span class="default">assert</span><span class="keyword">((</span><span class="default">$cssSrc </span><span class="keyword">= </span><span class="string">'<a href="http://dev.local/jquery-3.2.1.js" rel="nofollow" target="_blank">http://dev.local/jquery-3.2.1.js</a>'</span><span class="keyword">) || </span><span class="default">true</span><span class="keyword">);<br />
&nbsp; echo </span><span class="string">"&lt;link rel='stylesheet' type='text/css' href='</span><span class="default">$cssSrc</span><span class="string">'/&gt;\n"</span><span class="keyword">;<br />
</span><span class="default">?&gt;<br />
</span><br />
In a production environment, The website will use the minified version from the CDN. In a development environment, a development version, sourced locally, will be used instead.<br />
<br />
Note: This will not work for everything. Only code that can be embedded in an expression will work.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="119790""></a>
  <div class="note">
   <strong class="user">Ben</strong>
   <a href="#119790" class="date">26-Aug-2016 09:51</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
if there was no 'warning' message when assertion failed (FALSE), try reset the error handler:<br />
<span class="default">&lt;?php<br />
set_error_handler </span><span class="keyword">( </span><span class="default">null </span><span class="keyword">);</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="113276""></a>
  <div class="note">
   <strong class="user">office dot stojmenovic at gmail dot com</strong>
   <a href="#113276" class="date">20-Sep-2013 12:35</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Example from Ikac Framework how they use assert()<br />
<br />
<span class="default">&lt;?php<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">/**<br />
&nbsp;&nbsp; &nbsp; * Set Assertion Debug<br />
&nbsp;&nbsp; &nbsp; * <br />
&nbsp;&nbsp; &nbsp; * This method will check the given assertion and take appropriate -<br />
&nbsp;&nbsp; &nbsp; * action if its result is FALSE. <br />
&nbsp;&nbsp; &nbsp; * <br />
&nbsp;&nbsp; &nbsp; * This file is part of Ikac Framework.<br />
&nbsp;&nbsp; &nbsp; * <br />
&nbsp;&nbsp; &nbsp; * @package Ikac Framework<br />
&nbsp;&nbsp; &nbsp; * @author Ivan Stojmenovic Ikac &lt;contact.@stojmenovic.info&gt;<br />
&nbsp;&nbsp; &nbsp; * <br />
&nbsp;&nbsp; &nbsp; * @param mixed $assertion&nbsp; The assertion.<br />
&nbsp;&nbsp; &nbsp; * @param mixed $callback Callback to call on failed assertions<br />
&nbsp;&nbsp; &nbsp; * @param array $options&nbsp; Set the various control options or just query their current settings. <br />
&nbsp;&nbsp; &nbsp; * @param string $description&nbsp; An optional description that will be included in the failure message if the assertion fails. <br />
&nbsp;&nbsp; &nbsp; */<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">public function </span><span class="default">setAssertionDebug</span><span class="keyword">(</span><span class="default">$assertion</span><span class="keyword">, </span><span class="default">$callback</span><span class="keyword">, array </span><span class="default">$options</span><span class="keyword">, </span><span class="default">$description </span><span class="keyword">= </span><span class="default">null</span><span class="keyword">)<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">is_array</span><span class="keyword">(</span><span class="default">$options</span><span class="keyword">)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; foreach (</span><span class="default">$options </span><span class="keyword">AS </span><span class="default">$option </span><span class="keyword">=&gt; </span><span class="default">$value</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">assert_options</span><span class="keyword">(</span><span class="default">$option</span><span class="keyword">, </span><span class="default">$value</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">$callback</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">assert_options</span><span class="keyword">(</span><span class="default">ASSERT_CALLBACK</span><span class="keyword">, </span><span class="default">$callback</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">assert</span><span class="keyword">(</span><span class="default">$assertion</span><span class="keyword">, </span><span class="default">$description</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">?&gt;<br />
</span><br />
How to use:<br />
<br />
<span class="default">&lt;?php<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="keyword">use </span><span class="default">Ikac\Component\SystemBehaviour\OptionsInfo</span><span class="keyword">;<br />
<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">$system </span><span class="keyword">= new </span><span class="default">OptionsInfo</span><span class="keyword">();<br />
<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">$option </span><span class="keyword">= array(</span><span class="default">ASSERT_ACTIVE </span><span class="keyword">=&gt; </span><span class="default">1</span><span class="keyword">,</span><span class="default">ASSERT_WARNING </span><span class="keyword">=&gt; </span><span class="default">0</span><span class="keyword">,</span><span class="default">ASSERT_QUIET_EVAL </span><span class="keyword">=&gt; </span><span class="default">1</span><span class="keyword">);<br />
<br />
&nbsp;&nbsp; &nbsp; </span><span class="default">$system</span><span class="keyword">-&gt;</span><span class="default">setAssertionDebug</span><span class="keyword">(</span><span class="string">'2&lt;1'</span><span class="keyword">, function(){<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="string">"Assertion failed"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; }, </span><span class="default">$option</span><span class="keyword">);<br />
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="98521""></a>
  <div class="note">
   <strong class="user">uramihsayibok, gmail, com</strong>
   <a href="#98521" class="date">20-Jun-2010 01:48</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
There's a nice advantage to giving assert() some code to execute, as a string, rather than a simple true/false value: commenting.<br />
<br />
<span class="default">&lt;?php<br />
<br />
assert</span><span class="keyword">(</span><span class="string">'is_int($int) /* $int parameter must be an int, not just numeric */'</span><span class="keyword">);<br />
<br />
</span><span class="comment">// and my personal favorite<br />
</span><span class="default">assert</span><span class="keyword">(</span><span class="string">'false /* not yet implemented */'</span><span class="keyword">);<br />
<br />
</span><span class="default">?&gt;<br />
</span><br />
The comment will show up in the output (or in your assertion handler) and doesn't require someone debugging to go through your code trying to figure out why the assertion happened. That's no excuse to not comment your code, of course.<br />
<br />
You need to use a block comment (/*...*/) because a line comment (//...) creates an "unexpected $end" parse error in the evaluated code. Bug? Could be.<br />
(You can get around it with "false // not yet implemented\n" but that screws up the message)</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="84760""></a>
  <div class="note">
   <strong class="user">hodgman at ali dot com dot au</strong>
   <a href="#84760" class="date">28-Jul-2008 09:19</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
As noted on Wikipedia - "assertions are primarily a development tool, they are often disabled when a program is released to the public." and "Assertions should be used to document logically impossible situations and discover programming errors&mdash; if the 'impossible' occurs, then something fundamental is clearly wrong. This is distinct from error handling: most error conditions are possible, although some may be extremely unlikely to occur in practice. Using assertions as a general-purpose error handling mechanism is usually unwise: assertions do not allow for graceful recovery from errors, and an assertion failure will often halt the program's execution abruptly. Assertions also do not display a user-friendly error message."<br />
<br />
This means that the advice given by "gk at proliberty dot com" to force assertions to be enabled, even when they have been disabled manually, goes against best practices of only using them as a development tool.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="78176""></a>
  <div class="note">
   <strong class="user">Krzysztof &amp;#39;ChanibaL&amp;#39; Bociurko</strong>
   <a href="#78176" class="date">01-Oct-2007 06:13</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Note that func_get_args() should be used carefully and never in a string! For example:<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">function </span><span class="default">asserted_normal</span><span class="keyword">(</span><span class="default">$a</span><span class="keyword">, </span><span class="default">$b</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">assert</span><span class="keyword">(</span><span class="default">var_dump</span><span class="keyword">(</span><span class="default">func_get_args</span><span class="keyword">()));<br />
&nbsp;&nbsp;&nbsp; }<br />
function </span><span class="default">asserted_string</span><span class="keyword">(</span><span class="default">$a</span><span class="keyword">, </span><span class="default">$b</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">assert</span><span class="keyword">(</span><span class="string">'var_dump(func_get_args())'</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }<br />
</span><span class="default">?&gt;<br />
</span><br />
<span class="default">&lt;?php asserted_normal</span><span class="keyword">(</span><span class="default">1</span><span class="keyword">,</span><span class="default">2</span><span class="keyword">) </span><span class="default">?&gt;</span> prints<br />
array(2) {<br />
&nbsp; [0]=&gt;<br />
&nbsp; int(1)<br />
&nbsp; [1]=&gt;<br />
&nbsp; int(2)<br />
}<br />
<br />
but <span class="default">&lt;?php asserted_string</span><span class="keyword">(</span><span class="default">3</span><span class="keyword">,</span><span class="default">4</span><span class="keyword">) </span><span class="default">?&gt;</span> prints<br />
array(1) {<br />
&nbsp; [0]=&gt;<br />
&nbsp; string(25) "var_dump(func_get_args())"<br />
}<br />
<br />
This is because of that the string passed to assert() is being evaled inside assert, and not your function. Also, note that this works correctly, because of the eval scope:<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">function </span><span class="default">asserted_evaled_string</span><span class="keyword">(</span><span class="default">$a</span><span class="keyword">, </span><span class="default">$b</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">assert</span><span class="keyword">(eval(</span><span class="string">'var_dump(func_get_args())'</span><span class="keyword">));<br />
&nbsp;&nbsp;&nbsp; }<br />
</span><span class="default">asserted_evaled_string</span><span class="keyword">(</span><span class="default">5</span><span class="keyword">,</span><span class="default">6</span><span class="keyword">);<br />
</span><span class="default">?&gt;<br />
</span>array(2) {<br />
&nbsp; [0]=&gt;<br />
&nbsp; int(5)<br />
&nbsp; [1]=&gt;<br />
&nbsp; int(6)<br />
}<br />
<br />
(oh, and for simplicity's sake the evaled code doesn't return true, so&nbsp; don't worry that it fails assertion...)</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="69647""></a>
  <div class="note">
   <strong class="user">mail&lt;at&gt;aaron-mueller.de</strong>
   <a href="#69647" class="date">13-Sep-2006 10:51</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Here is a simple demonstration of Design By Contract with PHP<br />
<br />
<span class="default">&lt;?php<br />
<br />
assert_options</span><span class="keyword">(</span><span class="default">ASSERT_ACTIVE</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">);<br />
</span><span class="default">assert_options</span><span class="keyword">(</span><span class="default">ASSERT_WARNING</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">);<br />
</span><span class="default">assert_options</span><span class="keyword">(</span><span class="default">ASSERT_BAIL</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">);<br />
</span><span class="default">assert_options</span><span class="keyword">(</span><span class="default">ASSERT_CALLBACK</span><span class="keyword">, </span><span class="string">'dcb_callback'</span><span class="keyword">);<br />
<br />
function </span><span class="default">dcb_callback</span><span class="keyword">(</span><span class="default">$script</span><span class="keyword">, </span><span class="default">$line</span><span class="keyword">, </span><span class="default">$message</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; echo </span><span class="string">"&lt;h1&gt;Condition failed!&lt;/h1&gt;&lt;br /&gt;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; Script: &lt;strong&gt;</span><span class="default">$script</span><span class="string">&lt;/strong&gt;&lt;br /&gt;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; Line: &lt;strong&gt;</span><span class="default">$line</span><span class="string">&lt;/strong&gt;&lt;br /&gt;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; Condition: &lt;br /&gt;&lt;pre&gt;</span><span class="default">$message</span><span class="string">&lt;/pre&gt;"</span><span class="keyword">;<br />
}<br />
<br />
</span><span class="comment">// Parameters<br />
</span><span class="default">$a </span><span class="keyword">= </span><span class="default">5</span><span class="keyword">;<br />
</span><span class="default">$b </span><span class="keyword">= </span><span class="string">'Simple DCB with PHP'</span><span class="keyword">;<br />
<br />
</span><span class="comment">// Pre-Condition<br />
</span><span class="default">assert</span><span class="keyword">(</span><span class="string">'<br />
&nbsp;&nbsp;&nbsp; is_integer($a) &amp;&amp;<br />
&nbsp;&nbsp;&nbsp; ($a &gt; 0) &amp;&amp;<br />
&nbsp;&nbsp;&nbsp; ($a &lt; 20) &amp;&amp;<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; is_string($b) &amp;&amp;<br />
&nbsp;&nbsp;&nbsp; (strlen($b) &gt; 5);<br />
'</span><span class="keyword">);<br />
<br />
</span><span class="comment">// Function<br />
</span><span class="keyword">function </span><span class="default">combine</span><span class="keyword">(</span><span class="default">$a</span><span class="keyword">, </span><span class="default">$b</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; return </span><span class="string">"Kombined: " </span><span class="keyword">. </span><span class="default">$b </span><span class="keyword">. </span><span class="default">$a</span><span class="keyword">;<br />
}<br />
<br />
</span><span class="default">$result </span><span class="keyword">= </span><span class="default">combine</span><span class="keyword">(</span><span class="default">$a</span><span class="keyword">, </span><span class="default">$b</span><span class="keyword">);<br />
<br />
</span><span class="comment">// Post-Condition<br />
</span><span class="default">assert</span><span class="keyword">(</span><span class="string">'<br />
&nbsp;&nbsp;&nbsp; is_string($result) &amp;&amp;<br />
&nbsp;&nbsp;&nbsp; (strlen($result) &gt; 0);<br />
'</span><span class="keyword">);<br />
<br />
</span><span class="comment">// All right, the Function works fine<br />
</span><span class="default">var_dump</span><span class="keyword">(</span><span class="default">$result</span><span class="keyword">);<br />
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
</div>
</div>
</div></div></body></html>
