<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
 <head>
  <meta http-equiv="content-type" content="text/html; CHARSET=UTF-8">
  <title>解析 XML 数据到数组中</title>
<link media="all" rel="stylesheet" type="text/css" href="styles/03e73060321a0a848018724a6c83de7f-theme-base.css" />
<link media="all" rel="stylesheet" type="text/css" href="styles/03e73060321a0a848018724a6c83de7f-theme-medium.css" />

  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <link media="all" rel="stylesheet" type="text/css" href="style.css"/>
 </head>
 <body class="docs" class="docs"><div class="navbar navbar-fixed-top">
  <div class="navbar-inner clearfix">
    <ul class="nav" style="width: 100%">
      <li style="float: left;"><a href="function.xml-get-error-code.html">? xml_get_error_code</a></li>
      <li style="float: right;"><a href="function.xml-parse.html">xml_parse ?</a></li>
    </ul>
  </div>
</div>
<div id="breadcrumbs" class="clearfix">
  <ul class="breadcrumbs-container">
    <li><a href="index.html">PHP Manual</a></li>
    <li><a href="ref.xml.html">XML 解析器函数</a></li>
    <li>解析 XML 数据到数组中</li>
  </ul>
</div>
<div id="layout">
  <div id="layout-content"><div id="function.xml-parse-into-struct" class="refentry">
 <div class="refnamediv">
  <h1 class="refname">xml_parse_into_struct</h1>
  <p class="verinfo">(PHP 4, PHP 5, PHP 7, PHP 8)</p><p class="refpurpose"><span class="refname">xml_parse_into_struct</span> &mdash; <span class="dc-title">解析 XML 数据到数组中</span></p>

 </div>
 
 <div class="refsect1 description" id="refsect1-function.xml-parse-into-struct-description">
  <h3 class="title">说明</h3>
  <div class="methodsynopsis dc-description">
   <span class="methodname"><strong>xml_parse_into_struct</strong></span>(<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="methodparam"><span class="type"><a href="class.xmlparser.html" class="type XMLParser">XMLParser</a></span> <code class="parameter">$parser</code></span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="methodparam"><span class="type">string</span> <code class="parameter">$data</code></span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="methodparam"><span class="type">array</span> <code class="parameter reference">&$values</code></span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="methodparam"><span class="type">array</span> <code class="parameter reference">&$index</code><span class="initializer"> = <strong><code>null</code></strong></span></span><br>): <span class="type">int</span></div>

  <p class="para rdfs-comment">
   该函数解析 XML 字符串到两个对应的数组中，一个（<code class="parameter">index</code>）含有指向 <code class="parameter">values</code>
   数组中对应值的指针。最后两个参数必须通过引用传递。
  </p>
 </div>


 <div class="refsect1 parameters" id="refsect1-function.xml-parse-into-struct-parameters">
  <h3 class="title">参数</h3>
  <p class="para">
   <dl>
    
     <dt>
<code class="parameter">parser</code></dt>

     <dd>

      <p class="para">
       引用的 XML 解析器。
      </p>
     </dd>

    
    
     <dt>
<code class="parameter">data</code></dt>

     <dd>

      <p class="para">
       包含 XML 数据的字符串。
      </p>
     </dd>

    
    
     <dt>
<code class="parameter">values</code></dt>

     <dd>

      <p class="para">
       包含 XML 数据值的数组
      </p>
     </dd>

    
    
     <dt>
<code class="parameter">index</code></dt>

     <dd>

      <p class="para">
       包含指向 $values 中适当值位置的指针的数组。
      </p>
     </dd>

    
   </dl>

  </p>
 </div>


 <div class="refsect1 returnvalues" id="refsect1-function.xml-parse-into-struct-returnvalues">
  <h3 class="title">返回值</h3>
  <p class="para">
   <span class="function"><strong>xml_parse_into_struct()</strong></span> 失败时返回 0，成功返回 1。这和 <strong><code>false</code></strong> 与 <strong><code>true</code></strong> 不同，使用运算符（比如 ===）时要小心。
  </p>
 </div>


 <div class="refsect1 changelog" id="refsect1-function.xml-parse-into-struct-changelog">
  <h3 class="title">更新日志</h3>
  <table class="doctable informaltable">
   
    <thead>
     <tr>
      <th>版本</th>
      <th>说明</th>
     </tr>

    </thead>

    <tbody class="tbody">
     <tr>
 <td>8.0.0</td>
 <td>
  <code class="parameter">parser</code> 现在接受 <span class="classname"><a href="class.xmlparser.html" class="classname">XMLParser</a></span> 实例；之前接受有效的 <code class="literal">xml</code> <span class="type">resource</span>。
 </td>
</tr>

    </tbody>
   
  </table>

 </div>


 <div class="refsect1 examples" id="refsect1-function.xml-parse-into-struct-examples">
  <h3 class="title">示例</h3>
  <p class="para">
   下面的示例说明了函数生成的数组的内部结构。使用嵌入在 <code class="literal">para</code> 标签中的简单 <code class="literal">note</code> 标签，然后解析并打印出生成的结构：
   <div class="example" id="">
    <p><strong>Example #1 <span class="function"><strong>xml_parse_into_struct()</strong></span> 示例</strong></p>
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br />$simple </span><span style="color: #007700">= </span><span style="color: #DD0000">"&lt;para&gt;&lt;note&gt;simple note&lt;/note&gt;&lt;/para&gt;"</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">$p </span><span style="color: #007700">= </span><span style="color: #0000BB">xml_parser_create</span><span style="color: #007700">();<br /></span><span style="color: #0000BB">xml_parse_into_struct</span><span style="color: #007700">(</span><span style="color: #0000BB">$p</span><span style="color: #007700">, </span><span style="color: #0000BB">$simple</span><span style="color: #007700">, </span><span style="color: #0000BB">$vals</span><span style="color: #007700">, </span><span style="color: #0000BB">$index</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">xml_parser_free</span><span style="color: #007700">(</span><span style="color: #0000BB">$p</span><span style="color: #007700">);<br />echo </span><span style="color: #DD0000">"Index array\n"</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">print_r</span><span style="color: #007700">(</span><span style="color: #0000BB">$index</span><span style="color: #007700">);<br />echo </span><span style="color: #DD0000">"\nVals array\n"</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">print_r</span><span style="color: #007700">(</span><span style="color: #0000BB">$vals</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
    </div>

    <div class="example-contents"><p>
     运行以上代码，输出将是：
    </p></div>
    <div class="example-contents screen">
<div class="cdata"><pre>
Index array
Array
(
    [PARA] =&gt; Array
        (
            [0] =&gt; 0
            [1] =&gt; 2
        )

    [NOTE] =&gt; Array
        (
            [0] =&gt; 1
        )

)

Vals array
Array
(
    [0] =&gt; Array
        (
            [tag] =&gt; PARA
            [type] =&gt; open
            [level] =&gt; 1
        )

    [1] =&gt; Array
        (
            [tag] =&gt; NOTE
            [type] =&gt; complete
            [level] =&gt; 2
            [value] =&gt; simple note
        )

    [2] =&gt; Array
        (
            [tag] =&gt; PARA
            [type] =&gt; close
            [level] =&gt; 1
        )

)
</pre></div>
    </div>
   </div>
  </p>
  <p class="para">
   当 XML 文档很复杂时，事件驱动的解析（基于 expat 库）会变得复杂。此函数不会生成 DOM 风格对象，但会生成适合以树形方式遍历的结构。因此，可以轻松地创建表示 XML 文件中数据的对象。考虑以下表示氨基酸信息小型数据库的 XML 文件：
   <div class="example" id="">
    <p><strong>Example #2 moldb.xml - 分子信息的小型数据库</strong></p>
    <div class="example-contents">
<div class="xmlcode"><pre class="xmlcode">&lt;?xml version=&quot;1.0&quot;?&gt;
&lt;moldb&gt;

  &lt;molecule&gt;
      &lt;name&gt;Alanine&lt;/name&gt;
      &lt;symbol&gt;ala&lt;/symbol&gt;
      &lt;code&gt;A&lt;/code&gt;
      &lt;type&gt;hydrophobic&lt;/type&gt;
  &lt;/molecule&gt;

  &lt;molecule&gt;
      &lt;name&gt;Lysine&lt;/name&gt;
      &lt;symbol&gt;lys&lt;/symbol&gt;
      &lt;code&gt;K&lt;/code&gt;
      &lt;type&gt;charged&lt;/type&gt;
  &lt;/molecule&gt;

&lt;/moldb&gt;</pre>
</div>
    </div>

   </div>
    还有一些代码用来解析文档并生成相应对象：
   <div class="example" id="">
    <p><strong>Example #3 
     parsemoldb.php - 将 moldb.xml 解析到分子（molecular）对象的数组中
    </strong></p>
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br /><br /></span><span style="color: #007700">class </span><span style="color: #0000BB">AminoAcid </span><span style="color: #007700">{<br />    var </span><span style="color: #0000BB">$name</span><span style="color: #007700">;  </span><span style="color: #FF8000">// aa name<br />    </span><span style="color: #007700">var </span><span style="color: #0000BB">$symbol</span><span style="color: #007700">;    </span><span style="color: #FF8000">// three letter symbol<br />    </span><span style="color: #007700">var </span><span style="color: #0000BB">$code</span><span style="color: #007700">;  </span><span style="color: #FF8000">// one letter code<br />    </span><span style="color: #007700">var </span><span style="color: #0000BB">$type</span><span style="color: #007700">;  </span><span style="color: #FF8000">// hydrophobic, charged or neutral<br />    <br />    </span><span style="color: #007700">function </span><span style="color: #0000BB">__construct </span><span style="color: #007700">(</span><span style="color: #0000BB">$aa</span><span style="color: #007700">) <br />    {<br />        foreach (</span><span style="color: #0000BB">$aa </span><span style="color: #007700">as </span><span style="color: #0000BB">$k</span><span style="color: #007700">=&gt;</span><span style="color: #0000BB">$v</span><span style="color: #007700">)<br />            </span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">$k </span><span style="color: #007700">= </span><span style="color: #0000BB">$aa</span><span style="color: #007700">[</span><span style="color: #0000BB">$k</span><span style="color: #007700">];<br />    }<br />}<br /><br />function </span><span style="color: #0000BB">readDatabase</span><span style="color: #007700">(</span><span style="color: #0000BB">$filename</span><span style="color: #007700">) <br />{<br />    </span><span style="color: #FF8000">// read the XML database of aminoacids<br />    </span><span style="color: #0000BB">$data </span><span style="color: #007700">= </span><span style="color: #0000BB">file_get_contents</span><span style="color: #007700">(</span><span style="color: #0000BB">$filename</span><span style="color: #007700">);<br />    </span><span style="color: #0000BB">$parser </span><span style="color: #007700">= </span><span style="color: #0000BB">xml_parser_create</span><span style="color: #007700">();<br />    </span><span style="color: #0000BB">xml_parser_set_option</span><span style="color: #007700">(</span><span style="color: #0000BB">$parser</span><span style="color: #007700">, </span><span style="color: #0000BB">XML_OPTION_CASE_FOLDING</span><span style="color: #007700">, </span><span style="color: #0000BB">0</span><span style="color: #007700">);<br />    </span><span style="color: #0000BB">xml_parser_set_option</span><span style="color: #007700">(</span><span style="color: #0000BB">$parser</span><span style="color: #007700">, </span><span style="color: #0000BB">XML_OPTION_SKIP_WHITE</span><span style="color: #007700">, </span><span style="color: #0000BB">1</span><span style="color: #007700">);<br />    </span><span style="color: #0000BB">xml_parse_into_struct</span><span style="color: #007700">(</span><span style="color: #0000BB">$parser</span><span style="color: #007700">, </span><span style="color: #0000BB">$data</span><span style="color: #007700">, </span><span style="color: #0000BB">$values</span><span style="color: #007700">, </span><span style="color: #0000BB">$tags</span><span style="color: #007700">);<br />    </span><span style="color: #0000BB">xml_parser_free</span><span style="color: #007700">(</span><span style="color: #0000BB">$parser</span><span style="color: #007700">);<br /><br />    </span><span style="color: #FF8000">// loop through the structures<br />    </span><span style="color: #007700">foreach (</span><span style="color: #0000BB">$tags </span><span style="color: #007700">as </span><span style="color: #0000BB">$key</span><span style="color: #007700">=&gt;</span><span style="color: #0000BB">$val</span><span style="color: #007700">) {<br />        if (</span><span style="color: #0000BB">$key </span><span style="color: #007700">== </span><span style="color: #DD0000">"molecule"</span><span style="color: #007700">) {<br />            </span><span style="color: #0000BB">$molranges </span><span style="color: #007700">= </span><span style="color: #0000BB">$val</span><span style="color: #007700">;<br />            </span><span style="color: #FF8000">// each contiguous pair of array entries are the <br />            // lower and upper range for each molecule definition<br />            </span><span style="color: #007700">for (</span><span style="color: #0000BB">$i</span><span style="color: #007700">=</span><span style="color: #0000BB">0</span><span style="color: #007700">; </span><span style="color: #0000BB">$i </span><span style="color: #007700">&lt; </span><span style="color: #0000BB">count</span><span style="color: #007700">(</span><span style="color: #0000BB">$molranges</span><span style="color: #007700">); </span><span style="color: #0000BB">$i</span><span style="color: #007700">+=</span><span style="color: #0000BB">2</span><span style="color: #007700">) {<br />                </span><span style="color: #0000BB">$offset </span><span style="color: #007700">= </span><span style="color: #0000BB">$molranges</span><span style="color: #007700">[</span><span style="color: #0000BB">$i</span><span style="color: #007700">] + </span><span style="color: #0000BB">1</span><span style="color: #007700">;<br />                </span><span style="color: #0000BB">$len </span><span style="color: #007700">= </span><span style="color: #0000BB">$molranges</span><span style="color: #007700">[</span><span style="color: #0000BB">$i </span><span style="color: #007700">+ </span><span style="color: #0000BB">1</span><span style="color: #007700">] - </span><span style="color: #0000BB">$offset</span><span style="color: #007700">;<br />                </span><span style="color: #0000BB">$tdb</span><span style="color: #007700">[] = </span><span style="color: #0000BB">parseMol</span><span style="color: #007700">(</span><span style="color: #0000BB">array_slice</span><span style="color: #007700">(</span><span style="color: #0000BB">$values</span><span style="color: #007700">, </span><span style="color: #0000BB">$offset</span><span style="color: #007700">, </span><span style="color: #0000BB">$len</span><span style="color: #007700">));<br />            }<br />        } else {<br />            continue;<br />        }<br />    }<br />    return </span><span style="color: #0000BB">$tdb</span><span style="color: #007700">;<br />}<br /><br />function </span><span style="color: #0000BB">parseMol</span><span style="color: #007700">(</span><span style="color: #0000BB">$mvalues</span><span style="color: #007700">) <br />{<br />    for (</span><span style="color: #0000BB">$i</span><span style="color: #007700">=</span><span style="color: #0000BB">0</span><span style="color: #007700">; </span><span style="color: #0000BB">$i </span><span style="color: #007700">&lt; </span><span style="color: #0000BB">count</span><span style="color: #007700">(</span><span style="color: #0000BB">$mvalues</span><span style="color: #007700">); </span><span style="color: #0000BB">$i</span><span style="color: #007700">++) {<br />        </span><span style="color: #0000BB">$mol</span><span style="color: #007700">[</span><span style="color: #0000BB">$mvalues</span><span style="color: #007700">[</span><span style="color: #0000BB">$i</span><span style="color: #007700">][</span><span style="color: #DD0000">"tag"</span><span style="color: #007700">]] = </span><span style="color: #0000BB">$mvalues</span><span style="color: #007700">[</span><span style="color: #0000BB">$i</span><span style="color: #007700">][</span><span style="color: #DD0000">"value"</span><span style="color: #007700">];<br />    }<br />    return new </span><span style="color: #0000BB">AminoAcid</span><span style="color: #007700">(</span><span style="color: #0000BB">$mol</span><span style="color: #007700">);<br />}<br /><br /></span><span style="color: #0000BB">$db </span><span style="color: #007700">= </span><span style="color: #0000BB">readDatabase</span><span style="color: #007700">(</span><span style="color: #DD0000">"moldb.xml"</span><span style="color: #007700">);<br />echo </span><span style="color: #DD0000">"** Database of AminoAcid objects:\n"</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">print_r</span><span style="color: #007700">(</span><span style="color: #0000BB">$db</span><span style="color: #007700">);<br /><br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
    </div>

   </div>
    在执行完 <var class="filename">parsemoldb.php</var> 后，变量 <var class="varname">$db</var> 将包含有由 <span class="classname"><strong class="classname">AminoAcid</strong></span> 对象组成的数组，该脚本的输出如下：
   <div class="informalexample">
    <div class="example-contents screen">
<div class="cdata"><pre>
** Database of AminoAcid objects:
Array
(
    [0] =&gt; aminoacid Object
        (
            [name] =&gt; Alanine
            [symbol] =&gt; ala
            [code] =&gt; A
            [type] =&gt; hydrophobic
        )

    [1] =&gt; aminoacid Object
        (
            [name] =&gt; Lysine
            [symbol] =&gt; lys
            [code] =&gt; K
            [type] =&gt; charged
        )

)
</pre></div>
    </div>
   </div>
  </p>
 </div>


</div><div id="usernotes">
 <div class="head">
  <h3 class="title">User Contributed Notes</h3>
 </div>
<div id="allnotes">  <a name="90621""></a>
  <div class="note">
   <strong class="user">Adam Tylmad</strong>
   <a href="#90621" class="date">30-Apr-2009 12:58</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Thanx to jukea i've upgraded the characterData-function to allow the value 0. Here is the new complete code:<br />
<br />
<span class="default">&lt;?php<br />
<br />
</span><span class="keyword">class </span><span class="default">XMLParser </span><span class="keyword">{<br />
&nbsp;&nbsp;&nbsp; var </span><span class="default">$path</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; var </span><span class="default">$result</span><span class="keyword">;<br />
<br />
&nbsp;&nbsp;&nbsp; function </span><span class="default">cleanString</span><span class="keyword">(</span><span class="default">$string</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">trim</span><span class="keyword">(</span><span class="default">str_replace</span><span class="keyword">(</span><span class="string">"'"</span><span class="keyword">, </span><span class="string">"&amp;#39;"</span><span class="keyword">, </span><span class="default">$string</span><span class="keyword">));<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; function </span><span class="default">XMLParser</span><span class="keyword">(</span><span class="default">$encoding</span><span class="keyword">, </span><span class="default">$data</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">path </span><span class="keyword">= </span><span class="string">"\$this-&gt;result"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">index </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$xml_parser </span><span class="keyword">= </span><span class="default">xml_parser_create</span><span class="keyword">(</span><span class="default">$encoding</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">xml_set_object</span><span class="keyword">(</span><span class="default">$xml_parser</span><span class="keyword">, &amp;</span><span class="default">$this</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">xml_set_element_handler</span><span class="keyword">(</span><span class="default">$xml_parser</span><span class="keyword">, </span><span class="string">'startElement'</span><span class="keyword">, </span><span class="string">'endElement'</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">xml_set_character_data_handler</span><span class="keyword">(</span><span class="default">$xml_parser</span><span class="keyword">, </span><span class="string">'characterData'</span><span class="keyword">);<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">xml_parse</span><span class="keyword">(</span><span class="default">$xml_parser</span><span class="keyword">, </span><span class="default">$data</span><span class="keyword">, </span><span class="default">true</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">xml_parser_free</span><span class="keyword">(</span><span class="default">$xml_parser</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; function </span><span class="default">startElement</span><span class="keyword">(</span><span class="default">$parser</span><span class="keyword">, </span><span class="default">$tag</span><span class="keyword">, </span><span class="default">$attributeList</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">path </span><span class="keyword">.= </span><span class="string">"-&gt;"</span><span class="keyword">.</span><span class="default">$tag</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; eval(</span><span class="string">"\$data = "</span><span class="keyword">.</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">path</span><span class="keyword">.</span><span class="string">";"</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">is_array</span><span class="keyword">(</span><span class="default">$data</span><span class="keyword">)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$index </span><span class="keyword">= </span><span class="default">sizeof</span><span class="keyword">(</span><span class="default">$data</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">path </span><span class="keyword">.= </span><span class="string">"["</span><span class="keyword">.</span><span class="default">$index</span><span class="keyword">.</span><span class="string">"]"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; } else if (</span><span class="default">is_object</span><span class="keyword">(</span><span class="default">$data</span><span class="keyword">)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; eval(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">path</span><span class="keyword">.</span><span class="string">" = array("</span><span class="keyword">.</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">path</span><span class="keyword">.</span><span class="string">");"</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">path </span><span class="keyword">.= </span><span class="string">"[1]"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; foreach(</span><span class="default">$attributeList </span><span class="keyword">as </span><span class="default">$name </span><span class="keyword">=&gt; </span><span class="default">$value</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; eval(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">path</span><span class="keyword">.</span><span class="string">"-&gt;"</span><span class="keyword">.</span><span class="default">$name</span><span class="keyword">. </span><span class="string">" = '"</span><span class="keyword">.</span><span class="default">XMLParser</span><span class="keyword">::</span><span class="default">cleanString</span><span class="keyword">(</span><span class="default">$value</span><span class="keyword">).</span><span class="string">"';"</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; function </span><span class="default">endElement</span><span class="keyword">(</span><span class="default">$parser</span><span class="keyword">, </span><span class="default">$tag</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">path </span><span class="keyword">= </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">path</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">strrpos</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">path</span><span class="keyword">, </span><span class="string">"-&gt;"</span><span class="keyword">));<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; function </span><span class="default">characterData</span><span class="keyword">(</span><span class="default">$parser</span><span class="keyword">, </span><span class="default">$data</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$data </span><span class="keyword">= </span><span class="default">XMLParser</span><span class="keyword">::</span><span class="default">cleanString</span><span class="keyword">(</span><span class="default">$data</span><span class="keyword">)))<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; eval(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">path</span><span class="keyword">.</span><span class="string">" = '</span><span class="default">$data</span><span class="string">';"</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }<br />
}<br />
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="87304""></a>
  <div class="note">
   <strong class="user">aerik at thesylvans dot com</strong>
   <a href="#87304" class="date">28-Nov-2008 03:55</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Here's another attempt at dealing with rebuilding the xml from the array.&nbsp; I'm basically preventing certain tags from being self closing by just checking for them explicitly (sure wish expat didn't interpret &lt;textarea /&gt; and &lt;textarea&gt;&lt;/textarea&gt; the same way (as "complete" tags).
<br />

<br />
<span class="default">&lt;?php
<br />
</span><span class="keyword">function </span><span class="default">array2xml</span><span class="keyword">(</span><span class="default">$xmlary</span><span class="keyword">){
<br />
&nbsp; </span><span class="default">$o</span><span class="keyword">=</span><span class="string">''</span><span class="keyword">;
<br />
&nbsp; foreach(</span><span class="default">$xmlary </span><span class="keyword">as </span><span class="default">$tag </span><span class="keyword">){
<br />
&nbsp;&nbsp;&nbsp; if(</span><span class="default">$tag</span><span class="keyword">[</span><span class="string">'tag'</span><span class="keyword">] == </span><span class="string">'textarea' </span><span class="keyword">&amp;&amp; !isset(</span><span class="default">$tag</span><span class="keyword">[</span><span class="string">'value'</span><span class="keyword">])){
<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="comment">//fake a value so it won't self close
<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">$tag</span><span class="keyword">[</span><span class="string">'value'</span><span class="keyword">]=</span><span class="string">''</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; }
<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">//tab space:
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$t </span><span class="keyword">= </span><span class="string">''</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; for(</span><span class="default">$i</span><span class="keyword">=</span><span class="default">1</span><span class="keyword">; </span><span class="default">$i </span><span class="keyword">&lt; </span><span class="default">$tag</span><span class="keyword">[</span><span class="string">'level'</span><span class="keyword">];</span><span class="default">$i</span><span class="keyword">++){
<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">$t</span><span class="keyword">.=</span><span class="string">"\t"</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; }
<br />
&nbsp;&nbsp;&nbsp; switch(</span><span class="default">$tag</span><span class="keyword">[</span><span class="string">'type'</span><span class="keyword">]){
<br />
&nbsp;&nbsp; &nbsp;&nbsp; case </span><span class="string">'complete'</span><span class="keyword">:
<br />
&nbsp;&nbsp; &nbsp;&nbsp; case </span><span class="string">'open'</span><span class="keyword">:
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$o</span><span class="keyword">.=</span><span class="default">$t</span><span class="keyword">.</span><span class="string">'&lt;'</span><span class="keyword">.</span><span class="default">$tag</span><span class="keyword">[</span><span class="string">'tag'</span><span class="keyword">];
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if(isset(</span><span class="default">$tag</span><span class="keyword">[</span><span class="string">'attributes'</span><span class="keyword">])){
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; foreach(</span><span class="default">$tag</span><span class="keyword">[</span><span class="string">'attributes'</span><span class="keyword">] as </span><span class="default">$attr</span><span class="keyword">=&gt;</span><span class="default">$aval</span><span class="keyword">){
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$o</span><span class="keyword">.=</span><span class="string">' '</span><span class="keyword">.</span><span class="default">$attr</span><span class="keyword">.</span><span class="string">'="'</span><span class="keyword">.</span><span class="default">$aval</span><span class="keyword">.</span><span class="string">'"'</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }</span><span class="comment">//foreach
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">}</span><span class="comment">//attributes
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">if(</span><span class="default">$tag</span><span class="keyword">[</span><span class="string">'type'</span><span class="keyword">] == </span><span class="string">'complete'</span><span class="keyword">){
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if(!isset(</span><span class="default">$tag</span><span class="keyword">[</span><span class="string">'value'</span><span class="keyword">])){
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$o </span><span class="keyword">.= </span><span class="string">' /&gt;'</span><span class="keyword">.</span><span class="string">"\n"</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; } else {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$o </span><span class="keyword">.= </span><span class="string">'&gt;'</span><span class="keyword">.</span><span class="string">"\n"</span><span class="keyword">.</span><span class="default">$t</span><span class="keyword">.</span><span class="default">$tag</span><span class="keyword">[</span><span class="string">'value'</span><span class="keyword">].</span><span class="string">"\n"</span><span class="keyword">.</span><span class="default">$t</span><span class="keyword">.</span><span class="string">'&lt;/'</span><span class="keyword">.</span><span class="default">$tag</span><span class="keyword">[</span><span class="string">'tag'</span><span class="keyword">].</span><span class="string">'&gt;'</span><span class="keyword">.</span><span class="string">"\n"</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }else{
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$o </span><span class="keyword">.= </span><span class="string">'&gt;'</span><span class="keyword">.</span><span class="string">"\n"</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; break;
<br />
&nbsp;&nbsp; &nbsp;&nbsp; case </span><span class="string">'close'</span><span class="keyword">:
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$o </span><span class="keyword">.= </span><span class="default">$t</span><span class="keyword">.</span><span class="string">'&lt;/'</span><span class="keyword">.</span><span class="default">$tag</span><span class="keyword">[</span><span class="string">'tag'</span><span class="keyword">].</span><span class="string">'&gt;'</span><span class="keyword">.</span><span class="string">"\n"</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; break;
<br />
&nbsp;&nbsp; &nbsp;&nbsp; case </span><span class="string">'cdata'</span><span class="keyword">:
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$o </span><span class="keyword">.= </span><span class="default">$t</span><span class="keyword">.</span><span class="default">$tag</span><span class="keyword">[</span><span class="string">'value'</span><span class="keyword">].</span><span class="string">"\n"</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; break;
<br />
&nbsp;&nbsp;&nbsp; }</span><span class="comment">//switch
<br />
&nbsp; </span><span class="keyword">}</span><span class="comment">//foreach
<br />
</span><span class="keyword">}
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="85948""></a>
  <div class="note">
   <strong class="user">dale at ucsc dot edu</strong>
   <a href="#85948" class="date">25-Sep-2008 04:16</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
here you can [re]assemble xml from a xml_parse_into_struct generated array: ie array2xml
<br />

<br />
<span class="default">&lt;?php
<br />
$xml_parser </span><span class="keyword">= </span><span class="default">xml_parser_create</span><span class="keyword">( </span><span class="string">'UTF-8' </span><span class="keyword">); </span><span class="comment">// UTF-8 or ISO-8859-1
<br />
</span><span class="default">xml_parser_set_option</span><span class="keyword">( </span><span class="default">$xml_parser</span><span class="keyword">, </span><span class="default">XML_OPTION_CASE_FOLDING</span><span class="keyword">, </span><span class="default">0 </span><span class="keyword">);
<br />
</span><span class="default">xml_parser_set_option</span><span class="keyword">( </span><span class="default">$xml_parser</span><span class="keyword">, </span><span class="default">XML_OPTION_SKIP_WHITE</span><span class="keyword">, </span><span class="default">1 </span><span class="keyword">);
<br />
</span><span class="default">xml_parse_into_struct</span><span class="keyword">( </span><span class="default">$xml_parser</span><span class="keyword">, </span><span class="default">$my_text_xml</span><span class="keyword">, </span><span class="default">$aryXML </span><span class="keyword">);
<br />
</span><span class="default">xml_parser_free</span><span class="keyword">(</span><span class="default">$xml_parser</span><span class="keyword">);
<br />

<br />
</span><span class="comment">//now use aryXML array to xml string:
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$o</span><span class="keyword">=</span><span class="string">''</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; foreach( </span><span class="default">$aryXML </span><span class="keyword">as </span><span class="default">$tag </span><span class="keyword">){
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">//tab space:
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">for(</span><span class="default">$i</span><span class="keyword">=</span><span class="default">1</span><span class="keyword">; </span><span class="default">$i </span><span class="keyword">&lt; </span><span class="default">$tag</span><span class="keyword">[</span><span class="string">'level'</span><span class="keyword">];</span><span class="default">$i</span><span class="keyword">++)
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$o</span><span class="keyword">.=</span><span class="string">"\t"</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">$tag</span><span class="keyword">[</span><span class="string">'type'</span><span class="keyword">]!=</span><span class="string">'close'</span><span class="keyword">){
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">$tag</span><span class="keyword">[</span><span class="string">'type'</span><span class="keyword">]!=</span><span class="string">'cdata'</span><span class="keyword">)
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$o</span><span class="keyword">.=</span><span class="string">'&lt;'</span><span class="keyword">.</span><span class="default">$tag</span><span class="keyword">[</span><span class="string">'tag'</span><span class="keyword">];
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if(isset(</span><span class="default">$tag</span><span class="keyword">[</span><span class="string">'attributes'</span><span class="keyword">])){&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; foreach(</span><span class="default">$tag</span><span class="keyword">[</span><span class="string">'attributes'</span><span class="keyword">] as </span><span class="default">$attr</span><span class="keyword">=&gt;</span><span class="default">$aval</span><span class="keyword">){
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$o</span><span class="keyword">.=</span><span class="string">' '</span><span class="keyword">.</span><span class="default">$attr</span><span class="keyword">.</span><span class="string">'="'</span><span class="keyword">.</span><span class="default">$aval</span><span class="keyword">.</span><span class="string">'"'</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">$tag</span><span class="keyword">[</span><span class="string">'type'</span><span class="keyword">]!=</span><span class="string">'cdata'</span><span class="keyword">){
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$o</span><span class="keyword">.=(</span><span class="default">$tag</span><span class="keyword">[</span><span class="string">'type'</span><span class="keyword">]==</span><span class="string">'complete'</span><span class="keyword">)?</span><span class="string">'/&gt;'</span><span class="keyword">.</span><span class="string">"\n"</span><span class="keyword">:</span><span class="string">'&gt;'</span><span class="keyword">.</span><span class="string">"\n"</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$o</span><span class="keyword">.=(isset(</span><span class="default">$tag</span><span class="keyword">[</span><span class="string">'value'</span><span class="keyword">]))?</span><span class="default">$tag</span><span class="keyword">[</span><span class="string">'value'</span><span class="keyword">]:</span><span class="string">''</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }else{
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$o</span><span class="keyword">.=</span><span class="string">'&lt;/'</span><span class="keyword">.</span><span class="default">$tag</span><span class="keyword">[</span><span class="string">'tag'</span><span class="keyword">].</span><span class="string">'&gt;'</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="85636""></a>
  <div class="note">
   <strong class="user">Llorenc</strong>
   <a href="#85636" class="date">09-Sep-2008 03:20</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Sorry, forgot my last post below, I confused CDATA sections (&lt;![CDATA[]]&gt;) with the value type "cdata", which despite its name it's very different! The first allows adding markup (&amp;,&lt;,&gt;) as regular text and the second is to indicate a not complete node between the open and close nodes. What is true is that the CDATA delimiters are lost after xml_parse_into_struct so it's not possible to revert the process.<br />
<br />
Please, feel free to remove my comments or leave them if you think they can help anyone.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="84261""></a>
  <div class="note">
   <strong class="user">wickedfather at hotmail dot com</strong>
   <a href="#84261" class="date">06-Jul-2008 12:33</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Had a comment up that was removed saying I'd found drawbacks, but here's a class what I wrote which works fine for me.&nbsp; Comments removed due to post restrictions.&nbsp; Pass the xml into the parse method or in the constructor.&nbsp; Php4 and 5 safe.<br />
<br />
class XMLThing<br />
{<br />
&nbsp;&nbsp;&nbsp; var $rawXML;<br />
&nbsp;&nbsp;&nbsp; var $valueArray = array();<br />
&nbsp;&nbsp;&nbsp; var $keyArray = array();<br />
&nbsp;&nbsp;&nbsp; var $parsed = array();<br />
&nbsp;&nbsp;&nbsp; var $index = 0;<br />
&nbsp;&nbsp;&nbsp; var $attribKey = 'attributes';<br />
&nbsp;&nbsp;&nbsp; var $valueKey = 'value';<br />
&nbsp;&nbsp;&nbsp; var $cdataKey = 'cdata';<br />
&nbsp;&nbsp;&nbsp; var $isError = false;<br />
&nbsp;&nbsp;&nbsp; var $error = '';<br />
<br />
&nbsp;&nbsp;&nbsp; function XMLThing($xml = NULL)<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $this-&gt;rawXML = $xml;<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp;&nbsp; function parse($xml = NULL)<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (!is_null($xml))<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $this-&gt;rawXML = $xml;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $this-&gt;isError = false;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (!$this-&gt;parse_init())<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return false;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $this-&gt;index = 0;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $this-&gt;parsed = $this-&gt;parse_recurse();<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $this-&gt;status = 'parsing complete';<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return $this-&gt;parsed;<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp;&nbsp; function parse_recurse()<br />
&nbsp;&nbsp;&nbsp; {&nbsp; &nbsp; &nbsp; &nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $found = array();<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $tagCount = array();<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; while (isset($this-&gt;valueArray[$this-&gt;index]))<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $tag = $this-&gt;valueArray[$this-&gt;index];<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $this-&gt;index++;<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if ($tag['type'] == 'close')<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return $found;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if ($tag['type'] == 'cdata')<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $tag['tag'] = $this-&gt;cdataKey;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $tag['type'] = 'complete';<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $tagName = $tag['tag'];<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (isset($tagCount[$tagName]))<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {&nbsp; &nbsp; &nbsp; &nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if ($tagCount[$tagName] == 1)<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $found[$tagName] = array($found[$tagName]);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $tagRef =&amp; $found[$tagName][$tagCount[$tagName]];<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $tagCount[$tagName]++;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; else&nbsp; &nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $tagCount[$tagName] = 1;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $tagRef =&amp; $found[$tagName];<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; switch ($tag['type'])<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; case 'open':<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $tagRef = $this-&gt;parse_recurse();<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (isset($tag['attributes']))<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $tagRef[$this-&gt;attribKey] = $tag['attributes'];<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (isset($tag['value']))<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (isset($tagRef[$this-&gt;cdataKey]))&nbsp; &nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $tagRef[$this-&gt;cdataKey] = (array)$tagRef[$this-&gt;cdataKey];&nbsp; &nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; array_unshift($tagRef[$this-&gt;cdataKey], $tag['value']);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; else<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $tagRef[$this-&gt;cdataKey] = $tag['value'];<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; break;<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; case 'complete':<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (isset($tag['attributes']))<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $tagRef[$this-&gt;attribKey] = $tag['attributes'];<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $tagRef =&amp; $tagRef[$this-&gt;valueKey];<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (isset($tag['value']))<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $tagRef = $tag['value'];<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; break;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return $found;<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp;&nbsp; function parse_init()<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $this-&gt;parser = xml_parser_create();<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $parser = $this-&gt;parser;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; xml_parser_set_option($parser, XML_OPTION_CASE_FOLDING, 0);&nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; xml_parser_set_option($parser, XML_OPTION_SKIP_WHITE, 1);&nbsp; &nbsp; &nbsp; &nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (!$res = (bool)xml_parse_into_struct($parser, $this-&gt;rawXML, $this-&gt;valueArray, $this-&gt;keyArray))<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $this-&gt;isError = true;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $this-&gt;error = 'error: '.xml_error_string(xml_get_error_code($parser)).' at line '.xml_get_current_line_number($parser);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; xml_parser_free($parser);<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return $res;<br />
&nbsp;&nbsp;&nbsp; }<br />
}</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="83881""></a>
  <div class="note">
   <strong class="user">jemptymethod at gmail dot com</strong>
   <a href="#83881" class="date">16-Jun-2008 01:39</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
@wickedfather, re: beaudurrant....I just cannot concur that the latter's class is "great"....First of all, it doesn't handle attributes.&nbsp; Second of all, as my code below demonstrates, there is no need waste processing by determining duplicates within their own loop.&nbsp; Thirdly, when there are duplicates, it collapses the layer in the array above the duplicates.<br />
<br />
Here is some much more consise code, though not (yet) object oriented, and also not yet handling attributes; it maintains a stack for each level:<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">function </span><span class="default">xml_parse_into_assoc</span><span class="keyword">(</span><span class="default">$file</span><span class="keyword">) {<br />
&nbsp; </span><span class="default">$data </span><span class="keyword">= </span><span class="default">implode</span><span class="keyword">(</span><span class="string">""</span><span class="keyword">, </span><span class="default">file</span><span class="keyword">(</span><span class="default">$file</span><span class="keyword">));<br />
&nbsp; </span><span class="default">$p </span><span class="keyword">= </span><span class="default">xml_parser_create</span><span class="keyword">();<br />
&nbsp; <br />
&nbsp; </span><span class="default">xml_parser_set_option</span><span class="keyword">(</span><span class="default">$p</span><span class="keyword">, </span><span class="default">XML_OPTION_CASE_FOLDING</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">);<br />
&nbsp; </span><span class="default">xml_parser_set_option</span><span class="keyword">(</span><span class="default">$p</span><span class="keyword">, </span><span class="default">XML_OPTION_SKIP_WHITE</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">);<br />
&nbsp; <br />
&nbsp; </span><span class="default">xml_parse_into_struct</span><span class="keyword">(</span><span class="default">$p</span><span class="keyword">, </span><span class="default">$data</span><span class="keyword">, </span><span class="default">$vals</span><span class="keyword">, </span><span class="default">$index</span><span class="keyword">);<br />
&nbsp; </span><span class="default">xml_parser_free</span><span class="keyword">(</span><span class="default">$p</span><span class="keyword">);<br />
<br />
&nbsp; </span><span class="default">$levels </span><span class="keyword">= array(</span><span class="default">null</span><span class="keyword">);<br />
&nbsp; <br />
&nbsp; foreach (</span><span class="default">$vals </span><span class="keyword">as </span><span class="default">$val</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; if (</span><span class="default">$val</span><span class="keyword">[</span><span class="string">'type'</span><span class="keyword">] == </span><span class="string">'open' </span><span class="keyword">|| </span><span class="default">$val</span><span class="keyword">[</span><span class="string">'type'</span><span class="keyword">] == </span><span class="string">'complete'</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp;&nbsp; if (!</span><span class="default">array_key_exists</span><span class="keyword">(</span><span class="default">$val</span><span class="keyword">[</span><span class="string">'level'</span><span class="keyword">], </span><span class="default">$levels</span><span class="keyword">)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$levels</span><span class="keyword">[</span><span class="default">$val</span><span class="keyword">[</span><span class="string">'level'</span><span class="keyword">]] = array();<br />
&nbsp;&nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$prevLevel </span><span class="keyword">=&amp; </span><span class="default">$levels</span><span class="keyword">[</span><span class="default">$val</span><span class="keyword">[</span><span class="string">'level'</span><span class="keyword">] - </span><span class="default">1</span><span class="keyword">];<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$parent </span><span class="keyword">= </span><span class="default">$prevLevel</span><span class="keyword">[</span><span class="default">sizeof</span><span class="keyword">(</span><span class="default">$prevLevel</span><span class="keyword">)-</span><span class="default">1</span><span class="keyword">]; <br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; if (</span><span class="default">$val</span><span class="keyword">[</span><span class="string">'type'</span><span class="keyword">] == </span><span class="string">'open'</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">$val</span><span class="keyword">[</span><span class="string">'children'</span><span class="keyword">] = array();<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">array_push</span><span class="keyword">(&amp;</span><span class="default">$levels</span><span class="keyword">[</span><span class="default">$val</span><span class="keyword">[</span><span class="string">'level'</span><span class="keyword">]], </span><span class="default">$val</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp;&nbsp; continue;<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; else if (</span><span class="default">$val</span><span class="keyword">[</span><span class="string">'type'</span><span class="keyword">] == </span><span class="string">'complete'</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">$parent</span><span class="keyword">[</span><span class="string">'children'</span><span class="keyword">][</span><span class="default">$val</span><span class="keyword">[</span><span class="string">'tag'</span><span class="keyword">]] = </span><span class="default">$val</span><span class="keyword">[</span><span class="string">'value'</span><span class="keyword">];<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; else if (</span><span class="default">$val</span><span class="keyword">[</span><span class="string">'type'</span><span class="keyword">] == </span><span class="string">'close'</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">$pop </span><span class="keyword">= </span><span class="default">array_pop</span><span class="keyword">(</span><span class="default">$levels</span><span class="keyword">[</span><span class="default">$val</span><span class="keyword">[</span><span class="string">'level'</span><span class="keyword">]]);<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">$tag </span><span class="keyword">= </span><span class="default">$pop</span><span class="keyword">[</span><span class="string">'tag'</span><span class="keyword">];<br />
&nbsp;&nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp;&nbsp; if (</span><span class="default">$parent</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (!</span><span class="default">array_key_exists</span><span class="keyword">(</span><span class="default">$tag</span><span class="keyword">, </span><span class="default">$parent</span><span class="keyword">[</span><span class="string">'children'</span><span class="keyword">])) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$parent</span><span class="keyword">[</span><span class="string">'children'</span><span class="keyword">][</span><span class="default">$tag</span><span class="keyword">] = </span><span class="default">$pop</span><span class="keyword">[</span><span class="string">'children'</span><span class="keyword">];<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; else if (</span><span class="default">is_array</span><span class="keyword">(</span><span class="default">$parent</span><span class="keyword">[</span><span class="string">'children'</span><span class="keyword">][</span><span class="default">$tag</span><span class="keyword">])) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$parent</span><span class="keyword">[</span><span class="string">'children'</span><span class="keyword">][</span><span class="default">$tag</span><span class="keyword">][] = </span><span class="default">$pop</span><span class="keyword">[</span><span class="string">'children'</span><span class="keyword">]; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp;&nbsp; else {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return(array(</span><span class="default">$pop</span><span class="keyword">[</span><span class="string">'tag'</span><span class="keyword">] =&gt; </span><span class="default">$pop</span><span class="keyword">[</span><span class="string">'children'</span><span class="keyword">]));<br />
&nbsp;&nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$prevLevel</span><span class="keyword">[</span><span class="default">sizeof</span><span class="keyword">(</span><span class="default">$prevLevel</span><span class="keyword">)-</span><span class="default">1</span><span class="keyword">] = </span><span class="default">$parent</span><span class="keyword">;<br />
&nbsp; }<br />
}<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="82476""></a>
  <div class="note">
   <strong class="user">wickedfather at hotmail dot com</strong>
   <a href="#82476" class="date">12-Apr-2008 08:36</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
To beaudurrant - that class is great and structures things in a very sensible way.&nbsp; Only problem is that it raises an error if a tag is empty, so would suggest a simple mod to the parse method just to add an isset test.<br />
<br />
if (isset($val['value']))<br />
{<br />
&nbsp;&nbsp;&nbsp; $this-&gt;setArrayValue($this-&gt;output, $stack, $val['value']);<br />
}</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="81704""></a>
  <div class="note">
   <strong class="user">mathiasrav at gmail dot com</strong>
   <a href="#81704" class="date">10-Mar-2008 08:42</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
In response to Anonymous' post at 26-Feb-2008 11:50:<br />
<br />
Saying that you "don't understand everything" isn't going to get you very popular - you should understand the code you use.<br />
foreach isn't *slow* in PHP, it is actually faster than the equivalent for-construct (which, in many cases, isn't available).<br />
<br />
The reason your script is slow is simply your use of xml_parse_into_struct - it reads the whole XML-string and doesn't return until it has parsed and validated it all. If you're looking for efficiency, you'll have to use the more low-level xml_parser_create, xml_set_*_handler functions. Then make sure you don't keep everything in a huge array before outputting it (at least don't if you're going for efficiency).</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="79922""></a>
  <div class="note">
   <strong class="user">beaudurrant at gmail dot com</strong>
   <a href="#79922" class="date">19-Dec-2007 11:23</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
This is extending what Alf Marius Foss Olsen had posted above.<br />
<br />
It takes into account array keys with the same name and uses an increment for them instead of overwriting the keys.<br />
<br />
I am using it for SOAP requests (20K - 150K) and it parses very fast compared to PEAR.<br />
<br />
&lt;?<br />
<br />
class XMLParser&nbsp; {<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; // raw xml<br />
&nbsp;&nbsp;&nbsp; private $rawXML;<br />
&nbsp;&nbsp;&nbsp; // xml parser<br />
&nbsp;&nbsp;&nbsp; private $parser = null;<br />
&nbsp;&nbsp;&nbsp; // array returned by the xml parser<br />
&nbsp;&nbsp;&nbsp; private $valueArray = array();<br />
&nbsp;&nbsp;&nbsp; private $keyArray = array();<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; // arrays for dealing with duplicate keys<br />
&nbsp;&nbsp;&nbsp; private $duplicateKeys = array();<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; // return data<br />
&nbsp;&nbsp;&nbsp; private $output = array();<br />
&nbsp;&nbsp;&nbsp; private $status;<br />
<br />
&nbsp;&nbsp;&nbsp; public function XMLParser($xml){<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $this-&gt;rawXML = $xml;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $this-&gt;parser = xml_parser_create();<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return $this-&gt;parse();<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp;&nbsp; private function parse(){<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $parser = $this-&gt;parser;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; xml_parser_set_option($parser, XML_OPTION_CASE_FOLDING, 0); // Dont mess with my cAsE sEtTings<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; xml_parser_set_option($parser, XML_OPTION_SKIP_WHITE, 1);&nbsp; &nbsp;&nbsp; // Dont bother with empty info<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if(!xml_parse_into_struct($parser, $this-&gt;rawXML, $this-&gt;valueArray, $this-&gt;keyArray)){<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $this-&gt;status = 'error: '.xml_error_string(xml_get_error_code($parser)).' at line '.xml_get_current_line_number($parser);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return false;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; xml_parser_free($parser);<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $this-&gt;findDuplicateKeys();<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; // tmp array used for stacking<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $stack = array();&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $increment = 0;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; foreach($this-&gt;valueArray as $val) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if($val['type'] == "open") {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; //if array key is duplicate then send in increment<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if(array_key_exists($val['tag'], $this-&gt;duplicateKeys)){<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; array_push($stack, $this-&gt;duplicateKeys[$val['tag']]);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $this-&gt;duplicateKeys[$val['tag']]++;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; else{<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; // else send in tag<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; array_push($stack, $val['tag']);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; } elseif($val['type'] == "close") {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; array_pop($stack);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; // reset the increment if they tag does not exists in the stack<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if(array_key_exists($val['tag'], $stack)){<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $this-&gt;duplicateKeys[$val['tag']] = 0;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; } elseif($val['type'] == "complete") {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; //if array key is duplicate then send in increment<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if(array_key_exists($val['tag'], $this-&gt;duplicateKeys)){<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; array_push($stack, $this-&gt;duplicateKeys[$val['tag']]);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $this-&gt;duplicateKeys[$val['tag']]++;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; else{&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; // else send in tag<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; array_push($stack,&nbsp; $val['tag']);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $this-&gt;setArrayValue($this-&gt;output, $stack, $val['value']);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; array_pop($stack);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $increment++;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $this-&gt;status = 'success: xml was parsed';<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return true;<br />
<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; private function findDuplicateKeys(){<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; for($i=0;$i &lt; count($this-&gt;valueArray); $i++) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; // duplicate keys are when two complete tags are side by side<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if($this-&gt;valueArray[$i]['type'] == "complete"){<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if( $i+1 &lt; count($this-&gt;valueArray) ){<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if($this-&gt;valueArray[$i+1]['tag'] == $this-&gt;valueArray[$i]['tag'] &amp;&amp; $this-&gt;valueArray[$i+1]['type'] == "complete"){<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $this-&gt;duplicateKeys[$this-&gt;valueArray[$i]['tag']] = 0;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; // also when a close tag is before an open tag and the tags are the same<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if($this-&gt;valueArray[$i]['type'] == "close"){<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if( $i+1 &lt; count($this-&gt;valueArray) ){<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if(&nbsp; &nbsp; $this-&gt;valueArray[$i+1]['type'] == "open" &amp;&amp; $this-&gt;valueArray[$i+1]['tag'] == $this-&gt;valueArray[$i]['tag'])<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $this-&gt;duplicateKeys[$this-&gt;valueArray[$i]['tag']] = 0; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; private function setArrayValue(&amp;$array, $stack, $value){<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if ($stack) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $key = array_shift($stack);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $this-&gt;setArrayValue($array[$key], $stack, $value);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return $array;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; } else {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $array = $value;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; public function getOutput(){<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return $this-&gt;output;<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; public function getStatus(){<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return $this-&gt;status;&nbsp; &nbsp; <br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; <br />
}<br />
<br />
?&gt;<br />
<br />
Usage:<br />
<br />
$p = new XMLParser($xml);<br />
$p-&gt;getOutput();</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="77768""></a>
  <div class="note">
   <strong class="user">Alf Marius Foss Olsen</strong>
   <a href="#77768" class="date">12-Sep-2007 06:46</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
<span class="default">&lt;?php<br />
</span><span class="comment">/*<br />
&nbsp; An easy lightweight (Array -&gt;) XML -&gt; Array algorithm..<br />
<br />
&nbsp; Typical case: You have an array you want to export to an external server,<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; so you make XML out of it, exports it, and "on the other side"<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; make it into an array again. These two functions will take care<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; of that last part, ie XML -&gt; Array<br />
&nbsp; <br />
&nbsp; NOTE! The function XMLToArray assumes that the XML _dont_ have nodes on the<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; same level with the same name, then it just wont work. This is not a<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; problem, as this case deals with Array -&gt; XML -&gt; Array, and an array<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; cant have to identical indexes/keys.<br />
*/<br />
<br />
</span><span class="keyword">function </span><span class="default">XMLToArray</span><span class="keyword">(</span><span class="default">$xml</span><span class="keyword">) {<br />
&nbsp; </span><span class="default">$parser </span><span class="keyword">= </span><span class="default">xml_parser_create</span><span class="keyword">(</span><span class="string">'ISO-8859-1'</span><span class="keyword">); </span><span class="comment">// For Latin-1 charset<br />
&nbsp; </span><span class="default">xml_parser_set_option</span><span class="keyword">(</span><span class="default">$parser</span><span class="keyword">, </span><span class="default">XML_OPTION_CASE_FOLDING</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">); </span><span class="comment">// Dont mess with my cAsE sEtTings<br />
&nbsp; </span><span class="default">xml_parser_set_option</span><span class="keyword">(</span><span class="default">$parser</span><span class="keyword">, </span><span class="default">XML_OPTION_SKIP_WHITE</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">); </span><span class="comment">// Dont bother with empty info<br />
&nbsp; </span><span class="default">xml_parse_into_struct</span><span class="keyword">(</span><span class="default">$parser</span><span class="keyword">, </span><span class="default">$xml</span><span class="keyword">, </span><span class="default">$values</span><span class="keyword">);<br />
&nbsp; </span><span class="default">xml_parser_free</span><span class="keyword">(</span><span class="default">$parser</span><span class="keyword">);<br />
&nbsp; <br />
&nbsp; </span><span class="default">$return </span><span class="keyword">= array(); </span><span class="comment">// The returned array<br />
&nbsp; </span><span class="default">$stack </span><span class="keyword">= array(); </span><span class="comment">// tmp array used for stacking<br />
&nbsp; </span><span class="keyword">foreach(</span><span class="default">$values </span><span class="keyword">as </span><span class="default">$val</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; if(</span><span class="default">$val</span><span class="keyword">[</span><span class="string">'type'</span><span class="keyword">] == </span><span class="string">"open"</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">array_push</span><span class="keyword">(</span><span class="default">$stack</span><span class="keyword">, </span><span class="default">$val</span><span class="keyword">[</span><span class="string">'tag'</span><span class="keyword">]);<br />
&nbsp;&nbsp;&nbsp; } elseif(</span><span class="default">$val</span><span class="keyword">[</span><span class="string">'type'</span><span class="keyword">] == </span><span class="string">"close"</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">array_pop</span><span class="keyword">(</span><span class="default">$stack</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; } elseif(</span><span class="default">$val</span><span class="keyword">[</span><span class="string">'type'</span><span class="keyword">] == </span><span class="string">"complete"</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">array_push</span><span class="keyword">(</span><span class="default">$stack</span><span class="keyword">, </span><span class="default">$val</span><span class="keyword">[</span><span class="string">'tag'</span><span class="keyword">]);<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">setArrayValue</span><span class="keyword">(</span><span class="default">$return</span><span class="keyword">, </span><span class="default">$stack</span><span class="keyword">, </span><span class="default">$val</span><span class="keyword">[</span><span class="string">'value'</span><span class="keyword">]);<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">array_pop</span><span class="keyword">(</span><span class="default">$stack</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }</span><span class="comment">//if-elseif<br />
&nbsp; </span><span class="keyword">}</span><span class="comment">//foreach<br />
&nbsp; </span><span class="keyword">return </span><span class="default">$return</span><span class="keyword">;<br />
}</span><span class="comment">//function XMLToArray<br />
&nbsp; <br />
</span><span class="keyword">function </span><span class="default">setArrayValue</span><span class="keyword">(&amp;</span><span class="default">$array</span><span class="keyword">, </span><span class="default">$stack</span><span class="keyword">, </span><span class="default">$value</span><span class="keyword">) {<br />
&nbsp; if (</span><span class="default">$stack</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$key </span><span class="keyword">= </span><span class="default">array_shift</span><span class="keyword">(</span><span class="default">$stack</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">setArrayValue</span><span class="keyword">(</span><span class="default">$array</span><span class="keyword">[</span><span class="default">$key</span><span class="keyword">], </span><span class="default">$stack</span><span class="keyword">, </span><span class="default">$value</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">$array</span><span class="keyword">;<br />
&nbsp; } else {<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$array </span><span class="keyword">= </span><span class="default">$value</span><span class="keyword">;<br />
&nbsp; }</span><span class="comment">//if-else<br />
</span><span class="keyword">}</span><span class="comment">//function setArrayValue<br />
&nbsp; <br />
// USAGE:<br />
</span><span class="default">$xml </span><span class="keyword">= &lt;&lt;&lt;QQQ<br />
</span><span class="string">&lt;?xml version="1.0"?&gt;<br />
&lt;root&gt;<br />
&nbsp; &lt;node1&gt;Some text&lt;/node1&gt;<br />
&nbsp; &lt;node2a&gt;<br />
&nbsp;&nbsp;&nbsp; &lt;node2b&gt;<br />
&nbsp;&nbsp; &nbsp;&nbsp; &lt;node2c&gt;Some text&lt;/node2c&gt;<br />
&nbsp;&nbsp;&nbsp; &lt;/node2b&gt;<br />
&nbsp; &lt;/node2a&gt;<br />
&lt;/root&gt;\n<br />
</span><span class="keyword">QQQ;<br />
</span><span class="default">$array </span><span class="keyword">= </span><span class="default">XMLToArray</span><span class="keyword">(</span><span class="default">$xml</span><span class="keyword">);<br />
print </span><span class="string">"&lt;pre&gt;"</span><span class="keyword">;<br />
</span><span class="default">print_r</span><span class="keyword">(</span><span class="default">$array</span><span class="keyword">);<br />
print </span><span class="string">"&lt;/pre&gt;"</span><span class="keyword">;<br />
</span><span class="comment">//&nbsp; Output:<br />
//<br />
//&nbsp; Array<br />
//&nbsp; (<br />
//&nbsp; &nbsp; &nbsp; [root] =&gt; Array<br />
//&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (<br />
//&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; [node1] =&gt; Some text<br />
//&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; [node2a] =&gt; Array<br />
//&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (<br />
//&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; [node2b] =&gt; Array<br />
//&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (<br />
//&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; [node2c] =&gt; Some text<br />
//&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; )<br />
//&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; )<br />
//&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; )<br />
//&nbsp; )<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="77503""></a>
  <div class="note">
   <strong class="user">vinod at citadel-soft dot com</strong>
   <a href="#77503" class="date">01-Sep-2007 03:43</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
My previous code was having some bugs in, that is fixed now <br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">class </span><span class="default">CSLXmlReader </span><span class="keyword">{<br />
&nbsp;&nbsp;&nbsp; private </span><span class="default">$tagstack</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; private </span><span class="default">$xmlvals</span><span class="keyword">;&nbsp; <br />
&nbsp;&nbsp;&nbsp; private&nbsp; </span><span class="default">$xmlvarArrPos</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; private </span><span class="default">$xmlfile</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; function </span><span class="default">__construct</span><span class="keyword">(</span><span class="default">$filename</span><span class="keyword">)&nbsp; </span><span class="comment">// constructor to intialize the stack and val array<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">{<br />
&nbsp;&nbsp; &nbsp; &nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">tagstack </span><span class="keyword">= array();&nbsp;&nbsp; </span><span class="comment">// contain the open tags till now<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">xmlvals </span><span class="keyword">= array(); <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">xmlvarArrPos </span><span class="keyword">= </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">xmlvals</span><span class="keyword">;&nbsp; </span><span class="comment">// temporary variable to hold the current tag position&nbsp; &nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">xmlfile </span><span class="keyword">= </span><span class="default">$filename</span><span class="keyword">; <br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; function </span><span class="default">readDatabase</span><span class="keyword">() <br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// read the XML database <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$data </span><span class="keyword">= </span><span class="default">implode</span><span class="keyword">(</span><span class="string">""</span><span class="keyword">, </span><span class="default">file</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">xmlfile</span><span class="keyword">));<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$parser </span><span class="keyword">= </span><span class="default">xml_parser_create</span><span class="keyword">();<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">xml_parser_set_option</span><span class="keyword">(</span><span class="default">$parser</span><span class="keyword">, </span><span class="default">XML_OPTION_CASE_FOLDING</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">xml_parser_set_option</span><span class="keyword">(</span><span class="default">$parser</span><span class="keyword">, </span><span class="default">XML_OPTION_SKIP_WHITE</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">xml_parse_into_struct</span><span class="keyword">(</span><span class="default">$parser</span><span class="keyword">, </span><span class="default">$data</span><span class="keyword">, </span><span class="default">$values</span><span class="keyword">, </span><span class="default">$tags</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">xml_parser_free</span><span class="keyword">(</span><span class="default">$parser</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; foreach(</span><span class="default">$values </span><span class="keyword">as </span><span class="default">$key </span><span class="keyword">=&gt; </span><span class="default">$val</span><span class="keyword">)&nbsp; </span><span class="comment">// <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">{<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">$val</span><span class="keyword">[</span><span class="string">'type'</span><span class="keyword">] == </span><span class="string">"open"</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">array_push</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">tagstack</span><span class="keyword">, </span><span class="default">$val</span><span class="keyword">[</span><span class="string">'tag'</span><span class="keyword">]);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">getArrayPath</span><span class="keyword">(); <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">count</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">xmlvarArrPos</span><span class="keyword">) &gt; </span><span class="default">0 </span><span class="keyword">&amp;&amp; (!</span><span class="default">array_key_exists</span><span class="keyword">(</span><span class="default">0</span><span class="keyword">,</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">xmlvarArrPos</span><span class="keyword">)))<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$temp1 </span><span class="keyword">= </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">xmlvarArrPos</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">xmlvarArrPos </span><span class="keyword">=&nbsp; array();<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">xmlvarArrPos</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">] = </span><span class="default">$temp1</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">array_push</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">tagstack</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }&nbsp; &nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; else if( </span><span class="default">array_key_exists</span><span class="keyword">(</span><span class="default">0</span><span class="keyword">,</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">xmlvarArrPos</span><span class="keyword">)){ <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$opncount </span><span class="keyword">= </span><span class="default">count</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">xmlvarArrPos</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">array_push</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">tagstack</span><span class="keyword">, </span><span class="default">$opncount</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$tagStackPointer </span><span class="keyword">+= </span><span class="default">1</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }else if(</span><span class="default">$val</span><span class="keyword">[</span><span class="string">'type'</span><span class="keyword">] == </span><span class="string">"close"</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; while( </span><span class="default">$val</span><span class="keyword">[</span><span class="string">'tag'</span><span class="keyword">] != (</span><span class="default">$lastOpened </span><span class="keyword">= </span><span class="default">array_pop</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">tagstack</span><span class="keyword">))){}<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }else if(</span><span class="default">$val</span><span class="keyword">[</span><span class="string">'type'</span><span class="keyword">] ==&nbsp; </span><span class="string">"complete"</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">getArrayPath</span><span class="keyword">();<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if( </span><span class="default">array_key_exists</span><span class="keyword">(</span><span class="default">$val</span><span class="keyword">[</span><span class="string">'tag'</span><span class="keyword">],</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">xmlvarArrPos</span><span class="keyword">))<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {&nbsp; &nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">array_key_exists</span><span class="keyword">(</span><span class="default">0</span><span class="keyword">,</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">xmlvarArrPos</span><span class="keyword">[</span><span class="default">$val</span><span class="keyword">[</span><span class="string">'tag'</span><span class="keyword">]]))<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$elementCount </span><span class="keyword">= </span><span class="default">count</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">xmlvarArrPos</span><span class="keyword">[</span><span class="default">$val</span><span class="keyword">[</span><span class="string">'tag'</span><span class="keyword">]]);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">xmlvarArrPos</span><span class="keyword">[</span><span class="default">$val</span><span class="keyword">[</span><span class="string">'tag'</span><span class="keyword">]][</span><span class="default">$elementCount</span><span class="keyword">] = </span><span class="default">$val</span><span class="keyword">[</span><span class="string">'value'</span><span class="keyword">];<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }else<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {&nbsp; &nbsp; &nbsp; &nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$temp1 </span><span class="keyword">= </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">xmlvarArrPos</span><span class="keyword">[</span><span class="default">$val</span><span class="keyword">[</span><span class="string">'tag'</span><span class="keyword">]];<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">xmlvarArrPos</span><span class="keyword">[</span><span class="default">$val</span><span class="keyword">[</span><span class="string">'tag'</span><span class="keyword">]] =&nbsp; array();<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">xmlvarArrPos</span><span class="keyword">[</span><span class="default">$val</span><span class="keyword">[</span><span class="string">'tag'</span><span class="keyword">]][</span><span class="default">0</span><span class="keyword">] = </span><span class="default">$temp1</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">xmlvarArrPos</span><span class="keyword">[</span><span class="default">$val</span><span class="keyword">[</span><span class="string">'tag'</span><span class="keyword">]][</span><span class="default">1</span><span class="keyword">] = </span><span class="default">$val</span><span class="keyword">[</span><span class="string">'value'</span><span class="keyword">];<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; } else<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">xmlvarArrPos</span><span class="keyword">[</span><span class="default">$val</span><span class="keyword">[</span><span class="string">'tag'</span><span class="keyword">]] = </span><span class="default">$val</span><span class="keyword">[</span><span class="string">'value'</span><span class="keyword">];<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">reset</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">xmlvals</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">xmlvals</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; function </span><span class="default">getArrayPath</span><span class="keyword">()<br />
&nbsp;&nbsp;&nbsp; {<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">reset</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">xmlvals</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">xmlvarArrPos </span><span class="keyword">= &amp;</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">xmlvals</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; foreach(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">tagstack </span><span class="keyword">as </span><span class="default">$key</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {&nbsp; &nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">xmlvarArrPos </span><span class="keyword">= &amp;</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">xmlvarArrPos</span><span class="keyword">[</span><span class="default">$key</span><span class="keyword">];<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
}<br />
<br />
</span><span class="default">$readerObj&nbsp; </span><span class="keyword">= new </span><span class="default">CSLXmlReader</span><span class="keyword">(</span><span class="string">"test.xml"</span><span class="keyword">);<br />
</span><span class="default">$xmlvals </span><span class="keyword">= </span><span class="default">$readerObj</span><span class="keyword">-&gt;</span><span class="default">readDatabase</span><span class="keyword">();<br />
<br />
echo </span><span class="string">"########## XML Values In array as the multidimentional array&nbsp; #############\n"</span><span class="keyword">;<br />
echo </span><span class="string">"&lt;pre&gt;"</span><span class="keyword">;<br />
</span><span class="default">print_r</span><span class="keyword">(</span><span class="default">$xmlvals</span><span class="keyword">);<br />
echo </span><span class="string">"&lt;/pre&gt;"</span><span class="keyword">; <br />
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="73044""></a>
  <div class="note">
   <strong class="user">siteres at gmail dot com</strong>
   <a href="#73044" class="date">07-Feb-2007 01:38</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
PHP: XML to Array and backwards:<br />
<br />
Here the XML with PHP solution: XML-&gt;Array and Array-&gt;XML.<br />
Work with it as with usual array.<br />
<br />
Sources are here:<br />
<a href="http://mysrc.blogspot.com/2007/02/php-xml-to-array-and-backwards.html" rel="nofollow" target="_blank">http://mysrc.blogspot.com/2007/02/php-xml-to-array-and-backwards.html</a><br />
(leave me comments:)<br />
<br />
Example #1 (1.xml):<br />
<br />
&lt;ddd&gt;<br />
&nbsp;&lt;onemore dd="55"&gt;<br />
&nbsp; &lt;tt&gt;333&lt;/tt&gt;<br />
&nbsp; &lt;tt ss="s1"&gt;555&lt;/tt&gt;<br />
&nbsp; &lt;tt&gt;777&lt;/tt&gt;<br />
&nbsp;&lt;/onemore&gt;<br />
&nbsp;&lt;two&gt;sdf rr&lt;/two&gt;<br />
&lt;/ddd&gt;<br />
<br />
The code:<br />
<br />
$xml=xml2ary(file_get_contents('1.xml'));<br />
print_r($xml); <br />
<br />
Here is the Array result:<br />
<br />
Array<br />
(<br />
&nbsp;&nbsp; [ddd] =&gt; Array (<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; [_c] =&gt; Array (<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; [_p] =&gt; Array *RECURSION*<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; [onemore] =&gt; Array (<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; [_a] =&gt; Array (<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; [dd] =&gt; 55<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; )<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; [_c] =&gt; Array (<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; [_p] =&gt; Array&nbsp; *RECURSION*<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; [tt] =&gt; Array (<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; [0] =&gt; Array (<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; [_v] =&gt; 333<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; )<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; [1] =&gt; Array (<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; [_a] =&gt; Array (<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; [ss] =&gt; s1<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; )<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; [_v] =&gt; 555<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; )<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; [2] =&gt; Array (<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; [_v] =&gt; 777<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; )<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; )<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; )<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; )<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; [two] =&gt; Array (<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; [_v] =&gt; sdf rr<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; )<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; )<br />
&nbsp;&nbsp; &nbsp; &nbsp; )<br />
)</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="71472""></a>
  <div class="note">
   <strong class="user">webmaster at after5webdesign dot com</strong>
   <a href="#71472" class="date">30-Nov-2006 04:48</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
That parser also has a problem in which it will not parse more items than the current level it is on. That is, parsing this:&nbsp; &lt;1&gt;&lt;2&gt;A&lt;/2&gt;&lt;2&gt;B&lt;/2&gt;&lt;2&gt;C&lt;/2&gt;&lt;/1&gt;<br />
Will only result in this: A B<br />
C is never processed.<br />
<br />
It might be better with something like this:<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $file = get_url('<a href="http://news.search.yahoo.com/news/rss?p=current+events" rel="nofollow" target="_blank">http://news.search.yahoo.com/news/rss?p=current+events</a>', URL_CONTENT);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $data = $file['content'];<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $xml_parser = xml_parser_create();<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; xml_parse_into_struct($xml_parser, $data, $vals, $index);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; xml_parser_free($xml_parser);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; //Uncomment the lines below to see the entire structure of your XML document<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; //echo "&lt;pre&gt;INDEX: \n";<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; //print_r ($index);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; //echo "\n \n \n VALUES:";<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; //print_r ($vals);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; //echo "&lt;/pre&gt;";<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $params = array();<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $level = array();<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $start_level = 1;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; foreach ($vals as $xml_elem) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if ($xml_elem['type'] == 'open') {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (array_key_exists('attributes',$xml_elem)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; list($level[$xml_elem['level']],$extra) = array_values($xml_elem['attributes']);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; } else {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $level[$xml_elem['level']] = $xml_elem['tag'];<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if ($xml_elem['type'] == 'complete') {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $php_stmt = '$params';<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; while($start_level &lt; $xml_elem['level']) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $php_stmt .= '[$level['.$start_level.']]';<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $start_level++;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $php_stmt .= '[$xml_elem[\'tag\']][] = $xml_elem[\'value\'];';<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; eval($php_stmt);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $start_level--;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; echo "&lt;pre&gt;";<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; print_r ($params);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; echo "&lt;/pre&gt;";<br />
<br />
~Tim_Myth</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="69616""></a>
  <div class="note">
   <strong class="user">Elad Elrom</strong>
   <a href="#69616" class="date">12-Sep-2006 02:14</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
This is a quick fix for parsing XML from remote URL, some of the example above will work when trying to parse on your local server without "<a href="http://" rel="nofollow" target="_blank">http://</a>" but not when trying to parse from remote server using "<a href="http://www.URL" rel="nofollow" target="_blank">http://www.URL</a>"...<br />
<br />
&lt;?<br />
$file="<a href="http://www.URL.com/file.XML" rel="nofollow" target="_blank">http://www.URL.com/file.XML</a>";<br />
<br />
$xml_parser = xml_parser_create();<br />
<br />
$handle = fopen($file, "rb");<br />
$contents = '';<br />
while (!feof($handle)) {<br />
&nbsp; $data .= fread($handle, 8192);<br />
}<br />
fclose($handle);<br />
<br />
xml_parse_into_struct($xml_parser, $data, $vals, $index);<br />
xml_parser_free($xml_parser);<br />
<br />
$params = array();<br />
$level = array();<br />
foreach ($vals as $xml_elem) {<br />
&nbsp; if ($xml_elem['type'] == 'open') {<br />
&nbsp;&nbsp; if (array_key_exists('attributes',$xml_elem)) {<br />
&nbsp;&nbsp; &nbsp; list($level[$xml_elem['level']],$extra) = array_values($xml_elem['attributes']);<br />
&nbsp;&nbsp; } else {<br />
&nbsp;&nbsp; &nbsp; $level[$xml_elem['level']] = $xml_elem['tag'];<br />
&nbsp;&nbsp; }<br />
&nbsp; }<br />
&nbsp; if ($xml_elem['type'] == 'complete') {<br />
&nbsp;&nbsp; $start_level = 1;<br />
&nbsp;&nbsp; $php_stmt = '$params';<br />
&nbsp;&nbsp; while($start_level &lt; $xml_elem['level']) {<br />
&nbsp;&nbsp; &nbsp; $php_stmt .= '[$level['.$start_level.']]';<br />
&nbsp;&nbsp; &nbsp; $start_level++;<br />
&nbsp;&nbsp; }<br />
&nbsp;&nbsp; $php_stmt .= '[$xml_elem[\'tag\']] = $xml_elem[\'value\'];';<br />
&nbsp;&nbsp; eval($php_stmt);<br />
&nbsp; }<br />
}<br />
<br />
echo "&lt;pre&gt;";<br />
print_r ($params);<br />
echo "&lt;/pre&gt;";<br />
?&gt;</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="66487""></a>
  <div class="note">
   <strong class="user">efredricksen at gmail dot com</strong>
   <a href="#66487" class="date">24-May-2006 12:55</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Perhaps the one true parser:? I modified xademax's fine code to tidy it up, codewise and style wise, rationalize some minor crazyness, and make names fit nomenclature from the XML spec. (There are no uses of eval, and shame on you people who do.)<br />
<br />
<span class="default">&lt;?php <br />
</span><span class="keyword">class </span><span class="default">XmlElement </span><span class="keyword">{<br />
&nbsp; var </span><span class="default">$name</span><span class="keyword">;<br />
&nbsp; var </span><span class="default">$attributes</span><span class="keyword">;<br />
&nbsp; var </span><span class="default">$content</span><span class="keyword">;<br />
&nbsp; var </span><span class="default">$children</span><span class="keyword">;<br />
};<br />
<br />
function </span><span class="default">xml_to_object</span><span class="keyword">(</span><span class="default">$xml</span><span class="keyword">) {<br />
&nbsp; </span><span class="default">$parser </span><span class="keyword">= </span><span class="default">xml_parser_create</span><span class="keyword">();<br />
&nbsp; </span><span class="default">xml_parser_set_option</span><span class="keyword">(</span><span class="default">$parser</span><span class="keyword">, </span><span class="default">XML_OPTION_CASE_FOLDING</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">);<br />
&nbsp; </span><span class="default">xml_parser_set_option</span><span class="keyword">(</span><span class="default">$parser</span><span class="keyword">, </span><span class="default">XML_OPTION_SKIP_WHITE</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">);<br />
&nbsp; </span><span class="default">xml_parse_into_struct</span><span class="keyword">(</span><span class="default">$parser</span><span class="keyword">, </span><span class="default">$xml</span><span class="keyword">, </span><span class="default">$tags</span><span class="keyword">);<br />
&nbsp; </span><span class="default">xml_parser_free</span><span class="keyword">(</span><span class="default">$parser</span><span class="keyword">);<br />
<br />
&nbsp; </span><span class="default">$elements </span><span class="keyword">= array();&nbsp; </span><span class="comment">// the currently filling [child] XmlElement array<br />
&nbsp; </span><span class="default">$stack </span><span class="keyword">= array();<br />
&nbsp; foreach (</span><span class="default">$tags </span><span class="keyword">as </span><span class="default">$tag</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$index </span><span class="keyword">= </span><span class="default">count</span><span class="keyword">(</span><span class="default">$elements</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; if (</span><span class="default">$tag</span><span class="keyword">[</span><span class="string">'type'</span><span class="keyword">] == </span><span class="string">"complete" </span><span class="keyword">|| </span><span class="default">$tag</span><span class="keyword">[</span><span class="string">'type'</span><span class="keyword">] == </span><span class="string">"open"</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">$elements</span><span class="keyword">[</span><span class="default">$index</span><span class="keyword">] = new </span><span class="default">XmlElement</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">$elements</span><span class="keyword">[</span><span class="default">$index</span><span class="keyword">]-&gt;</span><span class="default">name </span><span class="keyword">= </span><span class="default">$tag</span><span class="keyword">[</span><span class="string">'tag'</span><span class="keyword">];<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">$elements</span><span class="keyword">[</span><span class="default">$index</span><span class="keyword">]-&gt;</span><span class="default">attributes </span><span class="keyword">= </span><span class="default">$tag</span><span class="keyword">[</span><span class="string">'attributes'</span><span class="keyword">];<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">$elements</span><span class="keyword">[</span><span class="default">$index</span><span class="keyword">]-&gt;</span><span class="default">content </span><span class="keyword">= </span><span class="default">$tag</span><span class="keyword">[</span><span class="string">'value'</span><span class="keyword">];<br />
&nbsp;&nbsp; &nbsp;&nbsp; if (</span><span class="default">$tag</span><span class="keyword">[</span><span class="string">'type'</span><span class="keyword">] == </span><span class="string">"open"</span><span class="keyword">) {&nbsp; </span><span class="comment">// push<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$elements</span><span class="keyword">[</span><span class="default">$index</span><span class="keyword">]-&gt;</span><span class="default">children </span><span class="keyword">= array();<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$stack</span><span class="keyword">[</span><span class="default">count</span><span class="keyword">(</span><span class="default">$stack</span><span class="keyword">)] = &amp;</span><span class="default">$elements</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$elements </span><span class="keyword">= &amp;</span><span class="default">$elements</span><span class="keyword">[</span><span class="default">$index</span><span class="keyword">]-&gt;</span><span class="default">children</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; if (</span><span class="default">$tag</span><span class="keyword">[</span><span class="string">'type'</span><span class="keyword">] == </span><span class="string">"close"</span><span class="keyword">) {&nbsp; </span><span class="comment">// pop<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">$elements </span><span class="keyword">= &amp;</span><span class="default">$stack</span><span class="keyword">[</span><span class="default">count</span><span class="keyword">(</span><span class="default">$stack</span><span class="keyword">) - </span><span class="default">1</span><span class="keyword">];<br />
&nbsp;&nbsp; &nbsp;&nbsp; unset(</span><span class="default">$stack</span><span class="keyword">[</span><span class="default">count</span><span class="keyword">(</span><span class="default">$stack</span><span class="keyword">) - </span><span class="default">1</span><span class="keyword">]);<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp; }<br />
&nbsp; return </span><span class="default">$elements</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">];&nbsp; </span><span class="comment">// the single top-level element<br />
</span><span class="keyword">}<br />
<br />
</span><span class="comment">// For example:<br />
</span><span class="default">$xml </span><span class="keyword">= </span><span class="string">'<br />
&lt;parser&gt;<br />
&nbsp;&nbsp; &lt;name language="en-us"&gt;Fred Parser&lt;/name&gt;<br />
&nbsp;&nbsp; &lt;category&gt;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &lt;name&gt;Nomenclature&lt;/name&gt;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &lt;note&gt;Noteworthy&lt;/note&gt;<br />
&nbsp;&nbsp; &lt;/category&gt;<br />
&lt;/parser&gt;<br />
'</span><span class="keyword">;<br />
</span><span class="default">print_r</span><span class="keyword">(</span><span class="default">xml_to_object</span><span class="keyword">(</span><span class="default">$xml</span><span class="keyword">));<br />
</span><span class="default">?&gt;<br />
</span><br />
will give:<br />
<br />
xmlelement Object<br />
(<br />
&nbsp;&nbsp;&nbsp; [name] =&gt; parser<br />
&nbsp;&nbsp;&nbsp; [attributes] =&gt; <br />
&nbsp;&nbsp;&nbsp; [content] =&gt; <br />
&nbsp;&nbsp;&nbsp; [children] =&gt; Array<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; (<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [0] =&gt; xmlelement Object<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; (<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [name] =&gt; name<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [attributes] =&gt; Array<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; (<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [language] =&gt; en-us<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; )<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [content] =&gt; Fred Parser<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [children] =&gt; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; )<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [1] =&gt; xmlelement Object<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; (<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [name] =&gt; category<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [attributes] =&gt; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [content] =&gt; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [children] =&gt; Array<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; (<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [0] =&gt; xmlelement Object<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; (<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [name] =&gt; name<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [attributes] =&gt; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [content] =&gt; Nomenclature<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [children] =&gt; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; )<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [1] =&gt; xmlelement Object<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; (<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [name] =&gt; note<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [attributes] =&gt; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [content] =&gt; Noteworthy<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [children] =&gt; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; )<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; )<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; )<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; )<br />
<br />
)</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="66479""></a>
  <div class="note">
   <strong class="user">Stuart</strong>
   <a href="#66479" class="date">23-May-2006 03:26</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
This is a great little function for a lot of XML work, but note that this function does not handle XML entities properly.<br />
<br />
The basic XML entities &amp;lt; &amp;gt; &amp;amp; &amp;quot; are fine, just anything else will not work:<br />
<br />
If the entity is defined in the XML header, the parser will drop it completely from the struct it creates.<br />
<br />
If the entity is not defined in the XML then the parser will crash out with an undefined entity error.<br />
<br />
You should be able to work around this limitation by using a preg_replace on your XML string before passing it to the parser.<br />
<br />
(Further details in Bug #35271; this is just a warning to those thinking of using this function for parsing real XML documents not just trivial XML examples)</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="60485""></a>
  <div class="note">
   <strong class="user">xademax at gmail dot com</strong>
   <a href="#60485" class="date">08-Jan-2006 12:15</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
This is just another simple xml parser :)<br />
<br />
<span class="default">&lt;?php<br />
<br />
</span><span class="keyword">class </span><span class="default">Xml<br />
</span><span class="keyword">{<br />
&nbsp;&nbsp;&nbsp; var </span><span class="default">$tag</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; var </span><span class="default">$value</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; var </span><span class="default">$attributes</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; var </span><span class="default">$next</span><span class="keyword">;<br />
}<br />
<br />
function </span><span class="default">xml2array</span><span class="keyword">(</span><span class="default">$xml_string</span><span class="keyword">)<br />
{<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$Parser </span><span class="keyword">= </span><span class="default">xml_parser_create</span><span class="keyword">();<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">xml_parser_set_option</span><span class="keyword">(</span><span class="default">$Parser</span><span class="keyword">, </span><span class="default">XML_OPTION_CASE_FOLDING</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">xml_parser_set_option</span><span class="keyword">(</span><span class="default">$Parser</span><span class="keyword">, </span><span class="default">XML_OPTION_SKIP_WHITE</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">xml_parse_into_struct</span><span class="keyword">(</span><span class="default">$Parser</span><span class="keyword">, </span><span class="default">$xml_string</span><span class="keyword">, </span><span class="default">$Xml_Values</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">xml_parser_free</span><span class="keyword">(</span><span class="default">$Parser</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$XmlClass </span><span class="keyword">= array();<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$LastObj </span><span class="keyword">= array();<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$NowObj </span><span class="keyword">= &amp;</span><span class="default">$XmlClass</span><span class="keyword">;<br />
<br />
&nbsp;&nbsp;&nbsp; foreach(</span><span class="default">$Xml_Values </span><span class="keyword">as </span><span class="default">$Xml_Key </span><span class="keyword">=&gt; </span><span class="default">$Xml_Value</span><span class="keyword">)<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$Index </span><span class="keyword">= </span><span class="default">count</span><span class="keyword">(</span><span class="default">$NowObj</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">$Xml_Value</span><span class="keyword">[</span><span class="string">"type"</span><span class="keyword">] == </span><span class="string">"complete"</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$NowObj</span><span class="keyword">[</span><span class="default">$Index</span><span class="keyword">] = new </span><span class="default">Xml</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$NowObj</span><span class="keyword">[</span><span class="default">$Index</span><span class="keyword">]-&gt;</span><span class="default">tag </span><span class="keyword">= </span><span class="default">$Xml_Value</span><span class="keyword">[</span><span class="string">"tag"</span><span class="keyword">];<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$NowObj</span><span class="keyword">[</span><span class="default">$Index</span><span class="keyword">]-&gt;</span><span class="default">value </span><span class="keyword">= </span><span class="default">$Xml_Value</span><span class="keyword">[</span><span class="string">"value"</span><span class="keyword">];<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$NowObj</span><span class="keyword">[</span><span class="default">$Index</span><span class="keyword">]-&gt;</span><span class="default">attributes </span><span class="keyword">= </span><span class="default">$Xml_Value</span><span class="keyword">[</span><span class="string">"attributes"</span><span class="keyword">];<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; elseif(</span><span class="default">$Xml_Value</span><span class="keyword">[</span><span class="string">"type"</span><span class="keyword">] == </span><span class="string">"open"</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$NowObj</span><span class="keyword">[</span><span class="default">$Index</span><span class="keyword">] = new </span><span class="default">Xml</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$NowObj</span><span class="keyword">[</span><span class="default">$Index</span><span class="keyword">]-&gt;</span><span class="default">tag </span><span class="keyword">= </span><span class="default">$Xml_Value</span><span class="keyword">[</span><span class="string">"tag"</span><span class="keyword">];<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$NowObj</span><span class="keyword">[</span><span class="default">$Index</span><span class="keyword">]-&gt;</span><span class="default">value </span><span class="keyword">= </span><span class="default">$Xml_Value</span><span class="keyword">[</span><span class="string">"value"</span><span class="keyword">];<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$NowObj</span><span class="keyword">[</span><span class="default">$Index</span><span class="keyword">]-&gt;</span><span class="default">attributes </span><span class="keyword">= </span><span class="default">$Xml_Value</span><span class="keyword">[</span><span class="string">"attributes"</span><span class="keyword">];<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$NowObj</span><span class="keyword">[</span><span class="default">$Index</span><span class="keyword">]-&gt;</span><span class="default">next </span><span class="keyword">= array();<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$LastObj</span><span class="keyword">[</span><span class="default">count</span><span class="keyword">(</span><span class="default">$LastObj</span><span class="keyword">)] = &amp;</span><span class="default">$NowObj</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$NowObj </span><span class="keyword">= &amp;</span><span class="default">$NowObj</span><span class="keyword">[</span><span class="default">$Index</span><span class="keyword">]-&gt;</span><span class="default">next</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; elseif(</span><span class="default">$Xml_Value</span><span class="keyword">[</span><span class="string">"type"</span><span class="keyword">] == </span><span class="string">"close"</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$NowObj </span><span class="keyword">= &amp;</span><span class="default">$LastObj</span><span class="keyword">[</span><span class="default">count</span><span class="keyword">(</span><span class="default">$LastObj</span><span class="keyword">) - </span><span class="default">1</span><span class="keyword">];<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; unset(</span><span class="default">$LastObj</span><span class="keyword">[</span><span class="default">count</span><span class="keyword">(</span><span class="default">$LastObj</span><span class="keyword">) - </span><span class="default">1</span><span class="keyword">]);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">$XmlClass</span><span class="keyword">;<br />
}<br />
<br />
</span><span class="default">$String </span><span class="keyword">= </span><span class="string">"<br />
&lt;parser&gt;<br />
&nbsp;&nbsp;&nbsp; &lt;parseur_name&gt;MyParser&lt;/parseur_name&gt;<br />
&nbsp;&nbsp;&nbsp; &lt;category&gt;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; &lt;name&gt;Name 1&lt;/name&gt;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; &lt;note&gt;A note 1&lt;/note&gt;<br />
&nbsp;&nbsp;&nbsp; &lt;/category&gt;<br />
&lt;/parser&gt;<br />
"</span><span class="keyword">;<br />
</span><span class="default">$Xml </span><span class="keyword">= </span><span class="default">xml2array</span><span class="keyword">(</span><span class="default">$String</span><span class="keyword">);<br />
<br />
</span><span class="default">print_r</span><span class="keyword">(</span><span class="default">$Xml</span><span class="keyword">);<br />
</span><span class="default">?&gt;<br />
</span><br />
This exemple will show : <br />
Array<br />
(<br />
&nbsp;&nbsp;&nbsp; [0] =&gt; Xml Object<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; (<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [tag] =&gt; parser<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [value] =&gt; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [attributes] =&gt; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [next] =&gt; Array<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; (<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [0] =&gt; Xml Object<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; (<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [tag] =&gt; parseur_name<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [value] =&gt; MyParser<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [attributes] =&gt; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [next] =&gt; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; )<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [1] =&gt; Xml Object<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; (<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [tag] =&gt; category<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [value] =&gt; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [attributes] =&gt; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [next] =&gt; Array<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; (<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [0] =&gt; Xml Object<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; (<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [tag] =&gt; name<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [value] =&gt; Name 1<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [attributes] =&gt; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [next] =&gt; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; )<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [1] =&gt; Xml Object<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; (<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [tag] =&gt; note<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [value] =&gt; A note 1<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [attributes] =&gt; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [next] =&gt; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; )<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; )<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; )<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; )<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; )<br />
<br />
)</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="58568""></a>
  <div class="note">
   <strong class="user">mbirth at webwriters dot de</strong>
   <a href="#58568" class="date">08-Nov-2005 03:48</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Searching for a nice and working way to get a RSS feed into an array-structure, I found the solution posted by kieran but disliked those several eval()s. So I wrote my own using references/pointers.<br />
<br />
<span class="default">&lt;?php<br />
<br />
</span><span class="keyword">class </span><span class="default">RSSParser </span><span class="keyword">{<br />
&nbsp; <br />
&nbsp; var </span><span class="default">$struct </span><span class="keyword">= array();&nbsp; </span><span class="comment">// holds final structure<br />
&nbsp; </span><span class="keyword">var </span><span class="default">$curptr</span><span class="keyword">;&nbsp; </span><span class="comment">// current branch on $struct<br />
&nbsp; </span><span class="keyword">var </span><span class="default">$parents </span><span class="keyword">= array();&nbsp; </span><span class="comment">// parent branches of current branch<br />
&nbsp; <br />
&nbsp; </span><span class="keyword">function </span><span class="default">RSSParser</span><span class="keyword">(</span><span class="default">$url</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">curptr </span><span class="keyword">=&amp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">struct</span><span class="keyword">;&nbsp; </span><span class="comment">// set ref to base<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$xmlparser </span><span class="keyword">= </span><span class="default">xml_parser_create</span><span class="keyword">();<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">xml_set_object</span><span class="keyword">(</span><span class="default">$xmlparser</span><span class="keyword">, </span><span class="default">$this</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">xml_set_element_handler</span><span class="keyword">(</span><span class="default">$xmlparser</span><span class="keyword">, </span><span class="string">'tag_open'</span><span class="keyword">, </span><span class="string">'tag_close'</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">xml_set_character_data_handler</span><span class="keyword">(</span><span class="default">$xmlparser</span><span class="keyword">, </span><span class="string">'cdata'</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$fp </span><span class="keyword">= </span><span class="default">fopen</span><span class="keyword">(</span><span class="default">$url</span><span class="keyword">, </span><span class="string">'r'</span><span class="keyword">);<br />
<br />
&nbsp;&nbsp;&nbsp; while (</span><span class="default">$data </span><span class="keyword">= </span><span class="default">fread</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">, </span><span class="default">4096</span><span class="keyword">))<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">xml_parse</span><span class="keyword">(</span><span class="default">$xmlparser</span><span class="keyword">, </span><span class="default">$data</span><span class="keyword">, </span><span class="default">feof</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">))<br />
&nbsp;&nbsp; &nbsp;&nbsp; || die(</span><span class="default">sprintf</span><span class="keyword">(</span><span class="string">"XML error: %s at line %d"</span><span class="keyword">, <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">xml_error_string</span><span class="keyword">(</span><span class="default">xml_get_error_code</span><span class="keyword">(</span><span class="default">$xmlparser</span><span class="keyword">)), <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">xml_get_current_line_number</span><span class="keyword">(</span><span class="default">$xmlparser</span><span class="keyword">)));<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">fclose</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">xml_parser_free</span><span class="keyword">(</span><span class="default">$xmlparser</span><span class="keyword">);<br />
&nbsp; }<br />
&nbsp; <br />
&nbsp; function </span><span class="default">tag_open</span><span class="keyword">(</span><span class="default">$parser</span><span class="keyword">, </span><span class="default">$tag</span><span class="keyword">, </span><span class="default">$attr</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$i </span><span class="keyword">= </span><span class="default">count</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">curptr</span><span class="keyword">[</span><span class="string">'children'</span><span class="keyword">]);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$j </span><span class="keyword">= </span><span class="default">count</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">parents</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">curptr</span><span class="keyword">[</span><span class="string">'children'</span><span class="keyword">][</span><span class="default">$i</span><span class="keyword">]=array();&nbsp; </span><span class="comment">// add new child element<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">parents</span><span class="keyword">[</span><span class="default">$j</span><span class="keyword">] =&amp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">curptr</span><span class="keyword">;&nbsp; </span><span class="comment">// store current position as parent<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">curptr </span><span class="keyword">=&amp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">curptr</span><span class="keyword">[</span><span class="string">'children'</span><span class="keyword">][</span><span class="default">$i</span><span class="keyword">];&nbsp; </span><span class="comment">// submerge to newly created child element<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">curptr</span><span class="keyword">[</span><span class="string">'name'</span><span class="keyword">] = </span><span class="default">$tag</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; if (</span><span class="default">count</span><span class="keyword">(</span><span class="default">$attr</span><span class="keyword">)&gt;</span><span class="default">0</span><span class="keyword">) </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">curptr</span><span class="keyword">[</span><span class="string">'attr'</span><span class="keyword">] = </span><span class="default">$attr</span><span class="keyword">;<br />
&nbsp; }<br />
&nbsp; <br />
&nbsp; function </span><span class="default">tag_close</span><span class="keyword">(</span><span class="default">$parser</span><span class="keyword">, </span><span class="default">$tag</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$i </span><span class="keyword">= </span><span class="default">count</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">parents</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; if (</span><span class="default">$i</span><span class="keyword">&gt;</span><span class="default">0</span><span class="keyword">) </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">curptr </span><span class="keyword">=&amp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">parents</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">-</span><span class="default">1</span><span class="keyword">];&nbsp; </span><span class="comment">// return to parent element<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">unset(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">parents</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">-</span><span class="default">1</span><span class="keyword">]);&nbsp; </span><span class="comment">// clear from list of parents<br />
&nbsp; </span><span class="keyword">}<br />
&nbsp; <br />
&nbsp; function </span><span class="default">cdata</span><span class="keyword">(</span><span class="default">$parser</span><span class="keyword">, </span><span class="default">$data</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$data </span><span class="keyword">= </span><span class="default">trim</span><span class="keyword">(</span><span class="default">$data</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; if (!empty(</span><span class="default">$data</span><span class="keyword">)) {<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">curptr</span><span class="keyword">[</span><span class="string">'value'</span><span class="keyword">] .= </span><span class="default">$data</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp; }<br />
&nbsp; <br />
}<br />
<br />
</span><span class="default">$myparser </span><span class="keyword">= new </span><span class="default">RSSParser</span><span class="keyword">(</span><span class="string">'getitems.xml'</span><span class="keyword">);<br />
</span><span class="default">$anotherparser </span><span class="keyword">= new </span><span class="default">RSSParser</span><span class="keyword">(</span><span class="string">'<a href="http://johndoe:secret@myfeeds.com/getfeed.xml" rel="nofollow" target="_blank">http://johndoe:secret@myfeeds.com/getfeed.xml</a>'</span><span class="keyword">);<br />
<br />
</span><span class="default">print_r</span><span class="keyword">(</span><span class="default">$myparser</span><span class="keyword">-&gt;</span><span class="default">struct</span><span class="keyword">);<br />
</span><span class="default">print_r</span><span class="keyword">(</span><span class="default">$anotherparser</span><span class="keyword">-&gt;</span><span class="default">struct</span><span class="keyword">);<br />
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="57975""></a>
  <div class="note">
   <strong class="user">kieran at kieran dot ca</strong>
   <a href="#57975" class="date">20-Oct-2005 09:20</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
&lt;?
<br />
/*
<br />
|
<br />
| _xml2array - another abstraction layer on xml_parse_into_struct 
<br />
|&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; that returns a nice nested array.
<br />
|
<br />
|&nbsp; &nbsp; &nbsp; @param: $xml is a string containing a full xml document
<br />
|
<br />
|&nbsp; &nbsp;&nbsp; returns: a nested php array that looks like this: 
<br />
|&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; 
<br />
|&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; array
<br />
|&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (
<br />
|&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; [_name] =&gt; the name of the tag
<br />
|&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; [_attributes] =&gt; an array of 'attribute'=&gt;'value' combos
<br />
|&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; [_value] =&gt; the text contents of the node
<br />
|&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; [_children] =&gt; an array of these arrays, one for each node.
<br />
|&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; )
<br />
|
<br />
|&nbsp; &nbsp; &nbsp;&nbsp; notes: thanks to 'jeffg at activestate dot com' who inspired
<br />
|&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; me to essentially re-write his example code from php.net
<br />
|
<br />
|&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; me: Kieran Huggins &lt; kieran[at]kieran[dot]ca &gt;
<br />
|
<br />
*/
<br />
function _xml2array($xml){
<br />
&nbsp;&nbsp;&nbsp; global $keys;
<br />
&nbsp;&nbsp;&nbsp; global $level;
<br />
&nbsp;&nbsp;&nbsp; if(!is_array($xml)){ // init on first run
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $raw_xml = $xml;
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $p = xml_parser_create();
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; xml_parser_set_option($p, XML_OPTION_CASE_FOLDING, 0);
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; xml_parser_set_option($p, XML_OPTION_SKIP_WHITE, 1);
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; xml_parse_into_struct($p, $raw_xml, $xml, $idx);
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; xml_parser_free($p);
<br />
&nbsp;&nbsp;&nbsp; }
<br />
&nbsp;&nbsp;&nbsp; for($i=0;$i&lt;count($xml,1);$i++){
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; // set the current level
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $level = $xml[$i]['level'];
<br />

<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if($level&lt;1)break;
<br />

<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; // mark this level's tag in the array
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $keys[$level] = '['.$i.']';
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; 
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; // if we've come down a level, sort output and destroy the upper level
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if(count($keys)&gt;$level) unset($keys[count($keys)]);
<br />

<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; // ignore close tags, they're useless
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if($xml[$i]['type']=="open" || $xml[$i]['type']=="complete"){
<br />

<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; // build the evalstring
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $e = '$output'.implode('[\'_children\']',$keys);
<br />

<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; // set the tag name
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; eval($e.'[\'_name\'] = $xml[$i][\'tag\'];');
<br />

<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; // set the attributes
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if($xml[$i]['attributes']){
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; eval($e.'[\'_attributes\'] = $xml[$i][\'attributes\'];');
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; 
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; // set the value
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if($xml[$i]['value']){
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; eval($e.'[\'_value\'] = trim($xml[$i][\'value\']);');
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }
<br />

<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }
<br />

<br />
&nbsp;&nbsp;&nbsp; }
<br />

<br />
&nbsp;&nbsp;&nbsp; return $output;
<br />
}
<br />
?&gt;</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="55243""></a>
  <div class="note">
   <strong class="user">Chris Hester</strong>
   <a href="#55243" class="date">28-Jul-2005 05:06</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
The array generated from XML stores not only the elements but also any spaces and linebreaks between the tags. This results in a much longer array. (I had 24 array fields instead of 10!) To cure this use the following code when creating the parser:<br />
<br />
<span class="default">&lt;?php<br />
$xml_parser </span><span class="keyword">= </span><span class="default">xml_parser_create</span><span class="keyword">();<br />
</span><span class="default">xml_parser_set_option</span><span class="keyword">(</span><span class="default">$xml_parser</span><span class="keyword">,</span><span class="default">XML_OPTION_SKIP_WHITE</span><span class="keyword">,</span><span class="default">1</span><span class="keyword">);<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="54106""></a>
  <div class="note">
   <strong class="user">PhF at madmac dot fr</strong>
   <a href="#54106" class="date">23-Jun-2005 01:11</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
The code previously posted by noob at noobsrule dot com doesn't work when the same tag name is used at different levels.<br />
(but perhaps "$php_used_prefix" was intended for that ?)<br />
For example:<br />
&lt;RatedShipment&gt;<br />
&nbsp; &lt;TransportationCharges&gt;<br />
&nbsp;&nbsp;&nbsp; ...<br />
&nbsp; &lt;/TransportationCharges&gt;<br />
&nbsp; &lt;RatedPackage&gt;<br />
&nbsp;&nbsp;&nbsp; &lt;TransportationCharges&gt;<br />
&nbsp;&nbsp; &nbsp;&nbsp; ...<br />
&nbsp;&nbsp;&nbsp; &lt;/TransportationCharges&gt;<br />
&nbsp; &lt;/RatedPackage&gt;<br />
&lt;/RatedShipment&gt;<br />
<span class="default">&lt;?php<br />
&nbsp;&nbsp;&nbsp; $p </span><span class="keyword">= </span><span class="default">xml_parser_create</span><span class="keyword">();<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">xml_parser_set_option</span><span class="keyword">(</span><span class="default">$p</span><span class="keyword">, </span><span class="default">XML_OPTION_CASE_FOLDING</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">xml_parser_set_option</span><span class="keyword">(</span><span class="default">$p</span><span class="keyword">, </span><span class="default">XML_OPTION_SKIP_WHITE</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">xml_parse_into_struct</span><span class="keyword">(</span><span class="default">$p</span><span class="keyword">, </span><span class="default">$UPSxml</span><span class="keyword">, </span><span class="default">$values</span><span class="keyword">, </span><span class="default">$idx</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">xml_parser_free</span><span class="keyword">(</span><span class="default">$p</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// tracking used keys<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$usedKeys </span><span class="keyword">= array();<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$deepLevel </span><span class="keyword">= -</span><span class="default">1</span><span class="keyword">;<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// start a php array string (evaluated later)<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$forEvalPrefix </span><span class="keyword">= </span><span class="string">'$xml_array'</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// loop throught the value array<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">foreach (</span><span class="default">$values </span><span class="keyword">as </span><span class="default">$key </span><span class="keyword">=&gt; </span><span class="default">$val</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$tagName </span><span class="keyword">= </span><span class="default">$val</span><span class="keyword">[</span><span class="string">'tag'</span><span class="keyword">]; </span><span class="comment">// pass the key tag into a more friendly looking variable<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$level </span><span class="keyword">= </span><span class="default">$val</span><span class="keyword">[</span><span class="string">'level'</span><span class="keyword">]; </span><span class="comment">// idem<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">if(</span><span class="default">$val</span><span class="keyword">[</span><span class="string">'type'</span><span class="keyword">] == </span><span class="string">'open'</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$deepLevel</span><span class="keyword">++; </span><span class="comment">// increase deep level<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$forEvalPrefix </span><span class="keyword">.= </span><span class="string">'[\''</span><span class="keyword">. </span><span class="default">$tagName </span><span class="keyword">.</span><span class="string">'\']'</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// begin used keys checks to allow multidimensionatity under the same tag<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">(isset(</span><span class="default">$usedKeys</span><span class="keyword">[</span><span class="default">$level</span><span class="keyword">][</span><span class="default">$tagName</span><span class="keyword">])) ? </span><span class="default">$usedKeys</span><span class="keyword">[</span><span class="default">$level</span><span class="keyword">][</span><span class="default">$tagName</span><span class="keyword">]++ : </span><span class="default">$usedKeys</span><span class="keyword">[</span><span class="default">$level</span><span class="keyword">][</span><span class="default">$tagName</span><span class="keyword">] = </span><span class="default">0</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$forEvalPrefix </span><span class="keyword">.= </span><span class="string">'['</span><span class="keyword">. </span><span class="default">$usedKeys</span><span class="keyword">[</span><span class="default">$level</span><span class="keyword">][</span><span class="default">$tagName</span><span class="keyword">] .</span><span class="string">']'</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; } <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">$val</span><span class="keyword">[</span><span class="string">'type'</span><span class="keyword">] == </span><span class="string">'complete'</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; (</span><span class="default">$level </span><span class="keyword">&gt; </span><span class="default">$deepLevel</span><span class="keyword">) ? </span><span class="default">$deepLevel</span><span class="keyword">++ : </span><span class="string">''</span><span class="keyword">; </span><span class="comment">// increase $deepLevel only if current level is bigger<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$tagValue </span><span class="keyword">= </span><span class="default">addslashes</span><span class="keyword">(</span><span class="default">$val</span><span class="keyword">[</span><span class="string">'value'</span><span class="keyword">] ); </span><span class="comment">// format the value for evaluation as a string<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$forEvalSuffix </span><span class="keyword">= </span><span class="string">'[\''</span><span class="keyword">. </span><span class="default">$tagName </span><span class="keyword">.</span><span class="string">'\'] = \''</span><span class="keyword">. </span><span class="default">$tagValue </span><span class="keyword">.</span><span class="string">'\';'</span><span class="keyword">; </span><span class="comment">// create a string to append to the current prefix<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$forEval </span><span class="keyword">= </span><span class="default">$forEvalPrefix </span><span class="keyword">. </span><span class="default">$forEvalSuffix</span><span class="keyword">; </span><span class="comment">// (without "$php_used_prefix"...)<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">eval(</span><span class="default">$forEval</span><span class="keyword">); </span><span class="comment">// write the string to the array structure<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">}<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">$val</span><span class="keyword">[</span><span class="string">'type'</span><span class="keyword">] == </span><span class="string">'close'</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; unset(</span><span class="default">$usedKeys</span><span class="keyword">[</span><span class="default">$deepLevel</span><span class="keyword">]); </span><span class="comment">// Suppress tagname's keys useless<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$deepLevel</span><span class="keyword">--;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$forEvalPrefix </span><span class="keyword">= </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$forEvalPrefix</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">strrpos</span><span class="keyword">(</span><span class="default">$forEvalPrefix</span><span class="keyword">, </span><span class="string">'['</span><span class="keyword">)); </span><span class="comment">// cut off the used keys node<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$forEvalPrefix </span><span class="keyword">= </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$forEvalPrefix</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">strrpos</span><span class="keyword">(</span><span class="default">$forEvalPrefix</span><span class="keyword">, </span><span class="string">'['</span><span class="keyword">)); </span><span class="comment">// cut off the end level of the array string prefix<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">}<br />
&nbsp;&nbsp;&nbsp; }<br />
echo </span><span class="string">'&lt;pre&gt;'</span><span class="keyword">;<br />
</span><span class="default">print_r </span><span class="keyword">(</span><span class="default">$xml_array</span><span class="keyword">);<br />
echo </span><span class="string">'&lt;/pre&gt;'</span><span class="keyword">;<br />
</span><span class="default">?&gt;<br />
</span><br />
MADmac ;-)</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="53864""></a>
  <div class="note">
   <strong class="user">peter at elemental dot org</strong>
   <a href="#53864" class="date">15-Jun-2005 08:46</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Quick addendum to my post below... The code does *not* handle cases where multiple elements are used without attribute IDs, as is the case with the moldb example.&nbsp; (It is probably worth noting that some of the other code below doesn't do this either, and is still more complex.)<br />
<br />
It is not difficult to add that functionality, but I have yet to find an elegant way to integrate that feature, and since I don't need that functionality at the moment, I'm going leave that as an exercise to the reader.&nbsp; ;-)<br />
<br />
-p.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="53840""></a>
  <div class="note">
   <strong class="user">peter at elemental dot org</strong>
   <a href="#53840" class="date">14-Jun-2005 04:09</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Some of the code posted previously seemed absurdly complex, so I thought I'd see if I could simplify things a bit. Here's what I came up with.&nbsp; (I'm still a PHP newbie, so perhaps I simplified too much.&nbsp; ;-)&nbsp; Untested for speed, but it *should* be pretty quick since it uses references instead of lookups or (gack) evals.<br />
<br />
Enjoy!<br />
<br />
/*<br />
&nbsp;*&nbsp; Convert a string containing XML into a nested array<br />
&nbsp;*<br />
&nbsp;*&nbsp; Takes a raw XML string as input<br />
&nbsp;*&nbsp; Returns a nested array<br />
&nbsp;*/<br />
<br />
function xml2array ($xml_data)<br />
{<br />
&nbsp;&nbsp;&nbsp; // parse the XML datastring<br />
&nbsp;&nbsp;&nbsp; $xml_parser = xml_parser_create ();<br />
&nbsp;&nbsp;&nbsp; xml_parse_into_struct ($xml_parser, $xml_data, $vals, $index);<br />
&nbsp;&nbsp;&nbsp; xml_parser_free ($xml_parser);<br />
<br />
&nbsp;&nbsp;&nbsp; // convert the parsed data into a PHP datatype<br />
&nbsp;&nbsp;&nbsp; $params = array();<br />
&nbsp;&nbsp;&nbsp; $ptrs[0] = &amp; $params;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; foreach ($vals as $xml_elem) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $level = $xml_elem['level'] - 1;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; switch ($xml_elem['type']) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; case 'open':<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $tag_or_id = (array_key_exists ('attributes', $xml_elem)) ? $xml_elem['attributes']['ID'] : $xml_elem['tag'];<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $ptrs[$level][$tag_or_id] = array ();<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $ptrs[$level+1] = &amp; $ptrs[$level][$tag_or_id];<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; break;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; case 'complete':<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $ptrs[$level][$xml_elem['tag']] = (isset ($xml_elem['value'])) ? $xml_elem['value'] : '';<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; break;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; return ($params);<br />
<br />
}</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="49334""></a>
  <div class="note">
   <strong class="user">noob at noobsrule dot com</strong>
   <a href="#49334" class="date">24-Jan-2005 10:59</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
This is my first time contributing but I found all the examples either didn't work or were beyond my comprehension.&nbsp; I also wanted to maintain the XML multi-dimensionality so I could do loops based on keys I was expecting rather than numbers or some other whatnot.&nbsp; This script is probably way inefficient, but should give you a multidimensional array with a depth that will match the XML source.&nbsp; Great for situations when you aren't sure what you'll be getting back.&nbsp; Its also only based on the values array of xml_parse_into_str() using the 3 tag types (open, complete, and close) -- hopefully it will make more sense to other noobs.<br />
<br />
Basically it just constructs a string ($php_prefix) that is tweaked if it hits an "open" or "close" tag and evaluated if it hits a "complete" tag.<br />
<br />
Thanks.<br />
<br />
<span class="default">&lt;?php<br />
<br />
</span><span class="comment"># initiate curl session...<br />
</span><span class="default">$ch </span><span class="keyword">= </span><span class="default">curl_init</span><span class="keyword">( </span><span class="string">"<a href="http://yourtargethost" rel="nofollow" target="_blank">http://yourtargethost</a>" </span><span class="keyword">) or die ( </span><span class="string">"could not initialize curl" </span><span class="keyword">); <br />
<br />
</span><span class="comment"># set curl options...<br />
</span><span class="default">curl_setopt</span><span class="keyword">( </span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_HEADER</span><span class="keyword">, </span><span class="default">0 </span><span class="keyword">);<br />
</span><span class="default">curl_setopt</span><span class="keyword">( </span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_POST</span><span class="keyword">, </span><span class="default">1 </span><span class="keyword">);<br />
</span><span class="default">curl_setopt</span><span class="keyword">( </span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_POSTFIELDS</span><span class="keyword">, </span><span class="default">$request_str </span><span class="keyword">);<br />
</span><span class="default">curl_setopt</span><span class="keyword">( </span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_FOLLOWLOCATION</span><span class="keyword">, </span><span class="default">0 </span><span class="keyword">);<br />
</span><span class="default">curl_setopt</span><span class="keyword">( </span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_REFERER</span><span class="keyword">, </span><span class="default">https</span><span class="keyword">:</span><span class="comment">//foobar.com" );<br />
</span><span class="default">curl_setopt</span><span class="keyword">( </span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_RETURNTRANSFER</span><span class="keyword">, </span><span class="default">1 </span><span class="keyword">);<br />
<br />
</span><span class="comment"># execute curl commands...<br />
</span><span class="default">$curl_result </span><span class="keyword">= </span><span class="default">curl_exec</span><span class="keyword">( </span><span class="default">$ch </span><span class="keyword">) or die ( </span><span class="string">"could not execute the post" </span><span class="keyword">);<br />
</span><span class="default">curl_close</span><span class="keyword">( </span><span class="default">$ch </span><span class="keyword">); </span><span class="comment">// close curl session <br />
<br />
# pass the XML result into 2 arrays ( index and values )...<br />
</span><span class="default">$p </span><span class="keyword">= </span><span class="default">xml_parser_create</span><span class="keyword">();<br />
</span><span class="default">xml_parser_set_option</span><span class="keyword">(</span><span class="default">$p</span><span class="keyword">, </span><span class="default">XML_OPTION_CASE_FOLDING</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">);<br />
</span><span class="default">xml_parser_set_option</span><span class="keyword">(</span><span class="default">$p</span><span class="keyword">, </span><span class="default">XML_OPTION_SKIP_WHITE</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">);<br />
</span><span class="default">xml_parse_into_struct</span><span class="keyword">(</span><span class="default">$p</span><span class="keyword">, </span><span class="default">$curl_result</span><span class="keyword">, </span><span class="default">$vals</span><span class="keyword">, </span><span class="default">$index</span><span class="keyword">);<br />
</span><span class="default">xml_parser_free</span><span class="keyword">(</span><span class="default">$p</span><span class="keyword">);<br />
<br />
</span><span class="comment"># create an empty used key tracker...<br />
</span><span class="default">$used_keys </span><span class="keyword">= array();<br />
<br />
</span><span class="comment"># start a php array string (evaluated later)...<br />
</span><span class="default">$php_prefix </span><span class="keyword">= </span><span class="string">"$"</span><span class="keyword">.</span><span class="string">"my_array"</span><span class="keyword">;<br />
<br />
</span><span class="comment"># loop through the values array...<br />
</span><span class="keyword">foreach (</span><span class="default">$vals </span><span class="keyword">as </span><span class="default">$key </span><span class="keyword">=&gt; </span><span class="default">$val</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; if( </span><span class="default">$val</span><span class="keyword">[</span><span class="string">'type'</span><span class="keyword">] == </span><span class="string">"open" </span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$my_tag </span><span class="keyword">= </span><span class="default">$val</span><span class="keyword">[</span><span class="string">'tag'</span><span class="keyword">]; </span><span class="comment">// pass the key tag into a more friendly looking variable...<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$php_prefix </span><span class="keyword">.= </span><span class="string">"['"</span><span class="keyword">.</span><span class="default">$my_tag</span><span class="keyword">.</span><span class="string">"']"</span><span class="keyword">; </span><span class="comment"># add a new level to the array string...<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; # begin used key checks to allow multidimensionality under the same tag, adds a number to the prefix if necessary...<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">if( ! </span><span class="default">array_key_exists</span><span class="keyword">( </span><span class="default">$my_tag</span><span class="keyword">, </span><span class="default">$used_keys </span><span class="keyword">) ) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$used_keys</span><span class="keyword">[</span><span class="default">$my_tag</span><span class="keyword">] = </span><span class="default">0</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$php_prefix </span><span class="keyword">.= </span><span class="string">"["</span><span class="keyword">.</span><span class="default">$used_keys</span><span class="keyword">[</span><span class="default">$my_tag</span><span class="keyword">].</span><span class="string">"]"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }else {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$used_keys</span><span class="keyword">[</span><span class="default">$my_tag</span><span class="keyword">]++; </span><span class="comment">// increment the key tracker to avoid overwriting existing key...<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$php_prefix </span><span class="keyword">.= </span><span class="string">"["</span><span class="keyword">.</span><span class="default">$used_keys</span><span class="keyword">[</span><span class="default">$my_tag</span><span class="keyword">].</span><span class="string">"]"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; } elseif( </span><span class="default">$val</span><span class="keyword">[</span><span class="string">'type'</span><span class="keyword">] == </span><span class="string">"complete" </span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$my_value </span><span class="keyword">= </span><span class="default">addslashes</span><span class="keyword">( </span><span class="default">$val</span><span class="keyword">[</span><span class="string">'value'</span><span class="keyword">] ); </span><span class="comment"># format the value for evaluation as a string...<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$php_suffix </span><span class="keyword">= </span><span class="string">"['"</span><span class="keyword">.</span><span class="default">$val</span><span class="keyword">[</span><span class="string">'tag'</span><span class="keyword">].</span><span class="string">"'] = \""</span><span class="keyword">.</span><span class="default">$my_value</span><span class="keyword">.</span><span class="string">"\";"</span><span class="keyword">; </span><span class="comment"># create a string with the tag and value to append to the current prefix (just used here)...<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$php_str </span><span class="keyword">= </span><span class="default">$php_prefix</span><span class="keyword">.</span><span class="default">$php_used_prefix</span><span class="keyword">.</span><span class="default">$php_suffix</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; eval( </span><span class="default">$php_str </span><span class="keyword">); </span><span class="comment"># write the string to the array structure...<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">}<br />
&nbsp;&nbsp;&nbsp; if( </span><span class="default">$val</span><span class="keyword">[</span><span class="string">'type'</span><span class="keyword">] == </span><span class="string">"close" </span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$php_prefix </span><span class="keyword">= </span><span class="default">substr</span><span class="keyword">( </span><span class="default">$php_prefix</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">strrpos</span><span class="keyword">( </span><span class="default">$php_prefix</span><span class="keyword">, </span><span class="string">"[" </span><span class="keyword">) ); </span><span class="comment"># cut off the used keys node...<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$php_prefix </span><span class="keyword">= </span><span class="default">substr</span><span class="keyword">( </span><span class="default">$php_prefix</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">strrpos</span><span class="keyword">( </span><span class="default">$php_prefix</span><span class="keyword">, </span><span class="string">"[" </span><span class="keyword">) ); </span><span class="comment"># cut off the end level of the array string prefix...<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">}<br />
}<br />
<br />
echo </span><span class="string">"&lt;pre&gt;"</span><span class="keyword">;<br />
</span><span class="comment">//print_r ($index);<br />
//echo "&lt;br&gt;&lt;br&gt;&lt;br&gt;";<br />
//print_r ($vals);<br />
//echo "&lt;br&gt;&lt;br&gt;&lt;br&gt;";<br />
</span><span class="default">print_r </span><span class="keyword">(</span><span class="default">$my_array</span><span class="keyword">);<br />
echo </span><span class="string">"&lt;/pre&gt;"</span><span class="keyword">;<br />
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="49154""></a>
  <div class="note">
   <strong class="user">dudus at onet dot pl</strong>
   <a href="#49154" class="date">18-Jan-2005 06:33</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
This function return array from XML. Included attributes and tags in same level.<br />
I wrote this function based on mmustafa code. <br />
<br />
enjoy! <br />
dUDA<br />
<br />
-------------------------------<br />
<br />
&lt;?<br />
function XMLtoArray($XML)<br />
{<br />
&nbsp;&nbsp;&nbsp; $xml_parser = xml_parser_create();<br />
&nbsp;&nbsp;&nbsp; xml_parse_into_struct($xml_parser, $XML, $vals);<br />
&nbsp;&nbsp;&nbsp; xml_parser_free($xml_parser);<br />
&nbsp;&nbsp;&nbsp; // wyznaczamy tablice z powtarzajacymi sie tagami na tym samym poziomie <br />
&nbsp;&nbsp;&nbsp; $_tmp='';<br />
&nbsp;&nbsp;&nbsp; foreach ($vals as $xml_elem)<br />
&nbsp;&nbsp;&nbsp; { <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $x_tag=$xml_elem['tag'];<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $x_level=$xml_elem['level'];<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $x_type=$xml_elem['type'];<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if ($x_level!=1 &amp;&amp; $x_type == 'close')<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (isset($multi_key[$x_tag][$x_level]))<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $multi_key[$x_tag][$x_level]=1;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; else<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $multi_key[$x_tag][$x_level]=0;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if ($x_level!=1 &amp;&amp; $x_type == 'complete')<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if ($_tmp==$x_tag) <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $multi_key[$x_tag][$x_level]=1;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $_tmp=$x_tag;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; // jedziemy po tablicy<br />
&nbsp;&nbsp;&nbsp; foreach ($vals as $xml_elem)<br />
&nbsp;&nbsp;&nbsp; { <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $x_tag=$xml_elem['tag'];<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $x_level=$xml_elem['level'];<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $x_type=$xml_elem['type'];<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if ($x_type == 'open') <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $level[$x_level] = $x_tag;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $start_level = 1;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $php_stmt = '$xml_array';<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if ($x_type=='close' &amp;&amp; $x_level!=1) <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $multi_key[$x_tag][$x_level]++;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; while($start_level &lt; $x_level)<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $php_stmt .= '[$level['.$start_level.']]';<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (isset($multi_key[$level[$start_level]][$start_level]) &amp;&amp; $multi_key[$level[$start_level]][$start_level]) <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $php_stmt .= '['.($multi_key[$level[$start_level]][$start_level]-1).']';<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $start_level++;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $add='';<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (isset($multi_key[$x_tag][$x_level]) &amp;&amp; $multi_key[$x_tag][$x_level] &amp;&amp; ($x_type=='open' || $x_type=='complete'))<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (!isset($multi_key2[$x_tag][$x_level]))<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $multi_key2[$x_tag][$x_level]=0;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; else<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $multi_key2[$x_tag][$x_level]++;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $add='['.$multi_key2[$x_tag][$x_level].']'; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (isset($xml_elem['value']) &amp;&amp; trim($xml_elem['value'])!='' &amp;&amp; !array_key_exists('attributes',$xml_elem))<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if ($x_type == 'open') <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $php_stmt_main=$php_stmt.'[$x_type]'.$add.'[\'content\'] = $xml_elem[\'value\'];';<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; else<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $php_stmt_main=$php_stmt.'[$x_tag]'.$add.' = $xml_elem[\'value\'];';<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; eval($php_stmt_main);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (array_key_exists('attributes',$xml_elem))<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (isset($xml_elem['value']))<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $php_stmt_main=$php_stmt.'[$x_tag]'.$add.'[\'content\'] = $xml_elem[\'value\'];';<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; eval($php_stmt_main);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; foreach ($xml_elem['attributes'] as $key=&gt;$value)<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $php_stmt_att=$php_stmt.'[$x_tag]'.$add.'[$key] = $value;';<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; eval($php_stmt_att);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; return $xml_array;<br />
}&nbsp; &nbsp; // END XMLtoArray<br />
?&gt;</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="45052""></a>
  <div class="note">
   <strong class="user">happyseb at free dot fr</strong>
   <a href="#45052" class="date">24-Aug-2004 08:51</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I would just add something about the solution proposed by "gordon at kanazawa dot ac dot jp".<br />
<br />
Something went wrong about the fact that "cdata" are treated the same way as "complete" in the xml_get_children first and in the xml_get_child then.<br />
<br />
When ?<br />
with this method, something like this :<br />
&lt;tagA&gt;<br />
&nbsp; &lt;tagB&gt;valueB&lt;/tagB&gt;<br />
&nbsp; valueA<br />
&nbsp; &lt;tagC&gt;valueC&lt;/tagC&gt;<br />
&lt;/tagA&gt;<br />
is considered as the same thing as<br />
&lt;tagA&gt;<br />
&nbsp; &lt;tagB&gt;valueB&lt;/tagB&gt;<br />
&nbsp; &lt;tagA&gt;valueA&lt;/tagA&gt;<br />
&nbsp; &lt;tagC&gt;valueC&lt;/tagC&gt;<br />
&lt;/tagA&gt;<br />
<br />
The algorithm is nomore bijective.<br />
<br />
Even if it might not be perfect :-) i propose a little modification of the xml_get_child function :<br />
<br />
function xml_get_child(&amp;$v, $children=NULL) {<br />
&nbsp;&nbsp; &nbsp;&nbsp; $c = array(); // the "child"<br />
&nbsp;&nbsp; &nbsp;&nbsp; if (isset($v['tag']) &amp;&amp; $v['type'] != 'cdata') $c['tag'] = $v['tag'];<br />
&nbsp;&nbsp; &nbsp;&nbsp; if (isset($v['value'])) $c['value'] = $v['value'];<br />
&nbsp;&nbsp; &nbsp;&nbsp; if (isset($v['attributes'])) $c['attributes'] = $v['attributes'];<br />
&nbsp;&nbsp; &nbsp;&nbsp; if (is_array($children)) $c['children'] = $children;<br />
&nbsp;&nbsp; &nbsp;&nbsp; return $c;<br />
}<br />
<br />
moreover, the following function will take the tree (made from the xml_get_tree function) as a parameter and build the xml content back<br />
<br />
&nbsp;&nbsp;&nbsp; /*<br />
&nbsp;&nbsp;&nbsp; // setTree<br />
&nbsp;&nbsp;&nbsp; // set xml Tree from a well-formed array<br />
&nbsp;&nbsp;&nbsp; // manage indentation<br />
&nbsp;&nbsp;&nbsp; // Parameters are :<br />
&nbsp;&nbsp;&nbsp; // $1 (needed) : Tree to transform<br />
&nbsp;&nbsp;&nbsp; // $2 (optional) : Indentation type (default is one tabulation)<br />
&nbsp;&nbsp;&nbsp; // $3 (optional) : First indent (default is empty string)<br />
&nbsp;&nbsp;&nbsp; */<br />
<br />
&nbsp;&nbsp;&nbsp; function setTree($Atree, $indentType = '&nbsp; &nbsp; ', $Sindent = '')<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp;&nbsp; if (! isset ($Atree['tag']) &amp;&amp; isset ($Atree['value'])) return ($Sindent.trim($Atree['value'])."\r\n") ;<br />
&nbsp;&nbsp; &nbsp;&nbsp; else {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $Stemp = $Sindent.'&lt;'.$Atree['tag'].' ' ;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (isset ($Atree['attributes']) &amp;&amp; is_array ($Atree['attributes'])) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; foreach ($Atree['attributes'] as $Aattribute =&gt; $Svalue) $Stemp .= $Aattribute.'="'.$Svalue.'" ' ;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (! isset ($Atree['children']) &amp;&amp; ! isset ($Atree['value'])) $Stemp .= '/&gt;'."\r\n" ;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; else {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $Stemp .= '&gt;'."\r\n" ;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (isset ($Atree['value'])) $Stemp .= $Sindent.$indentType.trim($Atree['value'])."\r\n" ;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (isset ($Atree['children']) &amp;&amp; is_array ($Atree['children']))<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; foreach ($Atree['children'] as $Achild) $Stemp .= $this-&gt;setTree($Achild, $indentType, $Sindent.$indentType) ;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $Stemp .= $Sindent.'&lt;/'.$Atree['tag'].'&gt;'."\r\n" ;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return ($Stemp) ;<br />
&nbsp;&nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; }</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="43203""></a>
  <div class="note">
   <strong class="user">sdh33 at cornell dot edu</strong>
   <a href="#43203" class="date">13-Jun-2004 10:12</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
(The previous post I wrote was incorrect.&nbsp; I fix that herein)<br />
I used the algorithm from stephane for writing back to a file, but ran into the following problem.&nbsp; My original XML looks like<br />
<br />
&lt;ENTRY id="1"&gt; ... &lt;/ENTRY&gt;&lt;ENTRY id="2"&gt; ... &lt;/ENTRY&gt;<br />
<br />
This got saved back as<br />
<br />
&lt;1&gt; ... &lt;/1&gt;&lt;2&gt; ... &lt;/2&gt;,<br />
<br />
which expat doesn't like.&nbsp; So I propose the following modification:<br />
<br />
function writeXmlToFile($data, $f, $niv = 0) {<br />
&nbsp; foreach($data as $name =&gt; $elem) {<br />
&nbsp;&nbsp;&nbsp; if (preg_match("/\A[0-9]/",$name)) {<br />
&nbsp;&nbsp; &nbsp;&nbsp; $open = "ENTRY id=\"$name\""; $name = "ENTRY";<br />
&nbsp;&nbsp;&nbsp; } else {<br />
&nbsp;&nbsp; &nbsp;&nbsp; $open = $name;<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; if(is_array($elem)) {<br />
&nbsp;&nbsp; &nbsp;&nbsp; fwrite($f, str_repeat("&nbsp; ", $niv)."&lt;".$open."&gt;"."\n");<br />
&nbsp;&nbsp; &nbsp;&nbsp; writeXmlToFile($elem, $f, $niv + 1);<br />
&nbsp;&nbsp; &nbsp;&nbsp; fwrite($f, str_repeat("&nbsp; ", $niv)."&lt;/".$name."&gt;"."\n");<br />
&nbsp;&nbsp;&nbsp; } else {<br />
&nbsp;&nbsp; &nbsp;&nbsp; fwrite($f, str_repeat("&nbsp; ", $niv)."&lt;".$open."&gt;".$elem."&lt;/".$name."&gt;"."\n");<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp; }<br />
}</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="41399""></a>
  <div class="note">
   <strong class="user">stephane dot dekeyzer at noemail dot com</strong>
   <a href="#41399" class="date">08-Apr-2004 11:54</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
for writing the array of mmustafa back to a xml file, use this code:<br />
<br />
function writeXmlFile($fileName, $struct){<br />
&nbsp; $f = fopen($fileName, "w");<br />
&nbsp; writeXmlToFile($struct, $f);<br />
&nbsp; fclose($f);<br />
}<br />
<br />
function writeXmlToFile($data, $f, $niv = 0){<br />
&nbsp; foreach($data as $name =&gt; $elem){<br />
&nbsp;&nbsp;&nbsp; if(is_array($elem)){<br />
&nbsp;&nbsp; &nbsp;&nbsp; fwrite($f, str_repeat("&nbsp; ", $niv)."&lt;".$name."&gt;"."\n");<br />
&nbsp;&nbsp; &nbsp;&nbsp; writeXmlToFile($elem, $f, $niv + 1);<br />
&nbsp;&nbsp; &nbsp;&nbsp; fwrite($f, str_repeat("&nbsp; ", $niv)."&lt;/".$name."&gt;"."\n");<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; else{<br />
&nbsp;&nbsp; &nbsp;&nbsp; fwrite($f, str_repeat("&nbsp; ", $niv)."&lt;".$name."&gt;".$elem."&lt;/".$name."&gt;"."\n");<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp; }<br />
}</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="38755""></a>
  <div class="note">
   <strong class="user">mmustafa at vsnl dot com</strong>
   <a href="#38755" class="date">06-Jan-2004 12:19</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
A small and simple php code to convert the raw array returned by xml_parse_into_struct into a proper data structure ..<br />
<br />
<span class="default">&lt;?php<br />
$file </span><span class="keyword">= </span><span class="string">"data.xml"</span><span class="keyword">;<br />
</span><span class="default">$xml_parser </span><span class="keyword">= </span><span class="default">xml_parser_create</span><span class="keyword">();<br />
<br />
if (!(</span><span class="default">$fp </span><span class="keyword">= </span><span class="default">fopen</span><span class="keyword">(</span><span class="default">$file</span><span class="keyword">, </span><span class="string">"r"</span><span class="keyword">))) {<br />
&nbsp;&nbsp;&nbsp; die(</span><span class="string">"could not open XML input"</span><span class="keyword">);<br />
}<br />
<br />
</span><span class="default">$data </span><span class="keyword">= </span><span class="default">fread</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">, </span><span class="default">filesize</span><span class="keyword">(</span><span class="default">$file</span><span class="keyword">));<br />
</span><span class="default">fclose</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">);<br />
</span><span class="default">xml_parse_into_struct</span><span class="keyword">(</span><span class="default">$xml_parser</span><span class="keyword">, </span><span class="default">$data</span><span class="keyword">, </span><span class="default">$vals</span><span class="keyword">, </span><span class="default">$index</span><span class="keyword">);<br />
</span><span class="default">xml_parser_free</span><span class="keyword">(</span><span class="default">$xml_parser</span><span class="keyword">);<br />
<br />
</span><span class="default">$params </span><span class="keyword">= array();<br />
</span><span class="default">$level </span><span class="keyword">= array();<br />
foreach (</span><span class="default">$vals </span><span class="keyword">as </span><span class="default">$xml_elem</span><span class="keyword">) {<br />
&nbsp; if (</span><span class="default">$xml_elem</span><span class="keyword">[</span><span class="string">'type'</span><span class="keyword">] == </span><span class="string">'open'</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; if (</span><span class="default">array_key_exists</span><span class="keyword">(</span><span class="string">'attributes'</span><span class="keyword">,</span><span class="default">$xml_elem</span><span class="keyword">)) {<br />
&nbsp;&nbsp; &nbsp;&nbsp; list(</span><span class="default">$level</span><span class="keyword">[</span><span class="default">$xml_elem</span><span class="keyword">[</span><span class="string">'level'</span><span class="keyword">]],</span><span class="default">$extra</span><span class="keyword">) = </span><span class="default">array_values</span><span class="keyword">(</span><span class="default">$xml_elem</span><span class="keyword">[</span><span class="string">'attributes'</span><span class="keyword">]);<br />
&nbsp;&nbsp;&nbsp; } else {<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">$level</span><span class="keyword">[</span><span class="default">$xml_elem</span><span class="keyword">[</span><span class="string">'level'</span><span class="keyword">]] = </span><span class="default">$xml_elem</span><span class="keyword">[</span><span class="string">'tag'</span><span class="keyword">];<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp; }<br />
&nbsp; if (</span><span class="default">$xml_elem</span><span class="keyword">[</span><span class="string">'type'</span><span class="keyword">] == </span><span class="string">'complete'</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$start_level </span><span class="keyword">= </span><span class="default">1</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$php_stmt </span><span class="keyword">= </span><span class="string">'$params'</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; while(</span><span class="default">$start_level </span><span class="keyword">&lt; </span><span class="default">$xml_elem</span><span class="keyword">[</span><span class="string">'level'</span><span class="keyword">]) {<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">$php_stmt </span><span class="keyword">.= </span><span class="string">'[$level['</span><span class="keyword">.</span><span class="default">$start_level</span><span class="keyword">.</span><span class="string">']]'</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">$start_level</span><span class="keyword">++;<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$php_stmt </span><span class="keyword">.= </span><span class="string">'[$xml_elem[\'tag\']] = $xml_elem[\'value\'];'</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; eval(</span><span class="default">$php_stmt</span><span class="keyword">);<br />
&nbsp; }<br />
}<br />
<br />
echo </span><span class="string">"&lt;pre&gt;"</span><span class="keyword">;<br />
</span><span class="default">print_r </span><span class="keyword">(</span><span class="default">$params</span><span class="keyword">);<br />
echo </span><span class="string">"&lt;/pre&gt;"</span><span class="keyword">;<br />
</span><span class="default">?&gt;<br />
</span><br />
Converts an XML document like ..<br />
<br />
&lt;country id="ZZ"&gt;<br />
&lt;name&gt;My Land&lt;/name&gt;<br />
&lt;location&gt;15E&lt;/location&gt;<br />
&lt;area&gt;40000&lt;/area&gt;<br />
&lt;state1&gt;<br />
&lt;name&gt;Hi State&lt;/name&gt;<br />
&lt;area&gt;1000&lt;/area&gt;<br />
&lt;population&gt;2000&lt;/population&gt;<br />
&lt;city1&gt;<br />
&lt;location&gt;13E&lt;/location&gt;<br />
&lt;population&gt;500&lt;/population&gt;<br />
&lt;area&gt;500&lt;/area&gt;<br />
&lt;/city1&gt;<br />
&lt;city2&gt;<br />
&lt;location&gt;13E&lt;/location&gt;<br />
&lt;population&gt;500&lt;/population&gt;<br />
&lt;area&gt;5000&lt;/area&gt;<br />
&lt;/city2&gt;<br />
&lt;/state1&gt;<br />
&lt;state2&gt;<br />
&lt;name&gt;Low State&lt;/name&gt;<br />
&lt;area&gt;3000&lt;/area&gt;<br />
&lt;population&gt;20000&lt;/population&gt;<br />
&lt;city1&gt;<br />
&lt;location&gt;15E&lt;/location&gt;<br />
&lt;population&gt;5000&lt;/population&gt;<br />
&lt;area&gt;1500&lt;/area&gt;<br />
&lt;/city1&gt;<br />
&lt;/state2&gt;<br />
&lt;/country&gt;<br />
<br />
To a php datastructure like ..<br />
<br />
Array<br />
(<br />
&nbsp;&nbsp;&nbsp; [ZZ] =&gt; Array<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; (<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [NAME] =&gt; My Land<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [LOCATION] =&gt; 15E<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [AREA] =&gt; 40000<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [STATE1] =&gt; Array<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; (<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [NAME] =&gt; Hi State<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [AREA] =&gt; 1000<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [POPULATION] =&gt; 2000<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [CITY1] =&gt; Array<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; (<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [LOCATION] =&gt; 13E<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [POPULATION] =&gt; 500<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [AREA] =&gt; 500<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; )<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [CITY2] =&gt; Array<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; (<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [LOCATION] =&gt; 13E<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [POPULATION] =&gt; 500<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [AREA] =&gt; 5000<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; )<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; )<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [STATE2] =&gt; Array<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; (<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [NAME] =&gt; Low State<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [AREA] =&gt; 3000<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [POPULATION] =&gt; 20000<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [CITY1] =&gt; Array<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; (<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [LOCATION] =&gt; 15E<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [POPULATION] =&gt; 5000<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [AREA] =&gt; 1500<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; )<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; )<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; )<br />
<br />
)</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="27015""></a>
  <div class="note">
   <strong class="user">bisqwit at iki dot fi dot not dot for dot ads dot invalid</strong>
   <a href="#27015" class="date">20-Nov-2002 08:33</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I made my own xml2tree()-function.<br />
The difference to the previously suggested ones on this manual page is that this creates a tree where the tags are keys.<br />
<br />
Example input:<br />
<br />
&lt;tree&gt;<br />
&nbsp;&lt;leaf name="gruu"&gt; pl?? &lt;/leaf&gt;<br />
&nbsp;&lt;animal type="cat" /&gt;<br />
&lt;/tree&gt;<br />
<br />
Example output:<br />
<br />
Array<br />
( 'tree' =&gt; Array<br />
&nbsp;&nbsp; &nbsp; ( 0 =&gt; Array<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; ( 'children' =&gt; Array<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ( 'leaf' =&gt; Array<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; ( 0 =&gt; Array<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ( 'attrs' =&gt; Array('name' =&gt; 'gruu'),<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 'values' =&gt; Array(0 =&gt; ' pl?? ')<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; )&nbsp; &nbsp; ),<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 'animal' =&gt; Array<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; ( 0 =&gt; Array<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ( 'attrs' =&gt; Array('type' =&gt; 'cat')<br />
)&nbsp; &nbsp; )&nbsp;&nbsp; )&nbsp; &nbsp; )&nbsp; &nbsp; )&nbsp;&nbsp; )<br />
<br />
function xml2tree2($string)<br />
{<br />
&nbsp; $parser = xml_parser_create();<br />
&nbsp; xml_parser_set_option($parser, XML_OPTION_CASE_FOLDING, 0);<br />
&nbsp; xml_parser_set_option($parser, XML_OPTION_SKIP_WHITE, 1);<br />
&nbsp; xml_parse_into_struct($parser, $string, $vals, $index);<br />
&nbsp; xml_parser_free($parser);<br />
&nbsp; <br />
&nbsp; $stack = array( array() );<br />
&nbsp; $stacktop = 0;<br />
&nbsp; $parent = array();<br />
&nbsp; foreach($vals as $val)<br />
&nbsp; {<br />
&nbsp;&nbsp;&nbsp; $type = $val['type'];<br />
&nbsp;&nbsp;&nbsp; if($type=='open' || $type=='complete')<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp;&nbsp; // open tag<br />
&nbsp;&nbsp; &nbsp;&nbsp; $stack[$stacktop++] = $tagi;<br />
&nbsp;&nbsp; &nbsp;&nbsp; $tagi = array('tag' =&gt; $val['tag']);<br />
<br />
&nbsp;&nbsp; &nbsp;&nbsp; if(isset($val['attributes']))&nbsp; $tagi['attrs'] = $val['attributes'];&nbsp; &nbsp; &nbsp; <br />
&nbsp;&nbsp; &nbsp;&nbsp; if(isset($val['value']))<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $tagi['values'][] = $val['value'];<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; if($type=='complete' || $type=='close')<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp;&nbsp; // finish tag<br />
&nbsp;&nbsp; &nbsp;&nbsp; $tags[] = $oldtagi = $tagi; <br />
&nbsp;&nbsp; &nbsp;&nbsp; $tagi = $stack[--$stacktop];<br />
&nbsp;&nbsp; &nbsp;&nbsp; $oldtag = $oldtagi['tag'];&nbsp; <br />
&nbsp;&nbsp; &nbsp;&nbsp; unset($oldtagi['tag']);<br />
&nbsp;&nbsp; &nbsp;&nbsp; $tagi['children'][$oldtag][] = $oldtagi;<br />
&nbsp;&nbsp; &nbsp;&nbsp; $parent = $tagi;<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; if($type=='cdata')<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp;&nbsp; $tagi['values'][] = $val['value'];<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp; }<br />
&nbsp; return $parent['children'];<br />
}&nbsp; &nbsp; &nbsp; &nbsp; <br />
<br />
Ps: Note that the xml parsing for some reason chokes if the values contain &lt;&gt; (even inside ""). You need to escape them as &amp;lt; and &amp;gt;.<br />
Same for &amp; (for obvious reasons). Escape it as &amp;amp;.<br />
For example "&amp;nbsp;" should be written as "&amp;amp;nbsp;".</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="24199""></a>
  <div class="note">
   
   <a href="#24199" class="date">09-Aug-2002 01:20</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
This is based on a comment above by mh@mainlab.de.&nbsp; This version makes more sense to me and I included a few comments that might make it more usefull for specific purposes.<br />
<br />
// Look through $vals and $index,<br />
// generated by parse_xml_data(),<br />
// for $location.&nbsp; $location resembles a unix path.<br />
// E.g. "my/xml/path/to/my/data".<br />
// Note: This is NOT a full-feature xml utility.<br />
// Your path must be unique in the xml data<br />
// and the tags must not contain slashes.<br />
//<br />
// returns: cdata from last element of $location<br />
//&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; or NULL.<br />
function get_xml_values($vals, $index, $location) {<br />
&nbsp; $location = explode('/', $location);<br />
&nbsp; $location_level = count($location);<br />
&nbsp; for ($n=0; $n&lt;$location_level; ++$n) {<br />
&nbsp;&nbsp;&nbsp; $val_indexes=$index[$location[$n]];<br />
&nbsp;&nbsp;&nbsp; $good=0;<br />
&nbsp;&nbsp;&nbsp; for ($i=0; $i&lt;count($val_indexes); ++$i) {<br />
&nbsp;&nbsp; &nbsp;&nbsp; $v = $vals[$val_indexes[$i]];<br />
&nbsp;&nbsp; &nbsp;&nbsp; // level is 1 based, n is 0 based:<br />
&nbsp;&nbsp; &nbsp;&nbsp; if ($v['level']-1 == $n) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if ($v['type'] == 'open') {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; // We found an open tag at the correct level.<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $good=1;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; break; // Remove break to avoid 'open' hiding<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // 'complete' at last $n. (Speed Vs. Robustness:<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // For now, I'm going with speed).<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if ($v['type'] == 'complete') {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; // We found it, after finding all the prior elements:<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; // You may want to change this to<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; // return $v<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; // so you can call $v['value'] and $v['attributes']<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return $v['value'];<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; if (!$good) {<br />
&nbsp;&nbsp; &nbsp;&nbsp; return NULL;<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp; }<br />
}</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="23526""></a>
  <div class="note">
   <strong class="user">farinspace-at-hotmail-dot-com</strong>
   <a href="#23526" class="date">20-Jul-2002 06:41</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Wow, took a while to consume all of this. I am a noobie at XML, in fact i just really started working with it today. I went ahead and added to the above code by gdemartini@bol.com.br. I also added the update by nyk@cowham.net.<br />
<br />
Added 'value' =&gt; $vals[$i]['value'] to the open case, as some nodes have both cdata as well as a children node. In previous versions of the functions the cdata of a node(a) that also had children would get stored in the children's array of the parent node(a). Now only children values are in the children array and the cdata is in the value key of the parent node(a).<br />
<br />
Added 'value' =&gt; $vals[$i]['value'] to tree array as the vals array produced by PHP includes a value to the top most node if no children exist (for completeness).<br />
<br />
Also, using xml_parser_set_option($parser, XML_OPTION_SKIP_WHITE,1) will strip all white space from both around the XML tags as well as inside the cdata. I added a piece of code by waldo@wh-e.com to take care of this. All SPACE characters are now only stripped from around the XML tags and cdata spacing is retained.<br />
<br />
CODE:<br />
***************************************<br />
<br />
function GetChildren($vals, &amp;$i) {<br />
<br />
&nbsp;&nbsp;&nbsp; $children = array();<br />
<br />
&nbsp;&nbsp;&nbsp; while (++$i &lt; sizeof($vals)) {<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; // compair type<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; switch ($vals[$i]['type']) {<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; case 'cdata':<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $children[] = $vals[$i]['value'];<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; break;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; case 'complete':<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $children[] = array(<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; 'tag' =&gt; $vals[$i]['tag'], <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; 'attributes' =&gt; $vals[$i]['attributes'], <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; 'value' =&gt; $vals[$i]['value']<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; );<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; break;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; case 'open':<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $children[] = array(<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; 'tag' =&gt; $vals[$i]['tag'], <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; 'attributes' =&gt; $vals[$i]['attributes'], <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; 'value' =&gt; $vals[$i]['value'], <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; 'children' =&gt; GetChildren($vals, $i)<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; );&nbsp; &nbsp; &nbsp; &nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; break;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; case 'close':<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return $children;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; }<br />
}<br />
<br />
function GetXMLTree($file) {<br />
<br />
&nbsp;&nbsp;&nbsp; $data = implode('', file($file));<br />
<br />
&nbsp;&nbsp;&nbsp; // by: waldo@wh-e.com - trim space around tags not within<br />
&nbsp;&nbsp;&nbsp; $data = eregi_replace("&gt;"."[[:space:]]+"."&lt;","&gt;&lt;",$data);<br />
<br />
&nbsp;&nbsp;&nbsp; // XML functions<br />
&nbsp;&nbsp;&nbsp; $p = xml_parser_create();<br />
<br />
&nbsp;&nbsp;&nbsp; // by: anony@mous.com - meets XML 1.0 specification<br />
&nbsp;&nbsp;&nbsp; xml_parser_set_option($p, XML_OPTION_CASE_FOLDING, 0);<br />
&nbsp;&nbsp;&nbsp; xml_parse_into_struct($p, $data, &amp;$vals, &amp;$index);<br />
&nbsp;&nbsp;&nbsp; xml_parser_free($p);<br />
<br />
&nbsp;&nbsp;&nbsp; $i = 0;<br />
&nbsp;&nbsp;&nbsp; $tree = array();<br />
&nbsp;&nbsp;&nbsp; $tree[] = array(<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; 'tag' =&gt; $vals[$i]['tag'], <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; 'attributes' =&gt; $vals[$i]['attributes'], <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; 'value' =&gt; $vals[$i]['value'], <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; 'children' =&gt; GetChildren($vals, $i)<br />
&nbsp;&nbsp;&nbsp; );<br />
<br />
&nbsp;&nbsp;&nbsp; return $tree;<br />
}<br />
<br />
***************************************</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="20412""></a>
  <div class="note">
   <strong class="user">dave at ovumdesign dot com</strong>
   <a href="#20412" class="date">03-Apr-2002 03:32</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Here is another variation on gdemartini@bol.com.br's nice tree algorithm. I have included nyk@cowham.net's "cdata" suggestion. I made a few changes to suppress unitialized variable warnings with error_reporting(E_ALL), and made a few stylistic changes.<br />
<br />
There are two functional modifications as well. The first is the added option to expat to turn off "case folding", since XML is technically a case-sensitive language. The second is the returned tree - instead of returning a single-element list (an array with index 0 pointing to the top node) like the original algorithm, it returns the top node itself. This saves you an unnecessary level of indirection.<br />
<br />
function xml_get_children($vals, &amp;$i) {<br />
&nbsp;&nbsp;&nbsp; $children = array();<br />
&nbsp;&nbsp;&nbsp; if (isset($vals[$i]['value'])) $children[] = $vals[$i]['value'];<br />
<br />
&nbsp;&nbsp;&nbsp; while (++$i &lt; count($vals)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; switch ($vals[$i]['type']) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; case 'cdata':<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $children[] = $vals[$i]['value'];<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; break;<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; case 'complete':<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $children[] = array(<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; 'tag'&nbsp; &nbsp; &nbsp; &nbsp; =&gt; $vals[$i]['tag'],<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; 'attributes' =&gt; isset($vals[$i]['attributes'])?<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $vals[$i]['attributes'] : null,<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; 'value'&nbsp; &nbsp; &nbsp; =&gt; $vals[$i]['value'],<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; );<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; break;<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; case 'open':<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $children[] = array(<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; 'tag'&nbsp; &nbsp; &nbsp; &nbsp; =&gt; $vals[$i]['tag'],<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; 'attributes' =&gt; isset($vals[$i]['attributes'])?<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $vals[$i]['attributes'] : null,<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; 'children'&nbsp;&nbsp; =&gt; xml_get_children($vals, $i),<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; );<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; break;<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; case 'close':<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return $children;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; }<br />
}<br />
<br />
function xml_get_tree($file) {<br />
&nbsp;&nbsp;&nbsp; $data = join('', file($file));<br />
<br />
&nbsp;&nbsp;&nbsp; $parser = xml_parser_create();<br />
&nbsp;&nbsp;&nbsp; xml_parser_set_option($parser, XML_OPTION_CASE_FOLDING, 0);<br />
&nbsp;&nbsp;&nbsp; xml_parser_set_option($parser, XML_OPTION_SKIP_WHITE,&nbsp;&nbsp; 1);<br />
&nbsp;&nbsp;&nbsp; xml_parse_into_struct($parser, $data, $vals, $index);<br />
&nbsp;&nbsp;&nbsp; xml_parser_free($parser);<br />
<br />
&nbsp;&nbsp;&nbsp; return array(<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; 'tag'&nbsp; &nbsp; &nbsp; &nbsp; =&gt; $vals[0]['tag'],<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; 'attributes' =&gt; isset($vals[0]['attributes'])?<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $vals[0]['attributes'] : null,<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; 'children'&nbsp;&nbsp; =&gt; xml_get_children($vals, $i = 0),<br />
&nbsp;&nbsp;&nbsp; );<br />
}<br />
<br />
This function takes a tree returned by xml_get_tree() and simplifies it similarly to voncken@mailandnews.com and oknapp@soly.de's suggestions. It finds any nodes that expat considered "complete" (childless) and contain no attributes, and it moves the tag name (as the key) and value into an element in the parent node's "values" array.<br />
<br />
For example: <br />
$tree = xml_get_tree('moldb.xml');&nbsp;&nbsp; <br />
$tree = xml_condense_tree($tree); <br />
echo $tree['children'][1]['values']['name'];<br />
<br />
Outputs:<br />
Lysine<br />
<br />
function xml_condense_tree($tree) {<br />
&nbsp;&nbsp;&nbsp; foreach ($tree['children'] as $index =&gt; $node) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (isset($node['children'])) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $tree['children'][$index] = xml_condense_tree($node);<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; } elseif (isset($node['value']) and !$node['attributes']) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $tree['values'][$node['tag']] = $node['value'];<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; unset($tree['children'][$index]);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; <br />
&nbsp;&nbsp;&nbsp; if (!$tree['children']) unset($tree['children']);<br />
&nbsp;&nbsp;&nbsp; return $tree;<br />
}<br />
<br />
Enjoy,<br />
Dave</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
</div>
</div>
</div></div></body></html>
