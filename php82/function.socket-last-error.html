<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
 <head>
  <meta http-equiv="content-type" content="text/html; CHARSET=UTF-8">
  <title>返回套接字上的最后一个错误</title>
<link media="all" rel="stylesheet" type="text/css" href="styles/03e73060321a0a848018724a6c83de7f-theme-base.css" />
<link media="all" rel="stylesheet" type="text/css" href="styles/03e73060321a0a848018724a6c83de7f-theme-medium.css" />

  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <link media="all" rel="stylesheet" type="text/css" href="style.css"/>
 </head>
 <body class="docs" class="docs"><div class="navbar navbar-fixed-top">
  <div class="navbar-inner clearfix">
    <ul class="nav" style="width: 100%">
      <li style="float: left;"><a href="function.socket-import-stream.html">? socket_import_stream</a></li>
      <li style="float: right;"><a href="function.socket-listen.html">socket_listen ?</a></li>
    </ul>
  </div>
</div>
<div id="breadcrumbs" class="clearfix">
  <ul class="breadcrumbs-container">
    <li><a href="index.html">PHP Manual</a></li>
    <li><a href="ref.sockets.html">Socket 函数</a></li>
    <li>返回套接字上的最后一个错误</li>
  </ul>
</div>
<div id="layout">
  <div id="layout-content"><div id="function.socket-last-error" class="refentry">
 <div class="refnamediv">
  <h1 class="refname">socket_last_error</h1>
  <p class="verinfo">(PHP 4 &gt;= 4.1.0, PHP 5, PHP 7, PHP 8)</p><p class="refpurpose"><span class="refname">socket_last_error</span> &mdash; <span class="dc-title">返回套接字上的最后一个错误</span></p>

 </div>
 
 <div class="refsect1 description" id="refsect1-function.socket-last-error-description">
  <h3 class="title">说明</h3>
  <div class="methodsynopsis dc-description">
   <span class="methodname"><strong>socket_last_error</strong></span>(<span class="methodparam"><span class="type">?</span><span class="type"><span class="type"><a href="class.socket.html" class="type Socket">Socket</a></span><span class="type"></span></span> <code class="parameter">$socket</code><span class="initializer"> = <strong><code>null</code></strong></span></span>): <span class="type">int</span></div>

  <p class="para rdfs-comment">
   如果将 <span class="classname"><a href="class.socket.html" class="classname">Socket</a></span> 实例传递给此函数，将会返回指定套接字发生的最后一个错误。如果
   <code class="parameter">socket</code> 为 <strong><code>null</code></strong>, 则返回最后一个失败的套接字函数的错误码。此函数对以下情况特别有帮助：
   <span class="function"><a href="function.socket-create.html" class="function">socket_create()</a></span> 失败时不会返回套接字，以及
   <span class="function"><a href="function.socket-select.html" class="function">socket_select()</a></span> 失败的原因与特定套接字没有直接联系。
   错误码适合提供给 <span class="function"><a href="function.socket-strerror.html" class="function">socket_strerror()</a></span>，将返回指定错误码的字符串描述。
  </p>
  <p class="para">
   如果没有错误或者已经使用 <span class="function"><a href="function.socket-clear-error.html" class="function">socket_clear_error()</a></span> 清除了错误，则函数返回 <code class="literal">0</code>。
  </p>
 </div>


 <div class="refsect1 parameters" id="refsect1-function.socket-last-error-parameters">
  <h3 class="title">参数</h3>
  <p class="para">
   <dl>
    
     <dt>
<code class="parameter">socket</code></dt>

     <dd>

      <p class="para">
       通过 <span class="function"><a href="function.socket-create.html" class="function">socket_create()</a></span> 创建的 <span class="classname"><a href="class.socket.html" class="classname">Socket</a></span> 实例。
      </p>
     </dd>

    
   </dl>

  </p>
 </div>


 <div class="refsect1 returnvalues" id="refsect1-function.socket-last-error-returnvalues">
  <h3 class="title">返回值</h3>
  <p class="para">
   此函数返回套接字错误码。
  </p>
 </div>


 <div class="refsect1 changelog" id="refsect1-function.socket-last-error-changelog">
  <h3 class="title">更新日志</h3>
  <table class="doctable informaltable">
   
    <thead>
     <tr>
      <th>版本</th>
      <th>说明</th>
     </tr>

    </thead>

    <tbody class="tbody">
     <tr>
  <td>8.0.0</td>
  <td>
   现在 <code class="parameter">socket</code> 是 <span class="classname"><a href="class.socket.html" class="classname">Socket</a></span> 实例，
   之前是 <span class="type">resource</span>。
  </td>
 </tr>

     <tr>
      <td>8.0.0</td>
      <td>
       <code class="parameter">socket</code> 现在可为空（nullable）。
      </td>
     </tr>

    </tbody>
   
  </table>

 </div>


 <div class="refsect1 examples" id="refsect1-function.socket-last-error-examples">
  <h3 class="title">示例</h3>
  <p class="para">
   <div class="example" id="">
    <p><strong>Example #1 <span class="function"><strong>socket_last_error()</strong></span> 示例</strong></p>
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br />$socket </span><span style="color: #007700">= @</span><span style="color: #0000BB">socket_create</span><span style="color: #007700">(</span><span style="color: #0000BB">AF_INET</span><span style="color: #007700">, </span><span style="color: #0000BB">SOCK_STREAM</span><span style="color: #007700">, </span><span style="color: #0000BB">SOL_TCP</span><span style="color: #007700">);<br /><br />if (</span><span style="color: #0000BB">$socket </span><span style="color: #007700">=== </span><span style="color: #0000BB">false</span><span style="color: #007700">) {<br />    </span><span style="color: #0000BB">$errorcode </span><span style="color: #007700">= </span><span style="color: #0000BB">socket_last_error</span><span style="color: #007700">();<br />    </span><span style="color: #0000BB">$errormsg </span><span style="color: #007700">= </span><span style="color: #0000BB">socket_strerror</span><span style="color: #007700">(</span><span style="color: #0000BB">$errorcode</span><span style="color: #007700">);<br />    <br />    die(</span><span style="color: #DD0000">"Couldn't create socket: [</span><span style="color: #0000BB">$errorcode</span><span style="color: #DD0000">] </span><span style="color: #0000BB">$errormsg</span><span style="color: #DD0000">"</span><span style="color: #007700">);<br />}<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
    </div>

   </div>
  </p>
 </div>


 <div class="refsect1 notes" id="refsect1-function.socket-last-error-notes">
  <h3 class="title">注释</h3>
  <blockquote class="note"><p><strong class="note">Note</strong>: 
   <p class="para">
    <span class="function"><strong>socket_last_error()</strong></span> 不会清除错误代码，如果需要可以使用
    <span class="function"><a href="function.socket-clear-error.html" class="function">socket_clear_error()</a></span> 清除。
   </p>
  </p></blockquote>
 </div>


</div><div id="usernotes">
 <div class="head">
  <h3 class="title">User Contributed Notes</h3>
 </div>
<div id="allnotes">  <a name="123535""></a>
  <div class="note">
   <strong class="user">divinity76 at gmail dot com</strong>
   <a href="#123535" class="date">19-Jan-2019 08:21</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
note that socket_last_error() cache the last error from the last socket syscall, it does not actually query the OS for the last error on the socket, so if an async socket have an error after the last async operation started successfully, socket_last_error() doesn't know about it, but&nbsp; socket_get_option($sock, SOL_SOCKET, SO_ERROR) actually query the OS, or so it seems... observed on PHP 7.1.16 on Cygwin on win7 x64 SP1 with non-blocking sockets, socket_last_error() never caught on to the fact that the current error had changed from EINPROGRESS (non-blocking connect) to 0 (connection successful)</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="95160""></a>
  <div class="note">
   <strong class="user">ca at php dot spamtrak dot org</strong>
   <a href="#95160" class="date">15-Dec-2009 02:33</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
This is a bit long, but personally I prefer to use the standard C defines in my code.
<br />

<br />
<span class="default">&lt;?php
<br />

<br />
define</span><span class="keyword">(</span><span class="string">'ENOTSOCK'</span><span class="keyword">,&nbsp; &nbsp; &nbsp; </span><span class="default">88</span><span class="keyword">);&nbsp; &nbsp; </span><span class="comment">/* Socket operation on non-socket */
<br />
</span><span class="default">define</span><span class="keyword">(</span><span class="string">'EDESTADDRREQ'</span><span class="keyword">,&nbsp; </span><span class="default">89</span><span class="keyword">);&nbsp; &nbsp; </span><span class="comment">/* Destination address required */
<br />
</span><span class="default">define</span><span class="keyword">(</span><span class="string">'EMSGSIZE'</span><span class="keyword">,&nbsp; &nbsp; &nbsp; </span><span class="default">90</span><span class="keyword">);&nbsp; &nbsp; </span><span class="comment">/* Message too long */
<br />
</span><span class="default">define</span><span class="keyword">(</span><span class="string">'EPROTOTYPE'</span><span class="keyword">,&nbsp; &nbsp; </span><span class="default">91</span><span class="keyword">);&nbsp; &nbsp; </span><span class="comment">/* Protocol wrong type for socket */
<br />
</span><span class="default">define</span><span class="keyword">(</span><span class="string">'ENOPROTOOPT'</span><span class="keyword">,&nbsp;&nbsp; </span><span class="default">92</span><span class="keyword">);&nbsp; &nbsp; </span><span class="comment">/* Protocol not available */
<br />
</span><span class="default">define</span><span class="keyword">(</span><span class="string">'EPROTONOSUPPORT'</span><span class="keyword">, </span><span class="default">93</span><span class="keyword">);&nbsp; </span><span class="comment">/* Protocol not supported */
<br />
</span><span class="default">define</span><span class="keyword">(</span><span class="string">'ESOCKTNOSUPPORT'</span><span class="keyword">, </span><span class="default">94</span><span class="keyword">);&nbsp; </span><span class="comment">/* Socket type not supported */
<br />
</span><span class="default">define</span><span class="keyword">(</span><span class="string">'EOPNOTSUPP'</span><span class="keyword">,&nbsp; &nbsp; </span><span class="default">95</span><span class="keyword">);&nbsp; &nbsp; </span><span class="comment">/* Operation not supported on transport endpoint */
<br />
</span><span class="default">define</span><span class="keyword">(</span><span class="string">'EPFNOSUPPORT'</span><span class="keyword">,&nbsp; </span><span class="default">96</span><span class="keyword">);&nbsp; &nbsp; </span><span class="comment">/* Protocol family not supported */
<br />
</span><span class="default">define</span><span class="keyword">(</span><span class="string">'EAFNOSUPPORT'</span><span class="keyword">,&nbsp; </span><span class="default">97</span><span class="keyword">);&nbsp; &nbsp; </span><span class="comment">/* Address family not supported by protocol */
<br />
</span><span class="default">define</span><span class="keyword">(</span><span class="string">'EADDRINUSE'</span><span class="keyword">,&nbsp; &nbsp; </span><span class="default">98</span><span class="keyword">);&nbsp; &nbsp; </span><span class="comment">/* Address already in use */
<br />
</span><span class="default">define</span><span class="keyword">(</span><span class="string">'EADDRNOTAVAIL'</span><span class="keyword">, </span><span class="default">99</span><span class="keyword">);&nbsp; &nbsp; </span><span class="comment">/* Cannot assign requested address */
<br />
</span><span class="default">define</span><span class="keyword">(</span><span class="string">'ENETDOWN'</span><span class="keyword">,&nbsp; &nbsp; &nbsp; </span><span class="default">100</span><span class="keyword">);&nbsp;&nbsp; </span><span class="comment">/* Network is down */
<br />
</span><span class="default">define</span><span class="keyword">(</span><span class="string">'ENETUNREACH'</span><span class="keyword">,&nbsp;&nbsp; </span><span class="default">101</span><span class="keyword">);&nbsp;&nbsp; </span><span class="comment">/* Network is unreachable */
<br />
</span><span class="default">define</span><span class="keyword">(</span><span class="string">'ENETRESET'</span><span class="keyword">,&nbsp; &nbsp;&nbsp; </span><span class="default">102</span><span class="keyword">);&nbsp;&nbsp; </span><span class="comment">/* Network dropped connection because of reset */
<br />
</span><span class="default">define</span><span class="keyword">(</span><span class="string">'ECONNABORTED'</span><span class="keyword">,&nbsp; </span><span class="default">103</span><span class="keyword">);&nbsp;&nbsp; </span><span class="comment">/* Software caused connection abort */
<br />
</span><span class="default">define</span><span class="keyword">(</span><span class="string">'ECONNRESET'</span><span class="keyword">,&nbsp; &nbsp; </span><span class="default">104</span><span class="keyword">);&nbsp;&nbsp; </span><span class="comment">/* Connection reset by peer */
<br />
</span><span class="default">define</span><span class="keyword">(</span><span class="string">'ENOBUFS'</span><span class="keyword">,&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">105</span><span class="keyword">);&nbsp;&nbsp; </span><span class="comment">/* No buffer space available */
<br />
</span><span class="default">define</span><span class="keyword">(</span><span class="string">'EISCONN'</span><span class="keyword">,&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">106</span><span class="keyword">);&nbsp;&nbsp; </span><span class="comment">/* Transport endpoint is already connected */
<br />
</span><span class="default">define</span><span class="keyword">(</span><span class="string">'ENOTCONN'</span><span class="keyword">,&nbsp; &nbsp; &nbsp; </span><span class="default">107</span><span class="keyword">);&nbsp;&nbsp; </span><span class="comment">/* Transport endpoint is not connected */
<br />
</span><span class="default">define</span><span class="keyword">(</span><span class="string">'ESHUTDOWN'</span><span class="keyword">,&nbsp; &nbsp;&nbsp; </span><span class="default">108</span><span class="keyword">);&nbsp;&nbsp; </span><span class="comment">/* Cannot send after transport endpoint shutdown */
<br />
</span><span class="default">define</span><span class="keyword">(</span><span class="string">'ETOOMANYREFS'</span><span class="keyword">,&nbsp; </span><span class="default">109</span><span class="keyword">);&nbsp;&nbsp; </span><span class="comment">/* Too many references: cannot splice */
<br />
</span><span class="default">define</span><span class="keyword">(</span><span class="string">'ETIMEDOUT'</span><span class="keyword">,&nbsp; &nbsp;&nbsp; </span><span class="default">110</span><span class="keyword">);&nbsp;&nbsp; </span><span class="comment">/* Connection timed out */
<br />
</span><span class="default">define</span><span class="keyword">(</span><span class="string">'ECONNREFUSED'</span><span class="keyword">,&nbsp; </span><span class="default">111</span><span class="keyword">);&nbsp;&nbsp; </span><span class="comment">/* Connection refused */
<br />
</span><span class="default">define</span><span class="keyword">(</span><span class="string">'EHOSTDOWN'</span><span class="keyword">,&nbsp; &nbsp;&nbsp; </span><span class="default">112</span><span class="keyword">);&nbsp;&nbsp; </span><span class="comment">/* Host is down */
<br />
</span><span class="default">define</span><span class="keyword">(</span><span class="string">'EHOSTUNREACH'</span><span class="keyword">,&nbsp; </span><span class="default">113</span><span class="keyword">);&nbsp;&nbsp; </span><span class="comment">/* No route to host */
<br />
</span><span class="default">define</span><span class="keyword">(</span><span class="string">'EALREADY'</span><span class="keyword">,&nbsp; &nbsp; &nbsp; </span><span class="default">114</span><span class="keyword">);&nbsp;&nbsp; </span><span class="comment">/* Operation already in progress */
<br />
</span><span class="default">define</span><span class="keyword">(</span><span class="string">'EINPROGRESS'</span><span class="keyword">,&nbsp;&nbsp; </span><span class="default">115</span><span class="keyword">);&nbsp;&nbsp; </span><span class="comment">/* Operation now in progress */
<br />
</span><span class="default">define</span><span class="keyword">(</span><span class="string">'EREMOTEIO'</span><span class="keyword">,&nbsp; &nbsp;&nbsp; </span><span class="default">121</span><span class="keyword">);&nbsp;&nbsp; </span><span class="comment">/* Remote I/O error */
<br />
</span><span class="default">define</span><span class="keyword">(</span><span class="string">'ECANCELED'</span><span class="keyword">,&nbsp; &nbsp;&nbsp; </span><span class="default">125</span><span class="keyword">);&nbsp;&nbsp; </span><span class="comment">/* Operation Canceled */
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
</div>
</div>
</div></div></body></html>
