<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
 <head>
  <meta http-equiv="content-type" content="text/html; CHARSET=UTF-8">
  <title>绑定 PHP 变量到 Oracle 位置标志符</title>
<link media="all" rel="stylesheet" type="text/css" href="styles/03e73060321a0a848018724a6c83de7f-theme-base.css" />
<link media="all" rel="stylesheet" type="text/css" href="styles/03e73060321a0a848018724a6c83de7f-theme-medium.css" />

  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <link media="all" rel="stylesheet" type="text/css" href="style.css"/>
 </head>
 <body class="docs" class="docs"><div class="navbar navbar-fixed-top">
  <div class="navbar-inner clearfix">
    <ul class="nav" style="width: 100%">
      <li style="float: left;"><a href="function.oci-bind-array-by-name.html">? oci_bind_array_by_name</a></li>
      <li style="float: right;"><a href="function.oci-cancel.html">oci_cancel ?</a></li>
    </ul>
  </div>
</div>
<div id="breadcrumbs" class="clearfix">
  <ul class="breadcrumbs-container">
    <li><a href="index.html">PHP Manual</a></li>
    <li><a href="ref.oci8.html">OCI8 函数</a></li>
    <li>绑定 PHP 变量到 Oracle 位置标志符</li>
  </ul>
</div>
<div id="layout">
  <div id="layout-content"><div id="function.oci-bind-by-name" class="refentry">
 <div class="refnamediv">
  <h1 class="refname">oci_bind_by_name</h1>
  <p class="verinfo">(PHP 5, PHP 7, PHP 8, PECL OCI8 &gt;= 1.1.0)</p><p class="refpurpose"><span class="refname">oci_bind_by_name</span> &mdash; <span class="dc-title">绑定 PHP 变量到 Oracle 位置标志符</span></p>

 </div>
 <div class="refsect1 description" id="refsect1-function.oci-bind-by-name-description">
  <h3 class="title">说明</h3>
  <div class="methodsynopsis dc-description">
   <span class="methodname"><strong>oci_bind_by_name</strong></span>(<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="methodparam"><span class="type">resource</span> <code class="parameter">$statement</code></span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="methodparam"><span class="type">string</span> <code class="parameter">$param</code></span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="methodparam"><span class="type"><a href="language.types.declarations.html#language.types.declarations.mixed" class="type mixed">mixed</a></span> <code class="parameter reference">&$var</code></span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="methodparam"><span class="type">int</span> <code class="parameter">$max_length</code><span class="initializer"> = -1</span></span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="methodparam"><span class="type">int</span> <code class="parameter">$type</code><span class="initializer"> = 0</span></span><br>): <span class="type">bool</span></div>

  <p class="para rdfs-comment">
   将 PHP 变量 <code class="parameter">var</code> 绑定到 Oracle 位置占位符 <code class="parameter">param</code>。绑定对
   Oracle 数据库性能很重要，同时也是避免 SQL 注入安全问题的一种方式。
  </p>

  <p class="para">
    绑定允许数据库重用语句上下文和以前执行语句的缓存，即使另一个用户或进程最初（originally）执行它也是如此。绑定减少了 SQL
    注入问题，因为与绑定变量关联的数据永远不会被视为 SQL 语句的一部分。不需要引用或转义。
  </p>

  <p class="para">
    已经绑定的 PHP 变量可以改变，语句重新执行，而不需要重新解析语句或重新绑定。
  </p>

  <p class="para">
    在 Oracle 中，绑定变量通常分为用于传递到数据库的值的 <code class="literal">IN</code> 绑定和用于返回给 PHP 的值的 <code class="literal">OUT</code>
    绑定。绑定变量可以同时为 <code class="literal">IN</code> 和 <code class="literal">OUT</code>。绑定变量是用于输入还是输出是在运行时确定的。
  </p>

  <p class="para">
    使用 <code class="literal">OUT</code> 绑定时必须指定 <code class="parameter">max_length</code> 以便 PHP 分配足够的内存来保存返回值。
  </p>

  <p class="para">
    对于 <code class="literal">IN</code> 绑定，如果使用不同的 PHP 变量值多次重新执行该语句，建议设置 <code class="parameter">max_length</code> 长度。否则
    Oracle 可能会将数据截断为初始 PHP 变量值的长度。如果不知道最大长度是多少，则在每次调用 <span class="function"><a href="function.oci-execute.html" class="function">oci_execute()</a></span> 之前使用当前数据大小重新调用
    <span class="function"><strong>oci_bind_by_name()</strong></span>。绑定不必要的大长度将对数据库中的进程内存产生影响。
  </p>

  <p class="para">
    绑定调用告诉 Oracle 从哪个内存地址读取数据。对于 <code class="literal">IN</code> 绑定，调用 <span class="function"><a href="function.oci-execute.html" class="function">oci_execute()</a></span>
    时地址需要包含有效数据。这意味着变量绑定必须保留在作用域内直到执行。否则，可能会出现意外结果或错误，例如"ORA-01460：未实现或不合理的转换请求"。对于
    <code class="literal">OUT</code> 绑定，一个问题是没有在 PHP 变量中设置值。
  </p>

  <p class="para">
    对于重复执行的语句，永远不变的绑定值可能会降低 Oracle 优化器选择最佳语句执行计划的能力。很少重新执行的长时间运行的语句可能无法从绑定中获益。但是，在这两种情况下，绑定可能比将字符串连接到
    SQL 语句中更安全，因为如果连接未过滤的用户文本，这可能会带来安全风险。
  </p>
 </div>


 <div class="refsect1 parameters" id="refsect1-function.oci-bind-by-name-parameters">
  <h3 class="title">参数</h3>
  <p class="para">
   <dl>
    
     <dt>
<code class="parameter">statement</code></dt>

     <dd>

      <p class="para">
       有效的 OCI8 语句标识符。
      </p>
     </dd>

    
    
     <dt>
<code class="parameter">param</code></dt>

     <dd>

      <p class="para">
       语句中使用以冒号为前缀的绑定变量占位符。冒号在 <code class="parameter">param</code> 中是可选的。Oracle 不使用问号作为占位符。
      </p>
     </dd>

    
    
     <dt>
<code class="parameter">var</code></dt>

     <dd>

      <p class="para">
       与 <code class="parameter">param</code> 关联的 PHP 变量
      </p>
     </dd>

    
    
     <dt>
<code class="parameter">max_length</code></dt>

     <dd>

      <p class="para">
       设置数据的最大长度。如果将其设置为 -1，则此函数将使用 <code class="parameter">var</code>
       的当前长度来设置最大长度。在这种情况下，<code class="parameter">var</code> 必须存在并且在调用
       <span class="function"><strong>oci_bind_by_name()</strong></span> 时包含数据。
      </p>
     </dd>

    
    
     <dt>
<code class="parameter">type</code></dt>

     <dd>

      <p class="para">
       Oracle 处理数据的数据类型。使用的默认 <code class="parameter">type</code> 是 <strong><code>SQLT_CHR</code></strong>。可能的话，Oracle
       将在此类型和数据库列（或 PL/SQL 变量类型）之间转换数据。
      </p>
      <p class="para">
       如果要绑定抽象数据类型（LOB/ROWID/BFILE），需要先用 <span class="function"><a href="function.oci-new-descriptor.html" class="function">oci_new_descriptor()</a></span>
       函数分配空间。<code class="parameter">length</code> 没有用于抽象数据类型，应被设为 -1。
      </p>
      <p class="para">
       <code class="parameter">type</code> 的可能值为：
       <ul class="itemizedlist">
        <li class="listitem">
         <p class="para">
          <strong><code>SQLT_BFILEE</code></strong> 或 <strong><code>OCI_B_BFILE</code></strong>
           对应 BFILE；
         </p>
        </li>
        <li class="listitem">
         <p class="para">
          <strong><code>SQLT_CFILEE</code></strong> 或 <strong><code>OCI_B_CFILEE</code></strong> 对应 CFILE；
         </p>
        </li>
        <li class="listitem">
         <p class="para">
          <strong><code>SQLT_CLOB</code></strong> 或 <strong><code>OCI_B_CLOB</code></strong> 对应 CLOB；
         </p>
        </li>
        <li class="listitem">
         <p class="para">
          <strong><code>SQLT_BLOB</code></strong> 或 <strong><code>OCI_B_BLOB</code></strong> 对应 BLOB；
         </p>
        </li>
        <li class="listitem">
         <p class="para">
          <strong><code>SQLT_RDD</code></strong> 或 <strong><code>OCI_B_ROWID</code></strong> 对应 ROWID；
         </p>
        </li>
        <li class="listitem">
         <p class="para">
          <strong><code>SQLT_NTY</code></strong> 或 <strong><code>OCI_B_NTY</code></strong> 对应命名数据类型；
         </p>
        </li>
        <li class="listitem">
         <p class="para">
          <strong><code>SQLT_INT</code></strong> 或 <strong><code>OCI_B_INT</code></strong> 对应整型；
         </p>
        </li>
        <li class="listitem">
         <p class="para">
          <strong><code>SQLT_CHR</code></strong> 对应 VARCHAR；
         </p>
        </li>
        <li class="listitem">
         <p class="para">
          <strong><code>SQLT_BIN</code></strong> 或 <strong><code>OCI_B_BIN</code></strong>
          对应 RAW 列；
         </p>
        </li>
        <li class="listitem">
         <p class="para">
          <strong><code>SQLT_LNG</code></strong> 对应 LONG 列；
         </p>
        </li>
        <li class="listitem">
         <p class="para">
          <strong><code>SQLT_LBI</code></strong> 对应 LONG RAW 列；
         </p>
        </li>
        <li class="listitem">
         <p class="para">
          <strong><code>SQLT_RSET</code></strong> 对应使用 <span class="function"><a href="function.oci-new-cursor.html" class="function">oci_new_cursor()</a></span> 创建的游标；
         </p>
        </li>
        <li class="listitem">
         <p class="para">
          <strong><code>SQLT_BOL</code></strong> 或 <strong><code>OCI_B_BOL</code></strong> 对应 PL/SQL BOOLEAN（需要 Oracle Database 12c）
         </p>
        </li>
       </ul>
      </p>
     </dd>

    
   </dl>

  </p>
 </div>


 <div class="refsect1 returnvalues" id="refsect1-function.oci-bind-by-name-returnvalues">
  <h3 class="title">返回值</h3>
  <p class="para">
   成功时返回 <strong><code>true</code></strong>， 或者在失败时返回 <strong><code>false</code></strong>。
  </p>
 </div>


 <div class="refsect1 examples" id="refsect1-function.oci-bind-by-name-examples">
  <h3 class="title">示例</h3>
  <p class="para">
   <div class="example" id="example-3624">
    <p><strong>Example #1 使用 <span class="function"><strong>oci_bind_by_name()</strong></span> 插入数据</strong></p>
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br /><br /></span><span style="color: #FF8000">// Create the table with:<br />//   CREATE TABLE mytab (id NUMBER, text VARCHAR2(40));<br /><br /></span><span style="color: #0000BB">$conn </span><span style="color: #007700">= </span><span style="color: #0000BB">oci_connect</span><span style="color: #007700">(</span><span style="color: #DD0000">'hr'</span><span style="color: #007700">, </span><span style="color: #DD0000">'welcome'</span><span style="color: #007700">, </span><span style="color: #DD0000">'localhost/XE'</span><span style="color: #007700">);<br />if (!</span><span style="color: #0000BB">$conn</span><span style="color: #007700">) {<br />    </span><span style="color: #0000BB">$m </span><span style="color: #007700">= </span><span style="color: #0000BB">oci_error</span><span style="color: #007700">();<br />    </span><span style="color: #0000BB">trigger_error</span><span style="color: #007700">(</span><span style="color: #0000BB">htmlentities</span><span style="color: #007700">(</span><span style="color: #0000BB">$m</span><span style="color: #007700">[</span><span style="color: #DD0000">'message'</span><span style="color: #007700">]), </span><span style="color: #0000BB">E_USER_ERROR</span><span style="color: #007700">);<br />}<br /><br /></span><span style="color: #0000BB">$stid </span><span style="color: #007700">= </span><span style="color: #0000BB">oci_parse</span><span style="color: #007700">(</span><span style="color: #0000BB">$conn</span><span style="color: #007700">,</span><span style="color: #DD0000">"INSERT INTO mytab (id, text) VALUES(:id_bv, :text_bv)"</span><span style="color: #007700">);<br /><br /></span><span style="color: #0000BB">$id </span><span style="color: #007700">= </span><span style="color: #0000BB">1</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">$text </span><span style="color: #007700">= </span><span style="color: #DD0000">"Data to insert     "</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">oci_bind_by_name</span><span style="color: #007700">(</span><span style="color: #0000BB">$stid</span><span style="color: #007700">, </span><span style="color: #DD0000">":id_bv"</span><span style="color: #007700">, </span><span style="color: #0000BB">$id</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">oci_bind_by_name</span><span style="color: #007700">(</span><span style="color: #0000BB">$stid</span><span style="color: #007700">, </span><span style="color: #DD0000">":text_bv"</span><span style="color: #007700">, </span><span style="color: #0000BB">$text</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">oci_execute</span><span style="color: #007700">(</span><span style="color: #0000BB">$stid</span><span style="color: #007700">);<br /><br /></span><span style="color: #FF8000">// Table now contains: 1, 'Data to insert     '<br /><br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
    </div>

   </div>
  </p>

  <p class="para">
   <div class="example" id="example-3626">
    <p><strong>Example #2 一次绑定多次执行</strong></p>
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br /><br /></span><span style="color: #FF8000">// Create the table with:<br />//   CREATE TABLE mytab (id NUMBER);<br /><br /></span><span style="color: #0000BB">$conn </span><span style="color: #007700">= </span><span style="color: #0000BB">oci_connect</span><span style="color: #007700">(</span><span style="color: #DD0000">'hr'</span><span style="color: #007700">, </span><span style="color: #DD0000">'welcome'</span><span style="color: #007700">, </span><span style="color: #DD0000">'localhost/XE'</span><span style="color: #007700">);<br />if (!</span><span style="color: #0000BB">$conn</span><span style="color: #007700">) {<br />    </span><span style="color: #0000BB">$m </span><span style="color: #007700">= </span><span style="color: #0000BB">oci_error</span><span style="color: #007700">();<br />    </span><span style="color: #0000BB">trigger_error</span><span style="color: #007700">(</span><span style="color: #0000BB">htmlentities</span><span style="color: #007700">(</span><span style="color: #0000BB">$m</span><span style="color: #007700">[</span><span style="color: #DD0000">'message'</span><span style="color: #007700">]), </span><span style="color: #0000BB">E_USER_ERROR</span><span style="color: #007700">);<br />}<br /><br /></span><span style="color: #0000BB">$a </span><span style="color: #007700">= array(</span><span style="color: #0000BB">1</span><span style="color: #007700">,</span><span style="color: #0000BB">3</span><span style="color: #007700">,</span><span style="color: #0000BB">5</span><span style="color: #007700">,</span><span style="color: #0000BB">7</span><span style="color: #007700">,</span><span style="color: #0000BB">11</span><span style="color: #007700">);  </span><span style="color: #FF8000">// data to insert<br /><br /></span><span style="color: #0000BB">$stid </span><span style="color: #007700">= </span><span style="color: #0000BB">oci_parse</span><span style="color: #007700">(</span><span style="color: #0000BB">$conn</span><span style="color: #007700">, </span><span style="color: #DD0000">'INSERT INTO mytab (id) VALUES (:bv)'</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">oci_bind_by_name</span><span style="color: #007700">(</span><span style="color: #0000BB">$stid</span><span style="color: #007700">, </span><span style="color: #DD0000">':bv'</span><span style="color: #007700">, </span><span style="color: #0000BB">$v</span><span style="color: #007700">, </span><span style="color: #0000BB">20</span><span style="color: #007700">);<br />foreach (</span><span style="color: #0000BB">$a </span><span style="color: #007700">as </span><span style="color: #0000BB">$v</span><span style="color: #007700">) {<br />    </span><span style="color: #0000BB">$r </span><span style="color: #007700">= </span><span style="color: #0000BB">oci_execute</span><span style="color: #007700">(</span><span style="color: #0000BB">$stid</span><span style="color: #007700">, </span><span style="color: #0000BB">OCI_DEFAULT</span><span style="color: #007700">);  </span><span style="color: #FF8000">// don't auto commit<br /></span><span style="color: #007700">}<br /></span><span style="color: #0000BB">oci_commit</span><span style="color: #007700">(</span><span style="color: #0000BB">$conn</span><span style="color: #007700">); </span><span style="color: #FF8000">// commit everything at once<br /><br />// Table contains five rows: 1, 3, 5, 7, 11<br /><br /></span><span style="color: #0000BB">oci_free_statement</span><span style="color: #007700">(</span><span style="color: #0000BB">$stid</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">oci_close</span><span style="color: #007700">(</span><span style="color: #0000BB">$conn</span><span style="color: #007700">);<br /><br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
    </div>

   </div>
  </p>

  <p class="para">
   <div class="example" id="example-3628">
    <p><strong>Example #3 使用 <code class="literal">foreach</code> 循环绑定</strong></p>
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br /><br />$conn </span><span style="color: #007700">= </span><span style="color: #0000BB">oci_connect</span><span style="color: #007700">(</span><span style="color: #DD0000">'hr'</span><span style="color: #007700">, </span><span style="color: #DD0000">'welcome'</span><span style="color: #007700">, </span><span style="color: #DD0000">'localhost/XE'</span><span style="color: #007700">);<br />if (!</span><span style="color: #0000BB">$conn</span><span style="color: #007700">) {<br />    </span><span style="color: #0000BB">$m </span><span style="color: #007700">= </span><span style="color: #0000BB">oci_error</span><span style="color: #007700">();<br />    </span><span style="color: #0000BB">trigger_error</span><span style="color: #007700">(</span><span style="color: #0000BB">htmlentities</span><span style="color: #007700">(</span><span style="color: #0000BB">$m</span><span style="color: #007700">[</span><span style="color: #DD0000">'message'</span><span style="color: #007700">]), </span><span style="color: #0000BB">E_USER_ERROR</span><span style="color: #007700">);<br />}<br /><br /></span><span style="color: #0000BB">$sql </span><span style="color: #007700">= </span><span style="color: #DD0000">'SELECT * FROM departments WHERE department_name = :dname AND location_id = :loc'</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">$stid </span><span style="color: #007700">= </span><span style="color: #0000BB">oci_parse</span><span style="color: #007700">(</span><span style="color: #0000BB">$conn</span><span style="color: #007700">, </span><span style="color: #0000BB">$sql</span><span style="color: #007700">);<br /><br /></span><span style="color: #0000BB">$ba </span><span style="color: #007700">= array(</span><span style="color: #DD0000">':dname' </span><span style="color: #007700">=&gt; </span><span style="color: #DD0000">'IT Support'</span><span style="color: #007700">, </span><span style="color: #DD0000">':loc' </span><span style="color: #007700">=&gt; </span><span style="color: #0000BB">1700</span><span style="color: #007700">);<br /><br />foreach (</span><span style="color: #0000BB">$ba </span><span style="color: #007700">as </span><span style="color: #0000BB">$key </span><span style="color: #007700">=&gt; </span><span style="color: #0000BB">$val</span><span style="color: #007700">) {<br /><br />    </span><span style="color: #FF8000">// oci_bind_by_name($stid, $key, $val) does not work<br />    // because it binds each placeholder to the same location: $val<br />    // instead use the actual location of the data: $ba[$key]<br />    </span><span style="color: #0000BB">oci_bind_by_name</span><span style="color: #007700">(</span><span style="color: #0000BB">$stid</span><span style="color: #007700">, </span><span style="color: #0000BB">$key</span><span style="color: #007700">, </span><span style="color: #0000BB">$ba</span><span style="color: #007700">[</span><span style="color: #0000BB">$key</span><span style="color: #007700">]);<br />}<br /><br /></span><span style="color: #0000BB">oci_execute</span><span style="color: #007700">(</span><span style="color: #0000BB">$stid</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">$row </span><span style="color: #007700">= </span><span style="color: #0000BB">oci_fetch_array</span><span style="color: #007700">(</span><span style="color: #0000BB">$stid</span><span style="color: #007700">, </span><span style="color: #0000BB">OCI_ASSOC</span><span style="color: #007700">+</span><span style="color: #0000BB">OCI_RETURN_NULLS</span><span style="color: #007700">);<br />foreach (</span><span style="color: #0000BB">$row </span><span style="color: #007700">as </span><span style="color: #0000BB">$item</span><span style="color: #007700">) {<br />    print </span><span style="color: #0000BB">$item</span><span style="color: #007700">.</span><span style="color: #DD0000">"&lt;br&gt;\n"</span><span style="color: #007700">;<br />}<br /><br /></span><span style="color: #0000BB">oci_free_statement</span><span style="color: #007700">(</span><span style="color: #0000BB">$stid</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">oci_close</span><span style="color: #007700">(</span><span style="color: #0000BB">$conn</span><span style="color: #007700">);<br /><br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
    </div>

   </div>
  </p>

  <p class="para">
   <div class="example" id="example-3630">
    <p><strong>Example #4 在 WHERE 子句中绑定</strong></p>
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br /><br />$conn </span><span style="color: #007700">= </span><span style="color: #0000BB">oci_connect</span><span style="color: #007700">(</span><span style="color: #DD0000">"hr"</span><span style="color: #007700">, </span><span style="color: #DD0000">"hrpwd"</span><span style="color: #007700">, </span><span style="color: #DD0000">"localhost/XE"</span><span style="color: #007700">);<br />if (!</span><span style="color: #0000BB">$conn</span><span style="color: #007700">) {<br />    </span><span style="color: #0000BB">$m </span><span style="color: #007700">= </span><span style="color: #0000BB">oci_error</span><span style="color: #007700">();<br />    </span><span style="color: #0000BB">trigger_error</span><span style="color: #007700">(</span><span style="color: #0000BB">htmlentities</span><span style="color: #007700">(</span><span style="color: #0000BB">$m</span><span style="color: #007700">[</span><span style="color: #DD0000">'message'</span><span style="color: #007700">]), </span><span style="color: #0000BB">E_USER_ERROR</span><span style="color: #007700">);<br />}<br /><br /></span><span style="color: #0000BB">$sql </span><span style="color: #007700">= </span><span style="color: #DD0000">'SELECT last_name FROM employees WHERE department_id = :didbv ORDER BY last_name'</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">$stid </span><span style="color: #007700">= </span><span style="color: #0000BB">oci_parse</span><span style="color: #007700">(</span><span style="color: #0000BB">$conn</span><span style="color: #007700">, </span><span style="color: #0000BB">$sql</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">$didbv </span><span style="color: #007700">= </span><span style="color: #0000BB">60</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">oci_bind_by_name</span><span style="color: #007700">(</span><span style="color: #0000BB">$stid</span><span style="color: #007700">, </span><span style="color: #DD0000">':didbv'</span><span style="color: #007700">, </span><span style="color: #0000BB">$didbv</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">oci_execute</span><span style="color: #007700">(</span><span style="color: #0000BB">$stid</span><span style="color: #007700">);<br />while ((</span><span style="color: #0000BB">$row </span><span style="color: #007700">= </span><span style="color: #0000BB">oci_fetch_array</span><span style="color: #007700">(</span><span style="color: #0000BB">$stid</span><span style="color: #007700">, </span><span style="color: #0000BB">OCI_ASSOC</span><span style="color: #007700">)) != </span><span style="color: #0000BB">false</span><span style="color: #007700">) {<br />    echo </span><span style="color: #0000BB">$row</span><span style="color: #007700">[</span><span style="color: #DD0000">'LAST_NAME'</span><span style="color: #007700">] .</span><span style="color: #DD0000">"&lt;br&gt;\n"</span><span style="color: #007700">;<br />}<br /><br /></span><span style="color: #FF8000">// Output is<br />//    Austin<br />//    Ernst<br />//    Hunold<br />//    Lorentz<br />//    Pataballa<br /><br /></span><span style="color: #0000BB">oci_free_statement</span><span style="color: #007700">(</span><span style="color: #0000BB">$stid</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">oci_close</span><span style="color: #007700">(</span><span style="color: #0000BB">$conn</span><span style="color: #007700">);<br /><br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
    </div>

   </div>
  </p>

  <p class="para">
   <div class="example" id="example-3632">
    <p><strong>Example #5 使用 LIKE 子句绑定</strong></p>
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br /><br />$conn </span><span style="color: #007700">= </span><span style="color: #0000BB">oci_connect</span><span style="color: #007700">(</span><span style="color: #DD0000">'hr'</span><span style="color: #007700">, </span><span style="color: #DD0000">'welcome'</span><span style="color: #007700">, </span><span style="color: #DD0000">'localhost/XE'</span><span style="color: #007700">);<br />if (!</span><span style="color: #0000BB">$conn</span><span style="color: #007700">) {<br />    </span><span style="color: #0000BB">$m </span><span style="color: #007700">= </span><span style="color: #0000BB">oci_error</span><span style="color: #007700">();<br />    </span><span style="color: #0000BB">trigger_error</span><span style="color: #007700">(</span><span style="color: #0000BB">htmlentities</span><span style="color: #007700">(</span><span style="color: #0000BB">$m</span><span style="color: #007700">[</span><span style="color: #DD0000">'message'</span><span style="color: #007700">]), </span><span style="color: #0000BB">E_USER_ERROR</span><span style="color: #007700">);<br />}<br /><br /></span><span style="color: #FF8000">// Find all cities that begin with 'South'<br /></span><span style="color: #0000BB">$stid </span><span style="color: #007700">= </span><span style="color: #0000BB">oci_parse</span><span style="color: #007700">(</span><span style="color: #0000BB">$conn</span><span style="color: #007700">, </span><span style="color: #DD0000">"SELECT city FROM locations WHERE city LIKE :bv"</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">$city </span><span style="color: #007700">= </span><span style="color: #DD0000">'South%'</span><span style="color: #007700">;  </span><span style="color: #FF8000">// '%' is a wildcard in SQL<br /></span><span style="color: #0000BB">oci_bind_by_name</span><span style="color: #007700">(</span><span style="color: #0000BB">$stid</span><span style="color: #007700">, </span><span style="color: #DD0000">":bv"</span><span style="color: #007700">, </span><span style="color: #0000BB">$city</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">oci_execute</span><span style="color: #007700">(</span><span style="color: #0000BB">$stid</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">oci_fetch_all</span><span style="color: #007700">(</span><span style="color: #0000BB">$stid</span><span style="color: #007700">, </span><span style="color: #0000BB">$res</span><span style="color: #007700">);<br /><br />foreach (</span><span style="color: #0000BB">$res</span><span style="color: #007700">[</span><span style="color: #DD0000">'CITY'</span><span style="color: #007700">] as </span><span style="color: #0000BB">$c</span><span style="color: #007700">) {<br />    print </span><span style="color: #0000BB">$c </span><span style="color: #007700">. </span><span style="color: #DD0000">"&lt;br&gt;\n"</span><span style="color: #007700">;<br />}<br /></span><span style="color: #FF8000">// Output is<br />//   South Brunswick<br />//   South San Francisco<br />//   Southlake<br /><br /></span><span style="color: #0000BB">oci_free_statement</span><span style="color: #007700">(</span><span style="color: #0000BB">$stid</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">oci_close</span><span style="color: #007700">(</span><span style="color: #0000BB">$conn</span><span style="color: #007700">);<br /><br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
    </div>

   </div>
  </p>

  <p class="para">
   <div class="example" id="example-3634">
    <p><strong>Example #6 与 REGEXP_LIKE 绑定</strong></p>
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br /><br />$conn </span><span style="color: #007700">= </span><span style="color: #0000BB">oci_connect</span><span style="color: #007700">(</span><span style="color: #DD0000">'hr'</span><span style="color: #007700">, </span><span style="color: #DD0000">'welcome'</span><span style="color: #007700">, </span><span style="color: #DD0000">'localhost/XE'</span><span style="color: #007700">);<br />if (!</span><span style="color: #0000BB">$conn</span><span style="color: #007700">) {<br />    </span><span style="color: #0000BB">$m </span><span style="color: #007700">= </span><span style="color: #0000BB">oci_error</span><span style="color: #007700">();<br />    </span><span style="color: #0000BB">trigger_error</span><span style="color: #007700">(</span><span style="color: #0000BB">htmlentities</span><span style="color: #007700">(</span><span style="color: #0000BB">$m</span><span style="color: #007700">[</span><span style="color: #DD0000">'message'</span><span style="color: #007700">]), </span><span style="color: #0000BB">E_USER_ERROR</span><span style="color: #007700">);<br />}<br /><br /></span><span style="color: #FF8000">// Find all cities that contain 'ing'<br /></span><span style="color: #0000BB">$stid </span><span style="color: #007700">= </span><span style="color: #0000BB">oci_parse</span><span style="color: #007700">(</span><span style="color: #0000BB">$conn</span><span style="color: #007700">, </span><span style="color: #DD0000">"SELECT city FROM locations WHERE REGEXP_LIKE(city, :bv)"</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">$city </span><span style="color: #007700">= </span><span style="color: #DD0000">'.*ing.*'</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">oci_bind_by_name</span><span style="color: #007700">(</span><span style="color: #0000BB">$stid</span><span style="color: #007700">, </span><span style="color: #DD0000">":bv"</span><span style="color: #007700">, </span><span style="color: #0000BB">$city</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">oci_execute</span><span style="color: #007700">(</span><span style="color: #0000BB">$stid</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">oci_fetch_all</span><span style="color: #007700">(</span><span style="color: #0000BB">$stid</span><span style="color: #007700">, </span><span style="color: #0000BB">$res</span><span style="color: #007700">);<br /><br />foreach (</span><span style="color: #0000BB">$res</span><span style="color: #007700">[</span><span style="color: #DD0000">'CITY'</span><span style="color: #007700">] as </span><span style="color: #0000BB">$c</span><span style="color: #007700">) {<br />    print </span><span style="color: #0000BB">$c </span><span style="color: #007700">. </span><span style="color: #DD0000">"&lt;br&gt;\n"</span><span style="color: #007700">;<br />}<br /></span><span style="color: #FF8000">// Output is<br />//   Beijing<br />//   Singapore<br /><br /></span><span style="color: #0000BB">oci_free_statement</span><span style="color: #007700">(</span><span style="color: #0000BB">$stid</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">oci_close</span><span style="color: #007700">(</span><span style="color: #0000BB">$conn</span><span style="color: #007700">);<br /><br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
    </div>

   </div>
  </p>

  <p class="para">
    对于少量固定数量的 IN 子句条件，请使用单独的绑定变量。运行时未知的值可以设置为 NULL。这允许所有应用程序用户使用单个语句，从而最大限度地提高 Oracle 数据库缓存效率。
  </p>

  <p class="para">
   <div class="example" id="example-3636">
    <p><strong>Example #7 在 IN 子句中绑定多个值</strong></p>
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br /><br />$conn </span><span style="color: #007700">= </span><span style="color: #0000BB">oci_connect</span><span style="color: #007700">(</span><span style="color: #DD0000">'hr'</span><span style="color: #007700">, </span><span style="color: #DD0000">'welcome'</span><span style="color: #007700">, </span><span style="color: #DD0000">'localhost/XE'</span><span style="color: #007700">);<br />if (!</span><span style="color: #0000BB">$conn</span><span style="color: #007700">) {<br />    </span><span style="color: #0000BB">$m </span><span style="color: #007700">= </span><span style="color: #0000BB">oci_error</span><span style="color: #007700">();<br />    </span><span style="color: #0000BB">trigger_error</span><span style="color: #007700">(</span><span style="color: #0000BB">htmlentities</span><span style="color: #007700">(</span><span style="color: #0000BB">$m</span><span style="color: #007700">[</span><span style="color: #DD0000">'message'</span><span style="color: #007700">]), </span><span style="color: #0000BB">E_USER_ERROR</span><span style="color: #007700">);<br />}<br /><br /></span><span style="color: #0000BB">$sql </span><span style="color: #007700">= </span><span style="color: #DD0000">'SELECT last_name FROM employees WHERE employee_id in (:e1, :e2, :e3)'</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">$stid </span><span style="color: #007700">= </span><span style="color: #0000BB">oci_parse</span><span style="color: #007700">(</span><span style="color: #0000BB">$conn</span><span style="color: #007700">, </span><span style="color: #0000BB">$sql</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">$mye1 </span><span style="color: #007700">= </span><span style="color: #0000BB">103</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">$mye2 </span><span style="color: #007700">= </span><span style="color: #0000BB">104</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">$mye3 </span><span style="color: #007700">= </span><span style="color: #0000BB">NULL</span><span style="color: #007700">; </span><span style="color: #FF8000">// pretend we were not given this value<br /></span><span style="color: #0000BB">oci_bind_by_name</span><span style="color: #007700">(</span><span style="color: #0000BB">$stid</span><span style="color: #007700">, </span><span style="color: #DD0000">':e1'</span><span style="color: #007700">, </span><span style="color: #0000BB">$mye1</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">oci_bind_by_name</span><span style="color: #007700">(</span><span style="color: #0000BB">$stid</span><span style="color: #007700">, </span><span style="color: #DD0000">':e2'</span><span style="color: #007700">, </span><span style="color: #0000BB">$mye2</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">oci_bind_by_name</span><span style="color: #007700">(</span><span style="color: #0000BB">$stid</span><span style="color: #007700">, </span><span style="color: #DD0000">':e3'</span><span style="color: #007700">, </span><span style="color: #0000BB">$mye3</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">oci_execute</span><span style="color: #007700">(</span><span style="color: #0000BB">$stid</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">oci_fetch_all</span><span style="color: #007700">(</span><span style="color: #0000BB">$stid</span><span style="color: #007700">, </span><span style="color: #0000BB">$res</span><span style="color: #007700">);<br />foreach (</span><span style="color: #0000BB">$res</span><span style="color: #007700">[</span><span style="color: #DD0000">'LAST_NAME'</span><span style="color: #007700">] as </span><span style="color: #0000BB">$name</span><span style="color: #007700">) {<br />    print </span><span style="color: #0000BB">$name </span><span style="color: #007700">.</span><span style="color: #DD0000">"&lt;br&gt;\n"</span><span style="color: #007700">;<br />}<br /><br /></span><span style="color: #FF8000">// Output is<br />//   Ernst<br />//   Hunold<br /><br /></span><span style="color: #0000BB">oci_free_statement</span><span style="color: #007700">(</span><span style="color: #0000BB">$stid</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">oci_close</span><span style="color: #007700">(</span><span style="color: #0000BB">$conn</span><span style="color: #007700">);<br /><br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
    </div>

   </div>
  </p>

  <p class="para">
   <div class="example" id="example-3638">
    <p><strong>Example #8 Binding a ROWID returned by a query</strong></p>
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br /><br /></span><span style="color: #FF8000">// Create the table with:<br />//   CREATE TABLE mytab (id NUMBER, salary NUMBER, name VARCHAR2(40));<br />//   INSERT INTO mytab (id, salary, name) VALUES (1, 100, 'Chris');<br />//   COMMIT;<br /><br /></span><span style="color: #0000BB">$conn </span><span style="color: #007700">= </span><span style="color: #0000BB">oci_connect</span><span style="color: #007700">(</span><span style="color: #DD0000">'hr'</span><span style="color: #007700">, </span><span style="color: #DD0000">'welcome'</span><span style="color: #007700">, </span><span style="color: #DD0000">'localhost/XE'</span><span style="color: #007700">);<br />if (!</span><span style="color: #0000BB">$conn</span><span style="color: #007700">) {<br />    </span><span style="color: #0000BB">$m </span><span style="color: #007700">= </span><span style="color: #0000BB">oci_error</span><span style="color: #007700">();<br />    </span><span style="color: #0000BB">trigger_error</span><span style="color: #007700">(</span><span style="color: #0000BB">htmlentities</span><span style="color: #007700">(</span><span style="color: #0000BB">$m</span><span style="color: #007700">[</span><span style="color: #DD0000">'message'</span><span style="color: #007700">]), </span><span style="color: #0000BB">E_USER_ERROR</span><span style="color: #007700">);<br />}<br /><br /></span><span style="color: #0000BB">$stid </span><span style="color: #007700">= </span><span style="color: #0000BB">oci_parse</span><span style="color: #007700">(</span><span style="color: #0000BB">$conn</span><span style="color: #007700">, </span><span style="color: #DD0000">'SELECT ROWID, name FROM mytab WHERE id = :id_bv FOR UPDATE'</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">$id </span><span style="color: #007700">= </span><span style="color: #0000BB">1</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">oci_bind_by_name</span><span style="color: #007700">(</span><span style="color: #0000BB">$stid</span><span style="color: #007700">, </span><span style="color: #DD0000">':id_bv'</span><span style="color: #007700">, </span><span style="color: #0000BB">$id</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">oci_execute</span><span style="color: #007700">(</span><span style="color: #0000BB">$stid</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">$row </span><span style="color: #007700">= </span><span style="color: #0000BB">oci_fetch_array</span><span style="color: #007700">(</span><span style="color: #0000BB">$stid</span><span style="color: #007700">, </span><span style="color: #0000BB">OCI_ASSOC</span><span style="color: #007700">+</span><span style="color: #0000BB">OCI_RETURN_NULLS</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">$rid </span><span style="color: #007700">= </span><span style="color: #0000BB">$row</span><span style="color: #007700">[</span><span style="color: #DD0000">'ROWID'</span><span style="color: #007700">];<br /></span><span style="color: #0000BB">$name </span><span style="color: #007700">= </span><span style="color: #0000BB">$row</span><span style="color: #007700">[</span><span style="color: #DD0000">'NAME'</span><span style="color: #007700">];<br /><br /></span><span style="color: #FF8000">// Change name to upper case &amp; save the changes<br /></span><span style="color: #0000BB">$name </span><span style="color: #007700">= </span><span style="color: #0000BB">strtoupper</span><span style="color: #007700">(</span><span style="color: #0000BB">$name</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">$stid </span><span style="color: #007700">= </span><span style="color: #0000BB">oci_parse</span><span style="color: #007700">(</span><span style="color: #0000BB">$conn</span><span style="color: #007700">, </span><span style="color: #DD0000">'UPDATE mytab SET name = :n_bv WHERE ROWID = :r_bv'</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">oci_bind_by_name</span><span style="color: #007700">(</span><span style="color: #0000BB">$stid</span><span style="color: #007700">, </span><span style="color: #DD0000">':n_bv'</span><span style="color: #007700">, </span><span style="color: #0000BB">$name</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">oci_bind_by_name</span><span style="color: #007700">(</span><span style="color: #0000BB">$stid</span><span style="color: #007700">, </span><span style="color: #DD0000">':r_bv'</span><span style="color: #007700">, </span><span style="color: #0000BB">$rid</span><span style="color: #007700">, -</span><span style="color: #0000BB">1</span><span style="color: #007700">, </span><span style="color: #0000BB">OCI_B_ROWID</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">oci_execute</span><span style="color: #007700">(</span><span style="color: #0000BB">$stid</span><span style="color: #007700">);<br /><br /></span><span style="color: #FF8000">// The table now contains 1, 100, CHRIS<br /><br /></span><span style="color: #0000BB">oci_free_statement</span><span style="color: #007700">(</span><span style="color: #0000BB">$stid</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">oci_close</span><span style="color: #007700">(</span><span style="color: #0000BB">$conn</span><span style="color: #007700">);<br /><br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
    </div>

   </div>
  </p>

  <p class="para">
   <div class="example" id="example-3640">
    <p><strong>Example #9 INSERT 时绑定 ROWID</strong></p>
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br /><br /></span><span style="color: #FF8000">// This example inserts an id &amp; name, and then updates the salary<br />// Create the table with:<br />//   CREATE TABLE mytab (id NUMBER, salary NUMBER, name VARCHAR2(40));<br />//<br />// Based on original ROWID example by thies at thieso dot net (980221)<br /><br /></span><span style="color: #0000BB">$conn </span><span style="color: #007700">= </span><span style="color: #0000BB">oci_connect</span><span style="color: #007700">(</span><span style="color: #DD0000">'hr'</span><span style="color: #007700">, </span><span style="color: #DD0000">'welcome'</span><span style="color: #007700">, </span><span style="color: #DD0000">'localhost/XE'</span><span style="color: #007700">);<br />if (!</span><span style="color: #0000BB">$conn</span><span style="color: #007700">) {<br />    </span><span style="color: #0000BB">$m </span><span style="color: #007700">= </span><span style="color: #0000BB">oci_error</span><span style="color: #007700">();<br />    </span><span style="color: #0000BB">trigger_error</span><span style="color: #007700">(</span><span style="color: #0000BB">htmlentities</span><span style="color: #007700">(</span><span style="color: #0000BB">$m</span><span style="color: #007700">[</span><span style="color: #DD0000">'message'</span><span style="color: #007700">]), </span><span style="color: #0000BB">E_USER_ERROR</span><span style="color: #007700">);<br />}<br /><br /></span><span style="color: #0000BB">$sql </span><span style="color: #007700">= </span><span style="color: #DD0000">"INSERT INTO mytab (id, name) VALUES(:id_bv, :name_bv)<br />        RETURNING ROWID INTO :rid"</span><span style="color: #007700">;<br /><br /></span><span style="color: #0000BB">$ins_stid </span><span style="color: #007700">= </span><span style="color: #0000BB">oci_parse</span><span style="color: #007700">(</span><span style="color: #0000BB">$conn</span><span style="color: #007700">, </span><span style="color: #0000BB">$sql</span><span style="color: #007700">);<br /><br /></span><span style="color: #0000BB">$rowid </span><span style="color: #007700">= </span><span style="color: #0000BB">oci_new_descriptor</span><span style="color: #007700">(</span><span style="color: #0000BB">$conn</span><span style="color: #007700">, </span><span style="color: #0000BB">OCI_D_ROWID</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">oci_bind_by_name</span><span style="color: #007700">(</span><span style="color: #0000BB">$ins_stid</span><span style="color: #007700">, </span><span style="color: #DD0000">":id_bv"</span><span style="color: #007700">,   </span><span style="color: #0000BB">$id</span><span style="color: #007700">,    </span><span style="color: #0000BB">10</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">oci_bind_by_name</span><span style="color: #007700">(</span><span style="color: #0000BB">$ins_stid</span><span style="color: #007700">, </span><span style="color: #DD0000">":name_bv"</span><span style="color: #007700">, </span><span style="color: #0000BB">$name</span><span style="color: #007700">,  </span><span style="color: #0000BB">32</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">oci_bind_by_name</span><span style="color: #007700">(</span><span style="color: #0000BB">$ins_stid</span><span style="color: #007700">, </span><span style="color: #DD0000">":rid"</span><span style="color: #007700">,     </span><span style="color: #0000BB">$rowid</span><span style="color: #007700">, -</span><span style="color: #0000BB">1</span><span style="color: #007700">, </span><span style="color: #0000BB">OCI_B_ROWID</span><span style="color: #007700">);<br /><br /></span><span style="color: #0000BB">$sql </span><span style="color: #007700">= </span><span style="color: #DD0000">"UPDATE mytab SET salary = :salary WHERE ROWID = :rid"</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">$upd_stid </span><span style="color: #007700">= </span><span style="color: #0000BB">oci_parse</span><span style="color: #007700">(</span><span style="color: #0000BB">$conn</span><span style="color: #007700">, </span><span style="color: #0000BB">$sql</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">oci_bind_by_name</span><span style="color: #007700">(</span><span style="color: #0000BB">$upd_stid</span><span style="color: #007700">, </span><span style="color: #DD0000">":rid"</span><span style="color: #007700">, </span><span style="color: #0000BB">$rowid</span><span style="color: #007700">, -</span><span style="color: #0000BB">1</span><span style="color: #007700">, </span><span style="color: #0000BB">OCI_B_ROWID</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">oci_bind_by_name</span><span style="color: #007700">(</span><span style="color: #0000BB">$upd_stid</span><span style="color: #007700">, </span><span style="color: #DD0000">":salary"</span><span style="color: #007700">, </span><span style="color: #0000BB">$salary</span><span style="color: #007700">,   </span><span style="color: #0000BB">32</span><span style="color: #007700">);<br /><br /></span><span style="color: #FF8000">// ids and names to insert<br /></span><span style="color: #0000BB">$data </span><span style="color: #007700">= array(</span><span style="color: #0000BB">1111 </span><span style="color: #007700">=&gt; </span><span style="color: #DD0000">"Larry"</span><span style="color: #007700">,<br />              </span><span style="color: #0000BB">2222 </span><span style="color: #007700">=&gt; </span><span style="color: #DD0000">"Bill"</span><span style="color: #007700">,<br />              </span><span style="color: #0000BB">3333 </span><span style="color: #007700">=&gt; </span><span style="color: #DD0000">"Jim"</span><span style="color: #007700">);<br /><br /></span><span style="color: #FF8000">// Salary of each person<br /></span><span style="color: #0000BB">$salary </span><span style="color: #007700">= </span><span style="color: #0000BB">10000</span><span style="color: #007700">;<br /><br /></span><span style="color: #FF8000">// Insert and immediately update each row<br /></span><span style="color: #007700">foreach (</span><span style="color: #0000BB">$data </span><span style="color: #007700">as </span><span style="color: #0000BB">$id </span><span style="color: #007700">=&gt; </span><span style="color: #0000BB">$name</span><span style="color: #007700">) {<br />    </span><span style="color: #0000BB">oci_execute</span><span style="color: #007700">(</span><span style="color: #0000BB">$ins_stid</span><span style="color: #007700">);<br />    </span><span style="color: #0000BB">oci_execute</span><span style="color: #007700">(</span><span style="color: #0000BB">$upd_stid</span><span style="color: #007700">);<br />}<br /><br /></span><span style="color: #0000BB">$rowid</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">free</span><span style="color: #007700">();<br /></span><span style="color: #0000BB">oci_free_statement</span><span style="color: #007700">(</span><span style="color: #0000BB">$upd_stid</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">oci_free_statement</span><span style="color: #007700">(</span><span style="color: #0000BB">$ins_stid</span><span style="color: #007700">);<br /><br /></span><span style="color: #FF8000">// Show the new rows<br /></span><span style="color: #0000BB">$stid </span><span style="color: #007700">= </span><span style="color: #0000BB">oci_parse</span><span style="color: #007700">(</span><span style="color: #0000BB">$conn</span><span style="color: #007700">, </span><span style="color: #DD0000">"SELECT * FROM mytab"</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">oci_execute</span><span style="color: #007700">(</span><span style="color: #0000BB">$stid</span><span style="color: #007700">);<br />while (</span><span style="color: #0000BB">$row </span><span style="color: #007700">= </span><span style="color: #0000BB">oci_fetch_array</span><span style="color: #007700">(</span><span style="color: #0000BB">$stid</span><span style="color: #007700">, </span><span style="color: #0000BB">OCI_ASSOC</span><span style="color: #007700">+</span><span style="color: #0000BB">OCI_RETURN_NULLS</span><span style="color: #007700">)) {<br />    </span><span style="color: #0000BB">var_dump</span><span style="color: #007700">(</span><span style="color: #0000BB">$row</span><span style="color: #007700">);<br />}<br /><br /></span><span style="color: #0000BB">oci_free_statement</span><span style="color: #007700">(</span><span style="color: #0000BB">$stid</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">oci_close</span><span style="color: #007700">(</span><span style="color: #0000BB">$conn</span><span style="color: #007700">);<br /><br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
    </div>

   </div>
  </p>

  <p class="para">
   <div class="example" id="example-3642">
    <p><strong>Example #10 为 PL/SQL 存储函数绑定</strong></p>
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br /><br /></span><span style="color: #FF8000">//  Before running the PHP program, create a stored function in<br />//  SQL*Plus or SQL Developer:<br />//<br />//  CREATE OR REPLACE FUNCTION myfunc(p IN NUMBER) RETURN NUMBER AS<br />//  BEGIN<br />//      RETURN p * 3;<br />//  END;<br /><br /></span><span style="color: #0000BB">$conn </span><span style="color: #007700">= </span><span style="color: #0000BB">oci_connect</span><span style="color: #007700">(</span><span style="color: #DD0000">'hr'</span><span style="color: #007700">, </span><span style="color: #DD0000">'welcome'</span><span style="color: #007700">, </span><span style="color: #DD0000">'localhost/XE'</span><span style="color: #007700">);<br />if (!</span><span style="color: #0000BB">$conn</span><span style="color: #007700">) {<br />    </span><span style="color: #0000BB">$e </span><span style="color: #007700">= </span><span style="color: #0000BB">oci_error</span><span style="color: #007700">();<br />    </span><span style="color: #0000BB">trigger_error</span><span style="color: #007700">(</span><span style="color: #0000BB">htmlentities</span><span style="color: #007700">(</span><span style="color: #0000BB">$e</span><span style="color: #007700">[</span><span style="color: #DD0000">'message'</span><span style="color: #007700">]), </span><span style="color: #0000BB">E_USER_ERROR</span><span style="color: #007700">);<br />}<br /><br /></span><span style="color: #0000BB">$p </span><span style="color: #007700">= </span><span style="color: #0000BB">8</span><span style="color: #007700">;<br /><br /></span><span style="color: #0000BB">$stid </span><span style="color: #007700">= </span><span style="color: #0000BB">oci_parse</span><span style="color: #007700">(</span><span style="color: #0000BB">$conn</span><span style="color: #007700">, </span><span style="color: #DD0000">'begin :r := myfunc(:p); end;'</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">oci_bind_by_name</span><span style="color: #007700">(</span><span style="color: #0000BB">$stid</span><span style="color: #007700">, </span><span style="color: #DD0000">':p'</span><span style="color: #007700">, </span><span style="color: #0000BB">$p</span><span style="color: #007700">);<br /><br /></span><span style="color: #FF8000">// The return value is an OUT bind. The default type will be a string<br />// type so binding a length 40 means that at most 40 digits will be<br />// returned.<br /></span><span style="color: #0000BB">oci_bind_by_name</span><span style="color: #007700">(</span><span style="color: #0000BB">$stid</span><span style="color: #007700">, </span><span style="color: #DD0000">':r'</span><span style="color: #007700">, </span><span style="color: #0000BB">$r</span><span style="color: #007700">, </span><span style="color: #0000BB">40</span><span style="color: #007700">);<br /><br /></span><span style="color: #0000BB">oci_execute</span><span style="color: #007700">(</span><span style="color: #0000BB">$stid</span><span style="color: #007700">);<br /><br />print </span><span style="color: #DD0000">"</span><span style="color: #0000BB">$r</span><span style="color: #DD0000">\n"</span><span style="color: #007700">;   </span><span style="color: #FF8000">// prints 24<br /><br /></span><span style="color: #0000BB">oci_free_statement</span><span style="color: #007700">(</span><span style="color: #0000BB">$stid</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">oci_close</span><span style="color: #007700">(</span><span style="color: #0000BB">$conn</span><span style="color: #007700">);<br /><br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
    </div>

   </div>
  </p>

  <p class="para">
  <div class="example" id="example-3644">
   <p><strong>Example #11 为 PL/SQL 存储过程绑定参数</strong></p>
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br /><br /></span><span style="color: #FF8000">//  Before running the PHP program, create a stored procedure in<br />//  SQL*Plus or SQL Developer:<br />//<br />//  CREATE OR REPLACE PROCEDURE myproc(p1 IN NUMBER, p2 OUT NUMBER) AS<br />//  BEGIN<br />//      p2 := p1 * 2;<br />//  END;<br /><br /></span><span style="color: #0000BB">$conn </span><span style="color: #007700">= </span><span style="color: #0000BB">oci_connect</span><span style="color: #007700">(</span><span style="color: #DD0000">'hr'</span><span style="color: #007700">, </span><span style="color: #DD0000">'welcome'</span><span style="color: #007700">, </span><span style="color: #DD0000">'localhost/XE'</span><span style="color: #007700">);<br />if (!</span><span style="color: #0000BB">$conn</span><span style="color: #007700">) {<br />    </span><span style="color: #0000BB">$e </span><span style="color: #007700">= </span><span style="color: #0000BB">oci_error</span><span style="color: #007700">();<br />    </span><span style="color: #0000BB">trigger_error</span><span style="color: #007700">(</span><span style="color: #0000BB">htmlentities</span><span style="color: #007700">(</span><span style="color: #0000BB">$e</span><span style="color: #007700">[</span><span style="color: #DD0000">'message'</span><span style="color: #007700">]), </span><span style="color: #0000BB">E_USER_ERROR</span><span style="color: #007700">);<br />}<br /><br /></span><span style="color: #0000BB">$p1 </span><span style="color: #007700">= </span><span style="color: #0000BB">8</span><span style="color: #007700">;<br /><br /></span><span style="color: #0000BB">$stid </span><span style="color: #007700">= </span><span style="color: #0000BB">oci_parse</span><span style="color: #007700">(</span><span style="color: #0000BB">$conn</span><span style="color: #007700">, </span><span style="color: #DD0000">'begin myproc(:p1, :p2); end;'</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">oci_bind_by_name</span><span style="color: #007700">(</span><span style="color: #0000BB">$stid</span><span style="color: #007700">, </span><span style="color: #DD0000">':p1'</span><span style="color: #007700">, </span><span style="color: #0000BB">$p1</span><span style="color: #007700">);<br /><br /></span><span style="color: #FF8000">// The second procedure parameter is an OUT bind. The default type<br />// will be a string type so binding a length 40 means that at most 40<br />// digits will be returned.<br /></span><span style="color: #0000BB">oci_bind_by_name</span><span style="color: #007700">(</span><span style="color: #0000BB">$stid</span><span style="color: #007700">, </span><span style="color: #DD0000">':p2'</span><span style="color: #007700">, </span><span style="color: #0000BB">$p2</span><span style="color: #007700">, </span><span style="color: #0000BB">40</span><span style="color: #007700">);<br /><br /></span><span style="color: #0000BB">oci_execute</span><span style="color: #007700">(</span><span style="color: #0000BB">$stid</span><span style="color: #007700">);<br /><br />print </span><span style="color: #DD0000">"</span><span style="color: #0000BB">$p2</span><span style="color: #DD0000">\n"</span><span style="color: #007700">;   </span><span style="color: #FF8000">// prints 16<br /><br /></span><span style="color: #0000BB">oci_free_statement</span><span style="color: #007700">(</span><span style="color: #0000BB">$stid</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">oci_close</span><span style="color: #007700">(</span><span style="color: #0000BB">$conn</span><span style="color: #007700">);<br /><br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
    </div>

   </div>
  </p>

  <p class="para">
  <div class="example" id="example-3646">
   <p><strong>Example #12 绑定 CLOB 列</strong></p>
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br /><br /></span><span style="color: #FF8000">// Before running, create the table:<br />//     CREATE TABLE mytab (mykey NUMBER, myclob CLOB);<br /><br /></span><span style="color: #0000BB">$conn </span><span style="color: #007700">= </span><span style="color: #0000BB">oci_connect</span><span style="color: #007700">(</span><span style="color: #DD0000">'hr'</span><span style="color: #007700">, </span><span style="color: #DD0000">'welcome'</span><span style="color: #007700">, </span><span style="color: #DD0000">'localhost/XE'</span><span style="color: #007700">);<br />if (!</span><span style="color: #0000BB">$conn</span><span style="color: #007700">) {<br />    </span><span style="color: #0000BB">$e </span><span style="color: #007700">= </span><span style="color: #0000BB">oci_error</span><span style="color: #007700">();<br />    </span><span style="color: #0000BB">trigger_error</span><span style="color: #007700">(</span><span style="color: #0000BB">htmlentities</span><span style="color: #007700">(</span><span style="color: #0000BB">$e</span><span style="color: #007700">[</span><span style="color: #DD0000">'message'</span><span style="color: #007700">]), </span><span style="color: #0000BB">E_USER_ERROR</span><span style="color: #007700">);<br />}<br /><br /></span><span style="color: #0000BB">$mykey </span><span style="color: #007700">= </span><span style="color: #0000BB">12343</span><span style="color: #007700">;  </span><span style="color: #FF8000">// arbitrary key for this example;<br /><br /></span><span style="color: #0000BB">$sql </span><span style="color: #007700">= </span><span style="color: #DD0000">"INSERT INTO mytab (mykey, myclob)<br />        VALUES (:mykey, EMPTY_CLOB())<br />        RETURNING myclob INTO :myclob"</span><span style="color: #007700">;<br /><br /></span><span style="color: #0000BB">$stid </span><span style="color: #007700">= </span><span style="color: #0000BB">oci_parse</span><span style="color: #007700">(</span><span style="color: #0000BB">$conn</span><span style="color: #007700">, </span><span style="color: #0000BB">$sql</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">$clob </span><span style="color: #007700">= </span><span style="color: #0000BB">oci_new_descriptor</span><span style="color: #007700">(</span><span style="color: #0000BB">$conn</span><span style="color: #007700">, </span><span style="color: #0000BB">OCI_D_LOB</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">oci_bind_by_name</span><span style="color: #007700">(</span><span style="color: #0000BB">$stid</span><span style="color: #007700">, </span><span style="color: #DD0000">":mykey"</span><span style="color: #007700">, </span><span style="color: #0000BB">$mykey</span><span style="color: #007700">, </span><span style="color: #0000BB">5</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">oci_bind_by_name</span><span style="color: #007700">(</span><span style="color: #0000BB">$stid</span><span style="color: #007700">, </span><span style="color: #DD0000">":myclob"</span><span style="color: #007700">, </span><span style="color: #0000BB">$clob</span><span style="color: #007700">, -</span><span style="color: #0000BB">1</span><span style="color: #007700">, </span><span style="color: #0000BB">OCI_B_CLOB</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">oci_execute</span><span style="color: #007700">(</span><span style="color: #0000BB">$stid</span><span style="color: #007700">, </span><span style="color: #0000BB">OCI_DEFAULT</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">$clob</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">save</span><span style="color: #007700">(</span><span style="color: #DD0000">"A very long string"</span><span style="color: #007700">);<br /><br /></span><span style="color: #0000BB">oci_commit</span><span style="color: #007700">(</span><span style="color: #0000BB">$conn</span><span style="color: #007700">);<br /><br /></span><span style="color: #FF8000">// Fetching CLOB data<br /><br /></span><span style="color: #0000BB">$query </span><span style="color: #007700">= </span><span style="color: #DD0000">'SELECT myclob FROM mytab WHERE mykey = :mykey'</span><span style="color: #007700">;<br /><br /></span><span style="color: #0000BB">$stid </span><span style="color: #007700">= </span><span style="color: #0000BB">oci_parse </span><span style="color: #007700">(</span><span style="color: #0000BB">$conn</span><span style="color: #007700">, </span><span style="color: #0000BB">$query</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">oci_bind_by_name</span><span style="color: #007700">(</span><span style="color: #0000BB">$stid</span><span style="color: #007700">, </span><span style="color: #DD0000">":mykey"</span><span style="color: #007700">, </span><span style="color: #0000BB">$mykey</span><span style="color: #007700">, </span><span style="color: #0000BB">5</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">oci_execute</span><span style="color: #007700">(</span><span style="color: #0000BB">$stid</span><span style="color: #007700">);<br /><br />print </span><span style="color: #DD0000">'&lt;table border="1"&gt;'</span><span style="color: #007700">;<br />while (</span><span style="color: #0000BB">$row </span><span style="color: #007700">= </span><span style="color: #0000BB">oci_fetch_array</span><span style="color: #007700">(</span><span style="color: #0000BB">$stid</span><span style="color: #007700">, </span><span style="color: #0000BB">OCI_ASSOC</span><span style="color: #007700">+</span><span style="color: #0000BB">OCI_RETURN_LOBS</span><span style="color: #007700">)) {<br />    print </span><span style="color: #DD0000">'&lt;tr&gt;&lt;td&gt;'</span><span style="color: #007700">.</span><span style="color: #0000BB">$row</span><span style="color: #007700">[</span><span style="color: #DD0000">'MYCLOB'</span><span style="color: #007700">].</span><span style="color: #DD0000">'&lt;/td&gt;&lt;/tr&gt;'</span><span style="color: #007700">;<br />    </span><span style="color: #FF8000">// In a loop, freeing the large variable before the 2nd fetch reduces PHP's peak memory usage<br />    </span><span style="color: #007700">unset(</span><span style="color: #0000BB">$row</span><span style="color: #007700">);  <br />}<br />print </span><span style="color: #DD0000">'&lt;/table&gt;'</span><span style="color: #007700">;<br /><br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
   </div>

  </div>
  </p>

  <p class="para">
  <div class="example" id="example-3648">
   <p><strong>Example #13 绑定 PL/SQL BOOLEAN</strong></p>
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br /><br />$conn </span><span style="color: #007700">= </span><span style="color: #0000BB">oci_connect</span><span style="color: #007700">(</span><span style="color: #DD0000">'hr'</span><span style="color: #007700">, </span><span style="color: #DD0000">'welcome'</span><span style="color: #007700">, </span><span style="color: #DD0000">'localhost/XE'</span><span style="color: #007700">);<br />if (!</span><span style="color: #0000BB">$conn</span><span style="color: #007700">) {<br />    </span><span style="color: #0000BB">$e </span><span style="color: #007700">= </span><span style="color: #0000BB">oci_error</span><span style="color: #007700">();<br />    </span><span style="color: #0000BB">trigger_error</span><span style="color: #007700">(</span><span style="color: #0000BB">htmlentities</span><span style="color: #007700">(</span><span style="color: #0000BB">$e</span><span style="color: #007700">[</span><span style="color: #DD0000">'message'</span><span style="color: #007700">]), </span><span style="color: #0000BB">E_USER_ERROR</span><span style="color: #007700">);<br />}<br /><br /></span><span style="color: #0000BB">$plsql </span><span style="color: #007700">= <br />  </span><span style="color: #DD0000">"begin<br />    :output1 := true;<br />    :output2 := false;<br />   end;"</span><span style="color: #007700">;<br /><br /></span><span style="color: #0000BB">$s </span><span style="color: #007700">= </span><span style="color: #0000BB">oci_parse</span><span style="color: #007700">(</span><span style="color: #0000BB">$c</span><span style="color: #007700">, </span><span style="color: #0000BB">$plsql</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">oci_bind_by_name</span><span style="color: #007700">(</span><span style="color: #0000BB">$s</span><span style="color: #007700">, </span><span style="color: #DD0000">':output1'</span><span style="color: #007700">, </span><span style="color: #0000BB">$output1</span><span style="color: #007700">, -</span><span style="color: #0000BB">1</span><span style="color: #007700">, </span><span style="color: #0000BB">OCI_B_BOL</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">oci_bind_by_name</span><span style="color: #007700">(</span><span style="color: #0000BB">$s</span><span style="color: #007700">, </span><span style="color: #DD0000">':output2'</span><span style="color: #007700">, </span><span style="color: #0000BB">$output2</span><span style="color: #007700">, -</span><span style="color: #0000BB">1</span><span style="color: #007700">, </span><span style="color: #0000BB">OCI_B_BOL</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">oci_execute</span><span style="color: #007700">(</span><span style="color: #0000BB">$s</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">var_dump</span><span style="color: #007700">(</span><span style="color: #0000BB">$output1</span><span style="color: #007700">);  </span><span style="color: #FF8000">// true<br /></span><span style="color: #0000BB">var_dump</span><span style="color: #007700">(</span><span style="color: #0000BB">$output2</span><span style="color: #007700">);  </span><span style="color: #FF8000">// false<br /><br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
   </div>

  </div>
  </p>

 </div>


 <div class="refsect1 notes" id="refsect1-function.oci-bind-by-name-notes">
  <h3 class="title">注释</h3>
  <div class="warning"><strong class="warning">Warning</strong>
   <p class="para">
    不要同时使用 <span class="function"><a href="function.addslashes.html" class="function">addslashes()</a></span> 和 <span class="function"><strong>oci_bind_by_name()</strong></span>，因为不需要引号。任何应用的引号都将写入数据库，因为
    <span class="function"><strong>oci_bind_by_name()</strong></span> 逐字插入数据并且不会删除引号或转义字符。
   </p>
  </div>
  <blockquote class="note"><p><strong class="note">Note</strong>: 
   <p class="para">
    如果将字符串绑定到 <code class="literal">WHERE</code> 子句中的 <code class="literal">CHAR</code> 列，请记住 Oracle 对 <code class="literal">CHAR</code>
    列使用空白填充的比较语义。PHP 变量使用空格填充到与成功的 <code class="literal">WHERE</code> 子句的列相同的宽度。
   </p>
  </p></blockquote>
  <blockquote class="note"><p><strong class="note">Note</strong>: 
   <p class="para">
     PHP <code class="parameter">var</code> 参数是引用。某些形式的循环无法按预期工作：
   </p>
   <div class="informalexample">
     <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br /></span><span style="color: #007700">foreach (</span><span style="color: #0000BB">$myarray </span><span style="color: #007700">as </span><span style="color: #0000BB">$key </span><span style="color: #007700">=&gt; </span><span style="color: #0000BB">$value</span><span style="color: #007700">)  {<br />    </span><span style="color: #0000BB">oci_bind_by_name</span><span style="color: #007700">(</span><span style="color: #0000BB">$stid</span><span style="color: #007700">, </span><span style="color: #0000BB">$key</span><span style="color: #007700">, </span><span style="color: #0000BB">$value</span><span style="color: #007700">);<br />}<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
     </div>

   </div>
   <p class="para">
    这会将每个键绑定到 $value 的位置，因此所有绑定变量最终都指向最后一个循环迭代的值。应该使用以下内容：
   </p>
   <div class="informalexample">
     <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br /></span><span style="color: #007700">foreach (</span><span style="color: #0000BB">$myarray </span><span style="color: #007700">as </span><span style="color: #0000BB">$key </span><span style="color: #007700">=&gt; </span><span style="color: #0000BB">$value</span><span style="color: #007700">) {<br />    </span><span style="color: #0000BB">oci_bind_by_name</span><span style="color: #007700">(</span><span style="color: #0000BB">$stid</span><span style="color: #007700">, </span><span style="color: #0000BB">$key</span><span style="color: #007700">, </span><span style="color: #0000BB">$myarray</span><span style="color: #007700">[</span><span style="color: #0000BB">$key</span><span style="color: #007700">]);<br />}<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
     </div>

   </div>
  </p></blockquote>
 </div>


 <div class="refsect1 seealso" id="refsect1-function.oci-bind-by-name-seealso">
  <h3 class="title">参见</h3>
  <p class="para">
   <ul class="simplelist">
    <li class="member"><span class="function"><a href="function.oci-bind-array-by-name.html" class="function" rel="rdfs-seeAlso">oci_bind_array_by_name()</a> - Binds a PHP array to an Oracle PL/SQL array parameter</span></li>
    <li class="member"><span class="function"><a href="function.oci-parse.html" class="function" rel="rdfs-seeAlso">oci_parse()</a> - 预处理用于执行的 Oracle 语句</span></li>
   </ul>
  </p>
 </div>


</div><div id="usernotes">
 <div class="head">
  <h3 class="title">User Contributed Notes</h3>
 </div>
<div id="allnotes">  <a name="126261""></a>
  <div class="note">
   <strong class="user">charles dot fisher at arconic dot com</strong>
   <a href="#126261" class="date">21-Jul-2021 06:45</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I am trying to rework ADOdb library calls to OCI, and I wrote this function today which is helping.<br />
<br />
function OraQry(&amp;$Results, $Query, $Binds = false) {<br />
&nbsp; global $xdb;<br />
<br />
&nbsp; $Results = oci_parse($xdb, $Query);<br />
<br />
&nbsp; if($Binds) foreach($Binds as $BindNm =&gt; $BindValJunk)<br />
&nbsp;&nbsp;&nbsp; oci_bind_by_name($Results, $BindNm, $Binds[$BindNm], -1);<br />
<br />
&nbsp; oci_execute($Results, OCI_NO_AUTO_COMMIT);<br />
<br />
&nbsp; return null;<br />
}<br />
<br />
This also has similarity to PDO in passing an array of bind variables, with the added benefit that if they are named numerically (starting at zero), then the call to the array() function can be omitted:<br />
<br />
OraQry($rs,<br />
&nbsp; 'select status from all_tables where owner=:0 and table_name=:1',<br />
&nbsp;&nbsp;&nbsp; [$owner, $table_name]);<br />
<br />
while($arr = oci_fetch_assoc($rs)) echo $arr['STATUS'] . "\n";</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="124325""></a>
  <div class="note">
   <strong class="user">asui dot dev dot null at gmail dot com</strong>
   <a href="#124325" class="date">22-Oct-2019 11:20</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you are getting "ORA-01722: invalid number error" while inserting/updating a FLOAT value into a NUMBER column, please check the correctness of a binded value format according to the current locale settings. <br />
<br />
Default "american" locale assumes that value send to oracle will be a dot decimal separator (just like 4127.5). But with setlocale('pl_PL.UTF-8') your float number would be represented as 4127,5 and that form will be used while sending data do oracle causing a problem...<br />
That was my case (8 hours of debugging).<br />
<br />
You can check your current locale with setlocale(LC_ALL, 0).<br />
<br />
What I can recommend as a solutions:<br />
a) do not set locale, or set it to 'C' for a time of sending data;<br />
b) convert float to a string format compatible with current oracle session NLS_NUMERIC_CHARACTERS parameter value. <br />
For example: when NLS_NUMERIC_CHARACTERS = '.,' float value 4127.5 should be converted to '4127.5'.&nbsp; Then oracle will catch it correctly even if current locale are set differently.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="121776""></a>
  <div class="note">
   <strong class="user">splintyg at gmail dot com</strong>
   <a href="#121776" class="date">19-Oct-2017 10:28</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Guys, i've been looking for long time, how to pass clob to and get from procedure<br />
CREATE OR REPLACE PROCEDURE myproc(p1 IN clob, p2 OUT clob);<br />
<br />
Here You are an answer:<br />
<br />
<span class="default">&lt;?php<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $conn </span><span class="keyword">= </span><span class="default">oci_connect</span><span class="keyword">(</span><span class="string">"TEST"</span><span class="keyword">, </span><span class="string">"html"</span><span class="keyword">, </span><span class="string">"//hostname"</span><span class="keyword">, </span><span class="string">"UTF8"</span><span class="keyword">);<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$filename </span><span class="keyword">= </span><span class="string">"./clob.txt"</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$handle </span><span class="keyword">= </span><span class="default">fopen</span><span class="keyword">(</span><span class="default">$filename</span><span class="keyword">, </span><span class="string">"r"</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$f </span><span class="keyword">= </span><span class="default">fread</span><span class="keyword">(</span><span class="default">$handle</span><span class="keyword">, </span><span class="default">filesize</span><span class="keyword">(</span><span class="default">$filename</span><span class="keyword">));<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">fclose</span><span class="keyword">(</span><span class="default">$handle</span><span class="keyword">);<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$stid </span><span class="keyword">= </span><span class="default">oci_parse</span><span class="keyword">(</span><span class="default">$conn</span><span class="keyword">, </span><span class="string">"begin myproc(:p1, :p2); end;"</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$p1 </span><span class="keyword">= </span><span class="default">oci_new_descriptor</span><span class="keyword">(</span><span class="default">$conn</span><span class="keyword">, </span><span class="default">OCI_D_LOB</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$p2 </span><span class="keyword">= </span><span class="default">oci_new_descriptor</span><span class="keyword">(</span><span class="default">$conn</span><span class="keyword">, </span><span class="default">OCI_D_LOB</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="default">oci_bind_by_name</span><span class="keyword">(</span><span class="default">$stid</span><span class="keyword">, </span><span class="string">":p1"</span><span class="keyword">, </span><span class="default">$p1</span><span class="keyword">, -</span><span class="default">1</span><span class="keyword">, </span><span class="default">OCI_B_CLOB</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">oci_bind_by_name</span><span class="keyword">(</span><span class="default">$stid</span><span class="keyword">, </span><span class="string">":p2"</span><span class="keyword">, </span><span class="default">$p2</span><span class="keyword">, -</span><span class="default">1</span><span class="keyword">, </span><span class="default">OCI_B_CLOB</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$p1</span><span class="keyword">-&gt;</span><span class="default">writeTemporary</span><span class="keyword">(</span><span class="default">$f</span><span class="keyword">, </span><span class="default">OCI_TEMP_BLOB</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">oci_execute</span><span class="keyword">(</span><span class="default">$stid</span><span class="keyword">); -- </span><span class="default">Figure out OCI_NO_AUTO_COMMIT<br />
&nbsp;&nbsp;&nbsp; oci_commit</span><span class="keyword">(</span><span class="default">$conn</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; echo </span><span class="default">$p2</span><span class="keyword">-&gt;</span><span class="default">load</span><span class="keyword">(); <br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$p1&nbsp; &nbsp; </span><span class="keyword">-&gt;</span><span class="default">close</span><span class="keyword">();<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$p2&nbsp; &nbsp; </span><span class="keyword">-&gt;</span><span class="default">close</span><span class="keyword">();<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">oci_free_statement</span><span class="keyword">(</span><span class="default">$stid</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">oci_close</span><span class="keyword">(</span><span class="default">$conn</span><span class="keyword">);<br />
</span><span class="default">?&gt;<br />
</span><br />
And perfect book about "PHP and Oracle" <br />
<a href="http://www.oracle.com/technetwork/topics/php/underground-php-oracle-manual-098250.html" rel="nofollow" target="_blank">http://www.oracle.com/technetwork/topics/php/underground-php-oracle-manual-098250.html</a></span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="121775""></a>
  <div class="note">
   <strong class="user">splintyg at gmail dot com</strong>
   <a href="#121775" class="date">19-Oct-2017 10:27</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Guys, i've been looking for long time, how to pass clob to and get from procedure<br />
CREATE OR REPLACE PROCEDURE myproc(p1 IN clob, p2 OUT clob);<br />
<br />
Here You are an answer:<br />
<br />
<span class="default">&lt;?php<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $conn </span><span class="keyword">= </span><span class="default">oci_connect</span><span class="keyword">(</span><span class="string">"TEST"</span><span class="keyword">, </span><span class="string">"html"</span><span class="keyword">, </span><span class="string">"//hostname"</span><span class="keyword">, </span><span class="string">"UTF8"</span><span class="keyword">);<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$filename </span><span class="keyword">= </span><span class="string">"./clob.txt"</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$handle </span><span class="keyword">= </span><span class="default">fopen</span><span class="keyword">(</span><span class="default">$filename</span><span class="keyword">, </span><span class="string">"r"</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$f </span><span class="keyword">= </span><span class="default">fread</span><span class="keyword">(</span><span class="default">$handle</span><span class="keyword">, </span><span class="default">filesize</span><span class="keyword">(</span><span class="default">$filename</span><span class="keyword">));<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">fclose</span><span class="keyword">(</span><span class="default">$handle</span><span class="keyword">);<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$stid </span><span class="keyword">= </span><span class="default">oci_parse</span><span class="keyword">(</span><span class="default">$conn</span><span class="keyword">, </span><span class="string">"begin myproc(:p1, :p2); end;"</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$p1 </span><span class="keyword">= </span><span class="default">oci_new_descriptor</span><span class="keyword">(</span><span class="default">$conn</span><span class="keyword">, </span><span class="default">OCI_D_LOB</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$p2 </span><span class="keyword">= </span><span class="default">oci_new_descriptor</span><span class="keyword">(</span><span class="default">$conn</span><span class="keyword">, </span><span class="default">OCI_D_LOB</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="default">oci_bind_by_name</span><span class="keyword">(</span><span class="default">$stid</span><span class="keyword">, </span><span class="string">":p1"</span><span class="keyword">, </span><span class="default">$p1</span><span class="keyword">, -</span><span class="default">1</span><span class="keyword">, </span><span class="default">OCI_B_CLOB</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">oci_bind_by_name</span><span class="keyword">(</span><span class="default">$stid</span><span class="keyword">, </span><span class="string">":p2"</span><span class="keyword">, </span><span class="default">$p2</span><span class="keyword">, -</span><span class="default">1</span><span class="keyword">, </span><span class="default">OCI_B_CLOB</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$p1</span><span class="keyword">-&gt;</span><span class="default">writeTemporary</span><span class="keyword">(</span><span class="default">$f</span><span class="keyword">, </span><span class="default">OCI_TEMP_BLOB</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">oci_execute</span><span class="keyword">(</span><span class="default">$stid</span><span class="keyword">); -- </span><span class="default">Figure out OCI_NO_AUTO_COMMIT<br />
&nbsp;&nbsp;&nbsp; oci_commit</span><span class="keyword">(</span><span class="default">$conn</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; echo </span><span class="default">$p2</span><span class="keyword">-&gt;</span><span class="default">load</span><span class="keyword">(); <br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$p1&nbsp; &nbsp; </span><span class="keyword">-&gt;</span><span class="default">close</span><span class="keyword">();<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$p2&nbsp; &nbsp; </span><span class="keyword">-&gt;</span><span class="default">close</span><span class="keyword">();<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">oci_free_statement</span><span class="keyword">(</span><span class="default">$stid</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">oci_close</span><span class="keyword">(</span><span class="default">$conn</span><span class="keyword">);<br />
</span><span class="default">?&gt;<br />
</span><br />
And perfect book about "PHP and Oracle" <br />
<a href="http://www.oracle.com/technetwork/topics/php/underground-php-oracle-manual-098250.html" rel="nofollow" target="_blank">http://www.oracle.com/technetwork/topics/php/underground-php-oracle-manual-098250.html</a></span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="121422""></a>
  <div class="note">
   <strong class="user">Anonymous</strong>
   <a href="#121422" class="date">24-Jul-2017 02:25</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Bear in mind that you cannot use reserved words for bind variables. Otherwise you'll get ORA-01745: Invalid host/bind variable name error.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="119783""></a>
  <div class="note">
   <strong class="user">martin dot abbrent at ufz dot de</strong>
   <a href="#119783" class="date">24-Aug-2016 11:21</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Example #7 only shows the binding of a small fixed number of values in an IN clause. There is also a way to bind multiple conditions with a variable number of values.<br />
<br />
<span class="default">&lt;?php<br />
$ids </span><span class="keyword">= array(<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">103</span><span class="keyword">,<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">104<br />
</span><span class="keyword">);<br />
<br />
</span><span class="default">$conn&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">= </span><span class="default">oci_pconnect</span><span class="keyword">(</span><span class="default">$user</span><span class="keyword">, </span><span class="default">$pass</span><span class="keyword">, </span><span class="default">$tns</span><span class="keyword">);<br />
</span><span class="comment">// Using ORACLE table() function to get the ids from the subquery<br />
</span><span class="default">$sql&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">= </span><span class="string">'SELECT * FROM employees WHERE employee_id IN (SELECT column_value FROM table(:ids))'</span><span class="keyword">;<br />
</span><span class="default">$stmt&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">= </span><span class="default">oci_parse</span><span class="keyword">(</span><span class="default">$conn</span><span class="keyword">, </span><span class="default">$sql</span><span class="keyword">);<br />
</span><span class="comment">// Create collection of numbers. Build in type for strings is ODCIVARCHAR2LIST, but you can also create own types.<br />
</span><span class="default">$idCollection </span><span class="keyword">= </span><span class="default">oci_new_collection</span><span class="keyword">(</span><span class="default">$conn</span><span class="keyword">, </span><span class="string">'ODCINUMBERLIST'</span><span class="keyword">, </span><span class="string">'SYS'</span><span class="keyword">);<br />
<br />
</span><span class="comment">// Maximum length of collections of type ODCINUMBERLIST is 32767, maybe you should check that!<br />
</span><span class="keyword">foreach (</span><span class="default">$ids </span><span class="keyword">as </span><span class="default">$id</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$idCollection</span><span class="keyword">-&gt;</span><span class="default">append</span><span class="keyword">(</span><span class="default">$id</span><span class="keyword">);<br />
}<br />
<br />
</span><span class="default">oci_bind_by_name</span><span class="keyword">(</span><span class="default">$stmt</span><span class="keyword">, </span><span class="string">':ids'</span><span class="keyword">, </span><span class="default">$idCollection</span><span class="keyword">, -</span><span class="default">1</span><span class="keyword">, </span><span class="default">SQLT_NTY</span><span class="keyword">);<br />
</span><span class="default">oci_execute</span><span class="keyword">(</span><span class="default">$stmt</span><span class="keyword">, </span><span class="default">OCI_DEFAULT</span><span class="keyword">);<br />
</span><span class="default">oci_fetch_all</span><span class="keyword">(</span><span class="default">$stmt</span><span class="keyword">, </span><span class="default">$return</span><span class="keyword">);<br />
</span><span class="default">oci_free_statement</span><span class="keyword">(</span><span class="default">$stmt</span><span class="keyword">);<br />
<br />
</span><span class="default">oci_close</span><span class="keyword">(</span><span class="default">$conn</span><span class="keyword">);<br />
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="119073""></a>
  <div class="note">
   <strong class="user">marki at trash-mail dot com</strong>
   <a href="#119073" class="date">28-Mar-2016 09:11</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Please note that in my earlier note about having oci_bind_by_name() in a function, this becomes a little more complicated when returning values like "UPDATE table SET bla='blubb' RETURNING id INTO :id". <br />
<br />
You can do it as follows:<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">function </span><span class="default">sql</span><span class="keyword">(</span><span class="default">$q</span><span class="keyword">, &amp;</span><span class="default">$vars_in</span><span class="keyword">=array(), &amp;</span><span class="default">$vars_out</span><span class="keyword">=array()) {<br />
&nbsp; ...<br />
&nbsp; </span><span class="default">$stid </span><span class="keyword">= </span><span class="default">oci_parse</span><span class="keyword">(</span><span class="default">$conn</span><span class="keyword">, </span><span class="default">$q</span><span class="keyword">);<br />
&nbsp; ...<br />
&nbsp; </span><span class="default">reset</span><span class="keyword">(</span><span class="default">$vars_in</span><span class="keyword">);<br />
&nbsp; do {<br />
&nbsp;&nbsp;&nbsp; if (</span><span class="default">current</span><span class="keyword">(</span><span class="default">$vars_in</span><span class="keyword">)===</span><span class="default">FALSE</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp;&nbsp; break;<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$b </span><span class="keyword">= </span><span class="default">oci_bind_by_name</span><span class="keyword">(</span><span class="default">$stid</span><span class="keyword">, </span><span class="default">key</span><span class="keyword">(</span><span class="default">$vars_in</span><span class="keyword">), </span><span class="default">current</span><span class="keyword">(</span><span class="default">$vars_in</span><span class="keyword">));<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// insert exception handling here<br />
&nbsp; </span><span class="keyword">} while (</span><span class="default">each</span><span class="keyword">(</span><span class="default">$vars_in</span><span class="keyword">) !== </span><span class="default">FALSE</span><span class="keyword">);<br />
<br />
&nbsp; </span><span class="comment">// VARS TO RETURN<br />
&nbsp; // we'll fix this to integer type because for now we need this for index IDs<br />
&nbsp; </span><span class="keyword">foreach (</span><span class="default">$vars_out </span><span class="keyword">as </span><span class="default">$k </span><span class="keyword">=&gt; </span><span class="default">$v</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$b </span><span class="keyword">= </span><span class="default">oci_bind_by_name</span><span class="keyword">(</span><span class="default">$stid</span><span class="keyword">, </span><span class="default">$k</span><span class="keyword">, </span><span class="default">$vars_out</span><span class="keyword">[</span><span class="default">$k</span><span class="keyword">], -</span><span class="default">1</span><span class="keyword">, </span><span class="default">SQLT_INT</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// insert exception handling here<br />
&nbsp; </span><span class="keyword">}<br />
<br />
&nbsp; ...<br />
}<br />
</span><span class="default">?&gt;<br />
</span><br />
Use like this:<br />
<br />
<span class="default">&lt;?php<br />
$blubb </span><span class="keyword">= </span><span class="string">'blubb'</span><span class="keyword">;<br />
</span><span class="default">$b </span><span class="keyword">= array(</span><span class="string">':bla' </span><span class="keyword">=&gt; </span><span class="default">$blubb</span><span class="keyword">);<br />
</span><span class="default">$b_out </span><span class="keyword">= array(</span><span class="string">':id' </span><span class="keyword">=&gt; </span><span class="string">''</span><span class="keyword">); </span><span class="comment">// leave value empty<br />
</span><span class="default">$x </span><span class="keyword">= </span><span class="default">sql</span><span class="keyword">(</span><span class="default">$q</span><span class="keyword">, </span><span class="default">$b</span><span class="keyword">, </span><span class="default">$b_out</span><span class="keyword">);<br />
</span><span class="default">$id </span><span class="keyword">= </span><span class="default">$b_out</span><span class="keyword">[</span><span class="string">':id'</span><span class="keyword">];<br />
</span><span class="default">?&gt;<br />
</span><br />
(The point is: you would not be able to return anything into $b[':bla'] because $b[':bla'] becomes current($vars_in) inside sql() and cannot be written to.)</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="119063""></a>
  <div class="note">
   <strong class="user">marki at trash-mail dot com</strong>
   <a href="#119063" class="date">26-Mar-2016 07:53</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I had a query that was working properly at first sight, no errors on execute, nothing, but there were simply no results returned at runtime.<br />
<br />
Be careful when putting the database commands into a function and binding your variables there while using oci_fetch_xxx() outside the function.<br />
<br />
function sql($conn, $stmt, $var) {<br />
&nbsp; $stid = oci_parse($conn, $stmt);<br />
&nbsp; ...<br />
&nbsp; oci_bind_by_name($stid, ':val', $var);<br />
&nbsp; ...<br />
}<br />
sql($conn, $q, $var);<br />
$row = oci_fetch_array($stid, OCI_ASSOC+OCI_RETURN_NULLS);<br />
<br />
As you see from the definition of oci_bind_by_name(), $var needs to be passed as reference, so your function has to have this reference ready like this:<br />
<br />
function sql($conn, $stmt, &amp;$var) {<br />
&nbsp; $stid = oci_parse($conn, $stmt);<br />
&nbsp; ...<br />
&nbsp; oci_bind_by_name($stid, ':val', $var);<br />
&nbsp; ...<br />
}<br />
<br />
The background is that if you don't pass by reference (in which case $var inside the function is a copy of $var outside the function), then oci_bind_by_name() will work just fine at first glance.<br />
However, since the oci_fetch statements that you use to actually get the data will reference the $var that has ceased to exist when the function finished. In fact, since the varbind seems to be a pointer, that pointer will point to an invalid location at that point and your variables won't be substitued in the SQL.<br />
<br />
All this also means that:<br />
<br />
1) You have to pass a variable, and not just a value<br />
<br />
This doesn't work:<br />
<br />
$stid = sql($conn, $q, array('bla'=&gt;'blubb'));<br />
<br />
This is better:<br />
<br />
$vars = array('bla'=&gt;'blubb');<br />
$stid = sql($conn, $q, $vars);<br />
<br />
2) Even when passing as reference to your helper function you cannot use e.g. foreach:<br />
<br />
This doesn't work:<br />
<br />
function sql($conn, $q, $vars) {<br />
&nbsp; ...<br />
&nbsp; foreach ($vars as $k =&gt; $v) {<br />
&nbsp;&nbsp;&nbsp; oci_bind_by_name($stid, $k, $v);<br />
&nbsp; }<br />
&nbsp; ...<br />
}<br />
<br />
Again, because $k and $v are local variables that will have disappeared once you perform an oci_fetch outside the function.<br />
<br />
Instead you have to work the array in a more low-level way like this:<br />
<br />
function sql($conn, $q, &amp;$vars) {<br />
&nbsp; ...<br />
&nbsp; $stid = oci_parse($conn, $q);<br />
&nbsp; ...<br />
&nbsp; reset($vars);<br />
&nbsp; do {<br />
&nbsp;&nbsp;&nbsp; if (current($vars)===FALSE) { // end of array<br />
&nbsp;&nbsp; &nbsp;&nbsp; break;<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; $b = oci_bind_by_name($stid, key($vars), current($vars));<br />
&nbsp;&nbsp;&nbsp; if ($b === FALSE) {<br />
&nbsp;&nbsp; &nbsp;&nbsp; DIE('Could not bind var');<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp; } while (each($vars) !== FALSE);<br />
}<br />
$binds = array(':bla1' =&gt; 'blubb1',<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ':bla2' =&gt; 'blubb2');<br />
$stid = sql($conn, $q, $binds);<br />
$row = oci_fetch_array($stid, OCI_ASSOC+OCI_RETURN_NULLS);<br />
<br />
Wherever you oci_bind_by_name(), the pointer to the initial data has to exist from beginning to end.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="115784""></a>
  <div class="note">
   <strong class="user">xorinox at gmx dot ch</strong>
   <a href="#115784" class="date">23-Sep-2014 02:54</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Working with Oracle and raw types in and out worked like the following for me.<br />
<br />
<span class="default">&lt;?php<br />
&nbsp; </span><span class="comment">/*oracle procedure<br />
&nbsp; procedure open_session(<br />
&nbsp;&nbsp;&nbsp; i_instance_id in raw,<br />
&nbsp;&nbsp;&nbsp; o_session_id out raw,<br />
&nbsp;&nbsp;&nbsp; o_errcode out number,<br />
&nbsp;&nbsp;&nbsp; o_errmsg out varchar2<br />
&nbsp; );&nbsp; <br />
&nbsp; */<br />
<br />
&nbsp; //open database<br />
&nbsp; </span><span class="default">$conn </span><span class="keyword">= </span><span class="default">DBOpen</span><span class="keyword">( </span><span class="default">DB_DEV_USER </span><span class="keyword">);<br />
<br />
&nbsp; </span><span class="comment">//get session id<br />
&nbsp; </span><span class="default">$sql </span><span class="keyword">= </span><span class="string">"begin p_loader.open_session( hextoraw( :instance_id ), :session_id, :errcode, :errmsg ); end;"</span><span class="keyword">;<br />
&nbsp; </span><span class="default">$stmt </span><span class="keyword">= </span><span class="default">oci_parse</span><span class="keyword">( </span><span class="default">$conn</span><span class="keyword">, </span><span class="default">$sql </span><span class="keyword">);<br />
&nbsp; </span><span class="default">$instanceId </span><span class="keyword">= </span><span class="default">DB_INSTANCE_ID</span><span class="keyword">;<br />
&nbsp; </span><span class="default">oci_bind_by_name</span><span class="keyword">( </span><span class="default">$stmt</span><span class="keyword">, </span><span class="string">":instance_id"</span><span class="keyword">, </span><span class="default">$instanceId</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">, </span><span class="default">SQLT_CHR </span><span class="keyword">);<br />
&nbsp; </span><span class="default">oci_bind_by_name</span><span class="keyword">( </span><span class="default">$stmt</span><span class="keyword">, </span><span class="string">":session_id"</span><span class="keyword">, </span><span class="default">$sessionId</span><span class="keyword">, </span><span class="default">16</span><span class="keyword">, </span><span class="default">SQLT_BIN </span><span class="keyword">);<br />
&nbsp; </span><span class="default">oci_bind_by_name</span><span class="keyword">( </span><span class="default">$stmt</span><span class="keyword">, </span><span class="string">":errcode"</span><span class="keyword">, </span><span class="default">$errcode</span><span class="keyword">, </span><span class="default">12</span><span class="keyword">, </span><span class="default">SQLT_INT </span><span class="keyword">);<br />
&nbsp; </span><span class="default">oci_bind_by_name</span><span class="keyword">( </span><span class="default">$stmt</span><span class="keyword">, </span><span class="string">":errmsg"</span><span class="keyword">, </span><span class="default">$errmsg</span><span class="keyword">, </span><span class="default">4000</span><span class="keyword">, </span><span class="default">SQLT_CHR </span><span class="keyword">);<br />
&nbsp; <br />
&nbsp; </span><span class="default">oci_execute</span><span class="keyword">( </span><span class="default">$stmt </span><span class="keyword">);<br />
&nbsp; </span><span class="default">$sessionId </span><span class="keyword">= </span><span class="default">bin2hex</span><span class="keyword">( </span><span class="default">$sessionId </span><span class="keyword">); </span><span class="comment">//now this is a hex string<br />
&nbsp; <br />
&nbsp; //close database<br />
&nbsp; </span><span class="default">DBClose</span><span class="keyword">( </span><span class="default">$conn </span><span class="keyword">);<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="114869""></a>
  <div class="note">
   <strong class="user">jjeffman at cpovo.net</strong>
   <a href="#114869" class="date">17-Apr-2014 04:02</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
It is very important to set up the maxlength of the returning parameter (:r), even when it is returning a number, otherwise the ORA-01460 exception (unimplemented or unreasonable conversion requested) may be raised.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="105911""></a>
  <div class="note">
   <strong class="user">abiyi2000 at yahoo dot com</strong>
   <a href="#105911" class="date">24-Sep-2011 08:03</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I unfortunately spent the whole day trying to make this work as part of OCI bind_by_name insert:
<br />

<br />
<span class="default">&lt;?php
<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="keyword">if(</span><span class="default">is_numeric</span><span class="keyword">(</span><span class="default">$v2</span><span class="keyword">)){
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">oci_bind_by_name</span><span class="keyword">(</span><span class="default">$stmth</span><span class="keyword">, </span><span class="default">$bvar</span><span class="keyword">, </span><span class="default">$v2</span><span class="keyword">,&nbsp; -</span><span class="default">1</span><span class="keyword">, </span><span class="default">OCI_B_INT</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp;&nbsp; }else{
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$v2 </span><span class="keyword">= (string) </span><span class="default">$v2</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">oci_bind_by_name</span><span class="keyword">(</span><span class="default">$stmth</span><span class="keyword">, </span><span class="default">$bvar</span><span class="keyword">, </span><span class="default">$v2</span><span class="keyword">, -</span><span class="default">1</span><span class="keyword">, </span><span class="default">SQLT_CHR</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp;&nbsp; }
<br />
</span><span class="default">?&gt;
<br />
</span>
<br />
The string field is always inserting correctly w/o any truncation. The string field is a&nbsp; varchar2(160) CHAR, but the data used to populate it is 40 chars in length.
<br />

<br />
The numeric part is of Type Number in the database which is being used to store unix time (10 digit seconds since 1970/01/01.
<br />

<br />
The problem, the insert was truncating to 9 digits with some bogus value not even related to the input i.e., it's not just a matter of dropping the leftmost or rightmost digit, it'll just insert a 9 digit bogus number.
<br />

<br />
The only way I was able to resolve this for the numeric field was to set the maxlength to 8 (not 10 which is the number of digits in the input): 
<br />

<br />
<span class="default">&lt;?php
<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="keyword">if(</span><span class="default">is_numeric</span><span class="keyword">(</span><span class="default">$v2</span><span class="keyword">)){
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">oci_bind_by_name</span><span class="keyword">(</span><span class="default">$stmth</span><span class="keyword">, </span><span class="default">$bvar</span><span class="keyword">, </span><span class="default">$v2</span><span class="keyword">,&nbsp; </span><span class="default">8</span><span class="keyword">, </span><span class="default">OCI_B_INT</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp;&nbsp; }else{
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$v2 </span><span class="keyword">= (string) </span><span class="default">$v2</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">oci_bind_by_name</span><span class="keyword">(</span><span class="default">$stmth</span><span class="keyword">, </span><span class="default">$bvar</span><span class="keyword">, </span><span class="default">$v2</span><span class="keyword">, -</span><span class="default">1</span><span class="keyword">, </span><span class="default">SQLT_CHR</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp;&nbsp; }
<br />
</span><span class="default">?&gt;
<br />
</span>
<br />
Hopefully you'll see this soon before you expend a lot of time repeating the same problem I had.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="92334""></a>
  <div class="note">
   <strong class="user">adrian dot crossley at hesa dot ac dot uk</strong>
   <a href="#92334" class="date">20-Jul-2009 06:14</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Sometimes you get the error "ORA-01461: can bind a LONG value only for insert into a LONG column".&nbsp; This error is highly misleading especially when you have no LONG columns or LONG values.<br />
<br />
From my testing it seems this error can be caused when the value of a bound variable exceeds the length allocated.<br />
<br />
To avoid this error make sure you specify lengths when binding varchars e.g. <br />
<span class="default">&lt;?php<br />
oci_bind_by_name</span><span class="keyword">(</span><span class="default">$stmt</span><span class="keyword">,</span><span class="string">':string'</span><span class="keyword">,</span><span class="default">$string</span><span class="keyword">, </span><span class="default">256</span><span class="keyword">);<br />
</span><span class="default">?&gt;<br />
</span><br />
And for numerics use the default length (-1) but tell oracle its an integer e.g. <br />
<span class="default">&lt;?php<br />
oci_bind_by_name</span><span class="keyword">(</span><span class="default">$stmt</span><span class="keyword">,</span><span class="string">':num'</span><span class="keyword">,</span><span class="default">$num</span><span class="keyword">, -</span><span class="default">1</span><span class="keyword">, </span><span class="default">SQLT_INT</span><span class="keyword">);<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="89074""></a>
  <div class="note">
   <strong class="user">avenger at php dot net</strong>
   <a href="#89074" class="date">20-Feb-2009 03:54</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Dont forget the 5th parameter: $type. It's will slowly your code some times. Eg:<br />
<br />
<span class="default">&lt;?php<br />
$sql </span><span class="keyword">= </span><span class="string">"select * from (select * from b xxx) where rownum &lt; :rnum"</span><span class="keyword">;<br />
</span><span class="default">$stmt </span><span class="keyword">= </span><span class="default">OCIParse</span><span class="keyword">(</span><span class="default">$conn</span><span class="keyword">,</span><span class="default">$sql</span><span class="keyword">);<br />
</span><span class="default">OCIBindByName</span><span class="keyword">(</span><span class="default">$stmt</span><span class="keyword">, </span><span class="string">":rnum"</span><span class="keyword">, </span><span class="default">$NUM</span><span class="keyword">, -</span><span class="default">1</span><span class="keyword">);<br />
</span><span class="default">OCIExecute</span><span class="keyword">(</span><span class="default">$stmt</span><span class="keyword">);<br />
</span><span class="default">?&gt;<br />
</span><br />
Below code was slow 5~6 time than not use bind value.Change the 3rd line to:<br />
<br />
<span class="default">&lt;?php<br />
OCIBindByName</span><span class="keyword">(</span><span class="default">$stmt</span><span class="keyword">, </span><span class="string">":rnum"</span><span class="keyword">, </span><span class="default">$NUM</span><span class="keyword">, -</span><span class="default">1</span><span class="keyword">, </span><span class="default">SQLT_INT</span><span class="keyword">);<br />
</span><span class="default">?&gt;<br />
</span><br />
will resloved this problem.<br />
<br />
This issue is also in the ADODB DB class(adodb.sf.net), you will be careful for use the SelectLimit method.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="83094""></a>
  <div class="note">
   <strong class="user">ajitsingh4u at gmail dot com</strong>
   <a href="#83094" class="date">09-May-2008 09:39</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
//Calling Oracle Stored Procedure<br />
//I assume that you have a users table and three columns in users table i.e. id, user, email in oracle<br />
// For example I made connection in constructor, you can modify as per your requirement.<br />
//<a href="http://www.devshed.com/c/a/PHP/Understanding-Destructors-in-PHP-5/1/" rel="nofollow" target="_blank">http://www.devshed.com/c/a/PHP/Understanding-Destructors-in-PHP-5/1/</a><br />
<span class="default">&lt;?php<br />
</span><span class="keyword">class </span><span class="default">Users</span><span class="keyword">{<br />
&nbsp;&nbsp;&nbsp; private </span><span class="default">$connection</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; public function </span><span class="default">__construct</span><span class="keyword">()<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">connection </span><span class="keyword">= </span><span class="default">oci_connect</span><span class="keyword">(</span><span class="string">"scott"</span><span class="keyword">, </span><span class="string">"tiger"</span><span class="keyword">, </span><span class="default">$db</span><span class="keyword">); </span><span class="comment">// Establishes a connection to the Oracle server; <br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">}<br />
<br />
&nbsp;&nbsp;&nbsp; public function </span><span class="default">selectUsers</span><span class="keyword">(</span><span class="default">$start_index</span><span class="keyword">=</span><span class="default">1</span><span class="keyword">, </span><span class="default">$numbers_of_rows</span><span class="keyword">=</span><span class="default">20</span><span class="keyword">)<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$sql </span><span class="keyword">=</span><span class="string">"BEGIN sp_users_select(:p_start_index, :p_numbers_of_rows, :p_cursor, :p_result); END;"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$stmt </span><span class="keyword">= </span><span class="default">oci_parse</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">connection</span><span class="keyword">, </span><span class="default">$sql</span><span class="keyword">);<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">//Bind in parameter<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">oci_bind_by_name</span><span class="keyword">(</span><span class="default">$stmt</span><span class="keyword">, </span><span class="string">':p_start_index'</span><span class="keyword">, </span><span class="default">$start_index</span><span class="keyword">, </span><span class="default">20</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">oci_bind_by_name</span><span class="keyword">(</span><span class="default">$stmt</span><span class="keyword">, </span><span class="string">':p_numbers_of_rows'</span><span class="keyword">, </span><span class="default">$numbers_of_rows</span><span class="keyword">, </span><span class="default">20</span><span class="keyword">);<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">//Bind out parameter<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">oci_bind_by_name</span><span class="keyword">(</span><span class="default">$stmt</span><span class="keyword">, </span><span class="string">':p_result'</span><span class="keyword">, </span><span class="default">$result</span><span class="keyword">, </span><span class="default">20</span><span class="keyword">); </span><span class="comment">// returns 0 if stored procedure succeessfully executed.<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; //Bind Cursor<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$p_cursor </span><span class="keyword">= </span><span class="default">oci_new_cursor</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">connection</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">oci_bind_by_name</span><span class="keyword">(</span><span class="default">$stmt</span><span class="keyword">, </span><span class="string">':p_cursor'</span><span class="keyword">, </span><span class="default">$p_cursor</span><span class="keyword">, -</span><span class="default">1</span><span class="keyword">, </span><span class="default">OCI_B_CURSOR</span><span class="keyword">);<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// Execute Statement<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">oci_execute</span><span class="keyword">(</span><span class="default">$stmt</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">oci_execute</span><span class="keyword">(</span><span class="default">$p_cursor</span><span class="keyword">, </span><span class="default">OCI_DEFAULT</span><span class="keyword">);<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">oci_fetch_all</span><span class="keyword">(</span><span class="default">$p_cursor</span><span class="keyword">, </span><span class="default">$cursor</span><span class="keyword">, </span><span class="default">null</span><span class="keyword">, </span><span class="default">null</span><span class="keyword">, </span><span class="default">OCI_FETCHSTATEMENT_BY_ROW</span><span class="keyword">);<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="default">$result</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="string">'&lt;br&gt;'</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">var_dump</span><span class="keyword">(</span><span class="default">$cursor</span><span class="keyword">); </span><span class="comment">// $cursor is an associative array so we can use print_r() to print this data.<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; // you can return data from this function to use it at your user interface.<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">}<br />
<br />
&nbsp;&nbsp;&nbsp; public function </span><span class="default">deleteUser</span><span class="keyword">(</span><span class="default">$id</span><span class="keyword">)<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$sql </span><span class="keyword">=</span><span class="string">"BEGIN sp_user_delete(:p_id, :p_result); END;"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$stmt </span><span class="keyword">= </span><span class="default">oci_parse</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">connection</span><span class="keyword">, </span><span class="default">$sql</span><span class="keyword">);<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// bind in and out variables<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">oci_bind_by_name</span><span class="keyword">(</span><span class="default">$stmt</span><span class="keyword">, </span><span class="string">':p_id'</span><span class="keyword">, </span><span class="default">$id</span><span class="keyword">, </span><span class="default">20</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">oci_bind_by_name</span><span class="keyword">(</span><span class="default">$stmt</span><span class="keyword">, </span><span class="string">':p_result'</span><span class="keyword">, </span><span class="default">$result</span><span class="keyword">, </span><span class="default">20</span><span class="keyword">);<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">//Execute the statement<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$check </span><span class="keyword">= </span><span class="default">oci_execute</span><span class="keyword">(</span><span class="default">$stmt</span><span class="keyword">);<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">$check </span><span class="keyword">== </span><span class="default">true</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$commit </span><span class="keyword">= </span><span class="default">oci_commit</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">connection</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; else<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$commit </span><span class="keyword">= </span><span class="default">oci_rollback</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">connection</span><span class="keyword">);<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">$result</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// You can make function for insert ,update using above two functions<br />
<br />
</span><span class="keyword">}<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="75018""></a>
  <div class="note">
   
   <a href="#75018" class="date">08-May-2007 01:59</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
This is what the old OCI_B_* constants are now called:<br />
(PHP 5.1.6 win32)<br />
<br />
OCI_B_NTY - SQLT_NTY<br />
OCI_B_BFILE - SQLT_BFILEE<br />
OCI_B_CFILEE - SQLT_CFILEE<br />
OCI_B_CLOB - SQLT_CLOB<br />
OCI_B_BLOB - SQLT_BLOB<br />
OCI_B_ROWID - SQLT_RDD<br />
OCI_B_CURSOR - SQLT_RSET<br />
OCI_B_BIN - SQLT_BIN<br />
OCI_B_INT - SQLT_INT<br />
OCI_B_NUM - SQLT_NUM</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="72290""></a>
  <div class="note">
   <strong class="user">Chris Delcamp</strong>
   <a href="#72290" class="date">11-Jan-2007 08:48</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
This is an example of returning the primary key from an insert so that you can do inserts on other tables with foreign keys based on that value.&nbsp; The date is just used to provied semi-unique data to be inserted.<br />
<br />
$conn = oci_connect("username", "password")<br />
$stmt = oci_parse($conn, "INSERT INTO test (test_msg) values (:data) RETURN test_id INTO :RV");<br />
$data = date("d-M-Y H:i:s");<br />
oci_bind_by_name($stmt, ":RV", $rv, -1, SQLT_INT);<br />
oci_bind_by_name($stmt, ":data", $data, 24);<br />
oci_execute($stmt);<br />
print $rv;</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="55895""></a>
  <div class="note">
   <strong class="user">hfuecks at nospam dot org</strong>
   <a href="#55895" class="date">16-Aug-2005 01:12</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Note that there have been some changes on the constant identifiers and the documentation is currently not entirely accurate.<br />
<br />
Running the following script;<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">foreach (</span><span class="default">array_keys</span><span class="keyword">(</span><span class="default">get_defined_constants</span><span class="keyword">()) as </span><span class="default">$const</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; if ( </span><span class="default">preg_match</span><span class="keyword">(</span><span class="string">'/^OCI_B_/'</span><span class="keyword">, </span><span class="default">$const</span><span class="keyword">) ) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; print </span><span class="string">"</span><span class="default">$const</span><span class="string">\n"</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
}<br />
</span><span class="default">?&gt;<br />
</span><br />
Under PHP 4.4.0 I get;<br />
<br />
OCI_B_SQLT_NTY &lt; renamed to OCI_B_NTY with PHP5<br />
OCI_B_BFILE<br />
OCI_B_CFILEE<br />
OCI_B_CLOB<br />
OCI_B_BLOB<br />
OCI_B_ROWID<br />
OCI_B_CURSOR<br />
OCI_B_BIN<br />
<br />
Under PHP 5.0.4 I get;<br />
<br />
OCI_B_NTY<br />
OCI_B_BFILE &lt; docs are wrong right now<br />
OCI_B_CFILEE &lt; docs are wrong right now<br />
OCI_B_CLOB<br />
OCI_B_BLOB<br />
OCI_B_ROWID<br />
OCI_B_CURSOR<br />
OCI_B_BIN &lt; it's a mystery</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
</div>
</div>
</div></div></body></html>
