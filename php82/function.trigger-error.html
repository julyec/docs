<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
 <head>
  <meta http-equiv="content-type" content="text/html; CHARSET=UTF-8">
  <title>产生一个用户级别的 error/warning/notice 信息</title>
<link media="all" rel="stylesheet" type="text/css" href="styles/03e73060321a0a848018724a6c83de7f-theme-base.css" />
<link media="all" rel="stylesheet" type="text/css" href="styles/03e73060321a0a848018724a6c83de7f-theme-medium.css" />

  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <link media="all" rel="stylesheet" type="text/css" href="style.css"/>
 </head>
 <body class="docs" class="docs"><div class="navbar navbar-fixed-top">
  <div class="navbar-inner clearfix">
    <ul class="nav" style="width: 100%">
      <li style="float: left;"><a href="function.set-exception-handler.html">? set_exception_handler</a></li>
      <li style="float: right;"><a href="function.user-error.html">user_error ?</a></li>
    </ul>
  </div>
</div>
<div id="breadcrumbs" class="clearfix">
  <ul class="breadcrumbs-container">
    <li><a href="index.html">PHP Manual</a></li>
    <li><a href="ref.errorfunc.html">错误处理 函数</a></li>
    <li>产生一个用户级别的 error/warning/notice 信息</li>
  </ul>
</div>
<div id="layout">
  <div id="layout-content"><div id="function.trigger-error" class="refentry">
 <div class="refnamediv">
  <h1 class="refname">trigger_error</h1>
  <p class="verinfo">(PHP 4 &gt;= 4.0.1, PHP 5, PHP 7, PHP 8)</p><p class="refpurpose"><span class="refname">trigger_error</span> &mdash; <span class="dc-title">产生一个用户级别的 error/warning/notice 信息</span></p>

 </div>

 <div class="refsect1 description" id="refsect1-function.trigger-error-description">
  <h3 class="title">说明</h3>
  <div class="methodsynopsis dc-description">
   <span class="methodname"><strong>trigger_error</strong></span>(<span class="methodparam"><span class="type">string</span> <code class="parameter">$message</code></span>, <span class="methodparam"><span class="type">int</span> <code class="parameter">$error_level</code><span class="initializer"> = <strong><code>E_USER_NOTICE</code></strong></span></span>): <span class="type">bool</span></div>

  <p class="para rdfs-comment">
   用于触发一个用户级别的错误条件，它能结合内置的错误处理器所关联，或者可以使用用户定义的函数作为新的错误处理程序(<span class="function"><a href="function.set-error-handler.html" class="function">set_error_handler()</a></span>)。
  </p>
  <p class="para">
   该函数在你运行出现异常时，需要产生一个特定的响应时非常有用。
  </p>
 </div>


 <div class="refsect1 parameters" id="refsect1-function.trigger-error-parameters">
  <h3 class="title">参数</h3>
  <p class="para">
   <dl>
    
     <dt>
<code class="parameter">message</code></dt>

     <dd>

      <p class="para">
       该 error 的特定错误信息，长度限制在了 1024 个字节。超过 1024 字节的字符都会被截断。
      </p>
     </dd>

    
    
     <dt>
<code class="parameter">error_level</code></dt>

     <dd>

      <p class="para">
       该 error 所特定的错误类型。仅 E_USER 系列常量对其有效，默认是 <strong><code>E_USER_NOTICE</code></strong>。
      </p>
     </dd>

    
   </dl>

  </p>
 </div>


 <div class="refsect1 returnvalues" id="refsect1-function.trigger-error-returnvalues">
  <h3 class="title">返回值</h3>
  <p class="para">
   如果指定了错误的 <code class="parameter">error_level</code> 会返回 <strong><code>false</code></strong> ，正确则返回 <strong><code>true</code></strong>。
  </p>
 </div>


 <div class="refsect1 examples" id="refsect1-function.trigger-error-examples">
  <h3 class="title">示例</h3>
  <p class="para">
   <div class="example" id="example-1048">
    <p><strong>Example #1 <span class="function"><strong>trigger_error()</strong></span> 示例</strong></p>
    <div class="example-contents"><p>
     <span class="function"><a href="function.set-error-handler.html" class="function">set_error_handler()</a></span> 可见到更多详细的例子。
    </p></div>
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br /></span><span style="color: #007700">if (</span><span style="color: #0000BB">$divisor </span><span style="color: #007700">== </span><span style="color: #0000BB">0</span><span style="color: #007700">) {<br />    </span><span style="color: #0000BB">trigger_error</span><span style="color: #007700">(</span><span style="color: #DD0000">"Cannot divide by zero"</span><span style="color: #007700">, </span><span style="color: #0000BB">E_USER_ERROR</span><span style="color: #007700">);<br />}<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
    </div>

   </div>
  </p>
 </div>


 <div class="refsect1 notes" id="refsect1-function.trigger-error-notes">
  <h3 class="title">注释</h3>
  <div class="warning"><strong class="warning">Warning</strong>
   <p class="para">
     在 <code class="parameter">message</code> 
     里的 HTML 实体，并不会被转义。如果错误消息要显示在浏览器里，需要对错误消息使用
     <span class="function"><a href="function.htmlentities.html" class="function">htmlentities()</a></span>。
   </p>
  </div>
 </div>


 <div class="refsect1 seealso" id="refsect1-function.trigger-error-seealso">
  <h3 class="title">参见</h3>
  <p class="para">
   <ul class="simplelist">
    <li class="member"><span class="function"><a href="function.error-reporting.html" class="function" rel="rdfs-seeAlso">error_reporting()</a> - 设置应该报告何种 PHP 错误</span></li>
    <li class="member"><span class="function"><a href="function.set-error-handler.html" class="function" rel="rdfs-seeAlso">set_error_handler()</a> - 设置用户自定义的错误处理函数</span></li>
    <li class="member"><span class="function"><a href="function.restore-error-handler.html" class="function" rel="rdfs-seeAlso">restore_error_handler()</a> - 还原之前的错误处理函数</span></li>
    <li class="member"><a href="errorfunc.constants.html" class="link">错误级别常量</a></li>
   </ul>
  </p>
 </div>

</div><div id="usernotes">
 <div class="head">
  <h3 class="title">User Contributed Notes</h3>
 </div>
<div id="allnotes">  <a name="127500""></a>
  <div class="note">
   <strong class="user">phpmanual at allanid dot com</strong>
   <a href="#127500" class="date">16-Aug-2022 05:17</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Note that whether or not the script is terminated by this function call, is determined by the error_level.<br />
<br />
Eg. E_USER_ERROR will terminate the script while E_USER_NOTICE will not.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="124282""></a>
  <div class="note">
   <strong class="user">spravce at jednota dot podborany dot cz</strong>
   <a href="#124282" class="date">10-Oct-2019 10:18</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Trigger error does not trim&nbsp; 1024+ chars length messages if you use your own error handler</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="118794""></a>
  <div class="note">
   <strong class="user">eslindsey at gmail dot com</strong>
   <a href="#118794" class="date">07-Feb-2016 08:58</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
For those of you wanting one (or more) lines of context on your call to trigger_error, I offer this. Would be nice to use \n to get a proper stack trace, but it seems trigger_error escapes it; therefore, I use a comma.<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="comment">/**<br />
&nbsp;* Behaves like trigger_error, but appends part of a stack trace to the error<br />
&nbsp;* message. This allows you to see where trigger_error was called from, instead<br />
&nbsp;* of just seeing the file and line number of the call to trigger_error.<br />
&nbsp;*<br />
&nbsp;* @param&nbsp;&nbsp; error_msg&nbsp;&nbsp; The designated error message for this error<br />
&nbsp;* @param&nbsp;&nbsp; error_type&nbsp; The designated error type for this error (E_USER_*)<br />
&nbsp;* @param&nbsp;&nbsp; context&nbsp; &nbsp;&nbsp; Number of stack frames to append, defaults to 1<br />
&nbsp;* @return&nbsp; FALSE if wrong error_type is specified, TRUE otherwise<br />
&nbsp;*/<br />
</span><span class="keyword">function </span><span class="default">trigger_error_with_context</span><span class="keyword">(</span><span class="default">$error_msg</span><span class="keyword">, </span><span class="default">$error_type</span><span class="keyword">, </span><span class="default">$context </span><span class="keyword">= </span><span class="default">1</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$stack </span><span class="keyword">= </span><span class="default">debug_backtrace</span><span class="keyword">();<br />
&nbsp;&nbsp;&nbsp; for (</span><span class="default">$i </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">; </span><span class="default">$i </span><span class="keyword">&lt; </span><span class="default">$context</span><span class="keyword">; </span><span class="default">$i</span><span class="keyword">++)<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">false </span><span class="keyword">=== (</span><span class="default">$frame </span><span class="keyword">= </span><span class="default">next</span><span class="keyword">(</span><span class="default">$stack</span><span class="keyword">))<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; break;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$error_msg </span><span class="keyword">.= </span><span class="string">", from " </span><span class="keyword">. </span><span class="default">$frame</span><span class="keyword">[</span><span class="string">'function'</span><span class="keyword">] . </span><span class="string">':' </span><span class="keyword">. </span><span class="default">$frame</span><span class="keyword">[</span><span class="string">'file'</span><span class="keyword">] . </span><span class="string">' line ' </span><span class="keyword">. </span><span class="default">$frame</span><span class="keyword">[</span><span class="string">'line'</span><span class="keyword">];<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">trigger_error</span><span class="keyword">(</span><span class="default">$error_msg</span><span class="keyword">, </span><span class="default">$error_type</span><span class="keyword">);<br />
}<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="115254""></a>
  <div class="note">
   <strong class="user">aydin dot kn12 at gmail dot com</strong>
   <a href="#115254" class="date">20-Jun-2014 07:48</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If error_type is E_USER_ERROR then trigger_error throw FATAL ERROR and script stopped after this line.<br />
<br />
<span class="default">&lt;?php<br />
<br />
$msg </span><span class="keyword">= </span><span class="string">'This is the test message for echo'</span><span class="keyword">;<br />
<br />
</span><span class="default">trigger_error</span><span class="keyword">(</span><span class="string">'Error message'</span><span class="keyword">, </span><span class="default">E_USER_ERROR</span><span class="keyword">); </span><span class="comment">// Script stopped after this line...<br />
<br />
</span><span class="keyword">echo </span><span class="default">$msg</span><span class="keyword">; </span><span class="comment">// This line does not appear...<br />
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="98910""></a>
  <div class="note">
   <strong class="user">PhpMyCoder</strong>
   <a href="#98910" class="date">15-Jul-2010 03:18</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
For those of you looking to use your own file or line number in the error (possibly using debug_backtrace()) instead of the ones created by trigger_error(), here is a solution:<br />
Create a custom function to handle E_USER_ERRORs that simply outputs the error type and message, while excluding the line number and file trigger_error() reports. You may also configure it to handle user warnings and notices if necessary (I did in the example below).<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">function </span><span class="default">error_handler</span><span class="keyword">(</span><span class="default">$level</span><span class="keyword">, </span><span class="default">$message</span><span class="keyword">, </span><span class="default">$file</span><span class="keyword">, </span><span class="default">$line</span><span class="keyword">, </span><span class="default">$context</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">//Handle user errors, warnings, and notices ourself<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">if(</span><span class="default">$level </span><span class="keyword">=== </span><span class="default">E_USER_ERROR </span><span class="keyword">|| </span><span class="default">$level </span><span class="keyword">=== </span><span class="default">E_USER_WARNING </span><span class="keyword">|| </span><span class="default">$level </span><span class="keyword">=== </span><span class="default">E_USER_NOTICE</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="string">'&lt;strong&gt;Error:&lt;/strong&gt; '</span><span class="keyword">.</span><span class="default">$message</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return(</span><span class="default">true</span><span class="keyword">); </span><span class="comment">//And prevent the PHP error handler from continuing<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">}<br />
&nbsp;&nbsp;&nbsp; return(</span><span class="default">false</span><span class="keyword">); </span><span class="comment">//Otherwise, use PHP's error handler<br />
</span><span class="keyword">}<br />
<br />
function </span><span class="default">trigger_my_error</span><span class="keyword">(</span><span class="default">$message</span><span class="keyword">, </span><span class="default">$level</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">//Get the caller of the calling function and details about it<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$callee </span><span class="keyword">= </span><span class="default">next</span><span class="keyword">(</span><span class="default">debug_backtrace</span><span class="keyword">());<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">//Trigger appropriate error<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">trigger_error</span><span class="keyword">(</span><span class="default">$message</span><span class="keyword">.</span><span class="string">' in &lt;strong&gt;'</span><span class="keyword">.</span><span class="default">$callee</span><span class="keyword">[</span><span class="string">'file'</span><span class="keyword">].</span><span class="string">'&lt;/strong&gt; on line &lt;strong&gt;'</span><span class="keyword">.</span><span class="default">$callee</span><span class="keyword">[</span><span class="string">'line'</span><span class="keyword">].</span><span class="string">'&lt;/strong&gt;'</span><span class="keyword">, </span><span class="default">$level</span><span class="keyword">);<br />
}<br />
<br />
</span><span class="comment">//Use our custom handler<br />
</span><span class="default">set_error_handler</span><span class="keyword">(</span><span class="string">'error_handler'</span><span class="keyword">);<br />
<br />
</span><span class="comment">//-------------------------------<br />
//Demo usage:<br />
//-------------------------------<br />
</span><span class="keyword">function </span><span class="default">abc</span><span class="keyword">(</span><span class="default">$str</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; if(!</span><span class="default">is_string</span><span class="keyword">(</span><span class="default">$str</span><span class="keyword">)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">trigger_my_error</span><span class="keyword">(</span><span class="string">'abc() expects parameter 1 to be a string'</span><span class="keyword">, </span><span class="default">E_USER_ERROR</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }<br />
}<br />
<br />
</span><span class="default">abc</span><span class="keyword">(</span><span class="string">'Hello world!'</span><span class="keyword">); </span><span class="comment">//Works<br />
</span><span class="default">abc</span><span class="keyword">(</span><span class="default">18</span><span class="keyword">); </span><span class="comment">//Error: abc() expects parameter 1 to be a string in [FILE].php on line 31<br />
</span><span class="default">?&gt;<br />
</span><br />
This is a pretty simple concept and I'm sure most of you know this, but for those that don't, let it serve as a good example!</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="94081""></a>
  <div class="note">
   <strong class="user">tudor AT iccblue DOT com DOT nospam</strong>
   <a href="#94081" class="date">15-Oct-2009 08:07</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
It actually turns out - at least on PHP 5.2.6 on XAMPP (Windows) that for the custom error handler, you will need to set $errorType as the first parameter, and only the second parameter as $message, i.e. in reverse order compared to how the manual states it now.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="92016""></a>
  <div class="note">
   <strong class="user">Howard Yeend</strong>
   <a href="#92016" class="date">05-Jul-2009 04:39</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
trigger_error always reports the line and file that trigger_error was called on. Which isn't very useful.
<br />

<br />
eg:
<br />

<br />
main.php:
<br />
<span class="default">&lt;?php
<br />
</span><span class="keyword">include(</span><span class="string">'functions.php'</span><span class="keyword">);
<br />
</span><span class="default">$x </span><span class="keyword">= </span><span class="string">'test'</span><span class="keyword">;
<br />
</span><span class="default">doFunction</span><span class="keyword">(</span><span class="default">$x</span><span class="keyword">);
<br />
</span><span class="default">?&gt;
<br />
</span>
<br />
functions.php:
<br />
<span class="default">&lt;?php
<br />
</span><span class="keyword">function </span><span class="default">doFunction</span><span class="keyword">(</span><span class="default">$var</span><span class="keyword">) {
<br />
if(</span><span class="default">is_numeric</span><span class="keyword">(</span><span class="default">$var</span><span class="keyword">)) {
<br />
&nbsp;</span><span class="comment">/* do some stuff*/
<br />
</span><span class="keyword">} else {
<br />
&nbsp;</span><span class="default">trigger_error</span><span class="keyword">(</span><span class="string">'var must be numeric'</span><span class="keyword">);
<br />
}
<br />
}
<br />
</span><span class="default">?&gt;
<br />
</span>
<br />
will output "Notice: var must be numeric in functions.php on line 6"
<br />
whereas "Notice: var must be numeric in main.php on line 4" would be more useful
<br />

<br />
here's a function to do that:
<br />

<br />
<span class="default">&lt;?php
<br />

<br />
</span><span class="keyword">function </span><span class="default">error</span><span class="keyword">(</span><span class="default">$message</span><span class="keyword">, </span><span class="default">$level</span><span class="keyword">=</span><span class="default">E_USER_NOTICE</span><span class="keyword">) {
<br />
</span><span class="default">$caller </span><span class="keyword">= </span><span class="default">next</span><span class="keyword">(</span><span class="default">debug_backtrace</span><span class="keyword">());
<br />
</span><span class="default">trigger_error</span><span class="keyword">(</span><span class="default">$message</span><span class="keyword">.</span><span class="string">' in &lt;strong&gt;'</span><span class="keyword">.</span><span class="default">$caller</span><span class="keyword">[</span><span class="string">'function'</span><span class="keyword">].</span><span class="string">'&lt;/strong&gt; called from &lt;strong&gt;'</span><span class="keyword">.</span><span class="default">$caller</span><span class="keyword">[</span><span class="string">'file'</span><span class="keyword">].</span><span class="string">'&lt;/strong&gt; on line &lt;strong&gt;'</span><span class="keyword">.</span><span class="default">$caller</span><span class="keyword">[</span><span class="string">'line'</span><span class="keyword">].</span><span class="string">'&lt;/strong&gt;'</span><span class="keyword">.</span><span class="string">"\n&lt;br /&gt;error handler"</span><span class="keyword">, </span><span class="default">$level</span><span class="keyword">);
<br />
}
<br />
</span><span class="default">?&gt;
<br />
</span>
<br />
So now in our example:
<br />

<br />
main.php:
<br />
<span class="default">&lt;?php
<br />
</span><span class="keyword">include(</span><span class="string">'functions.php'</span><span class="keyword">);
<br />
</span><span class="default">$x </span><span class="keyword">= </span><span class="string">'test'</span><span class="keyword">;
<br />
</span><span class="default">doFunction</span><span class="keyword">(</span><span class="default">$x</span><span class="keyword">);
<br />
</span><span class="default">?&gt;
<br />
</span>
<br />
functions.php:
<br />
<span class="default">&lt;?php
<br />
</span><span class="keyword">function </span><span class="default">doFunction</span><span class="keyword">(</span><span class="default">$var</span><span class="keyword">) {
<br />
&nbsp;&nbsp;&nbsp; if(</span><span class="default">is_numeric</span><span class="keyword">(</span><span class="default">$var</span><span class="keyword">)) {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">/* do some stuff*/
<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">} else {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">error</span><span class="keyword">(</span><span class="string">'var must be numeric'</span><span class="keyword">);
<br />
&nbsp;&nbsp;&nbsp; }
<br />
}
<br />

<br />
function </span><span class="default">error</span><span class="keyword">(</span><span class="default">$message</span><span class="keyword">, </span><span class="default">$level</span><span class="keyword">=</span><span class="default">E_USER_NOTICE</span><span class="keyword">) {
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$caller </span><span class="keyword">= </span><span class="default">next</span><span class="keyword">(</span><span class="default">debug_backtrace</span><span class="keyword">());
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">trigger_error</span><span class="keyword">(</span><span class="default">$message</span><span class="keyword">.</span><span class="string">' in &lt;strong&gt;'</span><span class="keyword">.</span><span class="default">$caller</span><span class="keyword">[</span><span class="string">'function'</span><span class="keyword">].</span><span class="string">'&lt;/strong&gt; called from &lt;strong&gt;'</span><span class="keyword">.</span><span class="default">$caller</span><span class="keyword">[</span><span class="string">'file'</span><span class="keyword">].</span><span class="string">'&lt;/strong&gt; on line &lt;strong&gt;'</span><span class="keyword">.</span><span class="default">$caller</span><span class="keyword">[</span><span class="string">'line'</span><span class="keyword">].</span><span class="string">'&lt;/strong&gt;'</span><span class="keyword">.</span><span class="string">"\n&lt;br /&gt;error handler"</span><span class="keyword">, </span><span class="default">$level</span><span class="keyword">);
<br />
}
<br />
</span><span class="default">?&gt;
<br />
</span>
<br />
now outputs:
<br />

<br />
"Notice: var must be numeric in doFunction called from main.php on line 4"</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="80206""></a>
  <div class="note">
   <strong class="user">webmaster at paramiliar dot com</strong>
   <a href="#80206" class="date">03-Jan-2008 11:11</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
We wanted to be able to pass an SQL query to the error handler on our site so we could monitor SQL problems, you cant do this through normal methods so we came up with this bridge script that 100% works<br />
<br />
<span class="default">&lt;?php<br />
<br />
</span><span class="keyword">function </span><span class="default">myErrorHandler</span><span class="keyword">(</span><span class="default">$errno</span><span class="keyword">, </span><span class="default">$errstr</span><span class="keyword">, </span><span class="default">$errfile</span><span class="keyword">, </span><span class="default">$errline</span><span class="keyword">){<br />
&nbsp;&nbsp;&nbsp; switch (</span><span class="default">$errno</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; case </span><span class="default">E_USER_ERROR</span><span class="keyword">:<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">$errstr </span><span class="keyword">== </span><span class="string">"(SQL)"</span><span class="keyword">){<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// handling an sql error<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">echo </span><span class="string">"&lt;b&gt;SQL Error&lt;/b&gt; [</span><span class="default">$errno</span><span class="string">] " </span><span class="keyword">. </span><span class="default">SQLMESSAGE </span><span class="keyword">. </span><span class="string">"&lt;br /&gt;\n"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="string">"Query : " </span><span class="keyword">. </span><span class="default">SQLQUERY </span><span class="keyword">. </span><span class="string">"&lt;br /&gt;\n"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="string">"On line " </span><span class="keyword">. </span><span class="default">SQLERRORLINE </span><span class="keyword">. </span><span class="string">" in file " </span><span class="keyword">. </span><span class="default">SQLERRORFILE </span><span class="keyword">. </span><span class="string">" "</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="string">", PHP " </span><span class="keyword">. </span><span class="default">PHP_VERSION </span><span class="keyword">. </span><span class="string">" (" </span><span class="keyword">. </span><span class="default">PHP_OS </span><span class="keyword">. </span><span class="string">")&lt;br /&gt;\n"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="string">"Aborting...&lt;br /&gt;\n"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; } else {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="string">"&lt;b&gt;My ERROR&lt;/b&gt; [</span><span class="default">$errno</span><span class="string">] </span><span class="default">$errstr</span><span class="string">&lt;br /&gt;\n"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="string">"&nbsp; Fatal error on line </span><span class="default">$errline</span><span class="string"> in file </span><span class="default">$errfile</span><span class="string">"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="string">", PHP " </span><span class="keyword">. </span><span class="default">PHP_VERSION </span><span class="keyword">. </span><span class="string">" (" </span><span class="keyword">. </span><span class="default">PHP_OS </span><span class="keyword">. </span><span class="string">")&lt;br /&gt;\n"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="string">"Aborting...&lt;br /&gt;\n"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; exit(</span><span class="default">1</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; break;<br />
<br />
&nbsp;&nbsp;&nbsp; case </span><span class="default">E_USER_WARNING</span><span class="keyword">:<br />
&nbsp;&nbsp;&nbsp; case </span><span class="default">E_USER_NOTICE</span><span class="keyword">:<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">/* Don't execute PHP internal error handler */<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">return </span><span class="default">true</span><span class="keyword">;<br />
}<br />
<br />
</span><span class="comment">// function to test the error handling<br />
<br />
</span><span class="keyword">function </span><span class="default">sqlerrorhandler</span><span class="keyword">(</span><span class="default">$ERROR</span><span class="keyword">, </span><span class="default">$QUERY</span><span class="keyword">, </span><span class="default">$PHPFILE</span><span class="keyword">, </span><span class="default">$LINE</span><span class="keyword">){<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">define</span><span class="keyword">(</span><span class="string">"SQLQUERY"</span><span class="keyword">, </span><span class="default">$QUERY</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">define</span><span class="keyword">(</span><span class="string">"SQLMESSAGE"</span><span class="keyword">, </span><span class="default">$ERROR</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">define</span><span class="keyword">(</span><span class="string">"SQLERRORLINE"</span><span class="keyword">, </span><span class="default">$LINE</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">define</span><span class="keyword">(</span><span class="string">"SQLERRORFILE"</span><span class="keyword">, </span><span class="default">$PHPFILE</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">trigger_error</span><span class="keyword">(</span><span class="string">"(SQL)"</span><span class="keyword">, </span><span class="default">E_USER_ERROR</span><span class="keyword">);<br />
}<br />
<br />
</span><span class="default">set_error_handler</span><span class="keyword">(</span><span class="string">"myErrorHandler"</span><span class="keyword">);<br />
<br />
</span><span class="comment">// trigger an sql error<br />
</span><span class="default">$query </span><span class="keyword">= </span><span class="string">"SELECT * FROM tbl LIMIT 1"</span><span class="keyword">;<br />
</span><span class="default">$sql </span><span class="keyword">= @</span><span class="default">mysql_query</span><span class="keyword">(</span><span class="default">$query</span><span class="keyword">)<br />
&nbsp;&nbsp;&nbsp; or </span><span class="default">sqlerrorhandler</span><span class="keyword">(</span><span class="string">"("</span><span class="keyword">.</span><span class="default">mysql_errno</span><span class="keyword">().</span><span class="string">") "</span><span class="keyword">.</span><span class="default">mysql_error</span><span class="keyword">(), </span><span class="default">$query</span><span class="keyword">, </span><span class="default">$_SERVER</span><span class="keyword">[</span><span class="string">'PHP_SELF'</span><span class="keyword">], </span><span class="default">__LINE__</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; <br />
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="63910""></a>
  <div class="note">
   <strong class="user">richard at 2006 dot atterer dot net</strong>
   <a href="#63910" class="date">03-Apr-2006 09:28</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Beware, trigger_error() is absolutely useless for transporting your own function's error messages in $php_errormsg:<br />
<br />
ini_set('track_errors', TRUE);<br />
function x() { trigger_error('MY ERROR'); }<br />
@x();<br />
echo "Error 1: \\"$php_errormsg\\"\\n";<br />
@file_get_contents('/nonexisting');<br />
echo "Error 2: \\"$php_errormsg\\"\\n";<br />
<br />
This outputs:<br />
<br />
Error 1: ""<br />
Error 2: "failed to open stream: No such file or directory"<br />
<br />
This behaviour is consistent with the description of $php_errormsg, which says that the variable will only be available within the scope in which the error occurred. The problem can be worked around with a custom error handler like the one below. However, I'm undecided whether changing the language in this way is good:<br />
<br />
function errHandler($errno, $errstr, $errfile, $errline) {<br />
&nbsp; global $php_errormsg; $php_errormsg = $errstr;<br />
}<br />
set_error_handler('errHandler');</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="52255""></a>
  <div class="note">
   <strong class="user">mano at easymail dot hu</strong>
   <a href="#52255" class="date">26-Apr-2005 05:13</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I am not so familiar with this but I think you can reach some of the functionality of try..catch with this function. I would disagree or correct the previous note. The @ is not the catch, it sets the error_reporting to 0 tempolary but with set_error_handler you can try to imitate some behavior like catch.<br />
I've just made this to try if it possible, I never tried in projects but I think could work in php 4. Actually if you want to have the Trace of the error you need to use php4.3+.<br />
Maybe not many of you will create new scripts in php4 and try to have some features from php5 but in some cases (extending older projects) this could be better error handling.<br />
<br />
If this is a wrong approach, waiting for comments, if its not, use it!<br />
<br />
&lt;?<br />
function catch($errno, $errstr, $errfile, $errline){<br />
&nbsp;&nbsp;&nbsp; $GLOBALS['throw'] = $errstr;<br />
&nbsp;&nbsp;&nbsp; $GLOBALS['throw_info'] = array(<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; 'Message'=&gt;$errstr<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; ,'Code'=&gt;$errno<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; ,'Line'=&gt;$errline<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; ,'File'=&gt;$errfile<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; ,'Trace'=&gt;debug_backtrace()<br />
&nbsp;&nbsp;&nbsp; );<br />
&nbsp;&nbsp;&nbsp; <br />
}<br />
set_error_handler('catch');<br />
<br />
function badgirl(){<br />
&nbsp;&nbsp;&nbsp; if(true){ //error occure<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; trigger_error("BadGirlWithError",E_USER_NOTICE); // as throw with notice<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return; // ...because trigger_error does not stop the function<br />
&nbsp;&nbsp;&nbsp; }else{<br />
&nbsp;&nbsp; &nbsp; &nbsp; return true;<br />
&nbsp;&nbsp;&nbsp; }<br />
}<br />
<br />
// Try <br />
$GLOBALS['throw'] = null; // ...try...<br />
$sheis = badgirl(); //could be @badgirl, display_errors is something else, this just the handling<br />
// ..try<br />
if($GLOBALS['throw']){&nbsp; // This actually catch re-throws too...<br />
&nbsp;&nbsp;&nbsp; switch($GLOBALS['throw']){ // Catch<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; case 'GoodGirlException':<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; die('No bad girl today!');<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; break;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; case 'BadGirlWithError':<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; die('Bad girl has some error');<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; break;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; default:<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return; // or you can make another trigger_error and re-throw another 'exception' or some other action<br />
&nbsp;&nbsp;&nbsp; }<br />
}<br />
echo "You will never see this line - @ only supress message, not a control flow";<br />
echo "Wrong! You could see this:)";<br />
<br />
?&gt;<br />
<br />
.mano</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="39196""></a>
  <div class="note">
   <strong class="user">dzn&#039;tM@ter</strong>
   <a href="#39196" class="date">20-Jan-2004 09:05</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Some might think that trigger_error is like a throw() or an err.raise construction, and @ works like catch(){} one - in fact it's NOT.<br />
<br />
function badgirl(){<br />
&nbsp;&nbsp;&nbsp; trigger_error("shame on me",E_USER_ERROR);<br />
&nbsp;&nbsp;&nbsp; return true;<br />
}<br />
<br />
$sheis = @badgirl();<br />
echo "You will never see this line - @ only supress message, not a control flow";</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="36043""></a>
  <div class="note">
   <strong class="user">robert at klugher dot com</strong>
   <a href="#36043" class="date">23-Sep-2003 05:12</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
This one took me some time ...<br />
<br />
When you use trigger_error with your own error handler, the class instances are destroyed (don't know how to say it better, I am not an expert).<br />
<br />
So, if you try to call a class function from within the error handler function, you will get 'Call to a member function on a non-object' error, even if this function works perfectly in the rest of your script.<br />
<br />
Solution : re-use the xxx = new yyy to re-create the instance in the beginning of your error handler ... and then you can call the class functions you want !</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="34526""></a>
  <div class="note">
   <strong class="user">mail at dooley dot cjb dot net</strong>
   <a href="#34526" class="date">29-Jul-2003 07:16</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
i recently began using a custom error handling class. the biggest problem is that, with call time pass by reference deprecated, you can't manipulate the error handler class after assigning at as the error handler (and it appears not to be returned by the set_error_handler method as the old error handler). my goal was to be able to store up all my non-fatal errors and print them at the end of script execution. that way i can use 'trigger_error' (which i actually have wrapped in a static method ErrorHandler::throwException for portability purposes... which is a pain because it always has the same line number information!!) for all kinds of errors, including user input erros. so when i check a user's password, for instance i would trigger a warning that said 'incorrect password'. of course i would only want this to print out the error once the script had completed. <br />
<br />
so in my error handler class i have the following in the constructor:<br />
<br />
function ErrorHandler()<br />
{<br />
&nbsp;&nbsp;&nbsp; $this-&gt;error_messages&nbsp; = array();<br />
&nbsp;&nbsp;&nbsp; error_reporting (E_ALL);<br />
&nbsp;&nbsp;&nbsp; set_error_handler(array($this,"assignError"));<br />
}<br />
<br />
and my assignError method:<br />
//accept the required arguments<br />
function assignError($errno, $errstr, $errfile, $errline)<br />
{<br />
&nbsp;&nbsp;&nbsp; //get the error string<br />
&nbsp;&nbsp;&nbsp; $error_message = $errstr;<br />
//if in debug mode, add line number and file info<br />
&nbsp;if(ErrorHandler::DEBUG())<br />
&nbsp;$error_message .= "&lt;br&gt;".basename($errfile).",line: ".$errline;<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; switch ($errno)<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; //if the error was fatal, then add the error<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; //display an error page and exit<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; case ErrorHandler::FATAL():<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $this-&gt;setType('Fatal');<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $this-&gt;addError($error_message);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; Display::errorPage($this-&gt;errorMessages());<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; exit(1);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; break;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; //if it was an error message, add a message of<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; //type error<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; case ErrorHandler::ERROR():<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $this-&gt;setType('Error');<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $this-&gt;addError($error_message);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; break;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; //if it was a warning, add a message of type<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; //warning<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; case ErrorHandler::WARNING():<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $this-&gt;setType('Warning');<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $this-&gt;addError($error_message);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; break;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; //if it was some other code then display all<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; //the error messages that were added<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; default:<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; Display::errorRows($this-&gt;errorMessages());<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; break;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; //return a value so that the script will continue<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; //execution<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return 1;<br />
}<br />
<br />
the key part there is the 'default' behaviour. i found that if i call trigger_error with anything other than E_USER_ERROR, E_USER_WARNING or E_USER_NOTICE, then error code '2' is passed to the handler method. so when it is time to print all my non-fatal errors, like 'password and confirm password don't match' or something, i call ErrorHandler::printAllErrors()<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; function printAllErrors()<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; trigger_error("",2);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
<br />
which leads to the default behaviour in my switch statement in the assignError method above. the only problem with this is that the weird bug 'Problem with method call' that occurs with some static method calls (that one person on the bug lists said was fixed and another said wouldn't be fixed until version 5) also produces error code 2!! i have just taken to suppressing these errors with @, because despite the alledged problem with the method call, the script still seems to execute fine.<br />
<br />
iain.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="32316""></a>
  <div class="note">
   <strong class="user">someone at attbi dot com</strong>
   <a href="#32316" class="date">23-May-2003 09:24</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
the idea is never to give out file names, line numbers, and cryptic codes to the user. Use trigger_error() after you used set_error_handler() to register your own callback function which either logs or emails the error codes to you, and echo a simple friendly message to the user.
<br />

<br />
And turn on a more verbose error handler function when you need to debug your scripts. In my init.php scripts I always have:
<br />

<br />
if (_DEBUG_) {
<br />
&nbsp;&nbsp;&nbsp; set_error_handler ('debug_error_handler');
<br />
}
<br />
else {
<br />
&nbsp;&nbsp;&nbsp; set_error_handler ('nice_error_handler');
<br />
}</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="32228""></a>
  <div class="note">
   <strong class="user">sl0th at r00thell dot ath dot cx</strong>
   <a href="#32228" class="date">20-May-2003 07:25</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Well this is a good way on debuging your php scripts, but i wouldn't feel<br />
too comfortable by giving out my web servers structure.<br />
Notice that what helps you finding and isolating errors in your php helps also a potential attacker.<br />
Or maybe i am just paranoid, but its worth mention it.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="26378""></a>
  <div class="note">
   <strong class="user">ceo at l-i-e dot com</strong>
   <a href="#26378" class="date">28-Oct-2002 05:20</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
You should be using set_error_handler (possibly in conjuction with error_log and/or trigger_error) if you want FILE and LINE number information.<br />
You don't need macros for this.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
</div>
</div>
</div></div></body></html>
