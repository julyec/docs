<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
 <head>
  <meta http-equiv="content-type" content="text/html; CHARSET=UTF-8">
  <title>Zlib 函数</title>
<link media="all" rel="stylesheet" type="text/css" href="styles/03e73060321a0a848018724a6c83de7f-theme-base.css" />
<link media="all" rel="stylesheet" type="text/css" href="styles/03e73060321a0a848018724a6c83de7f-theme-medium.css" />

  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <link media="all" rel="stylesheet" type="text/css" href="style.css"/>
 </head>
 <body class="docs" class="docs"><div class="navbar navbar-fixed-top">
  <div class="navbar-inner clearfix">
    <ul class="nav" style="width: 100%">
      <li style="float: left;"><a href="zlib.examples.html">? 示例</a></li>
      <li style="float: right;"><a href="function.deflate-add.html">deflate_add ?</a></li>
    </ul>
  </div>
</div>
<div id="breadcrumbs" class="clearfix">
  <ul class="breadcrumbs-container">
    <li><a href="index.html">PHP Manual</a></li>
    <li><a href="book.zlib.html">Zlib</a></li>
    <li>Zlib 函数</li>
  </ul>
</div>
<div id="layout">
  <div id="layout-content"><div id="ref.zlib" class="reference">
 <h1 class="title">Zlib 函数</h1>

 


























































































































































<h2>Table of Contents</h2><ul class="chunklist chunklist_reference"><li><a href="function.deflate-add.html">deflate_add</a> &mdash; Incrementally deflate data</li><li><a href="function.deflate-init.html">deflate_init</a> &mdash; Initialize an incremental deflate context</li><li><a href="function.gzclose.html">gzclose</a> &mdash; Close an open gz-file pointer</li><li><a href="function.gzcompress.html">gzcompress</a> &mdash; Compress a string</li><li><a href="function.gzdecode.html">gzdecode</a> &mdash; Decodes a gzip compressed string</li><li><a href="function.gzdeflate.html">gzdeflate</a> &mdash; Deflate a string</li><li><a href="function.gzencode.html">gzencode</a> &mdash; Create a gzip compressed string</li><li><a href="function.gzeof.html">gzeof</a> &mdash; Test for EOF on a gz-file pointer</li><li><a href="function.gzfile.html">gzfile</a> &mdash; Read entire gz-file into an array</li><li><a href="function.gzgetc.html">gzgetc</a> &mdash; Get character from gz-file pointer</li><li><a href="function.gzgets.html">gzgets</a> &mdash; Get line from file pointer</li><li><a href="function.gzgetss.html">gzgetss</a> &mdash; Get line from gz-file pointer and strip HTML tags</li><li><a href="function.gzinflate.html">gzinflate</a> &mdash; Inflate a deflated string</li><li><a href="function.gzopen.html">gzopen</a> &mdash; Open gz-file</li><li><a href="function.gzpassthru.html">gzpassthru</a> &mdash; Output all remaining data on a gz-file pointer</li><li><a href="function.gzputs.html">gzputs</a> &mdash; 别名 gzwrite</li><li><a href="function.gzread.html">gzread</a> &mdash; Binary-safe gz-file read</li><li><a href="function.gzrewind.html">gzrewind</a> &mdash; Rewind the position of a gz-file pointer</li><li><a href="function.gzseek.html">gzseek</a> &mdash; Seek on a gz-file pointer</li><li><a href="function.gztell.html">gztell</a> &mdash; Tell gz-file pointer read/write position</li><li><a href="function.gzuncompress.html">gzuncompress</a> &mdash; Uncompress a compressed string</li><li><a href="function.gzwrite.html">gzwrite</a> &mdash; Binary-safe gz-file write</li><li><a href="function.inflate-add.html">inflate_add</a> &mdash; Incrementally inflate encoded data</li><li><a href="function.inflate-get-read-len.html">inflate_get_read_len</a> &mdash; Get number of bytes read so far</li><li><a href="function.inflate-get-status.html">inflate_get_status</a> &mdash; Get decompression status</li><li><a href="function.inflate-init.html">inflate_init</a> &mdash; Initialize an incremental inflate context</li><li><a href="function.readgzfile.html">readgzfile</a> &mdash; Output a gz-file</li><li><a href="function.zlib-decode.html">zlib_decode</a> &mdash; Uncompress any raw/gzip/zlib encoded data</li><li><a href="function.zlib-encode.html">zlib_encode</a> &mdash; Compress data with the specified encoding</li><li><a href="function.zlib-get-coding-type.html">zlib_get_coding_type</a> &mdash; Returns the coding type used for output compression</li></ul>
</div>
<div id="usernotes">
 <div class="head">
  <h3 class="title">User Contributed Notes</h3>
 </div>
<div id="allnotes">  <a name="82310""></a>
  <div class="note">
   <strong class="user">Robin Skoglund</strong>
   <a href="#82310" class="date">04-Apr-2008 04:39</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
ini_set('zlib.output_compression', 'On') doesn't work<br />
<br />
It says that zlib.output_compression is PHP_INI_ALL changable, but in my case at least, this is not true. When using ini_set('zlib.output_compression', 'On') runtime, phpinfo() states that zlib.output_compression is enabled, yet there is no compression.<br />
<br />
Since I don't want to enable zlib.ouput_compression for all sites in php.ini, my solution was to enable it in apache conf (.htaccess should work as well) with the line:<br />
php_flag zlib.output_compression on<br />
<br />
Just spent hours figuring this out, so I hope it helps other people.<br />
<br />
Btw, I'm using Apache/2.2.4 (Ubuntu) PHP/5.2.3-1ubuntu6.3.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="75995""></a>
  <div class="note">
   <strong class="user">Brian</strong>
   <a href="#75995" class="date">25-Jun-2007 11:58</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you have zlib.output_compression set to on when your script starts (in php.ini or via apache directive), then you disable it at runtime using ini_set() before producing output, your output will still be buffered!&nbsp; Even if you call ob_implicit_flush().<br />
<br />
If you want unbuffered output, you must disable zlib.output_compression before your script starts (as well as mod_gzip of course, if you have both installed).<br />
<br />
This behaviour experienced on Server: Apache/1.3.33 (Debian GNU/Linux) mod_gzip/1.3.26.1a PHP/4.3.10-18</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="68454""></a>
  <div class="note">
   <strong class="user">anzenews at volja dot net</strong>
   <a href="#68454" class="date">27-Jul-2006 06:59</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
php at seven dot net dot nz: <br />
Have you been using register_shutdown_function() that outputs something? If yes, some of the output was not encoded and IE6 is less than forgiving about that. In my case it was reloading the page and sometimes showing a blank page. So IE6 does get invalid stream, bug is not bogus, only description is not good enough. <br />
<br />
jpleveille at webgraphe dot com:<br />
In PHP 4.4.2 register_shutdown_function() DOES output whatever you wish, but it is not encoded with the rest of the document. Which is even worse as you get a bug that is difficult / impossible to track down.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="67942""></a>
  <div class="note">
   <strong class="user">php at seven dot net dot nz</strong>
   <a href="#67942" class="date">07-Jul-2006 01:49</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
zlib.output_compression has caused problems for me in IE 6, when pages are sometimes not displayed. This could be difficult to track down and PHP have no intention of fixing it, so hopefully you find this note in a search if it happens to you.<br />
<br />
<a href="http://bugs.php.net/bug.php?id=38026" rel="nofollow" target="_blank">http://bugs.php.net/bug.php?id=38026</a></span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="66472""></a>
  <div class="note">
   <strong class="user">Arne dot Heizmann at csr dot com</strong>
   <a href="#66472" class="date">23-May-2006 10:34</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
PHP Version 5.1.4 here. What Bob said is correct even in this version (newest at the time of writing). You can't enable zlib.output_compression via ini_set(). You have to use php.ini.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="56917""></a>
  <div class="note">
   <strong class="user">Bob</strong>
   <a href="#56917" class="date">19-Sep-2005 06:45</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Contrary to what the documentation says, I've been unable to get zlib.output_compression to work via ini_set() (Even though I put it at the very beginning of the file before any output was sent) as of php 4.3.11.&nbsp; While it does get set to true, it will not actually do anything. Which means if you don't set this via php.ini or Apache configuration it's a no-go. I have to use ob_start("ob_gzhandler"); instead.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="56216""></a>
  <div class="note">
   <strong class="user">djmaze(AT)dragonflycms(.)org</strong>
   <a href="#56216" class="date">27-Aug-2005 08:27</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you need to compress data and send it as "Content-disposition: attachment" and on-the-fly to the client due to the size for example (40Mb) here's a dirty trick using ob_gzhandler()<br />
<br />
Keep in mind that $str is the content to output.<br />
<br />
When you start the output call<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">echo </span><span class="default">ob_gzhandler</span><span class="keyword">(</span><span class="default">$str</span><span class="keyword">, </span><span class="default">PHP_OUTPUT_HANDLER_START</span><span class="keyword">);<br />
</span><span class="default">?&gt;<br />
</span><br />
Then to output any further content<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">echo </span><span class="default">ob_gzhandler</span><span class="keyword">(</span><span class="default">$str</span><span class="keyword">, </span><span class="default">PHP_OUTPUT_HANDLER_CONT</span><span class="keyword">);<br />
</span><span class="default">?&gt;<br />
</span><br />
And to close the output<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">echo </span><span class="default">ob_gzhandler</span><span class="keyword">(</span><span class="string">''</span><span class="keyword">, </span><span class="default">PHP_OUTPUT_HANDLER_END</span><span class="keyword">);<br />
exit;<br />
</span><span class="default">?&gt;<br />
</span><br />
Only tested on Apache 1.3.33 with PHP 5.0.4</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="54412""></a>
  <div class="note">
   <strong class="user">ghassler at speakeasy dot net</strong>
   <a href="#54412" class="date">03-Jul-2005 09:45</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I tested all the compression levels against a 22k page and here are the results I got (in bytes):<br />
<br />
off = 22549<br />
1 = 4297<br />
2 = 4279<br />
3 = 4264<br />
4 = 4117<br />
5 = 4097<br />
6 = 4063<br />
7 = 4011<br />
8 = 3998<br />
9 = 3996<br />
<br />
Looks like the best bets for zlib.output_compression_level is 1 or 5.&nbsp; The default of 6 is probably OK too.&nbsp; Don't know what the CPU usage difference is between them all though.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="53722""></a>
  <div class="note">
   <strong class="user">jpleveille at webgraphe dot com</strong>
   <a href="#53722" class="date">10-Jun-2005 06:08</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
register_shutdown_function() (<a href="http://www.php.net/register_shutdown_function" rel="nofollow" target="_blank">http://www.php.net/register_shutdown_function</a>) won't output anything if you use zlib.output_compression.<br />
<br />
Shutdown function is called after closing all opened output buffers thus, for example, its output will not be compressed if zlib.output_compression is enabled.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="46366""></a>
  <div class="note">
   <strong class="user">admin_at_commandline_dot_ch</strong>
   <a href="#46366" class="date">08-Oct-2004 05:32</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
My gzip function.<br />
<br />
This function read, compress and writhe only small chunks at one time, this way you can compress big files without memory problems...<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">function </span><span class="default">gzip</span><span class="keyword">(</span><span class="default">$src</span><span class="keyword">, </span><span class="default">$level </span><span class="keyword">= </span><span class="default">5</span><span class="keyword">, </span><span class="default">$dst </span><span class="keyword">= </span><span class="default">false</span><span class="keyword">){<br />
&nbsp;&nbsp;&nbsp; if(</span><span class="default">$dst </span><span class="keyword">== </span><span class="default">false</span><span class="keyword">){<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$dst </span><span class="keyword">= </span><span class="default">$src</span><span class="keyword">.</span><span class="string">".gz"</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; if(</span><span class="default">file_exists</span><span class="keyword">(</span><span class="default">$src</span><span class="keyword">)){<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$filesize </span><span class="keyword">= </span><span class="default">filesize</span><span class="keyword">(</span><span class="default">$src</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$src_handle </span><span class="keyword">= </span><span class="default">fopen</span><span class="keyword">(</span><span class="default">$src</span><span class="keyword">, </span><span class="string">"r"</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if(!</span><span class="default">file_exists</span><span class="keyword">(</span><span class="default">$dst</span><span class="keyword">)){<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$dst_handle </span><span class="keyword">= </span><span class="default">gzopen</span><span class="keyword">(</span><span class="default">$dst</span><span class="keyword">, </span><span class="string">"w</span><span class="default">$level</span><span class="string">"</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; while(!</span><span class="default">feof</span><span class="keyword">(</span><span class="default">$src_handle</span><span class="keyword">)){<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$chunk </span><span class="keyword">= </span><span class="default">fread</span><span class="keyword">(</span><span class="default">$src_handle</span><span class="keyword">, </span><span class="default">2048</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">gzwrite</span><span class="keyword">(</span><span class="default">$dst_handle</span><span class="keyword">, </span><span class="default">$chunk</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">fclose</span><span class="keyword">(</span><span class="default">$src_handle</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">gzclose</span><span class="keyword">(</span><span class="default">$dst_handle</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">true</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; } else {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">error_log</span><span class="keyword">(</span><span class="string">"</span><span class="default">$dst</span><span class="string"> already exists"</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; } else {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">error_log</span><span class="keyword">(</span><span class="string">"</span><span class="default">$src</span><span class="string"> doesn't exist"</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">false</span><span class="keyword">;<br />
}<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="44059""></a>
  <div class="note">
   <strong class="user">gem at rellim dot com</strong>
   <a href="#44059" class="date">13-Jul-2004 08:03</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Run, do not walk, run, to add this to your Apache config file:<br />
<br />
php_flag zlib.output_compression On<br />
php_value zlib.output_compression_level 5<br />
<br />
I just tried this and achieved 10x and 15x speed inprovement on<br />
some mature php pages.&nbsp; Pages I have been seating over to make 5% gains on.&nbsp; I use microtime() on critical pages to help me track page speed and that confirms the speed improvement.&nbsp; The php page takes a timestamp at the beginning and end, then logs the page duration.&nbsp; So any IP transmission effects are not included.&nbsp; There is<br />
a clear subjective difference to the user.<br />
<br />
The test system was PHP 4.3.6, Apache 2.0.49 over Linux 2.4.<br />
As always YMMV.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="43181""></a>
  <div class="note">
   <strong class="user">zigazou at free dot fr</strong>
   <a href="#43181" class="date">12-Jun-2004 03:44</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you use "zlib.output_compression = On" in your php.ini file, and activates output buffering (ob_start), don't output this header :<br />
header('Content-Length: '.ob_get_length());<br />
<br />
This is because ob_get_length() will return the uncompressed size while zlib will compress the output. Thus your browser will get confused waiting for extra data that will never come.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="42946""></a>
  <div class="note">
   <strong class="user">xorinox at tiscali dot ch</strong>
   <a href="#42946" class="date">04-Jun-2004 07:52</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Have a look to this extended version :)<br />
<br />
<span class="default">&lt;?php<br />
<br />
</span><span class="keyword">function </span><span class="default">compress</span><span class="keyword">( </span><span class="default">$srcFileName</span><span class="keyword">, </span><span class="default">$dstFileName </span><span class="keyword">)<br />
{<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// getting file content<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$fp </span><span class="keyword">= </span><span class="default">fopen</span><span class="keyword">( </span><span class="default">$srcFileName</span><span class="keyword">, </span><span class="string">"r" </span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$data </span><span class="keyword">= </span><span class="default">fread </span><span class="keyword">( </span><span class="default">$fp</span><span class="keyword">, </span><span class="default">filesize</span><span class="keyword">( </span><span class="default">$srcFileName </span><span class="keyword">) );<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">fclose</span><span class="keyword">( </span><span class="default">$fp </span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// writing compressed file<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$zp </span><span class="keyword">= </span><span class="default">gzopen</span><span class="keyword">( </span><span class="default">$dstFileName</span><span class="keyword">, </span><span class="string">"w9" </span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">gzwrite</span><span class="keyword">( </span><span class="default">$zp</span><span class="keyword">, </span><span class="default">$data </span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">gzclose</span><span class="keyword">( </span><span class="default">$zp </span><span class="keyword">);<br />
}<br />
<br />
function </span><span class="default">uncompress</span><span class="keyword">( </span><span class="default">$srcFileName</span><span class="keyword">, </span><span class="default">$dstFileName</span><span class="keyword">, </span><span class="default">$fileSize </span><span class="keyword">)<br />
{<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// getting content of the compressed file<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$zp </span><span class="keyword">= </span><span class="default">gzopen</span><span class="keyword">( </span><span class="default">$srcFileName</span><span class="keyword">, </span><span class="string">"r" </span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$data </span><span class="keyword">= </span><span class="default">fread </span><span class="keyword">( </span><span class="default">$zp</span><span class="keyword">, </span><span class="default">$fileSize </span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">gzclose</span><span class="keyword">( </span><span class="default">$zp </span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// writing uncompressed file<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$fp </span><span class="keyword">= </span><span class="default">fopen</span><span class="keyword">( </span><span class="default">$dstFileName</span><span class="keyword">, </span><span class="string">"w" </span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">fwrite</span><span class="keyword">( </span><span class="default">$fp</span><span class="keyword">, </span><span class="default">$data </span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">fclose</span><span class="keyword">( </span><span class="default">$fp </span><span class="keyword">);<br />
}<br />
<br />
</span><span class="default">compress</span><span class="keyword">( </span><span class="string">"tmp/supportkonzept.rtf"</span><span class="keyword">, </span><span class="string">"tmp/_supportkonzept.rtf.gz" </span><span class="keyword">);<br />
</span><span class="default">uncompress</span><span class="keyword">( </span><span class="string">"tmp/_supportkonzept.rtf.gz"</span><span class="keyword">, </span><span class="string">"tmp/_supportkonzept.rtf"</span><span class="keyword">, </span><span class="default">filesize</span><span class="keyword">( </span><span class="string">"tmp/supportkonzept.rtf" </span><span class="keyword">) );<br />
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="42540""></a>
  <div class="note">
   <strong class="user">ec10 at gmx dot net</strong>
   <a href="#42540" class="date">20-May-2004 11:38</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
/**<br />
&nbsp;* @return bool<br />
&nbsp;* @param string $in<br />
&nbsp;* @param string $out<br />
&nbsp;* @param string $param = "1"<br />
&nbsp;* @desc compressing the file with the zlib-extension<br />
*/<br />
function gzip ($in, $out, $param="1")<br />
{<br />
&nbsp;&nbsp;&nbsp; if (!file_exists ($in) || !is_readable ($in))<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return false;<br />
&nbsp;&nbsp;&nbsp; if ((!file_exists ($out) &amp;&amp; !is_writable (dirname ($out)) || (file_exists($out) &amp;&amp; !is_writable($out)) ))<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return false;<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; $in_file = fopen ($in, "rb");<br />
&nbsp;&nbsp;&nbsp; if (!$out_file = gzopen ($out, "wb".$param)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return false;<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; while (!feof ($in_file)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $buffer = fgets ($in_file, 4096);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; gzwrite ($out_file, $buffer, 4096);<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp;&nbsp; fclose ($in_file);<br />
&nbsp;&nbsp;&nbsp; gzclose ($out_file);<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; return true;<br />
}<br />
<br />
/**<br />
&nbsp;* @return bool<br />
&nbsp;* @param string $in<br />
&nbsp;* @param string $out<br />
&nbsp;* @desc uncompressing the file with the zlib-extension<br />
*/<br />
function gunzip ($in, $out)<br />
{<br />
&nbsp;&nbsp;&nbsp; if (!file_exists ($in) || !is_readable ($in))<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return false;<br />
&nbsp;&nbsp;&nbsp; if ((!file_exists ($out) &amp;&amp; !is_writable (dirname ($out)) || (file_exists($out) &amp;&amp; !is_writable($out)) ))<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return false;<br />
<br />
&nbsp;&nbsp;&nbsp; $in_file = gzopen ($in, "rb");<br />
&nbsp;&nbsp;&nbsp; $out_file = fopen ($out, "wb");<br />
<br />
&nbsp;&nbsp;&nbsp; while (!gzeof ($in_file)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $buffer = gzread ($in_file, 4096);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; fwrite ($out_file, $buffer, 4096);<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;<br />
&nbsp;&nbsp;&nbsp; gzclose ($in_file);<br />
&nbsp;&nbsp;&nbsp; fclose ($out_file);<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; return true;<br />
}</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="42374""></a>
  <div class="note">
   <strong class="user">spam at wildpeaks dot com</strong>
   <a href="#42374" class="date">13-May-2004 07:04</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
For decompressing, i modified a function posted earlier (that way $string doesn't have a big size that may be beyond the memory limit if the gzipped file is big) :<br />
<br />
function file_ungzip($fromFile, $toFile) {<br />
&nbsp;&nbsp;&nbsp; $zp = @gzopen($fromFile, "r");<br />
&nbsp;&nbsp;&nbsp; $fp = @fopen($toFile, "w");<br />
&nbsp;&nbsp;&nbsp; while(!@gzeof($zp)) {$string = @gzread($zp, 4096); @fwrite($fp, $string, strlen($string));}<br />
&nbsp;&nbsp;&nbsp; @gzclose($zp);<br />
&nbsp;&nbsp;&nbsp; @fclose($fp);<br />
}</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="37482""></a>
  <div class="note">
   <strong class="user">thivierr at telus dot net</strong>
   <a href="#37482" class="date">17-Nov-2003 04:02</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I found the absolute easiest way to read a gzip file is as follows:<br />
<br />
echo file_get_contents("compress.zlib:///myphp/test.txt.gz");<br />
<br />
To create a gzip file:<br />
file_put_contents("compress.zlib:///myphp/test.txt.gz","Put this in the file\r\n");<br />
<br />
Things to note about this:<br />
-The best prefix to use is "compress.zlib", not "zlib"<br />
-If you wish to specify a path starting in the root path, you actually end up with three slashes.&nbsp; The above path corresponds to "/myphp/test.txt" on unix, and "c:\myphp\test.txt" on Windows (if C: is the current drive).&nbsp; I tested it just on Windows.<br />
-Compression and decompression both use the same prefix of "compress.zlib://" (plus one more slash to get a root dir).<br />
-I'm using 5.0, so I'm not 100% sure which behaviour started in which version.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="32441""></a>
  <div class="note">
   <strong class="user">chris at mad-teaparty dot com</strong>
   <a href="#32441" class="date">27-May-2003 05:10</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Nice function. I did it the other way round:<br />
<br />
function uncompress($srcName, $dstName) {<br />
&nbsp;&nbsp; $zp = gzopen($srcName, "r");<br />
&nbsp;&nbsp; while(!gzeof($zp))<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $string .= gzread($zp, 4096);<br />
&nbsp;&nbsp; gzclose($zp);<br />
<br />
&nbsp;&nbsp; $fp = fopen($dstName, "w");<br />
&nbsp;&nbsp; fwrite($fp, $string, strlen($string));<br />
&nbsp;&nbsp; fclose($fp);<br />
}<br />
<br />
uncompress("./myfile.txt.gz", "./myfile.txt");<br />
<br />
A shorter approach would be:<br />
<br />
function uncompress($srcName, $dstName) {<br />
&nbsp; $string = implode("", gzfile($srcName));<br />
&nbsp; $fp = fopen($dstName, "w");<br />
&nbsp; fwrite($fp, $string, strlen($string));<br />
&nbsp; fclose($fp);<br />
}</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="29412""></a>
  <div class="note">
   <strong class="user">mlevy at rgj dot com</strong>
   <a href="#29412" class="date">12-Feb-2003 02:06</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you turn zlib.output_compression_level on, be advised that you shouldn't try to flush() the output in your scripts. PHP will add the gzip header but send the output uncompressed, which plays havoc with Mozilla. IE seems to handle it, though.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="12522""></a>
  <div class="note">
   <strong class="user">monte at ispi dot net</strong>
   <a href="#12522" class="date">18-Apr-2001 06:02</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
An alternate way to handle gzip compression is to let the mod_gzip module of apache handle it. This seems to contradict the tutorial on phpbuilder.com saying that it won't compress php (or any dynamic) output, but mod_gzip as of version 1.3.17.1a works well for me.
<br />

<br />
Here is an example of an httpd.conf setup:
<br />

<br />
&lt;IfModule mod_gzip.c&gt;
<br />
mod_gzip_on&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; Yes
<br />
mod_gzip_dechunk&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Yes
<br />
mod_gzip_minimum_file_size&nbsp; 300
<br />
mod_gzip_maximum_file_size&nbsp; 0
<br />
mod_gzip_maximum_inmem_size 100000
<br />
mod_gzip_keep_workfiles&nbsp; &nbsp;&nbsp; No
<br />
mod_gzip_temp_dir&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; /tmp
<br />
mod_gzip_item_include&nbsp; &nbsp; &nbsp;&nbsp; file \.html$
<br />
mod_gzip_item_include&nbsp; &nbsp; &nbsp;&nbsp; file \.jsp$
<br />
mod_gzip_item_include&nbsp; &nbsp; &nbsp;&nbsp; file \.php$
<br />
mod_gzip_item_include&nbsp; &nbsp; &nbsp;&nbsp; file \.pl$
<br />
mod_gzip_item_include&nbsp; &nbsp; &nbsp;&nbsp; mime ^text/.*
<br />
mod_gzip_item_include&nbsp; &nbsp; &nbsp;&nbsp; mime ^application/x-httpd-php
<br />
mod_gzip_item_include&nbsp; &nbsp; &nbsp;&nbsp; mime ^httpd/unix-directory$
<br />
mod_gzip_item_include&nbsp; &nbsp; &nbsp;&nbsp; handler ^perl-script$
<br />
mod_gzip_item_include&nbsp; &nbsp; &nbsp;&nbsp; handler ^server-status$
<br />
mod_gzip_item_include&nbsp; &nbsp; &nbsp;&nbsp; handler ^server-info$
<br />
mod_gzip_item_exclude&nbsp; &nbsp; &nbsp;&nbsp; mime ^image/.*
<br />
&lt;/IfModule&gt;
<br />

<br />
This will automatically compress all output of your files with the .php extention or the x-httpd-php mime type. Be sure to have dechunk set to Yes.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
</div>
</div>
</div></div></body></html>
