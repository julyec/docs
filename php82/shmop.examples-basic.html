<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
 <head>
  <meta http-equiv="content-type" content="text/html; CHARSET=UTF-8">
  <title>Basic usage</title>
<link media="all" rel="stylesheet" type="text/css" href="styles/03e73060321a0a848018724a6c83de7f-theme-base.css" />
<link media="all" rel="stylesheet" type="text/css" href="styles/03e73060321a0a848018724a6c83de7f-theme-medium.css" />

  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <link media="all" rel="stylesheet" type="text/css" href="style.css"/>
 </head>
 <body class="docs" class="docs"><div class="navbar navbar-fixed-top">
  <div class="navbar-inner clearfix">
    <ul class="nav" style="width: 100%">
      <li style="float: left;"><a href="shmop.examples.html">? 示例</a></li>
      <li style="float: right;"><a href="ref.shmop.html">Shared Memory 函数 ?</a></li>
    </ul>
  </div>
</div>
<div id="breadcrumbs" class="clearfix">
  <ul class="breadcrumbs-container">
    <li><a href="index.html">PHP Manual</a></li>
    <li><a href="shmop.examples.html">示例</a></li>
    <li>Basic usage</li>
  </ul>
</div>
<div id="layout">
  <div id="layout-content"><div id="shmop.examples-basic" class="section">
  <h2 class="title">Basic usage</h2>
  <p class="para">
   <div class="example" id="">
    <p><strong>Example #1 Shared Memory Operations Overview</strong></p> 
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br />   <br /></span><span style="color: #FF8000">// Create 100 byte shared memory block with system id of 0xff3<br /></span><span style="color: #0000BB">$shm_id </span><span style="color: #007700">= </span><span style="color: #0000BB">shmop_open</span><span style="color: #007700">(</span><span style="color: #0000BB">0xff3</span><span style="color: #007700">, </span><span style="color: #DD0000">"c"</span><span style="color: #007700">, </span><span style="color: #0000BB">0644</span><span style="color: #007700">, </span><span style="color: #0000BB">100</span><span style="color: #007700">);<br />if (!</span><span style="color: #0000BB">$shm_id</span><span style="color: #007700">) {<br />    echo </span><span style="color: #DD0000">"Couldn't create shared memory segment\n"</span><span style="color: #007700">;<br />}<br /><br /></span><span style="color: #FF8000">// Get shared memory block's size<br /></span><span style="color: #0000BB">$shm_size </span><span style="color: #007700">= </span><span style="color: #0000BB">shmop_size</span><span style="color: #007700">(</span><span style="color: #0000BB">$shm_id</span><span style="color: #007700">);<br />echo </span><span style="color: #DD0000">"SHM Block Size: " </span><span style="color: #007700">. </span><span style="color: #0000BB">$shm_size </span><span style="color: #007700">. </span><span style="color: #DD0000">" has been created.\n"</span><span style="color: #007700">;<br /><br /></span><span style="color: #FF8000">// Lets write a test string into shared memory<br /></span><span style="color: #0000BB">$shm_bytes_written </span><span style="color: #007700">= </span><span style="color: #0000BB">shmop_write</span><span style="color: #007700">(</span><span style="color: #0000BB">$shm_id</span><span style="color: #007700">, </span><span style="color: #DD0000">"my shared memory block"</span><span style="color: #007700">, </span><span style="color: #0000BB">0</span><span style="color: #007700">);<br />if (</span><span style="color: #0000BB">$shm_bytes_written </span><span style="color: #007700">!= </span><span style="color: #0000BB">strlen</span><span style="color: #007700">(</span><span style="color: #DD0000">"my shared memory block"</span><span style="color: #007700">)) {<br />    echo </span><span style="color: #DD0000">"Couldn't write the entire length of data\n"</span><span style="color: #007700">;<br />}<br /><br /></span><span style="color: #FF8000">// Now lets read the string back<br /></span><span style="color: #0000BB">$my_string </span><span style="color: #007700">= </span><span style="color: #0000BB">shmop_read</span><span style="color: #007700">(</span><span style="color: #0000BB">$shm_id</span><span style="color: #007700">, </span><span style="color: #0000BB">0</span><span style="color: #007700">, </span><span style="color: #0000BB">$shm_size</span><span style="color: #007700">);<br />if (!</span><span style="color: #0000BB">$my_string</span><span style="color: #007700">) {<br />    echo </span><span style="color: #DD0000">"Couldn't read from shared memory block\n"</span><span style="color: #007700">;<br />}<br />echo </span><span style="color: #DD0000">"The data inside shared memory was: " </span><span style="color: #007700">. </span><span style="color: #0000BB">$my_string </span><span style="color: #007700">. </span><span style="color: #DD0000">"\n"</span><span style="color: #007700">;<br /><br /></span><span style="color: #FF8000">//Now lets delete the block and close the shared memory segment<br /></span><span style="color: #007700">if (!</span><span style="color: #0000BB">shmop_delete</span><span style="color: #007700">(</span><span style="color: #0000BB">$shm_id</span><span style="color: #007700">)) {<br />    echo </span><span style="color: #DD0000">"Couldn't mark shared memory block for deletion."</span><span style="color: #007700">;<br />}<br /></span><span style="color: #0000BB">shmop_close</span><span style="color: #007700">(</span><span style="color: #0000BB">$shm_id</span><span style="color: #007700">);<br />   <br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
    </div>

   </div>
  </p>
 </div><div id="usernotes">
 <div class="head">
  <h3 class="title">User Contributed Notes</h3>
 </div>
<div id="allnotes">  <a name="122241""></a>
  <div class="note">
   <strong class="user">Anonymous</strong>
   <a href="#122241" class="date">08-Jan-2018 02:27</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Simple class for SHMOP implementation.<br />
<br />
# Warning #<br />
<br />
You can write/read only one direction. If you try read and write at the same time you get corrupt data. (Its works like STD in/out)<br />
If you need bi-directional communication create 2 instance of shmop class.<br />
Don't try attach more than one readers or writers for some shmid, you get corrupt data. This class use kludged spinlocks for improve speed, and not real atomic operations. You can add semaphore with flock, but it very slow. (~x3)<br />
<br />
Benchmark:<br />
<br />
Reads per sec: 6316 Data size per sec: 6.17 gb<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="comment">########################<br />
# shmopwriter.php<br />
########################<br />
<br />
</span><span class="default">$blockSize </span><span class="keyword">= </span><span class="default">1024 </span><span class="keyword">* </span><span class="default">1024 </span><span class="keyword">* </span><span class="default">100</span><span class="keyword">;<br />
</span><span class="default">$data </span><span class="keyword">= </span><span class="default">random_bytes</span><span class="keyword">(</span><span class="default">$blockSize</span><span class="keyword">);<br />
<br />
try<br />
{<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$shm </span><span class="keyword">= new </span><span class="default">SHMOP</span><span class="keyword">(</span><span class="string">'shmopwriter.php'</span><span class="keyword">, </span><span class="string">'c'</span><span class="keyword">, </span><span class="default">644</span><span class="keyword">, </span><span class="default">$blockSize</span><span class="keyword">);<br />
<br />
&nbsp;&nbsp;&nbsp; while(</span><span class="default">1</span><span class="keyword">)<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if(!</span><span class="default">$shm</span><span class="keyword">-&gt;</span><span class="default">canWrite</span><span class="keyword">())<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; continue;<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$shm</span><span class="keyword">-&gt;</span><span class="default">write</span><span class="keyword">(</span><span class="default">$data</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$shm</span><span class="keyword">-&gt;</span><span class="default">close</span><span class="keyword">();<br />
<br />
} catch (</span><span class="default">Exception $e</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; echo </span><span class="string">'Error: '</span><span class="keyword">,&nbsp; </span><span class="default">$e</span><span class="keyword">-&gt;</span><span class="default">getMessage</span><span class="keyword">(), </span><span class="default">PHP_EOL</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; exit;<br />
}<br />
<br />
</span><span class="comment">########################<br />
<br />
########################<br />
# shmopreader.php<br />
########################<br />
<br />
</span><span class="default">$blockSize </span><span class="keyword">= </span><span class="default">1024 </span><span class="keyword">* </span><span class="default">1024 </span><span class="keyword">* </span><span class="default">100</span><span class="keyword">;<br />
</span><span class="default">$shm </span><span class="keyword">= new </span><span class="default">SHMOP</span><span class="keyword">(</span><span class="string">'shmopwriter.php'</span><span class="keyword">, </span><span class="string">'c'</span><span class="keyword">, </span><span class="default">644</span><span class="keyword">, </span><span class="default">$blockSize</span><span class="keyword">);<br />
</span><span class="default">$readsMT </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;<br />
</span><span class="default">$readsPS </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;<br />
<br />
while(!</span><span class="default">$shm</span><span class="keyword">-&gt;</span><span class="default">eof</span><span class="keyword">())<br />
{<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$times </span><span class="keyword">= </span><span class="default">microtime</span><span class="keyword">(</span><span class="default">true</span><span class="keyword">);<br />
<br />
&nbsp;&nbsp;&nbsp; if((</span><span class="default">$data </span><span class="keyword">= </span><span class="default">$shm</span><span class="keyword">-&gt;</span><span class="default">read</span><span class="keyword">()) === </span><span class="default">false</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; continue;<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$readsPS</span><span class="keyword">++;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$readsMT </span><span class="keyword">+= </span><span class="default">round</span><span class="keyword">(((</span><span class="default">microtime</span><span class="keyword">(</span><span class="default">true</span><span class="keyword">) - </span><span class="default">$times </span><span class="keyword">) * </span><span class="default">1000</span><span class="keyword">), </span><span class="default">3</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; if(</span><span class="default">$readsMT </span><span class="keyword">&gt; </span><span class="default">1000</span><span class="keyword">)<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="string">'Reads per sec: '</span><span class="keyword">, </span><span class="default">$readsPS</span><span class="keyword">, </span><span class="string">' Data size per sec: '</span><span class="keyword">, </span><span class="default">convert</span><span class="keyword">(</span><span class="default">$blockSize </span><span class="keyword">* </span><span class="default">$readsPS</span><span class="keyword">), </span><span class="default">PHP_EOL</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$readsPS </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$readsMT </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
}<br />
<br />
function </span><span class="default">convert</span><span class="keyword">(</span><span class="default">$size</span><span class="keyword">)<br />
{<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$unit</span><span class="keyword">=array(</span><span class="string">'b'</span><span class="keyword">,</span><span class="string">'kb'</span><span class="keyword">,</span><span class="string">'mb'</span><span class="keyword">,</span><span class="string">'gb'</span><span class="keyword">,</span><span class="string">'tb'</span><span class="keyword">,</span><span class="string">'pb'</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; return @</span><span class="default">round</span><span class="keyword">(</span><span class="default">$size</span><span class="keyword">/</span><span class="default">pow</span><span class="keyword">(</span><span class="default">1024</span><span class="keyword">,(</span><span class="default">$i</span><span class="keyword">=</span><span class="default">floor</span><span class="keyword">(</span><span class="default">log</span><span class="keyword">(</span><span class="default">$size</span><span class="keyword">,</span><span class="default">1024</span><span class="keyword">)))),</span><span class="default">2</span><span class="keyword">).</span><span class="string">' '</span><span class="keyword">.</span><span class="default">$unit</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">];<br />
}<br />
</span><span class="comment">########################<br />
<br />
########################<br />
# shmop.class.php<br />
########################<br />
<br />
</span><span class="keyword">class </span><span class="default">SHMOP<br />
</span><span class="keyword">{<br />
&nbsp;&nbsp;&nbsp; private </span><span class="default">$shmId</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; private </span><span class="default">$shmHeaderSize</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; private </span><span class="default">$shmHeaderOffset</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; private </span><span class="default">$shmBlockSize</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; private </span><span class="default">$shmMaxBlockSize</span><span class="keyword">;<br />
<br />
&nbsp;&nbsp;&nbsp; function </span><span class="default">__construct</span><span class="keyword">(</span><span class="default">string $pathname</span><span class="keyword">, </span><span class="default">string $flags</span><span class="keyword">, </span><span class="default">int $mode</span><span class="keyword">, </span><span class="default">int $size</span><span class="keyword">)<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">shmHeaderSize </span><span class="keyword">= </span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$size</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">shmHeaderOffset </span><span class="keyword">= </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">shmHeaderSize </span><span class="keyword">+ </span><span class="default">1</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">shmMaxBlockSize </span><span class="keyword">= </span><span class="default">$size</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">shmBlockSize </span><span class="keyword">= </span><span class="default">$size </span><span class="keyword">+ </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">shmHeaderOffset </span><span class="keyword">+ </span><span class="default">1</span><span class="keyword">;<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">shmId </span><span class="keyword">= </span><span class="default">shmop_open</span><span class="keyword">(</span><span class="default">ftok</span><span class="keyword">(</span><span class="default">$pathname</span><span class="keyword">, </span><span class="string">'s'</span><span class="keyword">), </span><span class="default">$flags</span><span class="keyword">, </span><span class="default">$mode</span><span class="keyword">, </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">shmBlockSize</span><span class="keyword">);<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if(!</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">shmId</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; throw new </span><span class="default">Exception</span><span class="keyword">(</span><span class="string">'shmop_open error'</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; function </span><span class="default">__destruct</span><span class="keyword">()<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if(!</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">shmId</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return;<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">close</span><span class="keyword">();<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; public function </span><span class="default">read</span><span class="keyword">()<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// Check SpinLock<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">if(</span><span class="default">shmop_read</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">shmId</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">) === </span><span class="string">"\0"</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">false</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// Get Header<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$dataSize </span><span class="keyword">= (int)</span><span class="default">shmop_read</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">shmId</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">, </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">shmHeaderSize</span><span class="keyword">);<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$data </span><span class="keyword">= </span><span class="default">shmop_read</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">shmId</span><span class="keyword">, </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">shmHeaderOffset</span><span class="keyword">, </span><span class="default">$dataSize</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// release spinlock<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">shmop_write</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">shmId</span><span class="keyword">, </span><span class="string">"\0"</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">$data</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; public function </span><span class="default">write</span><span class="keyword">(</span><span class="default">string $data</span><span class="keyword">)<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// Check SpinLock<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">if(</span><span class="default">shmop_read</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">shmId</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">) !== </span><span class="string">"\0"</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">false</span><span class="keyword">;<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$dataSize </span><span class="keyword">= </span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$data</span><span class="keyword">);<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">$dataSize </span><span class="keyword">&lt; </span><span class="default">1</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; throw new </span><span class="default">Exception</span><span class="keyword">(</span><span class="string">'dataSize &lt; 1'</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">$dataSize </span><span class="keyword">&gt; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">shmMaxBlockSize</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; throw new </span><span class="default">Exception</span><span class="keyword">(</span><span class="string">'dataSize &gt; shmMaxBlockSize: '</span><span class="keyword">. </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">shmMaxBlockSize</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// pack very slow use kludge<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$dataSize </span><span class="keyword">.= </span><span class="string">"\0"</span><span class="keyword">;<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// Write Header<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">shmop_write</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">shmId</span><span class="keyword">, </span><span class="default">$dataSize</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// Write Data<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">shmop_write</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">shmId</span><span class="keyword">, </span><span class="default">$data</span><span class="keyword">, </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">shmHeaderOffset</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// Write spinlock<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">shmop_write</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">shmId</span><span class="keyword">, </span><span class="string">"\1"</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">true</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp;&nbsp; public function </span><span class="default">eof</span><span class="keyword">()<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return (</span><span class="default">shmop_read</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">shmId</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">) === </span><span class="string">"\2"</span><span class="keyword">) ? </span><span class="default">true </span><span class="keyword">: </span><span class="default">false</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; public function </span><span class="default">sendeof</span><span class="keyword">()<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// Check SpinLock<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">if(</span><span class="default">shmop_read</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">shmId</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">) !== </span><span class="string">"\0"</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">false</span><span class="keyword">;<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">shmop_write</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">shmId</span><span class="keyword">, </span><span class="string">"\2"</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">true</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; public function </span><span class="default">canWrite</span><span class="keyword">()<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// Check SpinLock<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">return (</span><span class="default">shmop_read</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">shmId</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">) === </span><span class="string">"\0"</span><span class="keyword">) ? </span><span class="default">true </span><span class="keyword">: </span><span class="default">false</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; public function </span><span class="default">close</span><span class="keyword">()<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return @</span><span class="default">shmop_close</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">shmId</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp;&nbsp; private function </span><span class="default">delete</span><span class="keyword">()<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$del </span><span class="keyword">= @</span><span class="default">shmop_delete</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">shmId</span><span class="keyword">);<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">$del </span><span class="keyword">=== </span><span class="default">false</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">false</span><span class="keyword">;<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return @</span><span class="default">shmop_close</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">shmId</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }<br />
}<br />
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
</div>
</div>
</div></div></body></html>
