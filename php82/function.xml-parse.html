<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
 <head>
  <meta http-equiv="content-type" content="text/html; CHARSET=UTF-8">
  <title>开始解析 XML 文档</title>
<link media="all" rel="stylesheet" type="text/css" href="styles/03e73060321a0a848018724a6c83de7f-theme-base.css" />
<link media="all" rel="stylesheet" type="text/css" href="styles/03e73060321a0a848018724a6c83de7f-theme-medium.css" />

  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <link media="all" rel="stylesheet" type="text/css" href="style.css"/>
 </head>
 <body class="docs" class="docs"><div class="navbar navbar-fixed-top">
  <div class="navbar-inner clearfix">
    <ul class="nav" style="width: 100%">
      <li style="float: left;"><a href="function.xml-parse-into-struct.html">? xml_parse_into_struct</a></li>
      <li style="float: right;"><a href="function.xml-parser-create-ns.html">xml_parser_create_ns ?</a></li>
    </ul>
  </div>
</div>
<div id="breadcrumbs" class="clearfix">
  <ul class="breadcrumbs-container">
    <li><a href="index.html">PHP Manual</a></li>
    <li><a href="ref.xml.html">XML 解析器函数</a></li>
    <li>开始解析 XML 文档</li>
  </ul>
</div>
<div id="layout">
  <div id="layout-content"><div id="function.xml-parse" class="refentry">
 <div class="refnamediv">
  <h1 class="refname">xml_parse</h1>
  <p class="verinfo">(PHP 4, PHP 5, PHP 7, PHP 8)</p><p class="refpurpose"><span class="refname">xml_parse</span> &mdash; <span class="dc-title">开始解析 XML 文档</span></p>

 </div>

 <div class="refsect1 description" id="refsect1-function.xml-parse-description">
  <h3 class="title">说明</h3>
  <div class="methodsynopsis dc-description">
   <span class="methodname"><strong>xml_parse</strong></span>(<span class="methodparam"><span class="type"><a href="class.xmlparser.html" class="type XMLParser">XMLParser</a></span> <code class="parameter">$parser</code></span>, <span class="methodparam"><span class="type">string</span> <code class="parameter">$data</code></span>, <span class="methodparam"><span class="type">bool</span> <code class="parameter">$is_final</code><span class="initializer"> = <strong><code>false</code></strong></span></span>): <span class="type">int</span></div>

  <p class="para rdfs-comment">
   <span class="function"><strong>xml_parse()</strong></span> 解析 XML 文档。已配置事件的处理程序根据需要被无限次调用。
  </p>
 </div>


 <div class="refsect1 parameters" id="refsect1-function.xml-parse-parameters">
  <h3 class="title">参数</h3>
  <p class="para">
   <dl>
    
     <dt>
<code class="parameter">parser</code></dt>

     <dd>

      <p class="para">
       指向将要使用的 XML 解析器的指针。
      </p>
     </dd>

    
    
     <dt>
<code class="parameter">data</code></dt>

     <dd>

      <p class="para">
       要解析的数据块。可以通过使用新数据多次调用 <span class="function"><strong>xml_parse()</strong></span> 来分段解析文档，只要在解析最后一个数据时设置 <code class="parameter">is_final</code> 参数且为 <strong><code>true</code></strong> 即可。
      </p>
     </dd>

    
    
     <dt>
<code class="parameter">is_final</code></dt>

     <dd>

      <p class="para">
       如果被设置为 <strong><code>true</code></strong>，则 <code class="parameter">data</code> 为当前解析中最后一段数据。
      </p>
     </dd>

    
   </dl>

  </p>
 </div>


 <div class="refsect1 returnvalues" id="refsect1-function.xml-parse-returnvalues">
  <h3 class="title">返回值</h3>
  <p class="para">
   成功时返回 1，失败时返回 0。
  </p>
  <p class="para">
   若解析失败，可以使用如下函数获取错误信息：<span class="function"><a href="function.xml-get-error-code.html" class="function">xml_get_error_code()</a></span>、<span class="function"><a href="function.xml-error-string.html" class="function">xml_error_string()</a></span>、<span class="function"><a href="function.xml-get-current-line-number.html" class="function">xml_get_current_line_number()</a></span>、<span class="function"><a href="function.xml-get-current-column-number.html" class="function">xml_get_current_column_number()</a></span>
   和 <span class="function"><a href="function.xml-get-current-byte-index.html" class="function">xml_get_current_byte_index()</a></span>。
  </p>
  <blockquote class="note"><p><strong class="note">Note</strong>: 
   <p class="para">
    将 <code class="parameter">is_final</code> 参数设置为 <strong><code>true</code></strong>，一些错误（例如 entity 错误）将会在数据末尾报告。
   </p>
  </p></blockquote>
 </div>


 <div class="refsect1 changelog" id="refsect1-function.xml-parse-changelog">
  <h3 class="title">更新日志</h3>
  <table class="doctable informaltable">
   
    <thead>
     <tr>
      <th>版本</th>
      <th>说明</th>
     </tr>

    </thead>

    <tbody class="tbody">
     <tr>
 <td>8.0.0</td>
 <td>
  <code class="parameter">parser</code> 现在接受 <span class="classname"><a href="class.xmlparser.html" class="classname">XMLParser</a></span> 实例；之前接受有效的 <code class="literal">xml</code> <span class="type">resource</span>。
 </td>
</tr>

    </tbody>
   
  </table>

 </div>


 <div class="refsect1 examples" id="refsect1-function.xml-parse-examples">
  <h3 class="title">示例</h3>
  <div class="example" id="">
   <p><strong>Example #1 分块解析大型 XML 文档</strong></p>
   <div class="example-contents"><p>
     此示例展示了如何以块的形式读取和解析大型 XML 文档，这样就不必将整个文档保存在内存中。为简洁起见，省略了错误处理。
   </p></div>
   <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br />$stream </span><span style="color: #007700">= </span><span style="color: #0000BB">fopen</span><span style="color: #007700">(</span><span style="color: #DD0000">'large.xml'</span><span style="color: #007700">, </span><span style="color: #DD0000">'r'</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">$parser </span><span style="color: #007700">= </span><span style="color: #0000BB">xml_parser_create</span><span style="color: #007700">();<br /></span><span style="color: #FF8000">// set up the handlers here<br /></span><span style="color: #007700">while ((</span><span style="color: #0000BB">$data </span><span style="color: #007700">= </span><span style="color: #0000BB">fread</span><span style="color: #007700">(</span><span style="color: #0000BB">$stream</span><span style="color: #007700">, </span><span style="color: #0000BB">16384</span><span style="color: #007700">))) {<br />    </span><span style="color: #0000BB">xml_parse</span><span style="color: #007700">(</span><span style="color: #0000BB">$parser</span><span style="color: #007700">, </span><span style="color: #0000BB">$data</span><span style="color: #007700">); </span><span style="color: #FF8000">// parse the current chunk<br /></span><span style="color: #007700">}<br /></span><span style="color: #0000BB">xml_parse</span><span style="color: #007700">(</span><span style="color: #0000BB">$parser</span><span style="color: #007700">, </span><span style="color: #DD0000">''</span><span style="color: #007700">, </span><span style="color: #0000BB">true</span><span style="color: #007700">); </span><span style="color: #FF8000">// finalize parsing<br /></span><span style="color: #0000BB">xml_parser_free</span><span style="color: #007700">(</span><span style="color: #0000BB">$parser</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">fclose</span><span style="color: #007700">(</span><span style="color: #0000BB">$stream</span><span style="color: #007700">);</span>
</span>
</code></div>
   </div>

  </div>
 </div>


</div><div id="usernotes">
 <div class="head">
  <h3 class="title">User Contributed Notes</h3>
 </div>
<div id="allnotes">  <a name="115507""></a>
  <div class="note">
   <strong class="user">Programmerdude</strong>
   <a href="#115507" class="date">06-Aug-2014 07:26</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Due to restrictions in libxml2 the maximum length of $data is 9.5MB. If you need to process more than 9.5MB you can do so by calling the function multiple times and setting $is_final on the last call.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="114623""></a>
  <div class="note">
   <strong class="user">alejandro dot anv at gmail dot com</strong>
   <a href="#114623" class="date">13-Mar-2014 01:00</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Here is my array2xml function. I made it because I coudn't find a generic recursive function that generates a prety formatted XML from any array.<br />
<br />
Usage:<br />
<br />
<span class="default">&lt;?php </span><span class="keyword">echo </span><span class="default">xml2array</span><span class="keyword">(</span><span class="string">'rootname'</span><span class="keyword">,</span><span class="default">$myarray</span><span class="keyword">); </span><span class="default">?&gt;<br />
</span><br />
or if you want to specify a spacing character(s) other than TAB:<br />
<br />
<span class="default">&lt;?php </span><span class="keyword">echo </span><span class="default">xml2array</span><span class="keyword">(</span><span class="string">'rootname'</span><span class="keyword">,</span><span class="default">$myarray</span><span class="keyword">,</span><span class="string">'&nbsp;&nbsp; '</span><span class="keyword">); </span><span class="default">?&gt;<br />
</span><br />
or if you want avoid spacing at all<br />
<br />
<span class="default">&lt;?php </span><span class="keyword">echo </span><span class="default">xml2array</span><span class="keyword">(</span><span class="string">'rootname'</span><span class="keyword">,</span><span class="default">$myarray</span><span class="keyword">,</span><span class="string">''</span><span class="keyword">); </span><span class="default">?&gt;<br />
</span><br />
<span class="default">&lt;?php<br />
</span><span class="keyword">function </span><span class="default">array2xml</span><span class="keyword">(</span><span class="default">$nombre</span><span class="keyword">,</span><span class="default">$valor</span><span class="keyword">,</span><span class="default">$tab</span><span class="keyword">=</span><span class="string">"\t"</span><span class="keyword">,</span><span class="default">$nivel</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">){<br />
<br />
if (</span><span class="default">$nivel</span><span class="keyword">==</span><span class="default">0</span><span class="keyword">) </span><span class="default">$r</span><span class="keyword">=</span><span class="string">'&lt;?xml version="1.0" encoding="ISO-8859-1"?&gt;'</span><span class="keyword">;<br />
<br />
</span><span class="default">$arr</span><span class="keyword">=!</span><span class="default">is_numeric</span><span class="keyword">(</span><span class="default">$nombre</span><span class="keyword">);<br />
</span><span class="default">$spacing</span><span class="keyword">=</span><span class="default">str_repeat</span><span class="keyword">(</span><span class="default">$tab</span><span class="keyword">,</span><span class="default">$nivel</span><span class="keyword">);<br />
if (</span><span class="default">$tab</span><span class="keyword">!=</span><span class="string">''</span><span class="keyword">) </span><span class="default">$newline</span><span class="keyword">=</span><span class="string">"\n"</span><span class="keyword">;<br />
else </span><span class="default">$newline</span><span class="keyword">=</span><span class="string">''</span><span class="keyword">;<br />
<br />
if (</span><span class="default">is_array</span><span class="keyword">(</span><span class="default">$valor</span><span class="keyword">)){<br />
&nbsp;&nbsp; <br />
&nbsp;&nbsp; if (</span><span class="default">count</span><span class="keyword">(</span><span class="default">$valor</span><span class="keyword">)&gt;</span><span class="default">0</span><span class="keyword">){<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">$r</span><span class="keyword">.=</span><span class="default">$newline</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="comment">//$r.=str_repeat($tab,$nivel);<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="keyword">foreach(</span><span class="default">$valor </span><span class="keyword">as </span><span class="default">$k</span><span class="keyword">=&gt;</span><span class="default">$v</span><span class="keyword">){<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; if (</span><span class="default">$arr</span><span class="keyword">) </span><span class="default">$r</span><span class="keyword">.=</span><span class="string">"</span><span class="default">$spacing</span><span class="string">&lt;</span><span class="default">$nombre</span><span class="string">&gt;"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; if (</span><span class="default">is_array</span><span class="keyword">(</span><span class="default">$v</span><span class="keyword">))&nbsp; </span><span class="default">$r</span><span class="keyword">.=</span><span class="default">array2xml</span><span class="keyword">(</span><span class="default">$k</span><span class="keyword">,</span><span class="default">$v</span><span class="keyword">,</span><span class="default">$tab</span><span class="keyword">,</span><span class="default">$nivel</span><span class="keyword">+</span><span class="default">$arr</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; else </span><span class="default">$r</span><span class="keyword">.=</span><span class="string">"</span><span class="default">$spacing</span><span class="string">&lt;</span><span class="default">$k</span><span class="string">&gt;</span><span class="default">$v</span><span class="string">&lt;/</span><span class="default">$k</span><span class="string">&gt;</span><span class="default">$newline</span><span class="string">"</span><span class="keyword">;<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; if (</span><span class="default">$arr</span><span class="keyword">) </span><span class="default">$r</span><span class="keyword">.=</span><span class="string">"</span><span class="default">$spacing</span><span class="string">&lt;/</span><span class="default">$nombre</span><span class="string">&gt;</span><span class="default">$newline</span><span class="string">"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; }</span><span class="comment">//foreach<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="keyword">}</span><span class="comment">//count<br />
&nbsp;&nbsp; </span><span class="keyword">else </span><span class="default">$r</span><span class="keyword">.=</span><span class="string">"</span><span class="default">$spacing</span><span class="string">&lt;</span><span class="default">$nombre</span><span class="string">&gt;&lt;/</span><span class="default">$nombre</span><span class="string">&gt;"</span><span class="keyword">; </span><span class="comment">// it's an empty array<br />
&nbsp;&nbsp; </span><span class="keyword">}<br />
else {&nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; if (</span><span class="default">$arr</span><span class="keyword">) </span><span class="default">$r</span><span class="keyword">.=</span><span class="string">"</span><span class="default">$spacing</span><span class="string">&lt;</span><span class="default">$nombre</span><span class="string">&gt;"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; </span><span class="default">$r</span><span class="keyword">.=</span><span class="default">$valor</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; if (</span><span class="default">$arr</span><span class="keyword">) </span><span class="default">$r</span><span class="keyword">.=</span><span class="string">"&lt;/</span><span class="default">$nombre</span><span class="string">&gt;</span><span class="default">$newline</span><span class="string">"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; }<br />
<br />
return </span><span class="default">$r</span><span class="keyword">;&nbsp;&nbsp; <br />
}<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="97556""></a>
  <div class="note">
   <strong class="user">Ashok dot 893 at gmail dot com</strong>
   <a href="#97556" class="date">25-Apr-2010 10:52</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
This is very simple way to convert all applicable objects into associative array.&nbsp; This works with not only SimpleXML but any kind of object. The input can be either array or object. This function also takes an options parameter as array of indices to be excluded in the return array. And keep in mind, this returns only the array of non-static and accessible variables of the object since using the function get_object_vars().<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">function </span><span class="default">objectsIntoArray</span><span class="keyword">(</span><span class="default">$arrObjData</span><span class="keyword">, </span><span class="default">$arrSkipIndices </span><span class="keyword">= array())<br />
{<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$arrData </span><span class="keyword">= array();<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// if input is object, convert into array<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">if (</span><span class="default">is_object</span><span class="keyword">(</span><span class="default">$arrObjData</span><span class="keyword">)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$arrObjData </span><span class="keyword">= </span><span class="default">get_object_vars</span><span class="keyword">(</span><span class="default">$arrObjData</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; if (</span><span class="default">is_array</span><span class="keyword">(</span><span class="default">$arrObjData</span><span class="keyword">)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; foreach (</span><span class="default">$arrObjData </span><span class="keyword">as </span><span class="default">$index </span><span class="keyword">=&gt; </span><span class="default">$value</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">is_object</span><span class="keyword">(</span><span class="default">$value</span><span class="keyword">) || </span><span class="default">is_array</span><span class="keyword">(</span><span class="default">$value</span><span class="keyword">)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$value </span><span class="keyword">= </span><span class="default">objectsIntoArray</span><span class="keyword">(</span><span class="default">$value</span><span class="keyword">, </span><span class="default">$arrSkipIndices</span><span class="keyword">); </span><span class="comment">// recursive call<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">}<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">in_array</span><span class="keyword">(</span><span class="default">$index</span><span class="keyword">, </span><span class="default">$arrSkipIndices</span><span class="keyword">)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; continue;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$arrData</span><span class="keyword">[</span><span class="default">$index</span><span class="keyword">] = </span><span class="default">$value</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">$arrData</span><span class="keyword">;<br />
}<br />
</span><span class="default">?&gt;<br />
</span><br />
Usage:<br />
<br />
<span class="default">&lt;?php<br />
$xmlUrl </span><span class="keyword">= </span><span class="string">"feed.xml"</span><span class="keyword">; </span><span class="comment">// XML feed file/URL<br />
</span><span class="default">$xmlStr </span><span class="keyword">= </span><span class="default">file_get_contents</span><span class="keyword">(</span><span class="default">$xmlUrl</span><span class="keyword">);<br />
</span><span class="default">$xmlObj </span><span class="keyword">= </span><span class="default">simplexml_load_string</span><span class="keyword">(</span><span class="default">$xmlStr</span><span class="keyword">);<br />
</span><span class="default">$arrXml </span><span class="keyword">= </span><span class="default">objectsIntoArray</span><span class="keyword">(</span><span class="default">$xmlObj</span><span class="keyword">);<br />
</span><span class="default">print_r</span><span class="keyword">(</span><span class="default">$arrXml</span><span class="keyword">);<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="87920""></a>
  <div class="note">
   <strong class="user">lz_speedy at web dot de</strong>
   <a href="#87920" class="date">30-Dec-2008 10:20</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Best seen xml2array function ever<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">function </span><span class="default">xml2array</span><span class="keyword">(</span><span class="default">$url</span><span class="keyword">, </span><span class="default">$get_attributes </span><span class="keyword">= </span><span class="default">1</span><span class="keyword">, </span><span class="default">$priority </span><span class="keyword">= </span><span class="string">'tag'</span><span class="keyword">)<br />
{<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$contents </span><span class="keyword">= </span><span class="string">""</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; if (!</span><span class="default">function_exists</span><span class="keyword">(</span><span class="string">'xml_parser_create'</span><span class="keyword">))<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return array ();<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$parser </span><span class="keyword">= </span><span class="default">xml_parser_create</span><span class="keyword">(</span><span class="string">''</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; if (!(</span><span class="default">$fp </span><span class="keyword">= @ </span><span class="default">fopen</span><span class="keyword">(</span><span class="default">$url</span><span class="keyword">, </span><span class="string">'rb'</span><span class="keyword">)))<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return array ();<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; while (!</span><span class="default">feof</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">))<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$contents </span><span class="keyword">.= </span><span class="default">fread</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">, </span><span class="default">8192</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">fclose</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">xml_parser_set_option</span><span class="keyword">(</span><span class="default">$parser</span><span class="keyword">, </span><span class="default">XML_OPTION_TARGET_ENCODING</span><span class="keyword">, </span><span class="string">"UTF-8"</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">xml_parser_set_option</span><span class="keyword">(</span><span class="default">$parser</span><span class="keyword">, </span><span class="default">XML_OPTION_CASE_FOLDING</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">xml_parser_set_option</span><span class="keyword">(</span><span class="default">$parser</span><span class="keyword">, </span><span class="default">XML_OPTION_SKIP_WHITE</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">xml_parse_into_struct</span><span class="keyword">(</span><span class="default">$parser</span><span class="keyword">, </span><span class="default">trim</span><span class="keyword">(</span><span class="default">$contents</span><span class="keyword">), </span><span class="default">$xml_values</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">xml_parser_free</span><span class="keyword">(</span><span class="default">$parser</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; if (!</span><span class="default">$xml_values</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return; </span><span class="comment">//Hmm...<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$xml_array </span><span class="keyword">= array ();<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$parents </span><span class="keyword">= array ();<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$opened_tags </span><span class="keyword">= array ();<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$arr </span><span class="keyword">= array ();<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$current </span><span class="keyword">= &amp; </span><span class="default">$xml_array</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$repeated_tag_index </span><span class="keyword">= array (); <br />
&nbsp;&nbsp;&nbsp; foreach (</span><span class="default">$xml_values </span><span class="keyword">as </span><span class="default">$data</span><span class="keyword">)<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; unset (</span><span class="default">$attributes</span><span class="keyword">, </span><span class="default">$value</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">extract</span><span class="keyword">(</span><span class="default">$data</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$result </span><span class="keyword">= array ();<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$attributes_data </span><span class="keyword">= array ();<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (isset (</span><span class="default">$value</span><span class="keyword">))<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">$priority </span><span class="keyword">== </span><span class="string">'tag'</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$result </span><span class="keyword">= </span><span class="default">$value</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; else<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$result</span><span class="keyword">[</span><span class="string">'value'</span><span class="keyword">] = </span><span class="default">$value</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (isset (</span><span class="default">$attributes</span><span class="keyword">) and </span><span class="default">$get_attributes</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; foreach (</span><span class="default">$attributes </span><span class="keyword">as </span><span class="default">$attr </span><span class="keyword">=&gt; </span><span class="default">$val</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">$priority </span><span class="keyword">== </span><span class="string">'tag'</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$attributes_data</span><span class="keyword">[</span><span class="default">$attr</span><span class="keyword">] = </span><span class="default">$val</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; else<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$result</span><span class="keyword">[</span><span class="string">'attr'</span><span class="keyword">][</span><span class="default">$attr</span><span class="keyword">] = </span><span class="default">$val</span><span class="keyword">; </span><span class="comment">//Set all the attributes in a array called 'attr'<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">}<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">$type </span><span class="keyword">== </span><span class="string">"open"</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; { <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$parent</span><span class="keyword">[</span><span class="default">$level </span><span class="keyword">-</span><span class="default">1</span><span class="keyword">] = &amp; </span><span class="default">$current</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (!</span><span class="default">is_array</span><span class="keyword">(</span><span class="default">$current</span><span class="keyword">) or (!</span><span class="default">in_array</span><span class="keyword">(</span><span class="default">$tag</span><span class="keyword">, </span><span class="default">array_keys</span><span class="keyword">(</span><span class="default">$current</span><span class="keyword">))))<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$current</span><span class="keyword">[</span><span class="default">$tag</span><span class="keyword">] = </span><span class="default">$result</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">$attributes_data</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$current</span><span class="keyword">[</span><span class="default">$tag </span><span class="keyword">. </span><span class="string">'_attr'</span><span class="keyword">] = </span><span class="default">$attributes_data</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$repeated_tag_index</span><span class="keyword">[</span><span class="default">$tag </span><span class="keyword">. </span><span class="string">'_' </span><span class="keyword">. </span><span class="default">$level</span><span class="keyword">] = </span><span class="default">1</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$current </span><span class="keyword">= &amp; </span><span class="default">$current</span><span class="keyword">[</span><span class="default">$tag</span><span class="keyword">];<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; else<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (isset (</span><span class="default">$current</span><span class="keyword">[</span><span class="default">$tag</span><span class="keyword">][</span><span class="default">0</span><span class="keyword">]))<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$current</span><span class="keyword">[</span><span class="default">$tag</span><span class="keyword">][</span><span class="default">$repeated_tag_index</span><span class="keyword">[</span><span class="default">$tag </span><span class="keyword">. </span><span class="string">'_' </span><span class="keyword">. </span><span class="default">$level</span><span class="keyword">]] = </span><span class="default">$result</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$repeated_tag_index</span><span class="keyword">[</span><span class="default">$tag </span><span class="keyword">. </span><span class="string">'_' </span><span class="keyword">. </span><span class="default">$level</span><span class="keyword">]++;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; else<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; { <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$current</span><span class="keyword">[</span><span class="default">$tag</span><span class="keyword">] = array (<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$current</span><span class="keyword">[</span><span class="default">$tag</span><span class="keyword">],<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$result<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">); <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$repeated_tag_index</span><span class="keyword">[</span><span class="default">$tag </span><span class="keyword">. </span><span class="string">'_' </span><span class="keyword">. </span><span class="default">$level</span><span class="keyword">] = </span><span class="default">2</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (isset (</span><span class="default">$current</span><span class="keyword">[</span><span class="default">$tag </span><span class="keyword">. </span><span class="string">'_attr'</span><span class="keyword">]))<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$current</span><span class="keyword">[</span><span class="default">$tag</span><span class="keyword">][</span><span class="string">'0_attr'</span><span class="keyword">] = </span><span class="default">$current</span><span class="keyword">[</span><span class="default">$tag </span><span class="keyword">. </span><span class="string">'_attr'</span><span class="keyword">];<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; unset (</span><span class="default">$current</span><span class="keyword">[</span><span class="default">$tag </span><span class="keyword">. </span><span class="string">'_attr'</span><span class="keyword">]);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$last_item_index </span><span class="keyword">= </span><span class="default">$repeated_tag_index</span><span class="keyword">[</span><span class="default">$tag </span><span class="keyword">. </span><span class="string">'_' </span><span class="keyword">. </span><span class="default">$level</span><span class="keyword">] - </span><span class="default">1</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$current </span><span class="keyword">= &amp; </span><span class="default">$current</span><span class="keyword">[</span><span class="default">$tag</span><span class="keyword">][</span><span class="default">$last_item_index</span><span class="keyword">];<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; elseif (</span><span class="default">$type </span><span class="keyword">== </span><span class="string">"complete"</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (!isset (</span><span class="default">$current</span><span class="keyword">[</span><span class="default">$tag</span><span class="keyword">]))<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$current</span><span class="keyword">[</span><span class="default">$tag</span><span class="keyword">] = </span><span class="default">$result</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$repeated_tag_index</span><span class="keyword">[</span><span class="default">$tag </span><span class="keyword">. </span><span class="string">'_' </span><span class="keyword">. </span><span class="default">$level</span><span class="keyword">] = </span><span class="default">1</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">$priority </span><span class="keyword">== </span><span class="string">'tag' </span><span class="keyword">and </span><span class="default">$attributes_data</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$current</span><span class="keyword">[</span><span class="default">$tag </span><span class="keyword">. </span><span class="string">'_attr'</span><span class="keyword">] = </span><span class="default">$attributes_data</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; else<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (isset (</span><span class="default">$current</span><span class="keyword">[</span><span class="default">$tag</span><span class="keyword">][</span><span class="default">0</span><span class="keyword">]) and </span><span class="default">is_array</span><span class="keyword">(</span><span class="default">$current</span><span class="keyword">[</span><span class="default">$tag</span><span class="keyword">]))<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$current</span><span class="keyword">[</span><span class="default">$tag</span><span class="keyword">][</span><span class="default">$repeated_tag_index</span><span class="keyword">[</span><span class="default">$tag </span><span class="keyword">. </span><span class="string">'_' </span><span class="keyword">. </span><span class="default">$level</span><span class="keyword">]] = </span><span class="default">$result</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">$priority </span><span class="keyword">== </span><span class="string">'tag' </span><span class="keyword">and </span><span class="default">$get_attributes </span><span class="keyword">and </span><span class="default">$attributes_data</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$current</span><span class="keyword">[</span><span class="default">$tag</span><span class="keyword">][</span><span class="default">$repeated_tag_index</span><span class="keyword">[</span><span class="default">$tag </span><span class="keyword">. </span><span class="string">'_' </span><span class="keyword">. </span><span class="default">$level</span><span class="keyword">] . </span><span class="string">'_attr'</span><span class="keyword">] = </span><span class="default">$attributes_data</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$repeated_tag_index</span><span class="keyword">[</span><span class="default">$tag </span><span class="keyword">. </span><span class="string">'_' </span><span class="keyword">. </span><span class="default">$level</span><span class="keyword">]++;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; else<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$current</span><span class="keyword">[</span><span class="default">$tag</span><span class="keyword">] = array (<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$current</span><span class="keyword">[</span><span class="default">$tag</span><span class="keyword">],<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$result<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">); <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$repeated_tag_index</span><span class="keyword">[</span><span class="default">$tag </span><span class="keyword">. </span><span class="string">'_' </span><span class="keyword">. </span><span class="default">$level</span><span class="keyword">] = </span><span class="default">1</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">$priority </span><span class="keyword">== </span><span class="string">'tag' </span><span class="keyword">and </span><span class="default">$get_attributes</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (isset (</span><span class="default">$current</span><span class="keyword">[</span><span class="default">$tag </span><span class="keyword">. </span><span class="string">'_attr'</span><span class="keyword">]))<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; { <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$current</span><span class="keyword">[</span><span class="default">$tag</span><span class="keyword">][</span><span class="string">'0_attr'</span><span class="keyword">] = </span><span class="default">$current</span><span class="keyword">[</span><span class="default">$tag </span><span class="keyword">. </span><span class="string">'_attr'</span><span class="keyword">];<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; unset (</span><span class="default">$current</span><span class="keyword">[</span><span class="default">$tag </span><span class="keyword">. </span><span class="string">'_attr'</span><span class="keyword">]);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">$attributes_data</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$current</span><span class="keyword">[</span><span class="default">$tag</span><span class="keyword">][</span><span class="default">$repeated_tag_index</span><span class="keyword">[</span><span class="default">$tag </span><span class="keyword">. </span><span class="string">'_' </span><span class="keyword">. </span><span class="default">$level</span><span class="keyword">] . </span><span class="string">'_attr'</span><span class="keyword">] = </span><span class="default">$attributes_data</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$repeated_tag_index</span><span class="keyword">[</span><span class="default">$tag </span><span class="keyword">. </span><span class="string">'_' </span><span class="keyword">. </span><span class="default">$level</span><span class="keyword">]++; </span><span class="comment">//0 and 1 index is already taken<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">}<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; elseif (</span><span class="default">$type </span><span class="keyword">== </span><span class="string">'close'</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$current </span><span class="keyword">= &amp; </span><span class="default">$parent</span><span class="keyword">[</span><span class="default">$level </span><span class="keyword">-</span><span class="default">1</span><span class="keyword">];<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; return (</span><span class="default">$xml_array</span><span class="keyword">);<br />
}<br />
</span><span class="default">?&gt;<br />
</span><br />
Returns a well formed array like the structure of the xml-document<br />
<br />
&lt;root&gt;<br />
&nbsp;&lt;child1&gt;<br />
&nbsp; &lt;child1child1/&gt;<br />
&nbsp;&lt;/child1&gt;<br />
&lt;/root&gt;<br />
<br />
create an array like <br />
array[root][child1][child1child1]<br />
<br />
lg</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="79790""></a>
  <div class="note">
   <strong class="user">neoyahuu at yahoo dot com</strong>
   <a href="#79790" class="date">12-Dec-2007 08:18</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Instead of passing a URL, we can pass the XML content to this class (either you
<br />
&nbsp;want to use CURL, Socks or fopen to retrieve it first) and instead of using 
<br />
&nbsp;array, I'm using separator '|' to identify which data to get (in order to make 
<br />
&nbsp;it short to retrieve a complex XML data). Here is my class with built-in fopen 
<br />
&nbsp;which you can pass URL or you can pass the content instead :
<br />

<br />
p/s : thanks to this great help page.
<br />

<br />
<span class="default">&lt;?php
<br />

<br />
</span><span class="keyword">class </span><span class="default">xx_xml </span><span class="keyword">{
<br />

<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// XML parser variables
<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">var </span><span class="default">$parser</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; var </span><span class="default">$name</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; var </span><span class="default">$attr</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; var </span><span class="default">$data&nbsp; </span><span class="keyword">= array();
<br />
&nbsp;&nbsp;&nbsp; var </span><span class="default">$stack </span><span class="keyword">= array();
<br />
&nbsp;&nbsp;&nbsp; var </span><span class="default">$keys</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; var </span><span class="default">$path</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; 
<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// either you pass url atau contents. 
<br />
&nbsp;&nbsp;&nbsp; // Use 'url' or 'contents' for the parameter
<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">var </span><span class="default">$type</span><span class="keyword">;
<br />

<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// function with the default parameter value
<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">function </span><span class="default">xx_xml</span><span class="keyword">(</span><span class="default">$url</span><span class="keyword">=</span><span class="string">'<a href="http://www.example.com" rel="nofollow" target="_blank">http://www.example.com</a>'</span><span class="keyword">, </span><span class="default">$type</span><span class="keyword">=</span><span class="string">'url'</span><span class="keyword">) {
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">type </span><span class="keyword">= </span><span class="default">$type</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">url&nbsp; </span><span class="keyword">= </span><span class="default">$url</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">parse</span><span class="keyword">();
<br />
&nbsp;&nbsp;&nbsp; }
<br />
&nbsp;&nbsp;&nbsp; 
<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// parse XML data
<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">function </span><span class="default">parse</span><span class="keyword">()
<br />
&nbsp;&nbsp;&nbsp; {
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$data </span><span class="keyword">= </span><span class="string">''</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">parser </span><span class="keyword">= </span><span class="default">xml_parser_create</span><span class="keyword">();
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">xml_set_object</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">parser</span><span class="keyword">, </span><span class="default">$this</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">xml_set_element_handler</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">parser</span><span class="keyword">, </span><span class="string">'startXML'</span><span class="keyword">, </span><span class="string">'endXML'</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">xml_set_character_data_handler</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">parser</span><span class="keyword">, </span><span class="string">'charXML'</span><span class="keyword">);
<br />

<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">xml_parser_set_option</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">parser</span><span class="keyword">, </span><span class="default">XML_OPTION_CASE_FOLDING</span><span class="keyword">, </span><span class="default">false</span><span class="keyword">);
<br />

<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">type </span><span class="keyword">== </span><span class="string">'url'</span><span class="keyword">) {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// if use type = 'url' now we open the XML with fopen
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; 
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">if (!(</span><span class="default">$fp </span><span class="keyword">= @</span><span class="default">fopen</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">url</span><span class="keyword">, </span><span class="string">'rb'</span><span class="keyword">))) {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">error</span><span class="keyword">(</span><span class="string">"Cannot open </span><span class="keyword">{</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">url</span><span class="keyword">}</span><span class="string">"</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }
<br />

<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; while ((</span><span class="default">$data </span><span class="keyword">= </span><span class="default">fread</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">, </span><span class="default">8192</span><span class="keyword">))) {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (!</span><span class="default">xml_parse</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">parser</span><span class="keyword">, </span><span class="default">$data</span><span class="keyword">, </span><span class="default">feof</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">))) {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">error</span><span class="keyword">(</span><span class="default">sprintf</span><span class="keyword">(</span><span class="string">'XML error at line %d column %d'</span><span class="keyword">, 
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">xml_get_current_line_number</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">parser</span><span class="keyword">), 
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">xml_get_current_column_number</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">parser</span><span class="keyword">)));
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; } else if (</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">type </span><span class="keyword">== </span><span class="string">'contents'</span><span class="keyword">) {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// Now we can pass the contents, maybe if you want 
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; // to use CURL, SOCK or other method.
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$lines </span><span class="keyword">= </span><span class="default">explode</span><span class="keyword">(</span><span class="string">"\n"</span><span class="keyword">,</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">url</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; foreach (</span><span class="default">$lines </span><span class="keyword">as </span><span class="default">$val</span><span class="keyword">) {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">trim</span><span class="keyword">(</span><span class="default">$val</span><span class="keyword">) == </span><span class="string">''</span><span class="keyword">)
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; continue;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$data </span><span class="keyword">= </span><span class="default">$val </span><span class="keyword">. </span><span class="string">"\n"</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (!</span><span class="default">xml_parse</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">parser</span><span class="keyword">, </span><span class="default">$data</span><span class="keyword">)) {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">error</span><span class="keyword">(</span><span class="default">sprintf</span><span class="keyword">(</span><span class="string">'XML error at line %d column %d'</span><span class="keyword">, 
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">xml_get_current_line_number</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">parser</span><span class="keyword">), 
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">xml_get_current_column_number</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">parser</span><span class="keyword">)));
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }
<br />
&nbsp;&nbsp;&nbsp; }
<br />

<br />
&nbsp;&nbsp;&nbsp; function </span><span class="default">startXML</span><span class="keyword">(</span><span class="default">$parser</span><span class="keyword">, </span><span class="default">$name</span><span class="keyword">, </span><span class="default">$attr</span><span class="keyword">)&nbsp; &nbsp; {
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">stack</span><span class="keyword">[</span><span class="default">$name</span><span class="keyword">] = array();
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$keys </span><span class="keyword">= </span><span class="string">''</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$total </span><span class="keyword">= </span><span class="default">count</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">stack</span><span class="keyword">)-</span><span class="default">1</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$i</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; foreach (</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">stack </span><span class="keyword">as </span><span class="default">$key </span><span class="keyword">=&gt; </span><span class="default">$val</span><span class="keyword">)&nbsp; &nbsp; {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">count</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">stack</span><span class="keyword">) &gt; </span><span class="default">1</span><span class="keyword">) {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">$total </span><span class="keyword">== </span><span class="default">$i</span><span class="keyword">)
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$keys </span><span class="keyword">.= </span><span class="default">$key</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; else
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$keys </span><span class="keyword">.= </span><span class="default">$key </span><span class="keyword">. </span><span class="string">'|'</span><span class="keyword">; </span><span class="comment">// The saparator
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">}
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; else
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$keys </span><span class="keyword">.= </span><span class="default">$key</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$i</span><span class="keyword">++;
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">array_key_exists</span><span class="keyword">(</span><span class="default">$keys</span><span class="keyword">, </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">data</span><span class="keyword">))&nbsp; &nbsp; {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">data</span><span class="keyword">[</span><span class="default">$keys</span><span class="keyword">][] = </span><span class="default">$attr</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }&nbsp; &nbsp; else
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">data</span><span class="keyword">[</span><span class="default">$keys</span><span class="keyword">] = </span><span class="default">$attr</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">keys </span><span class="keyword">= </span><span class="default">$keys</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; }
<br />

<br />
&nbsp;&nbsp;&nbsp; function </span><span class="default">endXML</span><span class="keyword">(</span><span class="default">$parser</span><span class="keyword">, </span><span class="default">$name</span><span class="keyword">)&nbsp; &nbsp; {
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">end</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">stack</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">key</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">stack</span><span class="keyword">) == </span><span class="default">$name</span><span class="keyword">)
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">array_pop</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">stack</span><span class="keyword">);
<br />
&nbsp;&nbsp;&nbsp; }
<br />

<br />
&nbsp;&nbsp;&nbsp; function </span><span class="default">charXML</span><span class="keyword">(</span><span class="default">$parser</span><span class="keyword">, </span><span class="default">$data</span><span class="keyword">)&nbsp; &nbsp; {
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">trim</span><span class="keyword">(</span><span class="default">$data</span><span class="keyword">) != </span><span class="string">''</span><span class="keyword">)
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">data</span><span class="keyword">[</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">keys</span><span class="keyword">][</span><span class="string">'data'</span><span class="keyword">][] = </span><span class="default">trim</span><span class="keyword">(</span><span class="default">str_replace</span><span class="keyword">(</span><span class="string">"\n"</span><span class="keyword">, </span><span class="string">''</span><span class="keyword">, </span><span class="default">$data</span><span class="keyword">));
<br />
&nbsp;&nbsp;&nbsp; }
<br />

<br />
&nbsp;&nbsp;&nbsp; function </span><span class="default">error</span><span class="keyword">(</span><span class="default">$msg</span><span class="keyword">)&nbsp; &nbsp; {
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="string">"&lt;div align=\"center\"&gt;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; &lt;font color=\"red\"&gt;&lt;b&gt;Error: </span><span class="default">$msg</span><span class="string">&lt;/b&gt;&lt;/font&gt;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; &lt;/div&gt;"</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; exit();
<br />
&nbsp;&nbsp;&nbsp; }
<br />
}
<br />

<br />
</span><span class="default">?&gt;
<br />
</span>
<br />
And example of retrieving XML data:
<br />
p/s: example use to retrieve weather
<br />

<br />
<span class="default">&lt;?php
<br />
</span><span class="keyword">include_once </span><span class="string">"xx_xml.class.php"</span><span class="keyword">;
<br />

<br />
</span><span class="comment">// Im using simple curl (the original is in class) to get the contents
<br />

<br />
</span><span class="default">$pageurl </span><span class="keyword">= </span><span class="string">"<a href="http://xml.weather.yahoo.com/forecastrss?p=MYXX0008&amp;u=c" rel="nofollow" target="_blank">http://xml.weather.yahoo.com/forecastrss?p=MYXX0008&amp;u=c</a>"</span><span class="keyword">;
<br />
</span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_RETURNTRANSFER</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">);
<br />
</span><span class="default">curl_setopt </span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_URL</span><span class="keyword">, </span><span class="default">$pageurl </span><span class="keyword">);
<br />
</span><span class="default">$thecontents </span><span class="keyword">= </span><span class="default">curl_exec </span><span class="keyword">( </span><span class="default">$ch </span><span class="keyword">);
<br />
</span><span class="default">curl_close</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">);
<br />

<br />
</span><span class="comment">// We want to pass only a ready XML content instead of URL
<br />
// But if you want to use URL , skip the curl functions above and use this 
<br />
// $xx4 = new xx_xml("url here",'url');
<br />

<br />
</span><span class="default">$xx4 </span><span class="keyword">= new </span><span class="default">xx_xml</span><span class="keyword">(</span><span class="default">$thecontents</span><span class="keyword">,</span><span class="string">'contents'</span><span class="keyword">); 
<br />
</span><span class="comment">// As you can see, we use saparator '|' instead of long array
<br />
</span><span class="default">$Code </span><span class="keyword">= </span><span class="default">$xx4</span><span class="keyword">-&gt;</span><span class="default">data </span><span class="keyword">[</span><span class="string">'rss|channel|item|yweather:condition'</span><span class="keyword">][</span><span class="string">'code'</span><span class="keyword">] ;
<br />
</span><span class="default">$Celcius </span><span class="keyword">= </span><span class="default">$xx4</span><span class="keyword">-&gt;</span><span class="default">data </span><span class="keyword">[</span><span class="string">'rss|channel|item|yweather:condition'</span><span class="keyword">][</span><span class="string">'temp'</span><span class="keyword">] ;
<br />
</span><span class="default">$Text </span><span class="keyword">= </span><span class="default">$xx4</span><span class="keyword">-&gt;</span><span class="default">data </span><span class="keyword">[</span><span class="string">'rss|channel|item|yweather:condition'</span><span class="keyword">][</span><span class="string">'text'</span><span class="keyword">] ;
<br />
</span><span class="default">$Cityname </span><span class="keyword">= </span><span class="default">$xx4</span><span class="keyword">-&gt;</span><span class="default">data </span><span class="keyword">[</span><span class="string">'rss|channel|yweather:location'</span><span class="keyword">][</span><span class="string">'city'</span><span class="keyword">] ;
<br />

<br />
</span><span class="default">?&gt;
<br />
</span>
<br />
Hope this helps.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="76748""></a>
  <div class="note">
   <strong class="user">joris dot landman at chello dot nl</strong>
   <a href="#76748" class="date">28-Jul-2007 07:42</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
This page has been a great help! I've adapted the examples below to make a class to parse an X(HT)ML file to a multidimensional array.<br />
<br />
Spaces, tabs, breaks, etc. are included in the array as TEXT_NODE, since in XHTML they may be functional. A function to trim them can easily be added if so desired.<br />
<br />
I've written my class to store multiple tags with the same name. In order to do this I've used nested arrays with the key NODES to store the order in which tags and data were parsed. These NODES arrays can be used as a blueprint to reconstruct the X(HT)ML part of the document in it's entirity, including formatting. (Doctype will have to be added for validity).<br />
<br />
<span class="default">&lt;?php<br />
<br />
</span><span class="keyword">class </span><span class="default">my_xml_object </span><span class="keyword">{<br />
<br />
&nbsp;&nbsp;&nbsp; var </span><span class="default">$xml_data</span><span class="keyword">; </span><span class="comment"># raw xml data from file<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">function </span><span class="default">parse_xml_file</span><span class="keyword">(</span><span class="default">$my_uri</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">xml_data </span><span class="keyword">= </span><span class="default">null</span><span class="keyword">; </span><span class="comment"># clear previously parsed file and related variables<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">if (</span><span class="default">is_file</span><span class="keyword">(</span><span class="default">$my_uri</span><span class="keyword">) &amp;&amp; </span><span class="default">is_readable</span><span class="keyword">(</span><span class="default">$my_uri</span><span class="keyword">)) { </span><span class="comment"># existing and readable uri?<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$my_file </span><span class="keyword">= </span><span class="default">fopen</span><span class="keyword">(</span><span class="default">$my_uri</span><span class="keyword">, </span><span class="string">"r"</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; while(</span><span class="default">$my_xml_input </span><span class="keyword">= </span><span class="default">fread</span><span class="keyword">(</span><span class="default">$my_file</span><span class="keyword">, </span><span class="default">filesize</span><span class="keyword">(</span><span class="default">$my_uri</span><span class="keyword">))) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">xml_data </span><span class="keyword">.= </span><span class="default">$my_xml_input</span><span class="keyword">; </span><span class="comment"># add data to xml_data<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">}<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">fclose</span><span class="keyword">(</span><span class="default">$my_file</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">parse_xml_data</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">xml_data</span><span class="keyword">); </span><span class="comment"># parse data<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">} else {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">trigger_error</span><span class="keyword">(</span><span class="string">"supplied argument is not a URI to a (readable) file"</span><span class="keyword">, </span><span class="default">E_USER_ERROR</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp;&nbsp; var </span><span class="default">$xml_array </span><span class="keyword">= Array(); </span><span class="comment"># xml array from parsed data<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">function </span><span class="default">parse_xml_data</span><span class="keyword">(</span><span class="default">$my_data</span><span class="keyword">) { </span><span class="comment"># adapted from class by randlem@gmail.com, tgrabietz@bupnet.de, bbellwfu@gmail.com, Kyle Bresin - see <a href="http://nl2.php.net/xml_parse" rel="nofollow" target="_blank">http://nl2.php.net/xml_parse</a><br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">xml_array </span><span class="keyword">= Array(</span><span class="default">0 </span><span class="keyword">=&gt; Array()); </span><span class="comment"># clear previously parsed file and related variables; populate first element<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$my_parser </span><span class="keyword">= </span><span class="default">xml_parser_create</span><span class="keyword">(); </span><span class="comment"># set up parser<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">xml_set_object</span><span class="keyword">(</span><span class="default">$my_parser</span><span class="keyword">, </span><span class="default">$this</span><span class="keyword">); </span><span class="comment"># enable parser within object<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">xml_set_element_handler</span><span class="keyword">(</span><span class="default">$my_parser</span><span class="keyword">, </span><span class="string">"xml_tag_open"</span><span class="keyword">, </span><span class="string">"xml_tag_close"</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">xml_set_character_data_handler</span><span class="keyword">(</span><span class="default">$my_parser</span><span class="keyword">, </span><span class="string">"xml_tag_data"</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (!</span><span class="default">xml_parse</span><span class="keyword">(</span><span class="default">$my_parser</span><span class="keyword">, </span><span class="default">$my_data</span><span class="keyword">)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">trigger_error</span><span class="keyword">(</span><span class="string">"data can not be parsed"</span><span class="keyword">, </span><span class="default">E_USER_ERROR</span><span class="keyword">); </span><span class="comment"># inspect problems #die(sprintf("&lt;br /&gt;\n&lt;b&gt;Error&lt;/b&gt;:&nbsp; %s on line &lt;b&gt;%d&lt;/b&gt;&lt;br /&gt;\n", xml_error_string(xml_get_error_code($my_parser)), xml_get_current_line_number($my_parser)));<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">}<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">xml_parser_free</span><span class="keyword">(</span><span class="default">$my_parser</span><span class="keyword">); </span><span class="comment"># free parser<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">return </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">xml_array</span><span class="keyword">; </span><span class="comment"># return xml array<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">}<br />
<br />
&nbsp;&nbsp;&nbsp; var </span><span class="default">$my_branch </span><span class="keyword">= Array();<br />
&nbsp;&nbsp;&nbsp; function </span><span class="default">xml_tag_open</span><span class="keyword">(</span><span class="default">$my_parser</span><span class="keyword">, </span><span class="default">$my_name</span><span class="keyword">, </span><span class="default">$my_attributes</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">array_push</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">my_branch</span><span class="keyword">, </span><span class="default">$my_name</span><span class="keyword">); </span><span class="comment"># add tag name to branch<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">xml_array</span><span class="keyword">[] = Array(); </span><span class="comment"># nest array in xml array for data<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">if (</span><span class="default">count</span><span class="keyword">(</span><span class="default">$my_attributes</span><span class="keyword">)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">xml_array</span><span class="keyword">[</span><span class="default">count</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">xml_array</span><span class="keyword">) - </span><span class="default">1</span><span class="keyword">][</span><span class="string">"ATTRIBUTES"</span><span class="keyword">] = </span><span class="default">$my_attributes</span><span class="keyword">; </span><span class="comment"># nest attributes array<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">}<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp;&nbsp; function </span><span class="default">xml_tag_data</span><span class="keyword">(</span><span class="default">$my_parser</span><span class="keyword">, </span><span class="default">$my_data</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">xml_array</span><span class="keyword">[</span><span class="default">count</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">my_branch</span><span class="keyword">)][</span><span class="string">"TEXT_NODE"</span><span class="keyword">][] = </span><span class="default">$my_data</span><span class="keyword">; </span><span class="comment"># add data to nested array<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">xml_array</span><span class="keyword">[</span><span class="default">count</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">my_branch</span><span class="keyword">)][</span><span class="string">"NODES"</span><span class="keyword">][] = </span><span class="string">"TEXT_NODE"</span><span class="keyword">; </span><span class="comment"># add text node to nested NODES array<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">}<br />
<br />
&nbsp;&nbsp;&nbsp; function </span><span class="default">xml_tag_close</span><span class="keyword">(</span><span class="default">$my_parser</span><span class="keyword">, </span><span class="default">$my_name</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">xml_array</span><span class="keyword">[</span><span class="default">count</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">my_branch</span><span class="keyword">) - </span><span class="default">1</span><span class="keyword">][</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">my_branch</span><span class="keyword">[</span><span class="default">count</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">my_branch</span><span class="keyword">) - </span><span class="default">1</span><span class="keyword">]][] = </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">xml_array</span><span class="keyword">[</span><span class="default">count</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">xml_array</span><span class="keyword">) - </span><span class="default">1</span><span class="keyword">]; </span><span class="comment"># nest arrays to follow document structure<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">array_pop</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">xml_array</span><span class="keyword">); </span><span class="comment"># pop off element that was nested<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">xml_array</span><span class="keyword">[</span><span class="default">count</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">my_branch</span><span class="keyword">) - </span><span class="default">1</span><span class="keyword">][</span><span class="string">"NODES"</span><span class="keyword">][] = </span><span class="default">$my_name</span><span class="keyword">; </span><span class="comment"># add tag node to nested NODES array<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">array_pop</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">my_branch</span><span class="keyword">); </span><span class="comment"># update branch<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">}<br />
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="76089""></a>
  <div class="note">
   <strong class="user">dgrimes at scvl dot com</strong>
   <a href="#76089" class="date">29-Jun-2007 06:14</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
One note about magic quotes: magic_quotes_runtime needs to be disabled before parsing XML. It can cause strange errors during parsing. Just add the following at the top of your program:<br />
<br />
set_magic_quotes_runtime(0);<br />
<br />
If you need magic quotes you can use stripslashes or save the current magic quotes setting with get_magic_quotes_runtime() then disable and parse your XML and then restore the previous magic quotes setting.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="75953""></a>
  <div class="note">
   <strong class="user">php at b635 dot com</strong>
   <a href="#75953" class="date">23-Jun-2007 10:17</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
The suggestions below have been a great help, but there was one thing I really needed...<br />
<br />
I'm parsing Amazon XML data, and I wanted to be able to index into the array using something like:<br />
<br />
<span class="default">&lt;?php<br />
&nbsp; </span><span class="keyword">print </span><span class="string">"&lt;p&gt;" </span><span class="keyword">. </span><span class="default">$strAXML</span><span class="keyword">-&gt;</span><span class="default">arrOutput</span><span class="keyword">[</span><span class="default">ITEMLOOKUPRESPONSE</span><span class="keyword">][</span><span class="default">ITEMS</span><span class="keyword">][</span><span class="default">ITEM</span><span class="keyword">][</span><span class="default">SMALLIMAGE</span><span class="keyword">][</span><span class="default">URL</span><span class="keyword">];<br />
</span><span class="default">?&gt;<br />
</span><br />
To solve this, I had to push all of the open tags onto a separate stack, add any tag data to the tail end of an attributed multi-dimensional array, and then pop the tag name off of the stack once it was closed...<br />
<br />
<span class="default">&lt;?php<br />
<br />
</span><span class="keyword">class </span><span class="default">xml2array </span><span class="keyword">{<br />
&nbsp; <br />
&nbsp; var </span><span class="default">$arrOutput </span><span class="keyword">= array();<br />
&nbsp; var </span><span class="default">$arrName </span><span class="keyword">= array();<br />
&nbsp; var </span><span class="default">$objParser</span><span class="keyword">;<br />
&nbsp; var </span><span class="default">$strXmlData</span><span class="keyword">;<br />
&nbsp; <br />
&nbsp; function </span><span class="default">parse</span><span class="keyword">(</span><span class="default">$strInputXML</span><span class="keyword">) {<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// standard XML parse object setup<br />
&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">objParser </span><span class="keyword">= </span><span class="default">xml_parser_create </span><span class="keyword">();<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">xml_set_object</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">objParser</span><span class="keyword">,</span><span class="default">$this</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">xml_set_element_handler</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">objParser</span><span class="keyword">, </span><span class="string">"tagOpen"</span><span class="keyword">, </span><span class="string">"tagClosed"</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="default">xml_set_character_data_handler</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">objParser</span><span class="keyword">, </span><span class="string">"tagData"</span><span class="keyword">);<br />
&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">strXmlData </span><span class="keyword">= </span><span class="default">xml_parse</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">objParser</span><span class="keyword">,</span><span class="default">$strInputXML </span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; if(!</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">strXmlData</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp;&nbsp; die(</span><span class="default">sprintf</span><span class="keyword">(</span><span class="string">"XML error: %s at line %d"</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">xml_error_string</span><span class="keyword">(</span><span class="default">xml_get_error_code</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">objParser</span><span class="keyword">)),<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">xml_get_current_line_number</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">objParser</span><span class="keyword">)));<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="default">xml_parser_free</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">objParser</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">arrOutput</span><span class="keyword">;<br />
&nbsp; }<br />
<br />
&nbsp; function </span><span class="default">tagOpen</span><span class="keyword">(</span><span class="default">$parser</span><span class="keyword">, </span><span class="default">$name</span><span class="keyword">, </span><span class="default">$attrs</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// push the current tag name to an array of still-open tag names<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">array_push </span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">arrName</span><span class="keyword">, </span><span class="default">$name</span><span class="keyword">);<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// merge the array of current attributes to the open tag<br />
&nbsp;&nbsp;&nbsp; // NOTE: this does not currently handle multiple attributes with the same name<br />
&nbsp;&nbsp;&nbsp; // (i.e. it will overwrite them with the last values)<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$strEval </span><span class="keyword">= </span><span class="string">"\$this-&gt;arrOutput"</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; foreach (</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">arrName </span><span class="keyword">as </span><span class="default">$value</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">$strEval </span><span class="keyword">.= </span><span class="string">"[" </span><span class="keyword">. </span><span class="default">$value </span><span class="keyword">. </span><span class="string">"]"</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$strEval </span><span class="keyword">= </span><span class="default">$strEval </span><span class="keyword">. </span><span class="string">" = array_merge (" </span><span class="keyword">. </span><span class="default">$strEval </span><span class="keyword">. </span><span class="string">",\$attrs);"</span><span class="keyword">;<br />
<br />
&nbsp;&nbsp;&nbsp; eval (</span><span class="default">$strEval</span><span class="keyword">);<br />
&nbsp; }<br />
<br />
&nbsp; function </span><span class="default">tagData</span><span class="keyword">(</span><span class="default">$parser</span><span class="keyword">, </span><span class="default">$tagData</span><span class="keyword">) {&nbsp;&nbsp; <br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// set the latest open tag equal to the tag data<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$strEval </span><span class="keyword">= </span><span class="string">"\$this-&gt;arrOutput"</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; foreach (</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">arrName </span><span class="keyword">as </span><span class="default">$value</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">$strEval </span><span class="keyword">.= </span><span class="string">"[" </span><span class="keyword">. </span><span class="default">$value </span><span class="keyword">. </span><span class="string">"]"</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$strEval </span><span class="keyword">= </span><span class="default">$strEval </span><span class="keyword">. </span><span class="string">" = \$tagData;"</span><span class="keyword">;<br />
<br />
&nbsp;&nbsp;&nbsp; eval (</span><span class="default">$strEval</span><span class="keyword">);<br />
&nbsp; }<br />
<br />
&nbsp; <br />
&nbsp; function </span><span class="default">tagClosed</span><span class="keyword">(</span><span class="default">$parser</span><span class="keyword">, </span><span class="default">$name</span><span class="keyword">) {<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// pop this tag (and any subsequent tags) off the stack of open tag names<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">for (</span><span class="default">$i </span><span class="keyword">= </span><span class="default">count </span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">arrName</span><span class="keyword">) - </span><span class="default">1</span><span class="keyword">; </span><span class="default">$i </span><span class="keyword">&gt; </span><span class="default">0</span><span class="keyword">; </span><span class="default">$i</span><span class="keyword">--) {<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">$currName </span><span class="keyword">= </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">arrName</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">];<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">array_pop </span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">arrName</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp;&nbsp; if (</span><span class="default">$currName </span><span class="keyword">== </span><span class="default">$name</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; break;<br />
&nbsp;&nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp; }<br />
<br />
}<br />
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="63871""></a>
  <div class="note">
   <strong class="user">james @at@ mercstudio dot Com dot nospam</strong>
   <a href="#63871" class="date">02-Apr-2006 12:10</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
hi,<br />
<br />
i've modified bbellwfu at gmail dot com to as below:<br />
<br />
features added:<br />
&nbsp; - toXML (convert back array to xml string)<br />
&nbsp; - changed name, according to macromedia flash xml concept : children -&gt; childrens, tagdata -&gt; nodevalue, name -&gt; nodename,<br />
&nbsp; - added pointer firstchild to childrens[0] (if exists)<br />
<br />
some findings that i would like to share: <br />
&nbsp;- &lt;![cdata[my value here]]&gt; (does not work on property value<br />
&nbsp;- xml file must be htmlentity based (if not using cdata)<br />
&nbsp;- xml line feed on node data seems to be double line feed on windows (still figuring why)<br />
&nbsp;- xml line feed on attribute value seems to be ignored...<br />
<br />
here's my code below :)<br />
<br />
class u007xml<br />
{<br />
&nbsp;&nbsp; var $arrOutput = array();<br />
&nbsp;&nbsp; var $resParser;<br />
&nbsp;&nbsp; var $strXmlData;<br />
&nbsp;&nbsp; <br />
&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; function u007xml($tfile = "")<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if(trim($tfile) != "") { $this-&gt;loadFile($tfile);}<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; function loadFile($tfile)<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $this-&gt;thefile = $tfile;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $th = file($tfile);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $tdata = implode("\n", $th);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return $this-&gt;parse($tdata);<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp; function parse($strInputXML) <br />
&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $this-&gt;resParser = xml_parser_create ();<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; xml_set_object($this-&gt;resParser,$this);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; xml_set_element_handler($this-&gt;resParser, "tagOpen", "tagClosed");<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; xml_set_character_data_handler($this-&gt;resParser, "tagData");<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $this-&gt;strXmlData = xml_parse($this-&gt;resParser,$strInputXML );<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if(!$this-&gt;strXmlData) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; die(sprintf("XML error: %s at line %d",<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; xml_error_string(xml_get_error_code($this-&gt;resParser)),<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; xml_get_current_line_number($this-&gt;resParser)));<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; xml_parser_free($this-&gt;resParser);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return $this-&gt;arrOutput;<br />
&nbsp;&nbsp; }<br />
&nbsp;&nbsp; <br />
&nbsp;&nbsp; //called on each xml tree<br />
&nbsp;&nbsp; function tagOpen($parser, $name, $attrs) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; $tag=array("nodename"=&gt;$name,"attributes"=&gt;$attrs);<br />
&nbsp;&nbsp; &nbsp; &nbsp; array_push($this-&gt;arrOutput,$tag);<br />
&nbsp;&nbsp; }<br />
&nbsp; <br />
&nbsp; //called on data for xml<br />
&nbsp;&nbsp; function tagData($parser, $tagData) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; if(trim($tagData)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if(isset($this-&gt;arrOutput[count($this-&gt;arrOutput)-1]['nodevalue'])) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $this-&gt;arrOutput[count($this-&gt;arrOutput)-1]['nodevalue'] .= $this-&gt;parseXMLValue($tagData);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; else {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $this-&gt;arrOutput[count($this-&gt;arrOutput)-1]['nodevalue'] = $this-&gt;parseXMLValue($tagData);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; }<br />
&nbsp;&nbsp; }<br />
&nbsp; <br />
&nbsp; //called when finished parsing<br />
&nbsp;&nbsp; function tagClosed($parser, $name) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; $this-&gt;arrOutput[count($this-&gt;arrOutput)-2]['childrens'][] = $this-&gt;arrOutput[count($this-&gt;arrOutput)-1];<br />
&nbsp;&nbsp; &nbsp; &nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; if(count ($this-&gt;arrOutput[count($this-&gt;arrOutput)-2]['childrens'] ) == 1)<br />
&nbsp;&nbsp; &nbsp; &nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $this-&gt;arrOutput[count($this-&gt;arrOutput)-2]['firstchild'] =&amp; $this-&gt;arrOutput[count($this-&gt;arrOutput)-2]['childrens'][0];<br />
&nbsp;&nbsp; &nbsp; &nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; array_pop($this-&gt;arrOutput);<br />
&nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp;&nbsp; function toArray()<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; //not used, we can call loadString or loadFile instead...<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; function parseXMLValue($tvalue)<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $tvalue = htmlentities($tvalue);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return $tvalue;<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; function toXML($tob = null)<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; //return back xml<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $result = "";<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if( $tob == null)<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $tob = $this-&gt;arrOutput;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if(!isset($tob))<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; echo "XML Array empty...";<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return null;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; for($c = 0; $c &lt; count($tob); $c++)<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $result .="&lt;" . $tob[$c]["nodename"];<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; while (list($key, $value) = each($tob[$c]["attributes"]))<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $result .=" " . $key."=\"" . $this-&gt;parseXMLValue($value) . "\"";<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $result .= "&gt;";<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; //assign node value<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if( isset($tob[$c]["nodevalue"]) )<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $result .= $tob[$c]["nodevalue"];<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if( count($tob[$c]["childrens"]) &gt; 0 )<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $result .= "\r\n" . $this-&gt;toXML(&amp;$tob[$c]["childrens"]) . "";<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $result .= "&lt;/" . $tob[$c]["nodename"] . "&gt;\r\n";<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }//end of each array...<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return $result;<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; function displayXML()<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; print_r($this-&gt;arrOutput);<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; function getXML($tob = null)<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return "&lt;?xml version='1.0'?&gt;\r\n" . $this-&gt;toXML($tob);<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
}//end of u007xml class<br />
<br />
//examples below:<br />
<br />
$xx = new u007xml();<br />
$xx-&gt;loadFile("xml3.xml");<br />
<br />
//$xx-&gt;displayXML();<br />
<br />
print $xx-&gt;getXML();</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="63223""></a>
  <div class="note">
   <strong class="user">ben at autonomic dot net</strong>
   <a href="#63223" class="date">16-Mar-2006 05:12</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
bbellwfu's code does not handle 'text nodes' properly.<br />
Consider the innards of a tag like &lt;root&gt;xxx&lt;tag2/&gt;yyy&lt;/root&gt;<br />
The 'tagData' for root will be "xxxyyy" and you have lost all information about where "tag2" was in that sequence.<br />
<br />
Quick and dirty hack. <br />
<br />
Replace tagData with this code :<br />
&nbsp;&nbsp; function tagData($parser, $tagData) {&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $last_element=count($this-&gt;arrOutput)-1;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $this-&gt;arrOutput[$last_element]['children'][] = array("textnode",$tagData);&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; }<br />
<br />
What this does is adds 'textnodes' as children of its containing parent, *in the right sequence* (rather like the internet browsers do it). This then lets you do some more sensible secondary work like recursively looking up internal references within the document...</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="60909""></a>
  <div class="note">
   <strong class="user">Kyle Bresin</strong>
   <a href="#60909" class="date">19-Jan-2006 03:15</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Just wanted to note a small bug in bbellwfu's class (which is really great btw).<br />
<br />
It fails to capture any datums which are equal to numerical zero.<br />
<br />
The problem lies in the function tagData, the first if statement should be:<br />
<br />
if(trim($tagData) != '') {</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="57369""></a>
  <div class="note">
   <strong class="user">tim at alloutinteraction dot com</strong>
   <a href="#57369" class="date">01-Oct-2005 07:29</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I wanted to create a really simple XML parser, but I found the array management in xml_parse a bit daunting. So I flattened my XML and parsed it using string matching. It wouldn't be difficult to add xml depth (of 2 plus levels) by modifying the parsedXML array.<br />
<br />
&lt;?<br />
// here's the raw html<br />
$xmlRaw="&lt;order&gt;Order data&lt;/order&gt;&lt;label&gt;Label data&lt;/label&gt;&lt;control&gt;123&lt;/control&gt;";<br />
// here are the xml field names<br />
$xmlFieldNames=array("order", "label", "control");<br />
// for each xml field...<br />
foreach ($xmlFieldNames as $xmlField) {<br />
&nbsp;&nbsp;&nbsp; if(strpos($xmlRaw,$xmlField)!==false){<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; // I've broken 1 single line into 4 for display purposes<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $parsedXML[$xmlField]=substr($xmlRaw,<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; strpos($xmlRaw,"&lt;$xmlField&gt;")+strlen("&lt;$xmlField&gt;"),<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; strpos($xmlRaw,"&lt;/$xmlField&gt;")-strlen("&lt;$xmlField&gt;")<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; -strpos($xmlRaw,"&lt;$xmlField&gt;"));<br />
&nbsp;&nbsp;&nbsp; }<br />
}<br />
print_r($parsedXML);<br />
// prints: Array ( [order] =&gt; Order data [label] =&gt; Label data [control] =&gt; 123 )<br />
<br />
?&gt;<br />
<br />
Hope you find this useful (coded it while ill in bed with streaming cold, but felt much better afterwards!)<br />
<br />
Tim (a lazy coder)</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="52567""></a>
  <div class="note">
   <strong class="user">bbellwfu at gmail dot com</strong>
   <a href="#52567" class="date">05-May-2005 02:51</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Just improving a little bit on the code examples from tgrabietz and randlem below... everything in one pretty class, plus some checks in place so that the element data doesnt get split up (thanks to flobee on the xml_set_character_data_handler page)<br />
<br />
<span class="default">&lt;?php<br />
<br />
</span><span class="comment">/* Usage<br />
&nbsp;Grab some XML data, either from a file, URL, etc. however you want. Assume storage in $strYourXML;<br />
<br />
&nbsp;$objXML = new xml2Array();<br />
&nbsp;$arrOutput = $objXML-&gt;parse($strYourXML);<br />
&nbsp;print_r($arrOutput); //print it out, or do whatever!<br />
&nbsp; <br />
*/<br />
</span><span class="keyword">class </span><span class="default">xml2Array </span><span class="keyword">{<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; var </span><span class="default">$arrOutput </span><span class="keyword">= array();<br />
&nbsp;&nbsp;&nbsp; var </span><span class="default">$resParser</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; var </span><span class="default">$strXmlData</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; function </span><span class="default">parse</span><span class="keyword">(</span><span class="default">$strInputXML</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">resParser </span><span class="keyword">= </span><span class="default">xml_parser_create </span><span class="keyword">();<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">xml_set_object</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">resParser</span><span class="keyword">,</span><span class="default">$this</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">xml_set_element_handler</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">resParser</span><span class="keyword">, </span><span class="string">"tagOpen"</span><span class="keyword">, </span><span class="string">"tagClosed"</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">xml_set_character_data_handler</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">resParser</span><span class="keyword">, </span><span class="string">"tagData"</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">strXmlData </span><span class="keyword">= </span><span class="default">xml_parse</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">resParser</span><span class="keyword">,</span><span class="default">$strInputXML </span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if(!</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">strXmlData</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; die(</span><span class="default">sprintf</span><span class="keyword">(</span><span class="string">"XML error: %s at line %d"</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">xml_error_string</span><span class="keyword">(</span><span class="default">xml_get_error_code</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">resParser</span><span class="keyword">)),<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">xml_get_current_line_number</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">resParser</span><span class="keyword">)));<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">xml_parser_free</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">resParser</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">arrOutput</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; function </span><span class="default">tagOpen</span><span class="keyword">(</span><span class="default">$parser</span><span class="keyword">, </span><span class="default">$name</span><span class="keyword">, </span><span class="default">$attrs</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; </span><span class="default">$tag</span><span class="keyword">=array(</span><span class="string">"name"</span><span class="keyword">=&gt;</span><span class="default">$name</span><span class="keyword">,</span><span class="string">"attrs"</span><span class="keyword">=&gt;</span><span class="default">$attrs</span><span class="keyword">); <br />
&nbsp;&nbsp; &nbsp; &nbsp; </span><span class="default">array_push</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">arrOutput</span><span class="keyword">,</span><span class="default">$tag</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; function </span><span class="default">tagData</span><span class="keyword">(</span><span class="default">$parser</span><span class="keyword">, </span><span class="default">$tagData</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; if(</span><span class="default">trim</span><span class="keyword">(</span><span class="default">$tagData</span><span class="keyword">)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if(isset(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">arrOutput</span><span class="keyword">[</span><span class="default">count</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">arrOutput</span><span class="keyword">)-</span><span class="default">1</span><span class="keyword">][</span><span class="string">'tagData'</span><span class="keyword">])) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">arrOutput</span><span class="keyword">[</span><span class="default">count</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">arrOutput</span><span class="keyword">)-</span><span class="default">1</span><span class="keyword">][</span><span class="string">'tagData'</span><span class="keyword">] .= </span><span class="default">$tagData</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; } <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; else {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">arrOutput</span><span class="keyword">[</span><span class="default">count</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">arrOutput</span><span class="keyword">)-</span><span class="default">1</span><span class="keyword">][</span><span class="string">'tagData'</span><span class="keyword">] = </span><span class="default">$tagData</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; }<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; function </span><span class="default">tagClosed</span><span class="keyword">(</span><span class="default">$parser</span><span class="keyword">, </span><span class="default">$name</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">arrOutput</span><span class="keyword">[</span><span class="default">count</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">arrOutput</span><span class="keyword">)-</span><span class="default">2</span><span class="keyword">][</span><span class="string">'children'</span><span class="keyword">][] = </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">arrOutput</span><span class="keyword">[</span><span class="default">count</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">arrOutput</span><span class="keyword">)-</span><span class="default">1</span><span class="keyword">];<br />
&nbsp;&nbsp; &nbsp; &nbsp; </span><span class="default">array_pop</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">arrOutput</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }<br />
}<br />
</span><span class="default">?&gt;<br />
</span><br />
Will output something like...<br />
<br />
&lt;snippet&gt;<br />
Array<br />
(<br />
&nbsp;&nbsp;&nbsp; [0] =&gt; Array<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; (<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [name] =&gt; GETMESSAGESRESPONSE<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [attrs] =&gt; Array<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; (<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; )<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [children] =&gt; Array<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; (<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [0] =&gt; Array<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; (<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [name] =&gt; STATUS<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [attrs] =&gt; Array<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; (<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; )<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; )<br />
<br />
&lt;/snippet&gt;</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="50953""></a>
  <div class="note">
   <strong class="user">alex dot garcia at noos dot fr</strong>
   <a href="#50953" class="date">14-Mar-2005 01:47</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Here is the inverse function which takes parsed xml array in entry and outputs xml string<br />
<br />
enjoy !<br />
<br />
function getXmlFromArray($root){<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if(count($root) &gt; 0){<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $curr_name = $root['name'];<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $attribs = $root['attrs'];<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $curr_childs = $root['children'];<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $curr_data = $root['cdata'];<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $xml .= '&lt;'.$curr_name;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if(count($attribs) &gt; 0){<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $i = 1;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; foreach($attribs as $key =&gt; $value){<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $curr_attribs .= $key.'="'.$value.'"';<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $i++;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if($i &lt;= count($attribs)){<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $curr_attribs .= ' ';<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $xml .= ' '.$curr_attribs;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if($curr_data != ''){<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $xml .= '&gt;&lt;![CDATA['.$curr_data.']]&gt;&lt;/'.$curr_name.'&gt;';<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; } else {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if(count($curr_childs) &gt; 0){<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $xml .= '&gt;';<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; foreach($curr_childs as $child){<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $xml .= getXmlFromArray($child);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $xml .= '&lt;/'.$curr_name.'&gt;';<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; } else {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $xml .= '/&gt;';<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }&nbsp; &nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; } <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return $xml;<br />
&nbsp;&nbsp;&nbsp; }</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="45890""></a>
  <div class="note">
   <strong class="user">tgrabietz at bupnet dot de</strong>
   <a href="#45890" class="date">22-Sep-2004 08:05</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
it's like randlem at gmail dot com's great code, without using a "class container" but parsing cdata. The script returns the tree-structure in a single array. <br />
<br />
<span class="default">&lt;?php<br />
$file </span><span class="keyword">= </span><span class="string">'simple.xml'</span><span class="keyword">;<br />
</span><span class="default">$stack </span><span class="keyword">= array();<br />
<br />
function </span><span class="default">startTag</span><span class="keyword">(</span><span class="default">$parser</span><span class="keyword">, </span><span class="default">$name</span><span class="keyword">, </span><span class="default">$attrs</span><span class="keyword">) <br />
{<br />
&nbsp;&nbsp; global </span><span class="default">$stack</span><span class="keyword">;<br />
&nbsp;&nbsp; </span><span class="default">$tag</span><span class="keyword">=array(</span><span class="string">"name"</span><span class="keyword">=&gt;</span><span class="default">$name</span><span class="keyword">,</span><span class="string">"attrs"</span><span class="keyword">=&gt;</span><span class="default">$attrs</span><span class="keyword">);&nbsp;&nbsp; <br />
&nbsp;&nbsp; </span><span class="default">array_push</span><span class="keyword">(</span><span class="default">$stack</span><span class="keyword">,</span><span class="default">$tag</span><span class="keyword">);<br />
&nbsp; <br />
}<br />
<br />
function </span><span class="default">cdata</span><span class="keyword">(</span><span class="default">$parser</span><span class="keyword">, </span><span class="default">$cdata</span><span class="keyword">)<br />
{<br />
&nbsp;&nbsp;&nbsp; global </span><span class="default">$stack</span><span class="keyword">,</span><span class="default">$i</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; if(</span><span class="default">trim</span><span class="keyword">(</span><span class="default">$cdata</span><span class="keyword">))<br />
&nbsp;&nbsp;&nbsp; {&nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$stack</span><span class="keyword">[</span><span class="default">count</span><span class="keyword">(</span><span class="default">$stack</span><span class="keyword">)-</span><span class="default">1</span><span class="keyword">][</span><span class="string">'cdata'</span><span class="keyword">]=</span><span class="default">$cdata</span><span class="keyword">;&nbsp; &nbsp; <br />
&nbsp;&nbsp;&nbsp; }<br />
}<br />
<br />
function </span><span class="default">endTag</span><span class="keyword">(</span><span class="default">$parser</span><span class="keyword">, </span><span class="default">$name</span><span class="keyword">) <br />
{<br />
&nbsp;&nbsp; global </span><span class="default">$stack</span><span class="keyword">;&nbsp;&nbsp; <br />
&nbsp;&nbsp; </span><span class="default">$stack</span><span class="keyword">[</span><span class="default">count</span><span class="keyword">(</span><span class="default">$stack</span><span class="keyword">)-</span><span class="default">2</span><span class="keyword">][</span><span class="string">'children'</span><span class="keyword">][] = </span><span class="default">$stack</span><span class="keyword">[</span><span class="default">count</span><span class="keyword">(</span><span class="default">$stack</span><span class="keyword">)-</span><span class="default">1</span><span class="keyword">];<br />
&nbsp;&nbsp; </span><span class="default">array_pop</span><span class="keyword">(</span><span class="default">$stack</span><span class="keyword">);<br />
}<br />
<br />
</span><span class="default">$xml_parser </span><span class="keyword">= </span><span class="default">xml_parser_create</span><span class="keyword">();<br />
</span><span class="default">xml_set_element_handler</span><span class="keyword">(</span><span class="default">$xml_parser</span><span class="keyword">, </span><span class="string">"startTag"</span><span class="keyword">, </span><span class="string">"endTag"</span><span class="keyword">);<br />
</span><span class="default">xml_set_character_data_handler</span><span class="keyword">(</span><span class="default">$xml_parser</span><span class="keyword">, </span><span class="string">"cdata"</span><span class="keyword">);<br />
<br />
</span><span class="default">$data </span><span class="keyword">= </span><span class="default">xml_parse</span><span class="keyword">(</span><span class="default">$xml_parser</span><span class="keyword">,</span><span class="default">file_get_contents</span><span class="keyword">(</span><span class="default">$file</span><span class="keyword">));<br />
if(!</span><span class="default">$data</span><span class="keyword">) {<br />
&nbsp;&nbsp; die(</span><span class="default">sprintf</span><span class="keyword">(</span><span class="string">"XML error: %s at line %d"</span><span class="keyword">,<br />
</span><span class="default">xml_error_string</span><span class="keyword">(</span><span class="default">xml_get_error_code</span><span class="keyword">(</span><span class="default">$xml_parser</span><span class="keyword">)),<br />
</span><span class="default">xml_get_current_line_number</span><span class="keyword">(</span><span class="default">$xml_parser</span><span class="keyword">)));<br />
}<br />
<br />
</span><span class="default">xml_parser_free</span><span class="keyword">(</span><span class="default">$xml_parser</span><span class="keyword">);<br />
<br />
print(</span><span class="string">"&lt;pre&gt;\n"</span><span class="keyword">);<br />
</span><span class="default">print_r</span><span class="keyword">(</span><span class="default">$stack</span><span class="keyword">);<br />
print(</span><span class="string">"&lt;/pre&gt;\n"</span><span class="keyword">);<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="45734""></a>
  <div class="note">
   <strong class="user">ByK</strong>
   <a href="#45734" class="date">16-Sep-2004 08:12</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
modified from yours code. I think it's work!!.<br />
class CXml<br />
{<br />
&nbsp;&nbsp;&nbsp; var $xml_data;<br />
&nbsp;&nbsp;&nbsp; var $obj_data;<br />
&nbsp;&nbsp;&nbsp; var $pointer;<br />
<br />
&nbsp;&nbsp;&nbsp; function CXml() { }<br />
&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; function Set_xml_data( &amp;$xml_data )<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $this-&gt;index = 0;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $this-&gt;pointer[] = &amp;$this-&gt;obj_data;<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; //strip white space between tags<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $this-&gt;xml_data = eregi_replace("&gt;"."[[:space:]]+"."&lt;","&gt;&lt;",$xml_data);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $this-&gt;xml_parser = xml_parser_create( "UTF-8" );<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; xml_parser_set_option( $this-&gt;xml_parser, XML_OPTION_CASE_FOLDING, false );<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; xml_set_object( $this-&gt;xml_parser, &amp;$this );<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; xml_set_element_handler( $this-&gt;xml_parser, "_startElement", "_endElement");<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; xml_set_character_data_handler( $this-&gt;xml_parser, "_cData" );<br />
&nbsp;&nbsp; &nbsp; &nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; xml_parse( $this-&gt;xml_parser, $this-&gt;xml_data, true );<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; xml_parser_free( $this-&gt;xml_parser );<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; function _startElement( $parser, $tag, $attributeList )<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; foreach( $attributeList as $name =&gt; $value )<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $value = $this-&gt;_cleanString( $value );<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $object-&gt;$name = $value;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; //replaces the special characters with the underscore (_) in tag name<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $tag = preg_replace("/[:\-\. ]/", "_", $tag);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; eval( "\$this-&gt;pointer[\$this-&gt;index]-&gt;" . $tag . "[] = \$object;" );<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; eval( "\$size = sizeof( \$this-&gt;pointer[\$this-&gt;index]-&gt;" . $tag . " );" );<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; eval( "\$this-&gt;pointer[] = &amp;\$this-&gt;pointer[\$this-&gt;index]-&gt;" . $tag . "[\$size-1];" );<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $this-&gt;index++;<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp;&nbsp; function _endElement( $parser, $tag )<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; array_pop( $this-&gt;pointer );<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $this-&gt;index--;<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; function _cData( $parser, $data )<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (empty($this-&gt;pointer[$this-&gt;index])) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (rtrim($data, "\n"))<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $this-&gt;pointer[$this-&gt;index] = $data;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; } else {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $this-&gt;pointer[$this-&gt;index] .= $data;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp;&nbsp; function _cleanString( $string )<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return utf8_decode( trim( $string ) );<br />
&nbsp;&nbsp;&nbsp; }<br />
}<br />
<br />
$m_xml = new CXml();<br />
$xml_data = file_get_contents( $filename );<br />
<br />
$m_xml-&gt;Set_XML_data( $xml_data );<br />
<br />
$newsid = $m_xml-&gt;obj_data-&gt;root[0]-&gt;NewsID[0];</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="45700""></a>
  <div class="note">
   <strong class="user">randlem at gmail dot com</strong>
   <a href="#45700" class="date">15-Sep-2004 08:43</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Here's a handy way to generate a tree that can be can be decended easily.<br />
<br />
<span class="default">&lt;?php<br />
$file </span><span class="keyword">= </span><span class="string">'xmltest.xml'</span><span class="keyword">;<br />
<br />
</span><span class="default">$tag_tree </span><span class="keyword">= array();<br />
</span><span class="default">$stack </span><span class="keyword">= array();<br />
<br />
class </span><span class="default">tag </span><span class="keyword">{<br />
&nbsp;&nbsp;&nbsp; var </span><span class="default">$name</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; var </span><span class="default">$attrs</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; var </span><span class="default">$children</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; function </span><span class="default">tag</span><span class="keyword">(</span><span class="default">$name</span><span class="keyword">, </span><span class="default">$attrs</span><span class="keyword">, </span><span class="default">$children</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">name </span><span class="keyword">= </span><span class="default">$name</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">attrs </span><span class="keyword">= </span><span class="default">$attrs</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">children </span><span class="keyword">= </span><span class="default">$children</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
}<br />
<br />
function </span><span class="default">startTag</span><span class="keyword">(</span><span class="default">$parser</span><span class="keyword">, </span><span class="default">$name</span><span class="keyword">, </span><span class="default">$attrs</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; global </span><span class="default">$tag_tree</span><span class="keyword">, </span><span class="default">$stack</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$tag </span><span class="keyword">= new </span><span class="default">tag</span><span class="keyword">(</span><span class="default">$name</span><span class="keyword">,</span><span class="default">$attrs</span><span class="keyword">,</span><span class="string">''</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">array_push</span><span class="keyword">(</span><span class="default">$stack</span><span class="keyword">,</span><span class="default">$tag</span><span class="keyword">);<br />
}<br />
<br />
function </span><span class="default">endTag</span><span class="keyword">(</span><span class="default">$parser</span><span class="keyword">, </span><span class="default">$name</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; global </span><span class="default">$stack</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$stack</span><span class="keyword">[</span><span class="default">count</span><span class="keyword">(</span><span class="default">$stack</span><span class="keyword">)-</span><span class="default">2</span><span class="keyword">]-&gt;</span><span class="default">children</span><span class="keyword">[] = </span><span class="default">$stack</span><span class="keyword">[</span><span class="default">count</span><span class="keyword">(</span><span class="default">$stack</span><span class="keyword">)-</span><span class="default">1</span><span class="keyword">];<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">array_pop</span><span class="keyword">(</span><span class="default">$stack</span><span class="keyword">);<br />
}<br />
<br />
</span><span class="default">$xml_parser </span><span class="keyword">= </span><span class="default">xml_parser_create</span><span class="keyword">();<br />
</span><span class="default">xml_set_element_handler</span><span class="keyword">(</span><span class="default">$xml_parser</span><span class="keyword">, </span><span class="string">"startTag"</span><span class="keyword">, </span><span class="string">"endTag"</span><span class="keyword">);<br />
<br />
</span><span class="default">$data </span><span class="keyword">= </span><span class="default">xml_parse</span><span class="keyword">(</span><span class="default">$xml_parser</span><span class="keyword">,</span><span class="default">file_get_contents</span><span class="keyword">(</span><span class="default">$file</span><span class="keyword">));<br />
if(!</span><span class="default">$data</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; die(</span><span class="default">sprintf</span><span class="keyword">(</span><span class="string">"XML error: %s at line %d"</span><span class="keyword">,<br />
</span><span class="default">xml_error_string</span><span class="keyword">(</span><span class="default">xml_get_error_code</span><span class="keyword">(</span><span class="default">$xml_parser</span><span class="keyword">)),<br />
</span><span class="default">xml_get_current_line_number</span><span class="keyword">(</span><span class="default">$xml_parser</span><span class="keyword">)));<br />
}<br />
<br />
</span><span class="default">xml_parser_free</span><span class="keyword">(</span><span class="default">$xml_parser</span><span class="keyword">);<br />
<br />
print(</span><span class="string">"\n"</span><span class="keyword">);<br />
</span><span class="default">print_r</span><span class="keyword">(</span><span class="default">$stack</span><span class="keyword">);<br />
print(</span><span class="string">"\n"</span><span class="keyword">);<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="36899""></a>
  <div class="note">
   <strong class="user">michelek</strong>
   <a href="#36899" class="date">26-Oct-2003 10:42</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
its maybe not better, but me thinks its more stright-forward<br />
<br />
--INPUT:<br />
<br />
&lt;?xml version="1.0" encoding="UTF-8"?&gt;<br />
&lt;world&gt;<br />
&nbsp;&nbsp;&nbsp; &lt;country name="sweden"&gt;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; &lt;city name="stockholm"&gt;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; &lt;user&gt;Adam&lt;/user&gt;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; &lt;user&gt;Eva&lt;/user&gt;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; &lt;/city&gt;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; &lt;city name="g?teborg"&gt;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; &lt;user&gt;God&lt;/user&gt;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; &lt;/city&gt;<br />
&nbsp;&nbsp;&nbsp; &lt;/country&gt;<br />
&nbsp;&nbsp;&nbsp; &lt;country name="usa"&gt;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; &lt;city name="new york"&gt;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; &lt;user&gt;Clinton&lt;/user&gt;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; &lt;user&gt;Bush&lt;/user&gt;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; &lt;/city&gt;<br />
&nbsp;&nbsp;&nbsp; &lt;/country&gt;<br />
&lt;/world&gt;<br />
<br />
--CODE:<br />
&lt;?<br />
/**<br />
&nbsp;* m_i_h_k_e_l_AT_w_w_DOT_e_e<br />
&nbsp;* 26.10.2003<br />
**/<br />
$filename = "m.m.xml";<br />
$xmlC = new XmlC();<br />
$xml_data = file_get_contents( $filename );<br />
<br />
$xmlC-&gt;Set_XML_data( $xml_data );<br />
<br />
echo( "&lt;pre&gt;\n" );<br />
print_r( $xmlC-&gt;obj_data );<br />
echo( "&lt;/pre&gt;\n" );<br />
<br />
class XmlC<br />
{<br />
&nbsp; var $xml_data;<br />
&nbsp; var $obj_data;<br />
&nbsp; var $pointer;<br />
<br />
&nbsp; function XmlC()<br />
&nbsp; {<br />
&nbsp; }<br />
<br />
&nbsp; function Set_xml_data( &amp;$xml_data )<br />
&nbsp; {<br />
&nbsp;&nbsp;&nbsp; $this-&gt;index = 0;<br />
&nbsp;&nbsp;&nbsp; $this-&gt;pointer[] = &amp;$this-&gt;obj_data;<br />
<br />
&nbsp;&nbsp;&nbsp; $this-&gt;xml_data = $xml_data;<br />
&nbsp;&nbsp;&nbsp; $this-&gt;xml_parser = xml_parser_create( "UTF-8" );<br />
<br />
&nbsp;&nbsp;&nbsp; xml_parser_set_option( $this-&gt;xml_parser, XML_OPTION_CASE_FOLDING, false );<br />
&nbsp;&nbsp;&nbsp; xml_set_object( $this-&gt;xml_parser, &amp;$this );<br />
&nbsp;&nbsp;&nbsp; xml_set_element_handler( $this-&gt;xml_parser, "_startElement", "_endElement");<br />
&nbsp;&nbsp;&nbsp; xml_set_character_data_handler( $this-&gt;xml_parser, "_cData" );<br />
<br />
&nbsp;&nbsp;&nbsp; xml_parse( $this-&gt;xml_parser, $this-&gt;xml_data, true );<br />
&nbsp;&nbsp;&nbsp; xml_parser_free( $this-&gt;xml_parser );<br />
&nbsp; }<br />
<br />
&nbsp; function _startElement( $parser, $tag, $attributeList )<br />
&nbsp; {<br />
&nbsp;&nbsp;&nbsp; foreach( $attributeList as $name =&gt; $value )<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp;&nbsp; $value = $this-&gt;_cleanString( $value );<br />
&nbsp;&nbsp; &nbsp;&nbsp; $object-&gt;$name = $value;<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; eval( "\$this-&gt;pointer[\$this-&gt;index]-&gt;" . $tag . "[] = \$object;" );<br />
&nbsp;&nbsp;&nbsp; eval( "\$size = sizeof( \$this-&gt;pointer[\$this-&gt;index]-&gt;" . $tag . " );" );<br />
&nbsp;&nbsp;&nbsp; eval( "\$this-&gt;pointer[] = &amp;\$this-&gt;pointer[\$this-&gt;index]-&gt;" . $tag . "[\$size-1];" );<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; $this-&gt;index++;<br />
&nbsp; }<br />
<br />
&nbsp; function _endElement( $parser, $tag )<br />
&nbsp; {<br />
&nbsp;&nbsp;&nbsp; array_pop( $this-&gt;pointer );<br />
&nbsp;&nbsp;&nbsp; $this-&gt;index--;<br />
&nbsp; }<br />
<br />
&nbsp; function _cData( $parser, $data )<br />
&nbsp; {<br />
&nbsp;&nbsp;&nbsp; if( trim( $data ) )<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp;&nbsp; $this-&gt;pointer[$this-&gt;index] = trim( $data );<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp; }<br />
<br />
&nbsp; function _cleanString( $string )<br />
&nbsp; {<br />
&nbsp;&nbsp;&nbsp; return utf8_decode( trim( $string ) );<br />
&nbsp; }<br />
<br />
}<br />
?&gt;</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="35708""></a>
  <div class="note">
   <strong class="user">Adam Tylmad</strong>
   <a href="#35708" class="date">11-Sep-2003 01:11</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I've created a parser that returns an 
<br />
object based on a xml document.
<br />

<br />
example:
<br />
&lt;?xml version="1.0" encoding="ISO-8859-1" ?&gt; 
<br />
&lt;country name="sweden"&gt;
<br />
&nbsp;&nbsp;&nbsp; &lt;city name="stockholm"&gt;
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; &lt;user&gt;Adam&lt;/user&gt;
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; &lt;user&gt;Eve&lt;/user&gt;
<br />
&nbsp;&nbsp;&nbsp; &lt;/city&gt;
<br />
&nbsp;&nbsp;&nbsp; &lt;city name="g?teborg"&gt;
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; &lt;user&gt;God&lt;/user&gt;
<br />
&nbsp;&nbsp;&nbsp; &lt;/city&gt;
<br />
&lt;/country&gt;
<br />
&lt;country name="usa"&gt;
<br />
&nbsp;&nbsp;&nbsp; &lt;city name="new york"&gt;
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; &lt;user&gt;Clinton&lt;/user&gt;
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; &lt;user&gt;Bush&lt;/user&gt;
<br />
&nbsp;&nbsp;&nbsp; &lt;/city&gt;
<br />
&lt;/country&gt;
<br />

<br />
generates the following object structure:
<br />
[country] =&gt; Array
<br />
(
<br />
&nbsp;&nbsp;&nbsp; [0] =&gt; stdClass Object
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; (
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [name] =&gt; sweden
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [city] =&gt; Array
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; (
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [0] =&gt; stdClass Object
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; (
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [name] =&gt; stockholm
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [user] =&gt; Array
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; (
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [0] =&gt; Adam
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [1] =&gt; Eve
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; )
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; )
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [1] =&gt; stdClass Object
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; (
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [name] =&gt; g?teborg
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [user] =&gt; God
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; )
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; )
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; )
<br />
&nbsp;&nbsp;&nbsp; [1] =&gt; stdClass Object
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; (
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [name] =&gt; usa
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [city] =&gt; stdClass
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; (
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [name] =&gt; new york
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [user] =&gt; Array
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; (
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [0] =&gt; Clinton
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [1] =&gt; Bush
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; )
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; )
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; )
<br />
)
<br />

<br />
Here is the code:
<br />

<br />
class XMLParser {
<br />
&nbsp;&nbsp;&nbsp; var $path;
<br />
&nbsp;&nbsp;&nbsp; var $result;
<br />

<br />
&nbsp;&nbsp;&nbsp; function XMLParser($encoding, $data) {
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $this-&gt;path = "\$this-&gt;result";
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $this-&gt;index = 0;
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; 
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $xml_parser = xml_parser_create($encoding);
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; xml_set_object($xml_parser, &amp;$this);
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; xml_set_element_handler($xml_parser, 'startElement', 'endElement');
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; xml_set_character_data_handler($xml_parser, 'characterData');
<br />

<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; xml_parse($xml_parser, $data, true);
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; xml_parser_free($xml_parser);
<br />
&nbsp;&nbsp;&nbsp; }
<br />
&nbsp;&nbsp;&nbsp; 
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; function startElement($parser, $tag, $attributeList) {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; eval("\$vars = get_object_vars(".$this-&gt;path.");");
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $this-&gt;path .= "-&gt;".$tag;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if ($vars and array_key_exists($tag, $vars)) {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; eval("\$data = ".$this-&gt;path.";");
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (is_array($data)) {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $index = sizeof($data);
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $this-&gt;path .= "[".$index."]";
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; } else if (is_object($data)) {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; eval($this-&gt;path." = array(".$this-&gt;path.");");
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $this-&gt;path .= "[1]";
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; eval($this-&gt;path." = null;");
<br />

<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; foreach($attributeList as $name =&gt; $value)
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; eval($this-&gt;path."-&gt;".$name. " = '".XMLParser::cleanString($value)."';");
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; } 
<br />
&nbsp;&nbsp;&nbsp; 
<br />
&nbsp;&nbsp;&nbsp; function endElement($parser, $tag) {
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $this-&gt;path = substr($this-&gt;path, 0, strrpos($this-&gt;path, "-&gt;"));
<br />
&nbsp;&nbsp;&nbsp; }
<br />
&nbsp;&nbsp;&nbsp; 
<br />
&nbsp;&nbsp;&nbsp; function characterData($parser, $data) {
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; eval($this-&gt;path." = '".trim($data)."';");
<br />
&nbsp;&nbsp;&nbsp; }
<br />
}
<br />

<br />
enjoy! And please make it better if you can ;-)</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
</div>
</div>
</div></div></body></html>
