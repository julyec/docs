<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
 <head>
  <meta http-equiv="content-type" content="text/html; CHARSET=UTF-8">
  <title>将域名转换为 IDNA ASCII 格式</title>
<link media="all" rel="stylesheet" type="text/css" href="styles/03e73060321a0a848018724a6c83de7f-theme-base.css" />
<link media="all" rel="stylesheet" type="text/css" href="styles/03e73060321a0a848018724a6c83de7f-theme-medium.css" />

  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <link media="all" rel="stylesheet" type="text/css" href="style.css"/>
 </head>
 <body class="docs" class="docs"><div class="navbar navbar-fixed-top">
  <div class="navbar-inner clearfix">
    <ul class="nav" style="width: 100%">
      <li style="float: left;"><a href="ref.intl.idn.html">? IDN 函数</a></li>
      <li style="float: right;"><a href="function.idn-to-utf8.html">idn_to_utf8 ?</a></li>
    </ul>
  </div>
</div>
<div id="breadcrumbs" class="clearfix">
  <ul class="breadcrumbs-container">
    <li><a href="index.html">PHP Manual</a></li>
    <li><a href="ref.intl.idn.html">IDN 函数</a></li>
    <li>将域名转换为 IDNA ASCII 格式</li>
  </ul>
</div>
<div id="layout">
  <div id="layout-content"><div id="function.idn-to-ascii" class="refentry">
 <div class="refnamediv">
  <h1 class="refname">idn_to_ascii</h1>
  <p class="verinfo">(PHP 5 &gt;= 5.3.0, PHP 7, PHP 8, PECL intl &gt;= 1.0.2, PECL idn &gt;= 0.1)</p><p class="refpurpose"><span class="refname">idn_to_ascii</span> &mdash; <span class="dc-title">将域名转换为 IDNA ASCII 格式 </span></p>

 </div>
 <div class="refsect1 description" id="refsect1-function.idn-to-ascii-description">
  <h3 class="title">说明</h3>
  <p class="para">过程化风格</p>
  <div class="methodsynopsis dc-description">
   <span class="methodname"><strong>idn_to_ascii</strong></span>(<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="methodparam"><span class="type">string</span> <code class="parameter">$domain</code></span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="methodparam"><span class="type">int</span> <code class="parameter">$flags</code><span class="initializer"> = <strong><code>IDNA_DEFAULT</code></strong></span></span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="methodparam"><span class="type">int</span> <code class="parameter">$variant</code><span class="initializer"> = <strong><code>INTL_IDNA_VARIANT_UTS46</code></strong></span></span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="methodparam"><span class="type">array</span> <code class="parameter reference">&$idna_info</code><span class="initializer"> = <strong><code>null</code></strong></span></span><br>): <span class="type"><span class="type">string</span>|<span class="type"><span class="type false">false</span></span></span></div>

  <p class="para rdfs-comment">
   该函数可以将 Unicode 域名转换为 IDNA ASCII 兼容格式。
  </p> 
  </div>


 <div class="refsect1 parameters" id="refsect1-function.idn-to-ascii-parameters">
  <h3 class="title">参数</h3>
  <p class="para">
   <dl>
    
     <dt>
<code class="parameter">domain</code></dt>

     <dd>

      <p class="para">
       要转换的域，必须使用 UTF-8 编码。
      </p>
     </dd>

    
    
     <dt>
<code class="parameter">flags</code></dt>

     <dd>

      <p class="para">
       转换选项 &mdash; IDNA_* 开头的常量（除 IDNA_ERROR_* 开头的常量）。
      </p>
     </dd>

    
    
     <dt>
<code class="parameter">variant</code></dt>

     <dd>

      <p class="para">
       对于 IDNA 2003 是 <strong><code>INTL_IDNA_VARIANT_2003</code></strong> (自 PHP 7.2.0 起已弃用)，
       对于 UTS #46 是 <strong><code>INTL_IDNA_VARIANT_UTS46</code></strong> (仅 ICU 4.6 起可用)。
      </p>
     </dd>

    
    
     <dt>
<code class="parameter">idna_info</code></dt>

     <dd>

      <p class="para">
       仅当 <strong><code>INTL_IDNA_VARIANT_UTS46</code></strong> 用于 <code class="parameter">variant</code> 时，才可以使用该参数。
       在这种情况下，它将用这些键组成的数组来填充：
       <code class="literal">&#039;result&#039;</code> 键，转换结果（有可能是一个非法结果）；
       <code class="literal">&#039;isTransitionalDifferent&#039;</code> 键，布尔值，指示使用 UTS #46 的过滤机制是否会改变结果；
       <code class="literal">&#039;errors&#039;</code> 键，是 IDNA_ERROR_* 常量集里一个常量对应的 <span class="type">int</span> 。
      </p>
     </dd>

    
   </dl>

  </p>
 </div>

 
 <div class="refsect1 returnvalues" id="refsect1-function.idn-to-ascii-returnvalues">
  <h3 class="title">返回值</h3>
  <p class="para">
   IDNA ASCII 兼容格式编码的域名，  或者在失败时返回 <strong><code>false</code></strong>
  </p>
 </div>


 <div class="refsect1 changelog" id="refsect1-function.idn-to-ascii-changelog">
  <h3 class="title">更新日志</h3>
  <p class="para">
   <table class="doctable informaltable">
    
     <thead>
      <tr>
       <th>版本</th>
       <th>说明</th>
      </tr>

     </thead>

     <tbody class="tbody">
      <tr>
       <td>7.4.0</td>
       <td>
        现在 <code class="parameter">variant</code> 的默认值为 <strong><code>INTL_IDNA_VARIANT_UTS46</code></strong> ，
        而不是已弃用的 <strong><code>INTL_IDNA_VARIANT_2003</code></strong> 。
       </td>
      </tr>

      <tr>
       <td>7.2.0</td>
       <td>
        <strong><code>INTL_IDNA_VARIANT_2003</code></strong> 已被弃用；
        可以使用 <strong><code>INTL_IDNA_VARIANT_UTS46</code></strong> 代替。
       </td>
      </tr>

     </tbody>
    
   </table>

  </p>
 </div>

 
 <div class="refsect1 examples" id="refsect1-function.idn-to-ascii-examples">
  <h3 class="title">示例</h3>
  <div class="example" id="example-5094">
   <p><strong>Example #1 <span class="function"><strong>idn_to_ascii()</strong></span> 示例</strong></p>
   <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br /><br /></span><span style="color: #007700">echo </span><span style="color: #0000BB">idn_to_ascii</span><span style="color: #007700">(</span><span style="color: #DD0000">'t?st.de'</span><span style="color: #007700">); <br /><br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
   </div>

  </div>
  <p class="para">以上示例会输出：</p>
  <div class="example-contents screen">
<div class="cdata"><pre>
xn--tst-qla.de
</pre></div>
  </div>
 </div>


 <div class="refsect1 seealso" id="refsect1-function.idn-to-ascii-seealso">
  <h3 class="title">参见</h3>
  <p class="para">
   <ul class="simplelist">
    <li class="member"><span class="function"><a href="function.idn-to-utf8.html" class="function" rel="rdfs-seeAlso">idn_to_utf8()</a> - 将域名从 IDNA ASCII 转换为 Unicode</span></li>
   </ul>
  </p>
 </div>

</div><div id="usernotes">
 <div class="head">
  <h3 class="title">User Contributed Notes</h3>
 </div>
<div id="allnotes">  <a name="125560""></a>
  <div class="note">
   <strong class="user">waxblur at gmx dot at</strong>
   <a href="#125560" class="date">02-Dec-2020 09:16</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
In Windows, the path to the PHP folder must still be present in the PATH environment variable, becouse the necessary DLLs (icudt65.dll, icuin65.dll etc.) are available in this folder.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="120917""></a>
  <div class="note">
   <strong class="user">mschrieck at gmail dot com</strong>
   <a href="#120917" class="date">31-Mar-2017 01:03</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
To convert IDN Domains with the IDNA2008 definition use following command.<br />
<br />
idn_to_ascii('te?t.com',IDNA_NONTRANSITIONAL_TO_ASCII,INTL_IDNA_VARIANT_UTS46)<br />
<br />
The result is then as expected<br />
<br />
xn--tet-6ka.com</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="108900""></a>
  <div class="note">
   <strong class="user">edible dot email at gmail dot com</strong>
   <a href="#108900" class="date">03-Jun-2012 05:08</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
The notes on this function are not very clear and a little misleading.
<br />

<br />
Firstly, &lt;=5.3, you will need to make use of one of several scripts or classes available on the internet which might, or might not, require the installation of of the intl and idn PECL extensions ...and you will need to have !&lt;4.0 in order to be able to install both.
<br />

<br />
Secondly, if you have &gt;=5.4 you will not require the PECL extensions.
<br />

<br />
Third, use of utf8_encode() is not necessary.&nbsp; In fact, it will potentially prevent idn_to_ascii() from working at all.
<br />

<br />
On my setup it was necessary to change the charset in the script meta tags to UTF-8:
<br />

<br />
&lt;meta http-equiv="Content-Type" content="text/html; CHARSET=gb2312" /&gt;
<br />

<br />
...and to change charset_default in the php.ini file (/usr/local/lib/php.ini, whereis php.ini, find / -name php.ini):
<br />

<br />
default_charset = "UTF-8"
<br />

<br />
The above changes mean that idn_to_ascii() can now be used with that syntax (no need for utf8_encode()).&nbsp; Previously, the function worked to convert some IDNs, but failed to convert Japanese and Cyrillic IDNs.&nbsp; Further, no additional locales were enabled or added, and Apache's charset file was left unmodified.
<br />

<br />
It is also important to remember only to apply the function where required, eg:
<br />

<br />
idn_to_ascii(c?sino.com) // is wrong
<br />

<br />
...whereas...
<br />

<br />
iden_to_ascii(c?sino) // is right
<br />

<br />
...and also be aware of text editors that don't support UTF-8 encoding, or the $domain = 'c?sino' value will end up as $domain = '??????' ...and the function will fail.
<br />

<br />
I have found that Notepad++ easily and reliably handles UTF-8 encoding that works for this function using UTF-8 as the encoding option, not UTF-8 without BOM.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
</div>
</div>
</div></div></body></html>
