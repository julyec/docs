<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
 <head>
  <meta http-equiv="content-type" content="text/html; CHARSET=UTF-8">
  <title>返回指定的所有对象，包括它们各自的对象 ID</title>
<link media="all" rel="stylesheet" type="text/css" href="styles/03e73060321a0a848018724a6c83de7f-theme-base.css" />
<link media="all" rel="stylesheet" type="text/css" href="styles/03e73060321a0a848018724a6c83de7f-theme-medium.css" />

  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <link media="all" rel="stylesheet" type="text/css" href="style.css"/>
 </head>
 <body class="docs" class="docs"><div class="navbar navbar-fixed-top">
  <div class="navbar-inner clearfix">
    <ul class="nav" style="width: 100%">
      <li style="float: left;"><a href="function.snmpgetnext.html">? snmpgetnext</a></li>
      <li style="float: right;"><a href="function.snmpset.html">snmpset ?</a></li>
    </ul>
  </div>
</div>
<div id="breadcrumbs" class="clearfix">
  <ul class="breadcrumbs-container">
    <li><a href="index.html">PHP Manual</a></li>
    <li><a href="ref.snmp.html">SNMP 函数</a></li>
    <li>返回指定的所有对象，包括它们各自的对象 ID</li>
  </ul>
</div>
<div id="layout">
  <div id="layout-content"><div id="function.snmprealwalk" class="refentry">
 <div class="refnamediv">
  <h1 class="refname">snmprealwalk</h1>
  <p class="verinfo">(PHP 4, PHP 5, PHP 7, PHP 8)</p><p class="refpurpose"><span class="refname">snmprealwalk</span> &mdash; <span class="dc-title">
   返回指定的所有对象，包括它们各自的对象 ID
  </span></p>

 </div>
 <div class="refsect1 description" id="refsect1-function.snmprealwalk-description">
  <h3 class="title">说明</h3>
  <div class="methodsynopsis dc-description">
   <span class="methodname"><strong>snmprealwalk</strong></span>(<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="methodparam"><span class="type">string</span> <code class="parameter">$hostname</code></span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="methodparam"><span class="type">string</span> <code class="parameter">$community</code></span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="methodparam"><span class="type"><span class="type">array</span>|<span class="type">string</span></span> <code class="parameter">$object_id</code></span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="methodparam"><span class="type">int</span> <code class="parameter">$timeout</code><span class="initializer"> = -1</span></span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="methodparam"><span class="type">int</span> <code class="parameter">$retries</code><span class="initializer"> = -1</span></span><br>): <span class="type"><span class="type">array</span>|<span class="type"><span class="type false">false</span></span></span></div>

  <p class="para rdfs-comment">
   <span class="function"><strong>snmprealwalk()</strong></span> 函数用于遍历从 <code class="parameter">object_id</code> 开始的多个 <abbr title="Simple Network Management Protocol">SNMP</abbr> 对象，不仅返回它们的值，还返回它们的对象 ID。
  </p> 
 </div>

 
 <div class="refsect1 parameters" id="refsect1-function.snmprealwalk-parameters">
  <h3 class="title">参数</h3>
  <p class="para">
   <dl>
    
     <dt>
<code class="parameter">hostname</code></dt>

     <dd>
<p class="para"><abbr title="Simple Network Management Protocol">SNMP</abbr> 代理（服务器）的主机名。</p></dd>

    
    
     <dt>
<code class="parameter">community</code></dt>

     <dd>
<p class="para">The read community.</p></dd>

    
    
     <dt>
<code class="parameter">object_id</code></dt>

     <dd>
<p class="para">在所需对象之前的 <abbr title="Simple Network Management Protocol">SNMP</abbr> 对象 ID。</p></dd>

    
    
     <dt>
<code class="parameter">timeout</code></dt>

     <dd>
<p class="para">第一次超时前的微秒数。</p></dd>

    
    
     <dt>
<code class="parameter">retries</code></dt>

     <dd>
<p class="para">发生超时时重试的次数。</p></dd>

    
   </dl>

  </p>
 </div>

 
 <div class="refsect1 returnvalues" id="refsect1-function.snmprealwalk-returnvalues">
  <h3 class="title">返回值</h3>
  <p class="para">
   成功时返回 <abbr title="Simple Network Management Protocol">SNMP</abbr> 对象 ID 及其值的关联数组，错误时返回 <strong><code>false</code></strong>。如果出现错误，将显示一条 E_WARNING 消息。
  </p>
 </div>

 
 <div class="refsect1 examples" id="refsect1-function.snmprealwalk-examples">
  <h3 class="title">示例</h3>
  <p class="para">
   <div class="example" id="">
    <p><strong>Example #1 使用 <span class="function"><strong>snmprealwalk()</strong></span></strong></p>
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br /> print_r</span><span style="color: #007700">(</span><span style="color: #0000BB">snmprealwalk</span><span style="color: #007700">(</span><span style="color: #DD0000">"localhost"</span><span style="color: #007700">, </span><span style="color: #DD0000">"public"</span><span style="color: #007700">, </span><span style="color: #DD0000">"IF-MIB::ifName"</span><span style="color: #007700">));<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
    </div>

    
    <div class="example-contents"><p>
     以上将输出如下内容：
<div class="cdata"><pre>     
    Array
      (
      [IF-MIB::ifName.1] =&gt; STRING: lo
      [IF-MIB::ifName.2] =&gt; STRING: eth0
      [IF-MIB::ifName.3] =&gt; STRING: eth2
      [IF-MIB::ifName.4] =&gt; STRING: sit0
      [IF-MIB::ifName.5] =&gt; STRING: sixxs
    )
</pre></div>
    </p></div>
   </div>
  </p>
 </div>

 
 <div class="refsect1 seealso" id="refsect1-function.snmprealwalk-seealso">
  <h3 class="title">参见</h3>
  <p class="para">
   <ul class="simplelist">
    <li class="member"><span class="function"><a href="function.snmpwalk.html" class="function" rel="rdfs-seeAlso">snmpwalk()</a> - 从代理获取所有 SNMP 对象</span></li>
   </ul>
  </p>
 </div>

</div><div id="usernotes">
 <div class="head">
  <h3 class="title">User Contributed Notes</h3>
 </div>
<div id="allnotes">  <a name="93039""></a>
  <div class="note">
   <strong class="user">aleksander dot sztramski at kpsi dot pl</strong>
   <a href="#93039" class="date">20-Aug-2009 04:39</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you wish to use version 2c or 3, use the following functions:<br />
<br />
snmp v2c functions:<br />
<br />
snmp2_get (string host, string community, string object_id [, int timeout [, int retries]])<br />
snmp2_getnext (string host, string community, string object_id [, int timeout [, int retries]])<br />
snmp2_walk (string host, string community, string object_id [, int timeout [, int retries]])<br />
snmp2_real_walk (string host, string community, string object_id [, int timeout [, int retries]])<br />
snmp2_set (string host, string community, string object_id, string type, mixed value [, int timeout [, int retries]])<br />
<br />
snmp v3 functions:<br />
<br />
snmp3_get (string host, string sec_name, string sec_level, string auth_protocol, string auth_passphrase, string priv_pr)<br />
snmp3_getnext (string host, string sec_name, string sec_level, string auth_protocol, string auth_passphrase, string pri)<br />
snmp3_walk (string host, string sec_name, string sec_level, string auth_protocol, string auth_passphrase, string priv_p)<br />
snmp3_real_walk (string host, string sec_name, string sec_level, string auth_protocol, string auth_passphrase, string p)<br />
snmp3_set (string host, string sec_name, string sec_level, string auth_protocol, string auth_passphrase, string priv_pr)</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="83346""></a>
  <div class="note">
   <strong class="user">Anonymous</strong>
   <a href="#83346" class="date">21-May-2008 10:19</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
To check if there were any results found you have to use the empty() function.&nbsp; The count() function always returns a number 1 or larger.<br />
<br />
&nbsp;&nbsp; &nbsp; $walk_result = snmprealwalk($machine_ip, $community, $snmpcodes['interface_names']);<br />
<br />
&nbsp;&nbsp;&nbsp; if (empty($walk_result)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; print "No network interfaces found.&lt;br&gt;\n";<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; exit(0);<br />
&nbsp;&nbsp;&nbsp; }</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="68759""></a>
  <div class="note">
   <strong class="user">scot at indievisible dot org</strong>
   <a href="#68759" class="date">09-Aug-2006 12:10</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Some improvements based on testing a lot of OIDs on a lot of devices.<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">function </span><span class="default">snmptable</span><span class="keyword">(</span><span class="default">$host</span><span class="keyword">, </span><span class="default">$community</span><span class="keyword">, </span><span class="default">$oid</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// TODO: get original state and restore at bottom<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">snmp_set_oid_numeric_print</span><span class="keyword">(</span><span class="default">TRUE</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">snmp_set_quick_print</span><span class="keyword">(</span><span class="default">TRUE</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">snmp_set_enum_print</span><span class="keyword">(</span><span class="default">TRUE</span><span class="keyword">); <br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$retval </span><span class="keyword">= array();<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$raw </span><span class="keyword">= </span><span class="default">snmprealwalk</span><span class="keyword">(</span><span class="default">$host</span><span class="keyword">, </span><span class="default">$community</span><span class="keyword">, </span><span class="default">$oid</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; if (</span><span class="default">count</span><span class="keyword">(</span><span class="default">$raw</span><span class="keyword">) == </span><span class="default">0</span><span class="keyword">) return (</span><span class="default">$retval</span><span class="keyword">); </span><span class="comment">// no data<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$prefix_length </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">; <br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$largest </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; foreach (</span><span class="default">$raw </span><span class="keyword">as </span><span class="default">$key </span><span class="keyword">=&gt; </span><span class="default">$value</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">$prefix_length </span><span class="keyword">== </span><span class="default">0</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// don't just use $oid's length since it may be non-numeric<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$prefix_elements </span><span class="keyword">= </span><span class="default">count</span><span class="keyword">(</span><span class="default">explode</span><span class="keyword">(</span><span class="string">'.'</span><span class="keyword">,</span><span class="default">$oid</span><span class="keyword">));<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$tmp </span><span class="keyword">= </span><span class="string">'.' </span><span class="keyword">. </span><span class="default">strtok</span><span class="keyword">(</span><span class="default">$key</span><span class="keyword">, </span><span class="string">'.'</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; while (</span><span class="default">$prefix_elements </span><span class="keyword">&gt; </span><span class="default">1</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$tmp </span><span class="keyword">.= </span><span class="string">'.' </span><span class="keyword">. </span><span class="default">strtok</span><span class="keyword">(</span><span class="string">'.'</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$prefix_elements</span><span class="keyword">--;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$tmp </span><span class="keyword">.= </span><span class="string">'.'</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$prefix_length </span><span class="keyword">= </span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$tmp</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$key </span><span class="keyword">= </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$key</span><span class="keyword">, </span><span class="default">$prefix_length</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$index </span><span class="keyword">= </span><span class="default">explode</span><span class="keyword">(</span><span class="string">'.'</span><span class="keyword">, </span><span class="default">$key</span><span class="keyword">, </span><span class="default">2</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; isset(</span><span class="default">$retval</span><span class="keyword">[</span><span class="default">$index</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">]]) or </span><span class="default">$retval</span><span class="keyword">[</span><span class="default">$index</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">]] = array();<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">$largest </span><span class="keyword">&lt; </span><span class="default">$index</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">]) </span><span class="default">$largest </span><span class="keyword">= </span><span class="default">$index</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">];<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$retval</span><span class="keyword">[</span><span class="default">$index</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">]][</span><span class="default">$index</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">]] = </span><span class="default">$value</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp;&nbsp; if (</span><span class="default">count</span><span class="keyword">(</span><span class="default">$retval</span><span class="keyword">) == </span><span class="default">0</span><span class="keyword">) return (</span><span class="default">$retval</span><span class="keyword">); </span><span class="comment">// no data<br />
<br />
&nbsp;&nbsp;&nbsp; // fill in holes and blanks the agent may "give" you<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">foreach(</span><span class="default">$retval </span><span class="keyword">as </span><span class="default">$k </span><span class="keyword">=&gt; </span><span class="default">$x</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; for (</span><span class="default">$i </span><span class="keyword">= </span><span class="default">1</span><span class="keyword">; </span><span class="default">$i </span><span class="keyword">&lt;= </span><span class="default">$largest</span><span class="keyword">; </span><span class="default">$i</span><span class="keyword">++) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (! isset(</span><span class="default">$retval</span><span class="keyword">[</span><span class="default">$k</span><span class="keyword">][</span><span class="default">$i</span><span class="keyword">])) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$retval</span><span class="keyword">[</span><span class="default">$k</span><span class="keyword">][</span><span class="default">$i</span><span class="keyword">] = </span><span class="string">''</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">ksort</span><span class="keyword">(</span><span class="default">$retval</span><span class="keyword">[</span><span class="default">$k</span><span class="keyword">]);<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; return(</span><span class="default">$retval</span><span class="keyword">);<br />
}<br />
&nbsp;</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="68754""></a>
  <div class="note">
   <strong class="user">scot at indievisible dot org</strong>
   <a href="#68754" class="date">09-Aug-2006 08:16</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Since PHP doesn't have a nice snmptable-like function... here is a quick-and-dirty hack that works for me. Works on complete and sparse tables. The example oids are for the route (complete) and interface (often sparse) tables.<br />
<br />
<span class="default">&lt;?php<br />
&nbsp;&nbsp;&nbsp; $a </span><span class="keyword">= </span><span class="default">snmptable</span><span class="keyword">(</span><span class="string">"10.1.1.1"</span><span class="keyword">, </span><span class="string">"public"</span><span class="keyword">, </span><span class="string">".1.3.6.1.2.1.4.21"</span><span class="keyword">) or die(</span><span class="string">"error"</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">print_r</span><span class="keyword">(</span><span class="default">$a</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$a </span><span class="keyword">= </span><span class="default">snmptable</span><span class="keyword">(</span><span class="string">"10.1.1.1"</span><span class="keyword">, </span><span class="string">"public"</span><span class="keyword">, </span><span class="string">".1.3.6.1.2.1.2.2"</span><span class="keyword">) or die(</span><span class="string">"error"</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">print_r</span><span class="keyword">(</span><span class="default">$a</span><span class="keyword">);<br />
<br />
function </span><span class="default">snmptable</span><span class="keyword">(</span><span class="default">$host</span><span class="keyword">, </span><span class="default">$community</span><span class="keyword">, </span><span class="default">$oid</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// TODO: get original state and restore at bottom<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">snmp_set_oid_numeric_print</span><span class="keyword">(</span><span class="default">TRUE</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">snmp_set_quick_print</span><span class="keyword">(</span><span class="default">TRUE</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">snmp_set_enum_print</span><span class="keyword">(</span><span class="default">TRUE</span><span class="keyword">); <br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$retval </span><span class="keyword">= array();<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$raw </span><span class="keyword">= </span><span class="default">snmprealwalk</span><span class="keyword">(</span><span class="default">$host</span><span class="keyword">, </span><span class="default">$community</span><span class="keyword">, </span><span class="default">$oid</span><span class="keyword">) or die(</span><span class="string">"snmptable: unable to walk OID </span><span class="default">$oid</span><span class="string">"</span><span class="keyword">);<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$prefix_length </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">; <br />
<br />
&nbsp;&nbsp;&nbsp; foreach (</span><span class="default">$raw </span><span class="keyword">as </span><span class="default">$key </span><span class="keyword">=&gt; </span><span class="default">$value</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">$prefix_length </span><span class="keyword">== </span><span class="default">0</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// don't just use $oid's length since it may be non-numeric<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$prefix_elements </span><span class="keyword">= </span><span class="default">count</span><span class="keyword">(</span><span class="default">explode</span><span class="keyword">(</span><span class="string">'.'</span><span class="keyword">,</span><span class="default">$oid</span><span class="keyword">));<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$tmp </span><span class="keyword">= </span><span class="string">'.' </span><span class="keyword">. </span><span class="default">strtok</span><span class="keyword">(</span><span class="default">$key</span><span class="keyword">, </span><span class="string">'.'</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; while (</span><span class="default">$prefix_elements </span><span class="keyword">&gt; </span><span class="default">1</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$tmp </span><span class="keyword">.= </span><span class="string">'.' </span><span class="keyword">. </span><span class="default">strtok</span><span class="keyword">(</span><span class="string">'.'</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$prefix_elements</span><span class="keyword">--;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$tmp </span><span class="keyword">.= </span><span class="string">'.'</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$prefix_length </span><span class="keyword">= </span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$tmp</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$key </span><span class="keyword">= </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$key</span><span class="keyword">, </span><span class="default">$prefix_length</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$index </span><span class="keyword">= </span><span class="default">explode</span><span class="keyword">(</span><span class="string">'.'</span><span class="keyword">, </span><span class="default">$key</span><span class="keyword">, </span><span class="default">2</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; isset(</span><span class="default">$retval</span><span class="keyword">[</span><span class="default">$index</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">]]) or </span><span class="default">$retval</span><span class="keyword">[</span><span class="default">$index</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">]] = array();<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; isset(</span><span class="default">$firstrow</span><span class="keyword">) or </span><span class="default">$firstrow </span><span class="keyword">= </span><span class="default">$index</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">];<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$retval</span><span class="keyword">[</span><span class="default">$index</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">]][</span><span class="default">$index</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">]] = </span><span class="default">$value</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// check for holes in the table and fill them in<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">foreach (</span><span class="default">$retval</span><span class="keyword">[</span><span class="default">$firstrow</span><span class="keyword">] as </span><span class="default">$key </span><span class="keyword">=&gt; </span><span class="default">$tmp</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; foreach(</span><span class="default">$retval </span><span class="keyword">as </span><span class="default">$check </span><span class="keyword">=&gt; </span><span class="default">$tmp2</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (! isset(</span><span class="default">$retval</span><span class="keyword">[</span><span class="default">$check</span><span class="keyword">][</span><span class="default">$key</span><span class="keyword">])) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$retval</span><span class="keyword">[</span><span class="default">$check</span><span class="keyword">][</span><span class="default">$key</span><span class="keyword">] = </span><span class="string">''</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp;&nbsp; return(</span><span class="default">$retval</span><span class="keyword">);<br />
}<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="66830""></a>
  <div class="note">
   <strong class="user">railson at amixsi dot com dot br</strong>
   <a href="#66830" class="date">30-May-2006 10:52</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Attention: timeout is in microseconds (multiply by 1,000,000 for seconds)</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="45540""></a>
  <div class="note">
   <strong class="user">Stephen Cope</strong>
   <a href="#45540" class="date">09-Sep-2004 08:38</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Here's a way to find the uptime and number of users on a machine. (Note that uptime is the uptime of the snmpd daemon, which should be fairly close to the uptime for the host.)<br />
<br />
<span class="default">&lt;?php<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $state </span><span class="keyword">= </span><span class="default">snmprealwalk</span><span class="keyword">(</span><span class="default">$host</span><span class="keyword">, </span><span class="string">"public"</span><span class="keyword">, </span><span class="string">".1.3.6.1.2.1.25.1"</span><span class="keyword">, </span><span class="default">50</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$uptime </span><span class="keyword">= </span><span class="default">ereg_replace</span><span class="keyword">(</span><span class="string">"^.*\) ([0-9]+ .*):[0-9][0-9]\.[0-9]{2}.*$"</span><span class="keyword">, </span><span class="string">"\\1"</span><span class="keyword">, </span><span class="default">$state</span><span class="keyword">[</span><span class="string">'host.hrSystem.hrSystemUptime.0'</span><span class="keyword">]);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$users&nbsp; </span><span class="keyword">= (int)</span><span class="default">ereg_replace</span><span class="keyword">(</span><span class="string">"Gauge32: "</span><span class="keyword">, </span><span class="string">""</span><span class="keyword">, </span><span class="default">$state</span><span class="keyword">[</span><span class="string">'host.hrSystem.hrSystemNumUsers.0'</span><span class="keyword">]);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">printf</span><span class="keyword">(</span><span class="string">'&lt;div class="machine"&gt;&lt;dt&gt;%s&lt;/dt&gt;&lt;dd&gt;%s&lt;/dd&gt;'</span><span class="keyword">, </span><span class="default">$host</span><span class="keyword">, </span><span class="default">$desc</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">printf</span><span class="keyword">(</span><span class="string">'&lt;dd&gt;up %s&lt;/dd&gt;'</span><span class="keyword">, </span><span class="default">$uptime</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if ( </span><span class="default">$users </span><span class="keyword">) </span><span class="default">printf</span><span class="keyword">(</span><span class="string">'&lt;dd&gt;%d user%s&lt;/dd&gt;'</span><span class="keyword">, </span><span class="default">$users</span><span class="keyword">, (</span><span class="default">$users </span><span class="keyword">&gt; </span><span class="default">1</span><span class="keyword">) ? </span><span class="string">'s' </span><span class="keyword">: </span><span class="string">''</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">printf</span><span class="keyword">(</span><span class="string">'&lt;/div&gt;'</span><span class="keyword">);<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="29754""></a>
  <div class="note">
   <strong class="user">Lars Troen</strong>
   <a href="#29754" class="date">24-Feb-2003 05:30</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
snmprealwalk indexes the values using the oid instead of an integer. This is useful when you need data that is contained in the oid as well as the value. <br />
<br />
Here's an example for retrieving and printing vlan info:<br />
//<br />
// I have collected the vlan identifiers earlier from the 3com mib and they are stored in the $vlan table.<br />
// <br />
&nbsp; for($n=0;$n&lt;count($vlan);$n++){<br />
&nbsp;&nbsp;&nbsp; print $vlan[$n][id]."&nbsp; ".$vlan[$n][name]."&lt;br&gt;\n";<br />
&nbsp;&nbsp;&nbsp; $ifStackStatusTable=@snmprealwalk($switch, $community, ".1.3.6.1.2.1.31.1.2.1.3.".$vlan[$n][id]); // ifMIB.ifMIBObjects.ifStackTable.ifStackEntry.ifStackStatus<br />
&nbsp;&nbsp;&nbsp; for(reset($ifStackStatusTable);&nbsp; $port = key($ifStackStatusTable);&nbsp; next($ifStackStatusTable)){<br />
&nbsp;&nbsp; &nbsp;&nbsp; print "$port=$ifStackStatusTable[$port]&lt;br&gt;";<br />
&nbsp;&nbsp; &nbsp;&nbsp; }</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
</div>
</div>
</div></div></body></html>
