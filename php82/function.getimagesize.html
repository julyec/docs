<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
 <head>
  <meta http-equiv="content-type" content="text/html; CHARSET=UTF-8">
  <title>取得图像大小</title>
<link media="all" rel="stylesheet" type="text/css" href="styles/03e73060321a0a848018724a6c83de7f-theme-base.css" />
<link media="all" rel="stylesheet" type="text/css" href="styles/03e73060321a0a848018724a6c83de7f-theme-medium.css" />

  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <link media="all" rel="stylesheet" type="text/css" href="style.css"/>
 </head>
 <body class="docs" class="docs"><div class="navbar navbar-fixed-top">
  <div class="navbar-inner clearfix">
    <ul class="nav" style="width: 100%">
      <li style="float: left;"><a href="function.gd-info.html">? gd_info</a></li>
      <li style="float: right;"><a href="function.getimagesizefromstring.html">getimagesizefromstring ?</a></li>
    </ul>
  </div>
</div>
<div id="breadcrumbs" class="clearfix">
  <ul class="breadcrumbs-container">
    <li><a href="index.html">PHP Manual</a></li>
    <li><a href="ref.image.html">GD 和图像处理 函数</a></li>
    <li>取得图像大小</li>
  </ul>
</div>
<div id="layout">
  <div id="layout-content"><div id="function.getimagesize" class="refentry">
 <div class="refnamediv">
  <h1 class="refname">getimagesize</h1>
  <p class="verinfo">(PHP 4, PHP 5, PHP 7, PHP 8)</p><p class="refpurpose"><span class="refname">getimagesize</span> &mdash; <span class="dc-title">取得图像大小</span></p>

 </div>
 <div class="refsect1 description" id="refsect1-function.getimagesize-description">
  <h3 class="title">说明</h3>
  <div class="methodsynopsis dc-description">
   <span class="methodname"><strong>getimagesize</strong></span>(<span class="methodparam"><span class="type">string</span> <code class="parameter">$filename</code></span>, <span class="methodparam"><span class="type">array</span> <code class="parameter reference">&$image_info</code><span class="initializer"> = <strong><code>null</code></strong></span></span>): <span class="type"><span class="type">array</span>|<span class="type"><span class="type false">false</span></span></span></div>

  <p class="para rdfs-comment">
   <span class="function"><strong>getimagesize()</strong></span> 函数将确定任何支持的指定图像文件的大小，并返回尺寸以及文件类型和
   <code class="literal">height/width</code> 文本字符串，以在标准 <abbr title="Hyper Text Markup Language">HTML</abbr> <code class="tag">IMG</code>
   标签和对应的 <abbr title="Hypertext Transfer Protocol">HTTP</abbr> 内容类型中使用。
  </p>
  <p class="para">
   <span class="function"><strong>getimagesize()</strong></span> 还可以在 <code class="parameter">image_info</code> 参数中返回更多信息。
  </p>
  <div class="caution"><strong class="caution">Caution</strong>
   <p class="para">
    此函数要求 <code class="parameter">filename</code> 是有效的图像文件。如果提供的是非图像，可能会错误的识别为图像且函数会成功返回，但数组可能包含无意义的值。
   </p>
   <p class="para">
    不要使用 <span class="function"><strong>getimagesize()</strong></span> 识别指定的文件是否是有效的图像。请使用专业解决方案，比如
    <a href="book.fileinfo.html" class="link">Fileinfo</a> 扩展。
   </p>
  </div>
  <blockquote class="note"><p><strong class="note">Note</strong>: 
   <span class="simpara">
    注意 JPC 和 JP2 是具有不同位深度的组件。此外，JP2 文件可能包含有<code class="literal">多个 JPEG 2000
    代码流</code>，此情况下，<span class="function"><strong>getimagesize()</strong></span>
    返回此文件顶层中碰到的第一个代码流的值。
   </span>
  </p></blockquote>
  <blockquote class="note"><p><strong class="note">Note</strong>: 
   <span class="simpara">
    从具有最高比特率的 icon 中检索有关 icon 的信息。
   </span>
  </p></blockquote>
  <blockquote class="note"><p><strong class="note">Note</strong>: 
   <span class="simpara">
    GIF 图像由一个或多个帧组成，其中每个帧可能只占据图像的一部分。<span class="function"><strong>getimagesize()</strong></span> 报告的图像大小是整体大小（从逻辑屏幕描述符中读取）。
   </span>
  </p></blockquote>
 </div>

 
 <div class="refsect1 parameters" id="refsect1-function.getimagesize-parameters">
  <h3 class="title">参数</h3>
  <p class="para">
   <dl>
    
     <dt>
<code class="parameter">filename</code></dt>

     <dd>

      <p class="para">
       此参数指定希望检索其信息的文件。可以指向本地文件或（配置允许）使用某个<a href="wrappers.html" class="link">支持的流</a>的远程文件。
      </p>
     </dd>

    
    
     <dt>
<code class="parameter">image_info</code></dt>

     <dd>

      <p class="para">
       可选参数允许从图像文件中提取一些扩展信息。目前会将不同的 <abbr>JPG</abbr> APP
       标记作为关联数组返回。一些程序使用这些 APP 标记在图像中嵌入文本信息。
       A very common one is to embed 
       <a href="http://www.iptc.org/" class="link external" title="Link : http://www.iptc.org/">&raquo;&nbsp;IPTC</a> information in the APP13 marker.
       You can use the <span class="function"><a href="function.iptcparse.html" class="function">iptcparse()</a></span> function to parse the
       binary APP13 marker into something readable.
      </p>
      <blockquote class="note"><p><strong class="note">Note</strong>: 
       <p class="para">
        <code class="parameter">image_info</code> 仅支持 <abbr>JFIF</abbr> 文件。
       </p>
      </p></blockquote>
     </dd>

    
   </dl>

  </p>
 </div>

 
 <div class="refsect1 returnvalues" id="refsect1-function.getimagesize-returnvalues">
  <h3 class="title">返回值</h3>
  <p class="para">
   返回信息最多包含 7 个元素。并非所有图像类型都包含 <code class="literal">channels</code> 和 <code class="literal">bits</code> 元素。
  </p>
  <p class="para">
   索引 0 和 1 分别包含图像的宽度和高度。
  </p>
  <blockquote class="note"><p><strong class="note">Note</strong>: 
   <p class="para">
    一些格式可能没有图像或者包含多个图像。在这种情况下，<span class="function"><strong>getimagesize()</strong></span>
    可能无法正确确定图像大小。<span class="function"><strong>getimagesize()</strong></span> 此时会返回的宽高为 0。
   </p>
  </p></blockquote>
  <p class="para">
   索引 2 是表示图像类型的某个 <a href="image.constants.html" class="link">IMAGETYPE_XXX 常量</a>。
  </p>
  <p class="para">
   Index 3 is a text string with the correct 
   <code class="literal">height=&quot;yyy&quot; width=&quot;xxx&quot;</code> string that can be used
   directly in an <abbr>IMG</abbr> tag.
  </p>
  <p class="para">
   <code class="literal">mime</code> 是图像对应的 MIME 类型。此信息可用于传递具有正确 HTTP 
   <code class="literal">Content-type</code> 报头的图像：
   <div class="example" id="example-5350">
    <p><strong>Example #1 <span class="function"><strong>getimagesize()</strong></span> 和 MIME 类型</strong></p>
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br />$size </span><span style="color: #007700">= </span><span style="color: #0000BB">getimagesize</span><span style="color: #007700">(</span><span style="color: #0000BB">$filename</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">$fp </span><span style="color: #007700">= </span><span style="color: #0000BB">fopen</span><span style="color: #007700">(</span><span style="color: #0000BB">$filename</span><span style="color: #007700">, </span><span style="color: #DD0000">"rb"</span><span style="color: #007700">);<br />if (</span><span style="color: #0000BB">$size </span><span style="color: #007700">&amp;&amp; </span><span style="color: #0000BB">$fp</span><span style="color: #007700">) {<br />    </span><span style="color: #0000BB">header</span><span style="color: #007700">(</span><span style="color: #DD0000">"Content-type: </span><span style="color: #007700">{</span><span style="color: #0000BB">$size</span><span style="color: #007700">[</span><span style="color: #DD0000">'mime'</span><span style="color: #007700">]}</span><span style="color: #DD0000">"</span><span style="color: #007700">);<br />    </span><span style="color: #0000BB">fpassthru</span><span style="color: #007700">(</span><span style="color: #0000BB">$fp</span><span style="color: #007700">);<br />    exit;<br />} else {<br />    </span><span style="color: #FF8000">// error<br /></span><span style="color: #007700">}<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
    </div>

   </div>
  </p>
  <p class="para">
   <code class="literal">channels</code> 对 RGB 图片为 3，对 CMYK 图像为 4。
  </p>
  <p class="para">
   <code class="literal">bits</code> 是每种颜色的位数。
  </p>
  <p class="para">
   对应一些图像类型，<code class="literal">channels</code> 和 <code class="literal">bits</code> 值的存在可能会让人困惑。
   As an example, <abbr title="Graphic Interchange Format">GIF</abbr> always uses 3 channels
   per pixel, but the number of bits per pixel cannot be calculated for an
   animated <abbr title="Graphic Interchange Format">GIF</abbr> with a global color table.
  </p>
  <p class="para">
   失败时返回 <strong><code>false</code></strong>。
  </p>
 </div>

 
 <div class="refsect1 errors" id="refsect1-function.getimagesize-errors">
  <h3 class="title">错误／异常</h3>
  <p class="para">
   如果无法访问 <code class="parameter">filename</code> 图像，<span class="function"><strong>getimagesize()</strong></span> 将生成 <strong><code>E_WARNING</code></strong>
   级别的错误。读取错误时，<span class="function"><strong>getimagesize()</strong></span> 将生成 <strong><code>E_NOTICE</code></strong> 级别的错误。
  </p>
 </div>


 <div class="refsect1 changelog" id="refsect1-function.getimagesize-changelog">
  <h3 class="title">更新日志</h3>
  <p class="para">
   <table class="doctable informaltable">
    
     <thead>
      <tr>
       <th>版本</th>
       <th>说明</th>
      </tr>

     </thead>

     <tbody class="tbody">
      <tr>
       <td>8.2.0</td>
       <td>
        现在将正确返回 AVIF 图像的实际尺寸、bits 和 channels；以前，尺寸报告为 <code class="literal">0x0</code>，并且不会报告 bits 和 channels。
       </td>
      </tr>

      <tr>
       <td>7.1.0</td>
       <td>
        新增 WebP 支持。
       </td>
      </tr>

     </tbody>
    
   </table>

  </p>
 </div>

 
 <div class="refsect1 examples" id="refsect1-function.getimagesize-examples">
  <h3 class="title">示例</h3>
  <p class="para">
   <div class="example" id="example-5352">
    <p><strong>Example #2 <span class="function"><strong>getimagesize()</strong></span> 示例</strong></p>
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br /></span><span style="color: #007700">list(</span><span style="color: #0000BB">$width</span><span style="color: #007700">, </span><span style="color: #0000BB">$height</span><span style="color: #007700">, </span><span style="color: #0000BB">$type</span><span style="color: #007700">, </span><span style="color: #0000BB">$attr</span><span style="color: #007700">) = </span><span style="color: #0000BB">getimagesize</span><span style="color: #007700">(</span><span style="color: #DD0000">"img/flag.jpg"</span><span style="color: #007700">);<br />echo </span><span style="color: #DD0000">"&lt;img src=\"img/flag.jpg\" </span><span style="color: #0000BB">$attr</span><span style="color: #DD0000"> alt=\"getimagesize() example\" /&gt;"</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
    </div>

   </div>
   <div class="example" id="example-5354">
    <p><strong>Example #3 getimagesize (URL)</strong></p>
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br />$size </span><span style="color: #007700">= </span><span style="color: #0000BB">getimagesize</span><span style="color: #007700">(</span><span style="color: #DD0000">"http://www.example.com/gifs/logo.gif"</span><span style="color: #007700">);<br /><br /></span><span style="color: #FF8000">// if the file name has space in it, encode it properly<br /></span><span style="color: #0000BB">$size </span><span style="color: #007700">= </span><span style="color: #0000BB">getimagesize</span><span style="color: #007700">(</span><span style="color: #DD0000">"http://www.example.com/gifs/lo%20go.gif"</span><span style="color: #007700">);<br /><br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
    </div>

   </div>
   <div class="example" id="example-5356">
    <p><strong>Example #4 getimagesize() 返回 IPTC</strong></p>
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br />$size </span><span style="color: #007700">= </span><span style="color: #0000BB">getimagesize</span><span style="color: #007700">(</span><span style="color: #DD0000">"testimg.jpg"</span><span style="color: #007700">, </span><span style="color: #0000BB">$info</span><span style="color: #007700">);<br />if (isset(</span><span style="color: #0000BB">$info</span><span style="color: #007700">[</span><span style="color: #DD0000">"APP13"</span><span style="color: #007700">])) {<br />    </span><span style="color: #0000BB">$iptc </span><span style="color: #007700">= </span><span style="color: #0000BB">iptcparse</span><span style="color: #007700">(</span><span style="color: #0000BB">$info</span><span style="color: #007700">[</span><span style="color: #DD0000">"APP13"</span><span style="color: #007700">]);<br />    </span><span style="color: #0000BB">var_dump</span><span style="color: #007700">(</span><span style="color: #0000BB">$iptc</span><span style="color: #007700">);<br />}<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
    </div>

   </div>
  </p>
 </div>

 
 <div class="refsect1 notes" id="refsect1-function.getimagesize-notes">
  <h3 class="title">注释</h3>
  <blockquote class="note"><p><strong class="note">Note</strong>: <p class="para">此函数不需要 GD 图象库。</p></p></blockquote>
 </div>

 
 <div class="refsect1 seealso" id="refsect1-function.getimagesize-seealso">
  <h3 class="title">参见</h3>
  <ul class="simplelist">
   <li class="member"><span class="function"><a href="function.image-type-to-mime-type.html" class="function" rel="rdfs-seeAlso">image_type_to_mime_type()</a> - 取得 getimagesize、exif_read_data、exif_thumbnail、exif_imagetype 所返回的图像类型的 MIME 类型</span></li>
   <li class="member"><span class="function"><a href="function.exif-imagetype.html" class="function" rel="rdfs-seeAlso">exif_imagetype()</a> - 判断一个图像的类型</span></li>
   <li class="member"><span class="function"><a href="function.exif-read-data.html" class="function" rel="rdfs-seeAlso">exif_read_data()</a> - 从一个图片文件中读取 EXIF 头信息</span></li>
   <li class="member"><span class="function"><a href="function.exif-thumbnail.html" class="function" rel="rdfs-seeAlso">exif_thumbnail()</a> - 检索图像的嵌入式缩略图</span></li>
   <li class="member"><span class="function"><a href="function.imagesx.html" class="function" rel="rdfs-seeAlso">imagesx()</a> - 取得图像宽度</span></li>
   <li class="member"><span class="function"><a href="function.imagesy.html" class="function" rel="rdfs-seeAlso">imagesy()</a> - 取得图像高度</span></li>
  </ul>
 </div>

</div><div id="usernotes">
 <div class="head">
  <h3 class="title">User Contributed Notes</h3>
 </div>
<div id="allnotes">  <a name="122015""></a>
  <div class="note">
   <strong class="user">nikolam3244 at gmail dot com</strong>
   <a href="#122015" class="date">12-Dec-2017 07:24</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
There's a code snippet for getting JPEG image dimensions by getting only first few bytes of the file, but it doesn't work for PNG files, so I wrote one. It will download only the first 24 bytes instead of the whole image, and thus being much faster than getimagesize() and it will save bandwidth at the same time:<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="comment">// Retrieve PNG width and height without downloading/reading entire image.<br />
</span><span class="keyword">function </span><span class="default">getpngsize</span><span class="keyword">( </span><span class="default">$img_loc </span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$handle </span><span class="keyword">= </span><span class="default">fopen</span><span class="keyword">( </span><span class="default">$img_loc</span><span class="keyword">, </span><span class="string">"rb" </span><span class="keyword">) or die( </span><span class="string">"Invalid file stream." </span><span class="keyword">);<br />
<br />
&nbsp;&nbsp;&nbsp; if ( ! </span><span class="default">feof</span><span class="keyword">( </span><span class="default">$handle </span><span class="keyword">) ) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$new_block </span><span class="keyword">= </span><span class="default">fread</span><span class="keyword">( </span><span class="default">$handle</span><span class="keyword">, </span><span class="default">24 </span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if ( </span><span class="default">$new_block</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">] == </span><span class="string">"\x89" </span><span class="keyword">&amp;&amp;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$new_block</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">] == </span><span class="string">"\x50" </span><span class="keyword">&amp;&amp;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$new_block</span><span class="keyword">[</span><span class="default">2</span><span class="keyword">] == </span><span class="string">"\x4E" </span><span class="keyword">&amp;&amp;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$new_block</span><span class="keyword">[</span><span class="default">3</span><span class="keyword">] == </span><span class="string">"\x47" </span><span class="keyword">&amp;&amp;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$new_block</span><span class="keyword">[</span><span class="default">4</span><span class="keyword">] == </span><span class="string">"\x0D" </span><span class="keyword">&amp;&amp;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$new_block</span><span class="keyword">[</span><span class="default">5</span><span class="keyword">] == </span><span class="string">"\x0A" </span><span class="keyword">&amp;&amp;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$new_block</span><span class="keyword">[</span><span class="default">6</span><span class="keyword">] == </span><span class="string">"\x1A" </span><span class="keyword">&amp;&amp;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$new_block</span><span class="keyword">[</span><span class="default">7</span><span class="keyword">] == </span><span class="string">"\x0A" </span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if ( </span><span class="default">$new_block</span><span class="keyword">[</span><span class="default">12</span><span class="keyword">] . </span><span class="default">$new_block</span><span class="keyword">[</span><span class="default">13</span><span class="keyword">] . </span><span class="default">$new_block</span><span class="keyword">[</span><span class="default">14</span><span class="keyword">] . </span><span class="default">$new_block</span><span class="keyword">[</span><span class="default">15</span><span class="keyword">] === </span><span class="string">"\x49\x48\x44\x52" </span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$width&nbsp; </span><span class="keyword">= </span><span class="default">unpack</span><span class="keyword">( </span><span class="string">'H*'</span><span class="keyword">, </span><span class="default">$new_block</span><span class="keyword">[</span><span class="default">16</span><span class="keyword">] . </span><span class="default">$new_block</span><span class="keyword">[</span><span class="default">17</span><span class="keyword">] . </span><span class="default">$new_block</span><span class="keyword">[</span><span class="default">18</span><span class="keyword">] . </span><span class="default">$new_block</span><span class="keyword">[</span><span class="default">19</span><span class="keyword">] );<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$width&nbsp; </span><span class="keyword">= </span><span class="default">hexdec</span><span class="keyword">( </span><span class="default">$width</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">] );<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$height </span><span class="keyword">= </span><span class="default">unpack</span><span class="keyword">( </span><span class="string">'H*'</span><span class="keyword">, </span><span class="default">$new_block</span><span class="keyword">[</span><span class="default">20</span><span class="keyword">] . </span><span class="default">$new_block</span><span class="keyword">[</span><span class="default">21</span><span class="keyword">] . </span><span class="default">$new_block</span><span class="keyword">[</span><span class="default">22</span><span class="keyword">] . </span><span class="default">$new_block</span><span class="keyword">[</span><span class="default">23</span><span class="keyword">] );<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$height&nbsp; </span><span class="keyword">= </span><span class="default">hexdec</span><span class="keyword">( </span><span class="default">$height</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">] );<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return array( </span><span class="default">$width</span><span class="keyword">, </span><span class="default">$height </span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">false</span><span class="keyword">;<br />
}<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="121714""></a>
  <div class="note">
   <strong class="user">freecorvette at gmail dot com</strong>
   <a href="#121714" class="date">03-Oct-2017 08:03</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
For some images, using getimagesize() without the second parameter will return the correct info, but when you add the second parameter it will return false. This is most likely a bug (and it has been reported as such), but meanwhile, if you encounter this problem, a workaround is to use exif_read_data().</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="116976""></a>
  <div class="note">
   <strong class="user">simon dot waters at surevine dot com</strong>
   <a href="#116976" class="date">30-Mar-2015 09:01</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Note: getimage size doesn't attempt to validate image file formats<br />
<br />
It is possible for malformed GIF images to contain PHP and still have valid dimensions.<br />
<br />
Programmers need to ensure such images are validated by other tools, or never treated as PHP or other executable types (enforcing appropriate extensions, avoiding user controlled renaming, restricting uploaded images to areas of the website where PHP is not enabled).<br />
<br />
<a href="http://ha.ckers.org/blog/20070604/passing-malicious-php-through-getimagesize/" rel="nofollow" target="_blank">http://ha.ckers.org/blog/20070604/passing-malicious-php-through-getimagesize/</a></span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="114601""></a>
  <div class="note">
   <strong class="user">kazuya</strong>
   <a href="#114601" class="date">11-Mar-2014 02:19</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
i made function img_resize($path,$tmp_name,$new_name,$new_width)<br />
this could be useful.<br />
<br />
<span class="default">&lt;?php<br />
<br />
$new_file </span><span class="keyword">= </span><span class="default">img_resize</span><span class="keyword">(</span><span class="string">"./img/"</span><span class="keyword">, </span><span class="string">"test.jpg"</span><span class="keyword">,</span><span class="string">"copy_test.jpg"</span><span class="keyword">,</span><span class="default">300</span><span class="keyword">);<br />
echo </span><span class="string">"&lt;IMG src = '</span><span class="default">$new_file</span><span class="string">'&gt;"</span><span class="keyword">;<br />
<br />
function </span><span class="default">img_resize</span><span class="keyword">(</span><span class="default">$path</span><span class="keyword">,</span><span class="default">$tmp_name</span><span class="keyword">,</span><span class="default">$new_name</span><span class="keyword">,</span><span class="default">$new_width</span><span class="keyword">){<br />
&nbsp;&nbsp;&nbsp; if (!</span><span class="default">file_exists</span><span class="keyword">(</span><span class="default">$path</span><span class="keyword">.</span><span class="default">$filename</span><span class="keyword">)){<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="string">"file not found!"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; exit;<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; if (!</span><span class="default">is_writable</span><span class="keyword">(</span><span class="default">$path</span><span class="keyword">)){<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="string">"error:permission denied!"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; exit;<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; list(</span><span class="default">$width</span><span class="keyword">, </span><span class="default">$height</span><span class="keyword">) = </span><span class="default">getimagesize</span><span class="keyword">(</span><span class="default">$path </span><span class="keyword">. </span><span class="default">$tmp_name</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$new_height </span><span class="keyword">= </span><span class="default">abs</span><span class="keyword">(</span><span class="default">$new_width </span><span class="keyword">* </span><span class="default">$height </span><span class="keyword">/ </span><span class="default">$width</span><span class="keyword">); <br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$image_p </span><span class="keyword">= </span><span class="default">imagecreatetruecolor</span><span class="keyword">(</span><span class="default">$new_width</span><span class="keyword">, </span><span class="default">$new_height</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$image </span><span class="keyword">= </span><span class="default">imagecreatefromjpeg</span><span class="keyword">(</span><span class="default">$path </span><span class="keyword">. </span><span class="default">$tmp_name</span><span class="keyword">); <br />
&nbsp;&nbsp;&nbsp; </span><span class="default">imagecopyresampled</span><span class="keyword">(</span><span class="default">$image_p</span><span class="keyword">, </span><span class="default">$image</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$new_width</span><span class="keyword">, </span><span class="default">$new_height</span><span class="keyword">, </span><span class="default">$width</span><span class="keyword">, </span><span class="default">$height</span><span class="keyword">); <br />
&nbsp;&nbsp;&nbsp; </span><span class="default">imagejpeg</span><span class="keyword">(</span><span class="default">$image_p</span><span class="keyword">, </span><span class="default">$path </span><span class="keyword">. </span><span class="default">$new_name</span><span class="keyword">); <br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">$path</span><span class="keyword">.</span><span class="default">$new_name</span><span class="keyword">;<br />
}<br />
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="113158""></a>
  <div class="note">
   <strong class="user">tomasz at trejderowski dot pl</strong>
   <a href="#113158" class="date">06-Sep-2013 09:47</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you want to "convert" value returned by "getimagesize()" as index "2" into something more human-readable, you may consider using a function like this one:<br />
<br />
&nbsp;&nbsp;&nbsp; $imageTypeArray = array<br />
&nbsp;&nbsp;&nbsp; (<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; 0=&gt;'UNKNOWN',<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; 1=&gt;'GIF',<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; 2=&gt;'JPEG',<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; 3=&gt;'PNG',<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; 4=&gt;'SWF',<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; 5=&gt;'PSD',<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; 6=&gt;'BMP',<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; 7=&gt;'TIFF_II',<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; 8=&gt;'TIFF_MM',<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; 9=&gt;'JPC',<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; 10=&gt;'JP2',<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; 11=&gt;'JPX',<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; 12=&gt;'JB2',<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; 13=&gt;'SWC',<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; 14=&gt;'IFF',<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; 15=&gt;'WBMP',<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; 16=&gt;'XBM',<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; 17=&gt;'ICO',<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; 18=&gt;'COUNT'&nbsp; <br />
&nbsp;&nbsp;&nbsp; );<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; $size = getimagesize($filename);<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; $size[2] = $imageTypeArray[$size[2]];<br />
<br />
Or something similar.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="107537""></a>
  <div class="note">
   <strong class="user">alexyam at live dot com</strong>
   <a href="#107537" class="date">15-Feb-2012 11:30</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I wanted to use getimagesize() on .SWF files stored in the database as blob data and couldn't find a simple solution, so I created my own.<br />
<br />
I am releasing this code under the MIT license to save everyone some time:<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="comment">/*<br />
&nbsp;&nbsp;&nbsp; ----------------------------------------------------------------------<br />
&nbsp;&nbsp;&nbsp; PHP Blob Data As File Stream v1.0 (C) 2012 Alex Yam &lt;alexyam@live.com&gt;<br />
&nbsp;&nbsp;&nbsp; This code is released under the MIT License.<br />
&nbsp;&nbsp;&nbsp; ----------------------------------------------------------------------<br />
&nbsp;&nbsp;&nbsp; [Summary]<br />
<br />
&nbsp;&nbsp;&nbsp; A simple class for PHP functions to read and write blob data as a file<br />
&nbsp;&nbsp;&nbsp; using a stream wrapper.<br />
<br />
&nbsp;&nbsp;&nbsp; Particularly useful for running getimagesize() to get the width and<br />
&nbsp;&nbsp;&nbsp; height of .SWF Flash files that are stored in the database as blob data.<br />
<br />
&nbsp;&nbsp;&nbsp; Tested on PHP 5.3.10.<br />
<br />
&nbsp;&nbsp;&nbsp; ----------------------------------------------------------------------&nbsp; &nbsp; <br />
&nbsp;&nbsp;&nbsp; [Usage Example]<br />
<br />
&nbsp;&nbsp;&nbsp; //Include<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; include('./blob_data_as_file_stream.php');<br />
<br />
&nbsp;&nbsp;&nbsp; //Register the stream wrapper<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; stream_wrapper_register("BlobDataAsFileStream", "blob_data_as_file_stream");<br />
<br />
&nbsp;&nbsp;&nbsp; //Fetch a .SWF file from the Adobe website and store it into a variable.<br />
&nbsp;&nbsp;&nbsp; //Replace this with your own fetch-swf-blob-data-from-database code.<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $swf_url = '<a href="http://www.adobe.com/swf/software/flash/about/flashAbout_info_small.swf" rel="nofollow" target="_blank">http://www.adobe.com/swf/software/flash/about/flashAbout_info_small.swf</a>';<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $swf_blob_data = file_get_contents($swf_url);<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; //Store $swf_blob_data to the data stream<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; blob_data_as_file_stream::$blob_data_stream = $swf_blob_data;<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; //Run getimagesize() on the data stream<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $swf_info = getimagesize('BlobDataAsFileStream://');<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; var_dump($swf_info);<br />
<br />
&nbsp;&nbsp;&nbsp; ----------------------------------------------------------------------<br />
&nbsp;&nbsp;&nbsp; [Usage Output]<br />
<br />
&nbsp;&nbsp;&nbsp; array(5) {<br />
&nbsp;&nbsp; &nbsp;&nbsp; [0]=&gt;<br />
&nbsp;&nbsp; &nbsp;&nbsp; int(159)<br />
&nbsp;&nbsp; &nbsp;&nbsp; [1]=&gt;<br />
&nbsp;&nbsp; &nbsp;&nbsp; int(91)<br />
&nbsp;&nbsp; &nbsp;&nbsp; [2]=&gt;<br />
&nbsp;&nbsp; &nbsp;&nbsp; int(13)<br />
&nbsp;&nbsp; &nbsp;&nbsp; [3]=&gt;<br />
&nbsp;&nbsp; &nbsp;&nbsp; string(23) "width="159" height="91""<br />
&nbsp;&nbsp; &nbsp;&nbsp; ["mime"]=&gt;<br />
&nbsp;&nbsp; &nbsp;&nbsp; string(29) "application/x-shockwave-flash"<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
*/<br />
<br />
</span><span class="keyword">class </span><span class="default">blob_data_as_file_stream </span><span class="keyword">{<br />
<br />
&nbsp;&nbsp;&nbsp; private static </span><span class="default">$blob_data_position </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; public static </span><span class="default">$blob_data_stream </span><span class="keyword">= </span><span class="string">''</span><span class="keyword">;<br />
<br />
&nbsp;&nbsp;&nbsp; public static function </span><span class="default">stream_open</span><span class="keyword">(</span><span class="default">$path</span><span class="keyword">,</span><span class="default">$mode</span><span class="keyword">,</span><span class="default">$options</span><span class="keyword">,&amp;</span><span class="default">$opened_path</span><span class="keyword">){<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; static::</span><span class="default">$blob_data_position </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">true</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp;&nbsp; public static function </span><span class="default">stream_seek</span><span class="keyword">(</span><span class="default">$seek_offset</span><span class="keyword">,</span><span class="default">$seek_whence</span><span class="keyword">){<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$blob_data_length </span><span class="keyword">= </span><span class="default">strlen</span><span class="keyword">(static::</span><span class="default">$blob_data_stream</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; switch (</span><span class="default">$seek_whence</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="default">SEEK_SET</span><span class="keyword">:<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$new_blob_data_position </span><span class="keyword">= </span><span class="default">$seek_offset</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; break;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="default">SEEK_CUR</span><span class="keyword">:<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$new_blob_data_position </span><span class="keyword">= static::</span><span class="default">$blob_data_position</span><span class="keyword">+</span><span class="default">$seek_offset</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; break;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="default">SEEK_END</span><span class="keyword">:<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$new_blob_data_position </span><span class="keyword">= </span><span class="default">$blob_data_length</span><span class="keyword">+</span><span class="default">$seek_offset</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; break;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; default:<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">false</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if ((</span><span class="default">$new_blob_data_position </span><span class="keyword">&gt;= </span><span class="default">0</span><span class="keyword">) AND (</span><span class="default">$new_blob_data_position </span><span class="keyword">&lt;= </span><span class="default">$blob_data_length</span><span class="keyword">)){<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; static::</span><span class="default">$blob_data_position </span><span class="keyword">= </span><span class="default">$new_blob_data_position</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">true</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }else{<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">false</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp;&nbsp; public static function </span><span class="default">stream_tell</span><span class="keyword">(){<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return static::</span><span class="default">$blob_data_position</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp;&nbsp; public static function </span><span class="default">stream_read</span><span class="keyword">(</span><span class="default">$read_buffer_size</span><span class="keyword">){<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$read_data </span><span class="keyword">= </span><span class="default">substr</span><span class="keyword">(static::</span><span class="default">$blob_data_stream</span><span class="keyword">,static::</span><span class="default">$blob_data_position</span><span class="keyword">,</span><span class="default">$read_buffer_size</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; static::</span><span class="default">$blob_data_position </span><span class="keyword">+= </span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$read_data</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">$read_data</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp;&nbsp; public static function </span><span class="default">stream_write</span><span class="keyword">(</span><span class="default">$write_data</span><span class="keyword">){<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$write_data_length</span><span class="keyword">=</span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$write_data</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; static::</span><span class="default">$blob_data_stream </span><span class="keyword">= </span><span class="default">substr</span><span class="keyword">(static::</span><span class="default">$blob_data_stream</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,static::</span><span class="default">$blob_data_position</span><span class="keyword">).<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$write_data</span><span class="keyword">.</span><span class="default">substr</span><span class="keyword">(static::</span><span class="default">$blob_data_stream</span><span class="keyword">,static::</span><span class="default">$blob_data_position</span><span class="keyword">+=</span><span class="default">$write_data_length</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">$write_data_length</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp;&nbsp; public static function </span><span class="default">stream_eof</span><span class="keyword">(){<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return static::</span><span class="default">$blob_data_position </span><span class="keyword">&gt;= </span><span class="default">strlen</span><span class="keyword">(static::</span><span class="default">$blob_data_stream</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
}<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="105033""></a>
  <div class="note">
   <strong class="user">utilmind</strong>
   <a href="#105033" class="date">23-Jul-2011 03:17</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Here is the function which determines whether the PNG image contains alpha or not:
<br />

<br />
<span class="default">&lt;?php
<br />
</span><span class="keyword">function </span><span class="default">is_alpha_png</span><span class="keyword">(</span><span class="default">$fn</span><span class="keyword">){
<br />
&nbsp; return (</span><span class="default">ord</span><span class="keyword">(@</span><span class="default">file_get_contents</span><span class="keyword">(</span><span class="default">$fn</span><span class="keyword">, </span><span class="default">NULL</span><span class="keyword">, </span><span class="default">NULL</span><span class="keyword">, </span><span class="default">25</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">)) == </span><span class="default">6</span><span class="keyword">);
<br />
}
<br />
</span><span class="default">?&gt;
<br />
</span>
<br />
The color type of PNG image is stored at byte offset 25. Possible values of that 25'th byte is:
<br />
&nbsp;* 0 - greyscale
<br />
&nbsp;* 2 - RGB
<br />
&nbsp;* 3 - RGB with palette
<br />
&nbsp;* 4 - greyscale + alpha
<br />
&nbsp;* 6 - RGB + alpha</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="103516""></a>
  <div class="note">
   <strong class="user">Steve</strong>
   <a href="#103516" class="date">17-Apr-2011 03:12</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
The list of defined IMAGETYPE_ constants is on the manual page for exif_imagetype:<br />
<br />
<a href="http://www.php.net/manual/en/function.exif-imagetype.php" rel="nofollow" target="_blank">http://www.php.net/manual/en/function.exif-imagetype.php</a></span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="102418""></a>
  <div class="note">
   <strong class="user">Jesus Zamora</strong>
   <a href="#102418" class="date">13-Feb-2011 06:20</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Returns a array with 4 elements.<br />
The 0 index is the width of the image in pixels.<br />
The 1 index is the height of the image in pixels.<br />
The 2 index is a flag for the image type:<br />
<br />
1 = GIF, 2 = JPG, 3 = PNG, 4 = SWF, 5 = PSD, 6 = BMP, 7 = TIFF(orden de bytes intel), 8 = TIFF(orden de bytes motorola), 9 = JPC, 10 = JP2, 11 = JPX, 12 = JB2, 13 = SWC, 14 = IFF, 15 = WBMP, 16 = XBM. <br />
<br />
The 3 index contains ' height="yyy" width="xxx" '</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="94178""></a>
  <div class="note">
   <strong class="user">geoff at spacevs dot com</strong>
   <a href="#94178" class="date">20-Oct-2009 11:22</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
This function returns the width and height of a JPEG image from a string, allowing the dimensions of images stored in a database to be retrieved without writing them to the disk first, or using "imagecreatefromstring" which is very slow in comparison.<br />
<br />
<span class="default">&lt;?PHP<br />
</span><span class="keyword">function </span><span class="default">getJPEGImageXY</span><span class="keyword">(</span><span class="default">$data</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$soi </span><span class="keyword">= </span><span class="default">unpack</span><span class="keyword">(</span><span class="string">'nmagic/nmarker'</span><span class="keyword">, </span><span class="default">$data</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">$soi</span><span class="keyword">[</span><span class="string">'magic'</span><span class="keyword">] != </span><span class="default">0xFFD8</span><span class="keyword">) return </span><span class="default">false</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$marker </span><span class="keyword">= </span><span class="default">$soi</span><span class="keyword">[</span><span class="string">'marker'</span><span class="keyword">];<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$data&nbsp;&nbsp; </span><span class="keyword">= </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$data</span><span class="keyword">, </span><span class="default">4</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$done&nbsp;&nbsp; </span><span class="keyword">= </span><span class="default">false</span><span class="keyword">;<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; while(</span><span class="default">1</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$data</span><span class="keyword">) === </span><span class="default">0</span><span class="keyword">) return </span><span class="default">false</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; switch(</span><span class="default">$marker</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="default">0xFFC0</span><span class="keyword">:<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$info </span><span class="keyword">= </span><span class="default">unpack</span><span class="keyword">(</span><span class="string">'nlength/Cprecision/nY/nX'</span><span class="keyword">, </span><span class="default">$data</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return array(</span><span class="default">$info</span><span class="keyword">[</span><span class="string">'X'</span><span class="keyword">], </span><span class="default">$info</span><span class="keyword">[</span><span class="string">'Y'</span><span class="keyword">]);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; break;<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; default:<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$info&nbsp;&nbsp; </span><span class="keyword">= </span><span class="default">unpack</span><span class="keyword">(</span><span class="string">'nlength'</span><span class="keyword">, </span><span class="default">$data</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$data&nbsp;&nbsp; </span><span class="keyword">= </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$data</span><span class="keyword">, </span><span class="default">$info</span><span class="keyword">[</span><span class="string">'length'</span><span class="keyword">]);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$info&nbsp;&nbsp; </span><span class="keyword">= </span><span class="default">unpack</span><span class="keyword">(</span><span class="string">'nmarker'</span><span class="keyword">, </span><span class="default">$data</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$marker </span><span class="keyword">= </span><span class="default">$info</span><span class="keyword">[</span><span class="string">'marker'</span><span class="keyword">];<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$data&nbsp;&nbsp; </span><span class="keyword">= </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$data</span><span class="keyword">, </span><span class="default">2</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; break;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
}<br />
</span><span class="default">?&gt;<br />
</span><br />
Doing this 10,000 times takes 0.43 seconds, compared with using imagecreatefromstring/imagesx/imagesy which takes around 1.52 seconds to do the same.<br />
<br />
Do not use this instead of getimagesize when dealing with files, getimagesize is much faster coming in at 0.15 seconds.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="88793""></a>
  <div class="note">
   <strong class="user">james dot relyea at zifiniti dot com</strong>
   <a href="#88793" class="date">07-Feb-2009 08:49</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
As noted below, getimagesize will download the entire image before it checks for the requested information. This is extremely slow on large images that are accessed remotely. Since the width/height is in the first few bytes of the file, there is no need to download the entire file. I wrote a function to get the size of a JPEG by streaming bytes until the proper data is found to report the width and height:<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="comment">// Retrieve JPEG width and height without downloading/reading entire image.<br />
</span><span class="keyword">function </span><span class="default">getjpegsize</span><span class="keyword">(</span><span class="default">$img_loc</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$handle </span><span class="keyword">= </span><span class="default">fopen</span><span class="keyword">(</span><span class="default">$img_loc</span><span class="keyword">, </span><span class="string">"rb"</span><span class="keyword">) or die(</span><span class="string">"Invalid file stream."</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$new_block </span><span class="keyword">= </span><span class="default">NULL</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; if(!</span><span class="default">feof</span><span class="keyword">(</span><span class="default">$handle</span><span class="keyword">)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$new_block </span><span class="keyword">= </span><span class="default">fread</span><span class="keyword">(</span><span class="default">$handle</span><span class="keyword">, </span><span class="default">32</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$i </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">$new_block</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">]==</span><span class="string">"\xFF" </span><span class="keyword">&amp;&amp; </span><span class="default">$new_block</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">+</span><span class="default">1</span><span class="keyword">]==</span><span class="string">"\xD8" </span><span class="keyword">&amp;&amp; </span><span class="default">$new_block</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">+</span><span class="default">2</span><span class="keyword">]==</span><span class="string">"\xFF" </span><span class="keyword">&amp;&amp; </span><span class="default">$new_block</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">+</span><span class="default">3</span><span class="keyword">]==</span><span class="string">"\xE0"</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$i </span><span class="keyword">+= </span><span class="default">4</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">$new_block</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">+</span><span class="default">2</span><span class="keyword">]==</span><span class="string">"\x4A" </span><span class="keyword">&amp;&amp; </span><span class="default">$new_block</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">+</span><span class="default">3</span><span class="keyword">]==</span><span class="string">"\x46" </span><span class="keyword">&amp;&amp; </span><span class="default">$new_block</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">+</span><span class="default">4</span><span class="keyword">]==</span><span class="string">"\x49" </span><span class="keyword">&amp;&amp; </span><span class="default">$new_block</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">+</span><span class="default">5</span><span class="keyword">]==</span><span class="string">"\x46" </span><span class="keyword">&amp;&amp; </span><span class="default">$new_block</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">+</span><span class="default">6</span><span class="keyword">]==</span><span class="string">"\x00"</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// Read block size and skip ahead to begin cycling through blocks in search of SOF marker<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$block_size </span><span class="keyword">= </span><span class="default">unpack</span><span class="keyword">(</span><span class="string">"H*"</span><span class="keyword">, </span><span class="default">$new_block</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">] . </span><span class="default">$new_block</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">+</span><span class="default">1</span><span class="keyword">]);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$block_size </span><span class="keyword">= </span><span class="default">hexdec</span><span class="keyword">(</span><span class="default">$block_size</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">]);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; while(!</span><span class="default">feof</span><span class="keyword">(</span><span class="default">$handle</span><span class="keyword">)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$i </span><span class="keyword">+= </span><span class="default">$block_size</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$new_block </span><span class="keyword">.= </span><span class="default">fread</span><span class="keyword">(</span><span class="default">$handle</span><span class="keyword">, </span><span class="default">$block_size</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">$new_block</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">]==</span><span class="string">"\xFF"</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// New block detected, check for SOF marker<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$sof_marker </span><span class="keyword">= array(</span><span class="string">"\xC0"</span><span class="keyword">, </span><span class="string">"\xC1"</span><span class="keyword">, </span><span class="string">"\xC2"</span><span class="keyword">, </span><span class="string">"\xC3"</span><span class="keyword">, </span><span class="string">"\xC5"</span><span class="keyword">, </span><span class="string">"\xC6"</span><span class="keyword">, </span><span class="string">"\xC7"</span><span class="keyword">, </span><span class="string">"\xC8"</span><span class="keyword">, </span><span class="string">"\xC9"</span><span class="keyword">, </span><span class="string">"\xCA"</span><span class="keyword">, </span><span class="string">"\xCB"</span><span class="keyword">, </span><span class="string">"\xCD"</span><span class="keyword">, </span><span class="string">"\xCE"</span><span class="keyword">, </span><span class="string">"\xCF"</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">in_array</span><span class="keyword">(</span><span class="default">$new_block</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">+</span><span class="default">1</span><span class="keyword">], </span><span class="default">$sof_marker</span><span class="keyword">)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// SOF marker detected. Width and height information is contained in bytes 4-7 after this byte.<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$size_data </span><span class="keyword">= </span><span class="default">$new_block</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">+</span><span class="default">2</span><span class="keyword">] . </span><span class="default">$new_block</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">+</span><span class="default">3</span><span class="keyword">] . </span><span class="default">$new_block</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">+</span><span class="default">4</span><span class="keyword">] . </span><span class="default">$new_block</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">+</span><span class="default">5</span><span class="keyword">] . </span><span class="default">$new_block</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">+</span><span class="default">6</span><span class="keyword">] . </span><span class="default">$new_block</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">+</span><span class="default">7</span><span class="keyword">] . </span><span class="default">$new_block</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">+</span><span class="default">8</span><span class="keyword">];<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$unpacked </span><span class="keyword">= </span><span class="default">unpack</span><span class="keyword">(</span><span class="string">"H*"</span><span class="keyword">, </span><span class="default">$size_data</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$unpacked </span><span class="keyword">= </span><span class="default">$unpacked</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">];<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$height </span><span class="keyword">= </span><span class="default">hexdec</span><span class="keyword">(</span><span class="default">$unpacked</span><span class="keyword">[</span><span class="default">6</span><span class="keyword">] . </span><span class="default">$unpacked</span><span class="keyword">[</span><span class="default">7</span><span class="keyword">] . </span><span class="default">$unpacked</span><span class="keyword">[</span><span class="default">8</span><span class="keyword">] . </span><span class="default">$unpacked</span><span class="keyword">[</span><span class="default">9</span><span class="keyword">]);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$width </span><span class="keyword">= </span><span class="default">hexdec</span><span class="keyword">(</span><span class="default">$unpacked</span><span class="keyword">[</span><span class="default">10</span><span class="keyword">] . </span><span class="default">$unpacked</span><span class="keyword">[</span><span class="default">11</span><span class="keyword">] . </span><span class="default">$unpacked</span><span class="keyword">[</span><span class="default">12</span><span class="keyword">] . </span><span class="default">$unpacked</span><span class="keyword">[</span><span class="default">13</span><span class="keyword">]);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return array(</span><span class="default">$width</span><span class="keyword">, </span><span class="default">$height</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; } else {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// Skip block marker and read block size<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$i </span><span class="keyword">+= </span><span class="default">2</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$block_size </span><span class="keyword">= </span><span class="default">unpack</span><span class="keyword">(</span><span class="string">"H*"</span><span class="keyword">, </span><span class="default">$new_block</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">] . </span><span class="default">$new_block</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">+</span><span class="default">1</span><span class="keyword">]);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$block_size </span><span class="keyword">= </span><span class="default">hexdec</span><span class="keyword">(</span><span class="default">$block_size</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">]);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; } else {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">FALSE</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">FALSE</span><span class="keyword">;<br />
}<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="87188""></a>
  <div class="note">
   <strong class="user">anonymous</strong>
   <a href="#87188" class="date">23-Nov-2008 08:30</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Note that if you specify a remote file (via a URL) to check the size of, PHP will first download the remote file to your server.<br />
<br />
If you're using this function to check the size of user provided image links, this could constitute a security risk.&nbsp; A malicious user could potentially link to a very large image file and cause PHP to download it.&nbsp; I do not know what, if any, file size limits are in place for the download.&nbsp; But suppose the user provided a link to an image that was several gigabytes in size?<br />
<br />
It would be nice if there were a way to limit the size of the download performed by this function.&nbsp; Hopefully there is already a default with some sensible limits.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="84649""></a>
  <div class="note">
   <strong class="user">user at example dot net</strong>
   <a href="#84649" class="date">23-Jul-2008 09:13</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
When validating images, allways check both, image type *AND* file extension!<br />
<br />
Because most image types allow sections for comments or other irrelevant data. Those section can be used to infiltrate php code onto the server. If these files are stored as sent by the client, files with a ".php" extension can be executed and do tremendous harm.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="82245""></a>
  <div class="note">
   <strong class="user">info at alex-lawrence dot com</strong>
   <a href="#82245" class="date">02-Apr-2008 05:17</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Could be useful (didn′t know where to post it):<br />
<br />
function getImageErrors( $filename, $type = "", $minWidth = 0, $minHeight = 0, $maxWidth = 0, $maxHeight = 0, $maxFileSize = 0 )<br />
{<br />
&nbsp;&nbsp;&nbsp; $errors = array();<br />
&nbsp;&nbsp;&nbsp; if ( file_exists( $filename ) )<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $ending = substr( $filename, strpos( $filename, "." ) );<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if ( is_array( $type ) )<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $isTypeOf = false;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; foreach( $type as $eachtype )<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if ( $ending == $eachtype )<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $isTypeOf = true;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if ( ! $isTypeOf )<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $errors[ 'type' ] = $ending;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; elseif ( $type != "" )<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if ( $ending != $type )<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $errors[ 'type' ] = $ending;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $size = getimagesize( $filename );<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if ( $size[ 0 ] &lt; $minWidth )<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $errors[ 'minWidth' ] = $size[ 0 ];<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if ( $size[ 1 ] &lt; $minHeight )<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $errors[ 'minHeight' ] = $size[ 1 ];<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if ( ( $maxWidth &gt; $minWidth ) &amp;&amp; ( $size[ 0 ] &gt; $maxWidth ) )<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $errors[ 'maxWidth' ] = $size[ 0 ];<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if ( ( $maxHeight &gt; $minHeight ) &amp;&amp; ( $size[ 1 ] &gt; $maxHeight ) )<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $errors[ 'maxHeight' ] = $size[ 1 ];<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if ( ( $maxFileSize &gt; 0 ) &amp;&amp; ( filesize( $filename ) &gt; $maxFileSize ) )<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $errors[ 'maxFileSize' ] = filesize( $filename );<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; else<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $errors[ 'filename' ] = "not existing";<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; return ( count( $errors ) &gt; 0 ? $errors : null );<br />
}</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="81380""></a>
  <div class="note">
   <strong class="user">cloned at clonedmadman dot com</strong>
   <a href="#81380" class="date">25-Feb-2008 02:01</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Well, I am making a script which will resize the image when uploaded, however, i am making a multi-uploader, so i came across with a problem: an efficient way of getting a pictures height and width and storing them in an array to resize later. This is what i came up with:<br />
<br />
<span class="default">&lt;?php<br />
$links </span><span class="keyword">= array(</span><span class="string">"test1.jpg"</span><span class="keyword">, </span><span class="string">"test2.png"</span><span class="keyword">);<br />
</span><span class="default">$sizearray </span><span class="keyword">= array();<br />
</span><span class="default">$count </span><span class="keyword">= </span><span class="default">count</span><span class="keyword">(</span><span class="default">$links</span><span class="keyword">);<br />
for(</span><span class="default">$i </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">; </span><span class="default">$i </span><span class="keyword">&lt; </span><span class="default">$count</span><span class="keyword">; </span><span class="default">$i</span><span class="keyword">++) {<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$size </span><span class="keyword">= </span><span class="default">getimagesize</span><span class="keyword">(</span><span class="default">$links</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">]);<br />
&nbsp;&nbsp;&nbsp; list(</span><span class="default">$width</span><span class="keyword">, </span><span class="default">$height</span><span class="keyword">) = </span><span class="default">$size</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$sizearray</span><span class="keyword">[</span><span class="default">$links</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">]] = array(</span><span class="string">"width" </span><span class="keyword">=&gt; </span><span class="default">$width</span><span class="keyword">, </span><span class="string">"height" </span><span class="keyword">=&gt; </span><span class="default">$height</span><span class="keyword">);<br />
}<br />
</span><span class="default">print_r</span><span class="keyword">(</span><span class="default">$sizearray</span><span class="keyword">);<br />
</span><span class="comment">// which will print out: Array ( [test1.jpg] =&gt; Array ( [width] =&gt; 300 [height] =&gt; 400 ) [test2.png] =&gt; Array ( [width] =&gt; 680 [height] =&gt; 100 ) )<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="81043""></a>
  <div class="note">
   <strong class="user">shmohel at gmail dot com</strong>
   <a href="#81043" class="date">12-Feb-2008 06:27</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Rather than making a lengthy function that essentially runs twice (once as width, once as height) I came up with a helpful function that uses variable variables to set a maximum height/width. Hope someone finds this helpful.<br />
<br />
function scaleimage($location, $maxw=NULL, $maxh=NULL){<br />
&nbsp;&nbsp;&nbsp; $img = @getimagesize($location);<br />
&nbsp;&nbsp;&nbsp; if($img){<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $w = $img[0];<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $h = $img[1];<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $dim = array('w','h');<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; foreach($dim AS $val){<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $max = "max{$val}";<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if(${$val} &gt; ${$max} &amp;&amp; ${$max}){<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $alt = ($val == 'w') ? 'h' : 'w';<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $ratio = ${$alt} / ${$val};<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; ${$val} = ${$max};<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; ${$alt} = ${$val} * $ratio;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return("&lt;img src='{$location}' alt='image' width='{$w}' height='{$h}' /&gt;");<br />
&nbsp;&nbsp;&nbsp; }<br />
}</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="80346""></a>
  <div class="note">
   <strong class="user">pfarthing at hotmail dot com</strong>
   <a href="#80346" class="date">10-Jan-2008 03:35</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Correction: to find $y2 it should be...<br />
<br />
// set y side to a proportional size<br />
$y2 = $m * $x_max; // not $x1<br />
<br />
Thanks Norbert =)</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="80267""></a>
  <div class="note">
   <strong class="user">info at personalmis dot com</strong>
   <a href="#80267" class="date">07-Jan-2008 04:42</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Seems the various ways people are trying to proportionaly scale an image, up or down, could be more straight forward if one remembers ones algebra.<br />
<br />
The formula is, y = mx, where m is the slope of the line. This is the ratio of y:x or m = y/x.<br />
<br />
So if...<br />
<br />
// max values for x and y<br />
$y_max = 600;<br />
$x_max = 800;<br />
<br />
// image size<br />
$y1 = 2000;<br />
$x1 = 3000;<br />
<br />
// use width for scaling<br />
if ($x1 &gt; $x_max)<br />
{<br />
&nbsp;&nbsp;&nbsp; // find slope <br />
&nbsp;&nbsp;&nbsp; $m = $y1/$x1;<br />
&nbsp;&nbsp;&nbsp; // set x side to max<br />
&nbsp;&nbsp;&nbsp; $x2 = $x_max;<br />
&nbsp;&nbsp;&nbsp; // set y side to a proportional size<br />
&nbsp;&nbsp;&nbsp; $y2 = $m * $x1;<br />
}<br />
<br />
The new image proportionally scaled will be x2 = 800, y2 = 533 (rounded).<br />
<br />
To do it from the y side, simply reverse the x's and y's.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="77006""></a>
  <div class="note">
   <strong class="user">redcore at gmail dot com</strong>
   <a href="#77006" class="date">09-Aug-2007 02:50</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
It's always good to check out an image's dimensions while attempting to upload to your server or database...especially if it's going to be displayed on a page that doesn't accomodate images beyond a particular size.<br />
<br />
<span class="default">&lt;?php<br />
<br />
$tmpName </span><span class="keyword">= </span><span class="default">$_FILES</span><span class="keyword">[</span><span class="string">'userfile'</span><span class="keyword">][</span><span class="string">'tmp_name'</span><span class="keyword">];<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
list(</span><span class="default">$width</span><span class="keyword">, </span><span class="default">$height</span><span class="keyword">, </span><span class="default">$type</span><span class="keyword">, </span><span class="default">$attr</span><span class="keyword">) = </span><span class="default">getimagesize</span><span class="keyword">(</span><span class="default">$tmpName</span><span class="keyword">);<br />
<br />
if(</span><span class="default">$width</span><span class="keyword">&gt;</span><span class="default">275 </span><span class="keyword">|| </span><span class="default">$height</span><span class="keyword">&gt;</span><span class="default">275</span><span class="keyword">)<br />
{<br />
die(</span><span class="string">"exceeded image dimension limits."</span><span class="keyword">);<br />
}<br />
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="52099""></a>
  <div class="note">
   <strong class="user">ajreading at classixshop dot com</strong>
   <a href="#52099" class="date">21-Apr-2005 01:30</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
A simple piece of code i wrote to proportionally resize an image to a max height and width then display it<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="comment">// Max height and width<br />
</span><span class="default">$max_width </span><span class="keyword">= </span><span class="default">100</span><span class="keyword">;<br />
</span><span class="default">$max_height </span><span class="keyword">= </span><span class="default">100</span><span class="keyword">;<br />
<br />
</span><span class="comment">// Path to your jpeg<br />
<br />
</span><span class="default">$upfile </span><span class="string">'/path/to/file.jpg'</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">Header</span><span class="keyword">(</span><span class="string">"Content-type: image/jpeg"</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$size </span><span class="keyword">= </span><span class="default">GetImageSize</span><span class="keyword">(</span><span class="default">$upfile</span><span class="keyword">); </span><span class="comment">// Read the size<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$width </span><span class="keyword">= </span><span class="default">$size</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">];<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$height </span><span class="keyword">= </span><span class="default">$size</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">];<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// Proportionally resize the image to the<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; // max sizes specified above<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$x_ratio </span><span class="keyword">= </span><span class="default">$max_width </span><span class="keyword">/ </span><span class="default">$width</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$y_ratio </span><span class="keyword">= </span><span class="default">$max_height </span><span class="keyword">/ </span><span class="default">$height</span><span class="keyword">;<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if( (</span><span class="default">$width </span><span class="keyword">&lt;= </span><span class="default">$max_width</span><span class="keyword">) &amp;&amp; (</span><span class="default">$height </span><span class="keyword">&lt;= </span><span class="default">$max_height</span><span class="keyword">) )<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$tn_width </span><span class="keyword">= </span><span class="default">$width</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$tn_height </span><span class="keyword">= </span><span class="default">$height</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; elseif ((</span><span class="default">$x_ratio </span><span class="keyword">* </span><span class="default">$height</span><span class="keyword">) &lt; </span><span class="default">$max_height</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$tn_height </span><span class="keyword">= </span><span class="default">ceil</span><span class="keyword">(</span><span class="default">$x_ratio </span><span class="keyword">* </span><span class="default">$height</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$tn_width </span><span class="keyword">= </span><span class="default">$max_width</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; else<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$tn_width </span><span class="keyword">= </span><span class="default">ceil</span><span class="keyword">(</span><span class="default">$y_ratio </span><span class="keyword">* </span><span class="default">$width</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$tn_height </span><span class="keyword">= </span><span class="default">$max_height</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; </span><span class="comment">// Increase memory limit to support larger files<br />
&nbsp;&nbsp; &nbsp; <br />
&nbsp;&nbsp; &nbsp; </span><span class="default">ini_set</span><span class="keyword">(</span><span class="string">'memory_limit'</span><span class="keyword">, </span><span class="string">'32M'</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; <br />
&nbsp;&nbsp; &nbsp; </span><span class="comment">// Create the new image!<br />
&nbsp;&nbsp; &nbsp; </span><span class="default">$src </span><span class="keyword">= </span><span class="default">ImageCreateFromJpeg</span><span class="keyword">(</span><span class="default">$upfile</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; </span><span class="default">$dst </span><span class="keyword">= </span><span class="default">ImageCreateTrueColor</span><span class="keyword">(</span><span class="default">$tn_width</span><span class="keyword">, </span><span class="default">$tn_height</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; </span><span class="default">ImageCopyResized</span><span class="keyword">(</span><span class="default">$dst</span><span class="keyword">, </span><span class="default">$src</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">$tn_width</span><span class="keyword">, </span><span class="default">$tn_height</span><span class="keyword">, </span><span class="default">$width</span><span class="keyword">, </span><span class="default">$height</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; </span><span class="default">ImageJpeg</span><span class="keyword">(</span><span class="default">$dst</span><span class="keyword">);<br />
</span><span class="comment">// Destroy the images<br />
</span><span class="default">ImageDestroy</span><span class="keyword">(</span><span class="default">$src</span><span class="keyword">);<br />
</span><span class="default">ImageDestroy</span><span class="keyword">(</span><span class="default">$dst</span><span class="keyword">);<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="51444""></a>
  <div class="note">
   <strong class="user">mail at soylentgreens dot com</strong>
   <a href="#51444" class="date">30-Mar-2005 06:37</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
How about this for cropping images...<br />
<br />
<span class="default">&lt;?php<br />
<br />
$imgfile </span><span class="keyword">= </span><span class="string">"img.jpg"</span><span class="keyword">;<br />
</span><span class="default">$cropStartX </span><span class="keyword">= </span><span class="default">300</span><span class="keyword">;<br />
</span><span class="default">$cropStartY </span><span class="keyword">= </span><span class="default">250</span><span class="keyword">;<br />
</span><span class="default">$cropW&nbsp;&nbsp; </span><span class="keyword">= </span><span class="default">200</span><span class="keyword">;<br />
</span><span class="default">$cropH&nbsp;&nbsp; </span><span class="keyword">= </span><span class="default">200</span><span class="keyword">;<br />
<br />
</span><span class="comment">// Create two images<br />
</span><span class="default">$origimg </span><span class="keyword">= </span><span class="default">imagecreatefromjpeg</span><span class="keyword">(</span><span class="default">$imgfile</span><span class="keyword">);<br />
</span><span class="default">$cropimg </span><span class="keyword">= </span><span class="default">imagecreatetruecolor</span><span class="keyword">(</span><span class="default">$cropW</span><span class="keyword">,</span><span class="default">$cropH</span><span class="keyword">);<br />
<br />
</span><span class="comment">// Get the original size<br />
</span><span class="keyword">list(</span><span class="default">$width</span><span class="keyword">, </span><span class="default">$height</span><span class="keyword">) = </span><span class="default">getimagesize</span><span class="keyword">(</span><span class="default">$imgfile</span><span class="keyword">);<br />
<br />
</span><span class="comment">// Crop<br />
</span><span class="default">imagecopyresized</span><span class="keyword">(</span><span class="default">$cropimg</span><span class="keyword">, </span><span class="default">$origimg</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">$cropStartX</span><span class="keyword">, </span><span class="default">$cropStartY</span><span class="keyword">, </span><span class="default">$width</span><span class="keyword">, </span><span class="default">$height</span><span class="keyword">, </span><span class="default">$width</span><span class="keyword">, </span><span class="default">$height</span><span class="keyword">);<br />
<br />
</span><span class="comment">// TODO: write code to save new image<br />
// or, just display it like this:<br />
</span><span class="default">header</span><span class="keyword">(</span><span class="string">"Content-type: image/jpeg"</span><span class="keyword">);<br />
</span><span class="default">imagejpeg</span><span class="keyword">(</span><span class="default">$cropimg</span><span class="keyword">);<br />
<br />
</span><span class="comment">// destroy the images<br />
</span><span class="default">imagedestroy</span><span class="keyword">(</span><span class="default">$cropimg</span><span class="keyword">);<br />
</span><span class="default">imagedestroy</span><span class="keyword">(</span><span class="default">$origimg</span><span class="keyword">);<br />
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="50996""></a>
  <div class="note">
   <strong class="user">Coodiss at w3bbix dot net</strong>
   <a href="#50996" class="date">15-Mar-2005 09:51</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Heres a easy way to scale images to the &lt;td&gt; that they are in<br />
*this is broken up so anyone can understand it :)<br />
<br />
&lt;?<br />
$imageinfo = getimagesize("images/picture.jpg");<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
$ix=$imageinfo[0];<br />
$iy=$imageinfo[1];<br />
<br />
$widthscale = $ix/175;&nbsp; //&lt;TD&gt; WIDTH<br />
$heightscale = $iy/175; //&lt;TD&gt; HEIGHT<br />
<br />
if($widthscale &lt; 1)<br />
$nwidth = $ix*$widthscale;<br />
else<br />
$nwidth = $ix/$widthscale;<br />
<br />
if($heightscale &lt; 1)<br />
$nheight = $iy*$heightscale;<br />
else<br />
$nheight = $iy/$heightscale;<br />
<br />
?&gt;</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="49930""></a>
  <div class="note">
   <strong class="user">php dot net at dannysauer dot com</strong>
   <a href="#49930" class="date">12-Feb-2005 08:23</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Note that, if you're going to be a good programmer and use named constatnts (IMAGETYPE_JPEG) rather than their values (2), you want to use the IMAGETYPE variants - IMAGETYPE_JPEG, IMAGETYPE GIF, IMAGETYPE_PNG, etc.&nbsp; For some reason, somebody made a horrible decision, and IMG_PNG is actually 4 in my version of PHP, while IMAGETYPE_PNG is 3.&nbsp; It took me a while to figure out why comparing the type against IMG_PNG was failing...</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="42662""></a>
  <div class="note">
   <strong class="user">diablx at hotmail dot com</strong>
   <a href="#42662" class="date">25-May-2004 02:36</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I'm sorry for they other scripts, but I made one mistake about the image resizing... here is a working script !<br />
&lt;?<br />
&nbsp;&nbsp;&nbsp; // Some configuration variables !<br />
&nbsp;&nbsp;&nbsp; $maxWidth = 90;<br />
&nbsp;&nbsp;&nbsp; $maxHeight = 90;<br />
&nbsp;&nbsp;&nbsp; $maxCols = 8;<br />
&nbsp;&nbsp;&nbsp; $webDir = "https://localhost/images/";<br />
&nbsp;&nbsp;&nbsp; $localDir = $_SERVER['DOCUMENT_ROOT']."/images/";<br />
<br />
&nbsp;&nbsp;&nbsp; $AutorisedImageType = array ("jpg", "jpeg", "gif", "png");<br />
?&gt;<br />
<br />
&lt;center&gt;<br />
&lt;table border='1' cellspacing='5' cellpadding='5' style="border-collapse:collapse; border-style: dotted"&gt;<br />
&lt;tr&gt;<br />
&nbsp;&nbsp; &lt;?<br />
&nbsp;&nbsp; // Open localDir<br />
&nbsp;&nbsp; $dh = opendir($localDir);<br />
&nbsp;&nbsp; while (false !== ($filename = readdir($dh))) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; $filesArray[] = $filename;<br />
&nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp; // Display and resize<br />
&nbsp;&nbsp; foreach ($filesArray as $images) {<br />
&nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; $ext = substr($images, strpos($images, ".")+1, strlen($images));<br />
&nbsp;&nbsp; &nbsp; &nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; if( in_array($ext, $AutorisedImageType) ) {<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; list($width, $height, $type, $attr) = @getimagesize( $localDir.$images );<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $xRatio = $maxWidth / $width; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $yRatio = $maxHeight / $height; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if ( ($width &lt;= $maxWidth) &amp;&amp; ($height &lt;= $maxHeight) ) { <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $newWidth = $width; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $newHeight = $height; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; } <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; else if (($xRatio * $height) &lt; $maxHeight) { <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $newHeight = ceil($xRatio * $height); <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $newWidth = $maxWidth; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; } <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; else { <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $newWidth = ceil($yRatio * $width); <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $newHeight = $maxHeight; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; } <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if($i == $maxCols) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; echo "&lt;/tr&gt;&lt;tr&gt;";<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $i = 0;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; echo "&lt;td align='center' valign='middle' width='$maxWidth' height='$maxHeight'&gt;&lt;img src='".$webDir.$images."' width='$newWidth' height='$newHeight'&gt;&lt;/td&gt;";<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $i++;<br />
&nbsp;&nbsp; &nbsp; &nbsp; }<br />
&nbsp;&nbsp; }<br />
?&gt;<br />
&lt;/tr&gt;<br />
&lt;/table&gt;<br />
&lt;/center&gt;</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
</div>
</div>
</div></div></body></html>
