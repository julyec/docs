<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
 <head>
  <meta http-equiv="content-type" content="text/html; CHARSET=UTF-8">
  <title>Evaluates the given XPath expression</title>
<link media="all" rel="stylesheet" type="text/css" href="styles/03e73060321a0a848018724a6c83de7f-theme-base.css" />
<link media="all" rel="stylesheet" type="text/css" href="styles/03e73060321a0a848018724a6c83de7f-theme-medium.css" />

  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <link media="all" rel="stylesheet" type="text/css" href="style.css"/>
 </head>
 <body class="docs" class="docs"><div class="navbar navbar-fixed-top">
  <div class="navbar-inner clearfix">
    <ul class="nav" style="width: 100%">
      <li style="float: left;"><a href="domxpath.evaluate.html">? DOMXPath::evaluate</a></li>
      <li style="float: right;"><a href="domxpath.registernamespace.html">DOMXPath::registerNamespace ?</a></li>
    </ul>
  </div>
</div>
<div id="breadcrumbs" class="clearfix">
  <ul class="breadcrumbs-container">
    <li><a href="index.html">PHP Manual</a></li>
    <li><a href="class.domxpath.html">DOMXPath</a></li>
    <li>Evaluates the given XPath expression</li>
  </ul>
</div>
<div id="layout">
  <div id="layout-content"><div id="domxpath.query" class="refentry">
 <div class="refnamediv">
  <h1 class="refname">DOMXPath::query</h1>
  <p class="verinfo">(PHP 5, PHP 7, PHP 8)</p><p class="refpurpose"><span class="refname">DOMXPath::query</span> &mdash; <span class="dc-title">
   Evaluates the given XPath expression 
  </span></p>

 </div>
 <div class="refsect1 description" id="refsect1-domxpath.query-description">
  <h3 class="title">说明</h3>
  <div class="methodsynopsis dc-description">
   <span class="modifier">public</span> <span class="methodname"><strong>DOMXPath::query</strong></span>(<span class="methodparam"><span class="type">string</span> <code class="parameter">$expression</code></span>, <span class="methodparam"><span class="type">?</span><span class="type"><span class="type"><a href="class.domnode.html" class="type DOMNode">DOMNode</a></span><span class="type"></span></span> <code class="parameter">$contextNode</code><span class="initializer"> = <strong><code>null</code></strong></span></span>, <span class="methodparam"><span class="type">bool</span> <code class="parameter">$registerNodeNS</code><span class="initializer"> = <strong><code>true</code></strong></span></span>): <span class="type"><a href="language.types.declarations.html#language.types.declarations.mixed" class="type mixed">mixed</a></span></div>

  <p class="para rdfs-comment">
   Executes the given XPath <code class="parameter">expression</code>.
  </p>
 </div>

 <div class="refsect1 parameters" id="refsect1-domxpath.query-parameters">
  <h3 class="title">参数</h3>
  <p class="para">
   <dl>
    
     <dt>
<code class="parameter">expression</code></dt>

     <dd>

      <p class="para">
       The XPath expression to execute.
      </p>
     </dd>

    
    
     <dt>
<code class="parameter">contextNode</code></dt>

     <dd>

      <p class="para">
       The optional <code class="parameter">contextNode</code> can be specified for
       doing relative XPath queries. By default, the queries are relative to 
       the root element.
      </p>
     </dd>

    
    
     <dt>
<code class="parameter">registerNodeNS</code></dt>

     <dd>

      <p class="para">
       The optional <code class="parameter">registerNodeNS</code> can be specified to 
       disable automatic registration of the context node.
      </p>
     </dd>

    
   </dl>

  </p>
 </div>

 <div class="refsect1 returnvalues" id="refsect1-domxpath.query-returnvalues">
  <h3 class="title">返回值</h3>
  <p class="para">
   Returns a <span class="classname"><a href="class.domnodelist.html" class="classname">DOMNodeList</a></span> containing all nodes matching
   the given XPath <code class="parameter">expression</code>. Any expression which
   does not return nodes will return an empty
   <span class="classname"><a href="class.domnodelist.html" class="classname">DOMNodeList</a></span>.
  </p>
  <p class="para">
   If the <code class="parameter">expression</code> is malformed or the
   <code class="parameter">contextNode</code> is invalid,
   <span class="methodname"><strong>DOMXPath::query()</strong></span> returns <strong><code>false</code></strong>.
  </p>
 </div>

 <div class="refsect1 examples" id="refsect1-domxpath.query-examples">
  <h3 class="title">示例</h3>
  <p class="para">
   <div class="example" id="">
    <p><strong>Example #1 Getting all the english books</strong></p>
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br /><br />$doc </span><span style="color: #007700">= new </span><span style="color: #0000BB">DOMDocument</span><span style="color: #007700">;<br /><br /></span><span style="color: #FF8000">// We don't want to bother with white spaces<br /></span><span style="color: #0000BB">$doc</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">preserveWhiteSpace </span><span style="color: #007700">= </span><span style="color: #0000BB">false</span><span style="color: #007700">;<br /><br /></span><span style="color: #0000BB">$doc</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">load</span><span style="color: #007700">(</span><span style="color: #DD0000">'book.xml'</span><span style="color: #007700">);<br /><br /></span><span style="color: #0000BB">$xpath </span><span style="color: #007700">= new </span><span style="color: #0000BB">DOMXPath</span><span style="color: #007700">(</span><span style="color: #0000BB">$doc</span><span style="color: #007700">);<br /><br /></span><span style="color: #FF8000">// We start from the root element<br /></span><span style="color: #0000BB">$query </span><span style="color: #007700">= </span><span style="color: #DD0000">'//book/chapter/para/informaltable/tgroup/tbody/row/entry[. = "en"]'</span><span style="color: #007700">;<br /><br /></span><span style="color: #0000BB">$entries </span><span style="color: #007700">= </span><span style="color: #0000BB">$xpath</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">query</span><span style="color: #007700">(</span><span style="color: #0000BB">$query</span><span style="color: #007700">);<br /><br />foreach (</span><span style="color: #0000BB">$entries </span><span style="color: #007700">as </span><span style="color: #0000BB">$entry</span><span style="color: #007700">) {<br />    echo </span><span style="color: #DD0000">"Found </span><span style="color: #007700">{</span><span style="color: #0000BB">$entry</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">previousSibling</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">previousSibling</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">nodeValue</span><span style="color: #007700">}</span><span style="color: #DD0000">," </span><span style="color: #007700">.<br />         </span><span style="color: #DD0000">" by </span><span style="color: #007700">{</span><span style="color: #0000BB">$entry</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">previousSibling</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">nodeValue</span><span style="color: #007700">}</span><span style="color: #DD0000">\n"</span><span style="color: #007700">;<br />}<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
    </div>

    <div class="example-contents"><p>以上示例会输出：</p></div>
    <div class="example-contents screen">
<div class="cdata"><pre>
Found The Grapes of Wrath, by John Steinbeck
Found The Pearl, by John Steinbeck
</pre></div>
    </div>
    <div class="example-contents"><p>
     We can also use the <code class="parameter">contextNode</code> parameter to shorten
     our expression:
    </p></div>
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br /><br />$doc </span><span style="color: #007700">= new </span><span style="color: #0000BB">DOMDocument</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">$doc</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">preserveWhiteSpace </span><span style="color: #007700">= </span><span style="color: #0000BB">false</span><span style="color: #007700">;<br /><br /></span><span style="color: #0000BB">$doc</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">load</span><span style="color: #007700">(</span><span style="color: #DD0000">'book.xml'</span><span style="color: #007700">);<br /><br /></span><span style="color: #0000BB">$xpath </span><span style="color: #007700">= new </span><span style="color: #0000BB">DOMXPath</span><span style="color: #007700">(</span><span style="color: #0000BB">$doc</span><span style="color: #007700">);<br /><br /></span><span style="color: #0000BB">$tbody </span><span style="color: #007700">= </span><span style="color: #0000BB">$doc</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">getElementsByTagName</span><span style="color: #007700">(</span><span style="color: #DD0000">'tbody'</span><span style="color: #007700">)-&gt;</span><span style="color: #0000BB">item</span><span style="color: #007700">(</span><span style="color: #0000BB">0</span><span style="color: #007700">);<br /><br /></span><span style="color: #FF8000">// our query is relative to the tbody node<br /></span><span style="color: #0000BB">$query </span><span style="color: #007700">= </span><span style="color: #DD0000">'row/entry[. = "en"]'</span><span style="color: #007700">;<br /><br /></span><span style="color: #0000BB">$entries </span><span style="color: #007700">= </span><span style="color: #0000BB">$xpath</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">query</span><span style="color: #007700">(</span><span style="color: #0000BB">$query</span><span style="color: #007700">, </span><span style="color: #0000BB">$tbody</span><span style="color: #007700">);<br /><br />foreach (</span><span style="color: #0000BB">$entries </span><span style="color: #007700">as </span><span style="color: #0000BB">$entry</span><span style="color: #007700">) {<br />    echo </span><span style="color: #DD0000">"Found </span><span style="color: #007700">{</span><span style="color: #0000BB">$entry</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">previousSibling</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">previousSibling</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">nodeValue</span><span style="color: #007700">}</span><span style="color: #DD0000">," </span><span style="color: #007700">.<br />         </span><span style="color: #DD0000">" by </span><span style="color: #007700">{</span><span style="color: #0000BB">$entry</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">previousSibling</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">nodeValue</span><span style="color: #007700">}</span><span style="color: #DD0000">\n"</span><span style="color: #007700">;<br />}<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
    </div>

   </div>
  </p>
 </div>

 <div class="refsect1 seealso" id="refsect1-domxpath.query-seealso">
  <h3 class="title">参见</h3>
  <p class="para">
   <ul class="simplelist">
    <li class="member"><span class="methodname"><a href="domxpath.evaluate.html" class="methodname" rel="rdfs-seeAlso">DOMXPath::evaluate()</a> - Evaluates the given XPath expression and returns a typed result if possible</span></li>
   </ul>
  </p>
 </div>

</div><div id="usernotes">
 <div class="head">
  <h3 class="title">User Contributed Notes</h3>
 </div>
<div id="allnotes">  <a name="119748""></a>
  <div class="note">
   <strong class="user">chris dot russo99 at gmail dot com</strong>
   <a href="#119748" class="date">17-Aug-2016 03:58</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you can't find a solution for PHP XPATH case sensitivity, you can always try this approach:<br />
<br />
<a href="http://fsockopen.com/php-programming/your-final-stop-for-php-xpath-case-insensitive" rel="nofollow" target="_blank">http://fsockopen.com/php-programming/your-final-stop-for-php-xpath-case-insensitive</a><br />
<br />
Instead of inserting PHP functions into a XPATH object, convert the XPATH object into an Array(), and then use any PHP function, the regular way.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="117612""></a>
  <div class="note">
   <strong class="user">ikmahesh at cdac dot in</strong>
   <a href="#117612" class="date">08-Jul-2015 09:29</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
The parameters for $xPath-&gt;query() method is case sensitive. <br />
It matches IDs exact words.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="113248""></a>
  <div class="note">
   <strong class="user">RiKdnUa at mail dot ru</strong>
   <a href="#113248" class="date">17-Sep-2013 04:26</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Пример XPath запроса к XML документу. XML документ содержить элементы с именами из НЕлатинских символов (кириллица). При использовании в XPath запросе предиката, функция DOMXPath::query() выдает предупреждение и запрос не работает. Чтобы запрос работал, надо явно указывать ось. Файл этого примера должен быть в кодировке WINDOWS-1251. Тестировал в PHP 5.2.9-2 и PHP 5.2.17<br />
<br />
Example XPath-query to the XML-document. XML-document contains an elements with the names of non-Latin characters (cyrillic). When used predicate in XPath-query, function DOMXPath::query() gives a warning and query does not work. In order to earned the query, it is necessary to explicitly specify the axis. The file of this example is to be in the encoding WINDOWS-1251. Tested in PHP 5.2.9-2 and PHP 5.2.17<br />
<span class="default">&lt;?php<br />
ini_set</span><span class="keyword">(</span><span class="string">"display_errors"</span><span class="keyword">,</span><span class="string">"on"</span><span class="keyword">);<br />
</span><span class="default">error_reporting</span><span class="keyword">(-</span><span class="default">1</span><span class="keyword">);<br />
function </span><span class="default">utf8encode</span><span class="keyword">(</span><span class="default">$str</span><span class="keyword">){return </span><span class="default">iconv</span><span class="keyword">(</span><span class="string">'WINDOWS-1251'</span><span class="keyword">, </span><span class="string">'UTF-8'</span><span class="keyword">, </span><span class="default">$str</span><span class="keyword">);}<br />
</span><span class="default">$xml</span><span class="keyword">=</span><span class="string">"&lt;?xml version='1.0' encoding='WINDOWS-1251'?&gt;<br />
&lt;часть&gt;<br />
&lt;ссылка href='yandex.com'&gt;Яндекс&lt;/ссылка&gt;<br />
&lt;ссылка href='rik.dn.ua/fotopan.php'&gt;г.Донецк&lt;/ссылка&gt;<br />
&lt;/часть&gt;<br />
"</span><span class="keyword">;<br />
</span><span class="default">$document</span><span class="keyword">=new </span><span class="default">domDocument</span><span class="keyword">();<br />
</span><span class="default">$document</span><span class="keyword">-&gt;</span><span class="default">preserveWhiteSpace</span><span class="keyword">=</span><span class="default">false</span><span class="keyword">;<br />
</span><span class="default">$document</span><span class="keyword">-&gt;</span><span class="default">loadXML</span><span class="keyword">(</span><span class="default">$xml</span><span class="keyword">);<br />
</span><span class="default">$domxpath</span><span class="keyword">=new </span><span class="default">domXpath</span><span class="keyword">(</span><span class="default">$document</span><span class="keyword">);<br />
</span><span class="default">$list</span><span class="keyword">=</span><span class="default">$domxpath</span><span class="keyword">-&gt;</span><span class="default">query</span><span class="keyword">(</span><span class="default">utf8encode</span><span class="keyword">(</span><span class="string">'/child::часть/child::ссылка'</span><span class="keyword">));</span><span class="comment">//Ok<br />
</span><span class="keyword">echo </span><span class="string">'$list-&gt;length='</span><span class="keyword">.</span><span class="default">$list</span><span class="keyword">-&gt;</span><span class="default">length</span><span class="keyword">.</span><span class="string">"\n&lt;br/&gt;\n"</span><span class="keyword">;<br />
</span><span class="default">$list</span><span class="keyword">=</span><span class="default">$domxpath</span><span class="keyword">-&gt;</span><span class="default">query</span><span class="keyword">(</span><span class="default">utf8encode</span><span class="keyword">(</span><span class="string">'/часть/ссылка'</span><span class="keyword">));</span><span class="comment">//Ok<br />
</span><span class="keyword">echo </span><span class="string">'$list-&gt;length='</span><span class="keyword">.</span><span class="default">$list</span><span class="keyword">-&gt;</span><span class="default">length</span><span class="keyword">.</span><span class="string">"\n&lt;br/&gt;\n"</span><span class="keyword">;<br />
</span><span class="default">$list</span><span class="keyword">=</span><span class="default">$domxpath</span><span class="keyword">-&gt;</span><span class="default">query</span><span class="keyword">(</span><span class="default">utf8encode</span><span class="keyword">(</span><span class="string">'/child::часть/child::ссылка[position()=1]'</span><span class="keyword">));</span><span class="comment">//Ok<br />
</span><span class="keyword">echo </span><span class="string">'$list-&gt;length='</span><span class="keyword">.</span><span class="default">$list</span><span class="keyword">-&gt;</span><span class="default">length</span><span class="keyword">.</span><span class="string">"\n&lt;br/&gt;\n"</span><span class="keyword">;<br />
</span><span class="default">$list</span><span class="keyword">=</span><span class="default">$domxpath</span><span class="keyword">-&gt;</span><span class="default">query</span><span class="keyword">(</span><span class="default">utf8encode</span><span class="keyword">(</span><span class="string">'/часть/ссылка[1]'</span><span class="keyword">));</span><span class="comment">//Warning: DOMXPath::query() [domxpath.query]: Invalid expression in ...<br />
</span><span class="keyword">echo </span><span class="string">'$list-&gt;length='</span><span class="keyword">.</span><span class="default">$list</span><span class="keyword">-&gt;</span><span class="default">length</span><span class="keyword">.</span><span class="string">"\n&lt;br/&gt;\n"</span><span class="keyword">;<br />
</span><span class="default">$list</span><span class="keyword">=</span><span class="default">$domxpath</span><span class="keyword">-&gt;</span><span class="default">query</span><span class="keyword">(</span><span class="default">utf8encode</span><span class="keyword">(</span><span class="string">'/часть/ссылка[position()=1]'</span><span class="keyword">));</span><span class="comment">//Warning: DOMXPath::query() [domxpath.query]: Invalid expression in ...<br />
</span><span class="keyword">echo </span><span class="string">'$list-&gt;length='</span><span class="keyword">.</span><span class="default">$list</span><span class="keyword">-&gt;</span><span class="default">length</span><span class="keyword">.</span><span class="string">"\n&lt;br/&gt;\n"</span><span class="keyword">;<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="105881""></a>
  <div class="note">
   <strong class="user">info at syncgw dot com</strong>
   <a href="#105881" class="date">22-Sep-2011 09:05</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
A warning to all PHP programmer using this function PHP 5.0.0.0: We needed an equivalent to upper-case() function (is not available in XPath 1.0).<br />
<br />
XML-Document:<br />
<br />
&lt;Rec&gt;<br />
&lt;SourceRef&gt;./c:calendar2&lt;/SourceRef&gt;<br />
&lt;SourceRef&gt;./c:calendar&lt;/SourceRef&gt;<br />
&lt;/Rec&gt;<br />
<br />
using <br />
<br />
query('//DataStore[translate(SourceRef,"abcdefghijklmnopqrstuvwxyz","ABCDEFGHIJKLMNOPQRSTUVWXYZ")="./C:CALENDAR"]/.')<br />
<br />
returns ZERO matches.<br />
<br />
If you change XML-Source to<br />
<br />
&lt;Rec&gt;<br />
&lt;SourceRef&gt;./c:calendar&lt;/SourceRef&gt;<br />
&lt;SourceRef&gt;./c:calendar2&lt;/SourceRef&gt;<br />
&lt;/Rec&gt;<br />
<br />
everything works fine</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="105692""></a>
  <div class="note">
   <strong class="user">yuriscom at gmail dot com</strong>
   <a href="#105692" class="date">07-Sep-2011 10:29</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I hope it will be helpful for someone:
<br />

<br />
I spent some time to solve the problem when you query a string with quotes inside. 
<br />

<br />
Suppose you have:
<br />
$parameter = "aaa \"bbb\"";
<br />
$domxpath-&gt;query("//path[text()=\"".$parameter."\""];
<br />

<br />
In versions &gt; 5.3.0 there is registerPhpFunctions where you can put an addslashes. But in older version you cannot do it in simple way.
<br />

<br />
So the solution is to use a concat function. So when you have a substring with " inside, wrap it with '. And when you have a substring with ', then wrap with in ".
<br />

<br />
The code is:
<br />

<br />
<span class="default">&lt;?php
<br />
$dom </span><span class="keyword">= new </span><span class="default">DOMDocument</span><span class="keyword">;
<br />
</span><span class="default">$dom</span><span class="keyword">-&gt;</span><span class="default">loadXML</span><span class="keyword">(</span><span class="string">"&lt;name&gt;'bla' \"bla\" bla&lt;/name&gt;"</span><span class="keyword">);
<br />
</span><span class="default">$xpath </span><span class="keyword">= new </span><span class="default">DOMXPath</span><span class="keyword">(</span><span class="default">$dom</span><span class="keyword">);
<br />
</span><span class="default">$nodeList </span><span class="keyword">= </span><span class="default">$xpath</span><span class="keyword">-&gt;</span><span class="default">query</span><span class="keyword">(</span><span class="string">"//name[text()=concat(\"'bla' \" ,'\"bla\"' ,\" bla\")]"</span><span class="keyword">);
<br />
</span><span class="default">?&gt;
<br />
</span>
<br />
Below is the function that receives a string and returns a concat pattern for the xpath query.
<br />

<br />
<span class="default">&lt;?php
<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">function </span><span class="default">getPattern_MQ</span><span class="keyword">(</span><span class="default">$pattern</span><span class="keyword">) {
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// initiating an array of substrings
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$ar </span><span class="keyword">= array();
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// points to the current position in a string
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$offset </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$strlen </span><span class="keyword">= </span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$pattern</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; while (</span><span class="default">true</span><span class="keyword">) {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// find a position of quotes
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$qPos </span><span class="keyword">= </span><span class="default">strpos</span><span class="keyword">(</span><span class="default">$pattern</span><span class="keyword">, </span><span class="string">"\""</span><span class="keyword">, </span><span class="default">$offset</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; 
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (!</span><span class="default">$qPos</span><span class="keyword">) {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// no more quotes
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$leftOver </span><span class="keyword">= </span><span class="default">$offset </span><span class="keyword">- </span><span class="default">$strlen</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">$leftOver </span><span class="keyword">&lt; </span><span class="default">0</span><span class="keyword">) {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$string </span><span class="keyword">= </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$pattern</span><span class="keyword">, </span><span class="default">$leftOver</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$ar</span><span class="keyword">[] = </span><span class="string">"\"" </span><span class="keyword">. </span><span class="default">$string </span><span class="keyword">. </span><span class="string">"\""</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; break;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// add the whole substring before the quotes into the array
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$ar</span><span class="keyword">[] = </span><span class="string">"\"" </span><span class="keyword">. </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$pattern</span><span class="keyword">, </span><span class="default">$offset</span><span class="keyword">, (</span><span class="default">$qPos </span><span class="keyword">- </span><span class="default">$offset</span><span class="keyword">)) . </span><span class="string">"\""</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// add the quotes wrapped with single quot
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$ar</span><span class="keyword">[] = </span><span class="string">"'" </span><span class="keyword">. </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$pattern</span><span class="keyword">, </span><span class="default">$qPos</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">) . </span><span class="string">"'"</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$offset </span><span class="keyword">= </span><span class="default">$qPos </span><span class="keyword">+ </span><span class="default">1</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// join the array to get: concat("aaa",'"',"bbb",'"');
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$pattern </span><span class="keyword">= </span><span class="string">"concat(''," </span><span class="keyword">. </span><span class="default">join</span><span class="keyword">(</span><span class="string">","</span><span class="keyword">, </span><span class="default">$dynamicPatternsAr</span><span class="keyword">) . </span><span class="string">")"</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">$pattern</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; }
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="103461""></a>
  <div class="note">
   <strong class="user">chris AT cmbuckley DOT co DOT uk</strong>
   <a href="#103461" class="date">14-Apr-2011 07:31</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
To help with the problem where the default namespace is not registered with the DOMXPath object, you can use the following replacement to update your paths accordingly:
<br />

<br />
<span class="default">&lt;?php
<br />

<br />
$xml </span><span class="keyword">= &lt;&lt;&lt;EOS
<br />
</span><span class="string">&lt;root xmlns="urn:test"&gt;
<br />
&nbsp;&nbsp;&nbsp; &lt;foo&gt;bar&lt;/foo&gt;
<br />
&lt;/root&gt;
<br />
</span><span class="keyword">EOS;
<br />

<br />
</span><span class="default">$expression </span><span class="keyword">= </span><span class="string">'//foo'</span><span class="keyword">;
<br />
</span><span class="default">$prefix </span><span class="keyword">= </span><span class="string">'fakeprefix'</span><span class="keyword">;
<br />

<br />
</span><span class="default">$doc </span><span class="keyword">= new </span><span class="default">DOMDocument</span><span class="keyword">();
<br />
</span><span class="default">$doc</span><span class="keyword">-&gt;</span><span class="default">loadXML</span><span class="keyword">(</span><span class="default">$xml</span><span class="keyword">);
<br />

<br />
</span><span class="default">$context </span><span class="keyword">= </span><span class="default">$doc</span><span class="keyword">-&gt;</span><span class="default">documentElement</span><span class="keyword">; </span><span class="comment">// or whichever element you choose
<br />
</span><span class="default">$xpath </span><span class="keyword">= new </span><span class="default">DOMXPath</span><span class="keyword">(</span><span class="default">$doc</span><span class="keyword">);
<br />

<br />
</span><span class="comment">// register namespace as below, and apply a regex to the expression
<br />
</span><span class="keyword">if (</span><span class="default">null </span><span class="keyword">!== </span><span class="default">$context</span><span class="keyword">-&gt;</span><span class="default">namespaceURI</span><span class="keyword">) {
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$xpath</span><span class="keyword">-&gt;</span><span class="default">registerNamespace</span><span class="keyword">(</span><span class="default">$prefix</span><span class="keyword">, </span><span class="default">$context</span><span class="keyword">-&gt;</span><span class="default">namespaceURI</span><span class="keyword">);
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$expression </span><span class="keyword">= </span><span class="default">preg_replace</span><span class="keyword">(</span><span class="string">'#(::|/\s*|\A)(?![/@].+?|[a-z\-]+::)#'</span><span class="keyword">, </span><span class="string">'$1' </span><span class="keyword">. </span><span class="default">$prefix </span><span class="keyword">. </span><span class="string">':$2'</span><span class="keyword">, </span><span class="default">$expression</span><span class="keyword">);
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">var_dump</span><span class="keyword">(</span><span class="default">$expression</span><span class="keyword">); </span><span class="comment">// string(16) "//fakeprefix:foo"
<br />
</span><span class="keyword">}
<br />

<br />
</span><span class="default">$foo </span><span class="keyword">= </span><span class="default">$xpath</span><span class="keyword">-&gt;</span><span class="default">query</span><span class="keyword">(</span><span class="default">$expression</span><span class="keyword">, </span><span class="default">$context</span><span class="keyword">)-&gt;</span><span class="default">item</span><span class="keyword">(</span><span class="default">0</span><span class="keyword">);
<br />
</span><span class="default">var_dump</span><span class="keyword">(</span><span class="default">$doc</span><span class="keyword">-&gt;</span><span class="default">saveXML</span><span class="keyword">(</span><span class="default">$foo</span><span class="keyword">)); </span><span class="comment">// string(14) "&lt;foo&gt;bar&lt;/foo&gt;"
<br />

<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="99760""></a>
  <div class="note">
   <strong class="user">kkez at example dot com</strong>
   <a href="#99760" class="date">03-Sep-2010 07:51</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If the query() function seems to ignore your $contextnode, and instead returns all the tags in the document, try to use a relative path (use a . in front of the query):<br />
<br />
<span class="default">&lt;?php<br />
&nbsp;&nbsp;&nbsp; $xml </span><span class="keyword">= </span><span class="string">"&lt;?xml version='1.0' encoding='UTF-8'?&gt;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; &lt;test&gt;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; &lt;tag1&gt;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; &lt;uselesstag&gt;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; &lt;tag2&gt;test&lt;/tag2&gt;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; &lt;/uselesstag&gt;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; &lt;/tag1&gt;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; &lt;tag2&gt;test2&lt;/tag2&gt;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; &lt;/test&gt;"</span><span class="keyword">;<br />
&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$dom </span><span class="keyword">= new </span><span class="default">DomDocument</span><span class="keyword">();<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$dom</span><span class="keyword">-&gt;</span><span class="default">loadXML</span><span class="keyword">(</span><span class="default">$xml</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$xpath </span><span class="keyword">= new </span><span class="default">DomXPath</span><span class="keyword">(</span><span class="default">$dom</span><span class="keyword">);<br />
&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$tag1 </span><span class="keyword">= </span><span class="default">$dom</span><span class="keyword">-&gt;</span><span class="default">getElementsByTagName</span><span class="keyword">(</span><span class="string">"tag1"</span><span class="keyword">)-&gt;</span><span class="default">item</span><span class="keyword">(</span><span class="default">0</span><span class="keyword">);<br />
&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; echo </span><span class="default">$xpath</span><span class="keyword">-&gt;</span><span class="default">query</span><span class="keyword">(</span><span class="string">"//tag2"</span><span class="keyword">)-&gt;</span><span class="default">length</span><span class="keyword">; </span><span class="comment">//output 2 -&gt; correct<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">echo </span><span class="default">$xpath</span><span class="keyword">-&gt;</span><span class="default">query</span><span class="keyword">(</span><span class="string">"//tag2"</span><span class="keyword">, </span><span class="default">$tag1</span><span class="keyword">)-&gt;</span><span class="default">length</span><span class="keyword">; </span><span class="comment">//output 2 -&gt; wrong, the query is not relative<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">echo </span><span class="default">$xpath</span><span class="keyword">-&gt;</span><span class="default">query</span><span class="keyword">(</span><span class="string">".//tag2"</span><span class="keyword">, </span><span class="default">$tag1</span><span class="keyword">)-&gt;</span><span class="default">length</span><span class="keyword">; </span><span class="comment">//output 1 -&gt; correct (note the dot in front of //)<br />
</span><span class="default">?&gt;<br />
</span><br />
See that i couldn't use $xpath-&gt;query("tag2", $tag1) as per the documentation, since "tag2" is not a direct child of "tag1".<br />
I don't know why this note was deleted, i just tested it and it's correct.<br />
It's not a bug, it's simply not written in the documentation.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="94842""></a>
  <div class="note">
   <strong class="user">Anonymous</strong>
   <a href="#94842" class="date">27-Nov-2009 12:26</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I found this useful for building page templates
<br />

<br />
<span class="default">&lt;?php
<br />
$xsl </span><span class="keyword">= new </span><span class="default">DOMDocument</span><span class="keyword">;
<br />
</span><span class="default">$xsl</span><span class="keyword">-&gt;</span><span class="default">load</span><span class="keyword">(</span><span class="string">'layout.xsl'</span><span class="keyword">);
<br />

<br />
</span><span class="comment">// Set the &lt;xsl:include&gt; href attribute, the inner stylesheet to include in this layout
<br />
</span><span class="default">$xpath </span><span class="keyword">= new </span><span class="default">DomXPath</span><span class="keyword">(</span><span class="default">$xsl</span><span class="keyword">);
<br />
</span><span class="default">$res </span><span class="keyword">= </span><span class="default">$xpath</span><span class="keyword">-&gt;</span><span class="default">query</span><span class="keyword">(</span><span class="string">'//xsl:include'</span><span class="keyword">);
<br />
</span><span class="default">$res</span><span class="keyword">-&gt;</span><span class="default">item</span><span class="keyword">(</span><span class="default">0</span><span class="keyword">)-&gt;</span><span class="default">setAttribute</span><span class="keyword">(</span><span class="string">'href'</span><span class="keyword">,</span><span class="string">'page.xsl'</span><span class="keyword">);
<br />
</span><span class="default">$xsl</span><span class="keyword">-&gt;</span><span class="default">save</span><span class="keyword">(</span><span class="string">'media/xsl/layout.xsl'</span><span class="keyword">);
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="85381""></a>
  <div class="note">
   <strong class="user">Niklas</strong>
   <a href="#85381" class="date">27-Aug-2008 02:36</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
For XPath escaping use the following method (of course it could be more efficient).<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">public function </span><span class="default">xpathescape</span><span class="keyword">(</span><span class="default">$string</span><span class="keyword">)<br />
{<br />
</span><span class="default">$result </span><span class="keyword">= </span><span class="string">'concat('</span><span class="keyword">;<br />
<br />
for(</span><span class="default">$i</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">, </span><span class="default">$j</span><span class="keyword">=</span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$string</span><span class="keyword">); </span><span class="default">$i</span><span class="keyword">&lt;</span><span class="default">$j</span><span class="keyword">; ++</span><span class="default">$i</span><span class="keyword">)<br />
{<br />
if(</span><span class="default">$i </span><span class="keyword">&gt; </span><span class="default">0</span><span class="keyword">)<br />
</span><span class="default">$result </span><span class="keyword">.= </span><span class="string">","</span><span class="keyword">;<br />
<br />
if(</span><span class="default">$string</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">] == </span><span class="string">'\''</span><span class="keyword">)<br />
</span><span class="default">$result </span><span class="keyword">.= </span><span class="string">"\""</span><span class="keyword">.</span><span class="default">$string</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">].</span><span class="string">"\""</span><span class="keyword">;<br />
else<br />
</span><span class="default">$result </span><span class="keyword">.= </span><span class="string">'\''</span><span class="keyword">.</span><span class="default">$string</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">].</span><span class="string">'\''</span><span class="keyword">;<br />
}<br />
<br />
</span><span class="default">$result </span><span class="keyword">.= </span><span class="string">')'</span><span class="keyword">;<br />
<br />
return </span><span class="default">$result</span><span class="keyword">;<br />
}<br />
</span><span class="default">?&gt;<br />
</span><br />
Use it this way:<br />
&lt;php<br />
$xpath-&gt;query('//example[sub='.xpathescape($acomplexstring).']');<br />
<br />
?&gt;</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="84577""></a>
  <div class="note">
   <strong class="user">adam dot prall at thinkingman dot com</strong>
   <a href="#84577" class="date">19-Jul-2008 09:01</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you're wondering, like I was, why your XPath queries are not returning any of the new DOMElements you create in your (X)HTML documents, and only the ones originally loaded in with (for example) loadXML(), this is why; if you're doing things right, you have registered the nameSpace 'html' after creating your DOMXPath object thus:<br />
<br />
<span class="default">&lt;?php<br />
<br />
</span><span class="keyword">class </span><span class="default">XPathQueryLength </span><span class="keyword">{<br />
&nbsp;&nbsp; &nbsp; private </span><span class="default">$nameSpace </span><span class="keyword">= </span><span class="string">''</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; function </span><span class="default">__construct</span><span class="keyword">(</span><span class="default">DOMDocument $doc</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">xpath </span><span class="keyword">= new </span><span class="default">DOMXPath</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">doc</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">xpath</span><span class="keyword">-&gt;</span><span class="default">registerNamespace</span><span class="keyword">(<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="string">'html'</span><span class="keyword">,</span><span class="string">'<a href="http://www.w3.org/1999/xhtml" rel="nofollow" target="_blank">http://www.w3.org/1999/xhtml</a>' </span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; }<br />
&nbsp;&nbsp; &nbsp; function </span><span class="default">queryLength</span><span class="keyword">(</span><span class="default">$query</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">xpath</span><span class="keyword">-&gt;</span><span class="default">query</span><span class="keyword">(</span><span class="default">$query</span><span class="keyword">)-&gt;</span><span class="default">length</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; }<br />
}<br />
<br />
</span><span class="default">?&gt;<br />
</span><br />
...but don't forget that when adding new elements to the above DOMDocument $doc, to use createElementNS() instead of createElement(), otherwise you'll have this problem:<br />
<br />
<span class="default">&lt;?php<br />
<br />
</span><span class="comment">//$doc is a previously loaded XHTML document containing a normal html, head and body structure<br />
//$body is the first selected tag using $doc-&gt;getElementsByTagName('body');<br />
<br />
</span><span class="default">$pTag </span><span class="keyword">= </span><span class="default">$doc</span><span class="keyword">-&gt;</span><span class="default">createElement</span><span class="keyword">(</span><span class="string">'p'</span><span class="keyword">,</span><span class="string">'This is a new paragraph!'</span><span class="keyword">);<br />
</span><span class="default">$body</span><span class="keyword">-&gt;</span><span class="default">appendChild</span><span class="keyword">(</span><span class="default">$pTag</span><span class="keyword">);<br />
<br />
</span><span class="default">$xPath </span><span class="keyword">= new </span><span class="default">XPathQueryLength</span><span class="keyword">(</span><span class="default">$doc</span><span class="keyword">);<br />
print </span><span class="default">$xPath</span><span class="keyword">-&gt;</span><span class="default">queryLength</span><span class="keyword">(</span><span class="string">'//html:p'</span><span class="keyword">);<br />
<br />
</span><span class="default">output</span><span class="keyword">: </span><span class="default">0<br />
<br />
</span><span class="keyword">print </span><span class="default">$xPath</span><span class="keyword">-&gt;</span><span class="default">queryLength</span><span class="keyword">(</span><span class="string">'//p'</span><span class="keyword">);<br />
<br />
</span><span class="default">output</span><span class="keyword">: </span><span class="default">1<br />
<br />
?&gt;<br />
</span><br />
So do this instead:<br />
<br />
<span class="default">&lt;?php<br />
<br />
</span><span class="comment">//$doc is a previously loaded XHTML document containing a normal html, head and body structure<br />
//$body is the first selected tag using $doc-&gt;getElementsByTagName('body');<br />
<br />
</span><span class="default">$pTag </span><span class="keyword">= </span><span class="default">$doc</span><span class="keyword">-&gt;</span><span class="default">createElementNS</span><span class="keyword">(</span><span class="string">'<a href="http://www.w3.org/1999/xhtml" rel="nofollow" target="_blank">http://www.w3.org/1999/xhtml</a>'</span><span class="keyword">,</span><span class="string">'p'</span><span class="keyword">,</span><span class="string">'This is a new paragraph!'</span><span class="keyword">);<br />
</span><span class="default">$body</span><span class="keyword">-&gt;</span><span class="default">appendChild</span><span class="keyword">(</span><span class="default">$pTag</span><span class="keyword">);<br />
<br />
</span><span class="default">$xPath </span><span class="keyword">= new </span><span class="default">XPathQueryLength</span><span class="keyword">(</span><span class="default">$doc</span><span class="keyword">);<br />
print </span><span class="default">$xPath</span><span class="keyword">-&gt;</span><span class="default">queryLength</span><span class="keyword">(</span><span class="string">'//html:p'</span><span class="keyword">);<br />
<br />
</span><span class="default">output</span><span class="keyword">: </span><span class="default">2<br />
<br />
</span><span class="keyword">print </span><span class="default">$xPath</span><span class="keyword">-&gt;</span><span class="default">queryLength</span><span class="keyword">(</span><span class="string">'//p'</span><span class="keyword">);<br />
<br />
</span><span class="default">output</span><span class="keyword">: </span><span class="default">0<br />
<br />
?&gt;<br />
</span><br />
The resulting XHTML file from both example scripts looks much like this:<br />
<br />
&lt;html&gt;<br />
&nbsp; &lt;head&gt;&lt;/head&gt;<br />
&nbsp; &lt;body&gt;<br />
&nbsp;&nbsp; &nbsp; &lt;p&gt;This is a hardcoded paragraph.&lt;/p&gt;<br />
&nbsp;&nbsp; &nbsp; &lt;p&gt;This is a new paragraph!&lt;/p&gt;<br />
&nbsp; &lt;/body&gt;<br />
&lt;/html&gt;<br />
<br />
...so you would think that a paragraph is a paragraph is a paragraph, since you never see the prefix, as in "&lt;html:p&gt;This is a new paragraph!&lt;/html:p&gt;".<br />
<br />
This may seem glaringly obvious, but I was writing a class that converts CSS queries into XPath queries, and the fact that a namespace had been registered was rather buried in the code.<br />
<br />
We love the DOM, the DOM is good to us.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="81542""></a>
  <div class="note">
   <strong class="user">Nibinaear</strong>
   <a href="#81542" class="date">03-Mar-2008 06:15</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I've searched the entire web looking for a way to update / modify/ change/ alter the elements of an xml file and found NOTHING! <br />
<br />
So here it is, the defninitive way to "Change XML elements with PHP" rather than adding / appending new ones. This uses XPATH:<br />
<br />
<span class="default">&lt;?php<br />
<br />
</span><span class="comment">// Create a DOMDocument instance<br />
</span><span class="default">$xml </span><span class="keyword">= new </span><span class="default">DOMDocument</span><span class="keyword">;<br />
<br />
</span><span class="comment">// Ignore whitespace between nodes (default: true)<br />
</span><span class="default">$xml</span><span class="keyword">-&gt;</span><span class="default">preserveWhiteSpace </span><span class="keyword">= </span><span class="default">false</span><span class="keyword">;<br />
<br />
</span><span class="default">$file</span><span class="keyword">=</span><span class="string">'about.xml'</span><span class="keyword">;<br />
<br />
</span><span class="comment">// Load the XML data source<br />
</span><span class="default">$xml</span><span class="keyword">-&gt;</span><span class="default">Load</span><span class="keyword">(</span><span class="default">$file</span><span class="keyword">);<br />
<br />
</span><span class="default">$xpath </span><span class="keyword">= new </span><span class="default">DOMXPath</span><span class="keyword">(</span><span class="default">$xml</span><span class="keyword">);<br />
<br />
</span><span class="default">$query</span><span class="keyword">=</span><span class="string">'/regions/branch'</span><span class="keyword">;<br />
<br />
</span><span class="default">$entries </span><span class="keyword">= </span><span class="default">$xpath</span><span class="keyword">-&gt;</span><span class="default">query</span><span class="keyword">(</span><span class="default">$query</span><span class="keyword">);<br />
<br />
foreach (</span><span class="default">$entries </span><span class="keyword">as </span><span class="default">$entry</span><span class="keyword">)<br />
{<br />
&nbsp; </span><span class="default">$entry</span><span class="keyword">-&gt;</span><span class="default">firstChild</span><span class="keyword">-&gt;</span><span class="default">nodeValue</span><span class="keyword">=</span><span class="string">"like this!"</span><span class="keyword">;<br />
&nbsp; echo </span><span class="default">$entry</span><span class="keyword">-&gt;</span><span class="default">firstChild</span><span class="keyword">-&gt;</span><span class="default">nodeValue</span><span class="keyword">;&nbsp; <br />
}<br />
<br />
</span><span class="default">$xml</span><span class="keyword">-&gt;</span><span class="default">save</span><span class="keyword">(</span><span class="default">$file</span><span class="keyword">);<br />
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="78739""></a>
  <div class="note">
   <strong class="user">ondrej dot fischer at 4internet dot cz</strong>
   <a href="#78739" class="date">25-Oct-2007 06:46</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Unfortunately PHP's DOM extension doesn't support use of:<br />
&lt;?xml-stylesheet type="text/xsl" ... ?&gt;<br />
processing instruction.<br />
Here is an example, how to implement it using XPath query and extending DOMDocument by a method output().<br />
<br />
<span class="default">&lt;?php<br />
<br />
</span><span class="comment">// This simple function adds missing direct usage of anonymous instances<br />
// in PHP5's reference model<br />
</span><span class="keyword">function </span><span class="default">a</span><span class="keyword">(</span><span class="default">$var</span><span class="keyword">) {<br />
&nbsp;&nbsp; return </span><span class="default">$var</span><span class="keyword">;<br />
}<br />
<br />
</span><span class="comment">// Extended DOMDocument class<br />
</span><span class="keyword">class </span><span class="default">MyDOMDocument </span><span class="keyword">extends </span><span class="default">DOMDocument<br />
</span><span class="keyword">{<br />
<br />
&nbsp;&nbsp; public function </span><span class="default">output</span><span class="keyword">()<br />
&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">$stylesheets </span><span class="keyword">= array();<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">$PIs </span><span class="keyword">= </span><span class="default">a</span><span class="keyword">(new </span><span class="default">DOMXPath</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">))<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; -&gt;</span><span class="default">query</span><span class="keyword">(</span><span class="string">'/processing-instruction("xml-stylesheet")'</span><span class="keyword">);<br />
<br />
&nbsp;&nbsp; &nbsp;&nbsp; foreach(</span><span class="default">$PIs </span><span class="keyword">as </span><span class="default">$PI</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">// This might be implemented cleaner by regular parsing<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; // of DOMProcessingInstruction::data property<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">if(</span><span class="default">ereg</span><span class="keyword">(</span><span class="string">'type *= *"text/xsl" +href *= *"([^"]+)"'</span><span class="keyword">, </span><span class="default">$PI</span><span class="keyword">-&gt;</span><span class="default">data</span><span class="keyword">, </span><span class="default">$mem</span><span class="keyword">))<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// Here should be verified, that XSL file exists.<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">a</span><span class="keyword">(</span><span class="default">$stylesheets</span><span class="keyword">[] = new </span><span class="default">DOMDocument</span><span class="keyword">())-&gt;</span><span class="default">load</span><span class="keyword">(</span><span class="default">$mem</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">]);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; }<br />
&nbsp;&nbsp; &nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp; &nbsp;&nbsp; if(</span><span class="default">$stylesheets</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$processor </span><span class="keyword">= new </span><span class="default">XSLTProcessor</span><span class="keyword">();<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; foreach(</span><span class="default">$stylesheets </span><span class="keyword">as </span><span class="default">$stylesheet</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$processor</span><span class="keyword">-&gt;</span><span class="default">importStylesheet</span><span class="keyword">(</span><span class="default">$stylesheet</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; return </span><span class="default">$processor</span><span class="keyword">-&gt;</span><span class="default">transformToDoc</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="comment">// If no stylesheet instructions present, return self directly<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="keyword">else return </span><span class="default">$this</span><span class="keyword">;<br />
<br />
&nbsp;&nbsp; }<br />
}<br />
<br />
</span><span class="default">?&gt;<br />
</span><br />
Usage:<br />
<br />
<span class="default">&lt;?php<br />
<br />
$document </span><span class="keyword">= new </span><span class="default">MyDOMDocument</span><span class="keyword">();<br />
</span><span class="default">$document</span><span class="keyword">-&gt;</span><span class="default">load</span><span class="keyword">(</span><span class="string">'my.xml'</span><span class="keyword">);<br />
echo </span><span class="default">$document</span><span class="keyword">-&gt;</span><span class="default">output</span><span class="keyword">()-&gt;</span><span class="default">saveXML</span><span class="keyword">();<br />
<br />
</span><span class="default">?&gt;<br />
</span><br />
With following file my.xml:<br />
<br />
&lt;?xml version="1.0" ?&gt;<br />
&lt;?xml-stylesheet type="text/xsl" href="my.xsl" ?&gt;<br />
&lt;my-root /&gt;<br />
<br />
and existing file my.xsl that code will transform the xml file using my.xsl and output the result.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="77747""></a>
  <div class="note">
   <strong class="user">jbarnett at flowershopnetwork dot com</strong>
   <a href="#77747" class="date">11-Sep-2007 01:46</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
The order of nodes in the return value is not guaranteed.<br />
<br />
When my code was on an old server, the returned DOMNodeList was in document order.&nbsp; On the new server, the returned DOMNodeList is in a consistent order, but it is not in document order.&nbsp; <br />
<br />
PHP passes this function call off to the xmlXPathEvalExpression() function in libxml.&nbsp; That function in libxml only accepts two arguments - the same two this PHP function accepts.&nbsp; There must have been a change in the libxml version from the old server to the new server, and that libxml behaves differently.<br />
<br />
This would be okay if PHP had a way to compare nodes so I can resort the nodes manually, but there is not.<br />
<br />
So, there is no guaranteed way to get an ordered list of nodes like DOM 3 XPath provides.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="77048""></a>
  <div class="note">
   <strong class="user">Hayley Watson</strong>
   <a href="#77048" class="date">12-Aug-2007 05:43</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Note that if your DOMDocument was loaded from HTML, where element and attribute names are case-insensitive, the DOM parser converts them all to lower-case, so your XPath queries will have to as well; '//A/@HREF' won't find anything even if the original HTML contained "&lt;A HREF='example.com'&gt;".</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="76311""></a>
  <div class="note">
   <strong class="user">nicolas_rainardNOSPAM at yahoo dot fr</strong>
   <a href="#76311" class="date">10-Jul-2007 02:04</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Please note that what clochix says is valid for *any* document which has a default namespace (as it is the case for XHTML).<br />
<br />
This document :<br />
<br />
&lt;?xml version="1.0" encoding="UTF-8" ?&gt;<br />
<br />
&lt;root xmlns="<a href="http://www.exemple.org/namespace" rel="nofollow" target="_blank">http://www.exemple.org/namespace</a>"&gt;<br />
<br />
&nbsp;&nbsp;&nbsp; &lt;element id="1"&gt;<br />
&nbsp;&nbsp;&nbsp; ...<br />
&nbsp;&nbsp;&nbsp; &lt;/element&gt;<br />
<br />
&nbsp;&nbsp;&nbsp; &lt;element id="2"&gt;<br />
&nbsp;&nbsp;&nbsp; ...<br />
&nbsp;&nbsp;&nbsp; &lt;/element&gt;<br />
<br />
&lt;/element&gt;<br />
<br />
must be accessed this way :<br />
<br />
$document = new DOMDocument();<br />
$document-&gt;load('document.xml');<br />
<br />
$xpath = new DOMXPath($document);<br />
$xpath-&gt;registerNameSpace('fakeprefix', '<a href="http://www.exemple.org/namespace" rel="nofollow" target="_blank">http://www.exemple.org/namespace</a>');<br />
<br />
$elements = $xpath-&gt;query('//fakeprefix:element');<br />
<br />
Of course, there is no prefix in the original document, but the DOMXPath class *needs* one, whatever it is, if you use a default namespace. It *doesn't work* if you specify an empty prefix like this :<br />
<br />
$xpath-&gt;registerNameSpace('', '<a href="http://www.exemple.org/namespace" rel="nofollow" target="_blank">http://www.exemple.org/namespace</a>');<br />
<br />
Hope this help to spare some time...</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="73557""></a>
  <div class="note">
   <strong class="user">clochix at clochix dot net</strong>
   <a href="#73557" class="date">01-Mar-2007 04:05</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you want to perform queries on XHTML documents, you must fix a default namespace:
<br />

<br />
<span class="default">&lt;?php
<br />
$doc </span><span class="keyword">= new </span><span class="default">DOMDocument</span><span class="keyword">;
<br />
</span><span class="default">$doc</span><span class="keyword">-&gt;</span><span class="default">preserveWhiteSpace </span><span class="keyword">= </span><span class="default">true</span><span class="keyword">;
<br />
</span><span class="default">$doc</span><span class="keyword">-&gt;</span><span class="default">resolveExternals </span><span class="keyword">= </span><span class="default">true</span><span class="keyword">; </span><span class="comment">// for character entities
<br />
</span><span class="default">$doc</span><span class="keyword">-&gt;</span><span class="default">load</span><span class="keyword">(</span><span class="string">"<a href="http://www.w3.org/" rel="nofollow" target="_blank">http://www.w3.org/</a>"</span><span class="keyword">);
<br />
</span><span class="default">$xpath </span><span class="keyword">= new </span><span class="default">DOMXPath</span><span class="keyword">(</span><span class="default">$doc</span><span class="keyword">);
<br />
</span><span class="comment">// won't work
<br />
</span><span class="default">$entries </span><span class="keyword">= </span><span class="default">$xpath</span><span class="keyword">-&gt;</span><span class="default">query</span><span class="keyword">(</span><span class="string">"//div"</span><span class="keyword">);
<br />
</span><span class="comment">// you should use :
<br />
</span><span class="default">$xpath</span><span class="keyword">-&gt;</span><span class="default">registerNamespace</span><span class="keyword">(</span><span class="string">"html"</span><span class="keyword">, </span><span class="string">"<a href="http://www.w3.org/1999/xhtml" rel="nofollow" target="_blank">http://www.w3.org/1999/xhtml</a>"</span><span class="keyword">);
<br />
</span><span class="default">$entries </span><span class="keyword">= </span><span class="default">$xpath</span><span class="keyword">-&gt;</span><span class="default">query</span><span class="keyword">(</span><span class="string">"//html:div"</span><span class="keyword">);
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="58729""></a>
  <div class="note">
   <strong class="user">jakob dot voss at nichtich dot de</strong>
   <a href="#58729" class="date">14-Nov-2005 12:33</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
You can transform the result nodes into new DOMDocument objects this way:<br />
<br />
<span class="default">&lt;?php<br />
$result </span><span class="keyword">= </span><span class="default">$xpath</span><span class="keyword">-&gt;</span><span class="default">query</span><span class="keyword">(</span><span class="default">$query</span><span class="keyword">);<br />
</span><span class="default">$resultNode </span><span class="keyword">= </span><span class="default">$result</span><span class="keyword">-&gt;</span><span class="default">item</span><span class="keyword">(</span><span class="default">0</span><span class="keyword">);<br />
</span><span class="default">$newDom </span><span class="keyword">= new </span><span class="default">DOMDocument</span><span class="keyword">;<br />
</span><span class="default">$newDom</span><span class="keyword">-&gt;</span><span class="default">appendChild</span><span class="keyword">(</span><span class="default">$newDom</span><span class="keyword">-&gt;</span><span class="default">importNode</span><span class="keyword">(</span><span class="default">$resultNode</span><span class="keyword">,</span><span class="default">1</span><span class="keyword">));<br />
<br />
print </span><span class="string">"&lt;pre&gt;" </span><span class="keyword">. </span><span class="default">htmlspecialchars</span><span class="keyword">(</span><span class="default">$newDom</span><span class="keyword">-&gt;</span><span class="default">saveXML</span><span class="keyword">()) . </span><span class="string">"&lt;/pre&gt;"</span><span class="keyword">;<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="54692""></a>
  <div class="note">
   <strong class="user">Eric Hanson</strong>
   <a href="#54692" class="date">12-Jul-2005 05:40</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Two great XPath references follow.<br />
<br />
XPath in Five Paragraphs (finally!):<br />
<a href="http://www.rpbourret.com/xml/XPathIn5.htm" rel="nofollow" target="_blank">http://www.rpbourret.com/xml/XPathIn5.htm</a><br />
<br />
The w3c spec actually has a bunch of helpful examples:<br />
<a href="http://www.w3.org/TR/xpath#location-paths" rel="nofollow" target="_blank">http://www.w3.org/TR/xpath#location-paths</a></span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
</div>
</div>
</div></div></body></html>
