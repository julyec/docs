<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
 <head>
  <meta http-equiv="content-type" content="text/html; CHARSET=UTF-8">
  <title>将颜色定义为透明</title>
<link media="all" rel="stylesheet" type="text/css" href="styles/03e73060321a0a848018724a6c83de7f-theme-base.css" />
<link media="all" rel="stylesheet" type="text/css" href="styles/03e73060321a0a848018724a6c83de7f-theme-medium.css" />

  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <link media="all" rel="stylesheet" type="text/css" href="style.css"/>
 </head>
 <body class="docs" class="docs"><div class="navbar navbar-fixed-top">
  <div class="navbar-inner clearfix">
    <ul class="nav" style="width: 100%">
      <li style="float: left;"><a href="function.imagecolorstotal.html">? imagecolorstotal</a></li>
      <li style="float: right;"><a href="function.imageconvolution.html">imageconvolution ?</a></li>
    </ul>
  </div>
</div>
<div id="breadcrumbs" class="clearfix">
  <ul class="breadcrumbs-container">
    <li><a href="index.html">PHP Manual</a></li>
    <li><a href="ref.image.html">GD 和图像处理 函数</a></li>
    <li>将颜色定义为透明</li>
  </ul>
</div>
<div id="layout">
  <div id="layout-content"><div id="function.imagecolortransparent" class="refentry">
 <div class="refnamediv">
  <h1 class="refname">imagecolortransparent</h1>
  <p class="verinfo">(PHP 4, PHP 5, PHP 7, PHP 8)</p><p class="refpurpose"><span class="refname">imagecolortransparent</span> &mdash; <span class="dc-title">将颜色定义为透明</span></p>

 </div>
 <div class="refsect1 description" id="refsect1-function.imagecolortransparent-description">
  <h3 class="title">说明</h3>
  <div class="methodsynopsis dc-description">
   <span class="methodname"><strong>imagecolortransparent</strong></span>(<span class="methodparam"><span class="type"><a href="class.gdimage.html" class="type GdImage">GdImage</a></span> <code class="parameter">$image</code></span>, <span class="methodparam"><span class="type">?</span><span class="type"><span class="type">int</span><span class="type"></span></span> <code class="parameter">$color</code><span class="initializer"> = <strong><code>null</code></strong></span></span>): <span class="type">int</span></div>

  <p class="para rdfs-comment">
   获取或设置指定 <code class="parameter">image</code> 中的透明色。
  </p>
 </div>

 <div class="refsect1 parameters" id="refsect1-function.imagecolortransparent-parameters">
  <h3 class="title">参数</h3>
  <p class="para">
   <dl>
    <dt>

<code class="parameter">image</code></dt>
<dd>
<p class="para">由图象创建函数(例如<span class="function"><a href="function.imagecreatetruecolor.html" class="function">imagecreatetruecolor()</a></span>)返回的 
<span class="classname"><a href="class.gdimage.html" class="classname">GdImage</a></span> 对象。</p></dd>

    
     <dt>
<code class="parameter">color</code></dt>

     <dd>

      <p class="para">
       颜色标识符使用 <span class="function"><a href="function.imagecolorallocate.html" class="function">imagecolorallocate()</a></span> 创建。
      </p>
     </dd>

    
   </dl>

  </p>
 </div>

 <div class="refsect1 returnvalues" id="refsect1-function.imagecolortransparent-returnvalues">
  <h3 class="title">返回值</h3>
  <p class="para">
   返回新（或当前，如果未指定）透明色的标识符。如果 <code class="parameter">color</code>
   为 <strong><code>null</code></strong>，并且图像没有透明色，则返回的标识符为 <code class="literal">-1</code>。
  </p>
 </div>


 <div class="refsect1 changelog" id="refsect1-function.imagecolortransparent-changelog">
  <h3 class="title">更新日志</h3>
  <table class="doctable informaltable">
   
    <thead>
     <tr>
      <th>版本</th>
      <th>说明</th>
     </tr>

    </thead>

    <tbody class="tbody">
     <tr>
 <td>8.0.0</td>
 <td>
  <code class="parameter">image</code> 现在需要 <span class="classname"><a href="class.gdimage.html" class="classname">GdImage</a></span> 实例；之前需要有效的 <code class="literal">gd</code> <span class="type">resource</span>。
 </td>
</tr>

     <tr>
      <td>8.0.0</td>
      <td>
       <code class="parameter">color</code> 现在允许为 null。
      </td>
     </tr>

    </tbody>
   
  </table>

 </div>


 <div class="refsect1 examples" id="refsect1-function.imagecolortransparent-examples">
  <h3 class="title">示例</h3>
  <p class="para">
   <div class="example" id="example-5416">
    <p><strong>Example #1 <span class="function"><strong>imagecolortransparent()</strong></span> 示例</strong></p>
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br /></span><span style="color: #FF8000">// Create a 55x30 image<br /></span><span style="color: #0000BB">$im </span><span style="color: #007700">= </span><span style="color: #0000BB">imagecreatetruecolor</span><span style="color: #007700">(</span><span style="color: #0000BB">55</span><span style="color: #007700">, </span><span style="color: #0000BB">30</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">$red </span><span style="color: #007700">= </span><span style="color: #0000BB">imagecolorallocate</span><span style="color: #007700">(</span><span style="color: #0000BB">$im</span><span style="color: #007700">, </span><span style="color: #0000BB">255</span><span style="color: #007700">, </span><span style="color: #0000BB">0</span><span style="color: #007700">, </span><span style="color: #0000BB">0</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">$black </span><span style="color: #007700">= </span><span style="color: #0000BB">imagecolorallocate</span><span style="color: #007700">(</span><span style="color: #0000BB">$im</span><span style="color: #007700">, </span><span style="color: #0000BB">0</span><span style="color: #007700">, </span><span style="color: #0000BB">0</span><span style="color: #007700">, </span><span style="color: #0000BB">0</span><span style="color: #007700">);<br /><br /></span><span style="color: #FF8000">// Make the background transparent<br /></span><span style="color: #0000BB">imagecolortransparent</span><span style="color: #007700">(</span><span style="color: #0000BB">$im</span><span style="color: #007700">, </span><span style="color: #0000BB">$black</span><span style="color: #007700">);<br /><br /></span><span style="color: #FF8000">// Draw a red rectangle<br /></span><span style="color: #0000BB">imagefilledrectangle</span><span style="color: #007700">(</span><span style="color: #0000BB">$im</span><span style="color: #007700">, </span><span style="color: #0000BB">4</span><span style="color: #007700">, </span><span style="color: #0000BB">4</span><span style="color: #007700">, </span><span style="color: #0000BB">50</span><span style="color: #007700">, </span><span style="color: #0000BB">25</span><span style="color: #007700">, </span><span style="color: #0000BB">$red</span><span style="color: #007700">);<br /><br /></span><span style="color: #FF8000">// Save the image<br /></span><span style="color: #0000BB">imagepng</span><span style="color: #007700">(</span><span style="color: #0000BB">$im</span><span style="color: #007700">, </span><span style="color: #DD0000">'./imagecolortransparent.png'</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">imagedestroy</span><span style="color: #007700">(</span><span style="color: #0000BB">$im</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
    </div>

    <div class="example-contents"><p>以上示例的输出类似于：</p></div>
    <div class="mediaobject">
     
     <div class="imageobject">
      <img src="images/21009b70229598c6a80eef8b45bf282b-imagecolortransparent.png" alt="示例输出：imagecolortransparent()" width="55" height="30" />
     </div>
    </div>
   </div>
  </p>
 </div>

 <div class="refsect1 notes" id="refsect1-function.imagecolortransparent-notes">
  <h3 class="title">注释</h3>
  <blockquote class="note"><p><strong class="note">Note</strong>: 
   <p class="para">
    透明度仅能使用 <span class="function"><a href="function.imagecopymerge.html" class="function">imagecopymerge()</a></span> 和真彩色图像复制，而不使用
    <span class="function"><a href="function.imagecopy.html" class="function">imagecopy()</a></span> 或调色板图像。
   </p>
  </p></blockquote>
  <blockquote class="note"><p><strong class="note">Note</strong>: 
   <p class="para">
    透明色是图像的属性，透明度不是颜色的属性。一旦设定某个颜色为透明色，图像中之前绘制为该颜色的任何区域都成为透明的。
   </p>
  </p></blockquote>
 </div>

</div><div id="usernotes">
 <div class="head">
  <h3 class="title">User Contributed Notes</h3>
 </div>
<div id="allnotes">  <a name="118476""></a>
  <div class="note">
   <strong class="user">Sebastian Sejzer</strong>
   <a href="#118476" class="date">12-Dec-2015 05:48</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you are looking for a blank PNG, you don't need to generate it every time. Just define this constant:<br />
<br />
define("BLANK_PNG",&nbsp; &nbsp;&nbsp; "iVBORw0KGgoAAAANSUhEUgAAACgAAAAoCAYAAACM/rhtAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29m".<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; "dHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAADqSURBVHjaYvz//z/DYAYAAcTEMMgBQAANegcCBNCg".<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; "dyBAAA16BwIE0KB3IEAADXoHAgTQoHcgQAANegcCBNCgdyBAAA16BwIE0KB3IEAADXoHAgTQoHcgQAAN".<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; "egcCBNCgdyBAAA16BwIE0KB3IEAADXoHAgTQoHcgQAANegcCBNCgdyBAAA16BwIE0KB3IEAADXoHAgTQ".<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; "oHcgQAANegcCBNCgdyBAAA16BwIE0KB3IEAADXoHAgTQoHcgQAANegcCBNCgdyBAAA16BwIE0KB3IEAA".<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; "DXoHAgTQoHcgQAANegcCBNCgdyBAgAEAMpcDTTQWJVEAAAAASUVORK5CYII=");</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="115839""></a>
  <div class="note">
   <strong class="user">romanenko.alex.v at gmail.com</strong>
   <a href="#115839" class="date">02-Oct-2014 08:02</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
This function has a very strange behaviour with GD version &gt; 2. It returns count of colors instead of -1 (as noted) if cannot find transparent color. Be carefull!</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="107237""></a>
  <div class="note">
   <strong class="user">john at jbwalker dot com</strong>
   <a href="#107237" class="date">23-Jan-2012 08:42</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
A transparent background with text doesn't seem to work very well because of the antialiasing . But I tried the following kluge and it turned out very well:
<br />

<br />
<span class="default">&lt;?php
<br />
&nbsp;&nbsp; $im </span><span class="keyword">= </span><span class="default">imagecreatetruecolor</span><span class="keyword">(</span><span class="default">100</span><span class="keyword">,</span><span class="default">20</span><span class="keyword">);
<br />
&nbsp;&nbsp; </span><span class="default">$almostblack </span><span class="keyword">= </span><span class="default">imagecolorallocate</span><span class="keyword">(</span><span class="default">$im</span><span class="keyword">,</span><span class="default">254</span><span class="keyword">,</span><span class="default">254</span><span class="keyword">,</span><span class="default">254</span><span class="keyword">);
<br />
&nbsp;&nbsp; </span><span class="default">imagefill</span><span class="keyword">(</span><span class="default">$im</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">$almostblack</span><span class="keyword">);
<br />
&nbsp;&nbsp; </span><span class="default">$black </span><span class="keyword">= </span><span class="default">imagecolorallocate</span><span class="keyword">(</span><span class="default">$im</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">);
<br />
&nbsp;&nbsp; </span><span class="default">imagecolortransparent</span><span class="keyword">(</span><span class="default">$im</span><span class="keyword">,</span><span class="default">$almostblack</span><span class="keyword">);
<br />
&nbsp;&nbsp; </span><span class="comment">//... set x and y..
<br />
&nbsp;&nbsp; </span><span class="default">imagettftext</span><span class="keyword">(</span><span class="default">$im</span><span class="keyword">,</span><span class="default">8</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">$x</span><span class="keyword">,</span><span class="default">$y</span><span class="keyword">,</span><span class="default">$black</span><span class="keyword">,</span><span class="string">"calibri.ttf"</span><span class="keyword">,</span><span class="default">$txt</span><span class="keyword">);
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="104554""></a>
  <div class="note">
   <strong class="user">email at vladislav dot net</strong>
   <a href="#104554" class="date">22-Jun-2011 02:42</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Pay attention, that some GIF images may not include a transparent color. A good example of forced transparency in resized GIF image was given by markglibres at yahoo dot com 29-Mar-2009 02:48. But sometimes the transparent color in GIF images can be not set. The problem is, that the color you force to be transparent can be used in the original GIF as opaque and you will loose that color in resized image. The solution is not to use some default transparent color and to leave the resized image without transparent color (the same as original GIF). I used (nearly) the following code to make resized GIF images trnsparent&nbsp; only when the transparency is needed:<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="comment">/* ... */<br />
<br />
</span><span class="default">$img </span><span class="keyword">= </span><span class="default">ImageCreateFromGIF</span><span class="keyword">(</span><span class="default">$f</span><span class="keyword">); </span><span class="comment">/* create image from existing GIF: original image file name $f you may take from where you need */<br />
</span><span class="default">$transparent_index </span><span class="keyword">= </span><span class="default">ImageColorTransparent</span><span class="keyword">(</span><span class="default">$img</span><span class="keyword">); </span><span class="comment">/* gives the index of current transparent color or -1 */<br />
</span><span class="keyword">if(</span><span class="default">$transparent_index</span><span class="keyword">!=(-</span><span class="default">1</span><span class="keyword">)) </span><span class="default">$transparent_color </span><span class="keyword">= </span><span class="default">ImageColorsForIndex</span><span class="keyword">(</span><span class="default">$img</span><span class="keyword">,</span><span class="default">$transparent_index</span><span class="keyword">);<br />
<br />
</span><span class="comment">/* ... */<br />
<br />
</span><span class="default">$img_resized </span><span class="keyword">= </span><span class="default">ImageCreateTrueColor</span><span class="keyword">( </span><span class="default">$nw</span><span class="keyword">, </span><span class="default">$nh </span><span class="keyword">); </span><span class="comment">/* (the new width $nw and height $nh must be defined before) */<br />
</span><span class="keyword">if(!empty(</span><span class="default">$transparent_color</span><span class="keyword">)) </span><span class="comment">/* simple check to find wether transparent color was set or not */<br />
</span><span class="keyword">{<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$transparent_new </span><span class="keyword">= </span><span class="default">ImageColorAllocate</span><span class="keyword">( </span><span class="default">$img_resized</span><span class="keyword">, </span><span class="default">$transparent_color</span><span class="keyword">[</span><span class="string">'red'</span><span class="keyword">], </span><span class="default">$transparent_color</span><span class="keyword">[</span><span class="string">'green'</span><span class="keyword">], </span><span class="default">$transparent_color</span><span class="keyword">[</span><span class="string">'blue'</span><span class="keyword">] );<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$transparent_new_index </span><span class="keyword">= </span><span class="default">ImageColorTransparent</span><span class="keyword">( </span><span class="default">$img_resized</span><span class="keyword">, </span><span class="default">$transparent_new </span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">ImageFill</span><span class="keyword">( </span><span class="default">$img_resized</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">, </span><span class="default">$transparent_new_index </span><span class="keyword">); </span><span class="comment">/* don't forget to fill the new image with the transparent color */<br />
</span><span class="keyword">}<br />
list(</span><span class="default">$w</span><span class="keyword">,</span><span class="default">$h</span><span class="keyword">) = </span><span class="default">GetImageSize</span><span class="keyword">(</span><span class="default">$f</span><span class="keyword">); </span><span class="comment">/* defines the original width $w and height $h */<br />
</span><span class="keyword">if( </span><span class="default">ImageCopyResized</span><span class="keyword">( </span><span class="default">$img_resized</span><span class="keyword">, </span><span class="default">$img</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">, </span><span class="default">$nw</span><span class="keyword">,</span><span class="default">$nh</span><span class="keyword">, </span><span class="default">$w</span><span class="keyword">,</span><span class="default">$h </span><span class="keyword">) ) </span><span class="comment">/* resized copying and replacing the original image */<br />
</span><span class="keyword">{<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">ImageDestroy</span><span class="keyword">(</span><span class="default">$img</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$img </span><span class="keyword">= </span><span class="default">$img_resized</span><span class="keyword">;<br />
}<br />
<br />
</span><span class="comment">/* ... */<br />
<br />
</span><span class="default">header</span><span class="keyword">(</span><span class="string">'Content-Type: image/gif'</span><span class="keyword">);<br />
</span><span class="default">ImageGIF</span><span class="keyword">(</span><span class="default">$img</span><span class="keyword">);<br />
</span><span class="default">ImageDestroy</span><span class="keyword">(</span><span class="default">$img</span><span class="keyword">);<br />
</span><span class="default">?&gt;<br />
</span><br />
P.S.<br />
If there some errors, I hope you could understood the idea.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="100200""></a>
  <div class="note">
   <strong class="user">admin at fastproxyservers dot org</strong>
   <a href="#100200" class="date">30-Sep-2010 09:00</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I would like to share with others how to make PNG image transparent. I have tried almost all examples described on that page but none of them work for me. Finally I found the solution, but there is a bit cheating :) but who cares if it works?
<br />

<br />
So when I tried to allocate white (as an example) color as a transparent, it worked randomly (lets say 1 in 10 examples). That in turn pushed me to the idea that the problem is that white color is already exist in color palette. So if I try to add another white color with DIFFERENT index as a transparent, that will cause error.
<br />

<br />
So I found the solution, instead of adding new index, I searched for the white color's index in the color palette and made it defined as transparent :) The best idea is to use not a white but left bottom corner as transparent color (I guess that s standard for some other software languages).
<br />

<br />
<span class="default">&lt;?php
<br />
$index </span><span class="keyword">= </span><span class="default">imagecolorexact</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">image</span><span class="keyword">, </span><span class="default">255</span><span class="keyword">, </span><span class="default">255</span><span class="keyword">, </span><span class="default">255</span><span class="keyword">);
<br />
</span><span class="default">imagecolortransparent</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">image</span><span class="keyword">, </span><span class="default">$index</span><span class="keyword">);
<br />
</span><span class="default">?&gt;
<br />
</span>
<br />
All you need is to add that two lines before outputting your result.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="91053""></a>
  <div class="note">
   <strong class="user">ajamal</strong>
   <a href="#91053" class="date">22-May-2009 06:06</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
This might be of importance to newbies...If you are trying to create GIF's with transparencies, stick to the 216 colour pallet for all colours on the image... or transparencies wont work...at the very least yo will get dithering...</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="89927""></a>
  <div class="note">
   <strong class="user">markglibres at yahoo dot com</strong>
   <a href="#89927" class="date">29-Mar-2009 06:48</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I've made a very simple script that will retain transparency of images especially when resizing.
<br />

<br />
NOTE: Transparency is only supported on GIF and PNG files.
<br />

<br />
Parameters:
<br />

<br />
$new_image = image resource identifier such as returned by imagecreatetruecolor(). must be passed by reference
<br />
$image_source = image resource identifier returned by imagecreatefromjpeg, imagecreatefromgif and imagecreatefrompng. must be passed by reference
<br />

<br />
<span class="default">&lt;?php
<br />
</span><span class="keyword">function </span><span class="default">setTransparency</span><span class="keyword">(</span><span class="default">$new_image</span><span class="keyword">,</span><span class="default">$image_source</span><span class="keyword">)
<br />
&nbsp;&nbsp;&nbsp; {
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; 
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$transparencyIndex </span><span class="keyword">= </span><span class="default">imagecolortransparent</span><span class="keyword">(</span><span class="default">$image_source</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$transparencyColor </span><span class="keyword">= array(</span><span class="string">'red' </span><span class="keyword">=&gt; </span><span class="default">255</span><span class="keyword">, </span><span class="string">'green' </span><span class="keyword">=&gt; </span><span class="default">255</span><span class="keyword">, </span><span class="string">'blue' </span><span class="keyword">=&gt; </span><span class="default">255</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">$transparencyIndex </span><span class="keyword">&gt;= </span><span class="default">0</span><span class="keyword">) {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$transparencyColor&nbsp; &nbsp; </span><span class="keyword">= </span><span class="default">imagecolorsforindex</span><span class="keyword">(</span><span class="default">$image_source</span><span class="keyword">, </span><span class="default">$transparencyIndex</span><span class="keyword">);&nbsp; &nbsp; 
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; 
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$transparencyIndex&nbsp; &nbsp; </span><span class="keyword">= </span><span class="default">imagecolorallocate</span><span class="keyword">(</span><span class="default">$new_image</span><span class="keyword">, </span><span class="default">$transparencyColor</span><span class="keyword">[</span><span class="string">'red'</span><span class="keyword">], </span><span class="default">$transparencyColor</span><span class="keyword">[</span><span class="string">'green'</span><span class="keyword">], </span><span class="default">$transparencyColor</span><span class="keyword">[</span><span class="string">'blue'</span><span class="keyword">]);
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">imagefill</span><span class="keyword">(</span><span class="default">$new_image</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">$transparencyIndex</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">imagecolortransparent</span><span class="keyword">(</span><span class="default">$new_image</span><span class="keyword">, </span><span class="default">$transparencyIndex</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; 
<br />
&nbsp;&nbsp;&nbsp; } 
<br />
</span><span class="default">?&gt;
<br />
</span>
<br />

<br />
Sample Usage: (resizing)
<br />

<br />
<span class="default">&lt;?php
<br />
$image_source </span><span class="keyword">= </span><span class="default">imagecreatefrompng</span><span class="keyword">(</span><span class="string">'test.png'</span><span class="keyword">);
<br />
</span><span class="default">$new_image </span><span class="keyword">= </span><span class="default">imagecreatetruecolor</span><span class="keyword">(</span><span class="default">$width</span><span class="keyword">, </span><span class="default">$height</span><span class="keyword">);
<br />
</span><span class="default">setTransparency</span><span class="keyword">(</span><span class="default">$new_image</span><span class="keyword">,</span><span class="default">$image_source</span><span class="keyword">);
<br />
</span><span class="default">imagecopyresampled</span><span class="keyword">(</span><span class="default">$new_image</span><span class="keyword">, </span><span class="default">$image_source</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">$new_width</span><span class="keyword">, </span><span class="default">$new_height</span><span class="keyword">, </span><span class="default">$old_width</span><span class="keyword">, </span><span class="default">$old_height</span><span class="keyword">);
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="86593""></a>
  <div class="note">
   <strong class="user">steved at HaHaHa dot com dot au</strong>
   <a href="#86593" class="date">24-Oct-2008 10:28</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
How to center your text both vertically and horizontally in a GD image:
<br />

<br />
<span class="default">&lt;?php
<br />
</span><span class="comment">//get box size
<br />
</span><span class="default">$box </span><span class="keyword">= </span><span class="default">imagettfbbox</span><span class="keyword">(</span><span class="default">$titlesize</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">$titlefont</span><span class="keyword">, </span><span class="default">$title</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; 
<br />
</span><span class="comment">//Find out the width and height of the text box
<br />
</span><span class="default">$textW </span><span class="keyword">= </span><span class="default">$box</span><span class="keyword">[</span><span class="default">2</span><span class="keyword">] - </span><span class="default">$box</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">];
<br />
</span><span class="default">$textH </span><span class="keyword">= </span><span class="default">$box</span><span class="keyword">[</span><span class="default">5</span><span class="keyword">] - </span><span class="default">$box</span><span class="keyword">[</span><span class="default">3</span><span class="keyword">];
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; 
<br />
</span><span class="comment">// Calculate the positions
<br />
</span><span class="default">$positionLeft </span><span class="keyword">= (</span><span class="default">$width </span><span class="keyword">- </span><span class="default">$textW</span><span class="keyword">)/</span><span class="default">2</span><span class="keyword">;
<br />
</span><span class="default">$positionTop </span><span class="keyword">= ((</span><span class="default">$height </span><span class="keyword">- </span><span class="default">$textH</span><span class="keyword">)/</span><span class="default">2</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; 
<br />
</span><span class="comment">// Add some text
<br />
</span><span class="keyword">if(</span><span class="default">$align</span><span class="keyword">==</span><span class="string">"center"</span><span class="keyword">){&nbsp; &nbsp; 
<br />
</span><span class="default">imagettftext</span><span class="keyword">(</span><span class="default">$pic</span><span class="keyword">, </span><span class="default">size</span><span class="keyword">, </span><span class="default">angle</span><span class="keyword">, </span><span class="default">$positionLeft</span><span class="keyword">, </span><span class="default">$positionTop</span><span class="keyword">, </span><span class="default">colour</span><span class="keyword">, </span><span class="default">font</span><span class="keyword">, </span><span class="default">message</span><span class="keyword">);
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="85678""></a>
  <div class="note">
   <strong class="user">cca220v</strong>
   <a href="#85678" class="date">11-Sep-2008 02:47</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I found out the hard way that for two png's with alpha transparency to correctly stack you need to explicitly re-enable alpha blending.<br />
<br />
$img=imagecreatetruecolor($dx,$dy);<br />
$img1=imagecreatefrompng($png1); //first layer<br />
$img2=imagecreatefrompng($png2); //second layer (smaller image)<br />
<br />
imagealphablending($img, false);<br />
$transparent = imagecolorallocatealpha($img, 0, 0, 0, 127);<br />
imagefill($img, 0, 0, $transparent);<br />
imagesavealpha($img,true);<br />
imagealphablending($img, true); //removing this causes the second layer's transparency to go trough the 1st layer erasing it (the image &gt;is&lt; transparent there ... as is the 2nd layer ... but not the 1st so it should not be transparent)<br />
<br />
imagecopyresampled($img,$img1,<br />
imagecopyresampled($img,$img2,</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="82223""></a>
  <div class="note">
   <strong class="user">yousuf at philipz dot com</strong>
   <a href="#82223" class="date">01-Apr-2008 11:45</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Well 8-bit gif and png files can have multiple transparent colors, so detecting the transparent color by manually looking into the file or using imagecolortransparent and using the detected rgb color as the background color when imagecopy'ing (or other image copying functions) on a true color image will not work. The only means of getting the transparent pixels to appear is to copy the pixel colors one by one to a new true color image. Here's some code i wrote to do this.<br />
<br />
$original_image = @imagecreatefromgif( $original_image_file );<br />
<br />
$original_image_width = imagesx( $original_image );<br />
$original_image_height = imagesy( $original_image );<br />
<br />
if ( !imageistruecolor($original_image) ) {<br />
&nbsp;&nbsp; # detects if its non-true color image<br />
&nbsp;&nbsp; if ( imagecolortransparent($original_image) &gt;= 0 ) {<br />
&nbsp;&nbsp; &nbsp;&nbsp; # detects if any of the color palette has been set to transparent<br />
&nbsp;&nbsp; &nbsp;&nbsp; $truecolor = imagecreatetruecolor( $original_image_width, $original_image_height );<br />
&nbsp;&nbsp; &nbsp;&nbsp; for ($x = 0; $x &lt; $original_image_width; $x++) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; for ($y = 0; $y &lt; $original_image_height; $y++) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $color_index = ImageColorAt($original_image, $x, $y);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if ( !$color_palette[$color_index] ) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $rgb = imagecolorsforindex($original_image, $color_index);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $color_to_set = imagecolorallocate($truecolor, $rgb['red'], $rgb['green'], $rgb['blue']);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $color_palette[$color_index] = $color_to_set;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; } else {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $color_to_set = $color_palette[$color_index];<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; imagesetpixel($truecolor, $x, $y, $color_to_set);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; }<br />
&nbsp;&nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp;&nbsp; imagedestroy($original_image);<br />
&nbsp;&nbsp; &nbsp;&nbsp; $original_image = $truecolor;<br />
&nbsp;&nbsp; }<br />
}</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="82096""></a>
  <div class="note">
   <strong class="user">kroccamen, gmail</strong>
   <a href="#82096" class="date">27-Mar-2008 05:56</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Sorry, below should be:<br />
<br />
<span class="default">&lt;?php<br />
$is_alpha </span><span class="keyword">= </span><span class="default">ord </span><span class="keyword">(</span><span class="default">file_get_contents </span><span class="keyword">(</span><span class="default">$file_path</span><span class="keyword">, </span><span class="default">false</span><span class="keyword">, </span><span class="default">null</span><span class="keyword">, </span><span class="default">25</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">)) &amp; </span><span class="default">4</span><span class="keyword">;<br />
</span><span class="default">?&gt;<br />
</span><br />
much better :)<br />
Both types 4 (greyscale transparent png), and 6 (colour transparent png) have bit 4 set, so there's no need to bitwise twice and there's no need for == as the return value will be 4 or 0, which is easily interpreted as true or false elsewhere in your code.<br />
<br />
note: file_get_contents isn't reading the whole file in this instance, just 1 byte on its own and that's it, so you can be assured this is fast and safe.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="82032""></a>
  <div class="note">
   <strong class="user">kroccamen, gmail</strong>
   <a href="#82032" class="date">25-Mar-2008 04:44</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
@wesley gunn:<br />
Thank you very, very much for the code to determine if a PNG is 24 or 32-bit :)<br />
Here's an improved version in one line without using a file-handle<br />
<br />
<span class="default">&lt;?php<br />
$is_alpha </span><span class="keyword">= ((</span><span class="default">ord </span><span class="keyword">(<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">file_get_contents </span><span class="keyword">(</span><span class="default">$filename</span><span class="keyword">, </span><span class="default">false</span><span class="keyword">, </span><span class="default">null</span><span class="keyword">, </span><span class="default">25</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">)<br />
) &amp; </span><span class="default">6</span><span class="keyword">) &amp; </span><span class="default">4</span><span class="keyword">) == </span><span class="default">4</span><span class="keyword">;<br />
</span><span class="default">?&gt;<br />
</span><br />
Gives true for a PNG with alpha, false otherwise.<br />
This cannot detect 8-bit PNGs with transparency, but you could do that by searching the file contents for the presence of "PLTE" *AND* "tRNS".</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="81713""></a>
  <div class="note">
   <strong class="user">tomas at cimax dot com</strong>
   <a href="#81713" class="date">10-Mar-2008 12:19</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
On some versions you must set the index number of that color in color pallete rather than the color! So if you allocate color with imagecolorallocate, that this color gets 0 index on color pallete so than you must call: imagecolortransparent ( resource $image , 0 ) to make the image transparent!</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="80935""></a>
  <div class="note">
   <strong class="user">fmkaiba at optonline dot net</strong>
   <a href="#80935" class="date">07-Feb-2008 08:05</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
This is my 'perfect' (i use that word lightly) thumbnail generation script, switch '$transparency' to true to have it do its best to handle transparency in gifs and pngs. this code is built off of comments and advice of everyone else here, and i do not deserve full credit. So far this handles every error i can throw at it.<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">function </span><span class="default">createthumb</span><span class="keyword">(</span><span class="default">$name</span><span class="keyword">, </span><span class="default">$newname</span><span class="keyword">, </span><span class="default">$new_w</span><span class="keyword">, </span><span class="default">$new_h</span><span class="keyword">, </span><span class="default">$border</span><span class="keyword">=</span><span class="default">false</span><span class="keyword">, </span><span class="default">$transparency</span><span class="keyword">=</span><span class="default">true</span><span class="keyword">, </span><span class="default">$base64</span><span class="keyword">=</span><span class="default">false</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; if(</span><span class="default">file_exists</span><span class="keyword">(</span><span class="default">$newname</span><span class="keyword">))<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; @</span><span class="default">unlink</span><span class="keyword">(</span><span class="default">$newname</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; if(!</span><span class="default">file_exists</span><span class="keyword">(</span><span class="default">$name</span><span class="keyword">))<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">false</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$arr </span><span class="keyword">= </span><span class="default">split</span><span class="keyword">(</span><span class="string">"\."</span><span class="keyword">,</span><span class="default">$name</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$ext </span><span class="keyword">= </span><span class="default">$arr</span><span class="keyword">[</span><span class="default">count</span><span class="keyword">(</span><span class="default">$arr</span><span class="keyword">)-</span><span class="default">1</span><span class="keyword">];<br />
<br />
&nbsp;&nbsp;&nbsp; if(</span><span class="default">$ext</span><span class="keyword">==</span><span class="string">"jpeg" </span><span class="keyword">|| </span><span class="default">$ext</span><span class="keyword">==</span><span class="string">"jpg"</span><span class="keyword">){<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$img </span><span class="keyword">= @</span><span class="default">imagecreatefromjpeg</span><span class="keyword">(</span><span class="default">$name</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; } elseif(</span><span class="default">$ext</span><span class="keyword">==</span><span class="string">"png"</span><span class="keyword">){<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$img </span><span class="keyword">= @</span><span class="default">imagecreatefrompng</span><span class="keyword">(</span><span class="default">$name</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; } elseif(</span><span class="default">$ext</span><span class="keyword">==</span><span class="string">"gif"</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$img </span><span class="keyword">= @</span><span class="default">imagecreatefromgif</span><span class="keyword">(</span><span class="default">$name</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; if(!</span><span class="default">$img</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">false</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$old_x </span><span class="keyword">= </span><span class="default">imageSX</span><span class="keyword">(</span><span class="default">$img</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$old_y </span><span class="keyword">= </span><span class="default">imageSY</span><span class="keyword">(</span><span class="default">$img</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; if(</span><span class="default">$old_x </span><span class="keyword">&lt; </span><span class="default">$new_w </span><span class="keyword">&amp;&amp; </span><span class="default">$old_y </span><span class="keyword">&lt; </span><span class="default">$new_h</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$thumb_w </span><span class="keyword">= </span><span class="default">$old_x</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$thumb_h </span><span class="keyword">= </span><span class="default">$old_y</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; } elseif (</span><span class="default">$old_x </span><span class="keyword">&gt; </span><span class="default">$old_y</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$thumb_w </span><span class="keyword">= </span><span class="default">$new_w</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$thumb_h </span><span class="keyword">= </span><span class="default">floor</span><span class="keyword">((</span><span class="default">$old_y</span><span class="keyword">*(</span><span class="default">$new_h</span><span class="keyword">/</span><span class="default">$old_x</span><span class="keyword">)));<br />
&nbsp;&nbsp;&nbsp; } elseif (</span><span class="default">$old_x </span><span class="keyword">&lt; </span><span class="default">$old_y</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$thumb_w </span><span class="keyword">= </span><span class="default">floor</span><span class="keyword">(</span><span class="default">$old_x</span><span class="keyword">*(</span><span class="default">$new_w</span><span class="keyword">/</span><span class="default">$old_y</span><span class="keyword">));<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$thumb_h </span><span class="keyword">= </span><span class="default">$new_h</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; } elseif (</span><span class="default">$old_x </span><span class="keyword">== </span><span class="default">$old_y</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$thumb_w </span><span class="keyword">= </span><span class="default">$new_w</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$thumb_h </span><span class="keyword">= </span><span class="default">$new_h</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$thumb_w </span><span class="keyword">= (</span><span class="default">$thumb_w</span><span class="keyword">&lt;</span><span class="default">1</span><span class="keyword">) ? </span><span class="default">1 </span><span class="keyword">: </span><span class="default">$thumb_w</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$thumb_h </span><span class="keyword">= (</span><span class="default">$thumb_h</span><span class="keyword">&lt;</span><span class="default">1</span><span class="keyword">) ? </span><span class="default">1 </span><span class="keyword">: </span><span class="default">$thumb_h</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$new_img </span><span class="keyword">= </span><span class="default">ImageCreateTrueColor</span><span class="keyword">(</span><span class="default">$thumb_w</span><span class="keyword">, </span><span class="default">$thumb_h</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; if(</span><span class="default">$transparency</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">$ext</span><span class="keyword">==</span><span class="string">"png"</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">imagealphablending</span><span class="keyword">(</span><span class="default">$new_img</span><span class="keyword">, </span><span class="default">false</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$colorTransparent </span><span class="keyword">= </span><span class="default">imagecolorallocatealpha</span><span class="keyword">(</span><span class="default">$new_img</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">127</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">imagefill</span><span class="keyword">(</span><span class="default">$new_img</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">$colorTransparent</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">imagesavealpha</span><span class="keyword">(</span><span class="default">$new_img</span><span class="keyword">, </span><span class="default">true</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; } elseif(</span><span class="default">$ext</span><span class="keyword">==</span><span class="string">"gif"</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$trnprt_indx </span><span class="keyword">= </span><span class="default">imagecolortransparent</span><span class="keyword">(</span><span class="default">$img</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">$trnprt_indx </span><span class="keyword">&gt;= </span><span class="default">0</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">//its transparent<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$trnprt_color </span><span class="keyword">= </span><span class="default">imagecolorsforindex</span><span class="keyword">(</span><span class="default">$img</span><span class="keyword">, </span><span class="default">$trnprt_indx</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$trnprt_indx </span><span class="keyword">= </span><span class="default">imagecolorallocate</span><span class="keyword">(</span><span class="default">$new_img</span><span class="keyword">, </span><span class="default">$trnprt_color</span><span class="keyword">[</span><span class="string">'red'</span><span class="keyword">], </span><span class="default">$trnprt_color</span><span class="keyword">[</span><span class="string">'green'</span><span class="keyword">], </span><span class="default">$trnprt_color</span><span class="keyword">[</span><span class="string">'blue'</span><span class="keyword">]);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">imagefill</span><span class="keyword">(</span><span class="default">$new_img</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">$trnprt_indx</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">imagecolortransparent</span><span class="keyword">(</span><span class="default">$new_img</span><span class="keyword">, </span><span class="default">$trnprt_indx</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; } else {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">Imagefill</span><span class="keyword">(</span><span class="default">$new_img</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">imagecolorallocate</span><span class="keyword">(</span><span class="default">$new_img</span><span class="keyword">, </span><span class="default">255</span><span class="keyword">, </span><span class="default">255</span><span class="keyword">, </span><span class="default">255</span><span class="keyword">));<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="default">imagecopyresampled</span><span class="keyword">(</span><span class="default">$new_img</span><span class="keyword">, </span><span class="default">$img</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">, </span><span class="default">$thumb_w</span><span class="keyword">, </span><span class="default">$thumb_h</span><span class="keyword">, </span><span class="default">$old_x</span><span class="keyword">, </span><span class="default">$old_y</span><span class="keyword">); <br />
&nbsp;&nbsp;&nbsp; if(</span><span class="default">$border</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$black </span><span class="keyword">= </span><span class="default">imagecolorallocate</span><span class="keyword">(</span><span class="default">$new_img</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">imagerectangle</span><span class="keyword">(</span><span class="default">$new_img</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">, </span><span class="default">$thumb_w</span><span class="keyword">, </span><span class="default">$thumb_h</span><span class="keyword">, </span><span class="default">$black</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; if(</span><span class="default">$base64</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">ob_start</span><span class="keyword">();<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">imagepng</span><span class="keyword">(</span><span class="default">$new_img</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$img </span><span class="keyword">= </span><span class="default">ob_get_contents</span><span class="keyword">();<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">ob_end_clean</span><span class="keyword">();<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$return </span><span class="keyword">= </span><span class="default">base64_encode</span><span class="keyword">(</span><span class="default">$img</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; } else {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">$ext</span><span class="keyword">==</span><span class="string">"jpeg" </span><span class="keyword">|| </span><span class="default">$ext</span><span class="keyword">==</span><span class="string">"jpg"</span><span class="keyword">){<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">imagejpeg</span><span class="keyword">(</span><span class="default">$new_img</span><span class="keyword">, </span><span class="default">$newname</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$return </span><span class="keyword">= </span><span class="default">true</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; } elseif(</span><span class="default">$ext</span><span class="keyword">==</span><span class="string">"png"</span><span class="keyword">){<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">imagepng</span><span class="keyword">(</span><span class="default">$new_img</span><span class="keyword">, </span><span class="default">$newname</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$return </span><span class="keyword">= </span><span class="default">true</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; } elseif(</span><span class="default">$ext</span><span class="keyword">==</span><span class="string">"gif"</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">imagegif</span><span class="keyword">(</span><span class="default">$new_img</span><span class="keyword">, </span><span class="default">$newname</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$return </span><span class="keyword">= </span><span class="default">true</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">imagedestroy</span><span class="keyword">(</span><span class="default">$new_img</span><span class="keyword">); <br />
&nbsp;&nbsp;&nbsp; </span><span class="default">imagedestroy</span><span class="keyword">(</span><span class="default">$img</span><span class="keyword">); <br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">$return</span><span class="keyword">;<br />
}<br />
</span><span class="comment">//example useage<br />
</span><span class="default">createthumb</span><span class="keyword">(</span><span class="string">"img.gif"</span><span class="keyword">, </span><span class="string">"tn_img.gif"</span><span class="keyword">, </span><span class="default">64</span><span class="keyword">,</span><span class="default">64</span><span class="keyword">,</span><span class="default">true</span><span class="keyword">, </span><span class="default">true</span><span class="keyword">, </span><span class="default">false</span><span class="keyword">);<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="79145""></a>
  <div class="note">
   <strong class="user">wesley dot gunn at email dot it</strong>
   <a href="#79145" class="date">13-Nov-2007 09:27</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
a simple way to check png with alpha channel reading IHDR PNG HEADER<br />
<br />
$readPng =&nbsp; &nbsp; fopen&nbsp; &nbsp; ($argSourceImagePath, "rb");<br />
$readAlp =&nbsp; &nbsp; fread&nbsp; &nbsp; ($readPng, 52);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; fclose&nbsp; &nbsp; ($readPng);<br />
<br />
if(substr(bin2hex($readAlp),50,2) == "04" || substr(bin2hex($readAlp),50,2) == "06")<br />
echo("Png has alpha");</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="77099""></a>
  <div class="note">
   <strong class="user">Mikasto</strong>
   <a href="#77099" class="date">15-Aug-2007 04:53</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
To resize transparent PNG (if image is transparent &amp; ImageColorTransparent() returns -1):<br />
1) create a new image with the new sizes<br />
2) make the new image all transparent<br />
3) turn off the alpha blending for the new image (to keep the alpha channel when copy data)<br />
4) do copyresampled or copyresized into new image<br />
<br />
PHP code:<br />
// 1<br />
$im2 = ImageCreateTrueColor($w, $h);<br />
// 2<br />
ImageColorTransparent($im2, ImageColorAllocate($im2, 0, 0, 0));<br />
// 3<br />
ImageAlphaBlending($im2, false);<br />
// 4<br />
ImageCopyResampled($im2, $im, 0, 0, 0, 0, $w, $h, ImageSX($im), ImageSY($im));</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="76407""></a>
  <div class="note">
   <strong class="user">erik at vectorsector dot net</strong>
   <a href="#76407" class="date">13-Jul-2007 09:20</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
This script creates transparency for a unspecific RBG color for an already created PNG image.&nbsp; It also includes script of overlay text that does not get ruined in the process. <br />
<br />
<span class="default">&lt;?php<br />
<br />
header</span><span class="keyword">(</span><span class="string">"Content-type: image/png"</span><span class="keyword">);<br />
</span><span class="default">$image </span><span class="keyword">= </span><span class="default">imagecreatetruecolor</span><span class="keyword">(</span><span class="default">250</span><span class="keyword">, </span><span class="default">250</span><span class="keyword">);<br />
</span><span class="default">$string </span><span class="keyword">= </span><span class="default">$_GET</span><span class="keyword">[</span><span class="string">'text'</span><span class="keyword">];<br />
</span><span class="default">$im&nbsp; &nbsp;&nbsp; </span><span class="keyword">= </span><span class="default">imagecreatefrompng</span><span class="keyword">(</span><span class="string">"dynIcon.png"</span><span class="keyword">);<br />
</span><span class="default">$img </span><span class="keyword">= </span><span class="default">imagecreatetruecolor</span><span class="keyword">(</span><span class="default">16</span><span class="keyword">,</span><span class="default">16</span><span class="keyword">);<br />
</span><span class="default">$orange </span><span class="keyword">= </span><span class="default">imagecolorallocate</span><span class="keyword">(</span><span class="default">$im</span><span class="keyword">, </span><span class="default">220</span><span class="keyword">, </span><span class="default">210</span><span class="keyword">, </span><span class="default">60</span><span class="keyword">);<br />
</span><span class="default">$bg_color </span><span class="keyword">= </span><span class="default">imagecolorat</span><span class="keyword">(</span><span class="default">$im</span><span class="keyword">,</span><span class="default">1</span><span class="keyword">,</span><span class="default">1</span><span class="keyword">);<br />
</span><span class="default">$px&nbsp; &nbsp;&nbsp; </span><span class="keyword">= (</span><span class="default">imagesx</span><span class="keyword">(</span><span class="default">$im</span><span class="keyword">) - </span><span class="default">3 </span><span class="keyword">* </span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$string</span><span class="keyword">)) / </span><span class="default">2</span><span class="keyword">;<br />
</span><span class="default">imagecolortransparent</span><span class="keyword">(</span><span class="default">$im</span><span class="keyword">, </span><span class="default">$bg_color</span><span class="keyword">);<br />
</span><span class="default">imagestring</span><span class="keyword">(</span><span class="default">$im</span><span class="keyword">, </span><span class="default">3</span><span class="keyword">, </span><span class="default">$px</span><span class="keyword">, </span><span class="default">5</span><span class="keyword">, </span><span class="default">$string</span><span class="keyword">, </span><span class="default">$orange</span><span class="keyword">);<br />
</span><span class="default">imagepng</span><span class="keyword">(</span><span class="default">$im</span><span class="keyword">);<br />
</span><span class="default">imagedestroy</span><span class="keyword">(</span><span class="default">$im</span><span class="keyword">);<br />
<br />
</span><span class="default">?&gt;</span> <br />
<br />
Use $bg_color = imagecolorat($im,1,1); for instance, if you made the transparent color in photoshop by clearing out all the color leaving you with the checkered background showing you it's empty.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="71763""></a>
  <div class="note">
   <strong class="user">cinymini</strong>
   <a href="#71763" class="date">14-Dec-2006 11:17</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
When you use palette images (created with imagecreate()), the first color allocated is the background color. This color cannot be used for transparency. So if you want to make the background transparent, first allocate a dummy background color, then allocate the real background color and declare this is as transparent.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="71237""></a>
  <div class="note">
   <strong class="user">glenn at bengeweb dot co dot nz</strong>
   <a href="#71237" class="date">17-Nov-2006 08:03</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
in reference to webmaster at webnetwizard dotco dotuk who had a rather complicated method of determining if a GIF had any transparency set ...<br />
<br />
imagecolortransparent will return -1 if no transparency is found.<br />
<br />
eg:<br />
<br />
$transColorIndexMain = imageColorTransparent($mainImgObj);<br />
if ($transColorIndexMain &gt;= 0 ) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; # GIF has transparency ... ;<br />
}<br />
<br />
Current PHP Version: 4.4.4<br />
[GD Version] =&gt; bundled (2.0.28 compatible)</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="53703""></a>
  <div class="note">
   <strong class="user">ingrid</strong>
   <a href="#53703" class="date">09-Jun-2005 09:37</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
This script should take an animated GIF whit a white background transparancy, put some white=transparant text on it, and can be used in any page using the filename and the normal image tags.<br />
<br />
Everything works well, exept the animation. The GIF animation stands still. Don't know how to keep the animation&nbsp; animated. Is it possible in PHP?<br />
<br />
<span class="default">&lt;?php<br />
<br />
$TextFile </span><span class="keyword">= </span><span class="string">"teller.txt"</span><span class="keyword">;<br />
</span><span class="default">$Count </span><span class="keyword">= </span><span class="default">trim</span><span class="keyword">(</span><span class="default">file_get_contents</span><span class="keyword">(</span><span class="default">$TextFile</span><span class="keyword">));<br />
</span><span class="default">$FP </span><span class="keyword">= </span><span class="default">fopen</span><span class="keyword">(</span><span class="default">$TextFile</span><span class="keyword">, </span><span class="string">"r"</span><span class="keyword">);<br />
</span><span class="default">$Count</span><span class="keyword">=</span><span class="default">fgets</span><span class="keyword">(</span><span class="default">$FP</span><span class="keyword">, </span><span class="default">4096</span><span class="keyword">);<br />
</span><span class="default">fclose </span><span class="keyword">(</span><span class="default">$FP</span><span class="keyword">);<br />
</span><span class="default">settype</span><span class="keyword">(</span><span class="default">$Count</span><span class="keyword">, </span><span class="string">"integer"</span><span class="keyword">);<br />
</span><span class="default">$Count</span><span class="keyword">++;<br />
if (</span><span class="default">$FP </span><span class="keyword">= </span><span class="default">fopen </span><span class="keyword">(</span><span class="default">$TextFile</span><span class="keyword">, </span><span class="string">"w"</span><span class="keyword">)){<br />
</span><span class="default">fwrite </span><span class="keyword">(</span><span class="default">$FP</span><span class="keyword">, </span><span class="default">$Count</span><span class="keyword">);<br />
</span><span class="default">fclose </span><span class="keyword">(</span><span class="default">$FP</span><span class="keyword">);<br />
}<br />
<br />
</span><span class="default">$image </span><span class="keyword">= </span><span class="string">"blad.gif"</span><span class="keyword">;<br />
</span><span class="default">$im&nbsp; &nbsp; </span><span class="keyword">= </span><span class="default">imagecreatefromgif</span><span class="keyword">(</span><span class="default">$image</span><span class="keyword">);<br />
</span><span class="default">$white </span><span class="keyword">= </span><span class="default">imageColorAllocate </span><span class="keyword">(</span><span class="default">$im</span><span class="keyword">, </span><span class="default">255</span><span class="keyword">, </span><span class="default">255</span><span class="keyword">, </span><span class="default">255</span><span class="keyword">);<br />
</span><span class="default">$trans </span><span class="keyword">= </span><span class="default">imagecolortransparent</span><span class="keyword">(</span><span class="default">$im</span><span class="keyword">,</span><span class="default">$white</span><span class="keyword">);<br />
</span><span class="default">$hit </span><span class="keyword">= </span><span class="string">"</span><span class="default">$Count</span><span class="string">"</span><span class="keyword">;<br />
</span><span class="default">$ip </span><span class="keyword">= </span><span class="default">$_SERVER</span><span class="keyword">[</span><span class="string">"REMOTE_ADDR"</span><span class="keyword">];<br />
<br />
</span><span class="default">ImageString</span><span class="keyword">(</span><span class="default">$im</span><span class="keyword">, </span><span class="default">2</span><span class="keyword">, </span><span class="default">30</span><span class="keyword">, </span><span class="default">60</span><span class="keyword">,&nbsp; </span><span class="string">" je bent bezoeker "</span><span class="keyword">, </span><span class="default">$white</span><span class="keyword">);<br />
</span><span class="default">ImageString</span><span class="keyword">(</span><span class="default">$im</span><span class="keyword">, </span><span class="default">3</span><span class="keyword">, </span><span class="default">20</span><span class="keyword">, </span><span class="default">80</span><span class="keyword">, </span><span class="string">" </span><span class="default">$ip</span><span class="string">.</span><span class="default">$hit</span><span class="string">"</span><span class="keyword">, </span><span class="default">$trans</span><span class="keyword">);<br />
<br />
</span><span class="default">header</span><span class="keyword">(</span><span class="string">"Content-Type: image/gif"</span><span class="keyword">);<br />
</span><span class="default">Imagegif</span><span class="keyword">(</span><span class="default">$im</span><span class="keyword">,</span><span class="string">''</span><span class="keyword">,</span><span class="default">100</span><span class="keyword">);<br />
</span><span class="default">ImageDestroy </span><span class="keyword">(</span><span class="default">$im</span><span class="keyword">);<br />
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="51023""></a>
  <div class="note">
   <strong class="user">talkback at codesponge dot com</strong>
   <a href="#51023" class="date">16-Mar-2005 03:41</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Only one color may be transparent in one image.&nbsp; The last call to imagecolortransparent will be the color that is set to transparent.<br />
<br />
I am processing button images that have a slightly different fill color than the background color outside the border of the button. I was hoping that I could just make both of those colors transparent and solve the problem.<br />
<br />
Hope this tidbit of info will save you some time.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="48900""></a>
  <div class="note">
   <strong class="user">webmaster at webnetwizard dotco dotuk</strong>
   <a href="#48900" class="date">11-Jan-2005 06:09</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
After much devious mindbending, I have found a way to test any GIF for presence of background transparency. This ability is essential for my application which uploads any of GIF, JPEG or PNG and simultaneously creates a thumbnail of identical image type and identical filename (full size and thumbnail versions being stored in different folders).<br />
After uploading and moving the image in the usual way, a switch($image_type) statement ensures that the optimum code is used to generate the thumbnail; regardless of image type.<br />
The problem with the GIF type is that those with transparent backgrounds need to be treated differently to those without. When I don't detect GIF transparency, I either end up with all transparent GIF's having black backgrounds, or all GIF's get converted to transparent background - even if they weren't transparent in the original.<br />
But how to detect transparency in the original? It finally occurred to me that I could test for transparency programmatically by overlaying a copy of the original image over an all-black image, record the color value at particular pixel locations and then repeat the process by overlaying a copy of the original image over an all-white image, recording the color values at identical pixel locations and comparing these with the first set of values.<br />
If the two sets of values correlate exactly, and if sensible sampling points are used, the image can be treated as non-transparent. If the two sets of values show differences, the image should be treated as having a transparent background.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="46142""></a>
  <div class="note">
   <strong class="user">emilus at galeria-m dot art dot pl</strong>
   <a href="#46142" class="date">30-Sep-2004 02:02</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
To resize or copy image (gif [with gd&gt;=2.0.28] or png) with transparency.<br />
-Take current transparency color<br />
-create a new image with palette like old one and fill new image with transparent color<br />
-set transparent color<br />
-copy resized image<br />
<br />
$colorTransparent = imagecolortransparent($im);<br />
$im2 = imagecreate($new_w,$new_h);<br />
imagepalettecopy($im2,$im);<br />
imagefill($im2,0,0,$colorTransparent);<br />
imagecolortransparent($im2, $colorTransparent);<br />
imagecopyresized($im2,$im,0,0,0,0,$new_w,$new_h,$imsx,$imsy);</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="46030""></a>
  <div class="note">
   <strong class="user">php_comment et 5mm de</strong>
   <a href="#46030" class="date">27-Sep-2004 10:02</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
In fact this function can be used for two purposes:<br />
<br />
A.) to work with transparency while dealing with images in php (see watermark example)<br />
<br />
B.) to create a partially transparent picture<br />
<br />
For A.) one can work with truecolor images with some regulations, but B.) can only be used with palette-based images (= indexed = created with imagecreate not imagecreatetruecolor) and formats that support transparency (png, gif).<br />
<br />
For instance if you want to cut out a color out of a give picture that is in truecolor, use the following method to first convert it to palette-based image, assign the transparency and give it to the browser as png:<br />
<br />
&lt;?<br />
$img = imagecreatefromjpeg('test.jpg');<br />
imagetruecolortopalette($img, false, 256); // convert<br />
<br />
$white = imagecolorresolve($img, 255, 255, 255); // resolve given palette entry<br />
imagecolortransparent($img, $white);<br />
<br />
header("Content-type: image/png");<br />
imagepng($img);<br />
?&gt;</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="37420""></a>
  <div class="note">
   <strong class="user">php at kybert dot com</strong>
   <a href="#37420" class="date">14-Nov-2003 05:30</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
i had problems with the example by sandhawk at spies dot com because my png overlay, and the jpeg canvas were using different color depths, so, this function corrects this:<br />
<br />
[code]<br />
function WatermarkImage($CanvasImage, $WatermarkImage /* MUST BE PHG */, $Opacity=10, $Quality=75)<br />
{<br />
&nbsp;&nbsp;&nbsp; // create true color canvas image:<br />
&nbsp;&nbsp;&nbsp; $canvas_src = imagecreatefromjpeg($CanvasImage);<br />
&nbsp;&nbsp;&nbsp; $canvas_w = ImageSX($canvas_src);<br />
&nbsp;&nbsp;&nbsp; $canvas_h = ImageSY($canvas_src);<br />
&nbsp;&nbsp;&nbsp; $canvas_img = imagecreatetruecolor($canvas_w, $canvas_h);<br />
&nbsp;&nbsp;&nbsp; imagecopy($canvas_img, $canvas_src, 0,0,0,0, $canvas_w, $canvas_h);<br />
&nbsp;&nbsp;&nbsp; imagedestroy($canvas_src);&nbsp; &nbsp; // no longer needed<br />
<br />
&nbsp;&nbsp;&nbsp; // create true color overlay image:<br />
&nbsp;&nbsp;&nbsp; $overlay_src = imagecreatefrompng($WatermarkImage);<br />
&nbsp;&nbsp;&nbsp; $overlay_w = ImageSX($overlay_src);<br />
&nbsp;&nbsp;&nbsp; $overlay_h = ImageSY($overlay_src);<br />
&nbsp;&nbsp;&nbsp; $overlay_img = imagecreatetruecolor($overlay_w, $overlay_h);<br />
&nbsp;&nbsp;&nbsp; imagecopy($overlay_img, $overlay_src, 0,0,0,0, $overlay_w, $overlay_h);<br />
&nbsp;&nbsp;&nbsp; imagedestroy($overlay_src);&nbsp; &nbsp; // no longer needed<br />
<br />
&nbsp;&nbsp;&nbsp; // setup transparent color (pick one):<br />
&nbsp;&nbsp;&nbsp; $black&nbsp;&nbsp; = imagecolorallocate($overlay_img, 0x00, 0x00, 0x00);<br />
&nbsp;&nbsp;&nbsp; $white&nbsp;&nbsp; = imagecolorallocate($overlay_img, 0xFF, 0xFF, 0xFF);<br />
&nbsp;&nbsp;&nbsp; $magenta = imagecolorallocate($overlay_img, 0xFF, 0x00, 0xFF);&nbsp; &nbsp; <br />
&nbsp;&nbsp;&nbsp; // and use it here:<br />
&nbsp;&nbsp;&nbsp; imagecolortransparent($overlay_img, $white);<br />
<br />
&nbsp;&nbsp;&nbsp; // copy and merge the overlay image and the canvas image:<br />
&nbsp;&nbsp;&nbsp; imagecopymerge($canvas_img, $overlay_img, 0,0,0,0, $overlay_w, $overlay_h, $Opacity);<br />
<br />
&nbsp;&nbsp;&nbsp; // output:<br />
&nbsp;&nbsp;&nbsp; header("Content-type: image/jpeg");<br />
&nbsp;&nbsp;&nbsp; imagejpeg($canvas_img, '', $Quality);<br />
<br />
&nbsp;&nbsp;&nbsp; imagedestroy($overlay_img);<br />
&nbsp;&nbsp;&nbsp; imagedestroy($canvas_img);<br />
}<br />
<br />
// call function with opcity set to 50% and 95% quality<br />
WatermarkImage("canvas.jpg", "overlay.png", 50, 95);<br />
<br />
[/code]</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="36411""></a>
  <div class="note">
   <strong class="user">creator79&gt;&gt;web&gt;&gt;de</strong>
   <a href="#36411" class="date">08-Oct-2003 06:44</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Hi!<br />
I'm using GDLib 1.6.3 so far I know.<br />
You can have transparency on any defined color on any image type when using the imagecolorclosest($im, $R, $G, $B) function instead of imagecolorallocate() or imagecolorexact().</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="34642""></a>
  <div class="note">
   <strong class="user">calar at gamigo dot de</strong>
   <a href="#34642" class="date">01-Aug-2003 06:53</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
ok some works...<br />
<br />
i had a test-sytem with GDLib, phpinfo shows me this version:<br />
"GD Version&nbsp; 2.0 or higher" so far no porblems with: imageColorTransparent<br />
<br />
Then we had to copy ouer codes to another sever on this server phpinfo shots me version:<br />
"GD Version&nbsp; bundled (2.0.12 compatible)"<br />
<br />
The jpg was wrong and nothing was transparent.<br />
The point is, you have to use: imagecopymerge<br />
<br />
Don't if its true on any system just work on <br />
SUSE 8.2<br />
PHP 4.3.2</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="28035""></a>
  <div class="note">
   <strong class="user">Jonatan</strong>
   <a href="#28035" class="date">30-Dec-2002 10:35</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I have found that ImageColorTransparent() works on true color images if and only if the transparent color is black.<br />
(PHP 4.2.3/GD 2.0)</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
</div>
</div>
</div></div></body></html>
